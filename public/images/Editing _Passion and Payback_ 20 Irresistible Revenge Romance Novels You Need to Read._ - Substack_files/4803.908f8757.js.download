"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["4803"],{33803:function(e,t,n){n.d(t,{Z:()=>r});let r={elevatedTheme:"elevatedTheme-fBklGV"}},42450:function(e,t,n){n.d(t,{Z:()=>r});let r=/^(1588|1691|4457)$/.test(n.j)?null:{menu:"menu-WfPxpI",submenu:"submenu-tlfomG",floatingContainer:"floatingContainer-MUwyEF",menuItem:"menuItem-B7SAG_",disabled:"disabled-bXLaNs",priority_primary:"priority_primary-xntVG3",priorityPrimary:"priority_primary-xntVG3",priority_destructive:"priority_destructive-sXev9X",priorityDestructive:"priority_destructive-sXev9X",priority_secondary:"priority_secondary-prGxrw",prioritySecondary:"priority_secondary-prGxrw",relative:"relative-pHLTt2",icon:"icon-HSm3VM",text:"text-X3mTtF",transition:"transition-a_Ilul",show:"show-Kgvg96",hide:"hide-zZFh0h",actionSheetTransition:"actionSheetTransition-JBN9s_",actionSheetShow:"actionSheetShow-47rpBE",actionSheetHide:"actionSheetHide-QhOutK"}},68857:function(e,t,n){n.d(t,{Z:()=>r});let r=/^(2987|3154|3270|4716|6909|7437)$/.test(n.j)?{scrollBox:"scrollBox-zHkQVP",arrowButtonContainer:"arrowButtonContainer-O4uSiH",visible:"visible-JMTC0j",right:"right-i3oWGi",left:"left-Tg8vqp",arrowButtonOffsetContainer:"arrowButtonOffsetContainer-VMYLE4",arrowButtonOverlaidContainer:"arrowButtonOverlaidContainer-t10AyH",overlay:"overlay-zrMCxn",primary:"primary-lv_sOW",secondary:"secondary-pOosZC",arrowButtonOverlaid:"arrowButtonOverlaid-xLyA_z"}:null},29032:function(e,t,n){n.d(t,{C:()=>o});var r=n(16584),i=n(4615);let o=e=>{let{children:t,disable:n}=e;return n?(0,r.tZ)(r.HY,{children:t}):(0,r.tZ)(i.f6,{theme:"dark-theme",children:t})}},50012:function(e,t,n){n.d(t,{C:()=>g,l:()=>_});var r=n(7409);if(/^(2[79]87|1612|3154|4153|4716|6909)$/.test(n.j))var i=n(99282);var o=n(98848),a=n(16584),l=n(30396),s=n(94184),u=n.n(s),c=n(85685);if(/^(2[79]87|1612|3154|4153|4716|6909)$/.test(n.j))var d=n(93252);var p=n(63018),f=n(32700),h=n(63651);if(/^(2[79]87|1612|3154|4153|4716|6909)$/.test(n.j))var v=n(81821);var m=n(90271);function g(e){var{children:t,disabled:n}=e,l=(0,o._)(e,["children","disabled"]);return n||(0,v.tq)()||(0,d.P)()?(0,a.tZ)(a.HY,{children:t}):(0,a.tZ)(b,(0,i._)((0,r._)({},l),{children:t}))}function b(e){var t,n,s,u,d,{className:v,children:g,subject:b,placement:w="right-center",utmSource:y}=e,Z=(0,o._)(e,["className","children","subject","placement","utmSource"]);let[M,C]=(0,l.eJ)(!1),x=(t=null!==(d=null!==(u=b.slug)&&void 0!==u?u:b.handle)&&void 0!==d?d:(0,h._IO)(b),n={auto:M},(0,p._I)("/api/v1/user/".concat(t,"/public_profile"),n)),P=x.data,S=(0,f.o)((0,r._)({className:m.Z.profileHoverCard,loading:x.isLoading,hideOnScroll:!0,onOpen:()=>{C(!0)},layerOptions:{placement:w},content:P?(0,a.tZ)(c.ProfileCard,{profile:P,subject:b,utmSource:y,forceRefresh:()=>x.mutate()}):null},Z));return(0,a.BX)(_,(0,i._)((0,r._)({className:v},S.hoverProps),{forwardRef:null===(s=S.triggerProps)||void 0===s?void 0:s.ref,children:[g,S.layer]}))}function _(e){var{inline:t,className:n,forwardRef:i}=e,l=(0,o._)(e,["inline","className","forwardRef"]);return(0,a.tZ)("div",(0,r._)({className:u()("profile-hover-card-target",m.Z.profileHoverCardTarget,t&&m.Z.inline,n),ref:i},l))}},35543:function(e,t,n){n.d(t,{Sv:()=>B,Xe:()=>S,oJ:()=>j,oh:()=>O,yr:()=>k});var r=n(7409),i=n(99282),o=n(58865),a=n(16584),l=n(30396),s=n(82569),u=n.n(s),c=n(94734),d=n(17520),p=n(69241),f=n(19548),h=n(95441),v=n(60807),m=n(54371),g=n(6910),b=n(48980),_=n(63018),w=n(98914),y=n(44424),Z=n(70379),M=n(88817),C=n(23945);function x(){let e=(0,o._)(["Followed ",""]);return x=function(){return e},e}function P(){let e=(0,o._)(["Unfollowed ",""]);return P=function(){return e},e}function S(e){let t=(0,v.aF)();return(0,_._I)("/api/v1/feed/following",(0,r._)({auto:!!t},e))}function j(){let{mutate:e}=(0,p.kY)();return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return e("/api/v1/feed/following",...n)}}function O(e,t,n){let{isFollowing:r,toggle:i}=B(e,t,n),o=(0,v.aF)(),l=(0,f.gc)(null==e?void 0:e.id),s=!!(o&&e&&o.id!==e.id)&&!l,u=[];return s&&u.push((0,a.tZ)(y.sN,{leading:r?(0,a.tZ)(g.m,{stroke:"var(--color-fg-primary)"}):(0,a.tZ)(m.w,{stroke:"var(--color-fg-primary)"}),onClick:i,children:r?"Unfollow":"Follow"})),u}function B(e,t,n,o){let l=(0,v.aF)(),{onboardingModalRef:s,requireLogin:p}=(0,M.SJ)(),f=function(e,t){let{data:n}=S(t);return(null!=n?n:[]).includes(null!=e?e:0)}(null==e?void 0:e.id,o),{mutate:m,data:g}=S(o),_=(0,Z.pm)(),y=(0,C.Q1)((null==e?void 0:e.name)||""),{iString:j,iTemplate:O}=(0,h.M1)(),B=async o=>{if(e){if(!l&&s.current){p?p():s.current.open();return}m(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return o?[...t,e.id]:u()(t,e.id)},{revalidate:!1});try{await (0,b.rd)("/api/v1/feed/".concat(e.id,"/follow"),{method:o?"POST":"DELETE",json:{surface:t,noteId:n}}),_.popToast(e=>(0,a.tZ)(Z.FN,(0,i._)((0,r._)({},e),{Icon:o?c.Z:d.Z,text:o?O(x(),y):O(P(),y),cta:j("Undo"),onAccept:()=>B(!o)})))}catch(e){_.popToast(t=>(0,a.tZ)(Z.FN,(0,i._)((0,r._)({},t),{text:(0,w.zx)(e)})));return}}};return{isFollowing:f,toggle:()=>B(!f),isLoaded:!!g}}function k(e,t,n){let{isFollowing:r,toggle:i}=B(e,t,n),[o,a]=(0,l.eJ)(!1);return{isFollowing:r,buttonProps:{onClick:()=>{i(),r||a(!0)},onMouseLeave:()=>a(!1)}}}},80143:function(e,t,n){n.d(t,{Q:()=>l,Y:()=>s});var r=n(16584),i=n(98661),o=n(30396);let a=(0,i.createContext)({});function l(e){let{entityKey:t,children:n}=e;return(0,r.tZ)(a.Provider,{value:{entityKey:t},children:n})}function s(){return(0,o.qp)(a).entityKey}},6910:function(e,t,n){n.d(t,{m:()=>l});var r=n(7409),i=n(99282),o=n(98848),a=n(16584);function l(e){var{size:t=20,stroke:n="var(--color-light-secondary)"}=e,l=(0,o._)(e,["size","stroke"]);return(0,a.tZ)("svg",(0,i._)((0,r._)({},l),{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:n,xmlns:"http://www.w3.org/2000/svg",children:(0,a.tZ)("path",{id:"Vector",d:"M3 22C3 17.7044 6.69722 14.2222 11.258 14.2222C11.5081 14.2222 11.7556 14.2326 12 14.2531M21.0039 16.3098L18.6469 18.6668M18.6469 18.6668L16.2899 21.0239M18.6469 18.6668L21.0178 21.0377M18.6469 18.6668L16.276 16.2959M16.4118 6.44444C16.4118 8.89904 14.4102 10.8889 11.9412 10.8889C9.47214 10.8889 7.47059 8.89904 7.47059 6.44444C7.47059 3.98985 9.47214 2 11.9412 2C14.4102 2 16.4118 3.98985 16.4118 6.44444Z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})}))}},83786:function(e,t,n){n.d(t,{M:()=>o});var r=n(98661);let i=0;function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(0,r.useMemo)(()=>(i=++i>Number.MAX_SAFE_INTEGER?1:i,"".concat(e).concat(i)),t)}},9682:function(e,t,n){n.d(t,{bA:()=>l,js:()=>o,tv:()=>a});var r=n(30396),i=n(20042);function o(e,t){(0,r.d4)(()=>{let t=t=>{e(t)};return i.subscribers.push(t),()=>{i.subscribers.splice(i.subscribers.indexOf(t)>>>0,1)}},t)}function a(){let{path:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,n]=(0,r.eJ)({}),a=(0,r.sO)(null);o(e=>{a.current=e,n({})},[]);let l=a.current||(0,i.getCurrentUrl)(),s=l.replace(/\?.+$/,""),u=document.location.hash;return a.current=null,[{url:l,path:s,matches:e&&(0,i.exec)(s,e,{})||null,hash:u},i.route]}function l(){return history.state}},63018:function(e,t,n){n.d(t,{OV:()=>s,_I:()=>l,kp:()=>a.kp});var r=n(7409),i=n(98848),o=n(69241),a=n(48980);function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;var{deps:l,auto:s=!0,massage:u=async e=>e,shouldRevalidate:c=!0}=t,d=(0,i._)(t,["deps","auto","massage","shouldRevalidate"]);return(0,o.ZP)(s?l?[...l,e]:e:null,()=>(0,a.rd)(e,d).then(u),(0,r._)({},c?null:{revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1},n))}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var{deps:n}=t,r=(0,i._)(t,["deps"]);(0,o.MA)(n?[...n,e]:e,()=>(0,a.rd)(e,r))}},60684:function(e,t,n){n.d(t,{V:()=>v});var r=n(16584);if(!/^(1588|1691|4457)$/.test(n.j))var i=n(19425);var o=n(94184),a=n.n(o);if(!/^(1588|1691|4457)$/.test(n.j))var l=n(71375);var s=n(98661),u=n(20160),c=n(15771),d=n(80026),p=n(19081),f=n(58175);let h=/^(1588|1691|4457)$/.test(n.j)?null:{root:"root-BnqjqA",sheet:"sheet-dvfhcO",transition:"transition-yWeLc7",show:"show-xTDs8w",hide:"hide-F0u6Dg"},v=/^(1588|1691|4457)$/.test(n.j)?null:(0,s.forwardRef)((e,t)=>{let{title:n,onClose:o,children:s,className:v,paddingY:m=8}=e;return(0,r.tZ)(p.tu,{className:h.root,onClick:o,children:(0,r.tZ)(i.u.Child,{appear:!0,className:h.transition,enterFrom:h.hide,enterTo:h.show,leaveFrom:h.show,leaveTo:h.hide,children:(0,r.tZ)(u.W,{children:(0,r.BX)(p.tu,{className:a()(h.sheet,v),padding:8,ref:t,onClick:e=>{e.stopPropagation()},children:[!!n&&(0,r.BX)(r.HY,{children:[(0,r.BX)(p.hs,{justifyContent:"space-between",alignItems:"center",paddingX:8,paddingTop:8,paddingBottom:16,children:[(0,r.tZ)(p.tu,{gap:4,justifyContent:"center",children:(0,r.tZ)(f.xv.B3,{weight:"semibold",children:n})}),(0,r.tZ)(c.hU,{priority:"tertiary",onClick:()=>{o()},children:(0,r.tZ)(l.Z,{size:20})})]}),(0,r.tZ)(d.iz,{paddingX:8})]}),(0,r.tZ)(p.tu,{gap:8,paddingY:m,overflowY:"auto",children:s})]})})})})})},44424:function(e,t,n){if(n.d(t,{$j:()=>k,LF:()=>z,LY:()=>I,Mz:()=>N,dW:()=>U,ep:()=>O,sN:()=>B,v2:()=>P,xw:()=>$,yU:()=>F}),!/^(1588|1691|4457)$/.test(n.j))var r=n(7409);if(!/^(1588|1691|4457)$/.test(n.j))var i=n(99282);if(!/^(1588|1691|4457)$/.test(n.j))var o=n(98848);var a=n(16584);if(!/^(1588|1691|4457)$/.test(n.j))var l=n(19425);var s=n(94184),u=n.n(s);if(/^(1612|2987|4716|7437)$/.test(n.j))var c=n(2564);if(4716==n.j)var d=n(25380);var p=n(98661);if(/^(1612|2987|4716|7437)$/.test(n.j))var f=n(62372);var h=n(60684),v=n(71068),m=n(15771),g=n(61254),b=n(19081),_=n(10903),w=n(47295),y=n(50368),Z=n(4615),M=n(58175),C=n(91400),x=n(42450);let P=/^(1588|1691|4457)$/.test(n.j)?null:(0,p.forwardRef)((e,t)=>{var{trigger:n,children:s,ariaLabel:u="View more",hideOnScroll:c,layerOptions:d,layerClassName:f,onOpen:v,onClose:m,useMobileBottomSheet:g=!0,stopPropagation:b=!1,padding:w=4,disableMenu:Z=!1,title:M,Theme:P,customShowClass:B,customHideClass:k}=e,L=(0,o._)(e,["trigger","children","ariaLabel","hideOnScroll","layerOptions","layerClassName","onOpen","onClose","useMobileBottomSheet","stopPropagation","padding","disableMenu","title","Theme","customShowClass","customHideClass"]);"function"!=typeof n&&"string"!=typeof n.type&&n.type.$$typeof!==Symbol.for("react.forward_ref")&&console.error("Menu trigger must be a valid component that forwards a ref that react-laag uses, or a native dom element. See Button/IconButton for example, and preferably use those.");let N=(0,C.XA)(),{triggerProps:I,layerProps:$,renderLayer:T,isOpen:X,setOpen:F}=(0,_.x)({layerOptions:(0,r._)({auto:!0,possiblePlacements:["bottom-start","bottom-center","bottom-end","top-start","top-center","top-end"],preferY:"bottom"},d),hideOnScroll:c&&!(g&&N),onClose:m}),[U,z]=(0,p.useState)(!1),H=()=>{F(!1),m&&m()},Y=p.Children.map(s,e=>(0,p.cloneElement)(e,{useMobileBottomSheet:g,closeMenu:H})),D=(0,p.useMemo)(()=>({useMobileBottomSheet:g,close:H}),[m,g]),R=(0,i._)((0,r._)({},I),{ariaLabel:u,onClick:e=>{e.preventDefault(),b&&e.stopPropagation(),Z||F(!X),X?null==m||m():null==v||v()}});return(0,a.BX)(y.p.Provider,{value:D,children:["function"==typeof n?n(R):(0,p.cloneElement)(n,R),(X||U)&&T(g&&N?(0,a.tZ)(l.u,{appear:!0,show:X,beforeEnter:()=>z(!0),afterLeave:()=>z(!1),className:x.Z.actionSheetTransition,enterFrom:x.Z.actionSheetHide,enterTo:x.Z.actionSheetShow,leaveFrom:x.Z.actionSheetShow,leaveTo:x.Z.actionSheetHide,children:(0,a.tZ)(E,{Theme:P,children:(0,a.tZ)("div",(0,i._)((0,r._)({},$,L),{children:(0,a.tZ)(h.V,{title:M,onClose:H,ref:t,className:f,children:Y})}))})}):(0,a.tZ)(j,{isOpen:X,setAnimating:z,children:(0,a.tZ)(E,{Theme:P,children:(0,a.tZ)("div",(0,i._)((0,r._)({},$,L),{children:(0,a.tZ)(S,{isOpen:X,customHideClass:k,customShowClass:B,children:(0,a.tZ)(O,(0,i._)((0,r._)({className:f,ref:t,padding:w},!c&&{style:{overflowY:"auto"}}),{children:Y}))})}))})}))]})});function S(e){let{isOpen:t,customHideClass:n,customShowClass:r,children:i}=e;return(0,a.tZ)(l.u,{appear:!0,unmount:!1,show:t,className:x.Z.transition,enterFrom:null!=n?n:x.Z.hide,enterTo:null!=r?r:x.Z.show,leaveFrom:null!=r?r:x.Z.show,leaveTo:null!=n?n:x.Z.hide,children:i})}function j(e){let{children:t,isOpen:n,setAnimating:r}=e;return(0,a.tZ)(l.u,{appear:!0,unmount:!1,show:n,beforeEnter:()=>r(!0),afterLeave:()=>r(!1),className:x.Z.transition,children:t})}let O=/^(1588|1691|4457)$/.test(n.j)?null:(0,p.forwardRef)((e,t)=>{var{className:n,padding:i=4}=e,l=(0,o._)(e,["className","padding"]);return(0,a.tZ)(Z.Sf,{children:(0,a.tZ)(b.tu,(0,r._)({className:u()(x.Z.menu,"elevated",n),bg:"elevated",shadow:"md",border:"detail",radius:"sm",sizing:"border-box",showFocus:!0,gap:2,padding:i,ref:t},l))})}),B=/^(1588|1691|4457)$/.test(n.j)?null:(0,p.forwardRef)((e,t)=>{var n;return(0,a.tZ)(L,(0,i._)((0,r._)({},e),{className:u()(x.Z.menuItem,x.Z["priority_".concat(null!==(n=e.priority)&&void 0!==n?n:"primary")],e.className,{[x.Z.disabled]:!!e.disabled,[x.Z.relative]:!!e.hiddenInput}),children:e.children,ref:t}))}),k=(0,v.zo)({width:16,height:16}),L=/^(1588|1691|4457)$/.test(n.j)?null:(0,p.forwardRef)((e,t)=>{var{children:n,onClick:l,closeMenu:s,leading:u,trailing:c,priority:d="primary",className:f,disabled:h,href:v,download:g,hiddenInput:b}=e,_=(0,o._)(e,["children","onClick","closeMenu","leading","trailing","priority","className","disabled","href","download","hiddenInput"]);let Z=v?"a":m.kG,{close:M}=(0,y.X)();return(0,a.BX)(Z,(0,i._)((0,r._)({className:f,resetCss:!0,onClick:e=>{!h&&(l&&l(e),!e.defaultPrevented&&(M?M():s&&s()))},href:h?"javascript:void(0)":v,download:g,ref:t},_),{children:[u&&(0,a.tZ)(N,{children:(0,p.cloneElement)(u,{size:16})}),(0,a.tZ)(T,{priority:d,children:n}),c&&(0,a.tZ)(N,{children:(0,p.cloneElement)(c,{size:16})}),b&&(0,a.tZ)(w.U,{children:b})]}))}),N=(0,v.zo)({display:"flex",flex:"auto",width:24,height:24,alignItems:"center",justifyContent:"center"});function I(e){let{content:t,children:n,leading:o,trailing:l=(0,a.tZ)(c.Z,{size:20}),priority:s="primary"}=e,[u,d,p]=(0,f.XI)(),{triggerProps:h,layerProps:m,renderLayer:g}=(0,f.sJ)({isOpen:u,onParentClose:p,auto:!0,snap:!0,placement:"right-start",possiblePlacements:["left-start","right-start","left-end","right-end"],triggerOffset:0});return(0,a.BX)(a.HY,{children:[(0,a.tZ)(B,(0,i._)((0,r._)({},d,h),{onClick:e=>{e.preventDefault()},leading:o,trailing:l,priority:s,children:t})),u&&g((0,a.tZ)(v.xu,(0,i._)((0,r._)({},m,d),{children:(0,a.tZ)(O,{className:x.Z.submenu,padding:4,bg:"elevated",children:n})})))]})}function $(e){let{title:t,children:n,isFirst:r=!1}=e;return(0,a.BX)(b.tu,{gap:2,children:[!r&&(0,a.tZ)(g.iz,{paddingY:4,pullX:4}),t&&(0,a.tZ)(X,{children:t}),n]})}function T(e){let{priority:t,children:n}=e;return(0,a.tZ)(M.xv.B4,{color:"destructive"===t?"accent-red":"accent"===t?"pub-accent":t,weight:"medium",align:"left",flex:"grow",children:n})}function X(e){let{children:t}=e;return(0,a.tZ)(M.xv.B5,{transform:"uppercase",color:"secondary",weight:"regular",paddingX:4,paddingTop:4,children:t})}function F(e){let{children:t}=e;return(0,a.BX)(a.HY,{children:[(0,a.tZ)(b.tu,{paddingY:4,paddingX:8,children:(0,a.tZ)(M.xv.B4,{color:"secondary",children:t})}),(0,a.tZ)(g.iz,{pullX:8})]})}function U(e){let{children:t}=e;return(0,a.tZ)($,{children:(0,a.tZ)(b.tu,{paddingY:4,paddingX:8,children:(0,a.tZ)(M.xv.B5,{color:"secondary",children:t})})})}function E(e){let{Theme:t,children:n}=e;return t?(0,a.tZ)(t,{children:n}):n}function z(e){let{children:t,subtitle:n,onClick:r,onMouseEnter:i,closeMenu:o,leading:l,trailing:s,href:u,target:c,className:p,disabled:f=!1,selected:h=!1,native:v=!1,rel:m,download:g,hiddenInput:_,ref:w,useMobileBottomSheet:y}=e;return(0,a.tZ)(B,{onClick:r,onMouseEnter:i,closeMenu:o,leading:l,trailing:h?(0,a.tZ)(d.Z,{}):s,href:u,target:c,className:p,disabled:f,native:v,rel:m,download:g,hiddenInput:_,ref:w,useMobileBottomSheet:y,children:(0,a.BX)(b.sg,{alignItems:"start",children:[(0,a.tZ)(M.xv,{weight:"bold",color:"primary",children:t}),(0,a.tZ)(M.xv.B4,{color:"secondary",children:n})]})})}},47295:function(e,t,n){n.d(t,{U:()=>o});var r=n(16584);n(98661);let i=/^(1588|1691|4457)$/.test(n.j)?null:{hiddenInput:"hiddenInput-m9n617"},o=e=>{let{children:t}=e;return(0,r.tZ)("div",{className:i.hiddenInput,children:t})}},50368:function(e,t,n){n.d(t,{X:()=>o,p:()=>i});var r=n(98661);let i=/^(1588|1691|4457)$/.test(n.j)?null:(0,r.createContext)({useMobileBottomSheet:!0,close:()=>void 0});function o(){return(0,r.useContext)(i)}},10903:function(e,t,n){if(n.d(t,{x:()=>s}),!/^(1588|1691|4457)$/.test(n.j))var r=n(7409);if(!/^(1588|1691|4457)$/.test(n.j))var i=n(99282);var o=n(98661);if(!/^(1588|1691|4457)$/.test(n.j))var a=n(62372);var l=n(83786);let s=function(){let{layerOptions:e,hideOnScroll:t,onClose:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[s,u]=(0,o.useState)(!1),{triggerProps:c,layerProps:d,renderLayer:p}=(0,a.sJ)((0,r._)({isOpen:s,placement:"bottom-center",preferY:"bottom",triggerOffset:10,onOutsideClick:()=>{n&&n(),u(!1)}},e)),f=(0,l.M)("trigger"),h=(0,l.M)("dialog");return(0,o.useEffect)(()=>{if(t){let e=()=>{requestAnimationFrame(()=>{open&&t&&u(!1)})};return window.addEventListener("scroll",e,!0),()=>{window.removeEventListener("scroll",e,!0)}}},[t]),{triggerProps:(0,i._)((0,r._)({},c),{id:f,"aria-expanded":s,"aria-haspopup":"dialog","aria-controls":h}),layerProps:(0,i._)((0,r._)({},d),{id:h,role:"dialog",tabIndex:0,"aria-labeledby":f}),renderLayer:p,isOpen:s,setOpen:u}}},88817:function(e,t,n){n.d(t,{Ly:()=>o,SJ:()=>l,qr:()=>a});var r=n(6400),i=n(30396);let o=(0,r.createContext)({setChildOptions:()=>{},onboardingModalRef:{current:null},isLoading:!1,subscriptions:[],publicationUsers:[],onPageScroll:()=>void 0,setPinTitle:()=>void 0,setDrawer:()=>null,checkFocus:()=>!1,requireLogin:null});function a(e){let{shouldShowGetAppPill:t=!0,style:n,alwaysPinTitle:r,backAction:o,onRefresh:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=l();return(0,i.bt)(()=>{var i;null===(i=s.setChildOptions)||void 0===i||i.call(s,{title:e,style:n,alwaysPinTitle:r,backAction:o,shouldShowGetAppPill:t,onRefresh:a})},[s,e,n,o,t,a]),(0,i.bt)(()=>{var e;null===(e=s.setPinTitle)||void 0===e||e.call(s,!1)},[]),s}function l(){return(0,i.qp)(o)}},97842:function(e,t,n){n.d(t,{I0:()=>s,RN:()=>c,UX:()=>a,WG:()=>d,ge:()=>l,ky:()=>u});var r=n(6400),i=n(30396),o=n(63018);let a={user:null,inbox:{threadList:[],threads:new Map,filter:"all",resources:{all:{isLoading:!0,hasMore:!1},people:{isLoading:!0,hasMore:!1}}},users:new Map,profiles:new Map,communityPosts:new Map,communityComments:new Map,chats:new Map,comments:new Map,replies:new Map,conversations:new Map,publications:new Map,notes:new Map,editingPost:null},l=(0,r.createContext)(()=>Promise.resolve());function s(){return(0,i.qp)(l)}let u=(0,r.createContext)(a);function c(){return(0,i.qp)(u)}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return(0,o._I)("/api/v1/messages/unread-count",e,t)}},32189:function(e,t,n){n.d(t,{i:()=>s,x:()=>l});var r=n(30396),i=n(60807),o=n(68833),a=n(88817);function l(e){let{surface:t,zIndex:n=null}=e,l=(0,i.aF)(),{onboardingModalRef:s}=(0,a.SJ)();return(0,r.d4)(()=>{s.current&&null!==n&&(s.current.props.zIndex=n)},[s,n]),(e,n)=>r=>{if(!e){console.warn("No publication provided to usePubOnboardingHandler handler");return}if(!l){var i,a;if(!s.current)return;r.preventDefault(),n?null===(i=s.current)||void 0===i||i.openForPub(e,n):null===(a=s.current)||void 0===a||a.openToPubSignup(e);return}(0,o.x6)(e,t)}}function s(e){let{zIndex:t=null,onBeforeClose:n}=e,o=(0,i.aF)(),{onboardingModalRef:l}=(0,a.SJ)(),s=(0,r.sO)(null);return(0,r.d4)(()=>{o&&(s.current=o)},[o]),(0,r.d4)(()=>{l.current&&null!==t&&(l.current.props.zIndex=t)},[l,t]),e=>{if(!o&&l.current){n&&(l.current.onBeforeClose=()=>n(s.current)),e.preventDefault(),l.current.open();return}}}},64172:function(e,t,n){if(n.d(t,{Th:()=>m,Y0:()=>b,_V:()=>w,e:()=>v,lV:()=>f,p6:()=>g,th:()=>_}),/^(2[79]87|3154|3270|4716|6909)$/.test(n.j))var r=n(7409);if(/^(2[79]87|3154|3270|4716|6909)$/.test(n.j))var i=n(99282);if(/^(2[79]87|3154|3270|4716|6909)$/.test(n.j))var o=n(98848);var a=n(6400),l=n(30396),s=n(45578),u=n.n(s),c=n(48980);if(/^(2[79]87|3154|3270|4716|6909)$/.test(n.j))var d=n(17440);let p={hasLoadedOnce:!1,publications:[],subscriptions:[],publicationUsers:[],publicationMap:new Map,subscriptionMap:new Map,publicationUserMap:new Map,publicationsWithPledges:[]};function f(e){let{isLoggedIn:t,includePodcasts:n}=e,[o,a]=(0,l.eJ)((0,i._)((0,r._)({},p),{hasLoadedOnce:!t})),s=e=>{a(t=>{let n=u()([...t.publications,...e.publications],e=>e.id),i=u()([...t.subscriptions,...e.subscriptions],e=>e.publication_id),o=u()([...t.publicationUsers,...e.publicationUsers],e=>e.publication_id);return{hasLoadedOnce:!0,publications:n,subscriptions:i,publicationUsers:o,publicationMap:new Map(n.map(e=>[e.id,e])),subscriptionMap:new Map(i.map(e=>[e.publication_id,e])),publicationUserMap:new Map(o.map(e=>[e.publication_id,e])),publicationsWithPledges:[...t.publicationsWithPledges,...e.publicationsWithPledges],latestVoiceoverData:(0,r._)({},t.latestVoiceoverData,null==e?void 0:e.latestVoiceoverData),latestPodcastEpisodeData:(0,r._)({},t.latestPodcastEpisodeData,null==e?void 0:e.latestPodcastEpisodeData)}})};(0,l.d4)(()=>{if("serviceWorker"in navigator){let e=async e=>{var t;if((null===(t=e.data)||void 0===t?void 0:t.type)==="subscriptions-update"){let{payload:t}=e.data;t.ok&&s(t.json)}};return navigator.serviceWorker.addEventListener("message",e),()=>{navigator.serviceWorker.removeEventListener("message",e)}}},[]),(0,l.d4)(()=>{t&&(async()=>{try{for await(let e of y("/api/v1/subscriptions",{query:{include_podcasts:n?"1":void 0},getPageInit(e,t){let n=null==e?void 0:e.nextCursor;return n?(0,i._)((0,r._)({},t),{query:(0,i._)((0,r._)({},t.query),{cursor:n})}):null}}))s(e)}catch(e){console.warn(e)}})()},[t]);let f=(e,t)=>{let{subscription:n,publicationUser:o}=t;a(t=>(t=n?(0,i._)((0,r._)({},t),{subscriptions:t.subscriptions.map(e=>e.publication_id===n.publication_id?n:e),subscriptionMap:(0,d.Rg)(t.subscriptionMap,e,n)}):h(t,e),t=o?(0,i._)((0,r._)({},t),{publicationUsers:function(e,t,n){let r=(e=e.slice()).findIndex(t);return r>=0?e[r]=n:e.push(n),e}(t.publicationUsers,t=>t.publication_id===e,o),publicationUserMap:(0,d.Rg)(t.publicationUserMap,e,o)}):(0,i._)((0,r._)({},t),{publicationUsers:t.publicationUsers.filter(t=>t.publication_id!==e),publicationUserMap:(0,d.i4)(t.publicationUserMap,e)})))},v=async e=>{try{let t=await (0,c.rd)("/api/v1/subscription/".concat(e));f(e,t)}catch(t){t instanceof c.kp&&(404===t.response.status?a(t=>h(t,e)):console.error(t))}};return{result:o,isLoading:!1,hasLoadedOnce:o.hasLoadedOnce,refetch:async()=>o,refetchPublication:v,updatePublication:f,removeByPubId:e=>a(t=>h(t,e))}}function h(e,t){let n=e.subscriptions.filter(e=>e.publication_id!==t);return(0,i._)((0,r._)({},e),{subscriptions:n,subscriptionMap:new Map(n.map(e=>[e.publication_id,e]))})}let v=(0,a.createContext)({result:null,isLoading:!1,hasLoadedOnce:!1,refetch:()=>Promise.resolve(p),refetchPublication:()=>Promise.resolve(),updatePublication(){},removeByPubId:()=>{}});function m(){return(0,l.qp)(v)}function g(e){var t;let{subscriptionMap:n,publicationUserMap:r,publicationsWithPledges:i}=null!==(t=m().result)&&void 0!==t?t:{subscriptionMap:new Map,publicationUserMap:new Map,publicationsWithPledges:[]};return{subscription:n.get(e),publicationUser:r.get(e),is_pledged:!!(null==i?void 0:i.includes(e))}}function b(e){let{subscription:t,publicationUser:n,is_pledged:r}=g(e),i=(null==t?void 0:t.membership_state)==="free_signup",o=(null==t?void 0:t.membership_state)==="subscribed",a=!!(null==t?void 0:t.is_founding),l=!!(n&&["contributor","admin"].includes(n.role));return{subscription:t,publicationUser:n,isFreeSubscribed:i,isPaid:o,isSubscribed:i||o||l,isAuthor:l,isFounding:a,isPledged:r}}function _(){var e,t,n;let{publicationUsers:r,publicationMap:i}=null!==(e=m().result)&&void 0!==e?e:{publicationMap:new Map,publicationUsers:[]},o=null!==(n=null!==(t=r.find(e=>e.is_primary))&&void 0!==t?t:r.find(e=>"admin"===e.role))&&void 0!==n?n:r.find(e=>"contributor"===e.role);return o&&i.get(o.publication_id)}function w(e){var t,n;let{publicationUsers:r}=null!==(t=m().result)&&void 0!==t?t:{publicationUsers:[]};return null!==(n=r.find(t=>t.publication_id===e))&&void 0!==n?n:null}async function*y(e,t){var{getPageInit:n}=t,r=(0,o._)(t,["getPageInit"]);let i=await (0,c.rd)(e,r);yield i;let a=n(i,r);for(;null!=a;)i=await (0,c.rd)(e,a),yield i,a=n(i,r)}},17440:function(e,t,n){n.d(t,{F5:()=>l,FN:()=>s,Rg:()=>o,i4:()=>a,zg:()=>i});var r=n(7409);function i(e,t,n){let r=new Map(e);for(let e of t)r.set(n(e),e);return r}function o(e,t,n){let r=new Map(e);return r.set(t,n),r}function a(e,t){let n=new Map(e);return n.delete(t),n}function l(e,t,n){let i=e.get(t);if(null!=i){let o=new Map(e);return o.set(t,(0,r._)({},i,n)),o}return e}function s(e,t,n){let r=e.get(t);if(null!=r){let i=new Map(e);return i.set(t,n(r)),i}return e}},20521:function(e,t,n){n.d(t,{k:()=>a,x:()=>o});var r=n(98012);function i(e){var t;let n=[e.is_primary,(null===(t=e.publication)||void 0===t?void 0:t.author_id)===e.user_id,"admin"===e.role,"contributor"===e.role].map(e=>e?"0":"1").join("");return"".concat(n,"-").concat((0,r.Z)(e.created_at).valueOf())}function o(e){return e.slice(0).sort((e,t)=>i(e)>i(t)?1:-1)}function a(e){let{ineligibilityReasons:t,isSelfOrGlobalAdmin:n}=e,r=!0;for(let e of t)switch(e){case"not_member_of_pub":return!1;case"not_primary_pub":case"primary_user_of_other_pub":r=r&&n}return r}},62515:function(e,t,n){n.d(t,{Ds:()=>s,Rm:()=>o,aD:()=>a,gp:()=>l});var r=n(14773),i=n(63651);function o(e,t){return(0,r.Q2)("/chat/".concat(e),t)}function a(e,t){return(0,r.Q2)("/chat/".concat(e),t)}function l(e){return(0,r.Q2)("/chat/new",e)}function s(e){let{userId:t,userName:n}=e,o=(0,i.JlE)({userId:t,userName:n});return"".concat((0,r.ZX)(),"/chat/dm/user/").concat(o)}}}]);