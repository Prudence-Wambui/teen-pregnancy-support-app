"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["6835"],{30301:function(e,t,i){i.d(t,{Z:()=>a});let a={table:"table-BAJTHQ",tr:"tr-jyGCha",tbody:"tbody-EyZ57l","border-left-detail":"border-left-detail-eIBFIK",borderLeftDetail:"border-left-detail-eIBFIK",td:"td-ucFIGn",th:"th-Z3IRfp","border-bottom-detail":"border-bottom-detail-JKtjOR",borderBottomDetail:"border-bottom-detail-JKtjOR",thead:"thead-yvbVgS",tfoot:"tfoot-nBK5Jw",caption:"caption-ljUjSd",handle:"handle-TqIPca"}},8131:function(e,t,i){i.d(t,{Z:()=>U});var a=i(58865),n=i(16584),r=i(98661),o=i(30396),l=i(94184),d=i.n(l),s=i(8400),c=i.n(s),u=i(23279),p=i.n(u),m=i(23493),h=i.n(m),v=i(80569),g=i.n(v),w=i(93666),f=i(95441),y=i(15771),b=i(19081),Z=i(98248),x=i(58175),C=i(60308);function _(){let e=(0,a._)(["No results for “","”"]);return _=function(){return e},e}let E=e=>e.toLowerCase().trim()||"random",P=()=>{let{iString:e}=(0,f.M1)();return[{id:"B&W",name:e("B&W"),imageUrl:"/img/generate-presets/bw-portrait.jpg",prompt:()=>"B&W close up portrait, ambient light, Nikon 15mm f/1.8G, by Lee Jeffries, Alessio Albi, Adrian Kuipers"},{id:"Photo",name:e("Photo"),imageUrl:"/img/generate-presets/photo.jpg",prompt:()=>"Professional photography, bokeh, natural lighting, canon lens, shot on dslr 64 megapixels sharp focus"},{id:"Comic",name:e("Comic"),imageUrl:"/img/generate-presets/comic.jpg",prompt:()=>"Mark Brooks and Dan Mumford, comic book art, perfect, smooth cell shading"},{id:"Logo",name:e("Logo"),imageUrl:"/img/generate-presets/logo.jpg",prompt:()=>"2d, flat, vector illustration, football team emblem, logo, centered, sharp, clean linework, head-on"},{id:"Anime",name:e("Anime"),imageUrl:"/img/generate-presets/anime.jpg",prompt:()=>"Studio Ghibli, Anime Key Visual, by Makoto Shinkai, Deep Color, Intricate, 8k resolution concept art, Natural Lighting, Beautiful Composition"},{id:"Pixel",name:e("Pixel"),imageUrl:"/img/generate-presets/pixel.jpg",prompt:()=>"as a logo, 16-bit, Pixel, SNES Style, Susan Kare, Highly detailed, Modern, Simple Background"},{id:"Paint",name:e("Paint"),imageUrl:"/img/generate-presets/vangough.jpg",prompt:()=>{let e=["Van Gogh","John Sargent","Josephine Wall","Claude Monet","Edward Hopper","Edvard Munch","Gustav Klimt","Henry Asencio","Paul Cezanne","J M W Turner","Pablo Picasso"],t=e[Math.floor(Math.random()*e.length)];return"by ".concat(t,", oil painting, canvas, expressive, colorful")}},{id:"Blur",name:e("Blur"),imageUrl:"/img/generate-presets/richter.jpg",prompt:()=>"gerhard richter, photorealistic painting, motion blur"},{id:"Epic",name:e("Epic"),imageUrl:"/img/generate-presets/epic.jpg",prompt:()=>"Epic cinematic brilliant stunning intricate meticulously detailed dramatic atmospheric maximalist digital matte painting"},{id:"Toon",name:e("Toon"),imageUrl:"/img/generate-presets/cartoon.jpg",prompt:()=>"Pixar, Disney, concept art, 3d digital art, Maya 3D, ZBrush Central 3D shading, bright colored background, radial gradient background, cinematic, Reimagined by industrial light and magic, 4k resolution post processing"},{id:"Neon",name:e("Neon"),imageUrl:"/img/generate-presets/neon.jpg",prompt:()=>"synthwave, bladerunner, neon lights, midnight 80s vibe"},{id:"Etching",name:e("Etching"),imageUrl:"/img/generate-presets/lithograph.jpg",prompt:()=>"Lithography, letterpress intaglio mezzotint linocut"}]},U=e=>{var t;let{open:i,onAfterClose:a,onImageSelected:l,onUrlSelected:s,insertionPointSelector:u,className:m=""}=e,{iString:v,iTemplate:U}=(0,f.M1)(),N=P();l&&s&&console.error("onImageSelected and onUrlSelected are mutually exclusive");let[S,k]=(0,o.eJ)(""),[B,I]=(0,o.eJ)(""),[T,M]=(0,o.eJ)(null),[R,D]=(0,o.eJ)(!1),[L,O]=(0,o.eJ)(!1),X=(0,o.sO)(null),z=(0,o.sO)(null),A=(0,o.sO)(null),[F,j]=(0,o.eJ)(!1),[V,H]=(0,o.eJ)(null);(0,o.d4)(()=>(i&&(X.current.open(),setTimeout(()=>{z.current.focus()},50)),()=>{M(null),k(""),I(""),H(null)}),[i]),(0,o.d4)(()=>{let e=h()(()=>{},200,{leading:!1}),t=A.current;return i&&(null==t||t.addEventListener("scroll",e)),()=>{null==t||t.removeEventListener("scroll",e)}},[i]);let J=(0,o.I4)(async e=>{let{prompt:t,style:i}=e,a=E(t);try{D(!1),j(!0);let e=await g().post("/api/v1/generate_image/generate_art").send({prompt:a,style:i,num_images:4});I(S),j(!1),D(!1),M(i=>e.body.map(e=>({prompt:t,uri:e})).concat(null!=i?i:[])),A.current.scrollTop=0}catch(e){console.error("error searching images:",e),(null==e?void 0:e.status)===429?(alert("Image generation is limited to 6 requests per minute. Please try again in a minute."),j(!1)):(M(null),j(!1),D(!0))}},[S]),q=(0,o.I4)(p()(J,400),[J]),W=async e=>{var t;k(e);let i=N.find(e=>V===e.id);await q({prompt:e,style:null!==(t=null==i?void 0:i.prompt())&&void 0!==t?t:""})},K=null!==(t=document.querySelector(u))&&void 0!==t?t:document.body,G=async e=>{O(!0);try{if(s)await s({url:e.uri,prompt:e.prompt});else if(l){j(!0);let t=await g().post("/api/v1/generate_image/get_img_as_blob").send({url:e.uri}).responseType("blob");j(!1),D(!1),await l(t.body)}else console.error("no onSelected callback set")}catch(e){D(!0),j(!1)}O(!1),X.current.close()},Y=!!(F&&!(null==T?void 0:T.length)),Q=!!(F&&(null==T?void 0:T.length));return(0,r.createPortal)((0,n.tZ)("div",{onMouseDown:e=>{e.stopPropagation()},children:(0,n.BX)(w.p,{ref:X,closePill:!0,className:d()("insert-media-modal","insert-image-modal","insert-generated-image-modal","force-light-theme",m),onClose:a,children:[(0,n.tZ)("h3",{className:"insert-media-modal-header",children:v("Generate image")}),(0,n.BX)(b.tu,{gap:12,flex:"grow",children:[(0,n.tZ)("div",{className:"form new-form",children:(0,n.tZ)("form",{onSubmit:e=>{e.preventDefault(),W(S)},children:(0,n.BX)(b.tu,{gap:8,children:[(0,n.BX)(b.gq,{gap:8,children:[(0,n.tZ)("input",{className:"insert-image-modal-search",ref:z,type:"text","aria-label":v("Prompt"),placeholder:v("Describe what you want to create..."),value:S,onChange:e=>{k(e.target.value)}}),(0,n.tZ)(y.zx,{type:"submit",onClick:()=>{W(S)},disabled:F,children:v("Generate")})]}),(0,n.BX)(b.tu,{gap:8,children:[(0,n.tZ)(x.xv.Meta,{translated:!0,children:"Select a style (Optional)"}),(0,n.BX)(b.gq,{className:"presetRowContainer-XmnGot",children:[(0,n.tZ)("div",{className:"fade-Z_mZfF"}),(0,n.tZ)(b.gq,{className:"presetRow-qZS76T",gap:8,justifyContent:"start",alignItems:"start",paddingRight:32,paddingBottom:8,children:N.map(e=>(0,n.BX)(b.tu,{gap:4,justifyContent:"center",className:d()("preset-ikTtJa",{"selected-L0vQ3m":V===e.id,"unselected-TRcwOG":V&&V!==e.id}),onClick:()=>{V===e.id?H(null):H(e.id)},children:[(0,n.tZ)("img",{className:"presetImage-fEP9jz",src:(0,C.zF4)(e.imageUrl,144),alt:e.name}),(0,n.tZ)(x.xv.Meta,{className:"presetName-apjTm3",children:e.name})]}))})]})]})]})})}),(0,n.BX)("div",{className:d()("insert-image-modal-body","modalBody-h6TeXI"),ref:A,children:[R&&(0,n.tZ)("div",{className:"insert-image-modal-empty",children:v("Something went wrong. Please try again later.")}),Y||L?T&&0===T.length?(0,n.tZ)("div",{className:"insert-image-modal-empty",children:U(_(),B)}):(0,n.tZ)("div",{className:"insert-image-modal-empty",children:Y||L?(0,n.BX)(b.tu,{gap:8,alignItems:"center",justifyContent:"center",children:[(0,n.tZ)(Z.$j,{}),(0,n.tZ)(x.xv,{font:"text",translated:!0,children:"Generating images…"})]}):(0,n.tZ)(x.xv,{font:"text",translated:!0,children:"Enter a prompt above to generate an image"})}):(0,n.BX)(b.tu,{gap:12,className:"insert-image-modal-images",children:[Q&&(0,n.BX)(b.gq,{gap:8,alignItems:"center",justifyContent:"center",children:[(0,n.tZ)(Z.$j,{}),(0,n.tZ)(x.xv,{font:"text",translated:!0,children:"Generating images…"})]}),c()(T,2).map(e=>(0,n.tZ)(b.gq,{gap:12,children:e.map((e,t)=>(0,n.BX)("div",{className:"insert-image-modal-item",onClick:()=>{G(e)},children:[(0,n.tZ)("img",{src:e.uri}),(0,n.tZ)("div",{className:"insert-image-modal-item-footer",children:(0,n.tZ)(y.zx,{priority:"secondary",disabled:L,children:v("Insert")})})]},t))}))]})]})]})]})}),K)}},16564:function(e,t,i){i.d(t,{KH:()=>B,MR:()=>C,PN:()=>_,YX:()=>I,_g:()=>E,cM:()=>S,ko:()=>P,nO:()=>k});var a,n,r,o=i(7409),l=i(99282),d=i(58865),s=i(16584),c=i(94184),u=i.n(c),p=i(1852),m=i(86657);i(36081),i(36813);var h=i(99987),v=i(1055),g=i(72708),w=i(95441);i(68833);var f=i(15771),y=i(6490),b=i(84864),Z=i(72925);function x(){let e=(0,d._)(["Playback rate ",""]);return x=function(){return e},e}var C=((a={}).Embed="Embed audio",a.Voiceover="Add voiceover",a.Podcast="Audio",a.PodcastPreview="Podcast free version",a.VideoPodcast="Video",a.ShareQuote="Share quote",a),_=((n={}).Embed="Upload or record an audio file embedded into the text.",n.Voiceover="Upload or record a new voiceover: an audio version of your post.",n.Podcast="Create a new audio post by uploading or recording an audio file.",n.PodcastPreview="Upload a file that will appear to free users on the website and in their feeds.",n.VideoPodcast="Create a new video post by uploading or recording a video file. The audio from your video will be delivered to podcast players if selected in the publish settings.",n.ShareQuote="Upload or record an audio file that will be used as a share quote.",n),E=((r={})[r.PubAccent=0]="PubAccent",r[r.PubFull=1]="PubFull",r[r.Substack=2]="Substack",r);let P=e=>{let{containerRef:t,currentTime:i,remainingTime:a,progress:n,onMouseDown:r,shouldCollapseOnMobile:o=!1,theme:l=1}=e;return(0,s.BX)("div",{className:"tw-flex tw-grow tw-items-center tw-gap-3 tw-font-meta tw-text-sm tw-text-substack-primary sm:tw-gap-3","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":100*n,children:[(0,s.tZ)("div",{className:u()("tw-min-w-[40px] tw-text-right",{"tw-hidden sm:tw-block":o}),children:i}),(0,s.BX)("div",{ref:t,className:u()("tw-relative tw-h-5 tw-grow ",{"tw-ml-2 sm:tw-ml-0":o}),onMouseDown:r,children:[(0,s.tZ)("div",{className:u()("audio-progress-bar tw-absolute tw-top-2 tw-right-0 tw-left-0 tw-h-1 tw-rounded",{"tw-bg-pub-detail":1===l,"tw-bg-substack-detail":1!==l})}),(0,s.tZ)("div",{className:u()("tw-absolute tw-top-2 tw-left-0 tw-h-1 tw-rounded-l-full",{"tw-bg-pub-accent":2!==l,"tw-bg-substack-accent":2===l}),style:{width:"".concat(100*n,"%")}}),(0,s.tZ)("div",{className:u()("audio-playhead tw-absolute tw-ml-[-10px] tw-h-4 tw-w-4 tw-rounded-full tw-border-2 tw-border-solid ",{"tw-border-pub-background":1===l,"tw-border-substack-bg":1!==l,"tw-bg-substack-accent":2===l,"tw-bg-pub-accent":2!==l}),style:{left:"".concat(100*n,"%")}})]}),(0,s.tZ)("div",{className:"tw-min-w-[40px]",children:a})]})},U=[{value:1,display:"1"},{value:1.25,display:"1.25"},{value:1.5,display:"1.5"},{value:1.75,display:"1.75"},{value:2,display:"2"}],N=e=>{var t;let{onSetPlaybackRate:i,playbackRate:a,className:n}=e,r=U.findIndex(e=>{let{value:t}=e;return t===a}),{iTemplate:o}=(0,w.M1)(),l=(null==U?void 0:null===(t=U[r])||void 0===t?void 0:t.display)?"".concat(null==U?void 0:U[r].display,"x"):"";return(0,s.BX)("div",{onClick:()=>{let e=(r+1)%U.length;i(U[e].value)},className:n,"aria-label":o(x(),l),children:[U[r].display,"\xd7"]})},S=e=>{let{iString:t}=(0,w.M1)();return(0,s.tZ)(m.Z,(0,l._)((0,o._)({},e),{metricsPost:e.post,feature:"Embed audio",render:i=>{let{currentTime:a,isPlaying:n,progress:r,progressBarRef:o,progressBarOnMouseDown:l,remainingTime:d,playbackRate:c,setPlaybackRate:u,togglePlayback:p}=i;return(0,s.BX)("div",{"data-component-name":"AudioEmbedPlayer","data-drag-handle":"",className:"audio-embed tw-my-4 tw-box-border tw-flex tw-w-full tw-select-none tw-items-center tw-gap-4 tw-space-y-0 tw-rounded-full tw-bg-pub-wash tw-p-4 tw-font-sans sm:tw-gap-5",role:"region","aria-label":t("Audio embed player"),children:[(0,s.tZ)(N,{onSetPlaybackRate:u,playbackRate:c,className:"audio-button tw-w-12 tw-cursor-pointer tw-rounded-full tw-border tw-border-solid tw-border-pub-detail-light tw-py-1 tw-text-center tw-font-meta tw-text-sm tw-font-semibold tw-leading-none tw-text-pub-secondary-text hover:tw-border-pub-detail"}),(0,s.BX)("div",{className:"tw-flex tw-w-full tw-flex-wrap",children:[e.label&&(0,s.tZ)("div",{className:"tw-basis-full tw-pb-2 tw-text-ssm tw-font-semibold tw-text-pub-primary-text",children:e.label}),(0,s.tZ)("div",{className:"tw-flex tw-w-full tw-items-center tw-justify-between tw-gap-2 sm:tw-gap-4",children:(0,s.tZ)(P,{currentTime:a,remainingTime:d,containerRef:o,progress:r,onMouseDown:l})})]}),(0,s.tZ)("div",{className:"audio-embed-play-button tw-relative tw-flex tw-h-12 tw-w-12 tw-shrink-0 tw-cursor-pointer tw-items-center tw-justify-center tw-rounded-full tw-border-2 tw-border-solid tw-border-pub-detail tw-bg-pub-background tw-transition-transform hover:tw-scale-105",onClick:p,role:"button","aria-label":t("Play/pause"),children:n?(0,s.BX)("div",{className:"tw-flex tw-h-5 tw-w-4 tw-justify-between",children:[(0,s.tZ)("div",{className:"pause-icon tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"}),(0,s.tZ)("div",{className:"pause-icon tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"})]}):(0,s.tZ)(v.Z,{className:"tw-relative tw-left-[.1rem] tw-fill-pub-accent",stroke:"none",height:18})})]})}}))},k=e=>{var t;let{pub:i,post:a,duration:n,label:r}=e,{iString:o}=(0,w.M1)();return(0,s.tZ)("table",{"data-component-name":"AudioEmbedPlayerStatic",className:"tw-w-full tw-rounded-full tw-bg-substack-wash",children:(0,s.tZ)("tr",{children:(0,s.tZ)("td",{className:"tw-text-center tw-font-meta tw-text-ssm tw-uppercase tw-text-substack-primary",children:(0,s.BX)("a",{href:null==a?void 0:a.canonical_url,className:u()("tw-block tw-w-full tw-p-4 tw-text-substack-primary",Z.Z.noUnderline),children:[(0,s.tZ)(h.Z,{className:"tw-w-max-4 tw-mr-2 tw-inline-block tw-w-4 tw-align-middle",stroke:null===(t=i.theme)||void 0===t?void 0:t.background_pop_color,isStatic:!0}),(0,s.BX)("span",{className:"tw-align-middle",children:[(0,b.truncateText)(r,10)||o("Listen now")," \xb7 ",(0,b.secondsToHHMMSS)(n||0)]})]})})})})},B=e=>{let t=(0,p.useMediaQuery)({maxWidth:631}),i="/api/v1/audio/upload/".concat(e.mediaUploadId,"/src"),{iString:a}=(0,w.M1)();return(0,s.tZ)(m.Z,(0,l._)((0,o._)({},e),{src:i,feature:"Add voiceover",metricsPost:e.post,render:e=>{let{isPaywalled:i,currentTime:n,isPlaying:r,progress:o,progressBarRef:l,progressBarOnMouseDown:d,remainingTime:c,playbackRate:u,setPlaybackRate:p,togglePlayback:m}=e;return(0,s.BX)("div",{className:"tw-mb-6 tw-flex sm:tw-gap-1",children:[(0,s.tZ)("div",{className:"tw-hidden tw-h-20 tw-shrink-0 tw-basis-20 tw-items-center tw-justify-center tw-rounded-md tw-bg-pub-wash tw-fill-pub-primary-text tw-text-pub-primary-text sm:tw-flex",children:(0,s.tZ)(g.Z,{className:"tw-stroke-pub-secondary-text"})}),(0,s.BX)("div",{className:"tw-box-border tw-flex tw-h-20 tw-w-full tw-select-none tw-items-center tw-gap-3 tw-space-y-0 tw-rounded-l-md tw-rounded-r-[64px] tw-bg-pub-wash  tw-p-4 tw-font-sans",children:[i?(0,s.tZ)("div",{className:"tw-flex tw-w-full tw-flex-wrap tw-justify-center tw-text-ssm tw-text-pub-secondary-text sm:tw-text-sm",children:a("Upgrade to paid to play voiceover")}):(0,s.BX)("div",{className:"tw-flex tw-w-full tw-flex-wrap",children:[(0,s.tZ)("div",{className:"tw-basis-full tw-pb-2 tw-text-ssm tw-font-semibold tw-uppercase tw-text-pub-secondary-text",children:a("Article voiceover")}),(0,s.BX)("div",{className:"tw-flex tw-w-full tw-items-center tw-justify-between tw-gap-2 ",children:[(0,s.tZ)(N,{onSetPlaybackRate:p,playbackRate:u,className:"tw-w-12 tw-cursor-pointer tw-rounded-full tw-border tw-border-solid tw-border-pub-detail-light tw-py-1 tw-text-center tw-font-meta tw-text-sm tw-font-semibold tw-leading-none tw-text-pub-secondary-text hover:tw-border-pub-detail"}),(0,s.tZ)(P,{currentTime:n,remainingTime:c,containerRef:l,progress:o,onMouseDown:d,shouldCollapseOnMobile:!0})]})]}),i?(0,s.tZ)("div",{className:"tw-relative tw-flex tw-h-14 tw-w-14 tw-shrink-0 tw-cursor-not-allowed tw-items-center tw-justify-center tw-rounded-full tw-border-2 tw-border-solid tw-border-pub-detail tw-bg-pub-background tw-transition-transform",children:(0,s.tZ)(v.Z,{className:"tw-relative tw-left-[.15rem] tw-fill-pub-detail",stroke:"none",height:t?20:24})}):(0,s.tZ)("div",{className:"tw-relative tw-flex tw-h-14 tw-w-14 tw-shrink-0 tw-cursor-pointer tw-items-center tw-justify-center tw-rounded-full tw-border-2 tw-border-solid  tw-border-pub-detail tw-bg-pub-background tw-transition-transform hover:tw-scale-105",onClick:m,role:"button",children:r?(0,s.BX)("div",{className:"tw-flex tw-h-5 tw-w-5 tw-justify-between",children:[(0,s.tZ)("div",{className:"tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"}),(0,s.tZ)("div",{className:"tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"})]}):(0,s.tZ)(v.Z,{className:"tw-relative tw-left-[.15rem] tw-fill-pub-accent",stroke:"none",height:20})})]})]})}}))},I=e=>{let{isOpen:t,onDismiss:i}=e,{iString:a}=(0,w.M1)();return(0,s.BX)(y.u_,{isOpen:t,onClose:i,children:[(0,s.tZ)(y.xB,{showClose:!1,title:a("Something went wrong...")}),(0,s.tZ)(y.fe,{children:a("Unfortunately, there was a problem with your audio file upload. We'll investigate, but in the meantime, please try again, and we apologize for the inconvenience.")}),(0,s.tZ)(y.mz,{showDivider:!1,direction:"row",primaryButton:(0,s.tZ)(f.zx,{onClick:i,priority:"primary",children:a("Got it")})})]})}},74679:function(e,t,i){i.d(t,{p:()=>d});var a=i(16584),n=i(30396),r=i(98961),o=i(66067),l=i(15771);let d=e=>{let{editor:t,pub:i,postId:d,setPostId:s}=e,{isVideoEmbedDrawerOpen:c,setIsVideoEmbedDrawerOpen:u}=(0,o.B)(),[p,m]=(0,n.eJ)(null),[h,v]=(0,n.eJ)(!1),g=e=>{e.preventDefault(),v(!0)};return(0,n.d4)(()=>{if(h){let{mediaUploadId:e}=t.view.state.selection.node.attrs;m(e),u({isOpen:!0})}},[h,t.view.state.selection.node]),(0,n.d4)(()=>(document.addEventListener("editSelectedVideoEmbed",g),()=>{document.removeEventListener("editSelectedVideoEmbed",g)}),[]),(0,a.BX)(a.HY,{children:[(0,a.tZ)(l.hU,{priority:"tertiary",size:"sm",onClick:()=>u({isOpen:!c}),children:(0,a.tZ)(r.Z,{size:20})}),(0,a.tZ)(o.t,{id:"videoEmbed",editorDroppedFile:null,mediaUploadId:p,open:c,pub:i,postId:d,onClose:()=>{u({isOpen:!1,clearPreventChange:!0}),v(!1),m(null)},onSave:e=>{let{mediaUploadId:i,duration:a}=e;t.chain().focus().insertVideo({mediaUploadId:i,duration:a}).run()},setPostId:s})]})}},81924:function(e,t,i){i.d(t,{i:()=>C,w:()=>_});var a=i(16584),n=i(30396),r=i(55679),o=i(70109),l=i(94184),d=i.n(l),s=i(23279),c=i.n(s),u=i(47976),p=i(95441),m=i(22747),h=i(68833),v=i(98914),g=i(15771),w=i(19081),f=i(38023),y=i(6490),b=i(58175),Z=i(81355),x=i(60520);let C=e=>{let{isOpen:t,onClose:i,persistentExpression:r,node:l}=e,[d,s]=(0,n.eJ)(r),{iString:u}=(0,p.M1)(),[v]=(0,n.eJ)(()=>c()(s,1e3));return(0,n.d4)(()=>{s(r)},[r]),(0,a.tZ)(Z.e,{children:(0,a.BX)(y.u_,{isOpen:t,onClose:i,"data-test-id":"latex-modal",children:[(0,a.tZ)(y.fe,{children:(0,a.BX)(w.tu,{paddingTop:8,gap:24,children:[(0,a.BX)(w.tu,{gap:24,children:[(0,a.tZ)(w.gq,{justifyContent:"space-between",alignItems:"center",children:(0,a.tZ)(b.xv.Meta,{translated:!0,children:"LaTeX Editor"})}),(0,a.tZ)(f.g,{"data-test-id":"latex-input",rows:4,maxLength:1e3,value:d,name:"expression",onChange:e=>{v(e.target.value)}})]}),d?(0,a.tZ)(w.tu,{height:160,children:(0,a.tZ)(o.Z,{typesettingOptions:{fn:"tex2chtml",options:void 0},text:"".concat(d),renderMode:"pre",inline:!1,dynamic:!0})}):(0,a.tZ)(w.tu,{children:(0,a.tZ)(w.tu,{radius:"md",paddingX:12,paddingY:20,alignItems:"center",children:(0,a.tZ)(b.xv.B4,{fontStyle:"italic",translated:!0,color:"secondary",align:"center",children:"Write LaTeX expressions in the above editor and they'll appear here"})})})]})}),(0,a.tZ)(y.mz,{showDivider:!1,direction:"row",primaryButton:(0,a.tZ)(g.zx,{"data-test-id":"latex-save",priority:"primary",onClick:()=>{(0,h.j)(h.FP.LATEX_BLOCK_ADDED,{expression:d}),(0,m.oj)().dispatchEvent(new CustomEvent("close",{detail:{persistentExpression:d,node:l}})),i()},children:u("Save")}),secondaryButton:(0,a.tZ)(g.zx,{"data-test-id":"latex-cancel",priority:"secondary",onClick:()=>{(0,m.oj)().dispatchEvent(new CustomEvent("close",{detail:{persistentExpression:r,node:l}})),d!==r&&s(r),i()},children:u("Cancel")})})]})})},_=e=>{let{node:t,id:i}=e,[l,s]=(0,n.eJ)(t.attrs.persistentExpression);return(0,n.d4)(()=>{s(t.attrs.persistentExpression)},[t]),(0,n.d4)(()=>{let e=e=>{let{detail:i}=e;i.node.attrs.id===t.attrs.id&&s(i.persistentExpression)};return(0,m.oj)().addEventListener("close",e),()=>{(0,m.oj)().removeEventListener("close",e)}},[]),(0,a.tZ)(r.T5,{"data-drag-handle":"",children:(0,a.tZ)(Z.e,{children:(0,a.tZ)("div",{className:"latex-block",id:i,children:(0,a.tZ)(w.tu,{className:d()(x.Z.latexWrapper,t.attrs.persistentExpression||(0,v.K1)()?x.Z.emptyStateWrapper:null),radius:"md","data-attrs":JSON.stringify({persistentExpression:l,id:t.attrs.id}),onClick:()=>{l!==t.attrs.persistentExpression&&s(t.attrs.persistentExpression),(0,m.oj)().dispatchEvent(new CustomEvent("open",{detail:{persistentExpression:t.attrs.persistentExpression,node:t}}))},children:(0,a.BX)(w.gq,{paddingY:8,paddingX:16,flex:"grow",justifyContent:"center",alignItems:"center",children:[l||t.attrs.persistentExpression?(0,a.tZ)(w.tu,{alignItems:"center",justifyContent:"center",children:(0,a.tZ)(o.Z,{typesettingOptions:{fn:"tex2chtml",options:void 0},text:"".concat(l||t.attrs.persistentExpression),renderMode:"pre",inline:!1,dynamic:!0})}):(0,a.tZ)(w.tu,{alignSelf:"center",children:(0,a.tZ)(b.xv.Meta,{fontStyle:"italic",translated:!0,color:"secondary",children:"Edit & enter LaTeX expressions here"})}),(0,a.tZ)(w.tu,{children:(0,a.tZ)("button",{className:x.Z.latexEdit,children:(0,a.tZ)(u.Z,{width:20,height:20})})})]})})})})})}},67560:function(e,t,i){i.d(t,{b:()=>f});var a=i(58865),n=i(16584),r=i(30396),o=i(33804),l=i(95441),d=i(7882),s=i(15771),c=i(19081),u=i(68709),p=i(6490),m=i(17688),h=i(51776),v=i(63651);function g(){let e=(0,a._)(["Reader Survey ",""]);return g=function(){return e},e}function w(){let e=(0,a._)(["Reader Survey"]);return w=function(){return e},e}let f=e=>{var t,i;let{isOpen:a,onInsert:f,onClose:y,pub:b}=e,{iString:Z,iTemplate:x}=(0,l.M1)(),[C,_]=(0,r.eJ)(null),[E,P]=(0,r.eJ)(Z("Start Survey")),{isLoading:U,result:N,refetch:S}=(0,d.ib)({pathname:"/api/v1/survey",auto:!1}),{isLoading:k,result:B,refetch:I}=(0,d.ib)({pathname:"/api/v1/survey",auto:!1,method:"POST",json:{title:(null==N?void 0:null===(t=N.surveys)||void 0===t?void 0:t.length)?x(g(),(null==N?void 0:null===(i=N.surveys)||void 0===i?void 0:i.length)+1):x(w())}});return(0,r.d4)(()=>{let e=e=>{"surveySavedInPopup"===e.data&&S()};return a&&!k&&B&&(window.open((0,v.bzh)(b,B.id,{popup:!0}),"_blank"),window.addEventListener("message",e)),()=>{window.removeEventListener("message",e)}},[a,k,B]),(0,r.d4)(()=>{!a||N||U||S()},[a,N,S,U]),(0,n.tZ)(p.u_,{isOpen:a,children:(0,n.BX)(o.w,{children:[(0,n.tZ)(p.xB,{title:Z("Insert a Survey"),showClose:!1,showDivider:!0}),(0,n.tZ)(p.fe,{children:(0,n.tZ)(c.tu,{gap:20,children:!U&&N&&(0,n.BX)(n.HY,{children:[(0,n.BX)(h.fv,{children:[(0,n.tZ)(u.__,{children:Z("Survey to insert")}),(0,n.BX)(m.i,{value:C||"",onChange:e=>{let t=e.currentTarget.value;if("new"===t){I();return}_(Number(t))},children:[(0,n.tZ)(m.d,{children:Z("Select a reader survey")}),N.surveys.map(e=>(0,n.tZ)("option",{value:e.id,children:e.title},e.id)),(0,n.tZ)("option",{value:"new",children:Z("Create new survey")})]})]}),(0,n.BX)(h.fv,{children:[(0,n.tZ)(u.__,{children:Z("Button text")}),(0,n.tZ)(h.oi,{value:E,onChange:e=>{P(e.currentTarget.value)}})]})]})})}),(0,n.tZ)(p.mz,{showDivider:!0,primaryButton:(0,n.tZ)(s.zx,{priority:"primary",disabled:!C,loading:k,onClick:()=>{f(null==N?void 0:N.surveys.find(e=>e.id===C),E)},children:Z("Insert")}),secondaryButton:(0,n.tZ)(s.zx,{priority:"secondary",onClick:y,children:Z("Cancel")})})]})})}},42684:function(e,t,i){i.d(t,{Z:()=>h});var a=i(27412),n=i(7409),r=i(99282),o=i(16584),l=i(16564),d=i(86657),s=i(64819),c=i(24763),u=i(21903),p=i(24791),m=i(60308);class h extends u.ZP{isPodcast(){return[l.MR.Podcast,l.MR.PodcastPreview].includes(this.props.feature)}render(e,t){var i,a;let{feature:u,pub:h,initialFile:v,postId:g,setPostId:w,onRecorderStopped:f,onError:y,onRecorderStarted:b,onUploadStarted:Z,legacyPodcastUrl:x,onUploadCanceled:C,skipToRecordStep:_,hideRecorder:E,hideReset:P,components:U}=e,{mediaUpload:N,timeLeft:S,dismissedAudioErrorModal:k}=t,B=null!==(i=null==U?void 0:U.AuditionPlayer)&&void 0!==i?i:c.Z,I=null!==(a=null==U?void 0:U.AudioUploader)&&void 0!==a?a:s.n,T=(0,p.Os)(N);return x?(0,o.tZ)(d.Z,{feature:u,pub:h,src:x,render:e=>(0,o.tZ)(B,(0,r._)((0,n._)({},e),{onRemove:this.removeAudio})),mediaUpload:null!=N?N:void 0,trackingProps:{contentType:"post",surface:"editor",entityType:"post",entityKey:null!=g?g:"unknown"}}):(0,o.BX)(o.HY,{children:[(!N||"transcoded"!==N.state||T)&&(0,o.tZ)(I,{feature:u,initialFile:v,mediaType:"audio",postId:g,onUpload:e=>this.onMediaUpload({mediaUpload:e}),setPostId:w,onRecorderStarted:b,onRecorderStopped:f,onError:y,mediaUpload:N,removeUpload:this.removeUpload,onUploadCanceled:C,onUploadStarted:Z,transcodeTimeLeft:S,skipToRecordStep:_,language:this.props.language,hideRecorder:E,hideReset:P,onResetToDefault:this.props.onResetToDefault,maxVideoDurationSeconds:null,onVideoTooLong:null}),(null==N?void 0:N.state)==="transcoded"&&(0,o.tZ)(d.Z,{feature:u,pub:h,src:N?(0,m.rhs)("/api/v1/audio/upload/".concat(N.id,"/src")):x,render:e=>(0,o.tZ)(B,(0,r._)((0,n._)({},e),{onRemove:this.removeAudio})),duration:null==N?void 0:N.duration,playbackRate:1,mediaUpload:null!=N?N:void 0,trackingProps:{surface:"editor",contentType:"post",entityKey:null!=g?g:"unknown",entityType:"post"}}),T&&(0,o.tZ)(l.YX,{isOpen:!k,onDismiss:()=>{this.setState({dismissedAudioErrorModal:!0})}})]})}constructor(e,t){super(e,t),(0,a._)(this,"removeAudio",()=>{var e,t;this.props.legacyPodcastUrl?null===(e=(t=this.props).onRemoveLegacyUrl)||void 0===e||e.call(t):this.removeUpload()}),this.state={mediaUploadId:e.mediaUploadId,mediaUpload:e.mediaUpload||null,estimatedTimeLeftAt:null,timeLeft:0,percentComplete:1,dismissedAudioErrorModal:!1}}}},78592:function(e,t,i){let a,n;i.d(t,{G:()=>h});var r=i(16584),o=i(30396),l=i(80569),d=i.n(l),s=i(80026),c=i(6490);function u(){document.getElementById("technical-analysis-chart-demo")&&"TradingView"in window&&(n=new window.TradingView.widget({container_id:"technical-analysis-chart-demo",width:"100%",height:"600",symbol:"AAPL",interval:"D",timezone:"exchange",theme:"light",style:"1",toolbar_bg:"#f1f3f6",withdateranges:!0,hide_side_toolbar:!1,allow_symbol_change:!0,save_image:!1,show_popup_button:!0,popup_width:"1000",popup_height:"650",locale:"en"}))}async function p(e){try{let t=await new Promise((t,i)=>{let a=new Image;a.onload=()=>t(a),a.onerror=e=>i(e),a.src=e});return{height:t.height,width:t.width}}catch(e){return console.error("Error loading image:",e),{height:null,width:null}}}let m=()=>{let e=(0,o.sO)(null);return(0,o.d4)(()=>(e.current=u,a||(a=new Promise(e=>{let t=document.createElement("script");t.id="tradingview-widget-loading-script",t.src="https://s3.tradingview.com/tv.js",t.type="text/javascript",t.onload=e,document.head.appendChild(t)})),a.then(()=>e.current&&e.current()),()=>e.current=null),[]),(0,r.tZ)("div",{className:"tradingview-widget-container",children:(0,r.tZ)("div",{id:"technical-analysis-chart-demo"})})},h=e=>{let{isOpen:t,onClose:i,onInsert:a}=e,[l,u]=(0,o.eJ)(!1);return(0,r.BX)(c.u_,{isOpen:t,onClose:i,width:900,children:[(0,r.tZ)(c.xB,{showClose:!1,title:"Financial Chart"}),(0,r.tZ)(c.fe,{children:(0,r.tZ)(m,{})}),(0,r.tZ)(c.mz,{primaryButton:(0,r.tZ)(s.zx,{priority:"primary",disabled:l,onClick:()=>{u(!0),n.image(async e=>{let t=v(e),n=await d().post("/api/v1/image").send({image:t}),{height:r,width:o}=await p(n.body.url);a({url:n.body.url,height:r,width:o}),u(!1),i()})},children:"Insert"}),secondaryButton:(0,r.tZ)(s.zx,{priority:"secondary",onClick:i,children:"Cancel"})})]})},v=e=>{let t=e.match(/^https:\/\/\w*\.tradingview\.com\/x\/([^\/]+)/);if(!t||!t[1])throw Error("Invalid URL format");return"https://s3.tradingview.com/snapshots/".concat(t[1].substring(0,1).toLowerCase(),"/").concat(t[1],".png")}},39769:function(e,t,i){i.d(t,{F:()=>F});var a=i(7409),n=i(99282),r=i(16584),o=i(30396),l=i(94184),d=i.n(l),s=i(39693),c=i.n(s),u=i(24350),p=i.n(u),m=i(57557),h=i.n(m),v=i(71375),g=i(80569),w=i.n(g),f=i(71171),y=i.n(f),b=i(95441),Z=i(98914),x=i(15771),C=i(55014),_=i(19081),E=i(8594),P=i(68709),U=i(6490),N=i(19425),S=i(12048),k=i(98661),B=i(88e3);let I={modalFixed:"modalFixed-vsWZGw"},T=e=>{let{isOpen:t,children:i,className:a,onClose:n=()=>void 0}=e;return(0,r.tZ)(N.u,{show:t,as:k.Fragment,children:(0,r.tZ)(S.V,{as:"div",onClose:n,open:t,className:d()(I.modalFixed,a),children:(0,r.tZ)(B.Q,{children:(0,r.tZ)(B.l,{className:d()(a,I.modalFixedPanel),width:400,children:i})})})})};var M=i(98248),R=i(58175),D=i(51776),L=i(70379),O=i(63651);let X={fileUpload:"fileUpload-MAekNl",compact:"compact-ibnlwO",images:"images-DdFDkM",image:"image-gnZKZk",remove:"remove-ZNF8bv",size1:"size1-dUX40Z",size2:"size2-sshVv9",size4:"size4-V7EJBU"},z="image/heic",A=e=>{let{image:t,onRemove:i,listeners:o}=e;return(0,r.BX)(_.hs,(0,n._)((0,a._)({position:"relative",cursor:"grab",flex:"auto",radius:"xs",overflow:"hidden",className:X.image},o),{children:[(0,r.tZ)(x.GI,{priority:"secondary",size:"sm",className:X.remove,onClick:i,children:(0,r.tZ)(v.Z,{size:16})}),(0,r.tZ)("img",{src:t.src})]}))},F=e=>{let{isOpen:t,onClose:i,onInsertGallery:l,onUpdateGallery:s,editor:u,editingCurrentSelection:m,postId:v}=e,[g,f]=(0,o.eJ)([]),[N,S]=(0,o.eJ)({}),[k,B]=(0,o.eJ)(new Set),[I,F]=(0,o.eJ)([]),[j,V]=(0,o.eJ)([]),[H,J]=(0,o.eJ)(""),[q,W]=(0,o.eJ)(""),[K,G]=(0,o.eJ)(!1),[Y,Q]=(0,o.eJ)(!1),[$,ee]=(0,o.eJ)({}),[et,ei]=(0,o.eJ)(new Set),{iString:ea}=(0,b.M1)(),en=(0,L.pm)();(0,o.d4)(()=>{if(m){let{gallery:e}=u.view.state.selection.node.attrs,t=e.images.map(e=>(0,n._)((0,a._)({},e),{id:y()()}));f(t.map(e=>e.type===z?(0,n._)((0,a._)({},e),{src:(0,O.zF4)(e.src,200)}):e)),B(new Set(t.map(e=>e.id))),S(p()(t,"id")),J(e.caption),W(e.alt)}},[m]);let er=()=>{ed(),i()},eo=async e=>{if(e.length+g.length>9){en.popToast(e=>(0,r.tZ)(L.FN,(0,n._)((0,a._)({},e),{text:ea("Image gallery is limited to 9 images")})));return}let t=[],i=[];for(let a of Array.from(e)){if(a.type===z){i.push(a);continue}let e=await (0,Z.Zk)(a);t.push({file:a,src:e,id:y()()})}if(i.length){Q(!0);let e=[];for(let t of i){let i=await (0,Z.Zk)(t);e.push(w().post("/api/v1/image").send({image:i,postId:v}))}F(e);let r=(await Promise.all(e)).map((e,t)=>({type:e.body.contentType,src:e.body.url,id:y()(),file:i[t]}));ei(new Set(r.map(e=>e.id))),ee(p()(r,"id")),t.push(...r.map(e=>(0,n._)((0,a._)({},e),{src:(0,O.zF4)(e.src,200)}))),Q(!1)}f(e=>[...e,...t])},el=e=>{if(g.length<=1)f([]);else{let t=g[e];k.has(t.id)&&S(e=>h()(e,[t.id])),f(t=>[...t.slice(0,e),...t.slice(e+1)])}},ed=()=>{V([]),f([]),B(new Set),S({}),ei(new Set),ee({}),J(""),W("")},es=(0,o.I4)(async()=>{G(!0);try{let e=[];for(let t of g)if(k.has(t.id)){let{type:i,src:a}=N[t.id];e.push(Promise.resolve({body:{contentType:i,url:a}}))}else if(et.has(t.id)){let{type:i,src:a}=$[t.id];e.push(Promise.resolve({body:{contentType:i,url:a}}))}else{let i=w().post("/api/v1/image").send({image:t.src,postId:v});V(e=>[...e,i]),e.push(i)}let t={images:(await Promise.all(e)).map(e=>({type:e.body.contentType,src:e.body.url})),caption:H,alt:q};if(1===g.length)t.staticGalleryImage=t.images[0];else{V([]);let e=w().post("/api/v1/image-gallery").send({gallery:t});V([e]);let{body:i}=await e;t.staticGalleryImage={type:i.contentType,src:i.url}}m?s(t):l(t),G(!1),er()}catch(e){"ABORTED"!==e.code&&(G(!1),en.popToast(e=>(0,r.tZ)(L.FN,(0,n._)((0,a._)({},e),{text:ea("Failed to upload gallery images")}))),console.error(e))}},[g,H,q]),ec=new Map(g.map(e=>[e.id,e]));return(0,r.BX)(T,{isOpen:t,onClose:er,children:[(0,r.tZ)(U.xB,{title:ea("Image gallery"),description:ea("Add up to 9 images"),showClose:!0,onClose:er,showDivider:!0}),(0,r.tZ)(U.fe,{children:(0,r.BX)(_.sg,{gap:20,children:[Y&&(0,r.BX)(_.sg,{minHeight:220,alignItems:"center",justifyContent:"center",children:[(0,r.tZ)(M.$j,{}),(0,r.tZ)(R.xv.B4,{color:"secondary",children:ea("Processing images...")})]}),g.length>0&&!Y&&(0,r.tZ)(E.A,{items:g.map(e=>e.id),onReorder:e=>{f(c()(e.map(e=>ec.get(e))))},children:(0,r.tZ)(_.hs,{className:d()(X.images,X["size".concat(g.length)]),wrap:"wrap",gap:4,children:g.map((e,t)=>(0,r.tZ)(E.L,{item:e.id,index:t,children:i=>{let{listeners:a}=i;return(0,r.tZ)(A,{image:e,onRemove:()=>el(t),listeners:a})}},e.id))})}),g.length<9&&!Y&&(0,r.tZ)(C.G,{multiple:!0,onFileSelected:eo,dropCTA:ea("Drop image files here"),className:d()(X.fileUpload,!!g.length&&X.compact),addMode:g.length>0}),!!g.length&&(0,r.BX)(r.HY,{children:[(0,r.BX)(D.fv,{children:[(0,r.tZ)(P.__,{children:ea("Caption")}),(0,r.tZ)(D.oi,{placeholder:ea("Add a caption"),value:H,onChange:e=>J(e.currentTarget.value)})]}),(0,r.BX)(D.fv,{children:[(0,r.tZ)(P.__,{children:ea("Alt text")}),(0,r.tZ)(D.oi,{placeholder:ea("Add a description"),value:q,onChange:e=>W(e.currentTarget.value)})]})]})]})}),(0,r.tZ)(U.mz,{showDivider:!0,primaryButton:(0,r.tZ)(x.zx,{priority:"primary",onClick:es,disabled:!g.length||g.length>9,loading:K,children:m?ea("Update gallery"):ea("Add gallery")}),secondaryButton:(0,r.tZ)(x.zx,{priority:"secondary",onClick:()=>{j.forEach(e=>e.abort()),I.forEach(e=>e.abort()),F([]),V([]),G(!1),Q(!1),er()},children:ea("Cancel")})})]})}},60310:function(e,t,i){i.d(t,{Z:()=>_});var a=i(7409),n=i(99282),r=i(58865),o=i(16584),l=i(98661),d=i(30396),s=i(23279),c=i.n(s),u=i(23493),p=i.n(u),m=i(80569),h=i.n(m),v=i(64515);let g=e=>(0,o.tZ)(v.l,(0,n._)((0,a._)({},e),{className:"filled-icon",name:"UnsplashIcon",svgParams:{height:24,width:24,fill:"#1C110B"},children:(0,o.tZ)("path",{d:"M15.3364 10.9703H21V21H3V10.9703H8.66362V15.9748H15.3158V10.9703H15.3364ZM15.3364 3H8.66362V8.02517H15.3158V3H15.3364Z",strokeWidth:0})}));var w=i(93666),f=i(95441),y=i(7882),b=i(15771);function Z(){let e=(0,r._)(["No results for ",""]);return Z=function(){return e},e}let x="random",C=e=>e&&e.toLowerCase().trim()||x,_=e=>{let{open:t,onAfterClose:r,onSelectStockImage:s}=e,[u,m]=(0,d.eJ)(""),[v,_]=(0,d.eJ)(null),[E,P]=(0,d.eJ)({}),[U,N]=(0,d.eJ)(!1),[S,k]=(0,d.eJ)(!1),[B,I]=(0,d.eJ)(null),T=(0,d.sO)(null),M=(0,d.sO)(null),R=(0,d.sO)(null),D=(0,d.sO)(null),L=(0,d.sO)(!1),O=B&&B.screen<=540?2:3,X=B?Math.floor((B.content-4*(O-1))/O):0,{result:z}=(0,y.Wf)(()=>i.e("7381").then(i.t.bind(i,58751,23)),[],{auto:!0}),A=null==z?void 0:z.default,{iString:F,iTemplate:j}=(0,f.M1)();(0,d.d4)(()=>{let e=()=>{I({content:parseInt(window.getComputedStyle(M.current).getPropertyValue("width"),10),screen:window.innerWidth})};return t&&(T.current.open(),window.addEventListener("resize",e),setTimeout(()=>{e(),M.current.focus()},50)),()=>{_(null),m(""),window.removeEventListener("resize",e)}},[t]);let V=(0,d.I4)(async()=>{if(!v||!v.hasMore||L.current)return;L.current=!0;let e=C(u),t=await h().get("/api/v1/stock-photos").query({search:e,offset:v.results.length,limit:15}),i=(0,n._)((0,a._)({},v),{results:[...v.results,...t.body.results],hasMore:t.body.hasMore});_(i),P(t=>(0,n._)((0,a._)({},t),{[e]:i})),L.current=!1},[v,u]);(0,d.d4)(()=>{let e=p()(e=>{let{scrollTop:t,clientHeight:i,scrollHeight:a}=e.target;t>a-i-380&&V()},200,{leading:!1}),i=R.current;return t&&(null==i||i.addEventListener("scroll",e)),()=>{null==i||i.removeEventListener("scroll",e)}},[t,V]),(0,d.d4)(()=>{if(A&&v&&X){if(0===v.results.length||U||!t){var e;null===(e=D.current)||void 0===e||e.destroy(),D.current=null}else D.current?(D.current.reloadItems(),D.current.layout()):setTimeout(()=>{D.current=new A(".insert-image-modal-images",{itemSelector:".insert-image-modal-item",transitionDuration:0,gutter:4})},50)}},[v,U,X,t]);let H=(0,d.I4)(async e=>{let t=C(e);if(E[t]){N(!1),_(E[t]),R.current.scrollTop=0;return}try{let i=await h().get("/api/v1/stock-photos").query({search:t,offset:0,limit:15}),r={results:i.body.results,hasMore:i.body.hasMore,term:e};N(!1),_(r),P(e=>(0,n._)((0,a._)({},e),{[t]:r})),R.current.scrollTop=0}catch(e){N(!0)}},[E]),J=(0,d.I4)(c()(H,400),[H]);(0,d.d4)(()=>{t&&!v&&H(x)},[H,t,v]);let q=async e=>{m(e),await J(e)},W=async e=>{k(!0),await h().post("/api/v1/stock-photos").send({downloadLocation:e.links.download_location}),s({url:e.urls.regular,width:e.width,height:e.height,description:e.alt_description,userName:e.user.name,userHref:!!e.user.links.html}),k(!1),T.current.close()},K=document.querySelector(".editor");return K?(0,l.createPortal)((0,o.tZ)("div",{onMouseDown:e=>{e.stopPropagation()},children:(0,o.BX)(w.p,{ref:T,closePill:!0,className:"insert-media-modal insert-image-modal force-light-theme",onClose:r,children:[(0,o.tZ)("h3",{className:"insert-media-modal-header",children:F("Search images")}),(0,o.tZ)("div",{className:"form new-form",children:(0,o.tZ)("input",{className:"insert-image-modal-search",ref:M,type:"text","aria-label":F("Search"),placeholder:F("Search..."),value:u,onChange:e=>{q(e.target.value)}})}),(0,o.BX)("div",{className:"insert-image-modal-byline",children:[(0,o.tZ)(g,{height:14})," ",F("Powered by Unsplash")]}),(0,o.tZ)("div",{className:"insert-image-modal-body",ref:R,children:U?(0,o.tZ)("div",{className:"insert-image-modal-empty",children:F("There was an error searching photos. Please try again later.")}):v&&v.results.length>0?(0,o.tZ)("div",{className:"insert-image-modal-images",children:v.results.map(e=>(0,o.BX)("div",{className:"insert-image-modal-item",children:[(0,o.tZ)("img",{src:e.urls.small,alt:e.alt_description,width:X,height:e.height/e.width*X}),(0,o.BX)("div",{className:"insert-image-modal-item-footer",children:[(0,o.BX)("div",{className:"insert-image-modal-item-text",children:[(0,o.tZ)("div",{className:"insert-image-modal-item-title",children:e.description}),(0,o.tZ)("div",{className:"insert-image-modal-item-name",children:e.user.name})]}),(0,o.tZ)(b.zx,{size:"sm",priority:"secondary",disabled:S,onClick:()=>{W(e)},children:F("Insert")})]})]},e.id))}):v&&0===v.results.length?(0,o.tZ)("div",{className:"insert-image-modal-empty",children:j(Z(),"&ldquo;".concat(v.term,"&rdquo;"))}):null})]})}),K):null}},20479:function(e,t,i){i.d(t,{x:()=>m});var a=i(16584),n=i(30396),r=i(347),o=i(95441),l=i(7882),d=i(15771),s=i(19081),c=i(6490),u=i(17688),p=i(58175);let m=e=>{let{isOpen:t,setOpen:i,onInsert:m}=e,{iString:h}=(0,o.M1)(),[v,g]=(0,n.eJ)(null),{result:w,isLoading:f,refetch:y}=(0,l.ib)({method:"GET",pathname:"/api/v1/sponsorship-campaigns"}),b=(0,n.I4)(()=>{y()},[]);return(0,n.d4)(()=>{t&&b()},[t,b]),(0,a.BX)(c.u_,{isOpen:t,onClose:()=>i(!1),children:[(0,a.tZ)(c.xB,{title:h("Insert a sponsorship campaign"),description:(0,a.tZ)(a.HY,{children:(0,a.tZ)(p.xv.B4,{translated:!0,children:"Sponsorship campaigns are blocks that display text and images provided by a sponsor. They will appear in newsletter emails and on the web. Select an existing campaign from the list below or create a new one"})}),showClose:!0,onClose:()=>i(!1)}),(0,a.tZ)(c.fe,{children:(null==w?void 0:w.length)?(0,a.BX)(s.tu,{gap:4,textAlign:"right",children:[(0,a.BX)(u.i,{value:null==v?void 0:v.id,onChange:e=>g(w.find(t=>t.id===e.currentTarget.value)||null),children:[(0,a.tZ)(u.d,{children:h("Select a campaign")}),w.map(e=>(0,a.tZ)("option",{value:e.id,children:e.title}))]}),(0,a.tZ)(p.xv.B4,{translated:!0,as:"a",href:"/publish/sponsorship-campaigns",children:"Manage Campaigns"})]}):f?(0,a.tZ)(p.xv.B4,{translated:!0,children:"Loading campaigns..."}):(0,a.BX)(p.xv.B4,{translated:!0,children:["No campaigns found. ",(0,a.tZ)("a",{href:"/publish/sponsorship-campaigns",children:"Manage Campaigns"})]})}),(0,a.tZ)(r.h,{children:(0,a.tZ)(c.mz,{primaryButton:(0,a.tZ)(d.zx,{disabled:!v,priority:"primary",onClick:()=>{v&&(m(v),i(!1))},children:h("Insert Campaign")}),secondaryButton:(0,a.tZ)(d.zx,{priority:"secondary",onClick:()=>i(!1),children:h("Cancel")})})})]})}},44369:function(e,t,i){i.d(t,{$4:()=>d,Sm:()=>h,cS:()=>g,mg:()=>m,nv:()=>p,om:()=>f,pA:()=>w,vM:()=>v});var a=i(27412),n=i(42249),r=i(68833),o=i(98914),l=i(60308);class d extends n.sN{static fromMenuItem(e,t){let{spec:i}=e;return new d(i,t)}constructor(e,t){super(e);let i=this.spec.run;this.spec.run=(e,a,n,o)=>((0,r.j)(r.FP.EDITOR_MENU_ICON_CLICKED,{button:t||this.spec.label||this.spec.title}),i.call(this,e,a,n,o))}}let s="ProseMirror-prompt",c="".concat(s,"-visible");class u{read(e){return e.value}validate(e){return(e=this.clean(e))||!this.options.required?this.options.validate&&this.options.validate(e):"Required field"}clean(e){return this.options.clean?this.options.clean(e):e}constructor(e){(0,a._)(this,"options",void 0),this.options=e}}class p extends u{render(){let e=document.createElement("input");return e.type="text",e.placeholder=this.options.label,e.value=this.options.value||"",e.className=this.options.className||"",e.autocomplete="off",e}}class m extends u{render(){let e=document.createElement("select");e.value=this.options.value||"";let t=document.createElement("option");return t.textContent=this.options.label,t.value="",e.appendChild(t),this.options.options.forEach((t,i)=>{let a=document.createElement("option");a.textContent=t.label,a.value=String(i),e.appendChild(a)}),this.options.onChange&&e.addEventListener("change",()=>{let t=this.read(e);this.options.onChange(t)},!1),e}read(e){let t=this.options.options[e.value];return t&&t.value}}class h extends p{constructor(e,t,i="en"){let{iString:a}=I18N.i(i);super({label:a("Enter URL..."),className:"url-input",value:t||e&&e.mark.attrs.href||"",required:!0,clean:e=>{let t;return e?(t=e.trim()).startsWith("http")||t.startsWith("mailto")||/^%%.*%%$/.test(t)?t:"http://".concat(t):""},validate:e=>{if(!/^%%.*%%$/.test(e)){if(e.startsWith("".concat((0,l.SVA)(),"/publish/post/"))&&alert(a("This is a link to a post draft. Readers will not be able to access this page.")),e.length>1900)return a("Link is too long");try{let t=new URL(e);if(["http:","https:","mailto:"].includes(t.protocol))return}catch(e){console.error("Failed to parse URL:",e)}return e.startsWith("http")?a("Invalid URL"):a("Invalid URL. Try using http://")}}})}}function v(e,t){let{from:i,$from:a,to:n,empty:r}=e.selection;return r?!!t.isInSet(e.storedMarks||a.marks()):e.doc.rangeHasMark(i,n,t)}function g(e){if(w(e))return;let{iString:t}=I18N.i(e.language||"en"),i="".concat(s,"-").concat(e.parentClass),a=e.root||document.body,n=e.scrollParent&&document.querySelector&&document.querySelector(e.scrollParent)||function e(t){return null==t?null:t.scrollHeight>t.clientHeight?t:e(t.parentElement)}(a)||window,r=a.appendChild(document.createElement("div"));r.classList.add(s),e.className&&r.classList.add(e.className),r.id=i,(0,o.cn)(document.body,c);let l=e=>{r.contains(e.target)||p()},d=()=>{if(e.position)e.position(r,m);else{var t,i;let a=e.parentClass&&(null===(t=(i=document).querySelector)||void 0===t?void 0:t.call(i,".".concat(e.parentClass)));if(a){let t=a.getBoundingClientRect();r.style.top="".concat(t.bottom+(e.offsetTop||0),"px"),r.style.left="".concat(t.left+(e.offsetLeft||0),"px")}else{let t=r.getBoundingClientRect();r.style.top="".concat((window.innerHeight-t.height)/2+(e.offsetTop||0),"px"),r.style.left="".concat((window.innerWidth-t.width)/2+(e.offsetLeft||0),"px")}}},u=t=>{var i;t&&t.preventDefault();let a=function(e,t){let i={},a=0;for(let n in e){let r=e[n],o=t[a++],l=r.read(o),d=r.validate(l);if(d)return function(e,t){let i=e.parentNode;if(!i)return;let a=i.appendChild(document.createElement("div"));a.style.left="".concat(e.offsetLeft+e.offsetWidth+2,"px"),a.style.top="".concat(e.offsetTop-5,"px"),a.className="ProseMirror-invalid",a.textContent=t,setTimeout(()=>i.removeChild(a),1500)}(o,d),null;i[n]=r.clean(l)}return i}(null!==(i=e.fields)&&void 0!==i?i:{},h);a&&p(a)},p=t=>{(0,o.IV)(document.body,c),window.removeEventListener("mousedown",l),window.removeEventListener("resize",d,!1),n.removeEventListener("scroll",d,!1),r.parentNode&&r.parentNode.removeChild(r),t?(e.onSubmit&&e.onSubmit(t),e.callback&&e.callback(t)):e.onCancel&&e.onCancel(),e.onClose&&e.onClose()};setTimeout(()=>window.addEventListener("mousedown",l),50),window.addEventListener("resize",d,!1),n.addEventListener("scroll",d,!1);let m=r.appendChild(document.createElement("span"));m.className="head";let h=[],v=0;for(let t in e.fields){v++;let i=e.fields[t].render();i.tabIndex=v,h.push(i)}let g=r.appendChild(document.createElement("form"));if(e.title&&(g.appendChild(document.createElement("h5")).textContent=e.title),h.forEach(e=>{g.appendChild(document.createElement("div")).appendChild(e)}),!e.no_buttons){let i=document.createElement("button");i.type="submit",i.className="".concat(s,"-submit"),i.textContent=e.submitText||"OK",i.addEventListener("click",u);let a=document.createElement("button");a.type="button",a.className="".concat(s,"-cancel"),a.textContent=t("Cancel"),a.addEventListener("click",()=>p());let n=g.appendChild(document.createElement("div"));n.className="".concat(s,"-buttons"),n.appendChild(i),n.appendChild(document.createTextNode(" ")),n.appendChild(a)}if(e.footer&&g.appendChild(e.footer),e.openseaEmbedFooter&&g.appendChild(e.openseaEmbedFooter),d(),g.addEventListener("submit",u),e.onInput&&g.addEventListener("input",t=>{var i;null===(i=e.onInput)||void 0===i||i.call(e,t,r)}),g.addEventListener("keydown",e=>{if(27==e.keyCode)e.preventDefault(),p();else if(13!=e.keyCode||e.ctrlKey||e.metaKey||e.shiftKey){if(9==e.keyCode&&(window.setTimeout(()=>{r.contains(document.activeElement)||p()},500),h.length>1)){for(let t=0;t<h.length;t++)if(document.activeElement===h[t]){0===t&&e.shiftKey?(e.preventDefault(),h[h.length-1].focus()):t!==h.length-1||e.shiftKey||(e.preventDefault(),h[0].focus());break}}}else e.preventDefault(),u()}),g.elements.length>0){let e=g.elements[0];for(let t of Array.from(g.elements))if(!t.value&&["INPUT","TEXTAREA"].includes(t.nodeName)){e=t;break}e.focus()}}function w(e){let t="".concat(s,"-").concat(e.parentClass),i=document.getElementById(t);if(i){let e;if(i.querySelector&&(e=i.querySelector(".".concat(s,"-cancel"))),e)e.click();else{var a;null===(a=i.parentNode)||void 0===a||a.removeChild(i),(0,o.IV)(document.body,c)}return!0}}function f(e,t){let i=e.selection.$from;for(let e=i.depth;e>=0;e--){let a=i.index(e);if(i.node(e).canReplaceWith(a,a,t))return!0}return!1}},66586:function(e,t,i){i.d(t,{k:()=>w});var a=i(16584),n=i(30396),r=i(23493),o=i.n(r),l=i(16564),d=i(95441),s=i(42684),c=i(47921),u=i(68833),p=i(15771),m=i(19081),h=i(58175),v=i(87077);let g=o()((e,t)=>{e({mediaUploadId:null==t?void 0:t.id,duration:null==t?void 0:t.duration,mediaUpload:t})},1e3,{trailing:!1}),w=e=>{let{id:t,droppedFile:i,open:r,pub:o,postId:w,onSave:f,onClose:y,setPostId:b}=e,[Z,x]=(0,n.eJ)(null!=i?i:null),[C,_]=(0,n.eJ)(null),[E,P]=(0,n.eJ)(!1),{iString:U,language:N}=(0,d.M1)();(0,n.d4)(()=>{x(i)},[i]);let S=()=>{(!E||confirm(U("Your audio will be discarded, are you sure?")))&&((0,u.j)(u.FP.AUDIO_MODAL_CANCEL_CLICKED,{has_media_upload:!!C}),k())},k=()=>{_(null),x(null),y()},B=(null==C?void 0:C.state)!=="transcoded";return(0,a.BX)(c.n,{wrapperId:t,title:U(l.MR.Embed),isOpen:r,onClose:S,primaryButton:(0,a.tZ)(v.u,{disabled:!B,text:U("Audio needed"),children:(0,a.tZ)(p.zx,{priority:"primary",onClick:()=>{(0,u.j)(u.FP.AUDIO_MODAL_INSERT_CLICKED),g(f,C),k()},disabled:B,children:U("Insert")})}),secondaryButton:(0,a.tZ)(p.zx,{priority:"secondary-outline",onClick:S,children:U("Cancel")}),children:[(0,a.tZ)(h.xv.B4,{paddingBottom:24,children:U(l.PN.Embed)}),(0,a.BX)(m.tu,{padding:16,radius:"md",border:"detail",children:[(0,a.tZ)(h.xv.B2,{weight:"semibold",translated:!0,paddingBottom:16,children:"Create audio"}),(0,a.tZ)(s.Z,{initialFile:Z,feature:l.MR.Embed,mediaType:"audio",pub:o,postId:w,setPostId:b,onChange:e=>{let{mediaUpload:t}=e;P(!1),_(t),x(null)},onUploadStarted:()=>{P(!0)},onUploadCanceled:()=>{P(!1)},mediaUpload:C,mediaUploadId:null==C?void 0:C.id,onRemoveLegacyUrl:null,language:N})]})]})}},89871:function(e,t,i){i.d(t,{C:()=>g,z:()=>w});var a=i(7409),n=i(99282),r=i(16584),o=i(98661),l=i(30396),d=i(89734),s=i.n(d),c=i(80569),u=i.n(c),p=i(40647),m=i(61381),h=i(63018);let v=(0,o.createContext)({existingClips:[],mediaClipsRequest:null,isTranscribing:!1,podcastUpload:null,setExistingClips:()=>void 0,setIsTranscribing:()=>void 0,setMediaClipsRequest:()=>void 0,setTranscription:()=>void 0,setUploadProgress:()=>void 0,syncClips:()=>Promise.resolve(),transcription:null,transcriptionGenerated:!1,uploadProgress:null,transcodeProgress:null,setTranscodeProgress:()=>void 0,nonStandardInputReasons:{},uploadState:"no-upload",videoUpload:null,onVideoTranscodeUpdate:()=>Promise.resolve(),postMediaComposition:null,setPostMediaComposition:()=>void 0,updatingActivePostMediaComposition:!1,setUpdatingActivePostMediaComposition:()=>void 0,fetchPostMediaComposition:()=>Promise.resolve()}),g=e=>{var t;let{children:i,isUploadingMedia:o,podcastUpload:d,postId:s,videoUpload:c,activePostMediaComposition:h}=e,{getConfigFor:g}=(0,p.xR)(),w=!!g("clip_focused_video_upload_flow")&&!!c,[Z,x]=(0,l.eJ)(null),[C,_]=(0,l.eJ)(null),[E,P]=(0,l.eJ)(null),[U,N]=(0,l.eJ)({}),S=null!==(t=null==c?void 0:c.extractedAudio)&&void 0!==t?t:d,[k,B]=(0,l.eJ)(!1),{isTranscribing:I,setIsTranscribing:T,setTranscription:M,transcription:R,transcriptionGenerated:D}=f({audioUpload:S,postId:s}),{existingClips:L,mediaClipsRequest:O,setExistingClips:X,setMediaClipsRequest:z,syncClips:A}=y({videoUpload:c,additionalVideoUpload:Z}),{setIsPodcastDrawerOpen:F,setInitialTab:j}=(0,m.y)(),{postMediaComposition:V,setPostMediaComposition:H,updatingActivePostMediaComposition:J,setUpdatingActivePostMediaComposition:q,fetchPostMediaComposition:W,postMediaCompositionWithOtherAspect:K}=b({postId:s,videoUpload:c,activePostMediaComposition:null!=h?h:null});(0,l.d4)(()=>{var e;x(null!==(e=null==K?void 0:K.videoUpload)&&void 0!==e?e:null)},[K]);let G="no-upload";(c||o)&&w?o||c&&"created"===c.state?G="uploading":(null==c?void 0:c.state)==="uploaded"?G="transcoding":(null==c?void 0:c.state)!=="transcoded"||(null==S?void 0:S.state)==="error"||R&&"in_progress"!==R.status?(null==S?void 0:S.state)==="error"||(null==R?void 0:R.status)==="failed"||(null==O?void 0:O.status)==="failed"||(null==O?void 0:O.status)==="cancelled"?G="complete-without-clips":R&&k&&!L.length?G="generating-clips":R&&(L.length||!k)&&(G="complete"):G="transcribing":G="no-upload";let Y=(0,l.Ye)(()=>["transcribing","generating-clips"].includes(G)&&c?(0,n._)((0,a._)({},c),{state:"uploaded"}):c,[G,c]),Q=(0,l.Ye)(()=>["transcoding","transcribing","generating-clips"].includes(G)&&d?(0,n._)((0,a._)({},d),{state:"uploaded"}):d,[G,d]);return(0,l.d4)(()=>{"transcoding"===G?B(!0):k&&("complete"===G||"complete-without-clips"===G)&&(B(!1),j("complete"===G?"clips":"settings"),F({isOpen:!0,clearPreventChange:!0}))},[k,j,F,G]),(0,l.d4)(()=>{let e=setInterval(async()=>{if((null==c?void 0:c.state)==="uploaded"){var e,t,i;let{mux_asset:a}=(await u().get("/api/v1/video/upload/".concat(c.id,"/assets"))).body;(null==a?void 0:a.non_standard_input_reasons)&&N(a.non_standard_input_reasons),(null==a?void 0:null===(e=a.progress)||void 0===e?void 0:e.state)==="transcoding"&&(null==a?void 0:null===(t=a.progress)||void 0===t?void 0:t.progress)?P(a.progress.progress):(null==a?void 0:null===(i=a.progress)||void 0===i?void 0:i.state)==="completed"&&P(100)}},5e3);return()=>{clearInterval(e)}},[c]),(0,r.tZ)(v.Provider,{value:{existingClips:L,isTranscribing:I,mediaClipsRequest:O,podcastUpload:Q,setExistingClips:X,setIsTranscribing:T,setMediaClipsRequest:z,setTranscription:M,setUploadProgress:_,syncClips:A,transcription:R,transcriptionGenerated:D,uploadProgress:C,transcodeProgress:E,nonStandardInputReasons:U,uploadState:w?G:"no-upload",videoUpload:Y,onVideoTranscodeUpdate:e=>{var t,i,a;(null==e?void 0:e.non_standard_input_reasons)&&N(e.non_standard_input_reasons),(null==e?void 0:null===(t=e.progress)||void 0===t?void 0:t.state)==="transcoding"&&(null==e?void 0:null===(i=e.progress)||void 0===i?void 0:i.progress)?P(e.progress.progress):(null==e?void 0:null===(a=e.progress)||void 0===a?void 0:a.state)==="completed"&&P(100)},postMediaComposition:V,postMediaCompositionWithOtherAspect:K,setPostMediaComposition:H,updatingActivePostMediaComposition:J,setUpdatingActivePostMediaComposition:q,fetchPostMediaComposition:W,setTranscodeProgress:P},children:i})},w=()=>(0,l.qp)(v),f=e=>{var t;let{audioUpload:i,postId:a}=e,[n,r]=(0,l.eJ)(null!==(t=null==i?void 0:i.transcription)&&void 0!==t?t:null),[o,d]=(0,l.eJ)((null==n?void 0:n.status)==="in_progress"),[s,c]=(0,l.eJ)(!1),p=(0,l.sO)(0);return(0,l.d4)(()=>{let e=async()=>{var e,t;let{body:i}=await u().get("/api/v1/drafts/".concat(a,"/transcription"));(null==i?void 0:null===(e=i.data)||void 0===e?void 0:e.status)==="in_progress"?d(!0):(null==i?void 0:null===(t=i.data)||void 0===t?void 0:t.status)==="transcribed"&&r(i.data)};(null==i?void 0:i.state)==="transcoded"&&e()},[null==i?void 0:i.state,a]),(0,l.d4)(()=>{if(o&&a){let e=setInterval(()=>{p.current>300||(p.current+=1,u().get("/api/v1/drafts/".concat(a,"/transcription")).then(e=>{var t;(null===(t=e.body)||void 0===t?void 0:t.data)?("transcribed"===e.body.data.status&&p.current>1&&c(!0),r(e.body.data),d("in_progress"===e.body.data.status)):d(!1)}))},3e3);return()=>{clearInterval(e)}}},[a,o,null==i?void 0:i.id]),(0,l.d4)(()=>{i||(r(null),d(!1))},[i]),{isTranscribing:o,setIsTranscribing:d,setTranscription:r,transcription:n,transcriptionGenerated:s}},y=e=>{let{videoUpload:t,additionalVideoUpload:i}=e,[a,n]=(0,l.eJ)([]),[r,o]=(0,l.eJ)(null),d=s()(a,e=>{var t,i,a,n;return null!==(n=null===(a=e.assets)||void 0===a?void 0:null===(i=a[0])||void 0===i?void 0:null===(t=i.mediaUpload)||void 0===t?void 0:t.created_at)&&void 0!==n?n:e.created_at}).reverse(),c=async()=>{(null==t?void 0:t.id)&&n(await Promise.all([(await u().get("/api/v1/video/assets/".concat(t.id,"/clips"))).body,i?(await u().get("/api/v1/video/assets/".concat(i.id,"/clips"))).body:[]]).then(e=>{let[t,i]=e;return[...t,...i]}))},p=async()=>{var e,a;if(!(null==t?void 0:t.id))return;let n=null===(e=(await u().get("/api/v1/video/assets/".concat(t.id,"/clips-requests"))).body)||void 0===e?void 0:e.request;!n&&i&&(n=null===(a=(await u().get("/api/v1/video/assets/".concat(i.id,"/clips-requests"))).body)||void 0===a?void 0:a.request),o(n)},m=async()=>{await c(),await p()};return(0,l.d4)(()=>{if(!(null==t?void 0:t.id))return;m();let e=setInterval(m,1e4);return()=>clearInterval(e)},[null==t?void 0:t.id,null==i?void 0:i.id]),{existingClips:d,mediaClipsRequest:r,setExistingClips:c,setMediaClipsRequest:o,syncClips:m}},b=e=>{let{postId:t,videoUpload:i,activePostMediaComposition:a}=e,[n,r]=(0,l.eJ)(a),[o,d]=(0,l.eJ)(!1),s=(0,l.sO)(!1),c=async()=>{if(!t){console.warn("no post id");return}try{s.current=!0;let e=(await u().get("/api/v1/video/".concat(t,"/post-media-composition"))).body;r(e)}catch(e){console.error("error fetching post media composition",{error:e})}finally{s.current=!1}};(0,l.d4)(()=>{t&&(null==i?void 0:i.id)&&c()},[t,null==i?void 0:i.id]);let{data:p}=(0,h._I)("/api/v1/video/".concat(t,"/post-media-compositions"),{auto:!0,deps:[t,null==i?void 0:i.id]}),[m,v]=(0,l.eJ)();return(0,l.d4)(()=>{p&&v(null==p?void 0:p.find(e=>e.audio_enhancement_mode===(null==n?void 0:n.audio_enhancement_mode)&&e.enable_ai_trimming===(null==n?void 0:n.enable_ai_trimming)&&e.video_enhancement_mode===(null==n?void 0:n.video_enhancement_mode)&&e.layout===(null==n?void 0:n.layout)&&e.aspect_ratio!==(null==n?void 0:n.aspect_ratio)&&e.videoUpload))},[p]),{postMediaComposition:n,setPostMediaComposition:r,updatingActivePostMediaComposition:o,setUpdatingActivePostMediaComposition:d,fetchPostMediaComposition:c,postMediaCompositionWithOtherAspect:m}}},47921:function(e,t,i){i.d(t,{n:()=>C});var a=i(16584),n=i(71375),r=i(33804),o=i(71068),l=i(15771),d=i(6400),s=i(98661),c=i(30396),u=i(19425),p=i(94184),m=i.n(p),h=i(19081);let v="animation-BHdm9o",g="offscreen-g4eykY",w="onscreen-FmAcAO";function f(e){let{children:t,wrapperId:i}=e,a=document.getElementById(i);return(null===a&&((a=document.createElement("div")).setAttribute("id",i),document.body.appendChild(a)),a)?(0,s.createPortal)(t,a):null}let y=e=>{let{isOpen:t,wrapperId:i="drawer-portal",children:n,includeTransition:r=!0,className:l,width:s=400}=e,u=(0,c.sO)(null);(0,c.d4)(()=>{t&&u.current&&u.current.focus()},[u,t]);let p=r?b:d.Fragment;return(0,a.tZ)(f,{wrapperId:i,children:(0,a.tZ)(p,{isOpen:t,children:(0,a.tZ)(o.xu,{width:s,ref:u,borderLeft:"detail",shadow:"xl",className:m()("drawer-hBg1Rc",l),children:(0,a.tZ)(h.tu,{className:m()("drawer-scroll","container-c7lblE"),bg:"primary",overflowY:"auto",shadow:"xl",children:n})})})})},b=e=>{let{children:t,isOpen:i}=e;return(0,a.tZ)(u.u.Root,{show:i,children:(0,a.tZ)(u.u.Child,{as:d.Fragment,enter:v,enterFrom:g,enterTo:w,leave:v,leaveFrom:w,leaveTo:g,children:t})})};var Z=i(58175);let x=e=>{let{title:t,onClose:i}=e;return t||i?(0,a.tZ)(o.xu,{paddingX:{mobile:16,desktop:24},paddingTop:24,children:(0,a.BX)(h.gq,{alignItems:"center",justifyContent:"space-between",children:[t&&(0,a.tZ)(Z.xv.H3,{weight:"bold",children:t}),i&&(0,a.tZ)(h.gq,{paddingLeft:12,alignItems:"center",children:(0,a.tZ)(l.hU,{size:"sm","aria-label":"Close",priority:"tertiary",onClick:i,children:(0,a.tZ)(n.Z,{"aria-hidden":"true"})})})]})}):null},C=e=>{let{width:t=400,isOpen:i,children:n,title:l,onClose:d,primaryButton:s,secondaryButton:c,wrapperId:u,variant:p="overlay",className:m,drawerClassName:v}=e;return(0,a.tZ)(y,{className:v,includeTransition:"overlay"===p,width:t,isOpen:i,wrapperId:u,children:(0,a.BX)(r.w,{children:[(0,a.BX)(h.tu,{className:m,flex:"fill",overflowY:"auto",children:[(0,a.tZ)(x,{title:l,onClose:d}),(0,a.tZ)(o.xu,{className:"container-H2Tu59",paddingX:{desktop:24,mobile:16},paddingTop:l||d?24:0,children:n})]}),s&&(0,a.BX)(h.gq,{gap:8,padding:16,justifyContent:"end",borderY:"detail",children:[s,c]})]})})}},66067:function(e,t,i){i.d(t,{B:()=>b,t:()=>Z});var a=i(7409),n=i(99282),r=i(16584),o=i(30396),l=i(23493),d=i.n(l),s=i(95441),c=i(28771),u=i(47921),p=i(82061),m=i(68833),h=i(93687),v=i(15771),g=i(19081),w=i(58175),f=i(87077);let y=d()((e,t)=>{e({mediaUploadId:null==t?void 0:t.id,duration:null==t?void 0:t.duration,mediaUpload:t})},1e3,{trailing:!1}),b=()=>{let{isDrawerOpen:e,setIsDrawerOpen:t,setPreventChange:i}=(0,c.M$)();return{isVideoEmbedDrawerOpen:e("videoEmbed"),setIsVideoEmbedDrawerOpen:e=>t((0,n._)((0,a._)({},e),{drawerId:"videoEmbed",variant:"overlay"})),setPreventChange:e=>i({preventChange:e,preventChangeMessage:"Please wait until the video is uploaded before closing the drawer."})}},Z=e=>{let{id:t,editorDroppedFile:i,mediaUploadId:a,open:n,pub:l,postId:d,onSave:c,onClose:Z,setPostId:x}=e,[C,_]=(0,o.eJ)(null!=i?i:null),[E,P]=(0,o.eJ)(null),[U,N]=(0,o.eJ)(!1),{iString:S,language:k}=(0,s.M1)(),{setPreventChange:B}=b(),{mediaUpload:I,loading:T,error:M}=(0,h.z)({mediaUploadId:a});a&&!E&&I&&P(I),(0,o.d4)(()=>{_(i)},[i]);let R=()=>{(!U&&(null==E?void 0:E.state)!=="uploaded"&&(null==E?void 0:E.state)!=="transcoded"||confirm(S("Your video will be discarded, are you sure?")))&&((0,m.j)(m.FP.VIDEO_MODAL_CANCEL_CLICKED,{has_media_upload:!!E}),D())},D=()=>{P(null),_(null),Z()},L=(null==E?void 0:E.state)!=="transcoded";return(0,r.BX)(u.n,{wrapperId:t,title:S("Embed video"),isOpen:n,onClose:R,primaryButton:(0,r.tZ)(f.u,{disabled:!L,text:S("Video needed"),children:(0,r.tZ)(v.zx,{priority:"primary",onClick:()=>{(0,m.j)(m.FP.VIDEO_MODAL_INSERT_CLICKED),y(c,E),D()},disabled:L,children:S("Insert")})}),secondaryButton:(0,r.tZ)(v.zx,{priority:"secondary-outline",onClick:R,children:S("Cancel")}),children:[M&&(0,r.tZ)(w.xv,{color:"error",children:M}),T?(0,r.tZ)("div",{children:S("Loading...")}):(0,r.BX)(r.HY,{children:[(0,r.tZ)(w.xv.B4,{paddingBottom:24,translated:!0,children:"Upload or record a video file embedded into the text."}),(0,r.BX)(g.tu,{padding:16,radius:"md",border:"detail",children:[(0,r.tZ)(w.xv.B2,{weight:"semibold",translated:!0,paddingBottom:16,children:"Create video"}),(0,r.tZ)(p.ZP,{language:k,initialFile:C,mediaType:"video",pub:l,videoFeature:"embed",postId:d,setPostId:x,onChange:e=>{let{mediaUpload:t}=e;N(!1),P(t),_(null),B(!1)},onUploadStarted:()=>{B(!0),N(!0)},onUploadCanceled:()=>{N(!1),B(!1)},mediaUpload:E,mediaUploadId:null==E?void 0:E.id})]})]})]})}},61381:function(e,t,i){i.d(t,{y:()=>l});var a=i(7409),n=i(99282),r=i(30396),o=i(28771);let l=()=>{let{initialTab:e,isDrawerOpen:t,setInitialTab:i,setIsDrawerOpen:l,setPreventChange:d}=(0,o.M$)(),s=(0,r.I4)(e=>{l((0,n._)((0,a._)({},e),{drawerId:"podcast",variant:"push"}))},[l]);return{initialTab:e,isPodcastDrawerOpen:t("podcast"),setInitialTab:i,setIsPodcastDrawerOpen:s,setPreventChange:e=>d({preventChange:e,preventChangeMessage:"Please wait until the upload is finished before closing the drawer"})}}},82061:function(e,t,i){i.d(t,{Bl:()=>J,ZP:()=>A,h_:()=>z,nP:()=>H});var a=i(27412),n=i(7409),r=i(99282),o=i(58865),l=i(16584),d=i(98661),s=i(94184),c=i.n(s),u=i(98961),p=i(2647),m=i(57560),h=i(80569),v=i.n(h),g=i(13304),w=i(93666),f=i(12281),y=i(95441),b=i(41688),Z=i(31098),x=i(71825),C=i(21903),_=i(21680),E=i(40158),P=i(29719),U=i(68833),N=i(98914),S=i(88788),k=i(69791),B=i(15771),I=i(19081),T=i(44424),M=i(58175),R=i(74134),D=i(18618),L=i(84864),O=i(96085);function X(){let e=(0,o._)([""," remaining"]);return X=function(){return e},e}function z(e){let{children:t,className:i}=e,a=(0,d.useRef)(null);if(!a.current){let e=document.getElementById("video-portal");if(e)a.current=e;else{let e=document.createElement("div");e.setAttribute("id","video-portal"),e.className=i||"",document.body.appendChild(e),a.current=e}}return(0,d.createPortal)(t,a.current)}class A extends C.ZP{componentDidUpdate(e,t){var i,a,n;(null===(i=this.state.mediaUpload)||void 0===i?void 0:i.state)==="transcoded"&&(null===(a=t.mediaUpload)||void 0===a?void 0:a.state)!==(null===(n=this.state.mediaUpload)||void 0===n?void 0:n.state)&&this.activateThumbnailSetter(),this.props.initialFile!==e.initialFile&&this.setState({file:this.props.initialFile}),super.componentDidUpdate(e,t)}render(e,t){var i,a;let{pub:n,postId:r,setPostId:o,onUploadStarted:d,onUploadCanceled:s,videoFeature:m,mediaUpload:h,onProgress:v,onOpenDrawer:w,setVideoRecorderOpen:y,language:b,audioExtractPreviewMediaUpload:E,onOpenVideoSettings:U,postMediaComposition:N}=e,{timeLeft:S,settingThumbnail:k,settingPreview:X,file:z}=t,A=(null==h?void 0:h.media_type)==="video"&&"embed"!==this.props.videoFeature,j=!A&&X,H=k||X,{iString:J}=this.i18n,q=(null==h?void 0:h.state)==="transcoded",W="podcastDrawer"===m,K=!N||"completed"===N.workflow_state;return(0,l.tZ)("div",{className:c()("video-editor",{[O.Z.videoEditorEmbed]:["embed","podcast","podcastDrawer"].includes(m)}),children:q&&K?W?(0,l.tZ)(R.i,{padding:16,border:"detail",radius:"sm",marginTop:16,children:(0,l.tZ)(R.a,{icon:(0,l.tZ)(u.Z,{}),title:J("Uploaded video"),subtitle:h.primary_file_size?(0,L.numberToHumanFileSize)(h.primary_file_size):"",action:(0,l.BX)(T.v2,{layerOptions:{placement:"bottom-end"},trigger:(0,l.tZ)(B.hU,{size:"sm",priority:"quaternary",rounded:!1,children:(0,l.tZ)(p.Z,{})}),children:[(0,l.tZ)(T.sN,{hiddenInput:(0,l.tZ)("input",{ref:this.assignInput,type:"file",accept:C.hJ,onChange:e=>{this.removeUpload({skipConfirm:!0});let t=e.target,i=t.files?t.files[0]:null;this.setState({file:i})}}),children:J("Replace")}),(0,l.tZ)(T.sN,{priority:"destructive",onClick:()=>this.removeUpload(),children:J("Delete")})]})})}):(0,l.BX)("div",{className:"video-editor-player",children:[(0,l.tZ)(f.Z,{ref:this.assignVideoPlayer,mediaUpload:h,pub:n,noPreview:H,noControls:j,noKeyboardShortcuts:j,showPreviewWhenPaused:!0,renderPlayButton:()=>(0,l.tZ)(D.f,{isPlaying:!1,size:72}),surface:"editor",contentType:"post",entityType:"post",entityKey:null!=r?r:"unknown"}),(0,l.tZ)(Z.Z,{videoPlayerRef:null===(i=this.videoPlayer)||void 0===i?void 0:i.player,videoUpload:h,active:k,onCancel:()=>this.setState({settingThumbnail:!1}),onUpdate:e=>{this.onMediaUploadUpdated(e),this.setState({settingThumbnail:!1})}}),(0,l.tZ)(x.Z,{videoPlayerRef:null===(a=this.videoPlayer)||void 0===a?void 0:a.player,videoUpload:h,active:X,onCancel:()=>this.setState({settingPreview:!1}),onUpdate:e=>{this.setState({settingPreview:!1}),this.onMediaUploadUpdated(e)},audioPreviewMediaUpload:E,onAudioExtractPreviewMediaUpload:this.onAudioExtractPreviewMediaUpload}),"embed"!==this.props.videoFeature&&(0,l.tZ)(P.Z,{videoPlayer:this.videoPlayer,pub:n,postId:null!=r?r:null,mediaUpload:h,onOpenThumbnail:()=>this.setState({settingThumbnail:!0}),onThumbnailUpdated:this.onMediaUploadUpdated,onOpenSettings:function(){let{tab:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null==w||w({mediaType:"video",initialTab:e})},onOpenFreePreview:()=>this.setState({settingPreview:!0}),onRemoveFreePreview:()=>this.removeFreePreview(),onRemoveMedia:()=>this.removeUpload(),active:!H,onOpenVideoSettings:U}),H&&A&&(0,l.tZ)("div",{className:O.Z.topLabels,children:(0,l.tZ)(M.xv.B4,{className:O.Z.topLabel,children:k?J("Edit thumbnail"):X?J("Create free preview"):""})})]}):["cancelled","error"].includes(null==h?void 0:h.state)?(0,l.tZ)("div",{className:c()("video-uploader",{[O.Z.videoUploaderEmbed]:["embed","podcast","podcastDrawer"].includes(m)}),children:(0,l.BX)("div",{className:c()("video-uploader-progress",{[O.Z.videoUploaderProgressEmbed]:["embed","podcast"].includes(m)}),children:[(0,l.tZ)("div",{className:"video-uploader-progress-label error",children:J("Video upload failed")}),(0,l.BX)("div",{className:"video-uploader-progress-status",children:[(0,l.tZ)(B.hU,{size:"sm",priority:"quaternary",onClick:()=>this.removeUpload(),children:(0,l.tZ)(g.Z,{})}),(0,l.tZ)("div",{className:"video-uploader-progress-bar",children:(0,l.tZ)("div",{className:"video-uploader-progress-bar-filled error"})})]})]})}):(null==h?void 0:h.state)==="uploaded"?"hero"===m?(0,l.tZ)(F,{msLeft:S,onCancel:()=>this.removeUpload()}):(0,l.tZ)(I.gq,{flex:"grow",border:"detail",radius:"sm",alignItems:"center",paddingY:16,paddingX:12,gap:8,children:(0,l.tZ)(_.O,{onCancel:()=>this.removeUpload()})}):(null==h?void 0:h.id)?(0,l.tZ)("div",{className:c()("video-uploader",{[O.Z.videoUploaderEmbed]:["embed","podcast","podcastDrawer"].includes(m)}),children:(0,l.tZ)("div",{className:"video-uploader-progress",children:(0,l.tZ)("div",{className:"video-uploader-progress-label",children:J("Loading...")})})}):(0,l.tZ)(V,{initialFile:z,videoFeature:m,mediaType:"video",postId:r,onUpload:e=>{this.onMediaUpload({mediaUpload:e.mediaUpload}),this.onAudioExtractMediaUpload({mediaUpload:e.audioExtractMediaUpload})},setPostId:o,onProgress:v,setVideoRecorderOpen:y,onUploadStarted:d,onUploadCanceled:s,language:b,maxVideoDurationSeconds:null,onVideoTooLong:null})})}constructor(e,t){var i,r;super(e,t),(0,a._)(this,"videoPlayer",null),(0,a._)(this,"input",null),(0,a._)(this,"assignVideoPlayer",e=>{this.videoPlayer=e}),(0,a._)(this,"assignInput",e=>{this.input=e}),(0,a._)(this,"loadVideoFrame",async e=>{var t,i;if(!(null===(t=this.videoPlayer)||void 0===t?void 0:t.player)){console.error("loadVideoFrame called, but videoPlayer not set");return}if(this.videoPlayer.player.readyState<2){let e;let t=new Promise(t=>e=t);this.videoPlayer.player.addEventListener("canplay",e),this.videoPlayer.player.load(),await Promise.race([t,new Promise(e=>setTimeout(e,1e3))]),null===(i=this.videoPlayer)||void 0===i||i.player.removeEventListener("canplay",e)}this.videoPlayer&&(this.videoPlayer.player.currentTime=e),await new Promise(e=>setTimeout(e,100))}),(0,a._)(this,"activateThumbnailSetter",async()=>{var e,t;if(null===(e=this.optionsDropdown)||void 0===e||e.close(),!this.state.settingThumbnail){if(!this.state.mediaUpload){console.error("activateThumbnailSetter, mediaUpload is not set ");return}(null===(t=this.videoPlayer)||void 0===t?void 0:t.player)&&(await this.loadVideoFrame((this.state.mediaUpload.thumbnail_id-1)*5),this.setState({settingThumbnail:!0,settingPreview:!1}))}}),(0,a._)(this,"activatePreviewSetter",async()=>{var e,t;if(null===(e=this.optionsDropdown)||void 0===e||e.close(),!this.state.settingPreview&&(null===(t=this.videoPlayer)||void 0===t?void 0:t.player)){if(!this.state.mediaUpload){console.error("activatePreviewSetter, mediaUpload is not set");return}await this.loadVideoFrame(this.state.mediaUpload.preview_start||0),this.setState({settingPreview:!0,settingThumbnail:!1})}}),(0,a._)(this,"removeFreePreview",async()=>{var e,t;let{iString:i}=this.i18n;if(!confirm(i("Remove free preview. Are you sure?")))return;if(!this.state.mediaUpload){console.error("removeFreePreview called, mediaUpload not set");return}let a=(0,n._)({},this.state.audioExtractPreviewMediaUpload),{preview_start:r,preview_duration:o}=this.state.mediaUpload;null===(e=this.optionsDropdown)||void 0===e||e.close(),this.setState({settingPreview:!1}),this.onMediaUploadUpdated({preview_start:null,preview_duration:null}),(null===(t=this.state.audioExtractPreviewMediaUpload)||void 0===t?void 0:t.src_media_upload_id)===this.state.mediaUpload.id&&this.onAudioExtractPreviewMediaUpload({mediaUpload:null});try{await v().delete("/api/v1/video/upload/".concat(this.state.mediaUpload.id,"/preview")),(0,E.y)((0,l.tZ)(l.HY,{children:i("Free preview removed")}))}catch(e){this.onMediaUploadUpdated({preview_start:r,preview_duration:o}),this.onAudioExtractMediaUpload({mediaUpload:this.state.audioExtractMediaUpload}),this.onAudioExtractPreviewMediaUpload({mediaUpload:a}),alert((0,N.zx)(e))}}),this.state={settingThumbnail:!1,settingPreview:!1,mediaUpload:null!==(i=this.props.mediaUpload)&&void 0!==i?i:null,mediaUploadId:null!==(r=this.props.mediaUploadId)&&void 0!==r?r:null,audioExtractMediaUploadId:e.audioExtractMediaUploadId,audioExtractMediaUpload:e.audioExtractMediaUpload||null,audioExtractPreviewMediaUploadId:e.audioExtractPreviewMediaUploadId,audioExtractPreviewMediaUpload:e.audioExtractPreviewMediaUpload||null,estimatedTimeLeftAt:null,timeLeft:0,percentComplete:1,file:this.props.initialFile}}}let F=e=>{let{msLeft:t,onCancel:i}=e,{iString:a}=(0,y.M1)();return(0,l.tZ)("div",{className:"video-uploader",children:(0,l.BX)("div",{className:"video-uploader-progress",children:[(0,l.BX)("div",{className:"video-uploader-progress-label",children:[a("Video uploaded. Processing...")," ",t?"".concat((0,L.secondsToLargestUnit)(Math.max(t/1e3,60),{long:!0,secondsCutoff:30})," remaining"):""]}),(0,l.BX)("div",{className:"video-uploader-progress-status",children:[(0,l.tZ)(B.hU,{size:"sm",priority:"quaternary",onClick:()=>i(),children:(0,l.tZ)(g.Z,{})}),(0,l.tZ)("div",{className:"video-uploader-progress-bar",children:(0,l.tZ)("div",{className:"video-uploader-progress-bar-filled transcoding",style:"width: 100%;"})})]})]})})},j=e=>{let{onCancel:t,percentComplete:i,msLeft:a}=e,{iString:n,iTemplate:r}=(0,y.M1)(),o=(0,L.secondsToLargestUnit)(a/1e3,{long:!0,secondsCutoff:30});return(0,l.BX)("div",{className:"video-uploader-progress",children:[(0,l.BX)("div",{className:"video-uploader-progress-label",children:[n("Uploading video..."),a?r(X(),o):""]}),(0,l.BX)("div",{className:"video-uploader-progress-status",children:[(0,l.tZ)(B.hU,{size:"sm",priority:"quaternary",onClick:()=>{t()},children:(0,l.tZ)(g.Z,{})}),(0,l.tZ)("div",{className:"video-uploader-progress-bar",children:(0,l.tZ)("div",{className:"video-uploader-progress-bar-filled",style:"width: ".concat(100*i,"%;")})})]})]})};class V extends C.QM{trackUploadClicked(){(0,U.j)(U.FP.UPLOAD_VIDEO_CLICKED)}render(e,t){let{iString:i}=this.i18n,{hideVideoInfoPanel:a}=t,n=this.getEstimatedTimeLeftMs();return(0,l.BX)("div",{className:c()("video-uploader",e.className,{"with-buttons":!t.uploading,[O.Z.videoUploaderEmbed]:["embed","podcast","podcastDrawer"].includes(e.videoFeature)}),children:[this.state.existingEtags.length>0&&!a&&t.uploading&&(0,l.tZ)("div",{className:O.Z.resumingVideoUploadAlert,children:(0,l.tZ)(k.b,{title:i("Resuming video upload"),description:i("Looks like you were uploading this video before. We saved your progress, so we'll resume where we left off."),onDismiss:()=>{this.setState({hideVideoInfoPanel:!0})}})}),t.uploading?"hero"===e.videoFeature?(0,l.tZ)(j,{msLeft:null!=n?n:0,percentComplete:t.percentComplete,onCancel:()=>{if(confirm(i("Are you sure you want to cancel the upload?"))){var e,t;this.cancelUpload(),null===(e=(t=this.props).onUploadCanceled)||void 0===e||e.call(t)}}}):(0,l.tZ)(b.F,{percentComplete:t.percentComplete,onCancel:()=>{if(confirm(i("Are you sure you want to cancel the upload?"))){var e,t;this.cancelUpload(),null===(e=(t=this.props).onUploadCanceled)||void 0===e||e.call(t)}}}):(0,l.BX)(I.X2,{flex:"grow",alignItems:"center",gap:8,children:["hero"===e.videoFeature?(0,l.BX)(B.zx,{onClick:()=>{var e;null===(e=this.input)||void 0===e||e.click(),this.onUploadClicked()},priority:"primary",leading:S.Z.isSupported()?(0,l.tZ)(m.Z,{size:20}):(0,l.tZ)(u.Z,{}),children:[(0,l.tZ)("input",{ref:this.assignInput,type:"file",accept:this.props.accepts||this.accepts,onChange:()=>this.onFileSelected(),style:{display:"none"}}),S.Z.isSupported()?i("Upload video file"):i("Upload video")]}):(0,l.BX)(B.zx,{flex:"grow",priority:"secondary",onClick:()=>{var e;null===(e=this.input)||void 0===e||e.click(),this.onUploadClicked()},leading:(0,l.tZ)(m.Z,{size:20}),children:[(0,l.tZ)("input",{ref:this.assignInput,type:"file",accept:this.props.accepts||this.accepts,onChange:()=>this.onFileSelected(),style:{display:"none"}}),i("Upload")]}),S.Z.isSupported()&&(0,l.BX)(l.HY,{children:["hero"===e.videoFeature?(0,l.tZ)(B.zx,{priority:"primary",leading:(0,l.tZ)(u.Z,{}),onClick:()=>{var e;return null===(e=this.videoRecorderModal)||void 0===e?void 0:e.open()},children:i("Record video")}):(0,l.tZ)(B.zx,{flex:"grow",priority:"secondary",onClick:()=>{var e;null===(e=this.videoRecorderModal)||void 0===e||e.open(),(0,U.j)(U.FP.RECORD_EPISODE_AUDIO_CLICKED)},leading:(0,l.tZ)(u.Z,{}),children:i("Record")}),(0,l.tZ)(z,{className:O.Z.videoPortal,children:(0,l.tZ)(J,{ref:this.assignVideoRecorderModal,onVideoRecorded:e=>{let t=new File([e],"web_recording_".concat(Date.now(),".webm"),{type:e.type});this.uploadToS3(t)},videoFeature:e.videoFeature,onOpen:()=>(null==e?void 0:e.setVideoRecorderOpen)&&e.setVideoRecorderOpen(!0),onClose:()=>(null==e?void 0:e.setVideoRecorderOpen)&&e.setVideoRecorderOpen(!1)})})]})]}),(0,l.tZ)("div",{style:{position:"absolute",top:"-6px",right:"0",width:"5px",height:"5px",color:"gray",fontSize:"12px"},children:"\xb7"})]})}constructor(e,t){super(e,t),(0,a._)(this,"videoRecorderModal",null),(0,a._)(this,"input",null),(0,a._)(this,"assignVideoRecorderModal",e=>{this.videoRecorderModal=e}),(0,a._)(this,"assignInput",e=>{this.input=e}),this.state=(0,r._)((0,n._)({},this.state),{hideVideoInfoPanel:!1})}}class H extends C.QM{trackUploadClicked(){(0,U.j)(U.FP.UPLOAD_VIDEO_CLICKED,{source:"notes"})}render(e,t){return null}constructor(e,t){super(e,t),(0,a._)(this,"videoRecorderModal",null),this.state=(0,r._)((0,n._)({},this.state),{hideVideoInfoPanel:!1})}}class J extends w.p{getClassName(){return"video-recorder-modal"}componentWillUnmount(){super.componentWillUnmount(),this.recorder.stopCapture(),this.close()}onBeforeOpen(){this.startCapturePromise||(this.startCapturePromise=this.recorder.startCapture())}async onOpen(){var e,t;(0,U.j)(U.FP.VIDEO_RECORDER_SHOWN),null===(t=this.props)||void 0===t||null===(e=t.onOpen)||void 0===e||e.call(t);let i=this.startCapturePromise;if(this.startCapturePromise=null,!await i){this.close();return}if(this.recorder.stream instanceof Promise){console.error("onOpen called before stream was ready");return}this.videoElement&&"srcObject"in this.videoElement?this.videoElement.srcObject=this.recorder.stream:this.videoElement.src=URL.createObjectURL(this.recorder.stream)}onBeforeClose(){if(this.videoElement&&(this.videoElement.pause(),this.videoElement.srcObject=null,this.videoElement.src=null),this.recorder.state===S.Z.STATE.STARTED&&["embed","podcast"].includes(this.props.videoFeature))this.onButtonClick();else if(this.recorder.state===S.Z.STATE.STARTED);else if(this.recorder.state===S.Z.STATE.STARTING){let e=this.recorder;e.onStarted=()=>e.stop({dropRecording:!0})}else this.recorder.stopCapture()}onClose(){var e,t;(0,U.j)(U.FP.VIDEO_RECORDER_HIDDEN),null===(t=this.props)||void 0===t||null===(e=t.onClose)||void 0===e||e.call(t),this.setState({videoLoading:!0})}onButtonClick(){this.recorder.state===S.Z.STATE.STOPPED?(this.setState({countDown:3}),setTimeout(()=>this.setState({countDown:2}),700),setTimeout(()=>this.setState({countDown:1}),1400),this.recorder.start({startAt:Date.now()+2100})):this.recorder.state===S.Z.STATE.STARTED&&this.recorder.stop({stopCapture:!1})}renderChildren(e,t){let{children:i}=e,{videoLoading:a,recorderState:n,recorderDuration:r,recorderVolume:o,countDown:d}=t,{iString:s}=this.context;return(0,l.BX)("div",{className:"video-recorder-modal-wrap",children:[(0,l.tZ)("video",{ref:this.assignVideoElement,className:"video-recorder-preview",onLoadedMetadata:this.onVideoElementLoadedMetadata}),(0,l.tZ)("div",{className:"video-recorder-duration ".concat(n),children:n===S.Z.STATE.STOPPED?s(a?"Loading...":"Press to record"):n===S.Z.STATE.STARTING?"".concat(d||3):(0,L.secondsToHHMMSS)(r||0)}),(0,l.BX)("div",{className:"video-recorder-button ".concat(n),onClick:()=>this.onButtonClick(),children:[(0,l.tZ)("div",{className:"video-recorder-button-volume",style:"border-width:".concat(20*o,"px")}),(0,l.tZ)("div",{className:"video-recorder-button-inner"})]})]})}constructor(e,t){super(e,t),(0,a._)(this,"recorder",void 0),(0,a._)(this,"startCapturePromise",null),(0,a._)(this,"videoElement",null),(0,a._)(this,"recorderUpdateInterval",null),(0,a._)(this,"assignVideoElement",e=>{this.videoElement=e}),(0,a._)(this,"onVideoElementLoadedMetadata",()=>{if(!this.videoElement){console.error("onVideoElementLoadedMetadata called, videoElement not set");return}this.videoElement.volume=0,this.videoElement.play(),this.setState({videoLoading:!1})}),(0,a._)(this,"onRecorderStarting",()=>{(0,U.j)(U.FP.VIDEO_RECORDER_STARTING),this.onRecorderUpdated()}),(0,a._)(this,"onRecorderStarted",()=>{(0,U.j)(U.FP.VIDEO_RECORDER_STARTED),this.onRecorderUpdated(),this.recorderUpdateInterval=window.setInterval(()=>this.onRecorderUpdated(),100)}),(0,a._)(this,"onRecorderStopping",()=>{(0,U.j)(U.FP.VIDEO_RECORDER_STOPPING),this.recorderUpdateInterval&&clearInterval(this.recorderUpdateInterval),this.onRecorderUpdated()}),(0,a._)(this,"onRecorderStopped",e=>{if((0,U.j)(U.FP.VIDEO_RECORDER_STOPPED),this.onRecorderUpdated(),e){var t,i;(0,U.j)(U.FP.VIDEO_RECORDED,{videoType:e.type,videoSize:e.size}),null===(t=(i=this.props).onVideoRecorded)||void 0===t||t.call(i,e)}}),(0,a._)(this,"onRecorderUpdated",()=>{this.setState({recorderState:this.recorder.state,recorderDuration:this.recorder.duration,recorderVolume:this.recorder.volume})}),this.state.videoLoading=!0,this.recorder=new S.Z({aspectRatio:1920/1080,onStarting:this.onRecorderStarting,onStarted:this.onRecorderStarted,onStopping:this.onRecorderStopping,onStopped:this.onRecorderStopped,language:this.props.language}),this.onRecorderUpdated()}}(0,a._)(J,"contextType",y.wj)},24421:function(e,t,i){i.d(t,{N:()=>c});var a=i(16584),n=i(94184),r=i.n(n),o=i(26224),l=i(82621),d=i(60308),s=i(98143);function c(e){let{src:t,size:i,framed:n}=e;return(0,a.tZ)(l.Z,{className:r()(o.A.avatar,s.Z.avatar,n&&s.Z.framed),src:(0,d.zF4)(t),style:{width:i,height:i,minWidth:i,minHeight:i,objectFit:"cover",margin:0,display:"inline"},width:i,height:i})}},46527:function(e,t,i){i.d(t,{Z:()=>l});var a=i(7409),n=i(99282),r=i(98914),o=i(69332);let l=function(e){let{fireAnalyticsOnUrlChange:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=i=>l=>{let d=(0,o.m)(document.location.search),s=(0,a._)((0,n._)((0,a._)({},d),{[i]:l}),!t&&{_no_an:"true"}),c=Object.keys(s).map(t=>{let a=e[t]||(e=>e),n=t===i?a(s[t]):s[t];return null==n?void 0:"".concat(t,"=").concat(encodeURI(n))}).filter(e=>e).join("&");(0,r.Bb)("".concat(document.location.pathname,"?").concat(c))};return Object.keys(e).reduce((e,t)=>(0,n._)((0,a._)({},e),{[t]:i(t)}),{})}},61254:function(e,t,i){i.d(t,{ZC:()=>v,iz:()=>m,xt:()=>h});var a=i(7409),n=i(99282),r=i(98848),o=i(16584),l=i(94184),d=i.n(l);i(98661);var s=i(95441),c=i(19081),u=i(58175),p=i(44430);let m=e=>{var{className:t}=e,i=(0,r._)(e,["className"]);return(0,o.tZ)(c.X2,(0,n._)((0,a._)({className:d()(p.Z.divider,t)},i),{children:(0,o.tZ)("hr",{})}))},h=e=>{var{className:t}=e,i=(0,r._)(e,["className"]);return(0,o.tZ)(c.sg,(0,n._)((0,a._)({className:d()(p.Z.divider,p.Z.vertical,t),flex:"grow",sizing:"border-box"},i),{children:(0,o.tZ)("hr",{})}))};function v(e){var{text:t}=e,i=(0,r._)(e,["text"]);let{iString:l}=(0,s.M1)(),d=t||l("OR");return(0,o.BX)(c.X2,(0,n._)((0,a._)({gap:12,alignItems:"center"},i),{children:[(0,o.tZ)(m,{}),(0,o.tZ)(u.xv.Meta,{children:d}),(0,o.tZ)(m,{})]}))}},55014:function(e,t,i){i.d(t,{G:()=>h});var a=i(16584),n=i(30396),r=i(94184),o=i.n(r),l=i(11043),d=i(95441),s=i(15771),c=i(19081),u=i(58175),p=i(81821),m=i(52478);let h=e=>{let{onFileSelected:t,dropCTA:i,pickCTA:r,pickCTAHandler:h,acceptableTypes:v,loading:g,className:w,multiple:f=!1,addMode:y=!1,onDrop:b,onPick:Z,info:x}=e,[C,_]=(0,n.eJ)(!1),E=(0,n.sO)(null),{iString:P}=(0,d.M1)();r||h||(r=(0,a.tZ)(s.zx,{size:"sm",priority:"secondary-outline",children:f?P("Choose files"):P("Choose file")})),i||(i=P("Drop file here"));let U=e=>{e.preventDefault(),_(!0)},N=async e=>{var i,a,n,r;let o,l;if(e.preventDefault(),_(!1),(null===(a=e.dataTransfer)||void 0===a?void 0:null===(i=a.items)||void 0===i?void 0:i.length)>0){let t=Array.from(e.dataTransfer.items);for(let e of t)if("file"!==e.kind){alert(P("Please only drag files!"));return}o=e.dataTransfer.items[0].getAsFile(),l=t.map(e=>e.getAsFile())}else if((null===(r=e.dataTransfer)||void 0===r?void 0:null===(n=r.files)||void 0===n?void 0:n.length)>0)o=e.dataTransfer.files[0],l=e.dataTransfer.files;else{alert(P("Something went wrong!"));return}f?await t(l):await t(o),null==b||b(f?l:o)};return(0,a.BX)(a.HY,{children:[(0,a.BX)(c.sg,{alignItems:"center",justifyContent:"center",gap:12,radius:"md",className:o()(m.Z.dragArea,w,{[m.Z.dragActive]:C,"test-drag-active":C}),onDragEnter:U,onDragOver:U,onDragLeave:e=>{e.preventDefault(),_(!1)},onDrop:N,"aria-label":P("File Picker"),onClick:()=>{if(!h){var e;null===(e=E.current)||void 0===e||e.click()}},children:[!y&&(0,a.tZ)(l.Z,{size:32,strokeWidth:1.5}),!p.tq&&(0,a.tZ)("p",{className:m.Z.text,children:g?P("Loading..."):C?P("Release to upload"):y?P("Add another image"):(0,a.BX)(a.HY,{children:[i," ",P("or")," "]})}),(0,a.BX)(c.sg,{gap:4,children:[(0,a.tZ)(u.xv.B3,{color:"primary",weight:"medium",children:y?P("Add another file"):P("Drag files here to upload")}),x?"string"==typeof x?(0,a.tZ)(u.xv.B4,{color:"secondary",children:x}):x:null]}),r||(h?h(()=>{var e;null===(e=E.current)||void 0===e||e.click()}):null)]}),(0,a.tZ)("input",{className:o()(m.Z.file,"file-picker-input"),ref:E,type:"file",name:"file",accept:v,multiple:f,onInput:async e=>{let i=e.target,a=i.files;a&&a[0]&&(f?await t(a):await t(a[0]),null==Z||Z(f?a:a[0])),i.value=""}})]})}},25784:function(e,t,i){i.d(t,{$W:()=>g,FS:()=>v,Gt:()=>f,bp:()=>y,kt:()=>w,tl:()=>h});var a=i(7409),n=i(98848),r=i(16584),o=i(56743),l=i(2564),d=i(32642),s=i(97535);i(98661);var c=i(95441),u=i(15771),p=i(19081),m=i(58175);let h=e=>{var{className:t}=e,i=(0,n._)(e,["className"]);return(0,r.tZ)(p.hs,(0,a._)({flex:"grow",justifyContent:"space-between",alignItems:"center","aria-label":"pagination",gap:4,className:t},i))};function v(e){let{onClick:t,disabled:i}=e;return(0,r.tZ)(u.hU,{priority:"secondary-outline",size:"sm",disabled:i,onClick:t,children:(0,r.tZ)(o.Z,{size:20})})}function g(e){let{onClick:t,disabled:i}=e;return(0,r.tZ)(u.hU,{priority:"secondary-outline",size:"sm",disabled:i,onClick:t,children:(0,r.tZ)(l.Z,{size:20})})}function w(e){let{onClick:t,disabled:i}=e;return(0,r.tZ)(u.hU,{priority:"secondary-outline",size:"sm",disabled:i,onClick:t,children:(0,r.tZ)(d.Z,{size:20})})}function f(e){let{onClick:t,disabled:i}=e;return(0,r.tZ)(u.hU,{priority:"secondary-outline",size:"sm",disabled:i,onClick:t,children:(0,r.tZ)(s.Z,{size:20})})}function y(e){let{currentPage:t,totalPages:i,noun:a}=e,{iString:n}=(0,c.M1)();return(0,r.BX)(m.xv.B3,{color:"secondary",userSelect:"none",children:[a||null," ",(0,r.tZ)(m.Zx,{color:"primary",children:t})," ",n("of")," ",(0,r.tZ)(m.Zx,{color:"primary",children:i})]})}},58175:function(e,t,i){i.d(t,{Zx:()=>v,et:()=>C,hh:()=>k,xv:()=>h});var a=i(7409),n=i(99282),r=i(98848),o=i(16584),l=i(94184),d=i.n(l),s=i(98661),c=i(95441),u=i(5435),p=i(71068),m=i(23648);let h=e=>{var{className:t,align:i,size:l,weight:s,transform:h}=e,v=(0,r._)(e,["className","align","size","weight","transform"]);v=(0,n._)((0,a._)({},v),{textAlign:null!=i?i:v.textAlign,textTransform:null!=h?h:v.textTransform,fontSize:null!=l?l:v.fontSize,fontWeight:null!=s?s:v.fontWeight});let{iString:g,language:w}=(0,c.M1)(),f=v.children;if(v.translated&&"en"!==w){let e=[],t=[],i=(0,u.Fb)(v.children,e,t),a=g(i,...t);if(a&&a!==i)try{f=(0,u.rl)(a,e)}catch(e){console.log("Could not translate ".concat(i),e)}}return(0,o.tZ)(p.xu,(0,n._)((0,a._)({className:d()(m.Z.reset,t)},v),{children:f}))},v=e=>(0,o.tZ)(h,(0,a._)({as:"span"},e));function g(e){var{className:t,displayName:i}=e,l=(0,r._)(e,["className","displayName"]);let c=(0,s.forwardRef)((e,i)=>{var{className:s}=e,c=(0,r._)(e,["className"]);return(0,o.tZ)(h,(0,n._)((0,a._)({},l,c),{ref:i,className:d()(t,s)}))});return c.displayName=i,c}let w=g({as:"h1",font:"display",size:36,weight:"bold",lineHeight:44}),f=g({as:"h2",font:"display",size:30,lineHeight:36,weight:"bold"}),y=g({as:"h3",font:"display",size:24,lineHeight:28,weight:"bold"}),b=g({as:"h4",font:"display",size:20,lineHeight:24,weight:"bold"}),Z=g({font:"text",size:19,lineHeight:26,weight:"regular"}),x=g({font:"text",fontSize:17,lineHeight:24,fontWeight:"regular"}),C={font:"text",fontSize:15,lineHeight:20,fontWeight:"regular"},_=g(C),E=g({font:"text",fontSize:13,lineHeight:20,fontWeight:"regular"}),P=g({font:"text",size:11,lineHeight:20,weight:"regular"}),U=g((0,n._)((0,a._)({},{font:"meta",fontSize:11,lineHeight:20,fontWeight:"medium",textTransform:"uppercase",color:"secondary"}),{className:m.Z.meta})),N=g({font:"digit",size:12,lineHeight:20,weight:"bold",transform:"uppercase",className:m.Z.digit}),S=g({font:"serif",size:19,lineHeight:30,weight:"regular",className:m.Z.serif}),k=g({as:"a",decoration:"hover-underline"});g({as:"span"});let B=g({font:"text",color:"primary",className:m.Z.marketingBody}),I=g({as:"h1",weight:"regular",className:m.Z.marketingHeading1}),T=g({as:"h2",weight:"medium",className:m.Z.marketingHeading2}),M=g({as:"h3",weight:"medium",className:m.Z.marketingHeading3}),R=g({as:"h4",weight:"medium",className:m.Z.marketingHeading4}),D=g({as:"h5",weight:"bold",className:m.Z.marketingHeading5}),L=g({as:"h4",weight:"regular",textAlign:"center",className:m.Z.marketingQuote}),O=g({as:"h4",size:30,weight:"regular",className:m.Z.marketingSubtitle});h.H1=w,h.H2=f,h.H3=y,h.H4=b,h.B1=Z,h.B2=x,h.B3=_,h.B4=E,h.B5=P,h.Meta=U,h.Digit=N,h.Serif=S,h.MarketingBody=B,h.MarketingHeading1=I,h.MarketingHeading2=T,h.MarketingHeading3=M,h.MarketingHeading4=R,h.MarketingHeading5=D,h.MarketingQuote=L,h.MarketingSubtitle=O},8594:function(e,t,i){i.d(t,{A:()=>m,L:()=>h});var a=i(7409),n=i(99282),r=i(98848),o=i(16584),l=i(94697),d=i(45587),s=i(24285),c=i(71068);let u={opacity:.5,zIndex:1e3},p=e=>"item-".concat(e);function m(e){let{children:t,items:i,onReorder:a}=e,n=(0,l.Dy)((0,l.VT)(l.we,{activationConstraint:{distance:2}}),(0,l.VT)(l.Lg,{coordinateGetter:d.is}));return(0,o.tZ)(l.LB,{sensors:n,collisionDetection:l.pE,onDragEnd:e=>{let{active:t,over:n}=e;if(!n||t.id===n.id)return;let r=i.findIndex(e=>p(e)===t.id),o=i.findIndex(e=>p(e)===n.id);a((0,d.Rp)(i,r,o))},autoScroll:!1,children:(0,o.tZ)(d.Fo,{items:i.map(e=>p(e)),strategy:d.U2,children:t})})}function h(e){var{item:t}=e,i=(0,r._)(e,["item"]);return(0,o.tZ)(v,(0,a._)({id:p(t)},i))}let v=e=>{let{children:t,id:i,useDragHandle:r=!1}=e,{listeners:l,setNodeRef:p,transform:m,transition:h,isDragging:v}=(0,d.nB)({id:i});return(0,o.tZ)(c.xu,(0,n._)((0,a._)({ref:e=>p(e),style:(0,a._)({transform:s.ux.Translate.toString(m),transition:h},v?u:{})},r?{}:(0,a._)({},l)),{children:"function"==typeof t?t({listeners:l}):t}))}},62092:function(e,t,i){function a(e){let{fragment:t}=e;return"content"in t?t.content:[]}function n(e){let{fragment:t,content:i}=e;t.content=i}function r(e){let{node:t,marks:i}=e;t.marks=i}function o(e){let{node:t,text:i}=e;t.text=i}function l(e){let{node:t,attrs:i}=e;for(let[e,a]of Object.entries(i))t.attrs[e]=a}function d(e){return"type"in e&&"object"==typeof e.type}function s(e){return"type"in e&&"string"==typeof e.type}i.d(t,{Iy:()=>o,PH:()=>d,SK:()=>r,f5:()=>s,mR:()=>l,uR:()=>n,yX:()=>a})}}]);