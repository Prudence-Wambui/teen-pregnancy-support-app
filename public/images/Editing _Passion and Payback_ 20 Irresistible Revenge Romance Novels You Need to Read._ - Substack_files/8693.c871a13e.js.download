/*! For license information please see 8693.c871a13e.js.LICENSE.txt */
(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["8693"],{31190:function(e,t,n){"use strict";n.d(t,{Z:()=>i});let i={closeWelcomeModal:"closeWelcomeModal-KVUfKQ",maybeLater:"maybeLater-PlK9NK",publicationCoverPhotoLeft:"publicationCoverPhotoLeft-txdH2G",publicationCoverPhotoRight:"publicationCoverPhotoRight-RHPl8T",largePublicationCoverPhotoRight:"largePublicationCoverPhotoRight-A77S35",column:"column-_rp_8U",largeColumn:"largeColumn-bqn6Me",centeredColumn:"centeredColumn-M8Fujf",largeCenteredColumn:"largeCenteredColumn-AfeswM",hideColumnSmallScreens:"hideColumnSmallScreens-rlLOgZ",hideLargeColumnSmallScreens:"hideLargeColumnSmallScreens-LQBTX8",publicationCoverPhotoCenter:"publicationCoverPhotoCenter-rMU5R1",publicationLogo:"publicationLogo-EWjoMq",coverPrimary:"coverPrimary-cGRhhL",coverSecondary:"coverSecondary-pfbfwO",blurbImage:"blurbImage-bS0Pkx",containerClassName:"containerClassName-iHFmrN",promptClassName:"promptClassName-fM9VHe",inputClassName:"inputClassName-v5NZvy",subscribeButtonClassName:"subscribeButtonClassName-wpxkEl",largeHeading:"largeHeading-ZEJJF0",largeSubHeading:"largeSubHeading-lGmUwg",largePromptClassName:"largePromptClassName-Uexj1F",largeInputWrapperClassName:"largeInputWrapperClassName-VqAUAb",largeInputClassName:"largeInputClassName-zCK22A",largeSubscribeButtonClassName:"largeSubscribeButtonClassName-gTO6Dt",postContainer:"postContainer-iqizM2",postTitle:"postTitle-uVmG1_",postSubtitle:"postSubtitle-sIac6Y",postImage:"postImage-nsvz_r",faces:"faces-igzFCe",face:"face-G_PpVO",first:"first-bCHdQ8",last:"last-GRcjMY",bigSubtitle:"bigSubtitle-o28Z4u",balancedText:"balancedText-oQ__Kv",tosLink:"tosLink-n6HoHl",blurbText:"blurbText-isJ4mY",tosText:"tosText-yAQHNw"}},52478:function(e,t,n){"use strict";n.d(t,{Z:()=>i});let i=2787!=n.j?{dragArea:"dragArea-sMT00C",dragActive:"dragActive-g1aWbC",text:"text-ehFyYa",file:"file-P3qftv"}:null},78691:function(e,t,n){"use strict";n.d(t,{Z:()=>i});let i=/^(3154|6909)$/.test(n.j)?{viewer:"viewer-ecNuD7",nav:"nav-XSY6_G",navArrows:"navArrows-yQyPsn",bottomNav:"bottomNav-cjoblk",isReading:"isReading-OrZu1k",viewerContainer:"viewerContainer-hf71i1",viewerOffset:"viewerOffset-T8duEs",actionIcon:"actionIcon-uFP5Oe",content:"content-cFaSRD",navArrow:"navArrow-xdopTu",post:"post-XKrpvd",ufi:"ufi-l5oCA2",logoContainer:"logoContainer-m31AvM",ufiButton:"ufiButton-nSWhO0",likeButton:"likeButton-cDwe1L",isLiked:"isLiked-xJDjjp",commentButton:"commentButton-sQzbUO",restackButton:"restackButton-sMOIvG",isRestacked:"isRestacked-EvdZvU",shareButton:"shareButton-oCXda_",shortcutTooltip:"shortcutTooltip-pU9wZf",close:"close-zwyGNy",referringPubContainer:"referringPubContainer-BWGotX",referringPubTextContainer:"referringPubTextContainer-tL5sbE"}:null},56029:function(e,t,n){var i=n(33448);e.exports=function(e,t,n){for(var o=-1,r=e.length;++o<r;){var a=e[o],s=t(a);if(null!=s&&(void 0===l?s==s&&!i(s):n(s,l)))var l=s,d=a}return d}},53325:function(e){e.exports=function(e,t){return e>t}},89179:function(e,t,n){var i=n(55639),o=n(40554),r=n(14841),a=n(79833),s=i.isFinite,l=Math.min;e.exports=function(e){var t=Math[e];return function(e,n){if(e=r(e),(n=null==n?0:l(o(n),292))&&s(e)){var i=(a(e)+"e").split("e");return+((i=(a(t(i[0]+"e"+(+i[1]+n)))+"e").split("e"))[0]+"e"+(+i[1]-n))}return t(e)}}},8400:function(e,t,n){var i=n(14259),o=n(16612),r=n(40554),a=Math.ceil,s=Math.max;e.exports=function(e,t,n){t=(n?o(e,t,n):void 0===t)?1:s(r(t),0);var l=null==e?0:e.length;if(!l||t<1)return[];for(var d=0,c=0,u=Array(a(l/t));d<l;)u[c++]=i(e,d,d+=t);return u}},7739:function(e,t,n){var i=n(89465),o=n(55189),r=Object.prototype.hasOwnProperty,a=o(function(e,t,n){r.call(e,n)?e[n].push(t):i(e,n,[t])});e.exports=a},84753:function(e,t,n){var i=n(56029),o=n(53325),r=n(67206);e.exports=function(e,t){return e&&e.length?i(e,r(t,2),o):void 0}},43174:function(e,t,n){var i=n(55189)(function(e,t,n){e[+!n].push(t)},function(){return[[],[]]});e.exports=i},59854:function(e,t,n){var i=n(89179)("round");e.exports=i},93220:function(e,t,n){var i=n(13866)(n(3674));e.exports=i},98643:function(e,t,n){"use strict";n.d(t,{Z:()=>i});let i=(0,n(36150).Z)("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]])},52990:function(e,t,n){"use strict";n.d(t,{Z:()=>i});let i=(0,n(36150).Z)("BadgeDollarSign",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]])},47655:function(e,t,n){"use strict";n.d(t,{Z:()=>i});let i=(0,n(36150).Z)("BookmarkCheck",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]])},84967:function(e,t,n){"use strict";n.d(t,{Z:()=>i});let i=(0,n(36150).Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},11043:function(e,t,n){"use strict";n.d(t,{Z:()=>i});let i=(0,n(36150).Z)("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]])},38464:function(e,t,n){"use strict";n.d(t,{Z:()=>i});let i=(0,n(36150).Z)("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]])},20817:function(e,t,n){"use strict";n.d(t,{Z:()=>i});let i=(0,n(36150).Z)("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]])},8131:function(e,t,n){"use strict";if(n.d(t,{Z:()=>k}),4716==n.j)var i=n(58865);var o=n(16584),r=n(98661),a=n(30396),s=n(94184),l=n.n(s),d=n(8400),c=n.n(d),u=n(23279),m=n.n(u),p=n(23493),h=n.n(p),g=n(80569),v=n.n(g),_=n(93666),f=n(95441),y=n(15771),b=n(19081),w=n(98248),Z=n(58175),C=n(60308);let x=4716==n.j?{search:"search-GFq41a",presetRow:"presetRow-qZS76T",presetRowContainer:"presetRowContainer-XmnGot",fade:"fade-Z_mZfF",preset:"preset-ikTtJa",selected:"selected-L0vQ3m",presetImage:"presetImage-fEP9jz",unselected:"unselected-TRcwOG",presetName:"presetName-apjTm3",modalBody:"modalBody-h6TeXI"}:null;function P(){let e=(0,i._)(["No results for “","”"]);return P=function(){return e},e}let S=e=>e.toLowerCase().trim()||"random",I=()=>{let{iString:e}=(0,f.M1)();return[{id:"B&W",name:e("B&W"),imageUrl:"/img/generate-presets/bw-portrait.jpg",prompt:()=>"B&W close up portrait, ambient light, Nikon 15mm f/1.8G, by Lee Jeffries, Alessio Albi, Adrian Kuipers"},{id:"Photo",name:e("Photo"),imageUrl:"/img/generate-presets/photo.jpg",prompt:()=>"Professional photography, bokeh, natural lighting, canon lens, shot on dslr 64 megapixels sharp focus"},{id:"Comic",name:e("Comic"),imageUrl:"/img/generate-presets/comic.jpg",prompt:()=>"Mark Brooks and Dan Mumford, comic book art, perfect, smooth cell shading"},{id:"Logo",name:e("Logo"),imageUrl:"/img/generate-presets/logo.jpg",prompt:()=>"2d, flat, vector illustration, football team emblem, logo, centered, sharp, clean linework, head-on"},{id:"Anime",name:e("Anime"),imageUrl:"/img/generate-presets/anime.jpg",prompt:()=>"Studio Ghibli, Anime Key Visual, by Makoto Shinkai, Deep Color, Intricate, 8k resolution concept art, Natural Lighting, Beautiful Composition"},{id:"Pixel",name:e("Pixel"),imageUrl:"/img/generate-presets/pixel.jpg",prompt:()=>"as a logo, 16-bit, Pixel, SNES Style, Susan Kare, Highly detailed, Modern, Simple Background"},{id:"Paint",name:e("Paint"),imageUrl:"/img/generate-presets/vangough.jpg",prompt:()=>{let e=["Van Gogh","John Sargent","Josephine Wall","Claude Monet","Edward Hopper","Edvard Munch","Gustav Klimt","Henry Asencio","Paul Cezanne","J M W Turner","Pablo Picasso"],t=e[Math.floor(Math.random()*e.length)];return"by ".concat(t,", oil painting, canvas, expressive, colorful")}},{id:"Blur",name:e("Blur"),imageUrl:"/img/generate-presets/richter.jpg",prompt:()=>"gerhard richter, photorealistic painting, motion blur"},{id:"Epic",name:e("Epic"),imageUrl:"/img/generate-presets/epic.jpg",prompt:()=>"Epic cinematic brilliant stunning intricate meticulously detailed dramatic atmospheric maximalist digital matte painting"},{id:"Toon",name:e("Toon"),imageUrl:"/img/generate-presets/cartoon.jpg",prompt:()=>"Pixar, Disney, concept art, 3d digital art, Maya 3D, ZBrush Central 3D shading, bright colored background, radial gradient background, cinematic, Reimagined by industrial light and magic, 4k resolution post processing"},{id:"Neon",name:e("Neon"),imageUrl:"/img/generate-presets/neon.jpg",prompt:()=>"synthwave, bladerunner, neon lights, midnight 80s vibe"},{id:"Etching",name:e("Etching"),imageUrl:"/img/generate-presets/lithograph.jpg",prompt:()=>"Lithography, letterpress intaglio mezzotint linocut"}]},k=4716==n.j?e=>{var t;let{open:n,onAfterClose:i,onImageSelected:s,onUrlSelected:d,insertionPointSelector:u,className:p=""}=e,{iString:g,iTemplate:k}=(0,f.M1)(),N=I();s&&d&&console.error("onImageSelected and onUrlSelected are mutually exclusive");let[T,E]=(0,a.eJ)(""),[R,B]=(0,a.eJ)(""),[L,M]=(0,a.eJ)(null),[D,A]=(0,a.eJ)(!1),[U,j]=(0,a.eJ)(!1),X=(0,a.sO)(null),O=(0,a.sO)(null),F=(0,a.sO)(null),[H,z]=(0,a.eJ)(!1),[q,V]=(0,a.eJ)(null);(0,a.d4)(()=>(n&&(X.current.open(),setTimeout(()=>{O.current.focus()},50)),()=>{M(null),E(""),B(""),V(null)}),[n]),(0,a.d4)(()=>{let e=h()(()=>{},200,{leading:!1}),t=F.current;return n&&(null==t||t.addEventListener("scroll",e)),()=>{null==t||t.removeEventListener("scroll",e)}},[n]);let J=(0,a.I4)(async e=>{let{prompt:t,style:n}=e,i=S(t);try{A(!1),z(!0);let e=await v().post("/api/v1/generate_image/generate_art").send({prompt:i,style:n,num_images:4});B(T),z(!1),A(!1),M(n=>e.body.map(e=>({prompt:t,uri:e})).concat(null!=n?n:[])),F.current.scrollTop=0}catch(e){console.error("error searching images:",e),(null==e?void 0:e.status)===429?(alert("Image generation is limited to 6 requests per minute. Please try again in a minute."),z(!1)):(M(null),z(!1),A(!0))}},[T]),W=(0,a.I4)(m()(J,400),[J]),Y=async e=>{var t;E(e);let n=N.find(e=>q===e.id);await W({prompt:e,style:null!==(t=null==n?void 0:n.prompt())&&void 0!==t?t:""})},K=null!==(t=document.querySelector(u))&&void 0!==t?t:document.body,G=async e=>{j(!0);try{if(d)await d({url:e.uri,prompt:e.prompt});else if(s){z(!0);let t=await v().post("/api/v1/generate_image/get_img_as_blob").send({url:e.uri}).responseType("blob");z(!1),A(!1),await s(t.body)}else console.error("no onSelected callback set")}catch(e){A(!0),z(!1)}j(!1),X.current.close()},$=!!(H&&!(null==L?void 0:L.length)),Q=!!(H&&(null==L?void 0:L.length));return(0,r.createPortal)((0,o.tZ)("div",{onMouseDown:e=>{e.stopPropagation()},children:(0,o.BX)(_.p,{ref:X,closePill:!0,className:l()("insert-media-modal","insert-image-modal","insert-generated-image-modal","force-light-theme",p),onClose:i,children:[(0,o.tZ)("h3",{className:"insert-media-modal-header",children:g("Generate image")}),(0,o.BX)(b.tu,{gap:12,flex:"grow",children:[(0,o.tZ)("div",{className:"form new-form",children:(0,o.tZ)("form",{onSubmit:e=>{e.preventDefault(),Y(T)},children:(0,o.BX)(b.tu,{gap:8,children:[(0,o.BX)(b.gq,{gap:8,children:[(0,o.tZ)("input",{className:"insert-image-modal-search",ref:O,type:"text","aria-label":g("Prompt"),placeholder:g("Describe what you want to create..."),value:T,onChange:e=>{E(e.target.value)}}),(0,o.tZ)(y.zx,{type:"submit",onClick:()=>{Y(T)},disabled:H,children:g("Generate")})]}),(0,o.BX)(b.tu,{gap:8,children:[(0,o.tZ)(Z.xv.Meta,{translated:!0,children:"Select a style (Optional)"}),(0,o.BX)(b.gq,{className:x.presetRowContainer,children:[(0,o.tZ)("div",{className:x.fade}),(0,o.tZ)(b.gq,{className:x.presetRow,gap:8,justifyContent:"start",alignItems:"start",paddingRight:32,paddingBottom:8,children:N.map(e=>(0,o.BX)(b.tu,{gap:4,justifyContent:"center",className:l()(x.preset,{[x.selected]:q===e.id,[x.unselected]:q&&q!==e.id}),onClick:()=>{q===e.id?V(null):V(e.id)},children:[(0,o.tZ)("img",{className:x.presetImage,src:(0,C.zF4)(e.imageUrl,144),alt:e.name}),(0,o.tZ)(Z.xv.Meta,{className:x.presetName,children:e.name})]}))})]})]})]})})}),(0,o.BX)("div",{className:l()("insert-image-modal-body",x.modalBody),ref:F,children:[D&&(0,o.tZ)("div",{className:"insert-image-modal-empty",children:g("Something went wrong. Please try again later.")}),$||U?L&&0===L.length?(0,o.tZ)("div",{className:"insert-image-modal-empty",children:k(P(),R)}):(0,o.tZ)("div",{className:"insert-image-modal-empty",children:$||U?(0,o.BX)(b.tu,{gap:8,alignItems:"center",justifyContent:"center",children:[(0,o.tZ)(w.$j,{}),(0,o.tZ)(Z.xv,{font:"text",translated:!0,children:"Generating images…"})]}):(0,o.tZ)(Z.xv,{font:"text",translated:!0,children:"Enter a prompt above to generate an image"})}):(0,o.BX)(b.tu,{gap:12,className:"insert-image-modal-images",children:[Q&&(0,o.BX)(b.gq,{gap:8,alignItems:"center",justifyContent:"center",children:[(0,o.tZ)(w.$j,{}),(0,o.tZ)(Z.xv,{font:"text",translated:!0,children:"Generating images…"})]}),c()(L,2).map(e=>(0,o.tZ)(b.gq,{gap:12,children:e.map((e,t)=>(0,o.BX)("div",{className:"insert-image-modal-item",onClick:()=>{G(e)},children:[(0,o.tZ)("img",{src:e.uri}),(0,o.tZ)("div",{className:"insert-image-modal-item-footer",children:(0,o.tZ)(y.zx,{priority:"secondary",disabled:U,children:g("Insert")})})]},t))}))]})]})]})]})}),K)}:null},91925:function(e,t,n){"use strict";n.d(t,{s:()=>r});var i=n(16584),o=n(4615);function r(e){let{children:t}=e;return(0,i.tZ)(o.f6,{theme:"coverTheme-PJLqY5",children:t})}},16564:function(e,t,n){"use strict";n.d(t,{KH:()=>E,MR:()=>C,PN:()=>x,YX:()=>R,_g:()=>P,cM:()=>N,ko:()=>S,nO:()=>T});var i,o,r,a=n(7409),s=n(99282),l=n(58865),d=n(16584),c=n(94184),u=n.n(c),m=n(1852),p=n(86657);n(36081),n(36813);var h=n(99987),g=n(1055),v=n(72708),_=n(95441);n(68833);var f=n(15771),y=n(6490),b=n(84864),w=n(72925);function Z(){let e=(0,l._)(["Playback rate ",""]);return Z=function(){return e},e}var C=((i={}).Embed="Embed audio",i.Voiceover="Add voiceover",i.Podcast="Audio",i.PodcastPreview="Podcast free version",i.VideoPodcast="Video",i.ShareQuote="Share quote",i),x=4716==n.j?((o={}).Embed="Upload or record an audio file embedded into the text.",o.Voiceover="Upload or record a new voiceover: an audio version of your post.",o.Podcast="Create a new audio post by uploading or recording an audio file.",o.PodcastPreview="Upload a file that will appear to free users on the website and in their feeds.",o.VideoPodcast="Create a new video post by uploading or recording a video file. The audio from your video will be delivered to podcast players if selected in the publish settings.",o.ShareQuote="Upload or record an audio file that will be used as a share quote.",o):null,P=((r={})[r.PubAccent=0]="PubAccent",r[r.PubFull=1]="PubFull",r[r.Substack=2]="Substack",r);let S=e=>{let{containerRef:t,currentTime:n,remainingTime:i,progress:o,onMouseDown:r,shouldCollapseOnMobile:a=!1,theme:s=1}=e;return(0,d.BX)("div",{className:"tw-flex tw-grow tw-items-center tw-gap-3 tw-font-meta tw-text-sm tw-text-substack-primary sm:tw-gap-3","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":100*o,children:[(0,d.tZ)("div",{className:u()("tw-min-w-[40px] tw-text-right",{"tw-hidden sm:tw-block":a}),children:n}),(0,d.BX)("div",{ref:t,className:u()("tw-relative tw-h-5 tw-grow ",{"tw-ml-2 sm:tw-ml-0":a}),onMouseDown:r,children:[(0,d.tZ)("div",{className:u()("audio-progress-bar tw-absolute tw-top-2 tw-right-0 tw-left-0 tw-h-1 tw-rounded",{"tw-bg-pub-detail":1===s,"tw-bg-substack-detail":1!==s})}),(0,d.tZ)("div",{className:u()("tw-absolute tw-top-2 tw-left-0 tw-h-1 tw-rounded-l-full",{"tw-bg-pub-accent":2!==s,"tw-bg-substack-accent":2===s}),style:{width:"".concat(100*o,"%")}}),(0,d.tZ)("div",{className:u()("audio-playhead tw-absolute tw-ml-[-10px] tw-h-4 tw-w-4 tw-rounded-full tw-border-2 tw-border-solid ",{"tw-border-pub-background":1===s,"tw-border-substack-bg":1!==s,"tw-bg-substack-accent":2===s,"tw-bg-pub-accent":2!==s}),style:{left:"".concat(100*o,"%")}})]}),(0,d.tZ)("div",{className:"tw-min-w-[40px]",children:i})]})},I=[{value:1,display:"1"},{value:1.25,display:"1.25"},{value:1.5,display:"1.5"},{value:1.75,display:"1.75"},{value:2,display:"2"}],k=e=>{var t;let{onSetPlaybackRate:n,playbackRate:i,className:o}=e,r=I.findIndex(e=>{let{value:t}=e;return t===i}),{iTemplate:a}=(0,_.M1)(),s=(null==I?void 0:null===(t=I[r])||void 0===t?void 0:t.display)?"".concat(null==I?void 0:I[r].display,"x"):"";return(0,d.BX)("div",{onClick:()=>{let e=(r+1)%I.length;n(I[e].value)},className:o,"aria-label":a(Z(),s),children:[I[r].display,"\xd7"]})},N=e=>{let{iString:t}=(0,_.M1)();return(0,d.tZ)(p.Z,(0,s._)((0,a._)({},e),{metricsPost:e.post,feature:"Embed audio",render:n=>{let{currentTime:i,isPlaying:o,progress:r,progressBarRef:a,progressBarOnMouseDown:s,remainingTime:l,playbackRate:c,setPlaybackRate:u,togglePlayback:m}=n;return(0,d.BX)("div",{"data-component-name":"AudioEmbedPlayer","data-drag-handle":"",className:"audio-embed tw-my-4 tw-box-border tw-flex tw-w-full tw-select-none tw-items-center tw-gap-4 tw-space-y-0 tw-rounded-full tw-bg-pub-wash tw-p-4 tw-font-sans sm:tw-gap-5",role:"region","aria-label":t("Audio embed player"),children:[(0,d.tZ)(k,{onSetPlaybackRate:u,playbackRate:c,className:"audio-button tw-w-12 tw-cursor-pointer tw-rounded-full tw-border tw-border-solid tw-border-pub-detail-light tw-py-1 tw-text-center tw-font-meta tw-text-sm tw-font-semibold tw-leading-none tw-text-pub-secondary-text hover:tw-border-pub-detail"}),(0,d.BX)("div",{className:"tw-flex tw-w-full tw-flex-wrap",children:[e.label&&(0,d.tZ)("div",{className:"tw-basis-full tw-pb-2 tw-text-ssm tw-font-semibold tw-text-pub-primary-text",children:e.label}),(0,d.tZ)("div",{className:"tw-flex tw-w-full tw-items-center tw-justify-between tw-gap-2 sm:tw-gap-4",children:(0,d.tZ)(S,{currentTime:i,remainingTime:l,containerRef:a,progress:r,onMouseDown:s})})]}),(0,d.tZ)("div",{className:"audio-embed-play-button tw-relative tw-flex tw-h-12 tw-w-12 tw-shrink-0 tw-cursor-pointer tw-items-center tw-justify-center tw-rounded-full tw-border-2 tw-border-solid tw-border-pub-detail tw-bg-pub-background tw-transition-transform hover:tw-scale-105",onClick:m,role:"button","aria-label":t("Play/pause"),children:o?(0,d.BX)("div",{className:"tw-flex tw-h-5 tw-w-4 tw-justify-between",children:[(0,d.tZ)("div",{className:"pause-icon tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"}),(0,d.tZ)("div",{className:"pause-icon tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"})]}):(0,d.tZ)(g.Z,{className:"tw-relative tw-left-[.1rem] tw-fill-pub-accent",stroke:"none",height:18})})]})}}))},T=e=>{var t;let{pub:n,post:i,duration:o,label:r}=e,{iString:a}=(0,_.M1)();return(0,d.tZ)("table",{"data-component-name":"AudioEmbedPlayerStatic",className:"tw-w-full tw-rounded-full tw-bg-substack-wash",children:(0,d.tZ)("tr",{children:(0,d.tZ)("td",{className:"tw-text-center tw-font-meta tw-text-ssm tw-uppercase tw-text-substack-primary",children:(0,d.BX)("a",{href:null==i?void 0:i.canonical_url,className:u()("tw-block tw-w-full tw-p-4 tw-text-substack-primary",w.Z.noUnderline),children:[(0,d.tZ)(h.Z,{className:"tw-w-max-4 tw-mr-2 tw-inline-block tw-w-4 tw-align-middle",stroke:null===(t=n.theme)||void 0===t?void 0:t.background_pop_color,isStatic:!0}),(0,d.BX)("span",{className:"tw-align-middle",children:[(0,b.truncateText)(r,10)||a("Listen now")," \xb7 ",(0,b.secondsToHHMMSS)(o||0)]})]})})})})},E=e=>{let t=(0,m.useMediaQuery)({maxWidth:631}),n="/api/v1/audio/upload/".concat(e.mediaUploadId,"/src"),{iString:i}=(0,_.M1)();return(0,d.tZ)(p.Z,(0,s._)((0,a._)({},e),{src:n,feature:"Add voiceover",metricsPost:e.post,render:e=>{let{isPaywalled:n,currentTime:o,isPlaying:r,progress:a,progressBarRef:s,progressBarOnMouseDown:l,remainingTime:c,playbackRate:u,setPlaybackRate:m,togglePlayback:p}=e;return(0,d.BX)("div",{className:"tw-mb-6 tw-flex sm:tw-gap-1",children:[(0,d.tZ)("div",{className:"tw-hidden tw-h-20 tw-shrink-0 tw-basis-20 tw-items-center tw-justify-center tw-rounded-md tw-bg-pub-wash tw-fill-pub-primary-text tw-text-pub-primary-text sm:tw-flex",children:(0,d.tZ)(v.Z,{className:"tw-stroke-pub-secondary-text"})}),(0,d.BX)("div",{className:"tw-box-border tw-flex tw-h-20 tw-w-full tw-select-none tw-items-center tw-gap-3 tw-space-y-0 tw-rounded-l-md tw-rounded-r-[64px] tw-bg-pub-wash  tw-p-4 tw-font-sans",children:[n?(0,d.tZ)("div",{className:"tw-flex tw-w-full tw-flex-wrap tw-justify-center tw-text-ssm tw-text-pub-secondary-text sm:tw-text-sm",children:i("Upgrade to paid to play voiceover")}):(0,d.BX)("div",{className:"tw-flex tw-w-full tw-flex-wrap",children:[(0,d.tZ)("div",{className:"tw-basis-full tw-pb-2 tw-text-ssm tw-font-semibold tw-uppercase tw-text-pub-secondary-text",children:i("Article voiceover")}),(0,d.BX)("div",{className:"tw-flex tw-w-full tw-items-center tw-justify-between tw-gap-2 ",children:[(0,d.tZ)(k,{onSetPlaybackRate:m,playbackRate:u,className:"tw-w-12 tw-cursor-pointer tw-rounded-full tw-border tw-border-solid tw-border-pub-detail-light tw-py-1 tw-text-center tw-font-meta tw-text-sm tw-font-semibold tw-leading-none tw-text-pub-secondary-text hover:tw-border-pub-detail"}),(0,d.tZ)(S,{currentTime:o,remainingTime:c,containerRef:s,progress:a,onMouseDown:l,shouldCollapseOnMobile:!0})]})]}),n?(0,d.tZ)("div",{className:"tw-relative tw-flex tw-h-14 tw-w-14 tw-shrink-0 tw-cursor-not-allowed tw-items-center tw-justify-center tw-rounded-full tw-border-2 tw-border-solid tw-border-pub-detail tw-bg-pub-background tw-transition-transform",children:(0,d.tZ)(g.Z,{className:"tw-relative tw-left-[.15rem] tw-fill-pub-detail",stroke:"none",height:t?20:24})}):(0,d.tZ)("div",{className:"tw-relative tw-flex tw-h-14 tw-w-14 tw-shrink-0 tw-cursor-pointer tw-items-center tw-justify-center tw-rounded-full tw-border-2 tw-border-solid  tw-border-pub-detail tw-bg-pub-background tw-transition-transform hover:tw-scale-105",onClick:p,role:"button",children:r?(0,d.BX)("div",{className:"tw-flex tw-h-5 tw-w-5 tw-justify-between",children:[(0,d.tZ)("div",{className:"tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"}),(0,d.tZ)("div",{className:"tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"})]}):(0,d.tZ)(g.Z,{className:"tw-relative tw-left-[.15rem] tw-fill-pub-accent",stroke:"none",height:20})})]})]})}}))},R=e=>{let{isOpen:t,onDismiss:n}=e,{iString:i}=(0,_.M1)();return(0,d.BX)(y.u_,{isOpen:t,onClose:n,children:[(0,d.tZ)(y.xB,{showClose:!1,title:i("Something went wrong...")}),(0,d.tZ)(y.fe,{children:i("Unfortunately, there was a problem with your audio file upload. We'll investigate, but in the meantime, please try again, and we apologize for the inconvenience.")}),(0,d.tZ)(y.mz,{showDivider:!1,direction:"row",primaryButton:(0,d.tZ)(f.zx,{onClick:n,priority:"primary",children:i("Got it")})})]})}},26582:function(e,t,n){"use strict";if(n.d(t,{Z:()=>l}),/^(3154|6909)$/.test(n.j))var i=n(7409);if(/^(3154|6909)$/.test(n.j))var o=n(99282);if(/^(3154|6909)$/.test(n.j))var r=n(98848);var a=n(16584),s=n(64515);let l=/^(3154|6909)$/.test(n.j)?e=>{var{size:t=20,fill:n="var(--color-fg-primary)"}=e,l=(0,r._)(e,["size","fill"]);return(0,a.tZ)(s.l,(0,o._)((0,i._)({},l),{name:"PlayIconLockFilled",svgParams:{viewBox:"0 0 20 20"},width:t,height:t,fill:n,children:(0,a.tZ)("path",{stroke:"none","fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.04688 18.5527C4.4375 18.5527 4.76953 18.3965 5.16016 18.1719L6.2041 17.5685V14.633V13.4815C6.2041 12.4757 6.61309 11.9682 7.46663 11.9001C7.46663 10 9.07077 8.01343 11.4472 8.01343C13.8237 8.01343 15.4278 10 15.4278 11.901C15.5875 11.9144 15.7314 11.9429 15.86 11.9869L16.5469 11.5898C17.3574 11.1113 17.6406 10.7988 17.6406 10.2812C17.6406 9.76367 17.3574 9.45117 16.5469 8.98242L5.16016 2.39062C4.76953 2.16602 4.4375 2.01953 4.04688 2.01953C3.32422 2.01953 2.875 2.56641 2.875 3.41602V17.1465C2.875 17.9961 3.32422 18.5527 4.04688 18.5527ZM10.1094 12.9648H12.7852V11.8418C12.7852 10.8262 12.2871 10.2793 11.4473 10.2793C10.6074 10.2793 10.1094 10.8262 10.1094 11.8418V12.9648ZM14.0645 12.9707V11.9492C14.0645 10.1816 13.0098 9 11.4473 9C9.8848 9 8.8301 10.1816 8.8301 11.9492V12.97C8.2689 13.0149 8 13.3485 8 14.0098V17.8086C8 18.5215 8.3125 18.8535 8.9668 18.8535H13.918C14.582 18.8535 14.8945 18.5215 14.8945 17.8086V14.0098C14.8945 13.3515 14.6281 13.0179 14.0645 12.9707Z"})}))}:null},64343:function(e,t,n){"use strict";n.d(t,{Z:()=>s});var i=n(7409),o=n(99282),r=n(16584),a=n(64515);let s=e=>(0,r.tZ)(a.l,(0,o._)((0,i._)({},e),{name:"RightArrowIcon",svgParams:{height:20,width:20},children:(0,r.tZ)("path",{d:"M7.5 15L12.5 10L7.5 5","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})}))},74679:function(e,t,n){"use strict";n.d(t,{p:()=>l});var i=n(16584),o=n(30396);if(4716==n.j)var r=n(98961);var a=n(66067),s=n(15771);let l=e=>{let{editor:t,pub:n,postId:l,setPostId:d}=e,{isVideoEmbedDrawerOpen:c,setIsVideoEmbedDrawerOpen:u}=(0,a.B)(),[m,p]=(0,o.eJ)(null),[h,g]=(0,o.eJ)(!1),v=e=>{e.preventDefault(),g(!0)};return(0,o.d4)(()=>{if(h){let{mediaUploadId:e}=t.view.state.selection.node.attrs;p(e),u({isOpen:!0})}},[h,t.view.state.selection.node]),(0,o.d4)(()=>(document.addEventListener("editSelectedVideoEmbed",v),()=>{document.removeEventListener("editSelectedVideoEmbed",v)}),[]),(0,i.BX)(i.HY,{children:[(0,i.tZ)(s.hU,{priority:"tertiary",size:"sm",onClick:()=>u({isOpen:!c}),children:(0,i.tZ)(r.Z,{size:20})}),(0,i.tZ)(a.t,{id:"videoEmbed",editorDroppedFile:null,mediaUploadId:m,open:c,pub:n,postId:l,onClose:()=>{u({isOpen:!1,clearPreventChange:!0}),g(!1),p(null)},onSave:e=>{let{mediaUploadId:n,duration:i}=e;t.chain().focus().insertVideo({mediaUploadId:n,duration:i}).run()},setPostId:d})]})}},81924:function(e,t,n){"use strict";n.d(t,{i:()=>C,w:()=>x});var i=n(16584),o=n(30396),r=n(55679),a=n(70109),s=n(94184),l=n.n(s),d=n(23279),c=n.n(d),u=n(47976),m=n(95441),p=n(22747),h=n(68833),g=n(98914),v=n(15771),_=n(19081),f=n(38023),y=n(6490),b=n(58175),w=n(81355),Z=n(60520);let C=e=>{let{isOpen:t,onClose:n,persistentExpression:r,node:s}=e,[l,d]=(0,o.eJ)(r),{iString:u}=(0,m.M1)(),[g]=(0,o.eJ)(()=>c()(d,1e3));return(0,o.d4)(()=>{d(r)},[r]),(0,i.tZ)(w.e,{children:(0,i.BX)(y.u_,{isOpen:t,onClose:n,"data-test-id":"latex-modal",children:[(0,i.tZ)(y.fe,{children:(0,i.BX)(_.tu,{paddingTop:8,gap:24,children:[(0,i.BX)(_.tu,{gap:24,children:[(0,i.tZ)(_.gq,{justifyContent:"space-between",alignItems:"center",children:(0,i.tZ)(b.xv.Meta,{translated:!0,children:"LaTeX Editor"})}),(0,i.tZ)(f.g,{"data-test-id":"latex-input",rows:4,maxLength:1e3,value:l,name:"expression",onChange:e=>{g(e.target.value)}})]}),l?(0,i.tZ)(_.tu,{height:160,children:(0,i.tZ)(a.Z,{typesettingOptions:{fn:"tex2chtml",options:void 0},text:"".concat(l),renderMode:"pre",inline:!1,dynamic:!0})}):(0,i.tZ)(_.tu,{children:(0,i.tZ)(_.tu,{radius:"md",paddingX:12,paddingY:20,alignItems:"center",children:(0,i.tZ)(b.xv.B4,{fontStyle:"italic",translated:!0,color:"secondary",align:"center",children:"Write LaTeX expressions in the above editor and they'll appear here"})})})]})}),(0,i.tZ)(y.mz,{showDivider:!1,direction:"row",primaryButton:(0,i.tZ)(v.zx,{"data-test-id":"latex-save",priority:"primary",onClick:()=>{(0,h.j)(h.FP.LATEX_BLOCK_ADDED,{expression:l}),(0,p.oj)().dispatchEvent(new CustomEvent("close",{detail:{persistentExpression:l,node:s}})),n()},children:u("Save")}),secondaryButton:(0,i.tZ)(v.zx,{"data-test-id":"latex-cancel",priority:"secondary",onClick:()=>{(0,p.oj)().dispatchEvent(new CustomEvent("close",{detail:{persistentExpression:r,node:s}})),l!==r&&d(r),n()},children:u("Cancel")})})]})})},x=e=>{let{node:t,id:n}=e,[s,d]=(0,o.eJ)(t.attrs.persistentExpression);return(0,o.d4)(()=>{d(t.attrs.persistentExpression)},[t]),(0,o.d4)(()=>{let e=e=>{let{detail:n}=e;n.node.attrs.id===t.attrs.id&&d(n.persistentExpression)};return(0,p.oj)().addEventListener("close",e),()=>{(0,p.oj)().removeEventListener("close",e)}},[]),(0,i.tZ)(r.T5,{"data-drag-handle":"",children:(0,i.tZ)(w.e,{children:(0,i.tZ)("div",{className:"latex-block",id:n,children:(0,i.tZ)(_.tu,{className:l()(Z.Z.latexWrapper,t.attrs.persistentExpression||(0,g.K1)()?Z.Z.emptyStateWrapper:null),radius:"md","data-attrs":JSON.stringify({persistentExpression:s,id:t.attrs.id}),onClick:()=>{s!==t.attrs.persistentExpression&&d(t.attrs.persistentExpression),(0,p.oj)().dispatchEvent(new CustomEvent("open",{detail:{persistentExpression:t.attrs.persistentExpression,node:t}}))},children:(0,i.BX)(_.gq,{paddingY:8,paddingX:16,flex:"grow",justifyContent:"center",alignItems:"center",children:[s||t.attrs.persistentExpression?(0,i.tZ)(_.tu,{alignItems:"center",justifyContent:"center",children:(0,i.tZ)(a.Z,{typesettingOptions:{fn:"tex2chtml",options:void 0},text:"".concat(s||t.attrs.persistentExpression),renderMode:"pre",inline:!1,dynamic:!0})}):(0,i.tZ)(_.tu,{alignSelf:"center",children:(0,i.tZ)(b.xv.Meta,{fontStyle:"italic",translated:!0,color:"secondary",children:"Edit & enter LaTeX expressions here"})}),(0,i.tZ)(_.tu,{children:(0,i.tZ)("button",{className:Z.Z.latexEdit,children:(0,i.tZ)(u.Z,{width:20,height:20})})})]})})})})})}},21312:function(e,t,n){"use strict";n.d(t,{Z:()=>r});var i=n(16584),o=n(30396);function r(e){let{text:t,maxLines:n,ellipsesText:r="..."}=e,a=(0,o.sO)(null),[s,l]=(0,o.eJ)(t);return(0,o.d4)(()=>{(()=>{if(!a.current)return;a.current.innerText="-";let e=(a.current.clientHeight+1)*n+1,i=0,o=0,s=t.length;for(;i<=s;){if(o=Math.floor((i+s)/2),a.current.innerText=t.slice(0,o),o===t.length&&a.current.clientHeight<=e){a.current.innerText="",l(t);return}a.current.clientHeight<=e?i=o+1:s=o-1}let d=t.slice(0,o-r.length-2);a.current.innerText="",l(d+r)})()},[a,t,n,r]),(0,i.BX)("div",{style:{position:"relative"},children:[(0,i.tZ)("div",{children:s}),(0,i.tZ)("div",{ref:a,style:{visibility:"hidden",position:"absolute",width:"100%"}})]})}},56219:function(e,t,n){"use strict";n.d(t,{Ao:()=>e4,Rs:()=>e2,SO:()=>eK,_q:()=>eQ,a7:()=>e6,eu:()=>eJ,lO:()=>eV,mV:()=>e0,nM:()=>e$,sY:()=>e5,xw:()=>eW});var i=n(27412),o=n(7409),r=n(99282),a=n(58865),s=n(16584),l=n(6400),d=n(30396),c=n(94184),u=n.n(c),m=n(39693),p=n.n(m),h=n(85564),g=n.n(h),v=n(7739),_=n.n(v),f=n(93220),y=n.n(f),b=n(59543),w=n(80569),Z=n.n(w),C=n(60826),x=n(7464),P=n(84844),S=n(16564),I=n(9573),k=n(89074),N=n(59708),T=n(92828),E=n(75021),R=n(18787),B=n(90311),L=n(17350),M=n(16944),D=n(94442),A=n(3862),U=n(21316),j=n(85685),X=n(11712),O=n(94594),F=n(51014),H=n(33665),z=n(90156),q=n(72392),V=n(16506),J=n(89276),W=n(25956),Y=n(79160),K=n(70522),G=n(58319),$=n(57391),Q=n(37168),ee=n(95441),et=n(30372),en=n(56629),ei=n(68833),eo=n(48980),er=n(49762),ea=n(27036),es=n(98914),el=n(29927),ed=n(15771),ec=n(61254),eu=n(19081),em=n(1844),ep=n(58175),eh=n(70379),eg=n(71460),ev=n(23776),e_=n(57641),ef=n(98012),ey=n(24791),eb=n(6070),ew=n(67914),eZ=n(60308),eC=n(26111),ex=n(63651),eP=n(81821),eS=n(84864),eI=n(47929),ek=n(59961);function eN(){let e=(0,a._)(["The full video is for subscribers in the "," plan"]);return eN=function(){return e},e}function eT(){let e=(0,a._)(["The full video is for subscribers in the Founding Member plan"]);return eT=function(){return e},e}function eE(){let e=(0,a._)(["The full video is for paid subscribers"]);return eE=function(){return e},e}function eR(){let e=(0,a._)(["This email is for subscribers in the "," plan"]);return eR=function(){return e},e}function eB(){let e=(0,a._)(["This email is for subscribers in the Founding Member plan"]);return eB=function(){return e},e}function eL(){let e=(0,a._)(["This email is for paid subscribers"]);return eL=function(){return e},e}function eM(){let e=(0,a._)(["Continue reading this post for free, courtesy of ","."]);return eM=function(){return e},e}function eD(){let e=(0,a._)(["This post is for subscribers in the "," plan"]);return eD=function(){return e},e}function eA(){let e=(0,a._)(["This post is for subscribers in the Founding Member plan"]);return eA=function(){return e},e}function eU(){let e=(0,a._)(["This post is for paid subscribers"]);return eU=function(){return e},e}function ej(){let e=(0,a._)(["Subscribe to "," to continue reading"]);return ej=function(){return e},e}function eX(){let e=(0,a._)(["Visit the author’s Substack to subscribe and read more."]);return eX=function(){return e},e}function eO(){let e=(0,a._)(["Visit ",""]);return eO=function(){return e},e}function eF(){let e=(0,a._)(["Support ",""]);return eF=function(){return e},e}function eH(){let e=(0,a._)(["Subscribe to ",""]);return eH=function(){return e},e}function ez(){let e=(0,a._)(["By ",""]);return ez=function(){return e},e}function eq(){let e=(0,a._)(["Subscribe to ",""]);return eq=function(){return e},e}let eV="focus-comment-input",eJ=(e,t)=>!!e&&!e.invite_only&&!!t&&t.has_publication&&!t.is_admin&&!t.is_contributor&&!t.is_public_admin&&(0,ea.P)(t,e),eW=(e,t,n,i)=>"enabled"===e.payments_state?!(null==t?void 0:t.is_subscribed):(null==t?void 0:t.is_free_subscribed)&&"disabled"===e.payments_state&&!e.invite_only?!i&&n&&!(null==t?void 0:t.is_pledged):!(null==t?void 0:t.is_free_subscribed);class eY extends l.Component{async loadReactors(){let e=await Z().get("/api/v1/post/".concat(this.props.post.id,"/facepile"));this.setState({reactors:e.body.reactors,restackers:e.body.restackers})}async componentDidMount(){var e;this.props.paywall&&!this.props.postPreview&&(0,ei.j)(ei.FP.POST_PAYWALL_SHOWN,{post_id:this.props.post.id,post_audience:this.props.post.audience,post_type:this.props.post.type,user:this.props.user}),this._triggerShare=()=>this.triggerShare(),null===(e=this.containerRef.current)||void 0===e||e.addEventListener("share-post",this._triggerShare),this.props.post&&this.loadReactors(),.001>Math.random()&&(0,ei.K8)({post:this.props.post});let t=(0,eC.x)("subscribe_prompt");t&&("paid"===t?this.props.popToast(e=>(0,s.tZ)(eh.FN,(0,r._)((0,o._)({},e),{text:"Subscription purchased for ".concat(this.props.pub.name)}))):this.props.popToast(e=>(0,s.tZ)(eh.FN,(0,r._)((0,o._)({},e),{text:"Subscribed to ".concat(this.props.pub.name)})))),this.setPostPromptState()}componentWillUnmount(){if(this._triggerShare){var e;null===(e=this.containerRef.current)||void 0===e||e.removeEventListener("share-post",this._triggerShare)}this.props.stopInterval&&this.props.stopInterval()}isGiftPostEligible(){var e,t;let{getSettingFor:n,post:i,pub:o,referringUser:r,user:a}=this.props;return n("paywall_unlock_tokens")&&"only_paid"===i.audience&&i.teaser_post_eligible&&(!a||!a.is_subscribed)&&(0,eP.tq)({checkFirst4:!0})&&(null==r?void 0:null===(t=r.subscriptions)||void 0===t?void 0:null===(e=t.find(e=>e.publication_id===o.id))||void 0===e?void 0:e.membership_state)==="subscribed"}async setPostPromptState(){var e;let{post:t,disableSubscribePrompt:n,readerIsSearchCrawler:i,pub:o,user:r,readerInstalledAt:a,referringUser:s,forceFollowPrompt:l}=this.props,d="newsletter"===t.type&&!0===this.props.getSettingFor("enable_post_page_conversion")&&!n&&!(0,es.AE)()&&!i,c=!1;if(null===(e=document)||void 0===e?void 0:e.referrer)try{let e=new URL(document.referrer);c=!!e.hostname.match(/(^|\.)substack\.com$/)||e.hostname===window.location.hostname}catch(e){}let u=!1,m=this.props.skipFollowPrompt;this.isGiftPostEligible()&&["treatment_more_gifty","treatment_popover_gifty"].includes(this.context.getExperimentVariant("gift_post_unlocks_recipient_2"))&&(u=!0,m=!0);let p=!1;if(l)p=!0;else if(!eS.PUB_IDS_TO_NOT_SHOW_FOLLOW_PROMPT_ON.includes(o.id)&&!m&&d&&s&&s.name&&s.id!==(null==r?void 0:r.id)&&o.author_id!==s.id&&o.contributors.every(e=>e.user_id!==s.id)){let e=[];if(r)try{e=await (0,eo.rd)("/api/v1/feed/following")}catch(e){console.warn("Failed to fetch following state",e)}p=!e.includes(s.id)}let h=d&&!u&&!p&&!this.props.paywall&&!this.props.freeSignup&&!r,g=!u&&!["video","podcast"].includes(t.type)&&!i&&(0,eP.tq)({checkFirst4:!0})&&!a&&!c,v=!1;g&&!h&&(this.context.exposeExperiment("app_install_prompts"),"drawer"===this.context.getExperimentVariant("app_install_prompts")&&(v=!0,p=!1)),this.setState({shouldShowGiftPostPrompt:u,shouldShowFollowPrompt:p,shouldShowSubscribePrompt:h,appUpsellEligible:g,mountAppUpsellFooter:v})}triggerShare(){var e,t;let{fromEmail:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n?null===(e=this.shareDialogRef.current)||void 0===e||e.fromEmail():null===(t=this.shareDialogRef.current)||void 0===t||t.open()}onBottomReached(e){this.state.bottomReached||this.props.postPreview||(this.setState({bottomReached:!0}),(0,ei.xG)({post:this.props.post,hasPaywall:e,surface:"publication",trackerUuid:this.props.getCurrentUuid()}))}shouldShowUFI(){let{fromPostPage:e,user:t,pub:n,getSettingFor:i}=this.props,{canShowSubscribeFooterAfterPost:o}=this.state;return!!e&&!!o&&eW(n,t,!!i("payment_pledges_enabled"),this.shouldShowRecommendCta)}shouldTrackPaywallPostSeen(){if("undefined"==typeof window)return!1;let e=document.createElement("div"),t=this.props.post.body_html;e.innerHTML=t;let n=this.props.pub.post_preview_limit||eS.DEFAULT_PREVIEW_LIMIT,i="",o=!1;for(let t=e.childNodes.length-1;t>=0;t--){let r=e.childNodes[t];if(r&&(i+=r.textContent).length>n){o=!0;break}}return o}render(e,t){var n,i,a,l,d,c,m;let p,{user:h,pub:g,post:v,freeSignup:_,freeSignupEmail:f,isServingFreePodcastUrl:y,isShowsPost:w,isTheFreePressTheme:Z,reaction_token:C,invisible:P,paywall:I,onChange:M,hideTitle:A,noTitleLink:U,showComments:j,fromPostPage:H,freeTrialCoupon:W,showRestackModal:K,stripe_publishable_key:$,crossPostInfo:Q,iString:ee,iTemplate:et,themeVariables:en,referringUser:eo,renderComments:ea,renderContent:es,getSettingFor:el,startInterval:ec,forceFollowPrompt:em}=e,{showTranscription:ep,truncated:eg,autoPlayVoiceOver:e_,reactors:ef,restackers:ew,shouldShowFollowPrompt:eZ,shouldShowSubscribePrompt:eC,shouldShowGiftPostPrompt:eS,appUpsellEligible:eI,mountAppUpsellFooter:ek}=t;if(v.is_geoblocked)return(0,s.tZ)(e9,{});let ej=!!this.context.getConfigFor("like_posts_enabled"),eX=(0,N.N1)(null!==(l=eg||v.body_html)&&void 0!==l?l:""),eO=!I||I&&this.shouldTrackPaywallPostSeen();ec&&eO&&ec({postId:this.props.post.id,containerElementRef:this.containerRef,elementIsStatic:!0});let eF="video"===v.type&&!I&&(null===(n=v.videoUpload)||void 0===n?void 0:n.transcription),eH=this.shouldShowUFI()&&!(0,eb.HD)({pub:g}),ez=e6(v),eq=!!ef&&ef.length>0,eV=!!(el("paywall_unlock_tokens")&&"only_paid"===v.audience&&v.teaser_post_eligible),eJ=eV&&!(null==h?void 0:h.is_subscribed)&&((null==h?void 0:h.is_free_subscribed)||_)&&!(null==h?void 0:h.has_redeemed_post_unlock_token),eW=(0,eP.tq)({checkFirst4:!0});eV&&this.isGiftPostEligible()&&(this.context.exposeExperiment("gift_post_unlocks_recipient_2"),["treatment_more_gifty","treatment_popover_gifty"].includes(this.context.getExperimentVariant("gift_post_unlocks_recipient_2"))&&(eJ=!0,p=this.context.getExperimentVariant("gift_post_unlocks_recipient_2")));let eY="";eY="video"===v.type?"founding"===v.audience&&(0,ey.H$)(g)?et(eN(),null!==(d=(0,ey.H$)(g))&&void 0!==d?d:""):et("founding"===v.audience?eT():eE()):"adhoc_email"===v.type?"founding"===v.audience&&(0,ey.H$)(g)?et(eR(),null!==(c=(0,ey.H$)(g))&&void 0!==c?c:""):et("founding"===v.audience?eB():eL()):eJ?eW?ee("Continue reading this post for free in the Substack app"):et(eM(),g.author_name||g.name):"founding"===v.audience&&(0,ey.H$)(g)?et(eD(),null!==(m=(0,ey.H$)(g))&&void 0!==m?m:""):et("founding"===v.audience?eA():eU());let eK=(0,s.BX)(J.j,{disabled:!Z,post:v,isShowsPost:w,children:[(0,s.tZ)("div",{className:"available-content",children:ep?(0,s.tZ)("div",{className:"container tw-py-12",children:(0,s.tZ)(ev.Z,{post:v,pub:g,user:h,playerRef:this.videoPlayer})}):(0,s.tZ)(X.Z,{html:eg||v.body_html||null,pub:g,trackSelection:!0,post:v,themeVariables:en,canRestackImage:this.context.getConfigFor("restack_with_image"),user:h,freeSignup:_,freeSignupEmail:f,paywall:I,showing_behind_paywall:!!v.post_paywall_content_for_google})}),v.post_paywall_content_for_google&&(0,s.tZ)("div",{className:"paywall-content",children:(0,s.tZ)(X.Z,{html:v.post_paywall_content_for_google,pub:g,trackSelection:!1,post:v,user:h,freeSignup:_,freeSignupEmail:f,paywall:I})}),!P&&eO&&(0,s.tZ)(G.Z,{onVisible:()=>this.onBottomReached(!!I)})]}),eQ=(0,eb.HD)({pub:g}),e4=(0,eb.kb)({pub:g}),e2=eQ?(0,s.tZ)(V.Z,{post:v,user:h,pub:g,freeSignupEmail:f}):(0,s.tZ)(R.f1,(0,o._)({user:h,freeSignupEmail:f,freeSignup:_,publication:g,post:v,coupon:!0===this.props.paywall&&this.props.pub.paywall_free_trial_enabled?W:null,showPostUnlockPrompt:!!eJ,magicToken:C,giftingUser:eo,treatmentVariantForGiftPostPaywall:p,onPostUnlockError:()=>this.props.popToast(e=>(0,s.tZ)(eh.FN,(0,r._)((0,o._)({},e),{text:ee("Teaser posts are not currently available for this content")})))},Object.assign({title:eY,reauthenticationTitle:ee("To read this, please re-authenticate.")},I)));return(0,s.BX)("article",{className:u()("typography ".concat(v.type,"-post post"),{"tw-p-0":"podcast"===v.type,"shows-post":w,"full-width-image-header":(null===(i=v.postTheme)||void 0===i?void 0:i.header_variant)==="full-width-image"}),ref:this.containerRef,children:[(null==h?void 0:h.is_contributor)&&(null==v?void 0:v.id)&&(null==v?void 0:v.type)==="page"&&(0,s.tZ)(ed.zx,{priority:"secondary",href:(0,ex.ANx)(g,v.id,{params:{back:document.location.href}}),localNavigation:!1,leading:(0,s.tZ)(b.Z,{size:20}),children:ee("Edit")}),(0,s.tZ)(e8,{post:v,user:h,onChange:M}),(0,s.tZ)(F.ZP,{ref:this.shareDialogRef,user:h,pub:g,post:v,reaction_token:C,source:"email-share"}),eS&&(0,s.tZ)(E.f,{user:h,post:v,pub:g,referringUser:eo,freeSignupEmail:f,variant:this.context.getExperimentVariant("gift_post_unlocks_recipient_2")}),eZ&&(0,s.tZ)(T.yi,{pub:g,post:v,referringUser:eo,freeSignupEmail:f,forceFollowPrompt:em,surface:"post-follow-referrer-prompt"}),eC&&(0,s.tZ)(z.H,{pub:g,post:v,stripe_publishable_key:$,sharer:eo,appUpsellEligible:!!eI}),ek&&(0,s.tZ)(x.m,{pub:g,slug:v.slug}),es?(0,s.BX)(s.HY,{children:[!P&&(0,s.tZ)(G.Z,{onVisible:()=>{this.onTopReached(!!I)}}),es({comments:ea?ea():null,crossPostInfo:Q,postContent:(0,s.BX)(s.HY,{children:[eK,!!(I&&!v.post_paywall_content_for_google&&!y)&&e2]})})]}):(0,s.BX)(s.HY,{children:[(0,s.tZ)(e0,{user:null!=h?h:null,pub:g,post:v,isOnPostPage:!0,reaction_token:C,allowEdit:!0,showShare:!0,showSubtitle:!0,showPhoto:!0,showCommentRestack:!g.hide_post_restacks,hideTitle:!!A,noTitleLink:!!U,onChange:M,hideDate:"page"===v.type,hideAudience:"page"===v.type,showReactions:ej,showComments:!!j,showLabel:!0,showUpdatedIcons:!0,fromPostPage:!!H,onClickCommentButton:this.onCommentButtonClicked,reactors:ef,showRestackModal:!!K,showTranscriptionButton:!!eF,onTranscriptionClick:this.onTranscriptionClick,autoPlayVoiceOver:e_}),!P&&eO&&(0,s.tZ)(G.Z,{onVisible:()=>this.onTopReached(!!I)}),(v.has_voiceover||!!v.voiceoverUpload)&&!Z&&(0,s.tZ)(S.KH,{pub:g,post:v,mediaUploadId:v.voiceover_upload_id,duration:null===(a=v.voiceoverUpload)||void 0===a?void 0:a.duration,autoPlay:e_,href:v.canonical_url,isPaywalled:!v.voiceover_upload_id}),!v.voiceoverUpload&&e_&&ez&&(0,s.tZ)(Y.r,{postId:v.id,onClose:()=>{(0,ei.j)(ei.FP.LISTEN_TO_THIS_POST_MODAL_DISMISSED,{post_id:v.id}),this.setState({autoPlayVoiceOver:!1})}}),Q?(0,s.tZ)(k.F,{postType:v.type,crossPostInfo:Q}):null,(0,s.BX)("div",{children:[eX&&(0,s.tZ)(q.o,{toc:eX,position:"fixed"}),eK,I&&!v.post_paywall_content_for_google?(0,s.BX)(s.HY,{children:[e2,(0,s.tZ)(L.i,{post:v})]}):eg?(0,s.tZ)("p",{children:(0,s.BX)(ed.zx,{className:"expander",onClick:()=>this.setState({truncated:null}),children:["+ ",ee("show full post")]})}):!["page"].includes(null==v?void 0:v.type)&&(0,s.BX)(s.HY,{children:[eH&&(0,s.tZ)(e$,{pub:g,post:v,user:h,freeSignup:!!_,freeSignupEmail:f}),!eH&&this.shouldShowRecommendCta&&(0,s.tZ)(O.o,{pub:g}),Q&&("only_paid"===v.audience||"founding"===v.audience)&&(0,s.tZ)(eG,{pub:g}),(0,er.default)("like_posts_enabled")&&g.community_enabled&&eq&&!Z&&(0,s.tZ)(eu.X2,{borderTop:"detail-themed",paddingY:16,children:(0,s.tZ)(B.fB,{post:v,pub:g,user:h,reactors:ef,secondaryFaces:ew})}),!Z&&(0,s.tZ)("div",{className:"post-footer",children:(0,s.tZ)(D.Mp,{post:v,pub:g,user:h,onChange:M,postReactionToken:C})}),(0,s.tZ)(L.i,{post:v})]}),v.show_guest_bios&&"podcast"!==v.type&&!eQ&&!e4&&(0,s.tZ)(e1,{user:h,pub:g,post:v})]})]})]})}constructor(e,t){var n,o;super(e,t),(0,i._)(this,"containerRef",void 0),(0,i._)(this,"shareDialogRef",void 0),(0,i._)(this,"podcastCommentInput",void 0),(0,i._)(this,"podcastPlayer",void 0),(0,i._)(this,"videoPlayer",void 0),(0,i._)(this,"shouldShowRecommendCta",void 0),(0,i._)(this,"_triggerShare",void 0),(0,i._)(this,"onTopReached",e=>{this.state.topReached||this.props.postPreview||(this.setState({topReached:!0}),(0,ei.jJ)({post:this.props.post,hasPaywall:e,surface:"publication",markRead:!!this.props.user&&!this.props.noPageView,user:this.props.user,trackerUuid:this.props.getCurrentUuid()}))}),(0,i._)(this,"onTranscriptionClick",()=>{this.setState(e=>({showTranscription:!e.showTranscription}))}),(0,i._)(this,"onCommentButtonClicked",e=>{this.props.showComments&&!this.props.post.comment_count&&(e.stopPropagation(),e.preventDefault(),document.dispatchEvent(new CustomEvent(eV)))});let r={showTranscription:!1,autoPlay:!1,autoPlayVoiceOver:!1,commentSort:null!==(o=e.post.default_comment_sort)&&void 0!==o?o:"best_first",loadedWithHeaderLink:"undefined"!=typeof window&&(null===(n=window.location.hash)||void 0===n?void 0:n.startsWith("#".concat(encodeURIComponent("\xa7")))),reactors:null,feedUrl:null,shouldShowSubscribePrompt:!1,shouldShowFollowPrompt:!1};e.paywall||e.post.hidden||!e.post.body_html||(r.canShowSubscribeFooterAfterPost=e2(e.post.body_html),r.truncated=e.truncateAt?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if("undefined"==typeof window)return null;let i=document.createElement("div");if(i.innerHTML=e,null===i.textContent||i.textContent.length<t||i.childNodes.length<=1)return null;do i.removeChild(i.lastChild);while(i.childNodes.length>1&&i.textContent.length>n);return i.innerHTML}(e.post.body_html,e.truncateAt,e.truncateTo):null),"undefined"!=typeof window&&window.history.replaceState&&("true"===(0,eC.x)("autoPlay")&&(window.history.replaceState({},document.title,(0,eZ.rhs)({autoPlay:null})),r.autoPlay=!0),"true"===(0,eC.x)("play_audio")&&(window.history.replaceState({},document.title,(0,eZ.rhs)({play_audio:null})),r.autoPlayVoiceOver=!0)),this.state=r,this.containerRef=(0,l.createRef)(),this.shareDialogRef=(0,l.createRef)(),this.podcastCommentInput=(0,l.createRef)(),this.podcastPlayer=(0,l.createRef)(),this.videoPlayer=(0,l.createRef)(),this.shouldShowRecommendCta=eJ(e.pub,e.user)}}(0,i._)(eY,"contextType",Q.WH),(0,i._)(eY,"displayName","Post");let eK=(0,eh.dd)((0,$.f9)((0,en.us)((0,ee.fz)((0,et.aG)(eY))))),eG=e=>{let{pub:t}=e,{iTemplate:n}=(0,ee.M1)();return(0,s.BX)(s.HY,{children:[(0,s.tZ)(ec.iz,{paddingTop:16}),(0,s.BX)(eu.sg,{gap:16,paddingY:32,alignItems:"center",children:[(0,s.BX)(eu.sg,{gap:8,paddingBottom:8,children:[(0,s.tZ)(ep.xv.H4,{flex:"grow",align:"center",children:n(ej(),t.name)}),(0,s.tZ)(ep.xv.B3,{flex:"grow",align:"center",color:"secondary",children:n(eX())})]}),(0,s.tZ)(ed.zx,{priority:"primary",onClick:()=>{(0,ei.j)(ei.FP.POST_END_CTA_CLICKED,{type:"cross-post"}),(0,es.uX)((0,ex.W1P)(t,{params:{utm_source:eI.b3.postEndCta,addBase:!0}}),{local_navigation:!1})},children:n(eO(),t.name)})]})]})},e$=e=>{let{pub:t,post:n,user:i,freeSignup:o,freeSignupEmail:r,overridePledgesEnabled:a}=e,{iString:l,iTemplate:c}=(0,ee.M1)(),{getSettingFor:u}=(0,en.So)(),[m,p]=(0,d.eJ)(null),h=(0,eC.x)("just_subscribed"),g="disabled"===t.payments_state&&!t.invite_only&&(u("payment_pledges_enabled")||a),v="enabled"===t.payments_state&&(null==i?void 0:i.is_free_subscribed)&&!(null==i?void 0:i.is_subscribed)?"paid_upsell":g&&(null==i?void 0:i.is_free_subscribed)&&!(null==i?void 0:i.is_pledged)?"pledge_upsell":"free_upsell",_=g&&(null==i?void 0:i.is_free_subscribed)&&!(null==i?void 0:i.is_pledged);(0,d.d4)(()=>{(0,ei.j)(ei.FP.POST_END_CTA_RENDERED,{pub_id:t.id,post_id:n.id,type:v})},[t.id,n.id,v,_,null==i?void 0:i.is_free_subscribed]);let f=(0,eS.getByLine)(t);return(0,s.BX)(s.HY,{children:[(0,s.tZ)(ec.iz,{paddingTop:16}),(0,s.tZ)(G.Z,{onVisible:()=>{(0,ei.j)(ei.FP.POST_END_CTA_SEEN,{pub_id:t.id,post_id:n.id,type:v})}}),(0,s.BX)(eu.sg,{gap:16,paddingY:32,children:[(0,s.BX)(eu.sg,{gap:8,paddingBottom:8,children:[(0,s.tZ)(ep.xv.H4,{flex:"grow",align:"center",children:c(g&&(null==i?void 0:i.is_free_subscribed)?eF():eH(),t.name)}),(0,s.BX)(ep.xv.B3,{flex:"grow",align:"center",color:"secondary",children:[f?c(ez(),f):null,f&&t.rankingDetail?" \xb7 ":null,t.rankingDetail]}),t.hero_text&&(0,s.tZ)(ep.xv.B3,{color:"primary",flex:"grow",align:"center",children:t.hero_text})]}),(0,s.tZ)(eu.sg,{alignItems:"center",gap:16,children:_?(0,s.tZ)(ed.zx,{priority:"primary",onClick:()=>{(0,ei.j)(ei.FP.POST_END_CTA_CLICKED,{type:"pledge"}),(0,es.uX)((0,ex.W1P)(t,{params:{utm_source:eI.b3.postEndCta}}),{local_navigation:!1})},children:l("Pledge your support")}):(0,s.BX)(s.HY,{children:[(0,s.tZ)(H.Z,{pub:t,post:n,user:i,freeSignup:o,freeSignupEmail:r,isStatic:!1,onPrepareData:()=>{p(null)},source:"post-end-cta",className:ek.Z.subscribeWidget}),m&&(0,s.tZ)(em.y,{align:"center",children:m}),!(null==i?void 0:i.is_free_subscribed)&&!h&&(0,s.tZ)(eu.sg,{maxWidth:400,children:(0,s.tZ)(e_.O,{includeCheckbox:!1,addSubscribePreamble:!0,color:"secondary",textAlign:"center"})})]})})]})]})},eQ=e=>{let{pub:t}=e;return(0,s.BX)("div",{className:"post-silhouette",children:[(0,s.tZ)("div",{className:"post-silhouette-title"}),(0,s.tZ)("div",{className:"post-silhouette-meta ".concat(t&&t.bylines_enabled&&t.byline_images_enabled?"with-byline-image":"")}),(0,s.tZ)("div",{className:"post-silhouette-body"})]})},e0=e=>{var t,n,i,o;let r,{allowEdit:a,allowSendEmail:l,allowTruncate:d,base_url:c,children:m,className:p,hideAudience:h,hideDate:g,hideTitle:v,hidePinning:_,noTitleLink:f,isStatic:y,isFreePreview:b,is_draft:w,onChange:Z,post:x,pub:S,reaction_token:k,showComments:N,showDatetime:T,showEmailSent:E,showReactions:R,showShare:L,showAppUpsell:j,showSubtitle:X,showPhoto:O,showLabel:F,showRestack:H,showCommentRestack:z,hideAuthor:q,user:V,utm_source:J,showUpdatedIcons:Y,fromPostPage:K,onClickCommentButton:G,reactors:$,inThreadHead:Q,publishedPost:et,compEndsSoon:en,compEndedRecently:ei,siteConfigValues:eo={},eligibleForTTS:er,showRestackModal:ea,showIcon:es,isOnPostPage:el,showTranscriptionButton:ed,onTranscriptionClick:ec,isAppMode:em=!1,republishingPost:eh,autoPlayVoiceOver:eg=!1}=e,{iString:ev}=(0,ee.M1)(),e_=(0,eP.tq)({checkFirst4:!0}),ef=eh||x,ey="number"==typeof d?d:45,eZ=x.title&&x.title.length>ey,eC=w?x.draft_title:x.title,ek=[(es||"thread"===x.type)&&(0,s.tZ)(U.m,{postType:x.type,isStatic:y,height:15,className:x.type}),eZ&&d?(0,eS.truncateWords)(eC,ey):eC],eN=w?x.draft_subtitle:x.subtitle;x.section_id&&S.sections&&S.sections.length&&(x.section=S.sections.find(e=>e.id===x.section_id));let eT=(0,ew.B9)({pub:S,subscriptionType:null==V?void 0:V.subscription_type}),eE=!["page"].includes(null==x?void 0:x.type),eR=eE&&y&&en&&!eT&&(null==eo?void 0:eo.continue_support_cta_in_newsletter_emails),eB=e6(x)||er||x.voiceoverUpload,eL=(null==x?void 0:x.type)==="adhoc_email",eM=eE&&y&&!eL&&!em,eD=(0,eb.HD)({pub:S})&&(!!x.postTheme||["video","podcast"].includes(x.type)&&Q);r=x.post_url_override?x.post_url_override:y&&em?C.W.POST_TITLE_APP_MODE_URL:y?C.W.POST_TITLE_URL:"".concat((0,ex.uRy)(S,x)).concat(J?"?utm_source=".concat(J):"");let eA="".concat(S.base_url+(ef.section?(0,ex.Ucy)(S,{section:ef.section}):""),"/?utm_source=").concat(eI.b3.substack,"&utm_medium=").concat(eI.lP.menu);return eD?(0,s.tZ)(W.I,{post:x,postTheme:x.postTheme,title:eC,subtitle:eN,pub:S,inThreadHead:!!Q,autoPlayVoiceOver:eg}):(0,s.BX)("div",{className:u()("post-header",p),role:"region","aria-label":ev("Post header"),children:[(0,eb.kb)({pub:S})&&(null!==(o=null===(t=x.postTags)||void 0===t?void 0:t.length)&&void 0!==o?o:0)>0&&(0,s.tZ)(eu.X2,{alignItems:"center",gap:4,paddingBottom:8,children:null===(n=x.postTags)||void 0===n?void 0:n.map((e,t)=>(0,s.BX)(s.HY,{children:[0!==t&&(0,s.tZ)(ep.xv.Meta,{children:"—"}),(0,s.tZ)(ep.xv.Meta,{as:"a",size:14,href:(0,ex.Mk9)(S,e),children:e.name})]}))}),F&&x.section&&(0,s.tZ)(eu.X2,{className:"post-label",children:(0,s.tZ)(ep.xv.Meta,{as:"a",size:14,href:eA,children:null===(i=ef.section)||void 0===i?void 0:i.name})}),eR&&(0,s.tZ)(I.v,{post:x,compAlreadyExpired:ei}),!v&&(0,s.tZ)("h1",{className:u()("post-title",x.is_published?"published":"restack"!==x.type||eh?"adhoc_email"===x.type?"adhoc":"unpublished":"email-only-cross-post",{"post-title--the-pillar":(0,eb.kb)({pub:S})}),children:f?ek:(0,s.tZ)("a",{href:r,children:ek})}),X&&eN&&(0,s.tZ)("h3",{className:u()("subtitle",{"subtitle--the-pillar":(0,eb.kb)({pub:S})}),children:eN}),"page"===x.type?(0,s.tZ)("div",{style:{height:32}}):el&&!y?(0,s.BX)(eu.sg,{paddingBottom:16,"aria-label":ev("Post UFI"),role:"region",children:[(0,s.tZ)(eu.sg,{paddingY:16,children:(0,s.tZ)(A.E,{post:x,pub:S})}),(0,s.tZ)(P.j,{user:V,isMobile:e_,post:x}),e_?K&&(0,s.tZ)(D.mt,{post:x,pub:S,user:V,isStatic:!!y,postReactionToken:k,onChange:Z,allowEdit:a,hidePinning:_,showEmailSent:E,allowSendEmail:l,hideComments:!N,onCommentsClick:G,showRestackModal:ea}):(0,s.tZ)(D.Mp,{post:x,pub:S,user:V,onChange:Z,showRestackModal:ea,showTranscriptionButton:ed,onTranscriptionClick:ec,showClipping:"video"===x.type,postReactionToken:k})]}):(0,s.BX)(s.HY,{children:[!eE||y||et||Q?eE&&!y&&et?(0,s.tZ)(D._2,{post:x,pub:S,user:V,style:"compressed",labelStyle:"counts-or-none",postReactionToken:k,showEmailSent:E,hideShare:!L||"restack"===x.type,hideComments:"restack"===x.type,hideSavePost:"restack"===x.type,hideReactions:"restack"===x.type,showPreamble:!0,onChange:void 0,allowEdit:a,allowSendEmail:l,editButtonIsLast:!0,preambleConfig:{showAudience:!h,showDate:!g,showDatetime:T,showAuthor:!q},isStatic:y,position:"publisher-post-list"}):Q&&!y?(0,s.tZ)(D._2,{post:x,pub:S,user:V,style:"compressed",labelStyle:"counts-or-none",postReactionToken:k,hideSavePost:!0,showPreamble:!0,allowEdit:a,allowSendEmail:l,editButtonIsLast:!0,onChange:Z,preambleConfig:{showAudience:!h,showDate:!g,showDatetime:T,showAuthor:!q},hideShare:!L,position:"publisher-post-list",isStatic:y}):eE?(0,s.tZ)(B.SP,{user:V,pub:S,post:x,showDate:!g,showDatetime:T,showEmailSent:E,showAudience:!h,showReactions:!eM&&R,showComments:!eM&&N,showShare:!eM&&L,showRestack:!eM&&H,reaction_token:k,onChange:Z,isStatic:y,isFreePreview:b,sharedShareDialog:!0,base_url:c,allowSendEmail:l,allowEdit:a,showAuthor:!q,showPhoto:O,hidePinning:_,showUpdatedIcons:Y,inThreadHead:Q,fromPostPage:K,onClickCommentButton:G,reactors:$,isAppMode:em}):(0,s.tZ)("div",{className:"spacer",style:{height:24}}):(0,s.tZ)(M.a,{className:"meta-subheader",pub:S,post:x,user:V,showDate:!g,showDatetime:!!T,isStatic:!!y,postReactionToken:k,onChange:Z,allowEdit:a,hidePinning:_,showEmailSent:E,allowSendEmail:l,allowMobileFooter:K,onCommentsClick:G,showRestackModal:ea}),eE&&eM&&(0,s.tZ)(D.yT,{customization:{showShare:L,showComments:N,showReactions:R,showListen:!H&&!b&&!!eB,showSave:!H,showRestack:H,showCommentRestack:z,showAppUpsell:j}}),eL&&(0,s.tZ)("div",{className:"email-ufi-2-empty"})]}),m]})},e1=e=>{let{user:t,pub:n,post:i}=e,{iString:o,iTemplate:r}=(0,ee.M1)(),a=(0,eS.getBylineUsers)(i).filter(e=>e.is_guest);return 0===a.length?null:(0,s.BX)("div",{className:"post-contributor-footer",children:[(0,s.tZ)("div",{className:"container-border"}),a.map(e=>{let i=(0,eS.guessFirstName)(e.name),a=e.primaryPublicationSubscribeUrl;a&&(null==t?void 0:t.email)&&(a=(0,eZ.rhs)(a,{email:t.email,autoSubmit:!0,utm_source:eI.b3.substack,utm_campaign:eI.VX.guestPostBio,utm_medium:eI.lP.web}));let l=(0,eZ.rhs)((0,ex.NNq)(e),{utm_campaign:eI.VX.guestPostBio,utm_medium:eI.lP.web}),d=K.ZP.hasCustomProfilePhoto(e);return(0,s.tZ)("div",{className:u()("post-contributor-bio",{"post-contributor-bio-no-text":!e.bio}),"data-user-id":e.id,children:(0,s.tZ)("table",{cellpadding:"0",cellspacing:"0",className:"post-contributor-bio-table",children:(0,s.BX)("tr",{className:"post-contributor-bio-table-row",children:[d&&(0,s.tZ)("td",{className:"post-contributor-bio-userhead-cell post-contributor-bio-userhead-cell-web",children:(0,s.tZ)(j.ProfileHoverCard,{subject:e,utmSource:"byline",children:(0,s.tZ)(K.ZP,{size:52,user:t,pub:n,subject:e})})}),(0,s.tZ)("td",{className:"post-contributor-bio-body-cell post-contributor-bio-body-cell-web",children:(0,s.BX)("div",{className:"post-contributor-bio-body",children:[e.bio&&(0,s.tZ)("div",{className:"post-contributor-bio-preamble",children:o("A guest post by")}),(0,s.tZ)("table",{cellpadding:"0",cellspacing:"0",className:"post-contributor-bio-body-table",children:(0,s.BX)("tr",{className:"post-contributor-bio-body-table-row",children:[(0,s.BX)("td",{className:"post-contributor-bio-copy-cell",children:[!e.bio&&(0,s.tZ)("div",{className:"post-contributor-bio-preamble",children:o("A guest post by")}),(0,s.BX)(eu.X2,{gap:4,alignItems:"center",paddingBottom:4,children:[(0,s.tZ)(j.ProfileHoverCard,{subject:e,utmSource:"byline",children:(0,s.tZ)("a",{className:"post-contributor-bio-title no-margin",href:l,native:!0,children:e.name})}),(0,s.tZ)(eg.UserBadge,{size:"sm",tier:e.bestseller_tier,userId:e.id})]}),e.bio&&(0,s.tZ)("div",{className:"post-contributor-bio-text",children:e.bio})]}),(0,s.tZ)("td",{className:"post-contributor-bio-controls-cell post-contributor-bio-controls-cell-web",children:(0,s.tZ)("div",{className:"post-contributor-bio-controls",children:a&&(0,s.tZ)("a",{className:"post-contributor-bio-subscribe-button button primary",href:a,native:!0,children:(0,s.tZ)("span",{className:"post-contributor-bio-subscribe-button-label",children:r(eq(),i)})})})})]})})]})})]})})})})]})};class e4 extends(4716==n.j?l.Component:null){render(e){let{renderPost:t,posts:n,hideFirstHeading:i,className:o,top:r,children:a}=e;return n=n.slice(0).sort((e,t)=>(0,ef.Z)(t.post_date)-(0,ef.Z)(e.post_date)),(0,s.BX)("div",{className:"calendared-post-list ".concat(o||""),children:[r,p()(g()(this.renderByHeading(n,"year",(e,i)=>[!i.isSameNow("year")&&(0,s.tZ)("h2",{date:i,children:i.year()}),this.renderByHeading(e,"month",(e,o)=>[!(o.isSameNow("year")&&o.isSameNow("month"))&&(0,s.BX)("h3",{date:i,children:[(0,eS.get_month_name)(o)," ",!o.isSameNow("year")&&o.year()]}),e.map(e=>t(e,n.indexOf(e),n))])]))).filter((e,t,n)=>!i||t>=n.findIndex(e=>!e.props||!e.props.date)),a]})}renderByHeading(e,t,n){let i=_()(e,e=>(0,ef.Z)(e.post_date)[t]());return y()(i).sort((e,t)=>Number(t[0])-Number(e[0])).map(e=>{var t;let[,i]=e;return n(i,(0,ef.Z)(null===(t=i[0])||void 0===t?void 0:t.post_date))})}}function e2(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if("undefined"==typeof window)return!1;let n=document.createElement("div");n.innerHTML=e;let i="",o=!1;for(let e=n.childNodes.length-1;e>=0;e--){let r=n.childNodes[e];if(r){if((0,es.pv)(r,"button-wrapper")||(0,es.pv)(r,"subscription-widget-wrap")||(0,es.pv)(r,"subscribe-widget")){o=!0;break}if((i+=r.textContent).length>t)break}}return!o}function e8(e){let{post:t,user:n,onChange:i}=e,[a,l]=(0,d.eJ)(!1),{getExperimentVariant:c}=(0,$.jc)(),u="treatment"===c("video_email_watch_later_experiment"),{onSave:m}=(0,D.vk)({post:t,isSaved:!1});return((0,d.d4)(()=>{if("save"===new URL(location).searchParams.get("action")&&(history.replaceState({},"",(0,eZ.rhs)({action:null})),n)){let e=m();i({post:(0,r._)((0,o._)({},t),{is_saved:e})}),e&&u&&l(!0)}},[]),a)?(0,s.tZ)(el.X,{onClose:()=>l(!1)}):null}function e6(e){var t;return!!(null===(t=e.audio_items)||void 0===t?void 0:t.some(e=>"tts"===e.type))}function e5(e){var t;return!!(null===(t=e.audio_items)||void 0===t?void 0:t.some(e=>"tts"===e.type&&"paywalled"===e.status))}let e9=()=>(0,s.tZ)("article",{className:u()("typography post",{"shows-post":!1}),children:(0,s.tZ)("div",{className:"container tw-p-12",children:(0,s.tZ)("p",{align:"center",children:(0,s.tZ)(ep.xv,{translated:!0,as:"span",children:"This content has been withheld in your country in response to a legal requirement."})})})})},67560:function(e,t,n){"use strict";if(n.d(t,{b:()=>f}),4716==n.j)var i=n(58865);var o=n(16584),r=n(30396),a=n(33804),s=n(95441),l=n(7882),d=n(15771),c=n(19081),u=n(68709),m=n(6490),p=n(17688),h=n(51776),g=n(63651);function v(){let e=(0,i._)(["Reader Survey ",""]);return v=function(){return e},e}function _(){let e=(0,i._)(["Reader Survey"]);return _=function(){return e},e}let f=e=>{var t,n;let{isOpen:i,onInsert:f,onClose:y,pub:b}=e,{iString:w,iTemplate:Z}=(0,s.M1)(),[C,x]=(0,r.eJ)(null),[P,S]=(0,r.eJ)(w("Start Survey")),{isLoading:I,result:k,refetch:N}=(0,l.ib)({pathname:"/api/v1/survey",auto:!1}),{isLoading:T,result:E,refetch:R}=(0,l.ib)({pathname:"/api/v1/survey",auto:!1,method:"POST",json:{title:(null==k?void 0:null===(t=k.surveys)||void 0===t?void 0:t.length)?Z(v(),(null==k?void 0:null===(n=k.surveys)||void 0===n?void 0:n.length)+1):Z(_())}});return(0,r.d4)(()=>{let e=e=>{"surveySavedInPopup"===e.data&&N()};return i&&!T&&E&&(window.open((0,g.bzh)(b,E.id,{popup:!0}),"_blank"),window.addEventListener("message",e)),()=>{window.removeEventListener("message",e)}},[i,T,E]),(0,r.d4)(()=>{!i||k||I||N()},[i,k,N,I]),(0,o.tZ)(m.u_,{isOpen:i,children:(0,o.BX)(a.w,{children:[(0,o.tZ)(m.xB,{title:w("Insert a Survey"),showClose:!1,showDivider:!0}),(0,o.tZ)(m.fe,{children:(0,o.tZ)(c.tu,{gap:20,children:!I&&k&&(0,o.BX)(o.HY,{children:[(0,o.BX)(h.fv,{children:[(0,o.tZ)(u.__,{children:w("Survey to insert")}),(0,o.BX)(p.i,{value:C||"",onChange:e=>{let t=e.currentTarget.value;if("new"===t){R();return}x(Number(t))},children:[(0,o.tZ)(p.d,{children:w("Select a reader survey")}),k.surveys.map(e=>(0,o.tZ)("option",{value:e.id,children:e.title},e.id)),(0,o.tZ)("option",{value:"new",children:w("Create new survey")})]})]}),(0,o.BX)(h.fv,{children:[(0,o.tZ)(u.__,{children:w("Button text")}),(0,o.tZ)(h.oi,{value:P,onChange:e=>{S(e.currentTarget.value)}})]})]})})}),(0,o.tZ)(m.mz,{showDivider:!0,primaryButton:(0,o.tZ)(d.zx,{priority:"primary",disabled:!C,loading:T,onClick:()=>{f(null==k?void 0:k.surveys.find(e=>e.id===C),P)},children:w("Insert")}),secondaryButton:(0,o.tZ)(d.zx,{priority:"secondary",onClick:y,children:w("Cancel")})})]})})}},42684:function(e,t,n){"use strict";n.d(t,{Z:()=>h});var i=n(27412),o=n(7409),r=n(99282),a=n(16584),s=n(16564),l=n(86657),d=n(64819),c=n(24763),u=n(21903),m=n(24791),p=n(60308);class h extends u.ZP{isPodcast(){return[s.MR.Podcast,s.MR.PodcastPreview].includes(this.props.feature)}render(e,t){var n,i;let{feature:u,pub:h,initialFile:g,postId:v,setPostId:_,onRecorderStopped:f,onError:y,onRecorderStarted:b,onUploadStarted:w,legacyPodcastUrl:Z,onUploadCanceled:C,skipToRecordStep:x,hideRecorder:P,hideReset:S,components:I}=e,{mediaUpload:k,timeLeft:N,dismissedAudioErrorModal:T}=t,E=null!==(n=null==I?void 0:I.AuditionPlayer)&&void 0!==n?n:c.Z,R=null!==(i=null==I?void 0:I.AudioUploader)&&void 0!==i?i:d.n,B=(0,m.Os)(k);return Z?(0,a.tZ)(l.Z,{feature:u,pub:h,src:Z,render:e=>(0,a.tZ)(E,(0,r._)((0,o._)({},e),{onRemove:this.removeAudio})),mediaUpload:null!=k?k:void 0,trackingProps:{contentType:"post",surface:"editor",entityType:"post",entityKey:null!=v?v:"unknown"}}):(0,a.BX)(a.HY,{children:[(!k||"transcoded"!==k.state||B)&&(0,a.tZ)(R,{feature:u,initialFile:g,mediaType:"audio",postId:v,onUpload:e=>this.onMediaUpload({mediaUpload:e}),setPostId:_,onRecorderStarted:b,onRecorderStopped:f,onError:y,mediaUpload:k,removeUpload:this.removeUpload,onUploadCanceled:C,onUploadStarted:w,transcodeTimeLeft:N,skipToRecordStep:x,language:this.props.language,hideRecorder:P,hideReset:S,onResetToDefault:this.props.onResetToDefault,maxVideoDurationSeconds:null,onVideoTooLong:null}),(null==k?void 0:k.state)==="transcoded"&&(0,a.tZ)(l.Z,{feature:u,pub:h,src:k?(0,p.rhs)("/api/v1/audio/upload/".concat(k.id,"/src")):Z,render:e=>(0,a.tZ)(E,(0,r._)((0,o._)({},e),{onRemove:this.removeAudio})),duration:null==k?void 0:k.duration,playbackRate:1,mediaUpload:null!=k?k:void 0,trackingProps:{surface:"editor",contentType:"post",entityKey:null!=v?v:"unknown",entityType:"post"}}),B&&(0,a.tZ)(s.YX,{isOpen:!T,onDismiss:()=>{this.setState({dismissedAudioErrorModal:!0})}})]})}constructor(e,t){super(e,t),(0,i._)(this,"removeAudio",()=>{var e,t;this.props.legacyPodcastUrl?null===(e=(t=this.props).onRemoveLegacyUrl)||void 0===e||e.call(t):this.removeUpload()}),this.state={mediaUploadId:e.mediaUploadId,mediaUpload:e.mediaUpload||null,estimatedTimeLeftAt:null,timeLeft:0,percentComplete:1,dismissedAudioErrorModal:!1}}}},78592:function(e,t,n){"use strict";let i,o;n.d(t,{G:()=>h});var r=n(16584),a=n(30396),s=n(80569),l=n.n(s),d=n(80026),c=n(6490);function u(){document.getElementById("technical-analysis-chart-demo")&&"TradingView"in window&&(o=new window.TradingView.widget({container_id:"technical-analysis-chart-demo",width:"100%",height:"600",symbol:"AAPL",interval:"D",timezone:"exchange",theme:"light",style:"1",toolbar_bg:"#f1f3f6",withdateranges:!0,hide_side_toolbar:!1,allow_symbol_change:!0,save_image:!1,show_popup_button:!0,popup_width:"1000",popup_height:"650",locale:"en"}))}async function m(e){try{let t=await new Promise((t,n)=>{let i=new Image;i.onload=()=>t(i),i.onerror=e=>n(e),i.src=e});return{height:t.height,width:t.width}}catch(e){return console.error("Error loading image:",e),{height:null,width:null}}}let p=()=>{let e=(0,a.sO)(null);return(0,a.d4)(()=>(e.current=u,i||(i=new Promise(e=>{let t=document.createElement("script");t.id="tradingview-widget-loading-script",t.src="https://s3.tradingview.com/tv.js",t.type="text/javascript",t.onload=e,document.head.appendChild(t)})),i.then(()=>e.current&&e.current()),()=>e.current=null),[]),(0,r.tZ)("div",{className:"tradingview-widget-container",children:(0,r.tZ)("div",{id:"technical-analysis-chart-demo"})})},h=e=>{let{isOpen:t,onClose:n,onInsert:i}=e,[s,u]=(0,a.eJ)(!1);return(0,r.BX)(c.u_,{isOpen:t,onClose:n,width:900,children:[(0,r.tZ)(c.xB,{showClose:!1,title:"Financial Chart"}),(0,r.tZ)(c.fe,{children:(0,r.tZ)(p,{})}),(0,r.tZ)(c.mz,{primaryButton:(0,r.tZ)(d.zx,{priority:"primary",disabled:s,onClick:()=>{u(!0),o.image(async e=>{let t=g(e),o=await l().post("/api/v1/image").send({image:t}),{height:r,width:a}=await m(o.body.url);i({url:o.body.url,height:r,width:a}),u(!1),n()})},children:"Insert"}),secondaryButton:(0,r.tZ)(d.zx,{priority:"secondary",onClick:n,children:"Cancel"})})]})},g=e=>{let t=e.match(/^https:\/\/\w*\.tradingview\.com\/x\/([^\/]+)/);if(!t||!t[1])throw Error("Invalid URL format");return"https://s3.tradingview.com/snapshots/".concat(t[1].substring(0,1).toLowerCase(),"/").concat(t[1],".png")}},39769:function(e,t,n){"use strict";if(n.d(t,{F:()=>F}),4716==n.j)var i=n(7409);if(4716==n.j)var o=n(99282);var r=n(16584),a=n(30396),s=n(94184),l=n.n(s),d=n(39693),c=n.n(d),u=n(24350),m=n.n(u),p=n(57557),h=n.n(p);if(4716==n.j)var g=n(71375);var v=n(80569),_=n.n(v),f=n(71171),y=n.n(f),b=n(95441),w=n(98914),Z=n(15771),C=n(55014),x=n(19081),P=n(8594),S=n(68709),I=n(6490);if(4716==n.j)var k=n(19425);if(4716==n.j)var N=n(12048);var T=n(98661),E=n(88e3);let R=4716==n.j?{modalFixed:"modalFixed-vsWZGw"}:null,B=e=>{let{isOpen:t,children:n,className:i,onClose:o=()=>void 0}=e;return(0,r.tZ)(k.u,{show:t,as:T.Fragment,children:(0,r.tZ)(N.V,{as:"div",onClose:o,open:t,className:l()(R.modalFixed,i),children:(0,r.tZ)(E.Q,{children:(0,r.tZ)(E.l,{className:l()(i,R.modalFixedPanel),width:400,children:n})})})})};var L=n(98248),M=n(58175),D=n(51776),A=n(70379),U=n(63651);let j=4716==n.j?{fileUpload:"fileUpload-MAekNl",compact:"compact-ibnlwO",images:"images-DdFDkM",image:"image-gnZKZk",remove:"remove-ZNF8bv",size1:"size1-dUX40Z",size2:"size2-sshVv9",size4:"size4-V7EJBU"}:null,X="image/heic",O=e=>{let{image:t,onRemove:n,listeners:a}=e;return(0,r.BX)(x.hs,(0,o._)((0,i._)({position:"relative",cursor:"grab",flex:"auto",radius:"xs",overflow:"hidden",className:j.image},a),{children:[(0,r.tZ)(Z.GI,{priority:"secondary",size:"sm",className:j.remove,onClick:n,children:(0,r.tZ)(g.Z,{size:16})}),(0,r.tZ)("img",{src:t.src})]}))},F=e=>{let{isOpen:t,onClose:n,onInsertGallery:s,onUpdateGallery:d,editor:u,editingCurrentSelection:p,postId:g}=e,[v,f]=(0,a.eJ)([]),[k,N]=(0,a.eJ)({}),[T,E]=(0,a.eJ)(new Set),[R,F]=(0,a.eJ)([]),[H,z]=(0,a.eJ)([]),[q,V]=(0,a.eJ)(""),[J,W]=(0,a.eJ)(""),[Y,K]=(0,a.eJ)(!1),[G,$]=(0,a.eJ)(!1),[Q,ee]=(0,a.eJ)({}),[et,en]=(0,a.eJ)(new Set),{iString:ei}=(0,b.M1)(),eo=(0,A.pm)();(0,a.d4)(()=>{if(p){let{gallery:e}=u.view.state.selection.node.attrs,t=e.images.map(e=>(0,o._)((0,i._)({},e),{id:y()()}));f(t.map(e=>e.type===X?(0,o._)((0,i._)({},e),{src:(0,U.zF4)(e.src,200)}):e)),E(new Set(t.map(e=>e.id))),N(m()(t,"id")),V(e.caption),W(e.alt)}},[p]);let er=()=>{el(),n()},ea=async e=>{if(e.length+v.length>9){eo.popToast(e=>(0,r.tZ)(A.FN,(0,o._)((0,i._)({},e),{text:ei("Image gallery is limited to 9 images")})));return}let t=[],n=[];for(let i of Array.from(e)){if(i.type===X){n.push(i);continue}let e=await (0,w.Zk)(i);t.push({file:i,src:e,id:y()()})}if(n.length){$(!0);let e=[];for(let t of n){let n=await (0,w.Zk)(t);e.push(_().post("/api/v1/image").send({image:n,postId:g}))}F(e);let r=(await Promise.all(e)).map((e,t)=>({type:e.body.contentType,src:e.body.url,id:y()(),file:n[t]}));en(new Set(r.map(e=>e.id))),ee(m()(r,"id")),t.push(...r.map(e=>(0,o._)((0,i._)({},e),{src:(0,U.zF4)(e.src,200)}))),$(!1)}f(e=>[...e,...t])},es=e=>{if(v.length<=1)f([]);else{let t=v[e];T.has(t.id)&&N(e=>h()(e,[t.id])),f(t=>[...t.slice(0,e),...t.slice(e+1)])}},el=()=>{z([]),f([]),E(new Set),N({}),en(new Set),ee({}),V(""),W("")},ed=(0,a.I4)(async()=>{K(!0);try{let e=[];for(let t of v)if(T.has(t.id)){let{type:n,src:i}=k[t.id];e.push(Promise.resolve({body:{contentType:n,url:i}}))}else if(et.has(t.id)){let{type:n,src:i}=Q[t.id];e.push(Promise.resolve({body:{contentType:n,url:i}}))}else{let n=_().post("/api/v1/image").send({image:t.src,postId:g});z(e=>[...e,n]),e.push(n)}let t={images:(await Promise.all(e)).map(e=>({type:e.body.contentType,src:e.body.url})),caption:q,alt:J};if(1===v.length)t.staticGalleryImage=t.images[0];else{z([]);let e=_().post("/api/v1/image-gallery").send({gallery:t});z([e]);let{body:n}=await e;t.staticGalleryImage={type:n.contentType,src:n.url}}p?d(t):s(t),K(!1),er()}catch(e){"ABORTED"!==e.code&&(K(!1),eo.popToast(e=>(0,r.tZ)(A.FN,(0,o._)((0,i._)({},e),{text:ei("Failed to upload gallery images")}))),console.error(e))}},[v,q,J]),ec=new Map(v.map(e=>[e.id,e]));return(0,r.BX)(B,{isOpen:t,onClose:er,children:[(0,r.tZ)(I.xB,{title:ei("Image gallery"),description:ei("Add up to 9 images"),showClose:!0,onClose:er,showDivider:!0}),(0,r.tZ)(I.fe,{children:(0,r.BX)(x.sg,{gap:20,children:[G&&(0,r.BX)(x.sg,{minHeight:220,alignItems:"center",justifyContent:"center",children:[(0,r.tZ)(L.$j,{}),(0,r.tZ)(M.xv.B4,{color:"secondary",children:ei("Processing images...")})]}),v.length>0&&!G&&(0,r.tZ)(P.A,{items:v.map(e=>e.id),onReorder:e=>{f(c()(e.map(e=>ec.get(e))))},children:(0,r.tZ)(x.hs,{className:l()(j.images,j["size".concat(v.length)]),wrap:"wrap",gap:4,children:v.map((e,t)=>(0,r.tZ)(P.L,{item:e.id,index:t,children:n=>{let{listeners:i}=n;return(0,r.tZ)(O,{image:e,onRemove:()=>es(t),listeners:i})}},e.id))})}),v.length<9&&!G&&(0,r.tZ)(C.G,{multiple:!0,onFileSelected:ea,dropCTA:ei("Drop image files here"),className:l()(j.fileUpload,!!v.length&&j.compact),addMode:v.length>0}),!!v.length&&(0,r.BX)(r.HY,{children:[(0,r.BX)(D.fv,{children:[(0,r.tZ)(S.__,{children:ei("Caption")}),(0,r.tZ)(D.oi,{placeholder:ei("Add a caption"),value:q,onChange:e=>V(e.currentTarget.value)})]}),(0,r.BX)(D.fv,{children:[(0,r.tZ)(S.__,{children:ei("Alt text")}),(0,r.tZ)(D.oi,{placeholder:ei("Add a description"),value:J,onChange:e=>W(e.currentTarget.value)})]})]})]})}),(0,r.tZ)(I.mz,{showDivider:!0,primaryButton:(0,r.tZ)(Z.zx,{priority:"primary",onClick:ed,disabled:!v.length||v.length>9,loading:Y,children:p?ei("Update gallery"):ei("Add gallery")}),secondaryButton:(0,r.tZ)(Z.zx,{priority:"secondary",onClick:()=>{H.forEach(e=>e.abort()),R.forEach(e=>e.abort()),F([]),z([]),K(!1),$(!1),er()},children:ei("Cancel")})})]})}},60310:function(e,t,n){"use strict";if(n.d(t,{Z:()=>x}),4716==n.j)var i=n(7409);if(4716==n.j)var o=n(99282);if(4716==n.j)var r=n(58865);var a=n(16584),s=n(98661),l=n(30396),d=n(23279),c=n.n(d),u=n(23493),m=n.n(u),p=n(80569),h=n.n(p),g=n(64515);let v=4716==n.j?e=>(0,a.tZ)(g.l,(0,o._)((0,i._)({},e),{className:"filled-icon",name:"UnsplashIcon",svgParams:{height:24,width:24,fill:"#1C110B"},children:(0,a.tZ)("path",{d:"M15.3364 10.9703H21V21H3V10.9703H8.66362V15.9748H15.3158V10.9703H15.3364ZM15.3364 3H8.66362V8.02517H15.3158V3H15.3364Z",strokeWidth:0})})):null;var _=n(93666),f=n(95441),y=n(7882),b=n(15771);function w(){let e=(0,r._)(["No results for ",""]);return w=function(){return e},e}let Z="random",C=e=>e&&e.toLowerCase().trim()||Z,x=4716==n.j?e=>{let{open:t,onAfterClose:r,onSelectStockImage:d}=e,[u,p]=(0,l.eJ)(""),[g,x]=(0,l.eJ)(null),[P,S]=(0,l.eJ)({}),[I,k]=(0,l.eJ)(!1),[N,T]=(0,l.eJ)(!1),[E,R]=(0,l.eJ)(null),B=(0,l.sO)(null),L=(0,l.sO)(null),M=(0,l.sO)(null),D=(0,l.sO)(null),A=(0,l.sO)(!1),U=E&&E.screen<=540?2:3,j=E?Math.floor((E.content-4*(U-1))/U):0,{result:X}=(0,y.Wf)(()=>n.e("7381").then(n.t.bind(n,58751,23)),[],{auto:!0}),O=null==X?void 0:X.default,{iString:F,iTemplate:H}=(0,f.M1)();(0,l.d4)(()=>{let e=()=>{R({content:parseInt(window.getComputedStyle(L.current).getPropertyValue("width"),10),screen:window.innerWidth})};return t&&(B.current.open(),window.addEventListener("resize",e),setTimeout(()=>{e(),L.current.focus()},50)),()=>{x(null),p(""),window.removeEventListener("resize",e)}},[t]);let z=(0,l.I4)(async()=>{if(!g||!g.hasMore||A.current)return;A.current=!0;let e=C(u),t=await h().get("/api/v1/stock-photos").query({search:e,offset:g.results.length,limit:15}),n=(0,o._)((0,i._)({},g),{results:[...g.results,...t.body.results],hasMore:t.body.hasMore});x(n),S(t=>(0,o._)((0,i._)({},t),{[e]:n})),A.current=!1},[g,u]);(0,l.d4)(()=>{let e=m()(e=>{let{scrollTop:t,clientHeight:n,scrollHeight:i}=e.target;t>i-n-380&&z()},200,{leading:!1}),n=M.current;return t&&(null==n||n.addEventListener("scroll",e)),()=>{null==n||n.removeEventListener("scroll",e)}},[t,z]),(0,l.d4)(()=>{if(O&&g&&j){if(0===g.results.length||I||!t){var e;null===(e=D.current)||void 0===e||e.destroy(),D.current=null}else D.current?(D.current.reloadItems(),D.current.layout()):setTimeout(()=>{D.current=new O(".insert-image-modal-images",{itemSelector:".insert-image-modal-item",transitionDuration:0,gutter:4})},50)}},[g,I,j,t]);let q=(0,l.I4)(async e=>{let t=C(e);if(P[t]){k(!1),x(P[t]),M.current.scrollTop=0;return}try{let n=await h().get("/api/v1/stock-photos").query({search:t,offset:0,limit:15}),r={results:n.body.results,hasMore:n.body.hasMore,term:e};k(!1),x(r),S(e=>(0,o._)((0,i._)({},e),{[t]:r})),M.current.scrollTop=0}catch(e){k(!0)}},[P]),V=(0,l.I4)(c()(q,400),[q]);(0,l.d4)(()=>{t&&!g&&q(Z)},[q,t,g]);let J=async e=>{p(e),await V(e)},W=async e=>{T(!0),await h().post("/api/v1/stock-photos").send({downloadLocation:e.links.download_location}),d({url:e.urls.regular,width:e.width,height:e.height,description:e.alt_description,userName:e.user.name,userHref:!!e.user.links.html}),T(!1),B.current.close()},Y=document.querySelector(".editor");return Y?(0,s.createPortal)((0,a.tZ)("div",{onMouseDown:e=>{e.stopPropagation()},children:(0,a.BX)(_.p,{ref:B,closePill:!0,className:"insert-media-modal insert-image-modal force-light-theme",onClose:r,children:[(0,a.tZ)("h3",{className:"insert-media-modal-header",children:F("Search images")}),(0,a.tZ)("div",{className:"form new-form",children:(0,a.tZ)("input",{className:"insert-image-modal-search",ref:L,type:"text","aria-label":F("Search"),placeholder:F("Search..."),value:u,onChange:e=>{J(e.target.value)}})}),(0,a.BX)("div",{className:"insert-image-modal-byline",children:[(0,a.tZ)(v,{height:14})," ",F("Powered by Unsplash")]}),(0,a.tZ)("div",{className:"insert-image-modal-body",ref:M,children:I?(0,a.tZ)("div",{className:"insert-image-modal-empty",children:F("There was an error searching photos. Please try again later.")}):g&&g.results.length>0?(0,a.tZ)("div",{className:"insert-image-modal-images",children:g.results.map(e=>(0,a.BX)("div",{className:"insert-image-modal-item",children:[(0,a.tZ)("img",{src:e.urls.small,alt:e.alt_description,width:j,height:e.height/e.width*j}),(0,a.BX)("div",{className:"insert-image-modal-item-footer",children:[(0,a.BX)("div",{className:"insert-image-modal-item-text",children:[(0,a.tZ)("div",{className:"insert-image-modal-item-title",children:e.description}),(0,a.tZ)("div",{className:"insert-image-modal-item-name",children:e.user.name})]}),(0,a.tZ)(b.zx,{size:"sm",priority:"secondary",disabled:N,onClick:()=>{W(e)},children:F("Insert")})]})]},e.id))}):g&&0===g.results.length?(0,a.tZ)("div",{className:"insert-image-modal-empty",children:H(w(),"&ldquo;".concat(g.term,"&rdquo;"))}):null})]})}),Y):null}:null},20479:function(e,t,n){"use strict";n.d(t,{x:()=>p});var i=n(16584),o=n(30396),r=n(347),a=n(95441),s=n(7882),l=n(15771),d=n(19081),c=n(6490),u=n(17688),m=n(58175);let p=e=>{let{isOpen:t,setOpen:n,onInsert:p}=e,{iString:h}=(0,a.M1)(),[g,v]=(0,o.eJ)(null),{result:_,isLoading:f,refetch:y}=(0,s.ib)({method:"GET",pathname:"/api/v1/sponsorship-campaigns"}),b=(0,o.I4)(()=>{y()},[]);return(0,o.d4)(()=>{t&&b()},[t,b]),(0,i.BX)(c.u_,{isOpen:t,onClose:()=>n(!1),children:[(0,i.tZ)(c.xB,{title:h("Insert a sponsorship campaign"),description:(0,i.tZ)(i.HY,{children:(0,i.tZ)(m.xv.B4,{translated:!0,children:"Sponsorship campaigns are blocks that display text and images provided by a sponsor. They will appear in newsletter emails and on the web. Select an existing campaign from the list below or create a new one"})}),showClose:!0,onClose:()=>n(!1)}),(0,i.tZ)(c.fe,{children:(null==_?void 0:_.length)?(0,i.BX)(d.tu,{gap:4,textAlign:"right",children:[(0,i.BX)(u.i,{value:null==g?void 0:g.id,onChange:e=>v(_.find(t=>t.id===e.currentTarget.value)||null),children:[(0,i.tZ)(u.d,{children:h("Select a campaign")}),_.map(e=>(0,i.tZ)("option",{value:e.id,children:e.title}))]}),(0,i.tZ)(m.xv.B4,{translated:!0,as:"a",href:"/publish/sponsorship-campaigns",children:"Manage Campaigns"})]}):f?(0,i.tZ)(m.xv.B4,{translated:!0,children:"Loading campaigns..."}):(0,i.BX)(m.xv.B4,{translated:!0,children:["No campaigns found. ",(0,i.tZ)("a",{href:"/publish/sponsorship-campaigns",children:"Manage Campaigns"})]})}),(0,i.tZ)(r.h,{children:(0,i.tZ)(c.mz,{primaryButton:(0,i.tZ)(l.zx,{disabled:!g,priority:"primary",onClick:()=>{g&&(p(g),n(!1))},children:h("Insert Campaign")}),secondaryButton:(0,i.tZ)(l.zx,{priority:"secondary",onClick:()=>n(!1),children:h("Cancel")})})})]})}},44369:function(e,t,n){"use strict";n.d(t,{$4:()=>l,Sm:()=>h,cS:()=>v,mg:()=>p,nv:()=>m,om:()=>f,pA:()=>_,vM:()=>g});var i=n(27412),o=n(42249),r=n(68833),a=n(98914),s=n(60308);class l extends o.sN{static fromMenuItem(e,t){let{spec:n}=e;return new l(n,t)}constructor(e,t){super(e);let n=this.spec.run;this.spec.run=(e,i,o,a)=>((0,r.j)(r.FP.EDITOR_MENU_ICON_CLICKED,{button:t||this.spec.label||this.spec.title}),n.call(this,e,i,o,a))}}let d="ProseMirror-prompt",c="".concat(d,"-visible");class u{read(e){return e.value}validate(e){return(e=this.clean(e))||!this.options.required?this.options.validate&&this.options.validate(e):"Required field"}clean(e){return this.options.clean?this.options.clean(e):e}constructor(e){(0,i._)(this,"options",void 0),this.options=e}}class m extends u{render(){let e=document.createElement("input");return e.type="text",e.placeholder=this.options.label,e.value=this.options.value||"",e.className=this.options.className||"",e.autocomplete="off",e}}class p extends(4716==n.j?u:null){render(){let e=document.createElement("select");e.value=this.options.value||"";let t=document.createElement("option");return t.textContent=this.options.label,t.value="",e.appendChild(t),this.options.options.forEach((t,n)=>{let i=document.createElement("option");i.textContent=t.label,i.value=String(n),e.appendChild(i)}),this.options.onChange&&e.addEventListener("change",()=>{let t=this.read(e);this.options.onChange(t)},!1),e}read(e){let t=this.options.options[e.value];return t&&t.value}}class h extends m{constructor(e,t,n="en"){let{iString:i}=I18N.i(n);super({label:i("Enter URL..."),className:"url-input",value:t||e&&e.mark.attrs.href||"",required:!0,clean:e=>{let t;return e?(t=e.trim()).startsWith("http")||t.startsWith("mailto")||/^%%.*%%$/.test(t)?t:"http://".concat(t):""},validate:e=>{if(!/^%%.*%%$/.test(e)){if(e.startsWith("".concat((0,s.SVA)(),"/publish/post/"))&&alert(i("This is a link to a post draft. Readers will not be able to access this page.")),e.length>1900)return i("Link is too long");try{let t=new URL(e);if(["http:","https:","mailto:"].includes(t.protocol))return}catch(e){console.error("Failed to parse URL:",e)}return e.startsWith("http")?i("Invalid URL"):i("Invalid URL. Try using http://")}}})}}function g(e,t){let{from:n,$from:i,to:o,empty:r}=e.selection;return r?!!t.isInSet(e.storedMarks||i.marks()):e.doc.rangeHasMark(n,o,t)}function v(e){if(_(e))return;let{iString:t}=I18N.i(e.language||"en"),n="".concat(d,"-").concat(e.parentClass),i=e.root||document.body,o=e.scrollParent&&document.querySelector&&document.querySelector(e.scrollParent)||function e(t){return null==t?null:t.scrollHeight>t.clientHeight?t:e(t.parentElement)}(i)||window,r=i.appendChild(document.createElement("div"));r.classList.add(d),e.className&&r.classList.add(e.className),r.id=n,(0,a.cn)(document.body,c);let s=e=>{r.contains(e.target)||m()},l=()=>{if(e.position)e.position(r,p);else{var t,n;let i=e.parentClass&&(null===(t=(n=document).querySelector)||void 0===t?void 0:t.call(n,".".concat(e.parentClass)));if(i){let t=i.getBoundingClientRect();r.style.top="".concat(t.bottom+(e.offsetTop||0),"px"),r.style.left="".concat(t.left+(e.offsetLeft||0),"px")}else{let t=r.getBoundingClientRect();r.style.top="".concat((window.innerHeight-t.height)/2+(e.offsetTop||0),"px"),r.style.left="".concat((window.innerWidth-t.width)/2+(e.offsetLeft||0),"px")}}},u=t=>{var n;t&&t.preventDefault();let i=function(e,t){let n={},i=0;for(let o in e){let r=e[o],a=t[i++],s=r.read(a),l=r.validate(s);if(l)return function(e,t){let n=e.parentNode;if(!n)return;let i=n.appendChild(document.createElement("div"));i.style.left="".concat(e.offsetLeft+e.offsetWidth+2,"px"),i.style.top="".concat(e.offsetTop-5,"px"),i.className="ProseMirror-invalid",i.textContent=t,setTimeout(()=>n.removeChild(i),1500)}(a,l),null;n[o]=r.clean(s)}return n}(null!==(n=e.fields)&&void 0!==n?n:{},h);i&&m(i)},m=t=>{(0,a.IV)(document.body,c),window.removeEventListener("mousedown",s),window.removeEventListener("resize",l,!1),o.removeEventListener("scroll",l,!1),r.parentNode&&r.parentNode.removeChild(r),t?(e.onSubmit&&e.onSubmit(t),e.callback&&e.callback(t)):e.onCancel&&e.onCancel(),e.onClose&&e.onClose()};setTimeout(()=>window.addEventListener("mousedown",s),50),window.addEventListener("resize",l,!1),o.addEventListener("scroll",l,!1);let p=r.appendChild(document.createElement("span"));p.className="head";let h=[],g=0;for(let t in e.fields){g++;let n=e.fields[t].render();n.tabIndex=g,h.push(n)}let v=r.appendChild(document.createElement("form"));if(e.title&&(v.appendChild(document.createElement("h5")).textContent=e.title),h.forEach(e=>{v.appendChild(document.createElement("div")).appendChild(e)}),!e.no_buttons){let n=document.createElement("button");n.type="submit",n.className="".concat(d,"-submit"),n.textContent=e.submitText||"OK",n.addEventListener("click",u);let i=document.createElement("button");i.type="button",i.className="".concat(d,"-cancel"),i.textContent=t("Cancel"),i.addEventListener("click",()=>m());let o=v.appendChild(document.createElement("div"));o.className="".concat(d,"-buttons"),o.appendChild(n),o.appendChild(document.createTextNode(" ")),o.appendChild(i)}if(e.footer&&v.appendChild(e.footer),e.openseaEmbedFooter&&v.appendChild(e.openseaEmbedFooter),l(),v.addEventListener("submit",u),e.onInput&&v.addEventListener("input",t=>{var n;null===(n=e.onInput)||void 0===n||n.call(e,t,r)}),v.addEventListener("keydown",e=>{if(27==e.keyCode)e.preventDefault(),m();else if(13!=e.keyCode||e.ctrlKey||e.metaKey||e.shiftKey){if(9==e.keyCode&&(window.setTimeout(()=>{r.contains(document.activeElement)||m()},500),h.length>1)){for(let t=0;t<h.length;t++)if(document.activeElement===h[t]){0===t&&e.shiftKey?(e.preventDefault(),h[h.length-1].focus()):t!==h.length-1||e.shiftKey||(e.preventDefault(),h[0].focus());break}}}else e.preventDefault(),u()}),v.elements.length>0){let e=v.elements[0];for(let t of Array.from(v.elements))if(!t.value&&["INPUT","TEXTAREA"].includes(t.nodeName)){e=t;break}e.focus()}}function _(e){let t="".concat(d,"-").concat(e.parentClass),n=document.getElementById(t);if(n){let e;if(n.querySelector&&(e=n.querySelector(".".concat(d,"-cancel"))),e)e.click();else{var i;null===(i=n.parentNode)||void 0===i||i.removeChild(n),(0,a.IV)(document.body,c)}return!0}}function f(e,t){let n=e.selection.$from;for(let e=n.depth;e>=0;e--){let i=n.index(e);if(n.node(e).canReplaceWith(i,i,t))return!0}return!1}},66586:function(e,t,n){"use strict";n.d(t,{k:()=>_});var i=n(16584),o=n(30396),r=n(23493),a=n.n(r),s=n(16564),l=n(95441),d=n(42684),c=n(47921),u=n(68833),m=n(15771),p=n(19081),h=n(58175),g=n(87077);let v=a()((e,t)=>{e({mediaUploadId:null==t?void 0:t.id,duration:null==t?void 0:t.duration,mediaUpload:t})},1e3,{trailing:!1}),_=e=>{let{id:t,droppedFile:n,open:r,pub:a,postId:_,onSave:f,onClose:y,setPostId:b}=e,[w,Z]=(0,o.eJ)(null!=n?n:null),[C,x]=(0,o.eJ)(null),[P,S]=(0,o.eJ)(!1),{iString:I,language:k}=(0,l.M1)();(0,o.d4)(()=>{Z(n)},[n]);let N=()=>{(!P||confirm(I("Your audio will be discarded, are you sure?")))&&((0,u.j)(u.FP.AUDIO_MODAL_CANCEL_CLICKED,{has_media_upload:!!C}),T())},T=()=>{x(null),Z(null),y()},E=(null==C?void 0:C.state)!=="transcoded";return(0,i.BX)(c.n,{wrapperId:t,title:I(s.MR.Embed),isOpen:r,onClose:N,primaryButton:(0,i.tZ)(g.u,{disabled:!E,text:I("Audio needed"),children:(0,i.tZ)(m.zx,{priority:"primary",onClick:()=>{(0,u.j)(u.FP.AUDIO_MODAL_INSERT_CLICKED),v(f,C),T()},disabled:E,children:I("Insert")})}),secondaryButton:(0,i.tZ)(m.zx,{priority:"secondary-outline",onClick:N,children:I("Cancel")}),children:[(0,i.tZ)(h.xv.B4,{paddingBottom:24,children:I(s.PN.Embed)}),(0,i.BX)(p.tu,{padding:16,radius:"md",border:"detail",children:[(0,i.tZ)(h.xv.B2,{weight:"semibold",translated:!0,paddingBottom:16,children:"Create audio"}),(0,i.tZ)(d.Z,{initialFile:w,feature:s.MR.Embed,mediaType:"audio",pub:a,postId:_,setPostId:b,onChange:e=>{let{mediaUpload:t}=e;S(!1),x(t),Z(null)},onUploadStarted:()=>{S(!0)},onUploadCanceled:()=>{S(!1)},mediaUpload:C,mediaUploadId:null==C?void 0:C.id,onRemoveLegacyUrl:null,language:k})]})]})}},57952:function(e,t,n){"use strict";n.d(t,{Rq:()=>j,Xf:()=>D,_F:()=>L,pH:()=>M});var i=n(16584),o=n(6400),r=n(30396),a=n(23279),s=n.n(a);if(4716==n.j)var l=n(62686);if(2787!=n.j)var d=n(71375);if(2787!=n.j)var c=n(24840);if(4716==n.j)var u=n(53716);if(4716==n.j)var m=n(85200);if(4716==n.j)var p=n(887);if(4716==n.j)var h=n(71212);if(4716==n.j)var g=n(27194);if(2787!=n.j)var v=n(84967);if(2787!=n.j)var _=n(49336);var f=n(5772),y=n(95441),b=n(4796),w=n(68833),Z=n(98422),C=n(15771),x=n(61254),P=n(19081),S=n(44424),I=n(58175),k=n(98905),N=n(98012),T=n(61468),E=n(84864),R=n(22233);let B=(0,o.createContext)({isSearching:!1,items:[],setIsSearching:()=>void 0,setItems:()=>void 0,focusedItemStart:null,setFocusedItemStart:()=>void 0,filteredItems:[],searchTerm:null,setSearchTerm:()=>void 0,hasFiltered:!1}),L=e=>{let{children:t}=e,[n,o]=(0,r.eJ)(!1),[a,s]=(0,r.eJ)([]),[l,d]=(0,r.eJ)(null),[c,u]=(0,r.eJ)(null),{filteredItems:m,setQuery:p,hasFiltered:h}=(0,f.R)({items:a,getKeys:e=>[e.text],sortFunc:(e,t)=>e.start-t.start});return(0,r.d4)(()=>{var e,t;d(null!==(t=null===(e=m[0])||void 0===e?void 0:e.start)&&void 0!==t?t:null)},[m]),(0,i.tZ)(B.Provider,{value:{isSearching:n,setIsSearching:o,items:a,setItems:s,focusedItemStart:l,setFocusedItemStart:d,filteredItems:m,hasFiltered:h,searchTerm:c,setSearchTerm:e=>{u(e),p(e)}},children:t})},M=()=>(0,r.qp)(B),D=e=>{let{isEditing:t,setIsEditing:n,setEdits:o,hasEdits:r,handleSubmitEdits:a,handleRegenerateTranscription:s,handleCancelTranscription:c,isTranscribing:u,transcription:m,postId:p,audioUpload:h,onTranscriptionUploadCancelled:g,onTranscriptionUploadError:v,onTranscriptionUploadStarted:_,onTranscriptionUploaded:f,uploadedFile:y,setUploadedFile:b,isEditingSpeakers:Z}=e,{isSearching:x}=M();return(0,i.BX)(P.tu,{gap:16,children:[y&&(0,i.BX)(P.gq,{alignItems:"center",justifyContent:"space-between",padding:16,radius:"sm",border:"detail",gap:16,children:[(0,i.BX)(P.gq,{gap:16,alignItems:"center",children:[(0,i.tZ)(P.hs,{alignItems:"center",padding:8,radius:"sm",color:"primary",bg:"secondary",children:(0,i.tZ)(l.Z,{})}),(0,i.BX)(P.tu,{children:[(0,i.tZ)(I.xv.B3,{weight:"semibold",color:"primary",children:y.name}),(0,i.tZ)(I.xv.B4,{children:(0,E.numberToHumanFileSize)(y.size)})]})]}),(0,i.tZ)(C.hU,{onClick:()=>{(0,w.j)(w.FP.TRANSCRIPTION_EDIT_CANCELLED_CLICKED,{post_id:p}),b(null),c()},children:(0,i.tZ)(d.Z,{})})]}),t&&(0,i.tZ)(U,{hasEdits:r,setIsEditing:n,setEdits:o,handleSubmitEdits:a}),!t&&!x&&(0,i.tZ)(A,{isEditingSpeakers:Z,setIsEditing:n,transcription:m,isTranscribing:u,handleCancelTranscription:c,handleRegenerateTranscription:s,setUploadedFile:b,postId:p,audioUpload:h,onTranscriptionUploadCancelled:g,onTranscriptionUploadError:v,onTranscriptionUploadStarted:_,onTranscriptionUploaded:f}),x&&(0,i.tZ)(j,{postId:p})]})},A=e=>{var t,n,o;let{transcription:r,isTranscribing:a,handleCancelTranscription:s,handleRegenerateTranscription:l,setUploadedFile:d,postId:v,audioUpload:_,onTranscriptionUploadStarted:f,onTranscriptionUploadCancelled:Z,onTranscriptionUploadError:I,onTranscriptionUploaded:k,setIsEditing:E,isEditingSpeakers:B}=e,{iString:L}=(0,y.M1)(),D=(null==r?void 0:r.created_at)&&new Date(r.created_at)<(0,N.Z)().subtract(5,"minutes").toDate(),A=(null==r?void 0:r.status)==="failed",U=(null==r?void 0:r.status)==="transcribed",{setIsSearching:j}=M(),X=null===(t=(null!==(n=null==r?void 0:r.signed_captions)&&void 0!==n?n:[]).find(e=>"True"===e.original))||void 0===t?void 0:t.url,O=async e=>{if(e.cdn_unaligned_url&&e.cdn_url)try{var t,n,i,o;let r=await fetch(e.cdn_unaligned_url,{headers:{Accept:"text/plain"}}),a=await r.text(),s=JSON.parse(a),l=null!==(n=s.segments)&&void 0!==n?n:[];Object.keys(null!==(i=s.speaker_map)&&void 0!==i?i:{}).length>0&&(null==l?void 0:null===(t=l[0])||void 0===t?void 0:t.speaker)||(r=await fetch(e.cdn_url,{headers:{Accept:"text/plain"}}),a=await r.text(),l=JSON.parse(a));let d=(0,T.Vu)(l,null!==(o=e.speaker_map)&&void 0!==o?o:{}),c=new Blob([d],{type:"text/plain"}),u=URL.createObjectURL(c),m=document.createElement("a");m.href=u,m.download="transcript_".concat(new Date().toISOString(),".txt"),document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(u)}catch(e){console.error("Failed to fetch and download transcript:",e)}};return(0,i.BX)(P.gq,{justifyContent:"space-between",gap:8,children:[(0,i.tZ)(C.hU,{onClick:()=>{(0,w.j)(w.FP.TRANSCRIPTION_SEARCH_CLICKED,{post_id:v}),j(!0)},disabled:B,children:(0,i.tZ)(c.Z,{})}),(0,i.BX)(P.gq,{gap:8,children:[(0,i.tZ)(C.zx,{onClick:l,disabled:!(U&&!D||!a||A)||B,leading:(0,i.tZ)(u.Z,{}),priority:"secondary",children:L("Regenerate")}),(0,i.tZ)(b.z,{setUploadedFile:d,postId:v,mediaUpload:_,transcription:null!=r?r:null,onTranscriptionUploadStarted:f,onTranscriptionUploadCancelled:Z,onTranscriptionUploadError:I,onTranscriptionUploaded:k,disabled:!v||!_||(null==_?void 0:_.state)!=="transcoded"||B}),(0,i.BX)(S.v2,{trigger:(0,i.tZ)(C.hU,{priority:"secondary",rounded:!1,children:(0,i.tZ)(m.Z,{className:R.Z.icon})}),children:[(null==r?void 0:r.status)==="transcribed"&&(0,i.BX)(i.HY,{children:[(0,i.tZ)(S.sN,{disabled:B,onClick:()=>{(0,w.j)(w.FP.TRANSCRIPTION_EDIT_CLICKED,{post_id:v}),E(!0)},leading:(0,i.tZ)(p.Z,{}),children:L("Correct transcript")}),(0,i.tZ)(x.iz,{}),(0,i.BX)(S.LY,{leading:(0,i.tZ)(h.Z,{}),content:L("Download"),children:[(0,i.tZ)(S.sN,{disabled:B,onClick:()=>{(0,w.j)(w.FP.TRANSCRIPTION_DOWNLOAD_CLICKED,{post_id:v,type:"txt"}),O(r)},children:L("Download .txt file")}),(0,i.tZ)(S.sN,{disabled:B,href:null!==(o=r.cdn_url)&&void 0!==o?o:void 0,onClick:()=>{(0,w.j)(w.FP.TRANSCRIPTION_DOWNLOAD_CLICKED,{post_id:v,type:"json"})},children:L("Download .json file")}),X&&(0,i.tZ)(S.sN,{disabled:B,href:X,onClick:()=>{(0,w.j)(w.FP.TRANSCRIPTION_DOWNLOAD_CLICKED,{post_id:v,type:"vtt"})},children:L("Download .vtt file")})]}),(0,i.tZ)(x.iz,{})]}),(0,i.tZ)(S.sN,{disabled:!r||B,priority:"destructive",leading:(0,i.tZ)(g.Z,{}),onClick:s,children:L("Remove")})]})]})]})},U=e=>{let{setIsEditing:t,setEdits:n,hasEdits:o,handleSubmitEdits:r}=e,{iString:a}=(0,y.M1)();return(0,i.BX)(P.gq,{justifyContent:"end",gap:8,children:[(0,i.tZ)(C.zx,{onClick:()=>{t(!1),n({})},priority:"secondary",children:a("Cancel")}),(0,i.tZ)(C.zx,{priority:"primary",disabled:!o,onClick:r,children:a("Save")})]})},j=e=>{let{postId:t,closeAlwaysVisible:n=!0}=e,{iString:o}=(0,y.M1)(),{isMobile:a}=(0,Z.v9)(),l=(0,r.sO)(null),{setSearchTerm:u,setIsSearching:m,hasFiltered:p,filteredItems:h,setFocusedItemStart:g,focusedItemStart:f,searchTerm:b}=M();(0,r.d4)(()=>{!b&&l.current&&(l.current.value="")},[b]);let x=h.findIndex(e=>e.start===f),S=()=>{let e=x+1>=h.length?0:x+1;g(h[e].start)},N=()=>{u(""),m(!1),(0,w.j)(w.FP.TRANSCRIPTION_SEARCH_CANCELLED,{post_id:t})};return(0,i.BX)(P.gq,{gap:8,justifyContent:"space-between",alignItems:"center",className:R.Z.searchForm,children:[(0,i.tZ)(k.K,{ref:l,leftIcon:(0,i.tZ)(P.gq,{children:(0,i.tZ)(c.Z,{size:16})}),rightIcon:(0,i.tZ)(P.gq,{cursor:"pointer",onClick:N,children:b||n?(0,i.tZ)(d.Z,{size:16}):null}),placeholder:o("Search"),onChange:s()(e=>{u(e.target.value),(0,w.j)(w.FP.TRANSCRIPTION_SEARCHED,{post_id:t})},100),onKeyDown:e=>{"Enter"===e.key&&S(),"Escape"===e.key&&N()}}),p&&(0,i.tZ)(P.gq,{gap:8,paddingRight:8*!!a,children:(0,i.BX)(P.gq,{alignItems:"center",gap:8,children:[(0,i.tZ)(I.xv.B4,{paddingLeft:a?4:16,className:R.Z.resultsValue,color:"primary",weight:"semibold",children:"".concat(x+1," / ").concat(h.length)}),(0,i.BX)(P.gq,{children:[(0,i.tZ)(C.hU,{priority:"tertiary",size:"sm",onClick:()=>{let e=x-1<0?h.length-1:x-1;g(h[e].start)},children:(0,i.tZ)(v.Z,{size:20})}),(0,i.tZ)(C.hU,{priority:"tertiary",size:"sm",onClick:S,children:(0,i.tZ)(_.Z,{size:20})})]})]})})]})}},47921:function(e,t,n){"use strict";n.d(t,{n:()=>Z});var i=n(16584);if(4716==n.j)var o=n(71375);var r=n(33804),a=n(71068),s=n(15771),l=n(6400),d=n(98661),c=n(30396);if(4716==n.j)var u=n(19425);var m=n(94184),p=n.n(m),h=n(19081);let g=4716==n.j?{animation:"animation-BHdm9o",offscreen:"offscreen-g4eykY",onscreen:"onscreen-FmAcAO",container:"container-c7lblE",drawer:"drawer-hBg1Rc"}:null;function v(e){let{children:t,wrapperId:n}=e,i=document.getElementById(n);return(null===i&&((i=document.createElement("div")).setAttribute("id",n),document.body.appendChild(i)),i)?(0,d.createPortal)(t,i):null}let _=e=>{let{isOpen:t,wrapperId:n="drawer-portal",children:o,includeTransition:r=!0,className:s,width:d=400}=e,u=(0,c.sO)(null);(0,c.d4)(()=>{t&&u.current&&u.current.focus()},[u,t]);let m=r?f:l.Fragment;return(0,i.tZ)(v,{wrapperId:n,children:(0,i.tZ)(m,{isOpen:t,children:(0,i.tZ)(a.xu,{width:d,ref:u,borderLeft:"detail",shadow:"xl",className:p()(g.drawer,s),children:(0,i.tZ)(h.tu,{className:p()("drawer-scroll",g.container),bg:"primary",overflowY:"auto",shadow:"xl",children:o})})})})},f=e=>{let{children:t,isOpen:n}=e;return(0,i.tZ)(u.u.Root,{show:n,children:(0,i.tZ)(u.u.Child,{as:l.Fragment,enter:g.animation,enterFrom:g.offscreen,enterTo:g.onscreen,leave:g.animation,leaveFrom:g.onscreen,leaveTo:g.offscreen,children:t})})};var y=n(58175);let b=4716==n.j?{container:"container-H2Tu59"}:null,w=e=>{let{title:t,onClose:n}=e;return t||n?(0,i.tZ)(a.xu,{paddingX:{mobile:16,desktop:24},paddingTop:24,children:(0,i.BX)(h.gq,{alignItems:"center",justifyContent:"space-between",children:[t&&(0,i.tZ)(y.xv.H3,{weight:"bold",children:t}),n&&(0,i.tZ)(h.gq,{paddingLeft:12,alignItems:"center",children:(0,i.tZ)(s.hU,{size:"sm","aria-label":"Close",priority:"tertiary",onClick:n,children:(0,i.tZ)(o.Z,{"aria-hidden":"true"})})})]})}):null},Z=e=>{let{width:t=400,isOpen:n,children:o,title:s,onClose:l,primaryButton:d,secondaryButton:c,wrapperId:u,variant:m="overlay",className:p,drawerClassName:g}=e;return(0,i.tZ)(_,{className:g,includeTransition:"overlay"===m,width:t,isOpen:n,wrapperId:u,children:(0,i.BX)(r.w,{children:[(0,i.BX)(h.tu,{className:p,flex:"fill",overflowY:"auto",children:[(0,i.tZ)(w,{title:s,onClose:l}),(0,i.tZ)(a.xu,{className:b.container,paddingX:{desktop:24,mobile:16},paddingTop:s||l?24:0,children:o})]}),d&&(0,i.BX)(h.gq,{gap:8,padding:16,justifyContent:"end",borderY:"detail",children:[d,c]})]})})}},4796:function(e,t,n){"use strict";n.d(t,{z:()=>y});var i=n(16584),o=n(30396);if(4716==n.j)var r=n(32224);var a=n(98661),s=n(80569),l=n.n(s),d=n(95441),c=n(6400);let u=(e,t)=>{let n=new FileReader;n.onload=e=>{var n;t(null===(n=e.target)||void 0===n?void 0:n.result)},n.readAsText(e)};var m=n(68833),p=n(15771),h=n(61254),g=n(19081),v=n(44424),_=n(61468);let f=4716==n.j?[".txt",".srt",".vtt"]:null,y=e=>{let{postId:t,mediaUpload:n,transcription:s,onTranscriptionUploadStarted:y,onTranscriptionUploadCancelled:b,onTranscriptionUploadError:w,onTranscriptionUploaded:Z,disabled:C,setUploadedFile:x}=e,{iString:P}=(0,d.M1)(),[S,I]=(0,o.eJ)(!1),[k,N]=(0,o.eJ)(""),T=s&&"in_progress"===s.status,[E,R]=(0,o.eJ)(null),B=async e=>{if(R(e),null==y||y(),e.length>0&&e[0]){var i;x&&x(e[0]);let o=null!==(i=e[0].name.split(".").pop())&&void 0!==i?i:"";(0,m.j)(m.FP.TRANSCRIPTION_UPLOAD_FILE_STARTED,{post_id:t,audio_upload_id:null==n?void 0:n.id,type:o}),u(e[0],async t=>{N(t);let i=null,r={};try{if("txt"===o){var a;[i,r]=(0,_.kF)(t,null!==(a=null==n?void 0:n.duration)&&void 0!==a?a:0)}else"vtt"===o?[i,r]=(0,_.$h)(t):"srt"===o&&([i,r]=(0,_.$h)(t));let s=(0,_.ob)(i);if(i&&!s)await L(e[0],o,i,r);else{let e=P("Error validating transcription file"),t="".concat(e,": ").concat(s);console.error(t),null==w||w(t)}}catch(t){let e=P("Error parsing transcription file");console.error(e,t),null==w||w(e),x&&x(null)}finally{U()}})}},L=async(e,i,o,r)=>{let{body:a}=await l().post("/api/v1/drafts/".concat(t,"/upload_transcription/start")).send({speaker_map:r}),{originalTranscriptionFileKey:s,unalignedTranscriptionFileKey:d,alignedTranscriptionFileKey:c}=a;I(!0);try{var u;await l().put(s).send(e).set("Content-Type",e.type),await l().put(d).send(JSON.stringify(o)).set("Content-Type","application/json"),await l().put(c).send(JSON.stringify(null!==(u=null==o?void 0:o.segments)&&void 0!==u?u:[])).set("Content-Type","application/json"),await l().post("/api/v1/drafts/".concat(t,"/upload_transcription/complete")).send(),await l().post("/api/v1/drafts/".concat(t,"/realign_transcription")).send({edits:{}}).then(e=>{var o;(null===(o=e.body)||void 0===o?void 0:o.data)&&((0,m.j)(m.FP.TRANSCRIPTION_UPLOAD_FILE_COMPLETED,{post_id:t,audio_upload_id:null==n?void 0:n.id,type:i}),I(!1),Z(e.body.data),U())})}catch(e){(0,m.j)(m.FP.TRANSCRIPTION_UPLOAD_FILE_FAILED,{post_id:t,audio_upload_id:null==n?void 0:n.id,type:i}),console.error("File upload failed:",e),null==w||w(P("Error uploading transcription file"))}};(0,a.useEffect)(()=>{},[k]);let{openFileDialog:M,fileInputRef:D}=function(e){let{onFilesSelected:t}=e,n=(0,c.createRef)(),i=e=>{let n=e.target;n.files&&n.files.length>0&&t(n.files)};return(0,a.useEffect)(()=>{let e=n.current;if(e)return e.addEventListener("change",i),()=>{e.removeEventListener("change",i)}},[n]),{openFileDialog:()=>{var e;null===(e=n.current)||void 0===e||e.click()},fileInputRef:n}}({onFilesSelected:B}),{dropRef:A}=function(e){let{onFilesSelected:t}=e,[n,i]=(0,a.useState)(!1),o=(0,a.useRef)(null),r=e=>{e.preventDefault(),e.stopPropagation()},s=e=>{e.preventDefault(),e.stopPropagation(),i(!1)},l=e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&e.dataTransfer.items&&e.dataTransfer.items.length>0&&i(!0)},d=e=>{e.preventDefault(),e.stopPropagation(),i(!1),e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0&&(t(e.dataTransfer.files),e.dataTransfer.clearData())};return(0,a.useEffect)(()=>{let e=o.current;if(e)return e.addEventListener("dragenter",r),e.addEventListener("dragleave",s),e.addEventListener("dragover",l),e.addEventListener("drop",d),()=>{e.removeEventListener("dragenter",r),e.removeEventListener("dragleave",s),e.removeEventListener("dragover",l),e.removeEventListener("drop",d)}},[o]),{dropRef:o,dragging:n}}({onFilesSelected:B}),U=()=>{R(null),D.current&&(D.current.value=""),null==b||b()},j=null==E?void 0:E[0],X=e=>{(0,m.j)(m.FP.TRANSCRIPTION_UPLOAD_FILE_TYPE_CLICKED,{post_id:t,audio_upload_id:null==n?void 0:n.id,type:e}),D.current&&(D.current.accept=e,setTimeout(()=>M(),50))};return T?null:(0,i.BX)(g.tu,{gap:8,children:[!S&&(0,i.BX)(v.v2,{ref:A,layerOptions:{placement:"bottom-center"},onOpen:()=>{(0,m.j)(m.FP.TRANSCRIPTION_UPLOAD_FILE_CLICKED,{post_id:t,audio_upload_id:null==n?void 0:n.id})},trigger:(0,i.tZ)(p.zx,{disabled:C,priority:"secondary",leading:(0,i.tZ)(r.Z,{size:18}),children:P("Upload transcript")}),children:[(0,i.tZ)(v.sN,{onClick:()=>X(".txt"),children:P("Upload .txt file")}),(0,i.tZ)(h.iz,{}),(0,i.tZ)(v.sN,{onClick:()=>X(".vtt"),children:P("Upload .vtt file")}),(0,i.tZ)(h.iz,{}),(0,i.tZ)(v.sN,{onClick:()=>X(".srt"),children:P("Upload .srt file")})]}),j&&(0,i.tZ)(g.tu,{gap:8}),(0,i.tZ)("input",{type:"file",ref:D,style:{display:"none"},accept:f.join(",")})]})}},66067:function(e,t,n){"use strict";if(n.d(t,{B:()=>b,t:()=>w}),4716==n.j)var i=n(7409);if(4716==n.j)var o=n(99282);var r=n(16584),a=n(30396),s=n(23493),l=n.n(s),d=n(95441),c=n(28771),u=n(47921),m=n(82061),p=n(68833),h=n(93687),g=n(15771),v=n(19081),_=n(58175),f=n(87077);let y=l()((e,t)=>{e({mediaUploadId:null==t?void 0:t.id,duration:null==t?void 0:t.duration,mediaUpload:t})},1e3,{trailing:!1}),b=()=>{let{isDrawerOpen:e,setIsDrawerOpen:t,setPreventChange:n}=(0,c.M$)();return{isVideoEmbedDrawerOpen:e("videoEmbed"),setIsVideoEmbedDrawerOpen:e=>t((0,o._)((0,i._)({},e),{drawerId:"videoEmbed",variant:"overlay"})),setPreventChange:e=>n({preventChange:e,preventChangeMessage:"Please wait until the video is uploaded before closing the drawer."})}},w=e=>{let{id:t,editorDroppedFile:n,mediaUploadId:i,open:o,pub:s,postId:l,onSave:c,onClose:w,setPostId:Z}=e,[C,x]=(0,a.eJ)(null!=n?n:null),[P,S]=(0,a.eJ)(null),[I,k]=(0,a.eJ)(!1),{iString:N,language:T}=(0,d.M1)(),{setPreventChange:E}=b(),{mediaUpload:R,loading:B,error:L}=(0,h.z)({mediaUploadId:i});i&&!P&&R&&S(R),(0,a.d4)(()=>{x(n)},[n]);let M=()=>{(!I&&(null==P?void 0:P.state)!=="uploaded"&&(null==P?void 0:P.state)!=="transcoded"||confirm(N("Your video will be discarded, are you sure?")))&&((0,p.j)(p.FP.VIDEO_MODAL_CANCEL_CLICKED,{has_media_upload:!!P}),D())},D=()=>{S(null),x(null),w()},A=(null==P?void 0:P.state)!=="transcoded";return(0,r.BX)(u.n,{wrapperId:t,title:N("Embed video"),isOpen:o,onClose:M,primaryButton:(0,r.tZ)(f.u,{disabled:!A,text:N("Video needed"),children:(0,r.tZ)(g.zx,{priority:"primary",onClick:()=>{(0,p.j)(p.FP.VIDEO_MODAL_INSERT_CLICKED),y(c,P),D()},disabled:A,children:N("Insert")})}),secondaryButton:(0,r.tZ)(g.zx,{priority:"secondary-outline",onClick:M,children:N("Cancel")}),children:[L&&(0,r.tZ)(_.xv,{color:"error",children:L}),B?(0,r.tZ)("div",{children:N("Loading...")}):(0,r.BX)(r.HY,{children:[(0,r.tZ)(_.xv.B4,{paddingBottom:24,translated:!0,children:"Upload or record a video file embedded into the text."}),(0,r.BX)(v.tu,{padding:16,radius:"md",border:"detail",children:[(0,r.tZ)(_.xv.B2,{weight:"semibold",translated:!0,paddingBottom:16,children:"Create video"}),(0,r.tZ)(m.ZP,{language:T,initialFile:C,mediaType:"video",pub:s,videoFeature:"embed",postId:l,setPostId:Z,onChange:e=>{let{mediaUpload:t}=e;k(!1),S(t),x(null),E(!1)},onUploadStarted:()=>{E(!0),k(!0)},onUploadCanceled:()=>{k(!1),E(!1)},mediaUpload:P,mediaUploadId:null==P?void 0:P.id})]})]})]})}},21599:function(e,t,n){"use strict";n.d(t,{S2:()=>s,pW:()=>c,sK:()=>l});var i=n(48980),o=n(7882),r=n(98914);if(/^(3154|6909)$/.test(n.j))var a=n(26111);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=e||(0,a.x)("selection");let{isLoading:n,error:i,result:r}=(0,o.ib)({pathname:"/api/v1/post_selection/".concat(e),auto:!!e,deps:[e]});return{isLoading:n,error:i,postSelection:null!=r?r:null,highlightSelection:()=>{r&&d(r,t)}}}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=e||(0,a.x)("selection");let n=null;try{n=await (0,i.rd)("/api/v1/post_selection/".concat(e))}catch(e){console.error("could not fetch post selection",e)}n&&d(n,t)}function d(e){var t,n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(i.ignoreSafari&&(0,r.G6)()||!e.text)return;let o=(null!==(n=null===(t=/^[^.]+\./.exec(e.text))||void 0===t?void 0:t[0])&&void 0!==n?n:e.text).replace(/\.+$/g,"");if(!o)return;let a="#:~:text=".concat(encodeURIComponent(o));history.replaceState({},document.title,a),document.location.replace(a)}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=e||(0,a.x)("imgSelection");let n=null;try{n=(await (0,i.rd)("/api/v1/post_selection/image/".concat(e))).selection}catch(t){console.error("Couldn't find post image selection with id ".concat(e),t)}n&&function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(n.ignoreSafari&&(0,r.G6)())&&e.img_src){for(let n of document.getElementsByTagName("img"))if(n.src===e.img_src){t=n;return}t&&t.scrollIntoView()}}(n,t)}},32129:function(e,t,n){"use strict";n.r(t),n.d(t,{PostMetaTags:()=>p,getPageTitleAndMeta:()=>h,getPostMetaImage:()=>g,getPostMetaImageForTwitter:()=>v});var i=n(16584),o=n(32351),r=n(49762),a=n(2748);if(/^(3154|6909)$/.test(n.j))var s=n(93903);var l=n(6070),d=n(1835),c=n(60308),u=n(84864),m=n(93370);function p(e){var t,n;let r,a,{publication:s,post:l,clip:d,siteConfigs:u={},twitterCardUrl:p=null,isCommentPage:_=!1,selection:f=null,imgSelection:y=null}=e,b=(null==l?void 0:l.social_title)||(null==l?void 0:l.title)||s.name,{title:w,description:Z}=h(l,s,{isCommentPage:_}),C=null;p?(r=p,a=!0):f&&l?(r=(0,c.LLm)(s,l,f),a=!0):y&&l?(r=(0,c.cjA)(s,l,y),a=!0):([r,a]=g(s,l),C=v(s,l));let x=_&&l&&"thread"!==l.type&&0===l.comment_count||(null==l?void 0:l.type)==="restack";return(0,i.tZ)(o.Metadata,{title:w,socialTitle:d?"✂️ ".concat((0,m.UB)(null!==(t=d.duration)&&void 0!==t?t:0)," | ").concat(b):b,searchDescription:null==l?void 0:l.search_engine_description,description:Z,image:d&&null!==(n=(0,c.ow1)(d))&&void 0!==n?n:r,twitterImage:d?void 0:C,isLargeImage:a,imageHeight:f?564:void 0,imageWidth:f?1128:void 0,seoProps:{noindex:x,noarchive:!!(l&&l.post_paywall_content_for_google)},isPodcast:(null==l?void 0:l.type)==="podcast",isVideo:(null==l?void 0:l.type)==="video",slug:null==l?void 0:l.slug,pub:s,post:l,siteConfigs:u})}function h(e,t){var n,i;let o,l,c,{isCommentPage:m=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},p=(null==e?void 0:e.social_title)||(null==e?void 0:e.title)||t.name,h=(l=e?(0,u.getPrintedByline)(t,e):(0,r.default)("publication_author_display_override")||(null===(i=(0,d.Im)(t.contributors))||void 0===i?void 0:i.owner))&&!(null===(n=t.name)||void 0===n?void 0:n.toLowerCase().includes(null==l?void 0:l.toLowerCase()));return(null==e?void 0:e.title)?(o=(null==e?void 0:e.search_engine_title)||p,m&&"thread"!==e.type&&(o="Comments - ".concat(o)),"".concat(o," - by ").concat(l).length<60&&(l&&h&&(o+=" - by ".concat(l)),"".concat(o," - ").concat(t.name).length<60&&(o+=" - ".concat(t.name)))):o=h?"".concat(t.name," | ").concat(l," | Substack"):"".concat(t.name," | Substack"),c=e?(0,u.postSocialDescription)(e,t):(0,a.F)(t),{title:o,description:c=(0,s.Z)(c)}}function g(e,t){let n,i;return(null==t?void 0:t.cover_image)?(n=(0,c.zF4)(t.cover_image,1200,{height:600,smartCrop:!0,format:"jpg"}),i=!0):"numlock"===e.subdomain?(n=(0,c.zF4)("/img/numlock_square.png?v=2",840),i=!1):(n=(0,l.HD)({pub:e})?(0,c.zF4)("/img/thefp/thefp-preview-card.png",1200,{height:600,smartCrop:!0,format:"jpg",quality:"auto:best"}):(0,c.d54)(e),i=!0),[n,i]}function v(e,t){return(null==t?void 0:t.cover_image)?(0,c.h75)(e,t):null}},7392:function(e,t,n){"use strict";n.r(t),n.d(t,{MiniChatInbox:()=>tn});var i=n(16584),o=n(30396),r=n(56743),a=n(68833),s=n(98914),l=n(80026),d=n(40225),c=n(7409),u=n(99282),m=n(98848),p=n(39693),h=n.n(p),g=n(47976),v=n(51534),_=n(45530),f=n(5772),y=n(95441),b=n(60807),w=n(80878),Z=n(7882),C=n(61254),x=n(10510),P=n(69891),S=n(55533),I=n(94874),k=n(43570),N=n(71460),T=n(94184),E=n.n(T),R=n(71068),B=n(19081),L=n(36889),M=n(44854);function D(e){var{isSelected:t,className:n}=e,o=(0,m._)(e,["isSelected","className"]);return(0,i.tZ)(B.sg,{children:(0,i.tZ)(B.gq,(0,c._)({className:E()(M.Z.chatPublication,n,t&&M.Z.selected),as:"a",alignItems:"center",position:"relative",gap:12,paddingY:12,paddingX:16,href:o.href,target:"_blank",rel:"noopener noreferrer",hover:!0,userSelect:"none"},o))})}let A=(0,R.E7)({display:"flex",direction:"column",flex:"grow",minWidth:0,gap:2,alignSelf:"start",justifyContent:"start"});function U(e){let{unread:t,children:n}=e;return(0,i.tZ)(l.xv.B4,{display:"flex",color:t?"primary":"secondary",children:(0,i.tZ)(l.xv,{as:"span",ellipsis:!0,minWidth:0,children:n})})}function j(e){var t;let{comment:n,outgoing:o,link:r,fallbackText:a}=e;if(n.reported_by_user)return(0,i.tZ)("em",{children:"You reported this thread."});let{media_uploads:s}=n,l=(null==s?void 0:s.length)||0,d=null!==(t=null==n?void 0:n.body)&&void 0!==t?t:void 0,c=o?"You: ":"";return n||(c="New conversation"),r&&(d?c+="\uD83D\uDD17 ".concat(d):r?c+="\uD83D\uDD17 ".concat(r):c+="\uD83D\uDD17 Link"),s&&(d?c+="\uD83D\uDCF8 ".concat(d):l>1?c+="\uD83D\uDCF8  ".concat(l," Images"):c+="\uD83D\uDCF8 Image"),s||r||(d?c+=d:c+=a),(0,i.tZ)(i.HY,{children:c})}function X(){return(0,i.tZ)(B.sg,{padding:12,gap:8,children:Array(8).fill(0).map(()=>(0,i.tZ)(O,{}))})}function O(){return(0,i.BX)(B.X2,{gap:12,padding:8,alignItems:"center",children:[(0,i.tZ)(L.V,{type:"circle",size:48}),(0,i.BX)(B.sg,{gap:8,flex:"grow",children:[(0,i.tZ)(L.V,{type:"bar",maxWidth:"".concat(50*Math.random()+50,"%")}),(0,i.tZ)(L.V,{type:"bar",maxWidth:"".concat(25*Math.random()+25,"%")})]})]})}var F=n(64515);let H=e=>{var{size:t=24,color:n="var(--color-fg-primary)"}=e,o=(0,m._)(e,["size","color"]);return(0,i.tZ)(F.l,(0,u._)((0,c._)({},o),{name:"SkinnyPinIcon",svgParams:{viewBox:"0 0 24 24"},stroke:"none",width:t,height:t,fill:n,children:(0,i.tZ)("path",{d:"M4 14.8571C4 15.7323 4.58687 16.3089 5.51351 16.3089H11.0836V21.117C11.0836 22.6924 11.7426 24 12 24C12.2471 24 12.906 22.6924 12.906 21.117V16.3089H18.4762C19.4028 16.3089 19.9896 15.7323 19.9896 14.8571C19.9896 12.6847 18.2497 10.3887 15.3565 9.33849L15.0167 4.6126C16.5199 3.75804 17.7554 2.79021 18.2908 2.10038C18.5585 1.75032 18.6924 1.40025 18.6924 1.09137C18.6924 0.463323 18.2085 0 17.4878 0H6.51222C5.7812 0 5.30759 0.463323 5.30759 1.09137C5.30759 1.40025 5.43115 1.75032 5.69883 2.10038C6.23423 2.79021 7.46975 3.75804 8.97296 4.6126L8.6332 9.33849C5.74002 10.3887 4 12.6847 4 14.8571Z"})}))};function z(){return(0,i.tZ)(H,{size:12,color:"var(--color-fg-secondary)"})}var q=n(98661);let V=(0,q.createContext)("unknown");function J(){return(0,q.useContext)(V)}var W=n(31541),Y=n(98012),K=n(62515);function G(e){var t,n,o;let{item:r,onSelect:s,isSelected:d,isUnread:c,tab:u}=e,m=J(),p=(0,b.aF)(),h=null===(t=r.messageThread.members.find(e=>e.user_id!==(null==p?void 0:p.id)))||void 0===t?void 0:t.user;if(!h)return console.error("No member for DM conversation ".concat(r.messageThread.id)),null;let{recentMessage:g}=r,v=g&&(null===(n=r.messageThread.members.find(e=>g.comment.user_id===e.user_id))||void 0===n?void 0:n.user);return(0,i.BX)(D,{isSelected:d,onClick:e=>{let t=r.messageThread.id;(0,a.j)(a.FP.CHAT_INBOX_CONVERSATION_CLICKED,{surface:m,tab:u,type:"dm",conversation_id:t}),s(t,e)},href:(0,K.Rm)(r.messageThread.id),children:[c&&(0,i.tZ)(W.in,{className:M.Z.unreadDot}),(0,i.tZ)(I.qE,{user:h,size:56}),(0,i.BX)(A,{children:[(0,i.BX)(l.X2,{alignItems:"center",gap:8,children:[(0,i.BX)(l.X2,{gap:12,flex:"grow",children:[(0,i.tZ)(l.xv.B3,{weight:"medium",ellipsis:!0,children:h.name}),h.bestseller_tier?(0,i.tZ)(N.UserBadge,{inline:!0,tier:h.bestseller_tier,size:"sm",tooltipOnHover:!0,userId:h.id}):null,"requests"===u&&(0,i.tZ)($,{item:r})]}),(null==g?void 0:g.comment)&&(0,i.tZ)(l.xv.B5,{color:"secondary",children:(0,Y.Z)(g.comment.created_at).chatTime()}),r.isPinned&&(0,i.tZ)(z,{})]}),g&&(0,i.tZ)(U,{unread:c,children:(0,i.tZ)(j,{comment:g.comment,link:null===(o=g.link_metadata)||void 0===o?void 0:o.title,outgoing:(null==v?void 0:v.id)===(null==p?void 0:p.id),fallbackText:r.subtitleBody})})]})]})}function $(e){let{item:t}=e,{iString:n}=(0,y.M1)(),{subscriberContext:o}=t,r=null==o?void 0:o.membershipState,a=r&&["free_signup","subscribed"].includes(r);return o&&a?(0,i.tZ)(k.Vp,{theme:"subscribed"===r?"paid":"default",children:n(o.isFounding?"Founding":"subscribed"===r?"Paid":"Free")}):null}var Q=n(48980);let ee=function(){let{before:e,tab:t="all"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async n=>{try{var i,o;let r=await (0,Q.rd)("/api/v1/messages/inbox",{query:{paginate:"true",tab:t,before:e}});n({type:"inbox-new_items",payload:{threads:null==r?void 0:r.threads,hasMore:null==r?void 0:r.more,directMessagesUnreadCount:null==r?void 0:r.directMessagesUnreadCount,pendingInviteCount:null==r?void 0:r.pendingInviteCount,pendingInviteUnreadCount:null!==(i=null==r?void 0:r.pendingInviteUnreadCount)&&void 0!==i?i:null==r?void 0:r.pendingInviteCount,pubChatUnreadCount:null!==(o=null==r?void 0:r.pubChatUnreadCount)&&void 0!==o?o:0,mostRecentChatTimestamp:r.mostRecentChatTimestamp}})}catch(e){if(console.warn("error",e),e instanceof Q.kp)n({type:"inbox-new_error",payload:{error:e}});else throw e}}},et=e=>async t=>{"direct-message"===e&&t(ee({tab:"people"})),t({type:"inbox-set_filter",payload:e})};function en(e){return"direct-message"===e?"people":"all"}var ei=n(67358),eo=n(85200),er=n(5281),ea=n(63018),es=n(44424),el=n(97842),ed=n(60308);function ec(e){var t;let{onClick:n}=e,o=(0,el.RN)();return o.inbox.pendingInviteCount?(0,i.tZ)(l.sg,{className:E()(M.Z.invitesRow),children:(0,i.BX)(D,{onClick:n,children:[(null!==(t=o.inbox.pendingInviteUnreadCount)&&void 0!==t?t:0)>0&&(0,i.tZ)(W.in,{className:M.Z.unreadDot}),(0,i.tZ)(l.X2,{width:56,justifyContent:"center",alignItems:"center",children:(0,i.tZ)(ei.Z,{size:20})}),(0,i.tZ)(A,{children:(0,i.BX)(l.X2,{justifyContent:"space-between",alignItems:"center",children:[(0,i.tZ)(l.xv.B3,{weight:"semibold",translated:!0,children:"Requests"}),(0,i.tZ)(l.xv.B4,{color:"secondary",flex:"auto"})]})})]})}):null}function eu(){return(0,i.tZ)(es.v2,{trigger:(0,i.tZ)(l.hU,{"aria-label":"View more",priority:"tertiary",children:(0,i.tZ)(eo.Z,{size:20})}),children:(0,i.tZ)(es.sN,{href:(0,ed.v3t)({section:"privacy"}),target:"_blank",leading:(0,i.tZ)(er.Z,{}),children:(0,i.tZ)(l.xv.B3,{weight:"semibold",children:"Messaging settings"})})})}function em(e){let{error:t,items:n,isLoading:r,selectedConversationId:s,onSelect:d}=e,c=J(),{refetch:u}=(0,Z.ib)({pathname:"/api/v1/messages/inbox/invites/seen",method:"POST",auto:!1});return(0,o.d4)(()=>{r||(u(),(0,a.j)(a.FP.DIRECT_MESSAGE_REQUESTS_VIEWED,{pending_conversation_requests:n.length,surface:c}))},[r]),(0,i.tZ)(i.HY,{children:t?(0,i.tZ)(i.HY,{children:"'Error'"}):r?(0,i.tZ)(X,{}):(0,i.tZ)(l.sg,{paddingY:12,gap:8,flex:"grow",children:n.length?n.map(e=>(0,i.tZ)(G,{item:e,onSelect:(t,n)=>d(e.messageThread.id,n),isUnread:!e.lastViewedAt,isSelected:s===e.messageThread.id,tab:"requests"},e.id)):(0,i.tZ)(ep,{})})})}function ep(e){let{spam:t}=e;return(0,i.tZ)(l.sg,{flex:"grow",justifyContent:"center",alignItems:"center",sizing:"border-box",children:(0,i.tZ)(S.vJ,{title:t?"No spam requests yet":"No requests yet",body:t?"Message requests that may be low-quality or unwanted will appear here.":"Control whose messages arrive as requests in your Settings.",children:!t&&(0,i.tZ)(l.zx,{priority:"primary-mono",href:(0,ed.v3t)({section:"privacy"}),newTab:!0,size:"sm",children:"Go to Settings"})})})}var eh=n(10928),eg=n.n(eh);function ev(e,t){var n;let i;let o=e.conversations.get(t.messageThreadId),r=t.recentMessageId?e.communityComments.get(t.recentMessageId):null,a=eg()(null!==(n=null==o?void 0:o.replyIds)&&void 0!==n?n:[]),s=a?e.communityComments.get(a):null;return r?s?r.comment.created_at>s.comment.created_at?r:s:r:s}n(27484),n(43174),n(89734),n(56232),n(83034),n(12936),n(42694),n(20160),n(83320),n(87698),n(89320),n(9997),n(28161),n(78327),n(45985),n(12757),n(98585),n(36518),n(85095),n(40647),n(49762);var e_=n(9682);n(15771),n(84370),n(91246),n(78096),n(58175),n(70379),n(87077),n(78118),n(74949),n(83010),n(50312),n(78718);var ef=n(91400),ey=n(88817);n(75419),n(50167),n(65575),n(86657),n(56219),n(14293),n(2689),n(9970),n(20888),n(63474),n(2009),n(5623);var eb=n(63651),ew=n(84864);(0,R.zo)({display:"flex",direction:"row",flex:"grow",alignItems:"center",justifyContent:"space-between",paddingX:8,gap:16}),n(44312),n(41233);var eZ=n(64172);function eC(e){return(0,i.tZ)(l.hU,(0,u._)((0,c._)({priority:"tertiary"},e),{children:(0,i.tZ)(g.Z,{size:20})}))}function ex(e){var t;let{filteredItems:n,inboxItems:r,onSelectInvites:s,onSelectPub:d,onSelectConversation:c,activePub:u,activeConversationId:m}=e,p=(0,b.aF)(),h=J(),g=(0,el.I0)(),v=(0,el.RN)(),{inbox:{filter:_}}=v,{isLoading:f}=v.inbox.resources[en(_)],{requireLogin:y}=(0,ey.SJ)(),{refetch:w}=(0,Z.ib)({pathname:"/api/v1/messages/inbox/seen",method:"POST",auto:!1}),C=u&&v.publications.get(u);(0,o.d4)(()=>{f||((0,a.j)(a.FP.THREADS_INBOX_SCREEN_VIEWED,{unread_count:r.filter(e=>eI(e)).length,thread_count:r.length,tab:_,surface:h}),w())},[f,_]);let x=!r.find(e=>"chat"===e.type?e.publication.id===u:e.messageThreadId===m)&&C?(0,i.tZ)(eS,{item:{id:"chat-".concat(C.id),type:"chat",publication:C,lastViewedAt:null,communityPostId:null,timestamp:null,communityPost:null,user:null,isOwned:!1,isCurrentUserAuthor:!1,title:C.name,paywallStatus:{is_allowed_access:!1,paywall_error:"UNAUTHORIZED"}},onSelect:()=>{},isSelected:!0,isUnread:!1}):null;return(0,i.tZ)(i.HY,{children:p&&f?(0,i.tZ)(X,{}):n.length>0||v.inbox.pendingInviteUnreadCount?(0,i.BX)(eN,{children:[(0,i.tZ)(ec,{onClick:s}),x,n.map(e=>"chat"===e.type?(0,i.tZ)(eS,{item:e,onSelect:d,isSelected:u===e.publication.id,isUnread:eI(e)},e.publication.id):(0,i.tZ)(G,{item:e,onSelect:c,isSelected:m===e.messageThread.id,isUnread:eI(e),tab:_},e.messageThread.id))]}):r.length>0?(0,i.tZ)(l.sg,{paddingTop:8,children:(0,i.tZ)(l.sg,{justifyContent:"center",alignItems:"center",flex:"fill",padding:32,children:(0,i.tZ)(S.ld,{title:"No chats found",body:"Please try again with a different search term."})})}):x?(0,i.tZ)(eN,{children:x}):(0,i.tZ)(l.sg,{justifyContent:"center",alignItems:"center",flex:"grow",paddingX:32,children:"chat"===_?(0,i.tZ)(S.vJ,{title:"You don’t have any threads",body:"When one of your subscriptions starts a new thread, it will appear here."}):"direct-message"===_?(0,i.tZ)(S.vJ,{title:"You don’t have any direct messages",body:"When someone sends you one, it will appear here."}):"unread"===_?(0,i.tZ)(S.vJ,{title:"You don’t have any unread messages",body:"When someone sends you one, it will appear here.",children:(0,i.tZ)(l.zx,{priority:"primary-mono",size:"sm",onClick:()=>g({type:"inbox-set_filter",payload:"all"}),children:"Clear filter"})}):(0,i.tZ)(S.vJ,{title:"No messages yet",body:"Send a message to get started.",children:(0,i.tZ)(l.zx,{priority:"primary-mono",size:"sm",href:"/chat/new",onClick:null!==(t=y?e=>{e.preventDefault(),y()}:null)&&void 0!==t?t:void 0,children:"Send message"})})})})}function eP(e){var{inboxItems:t}=e,n=(0,m._)(e,["inboxItems"]);let{iString:o}=(0,y.M1)(),r=(0,el.I0)(),{inbox:{filter:a}}=(0,el.RN)(),s=h()([{value:"all",label:o("All")},{value:"direct-message",label:o("Direct"),isUnread:t.filter(e=>"direct-message"===e.type&&eI(e)).length>0},{value:"unread",label:o("Unread")}]);return(0,i.tZ)(l.sg,{flex:"auto",style:{position:"sticky",top:0},bg:"primary",zIndex:1,children:(0,i.tZ)(P.n,(0,c._)({value:a,tabs:s.map(e=>{let{value:t,label:n,isUnread:o}=e;return{value:t,label:n,trailingIcon:o?(0,i.tZ)(W.in,{className:M.Z.unreadTabDot}):null}}),onChange:e=>{(0,w._)("/chat"),r(et(e))},ariaLabel:o("Select filter")},n))})}function eS(e){var t,n,o;let{item:r,onSelect:s,isSelected:d,isUnread:c}=e,u=J(),m=(0,b.aF)(),p=(null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.id)===(null==m?void 0:m.id)?"You":null==r?void 0:null===(n=r.user)||void 0===n?void 0:n.name,{filter:h}=(0,el.RN)().inbox,g="free"!==r.publication.paywall_chat,f=null===(o=r.paywallStatus)||void 0===o?void 0:o.is_allowed_access;return(0,i.BX)(i.HY,{children:[(0,i.BX)(D,{isSelected:d,onClick:e=>{(0,a.j)(a.FP.CHAT_INBOX_CONVERSATION_CLICKED,{type:"publication",publication_id:r.publication.id,tab:h,surface:u}),s(r.publication.id,e)},href:(0,eb.xC8)({pubId:r.publication.id}),children:[c&&(0,i.tZ)(W.in,{className:M.Z.unreadDot}),(0,i.tZ)(x.wk,{pub:r.publication,size:56,radius:"md",bg:"unset"}),(0,i.BX)(A,{children:[(0,i.BX)(l.X2,{justifyContent:"space-between",alignItems:"center",gap:8,children:[(0,i.tZ)(l.xv.B3,{className:M.Z.sidebarRowTitle,weight:"semibold",ellipsis:!0,children:r.title||r.publication.name}),r.communityPost&&(0,i.tZ)(l.xv.B5,{color:"secondary",weight:"regular",children:(0,Y.Z)(r.communityPost.created_at).chatTime()}),g&&!f&&(0,i.tZ)(v.Z,{size:12,color:"var(--color-fg-secondary)"}),g&&f&&(0,i.tZ)(_.Z,{size:12,color:"var(--color-fg-secondary)"}),r.isPinned&&(0,i.tZ)(z,{})]}),r.communityPost?(0,i.BX)(U,{unread:c,children:[p&&"".concat((0,ew.guessFirstName)(p),": "),(0,i.tZ)(ek,{post:r.communityPost})]}):r.paywallStatus&&!r.paywallStatus.is_allowed_access?(0,i.tZ)(eT,{paywallStatus:r.paywallStatus}):(0,i.tZ)(U,{children:(0,i.tZ)(l.xv,{fontStyle:"italic",children:"Click here to start your subscriber chat"})})]})]}),r.isPrimary?(0,i.tZ)(C.iz,{}):null]})}function eI(e){var t;if("chat"===e.type&&(e.paywallStatus&&!e.paywallStatus.is_allowed_access||!e.publication.threads_v2_enabled||!e.communityPost||e.isCurrentUserAuthor))return!1;let{lastViewedAt:n}=e;if(!n)return!0;let i="chat"===e.type?null===(t=e.communityPost)||void 0===t?void 0:t.created_at:e.timestamp;return!!i&&i>n}function ek(e){var t,n,o,r;let{post:a}=e,{iPlural:s}=(0,y.M1)(),{isPaid:l,isFounding:d,isAuthor:c}=(0,eZ.Y0)(a.publication_id);return a.link_url?(0,i.tZ)(i.HY,{children:a.body?"\uD83D\uDD17 ".concat(a.body):(null===(n=a.link_metadata)||void 0===n?void 0:n.title)?"\uD83D\uDD17 ".concat(null===(o=a.link_metadata)||void 0===o?void 0:o.title):"\uD83D\uDD17 ".concat(null===(r=a.link_metadata)||void 0===r?void 0:r.url)}):a.media_assets&&a.media_assets.length>0?(0,i.tZ)(i.HY,{children:a.body?"\uD83D\uDCF8 ".concat(a.body):s("\uD83D\uDCF8 Image","\uD83D\uDCF8 %1 Images",a.media_assets.length)}):(null==a?void 0:null===(t=a.threadMediaUploads)||void 0===t?void 0:t.length)?(0,i.tZ)(i.HY,{children:a.body?"▶ ".concat(a.body):s("▶ Video","▶ %1 Videos",null==a?void 0:a.threadMediaUploads.length)}):a.body?(0,i.tZ)(i.HY,{children:a.body}):d||c||"only_founding"!==a.audience?l||d||c||"only_paid"!==a.audience?(0,i.tZ)(i.HY,{children:a.body}):(0,i.tZ)(i.HY,{children:"\uD83D\uDD12 Paid subscriber thread"}):(0,i.tZ)(i.HY,{children:"\uD83D\uDD12 Founding member thread"})}n(20521),n(33884),n(70293);let eN=(0,l.E7)({display:"flex",direction:"column"});function eT(e){let{paywallStatus:t}=e,{iString:n}=(0,y.M1)(),{paywall_error:o}=t,r=n("FOUNDING_SUBSCRIPTION_REQUIRED"===o?"Founding members only":"PAID_SUBSCRIPTION_REQUIRED"===o?"Paid subscribers only":"Subscribers only");return(0,i.BX)(l.X2,{alignItems:"center",gap:4,children:[(0,i.tZ)(v.Z,{size:12,color:"var(--color-fg-secondary)"}),(0,i.tZ)(U,{children:r})]})}var eE=n(44908),eR=n.n(eE),eB=n(45578),eL=n.n(eB),eM=n(69241),eD=n(12765);let eA=e=>async t=>{let n="before";t({type:"conversation-request_initial",payload:{conversationId:e}});try{let i=await (0,Q.rd)("/api/v1/messages/dm/".concat(e));t({type:"conversation-load_more",payload:{edge:n,cursor:null,page:i}})}catch(i){t({type:"conversation-request_error",payload:{conversationId:e,edge:n,cursor:null,error:i}})}};var eU=n(92039),ej=n(17440);function eX(e){let{children:t,surface:n}=e,{user:r,userSettings:a}=(0,b.SE)(),s=a.newest_seen_chat_item_published_at,[{path:l}]=(0,e_.tv)(),d=(0,ef.XA)(),m=(0,eU.rG)(),p=(0,eU.m)(),[h,g]=(0,eD.L)(eq,(0,u._)((0,c._)({},el.UX),{user:r,users:new Map(r?[[r.id,r]]:[])}));(0,el.WG)({auto:!!r},{onSuccess:e=>{g({type:"inbox-unread_count",payload:e})}});let v=(0,o.sO)(0);return(0,o.d4)(()=>{if(m&&r)return m.listen({["user:".concat(r.id)]:e=>{let{data:t}=e;if(null==t?void 0:t.message){let{message:e}=t;"dms:new-message"===e.type||"dms:updated-message"===e.type?g(e3(e)):"chat:updated-post"===e.type?g(te(e)):"chat:new-post"===e.type&&g(tt(e))}}})},[m]),(0,o.d4)(()=>{"open"===p&&r&&g(ee())},[p]),(0,o.d4)(()=>{if("open"!==p){let e;let t=()=>{let e=Date.now(),{visibilityState:t="visible"}=document;r&&e-v.current>5e3&&"hidden"!==t&&(v.current=e,g(ee()))},n=()=>{t(),e=setTimeout(n,3e4+Math.floor(2e3*Math.random()))},i=function(e){let t=0,n=()=>{let{visibilityState:n="visible"}=document,i=Date.now();"hidden"!==n&&i-t>2e3&&(e(),t=i)};return window.addEventListener("online",n),document.addEventListener("visibilitychange",n),window.addEventListener("focus",n),()=>{window.removeEventListener("online",n),document.removeEventListener("visibilitychange",n),window.removeEventListener("focus",n)}}(t);return l.startsWith("/chat")&&!d?n():t(),()=>{e&&clearTimeout(e),i()}}},[s,l,d,g,p]),(0,i.tZ)(V.Provider,{value:n,children:(0,i.tZ)(el.ge.Provider,{value:g,children:(0,i.tZ)(el.ky.Provider,{value:h,children:t})})})}let eO={before:{isLoading:!1,hasMore:!1,error:null},after:{isLoading:!1,hasMore:!1,error:null},posts:[],publication:null,muteStatus:void 0,isLoaded:!1},eF={isLoading:!1,hasMore:!1,error:null},eH={before:{isLoading:!0,cursor:null,error:null},after:{isLoading:!1,cursor:null,error:null},replyIds:[]},ez={before:eF,after:(0,u._)((0,c._)({},eF),{isLoading:!0}),target:null,lastViewedAt:null,order:"asc",comments:[],isLoaded:!1};function eq(e,t){return t.type.startsWith("publications-")?function(e,t){if("publications-set"===t.type){var n;let i=t.payload,o=null!==(n=e.chats.get(i.id))&&void 0!==n?n:eO;return(0,u._)((0,c._)({},e),{chats:(0,ej.Rg)(e.chats,i.id,(0,u._)((0,c._)({},o),{publication:i})),publications:(0,ej.Rg)(e.publications,i.id,i)})}return e}(e,t):t.type.startsWith("inbox-")?function(e,t){switch(t.type){case"inbox-new_items":{let{threads:n,hasMore:i,directMessagesUnreadCount:o,pendingInviteCount:r,pendingInviteUnreadCount:a,mostRecentChatTimestamp:s}=t.payload,l=(0,u._)((0,c._)({},e),{users:new Map([...e.users,...n.flatMap(e=>"chat"===e.type?e.user?[e.user]:[]:e.messageThread.members.map(e=>e.user)).map(e=>[e.id,e])]),communityPosts:new Map([...e.communityPosts,...h()(n.map(e=>"chat"===e.type&&e.communityPost?[e.communityPost.id,{communityPost:e.communityPost,pubRole:null,isNew:!1}]:null))]),communityComments:new Map([...e.communityComments,...h()(n.map(t=>{if("direct-message"===t.type&&t.recentMessage){var n;let{recentMessage:i}=t,{id:o}=i;return[i.id,(0,u._)((0,c._)({},e.communityComments.get(o)),{comment:i,userId:i.user_id,quoteId:null!==(n=i.quote_id)&&void 0!==n?n:void 0,isNew:!1})]}}))]),chats:new Map([...e.chats,...h()(n.map(t=>{if("chat"===t.type&&t.publication){var n;let i=null!==(n=e.chats.get(t.publication.id))&&void 0!==n?n:eO;return[t.publication.id,(0,u._)((0,c._)({},i),{publication:t.publication,muteStatus:t.muteStatus,isPinned:t.isPinned})]}return null}))]),conversations:new Map([...e.conversations,...h()(n.map(t=>{if("direct-message"===t.type){let n=e.conversations.get(t.messageThread.id);return[t.messageThread.id,(0,u._)((0,c._)({},eH,n),{thread:t.messageThread})]}}))])}),d=n.map((t,n)=>{var i,o,r,a,s,l,d,m;return"chat"===t.type?(0,u._)((0,c._)({},t),{communityPostId:null!==(l=null===(i=t.communityPost)||void 0===i?void 0:i.id)&&void 0!==l?l:null,muteStatus:null!==(d=t.muteStatus)&&void 0!==d?d:{is_muted:!1,expires_at:null},isPrimary:0===n&&0===e.inbox.threads.size&&t.publication.id===(null===(r=e.user)||void 0===r?void 0:null===(o=r.primary_publication)||void 0===o?void 0:o.id)||(null===(a=e.inbox.threads.get(t.id))||void 0===a?void 0:a.isPrimary)}):(0,u._)((0,c._)({},t),{messageThreadId:t.messageThread.id,recentMessageId:null!==(m=null===(s=t.recentMessage)||void 0===s?void 0:s.id)&&void 0!==m?m:null,isPrimary:!1})}),m=e7(d),p=(0,ej.zg)(e.inbox.threads,d,e=>e.id),g=e7([...p.values()]),{filter:v}=e.inbox,_=en(v);return eG((0,u._)((0,c._)({},l),{inbox:(0,u._)((0,c._)({},e.inbox),{resources:(0,u._)((0,c._)({},e.inbox.resources),{[_]:{hasMore:i&&m===g,isLoading:!1}}),threads:p,directMessagesUnreadCount:o,pendingInviteCount:r,pendingInviteUnreadCount:a,mostRecentChatTimestamp:s})}))}case"inbox-pin":{let{itemId:n,isPinned:i}=t.payload;return eG((0,u._)((0,c._)({},e),{inbox:(0,u._)((0,c._)({},e.inbox),{threads:(0,ej.F5)(e.inbox.threads,n,{isPinned:i})})}))}case"inbox-mark_viewed":{let{itemId:n}=t.payload;return(0,u._)((0,c._)({},e),{inbox:(0,u._)((0,c._)({},e.inbox),{threads:(0,ej.F5)(e.inbox.threads,n,{lastViewedAt:new Date().toISOString()})})})}case"inbox-set_filter":return(0,u._)((0,c._)({},e),{inbox:(0,u._)((0,c._)({},e.inbox),{filter:t.payload})});case"inbox-unread_count":{let{unreadCount:n,pendingInviteCount:i,pendingInviteUnreadCount:o,pubChatUnreadCount:r}=t.payload;return(0,u._)((0,c._)({},e),{inbox:(0,u._)((0,c._)({},e.inbox),{directMessagesUnreadCount:n,pendingInviteCount:i,pendingInviteUnreadCount:o,pubChatUnreadCount:r})})}case"inbox-new_error":return(0,u._)((0,c._)({},e),{inbox:(0,u._)((0,c._)({},e.inbox),{resources:(0,u._)((0,c._)({},e.inbox.resources),{[en(e.inbox.filter)]:{error:t.payload.error}})})});default:return e}}(e,t):t.type.startsWith("pub_chat-")?function(e,t){switch(t.type){case"pub_chat-mute":{let{expires_at:n,pubId:i}=t.payload;return eG((0,u._)((0,c._)({},e),{inbox:(0,u._)((0,c._)({},e.inbox),{threads:(0,ej.FN)(e.inbox.threads,e1(i),e=>(0,u._)((0,c._)({},e),{muteStatus:{is_muted:!0,expires_at:n}}))})}))}case"pub_chat-unmute":{let{pubId:n}=t.payload;return eG((0,u._)((0,c._)({},e),{inbox:(0,u._)((0,c._)({},e.inbox),{threads:(0,ej.FN)(e.inbox.threads,e1(n),e=>(0,u._)((0,c._)({},e),{muteStatus:{is_muted:!1,expires_at:null}}))})}))}case"pub_chat-leave":{let n=t.payload,i=e1(n.id);return(0,u._)((0,c._)({},e),{chats:(0,ej.i4)(e.chats,n.id),inbox:(0,u._)((0,c._)({},e.inbox),{threads:(0,ej.i4)(e.inbox.threads,e1(n.id)),threadList:e.inbox.threadList.filter(e=>e!==i)})})}case"pub_chat-join":{let n=t.payload;e1(n.id);let i=(0,ej.Rg)(e.inbox.threads,e1(n.id),{id:e1(n.id),type:"chat",publication:n,communityPostId:null,lastViewedAt:new Date().toISOString(),timestamp:null});return(0,c._)({},eG((0,u._)((0,c._)({},e),{inbox:(0,u._)((0,c._)({},e.inbox),{threads:i}),chats:(0,ej.FN)(e.chats,n.id,e=>(0,u._)((0,c._)({},e),{muteStatus:{is_muted:!1}})),publications:(0,ej.Rg)(e.publications,n.id,n)})))}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("conversation-")?function(e,t){var n,i;switch(t.type){case"conversation-request_initial":{let{conversationId:n}=t.payload,i=e.conversations.get(n);if(i&&i.replyIds.length>0)return e;return(0,u._)((0,c._)({},e),{conversations:(0,ej.Rg)(e.conversations,n,(0,c._)({},i,eH))})}case"conversation-delete":{let{conversationId:n}=t.payload;new Map(e.conversations).delete(n);let i=e4(n);return(0,u._)((0,c._)({},e),{conversations:(0,ej.i4)(e.conversations,n),inbox:(0,u._)((0,c._)({},e.inbox),{threads:(0,ej.i4)(e.inbox.threads,i),threadList:e.inbox.threadList.filter(e=>e!==i)})})}case"conversation-request_error":{let{conversationId:n,cursor:i,edge:o,error:r}=t.payload,a=e.conversations.get(n);if(!a)return console.error("Attempting to set an error on missing conversation"),e;if(a[o].cursor!==i)return console.warn("Attempting to set an error on a missing cursor. Ignoring."),e;return(0,u._)((0,c._)({},e),{conversations:(0,ej.Rg)(e.conversations,n,(0,u._)((0,c._)({},a),{[o]:{isLoading:!1,cursor:i,error:r}}))})}case"conversation-load_more":{let i;let{edge:o,cursor:r,page:{thread:a,replies:s,publications:l,comments:d,pastCursor:m,futureCursor:p,profile:g,subscriberContext:v}}=t.payload,_=s.map(e=>e.comment.id),f=new Set(_),y=e.conversations.get(a.id);if(!y)return console.error("Attempting to load messages for missing conversation"),e;if(y[o].cursor!==r)return console.warn("Attempting to load messages for an old cursor. Ignoring."),e;let b=y.replyIds.filter(e=>!f.has(e));b="before"===o?_.concat(b):b.concat(_),i=r?{[o]:{isLoading:!1,cursor:"before"===o?m:p,error:null}}:{before:{isLoading:!1,cursor:m,error:null},after:{isLoading:!1,cursor:p,error:null}};let w=(0,u._)((0,c._)({},y,i),{thread:a,replyIds:b}),Z=g&&(null===(n=a.members.find(e=>e.user_id===g.id))||void 0===n?void 0:n.user),C=(0,u._)((0,c._)({},e),{conversations:(0,ej.Rg)(e.conversations,a.id,w),communityComments:e9(e.communityComments,s.flatMap(e=>h()([e,e.quote]).map(e2)),e=>e.comment.id,e=>e.comment.created_at),users:(0,ej.zg)(e.users,s.flatMap(e=>{var t;return h()([e.user,null===(t=e.quote)||void 0===t?void 0:t.user])}),e=>e.id),profiles:g?(0,ej.Rg)(e.profiles,g.id,(0,u._)((0,c._)({},Z,g),{subscriberContext:v})):e.profiles,publications:l?(0,ej.zg)(e.publications,l,e=>e.id):e.publications,notes:d?(0,ej.zg)(e.notes,d,e=>"c-".concat(e.id)):e.notes});if("after"===o||!r)return eY(C,a.id,null);return C}case"conversation-comments-new":{let{conversationId:n,linkUrl:o,quoteReply:r}=t.payload,a=e.conversations.get(n);if(!a)throw Error("Attempted to post message to missing conversation");let l={comment:(0,u._)((0,c._)({},eW(e,t.payload)),{quote_id:null!==(i=a.quoteReply)&&void 0!==i?i:null}),clientId:t.payload.clientId,isNew:!0,is_banned:!1,link_metadata:o?{url:o,host:(0,s.Fo)(o)}:void 0,quote:r,quoteId:null==r?void 0:r.comment.id},d=(0,u._)((0,c._)({},a),{quoteReply:null,replyIds:[...a.replyIds,l.comment.id]});return eY((0,u._)((0,c._)({},e),{communityComments:(0,ej.Rg)(e.communityComments,l.comment.id,l),conversations:(0,ej.Rg)(e.conversations,n,d)}),n,l.comment.id)}case"conversation-comments-commit":{let{tempId:n}=t.payload,{threadId:i,reply:o,publications:r,comments:a}=t.payload;n=null!=n?n:o.client_id;let s=e.conversations.get(i);if(!s)throw Error("Attempted to post message to missing conversation");let l=n&&e.communityComments.get(n),d=new Map(e.communityComments),m=e2(o);d.set(o.comment.id,l?(0,u._)((0,c._)({},m),{clientId:l.clientId,comment:(0,u._)((0,c._)({},m.comment),{media_uploads:l.comment.media_uploads})}):m),o.quote&&d.set(o.quote.comment.id,e2(o.quote));let p=s.replyIds,h=o.comment.id;return n&&(p=p.map(e=>e===n?h:e)),p.includes(h)||(p=[...p,h]),p=[...new Set(p)],eY((0,u._)((0,c._)({},e),{conversations:(0,ej.Rg)(e.conversations,i,(0,u._)((0,c._)({},s),{replyIds:p})),communityComments:d,publications:r?(0,ej.zg)(e.publications,r,e=>e.id):e.publications,notes:a?(0,ej.zg)(e.notes,a,e=>"c-".concat(e.id)):e.notes}),i,o.comment.id)}case"conversation-comments-error":{let{commentId:n,error:i}=t.payload,o=e.communityComments.get(n);if(!o)throw Error("Attempted to assing error to missing comment");if(!o.isNew)throw Error("Attempted to set error on persisted comment");return(0,u._)((0,c._)({},e),{communityComments:(0,ej.Rg)(e.communityComments,n,(0,u._)((0,c._)({},o),{error:i}))})}case"conversation-quote-set":{let{conversationId:n,commentId:i}=t.payload,o=e.conversations.get(n);if(!o)throw Error("Tried to quote a message in a conversation that does not exist");return(0,u._)((0,c._)({},e),{conversations:(0,ej.Rg)(e.conversations,n,(0,u._)((0,c._)({},o),{quoteReply:i}))})}case"conversation-invite-accept":{let{conversationId:n}=t.payload;return e0(e,n,{membership_state:"accepted"})}case"conversation-invite-reject":{let n=new Map(e.conversations);return n.delete(t.payload.conversationId),(0,u._)((0,c._)({},e),{conversations:n})}case"conversation-invite-restore":{let{conversationId:n}=t.payload;return e0(e,n,{membership_state:"pending"})}case"conversation-mute":{let{conversationId:n,time:i}=t.payload;return e0(e,n,{unmute_at:i?(0,Y.Z)().add(1,"hour").toISOString():null})}case"conversation-toggle_reaction":{let{messageId:n,reaction:i}=t.payload,o=e.communityComments.get(n);if(!o)return console.warn("chat item does not exist"),e;let r=i!==o.comment.reaction;return(0,u._)((0,c._)({},e),{communityComments:(0,ej.Rg)(e.communityComments,n,(0,u._)((0,c._)({},o),{comment:eK(o.comment,i,r)}))})}default:return e}}(e,t):t.type.startsWith("posts-")?function(e,t){var n,i,o,r,a,s;let{publication_id:l}=t.payload,d=null!==(n=e.chats.get(l))&&void 0!==n?n:eO;switch(t.type){case"posts-request_initial":return(0,u._)((0,c._)({},e),{chats:(0,ej.Rg)(e.chats,l,(0,u._)((0,c._)({},d),{after:(0,u._)((0,c._)({},d.after),{isLoading:!0})}))});case"posts-request_more":return(0,u._)((0,c._)({},e),{chats:(0,ej.Rg)(e.chats,l,(0,u._)((0,c._)({},d),{before:(0,u._)((0,c._)({},d.before),{isLoading:!0})}))});case"posts-load_more":{let{result:n,direction:i}=t.payload,o=n.threads.find(e=>"deleted"!==e.communityPost.status),r=e9(e.communityPosts,n.threads,e=>e.communityPost.id,e=>e.communityPost.created_at),a=e1(l),s=(null==d?void 0:d.isLoaded)?{[i]:{isLoading:!1,hasMore:"before"===i?n.moreBefore:n.moreAfter,error:null}}:{before:{isLoading:!1,hasMore:n.moreBefore,error:null},after:{isLoading:!1,hasMore:n.moreAfter,error:null}},m=(0,u._)((0,c._)({},e),{users:(0,ej.zg)(e.users,n.threads.map(e=>e.user),e=>e.id),communityPosts:r,chats:(0,ej.Rg)(e.chats,l,(0,u._)((0,c._)({},d,s),{posts:eR()([...d.posts,...n.threads.map(e=>e.communityPost.id)]).sort((e,t)=>{var n,i;return e5(null===(n=r.get(e))||void 0===n?void 0:n.communityPost.created_at,null===(i=r.get(t))||void 0===i?void 0:i.communityPost.created_at)}),muteStatus:n.muteStatus,lastViewedAt:n.lastViewedAt,isLoaded:!0})),inbox:(0,u._)((0,c._)({},e.inbox),{threads:(0,ej.FN)(e.inbox.threads,a,e=>{var t,i;return"chat"===e.type?(0,u._)((0,c._)({},e),{communityPostId:null!==(t=null==o?void 0:o.communityPost.id)&&void 0!==t?t:e.communityPostId,lastViewedAt:null!==(i=n.lastViewedAt)&&void 0!==i?i:null}):e})})});return(0,u._)((0,c._)({},m),{inbox:"before"===i?e.inbox:(0,u._)((0,c._)({},e.inbox),{threadList:e$(m)})})}case"posts-error":{let{error:n,direction:i}=t.payload;return(0,u._)((0,c._)({},e),{chats:(0,ej.Rg)(e.chats,l,(0,u._)((0,c._)({},d),{[i]:{isLoading:!1,hasMore:!0,error:n}}))})}case"posts-mark_viewed":{let t=new Date().toISOString();return(0,u._)((0,c._)({},e),{inbox:(0,u._)((0,c._)({},e.inbox),{threads:(0,ej.F5)(e.inbox.threads,e1(l),{lastViewedAt:new Date().toISOString()})}),chats:(0,ej.Rg)(e.chats,l,(0,u._)((0,c._)({},d),{lastViewedAt:t}))})}case"posts-new":{let n=new Date().toISOString(),r={communityPost:(0,u._)((0,c._)({},t.payload),{status:"published",created_at:n,updated_at:n,is_locked:!1,is_edited:!1,user_id:null!==(o=null===(i=e.user)||void 0===i?void 0:i.id)&&void 0!==o?o:0,user:e.user,mediaAttachments:[],paywallInfo:null}),isNew:!0};return(0,u._)((0,c._)({},e),{communityPosts:(0,ej.Rg)(e.communityPosts,r.communityPost.id,r),chats:(0,ej.Rg)(e.chats,l,(0,u._)((0,c._)({},d),{posts:[r.communityPost.id,...d.posts]}))})}case"posts-updated":{let{id:n,chatItem:i}=t.payload;if(!d.posts.includes(n))return e;let o=new Map(e.communityPosts);return o.set(i.communityPost.id,i),(0,u._)((0,c._)({},e),{communityPosts:o})}case"posts-new_incoming":{let{chatItem:n,publication_id:i,id:o}=t.payload,r=new Map(e.communityPosts);r.set(o,n);let a=Array.from(new Set([o,...d.posts]));return(0,u._)((0,c._)({},e),{inbox:(0,u._)((0,c._)({},e.inbox),{threads:(0,ej.F5)(e.inbox.threads,e1(i),{communityPostId:n.communityPost.id})}),users:n.communityPost.user?(0,ej.Rg)(e.users,n.communityPost.user.id,n.communityPost.user):e.users,communityPosts:r,chats:(0,ej.Rg)(e.chats,i,(0,u._)((0,c._)({},d),{posts:a}))})}case"posts-commit":{let{id:n,chatItem:i,publication_id:o}=t.payload,r=new Map(e.communityPosts);r.delete(n),r.set(i.communityPost.id,i);let a=d.posts.includes(n)?d.posts.map(e=>e===n?i.communityPost.id:e):d.after.hasMore?d.posts:[i.communityPost.id,...d.posts];return(0,u._)((0,c._)({},e),{inbox:(0,u._)((0,c._)({},e.inbox),{threads:(0,ej.F5)(e.inbox.threads,e1(o),{communityPostId:i.communityPost.id})}),communityPosts:r,chats:(0,ej.Rg)(e.chats,o,(0,u._)((0,c._)({},d),{posts:a}))})}case"posts-new_reaction":{let{id:n,reaction:i}=t.payload,o=e.communityPosts.get(n);if(!o||!e8(o)||!(null===(r=o.communityPost)||void 0===r?void 0:r.reactions))return console.warn("chat item does not exist"),e;if(o.communityPost.reaction===i)return console.warn("already set this reaction",i),e;return(0,u._)((0,c._)({},e),{communityPosts:(0,ej.Rg)(e.communityPosts,n,(0,u._)((0,c._)({},o),{communityPost:eK(o.communityPost,i,!0)}))})}case"posts-remove_reaction":{let{id:n,reaction:i}=t.payload,o=e.communityPosts.get(n);if(!o||!e8(o)||!(null===(a=o.communityPost)||void 0===a?void 0:a.reactions))return console.warn("chat item does not exist"),e;return(0,u._)((0,c._)({},e),{communityPosts:(0,ej.Rg)(e.communityPosts,n,(0,u._)((0,c._)({},o),{communityPost:eK(o.communityPost,i,!1)}))})}case"posts-delete_post":{let{id:n,publication_id:i}=t.payload,o=e.communityPosts.get(n);if(!o)return console.warn("chat item does not exist"),e;let r=new Map(e.communityComments),a=e.comments.get(n);a&&a.comments.forEach(t=>{eJ(t,r);let n=e.replies.get(t);n&&n.comments.forEach(e=>{eJ(e,r)})});let l=null===(s=e.chats.get(i))||void 0===s?void 0:s.posts.filter(t=>{var i;if(t===n)return!1;let o=e.communityPosts.get(t);return(null==o?void 0:null===(i=o.communityPost)||void 0===i?void 0:i.status)!=="deleted"}).sort((t,n)=>{var i,o;let r=null===(i=e.communityPosts.get(t))||void 0===i?void 0:i.communityPost,a=null===(o=e.communityPosts.get(n))||void 0===o?void 0:o.communityPost;return e5(null==r?void 0:r.created_at,null==a?void 0:a.created_at)})[0],d=(0,u._)((0,c._)({},e),{communityPosts:(0,ej.Rg)(e.communityPosts,n,(0,u._)((0,c._)({},o),{communityPost:(0,u._)((0,c._)({},o.communityPost),{status:"deleted",updated_at:new Date().toISOString()})})),communityComments:r,inbox:(0,u._)((0,c._)({},e.inbox),{threads:(0,ej.FN)(e.inbox.threads,e1(i),e=>"chat"===e.type?(0,u._)((0,c._)({},e),{communityPostId:null!=l?l:null}):e)})});return(0,u._)((0,c._)({},d),{inbox:(0,u._)((0,c._)({},d.inbox),{threadList:e$(d)})})}case"posts-flag_post":{let{id:n}=t.payload,i=e.communityPosts.get(n);if(!i||!e8(i))return console.warn("chat item does not exist"),e;return(0,u._)((0,c._)({},e),{communityPosts:(0,ej.Rg)(e.communityPosts,n,(0,u._)((0,c._)({},i),{communityPost:(0,u._)((0,c._)({},i.communityPost),{reported_by_user:!0})}))})}case"posts-lock_replies":{let{id:n,isLocked:i}=t.payload,o=e.communityPosts.get(n);if(!o||!e8(o))return console.warn("chat item does not exist"),e;return(0,u._)((0,c._)({},e),{communityPosts:(0,ej.Rg)(e.communityPosts,n,(0,u._)((0,c._)({},o),{communityPost:(0,u._)((0,c._)({},o.communityPost),{is_locked:i})}))})}case"posts-link_metadata":{let{id:n,link_metadata:i}=t.payload,o=e.communityPosts.get(n);if(!o)return console.warn("chat item does not exist"),e;return(0,u._)((0,c._)({},e),{communityPosts:(0,ej.Rg)(e.communityPosts,n,(0,u._)((0,c._)({},o),{communityPost:(0,u._)((0,c._)({},o.communityPost),{link_metadata:i})}))})}case"posts-save_scroll_position":{let{publication_id:n,scrollOffset:i,scrollCache:o}=t.payload;return(0,u._)((0,c._)({},e),{chats:(0,ej.Rg)(e.chats,n,(0,u._)((0,c._)({},d),{scrollOffset:i,scrollCache:o}))})}case"posts-update_post":{let{id:n,post:i}=t.payload,o=e.communityPosts.get(n);if(!o||!e8(o))return console.warn("post does not exist"),e;return(0,u._)((0,c._)({},e),{communityPosts:(0,ej.Rg)(e.communityPosts,n,(0,u._)((0,c._)({},o),{communityPost:(0,c._)({},o.communityPost,i)}))})}case"posts-edit_post":{let{post:n}=t.payload;return(0,u._)((0,c._)({},e),{editingPost:n})}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("replies-")||t.type.startsWith("comments-")?function(e,t){var n,i,o,r,a,s,l,d,m;let p,g=null,v=null;"parentCommentId"in(m=t).payload&&m.payload.parentCommentId?v=t.payload.parentCommentId:"postId"in t.payload&&(g=t.payload.postId);let _=e=>v?{replies:e}:{comments:e};p=v?null!==(n=e.replies.get(v))&&void 0!==n?n:ez:g&&null!==(i=e.comments.get(g))&&void 0!==i?i:ez;let f=v?e.replies:e.comments,y=null!=v?v:g;switch(t.type){case"replies-clear":case"comments-clear":return y?(0,c._)({},e,_((0,ej.Rg)(f,y,ez))):e;case"replies-request_initial":case"comments-request_initial":{let{order:n,target:i}=t.payload,r=(0,u._)((0,c._)({},eF),{isLoading:!0,hasMore:!1}),a=i&&(null==p?void 0:p.comments.includes(i.id));return(0,c._)({},e,_((0,ej.Rg)(f,y,(0,u._)((0,c._)({},p),{before:"desc"===n?r:eF,after:"asc"===n?r:eF,order:n,target:null!=i?i:null,isLoaded:(!i||!!a)&&null!==(o=null==p?void 0:p.isLoaded)&&void 0!==o&&o}))))}case"replies-request_edge":case"comments-request_edge":{let{edge:n}=t.payload;return(0,c._)({},e,_((0,ej.Rg)(f,y,(0,u._)((0,c._)({},p),{[n]:(0,u._)((0,c._)({},p[n]),{isLoading:!0,error:null})}))))}case"replies-load_edge":case"comments-load_edge":{let{edge:n,result:{post:i,parent:o,replies:r,more:a,moreAfter:s,moreBefore:l,lastViewedAt:d}}=t.payload,m=null;if((null==i?void 0:i.communityPost.publication_id)&&(null==i?void 0:i.communityPost.muted)){let t={is_muted:!0,type:i.communityPost.left_pub_chat?"leave":"mute"},n=e.chats.get(null==i?void 0:i.communityPost.publication_id)||eO;n.muteStatus||(m=(0,ej.Rg)(e.chats,i.communityPost.publication_id,(0,u._)((0,c._)({},n),{muteStatus:t})))}let g=r.map(e=>e.comment.id),v=e9(e.communityComments,r.flatMap(e=>h()([e,e.quote]).map(e2)),e=>e.comment.id,e=>e.comment.updated_at);if(o)v.set(o.comment.id,(0,u._)((0,c._)({},o),{userId:o.user.id}));let b=(0,ej.zg)(e.users,h()([null==i?void 0:i.communityPost.user,null==o?void 0:o.user]),e=>e.id),w=y?f.get(y):null,Z=(null==w?void 0:w.isLoaded)?{[n]:{isLoading:!1,hasMore:a,error:null}}:{before:{isLoading:!1,hasMore:l,error:null},after:{isLoading:!1,hasMore:s,error:null}};return(0,c._)((0,u._)((0,c._)((0,u._)((0,c._)({},e),{communityPosts:i?(0,ej.Rg)(e.communityPosts,i.communityPost.id,i):e.communityPosts,communityComments:v}),m?{chats:m}:{}),{users:new Map([...b,...r.map(e=>[e.user.id,e.user])])}),_((0,ej.Rg)(f,y,(0,u._)((0,c._)((0,u._)((0,c._)({},p),{comments:eR()([...p.comments,...g]).sort((e,t)=>{var n,i;return e5(null===(n=v.get(e))||void 0===n?void 0:n.comment.created_at,null===(i=v.get(t))||void 0===i?void 0:i.comment.created_at)}).filter(e=>{var t;return(null===(t=v.get(e))||void 0===t?void 0:t.comment.status)!=="flagged"})}),Z),{order:"after"!==n||a?p.order:"desc",isLoaded:!0,lastViewedAt:d}))))}case"replies-target":case"comments-target":return y?(0,c._)({},e,_((0,ej.Rg)(f,y,(0,u._)((0,c._)({},p),{target:t.payload.target})))):e;case"replies-mark_viewed":case"comments-mark_viewed":{let{lastViewedAt:n}=t.payload;if("postId"in t.payload){let{postId:i}=t.payload;e=(0,u._)((0,c._)({},e),{communityPosts:(0,ej.FN)(e.communityPosts,i,e=>(0,u._)((0,c._)({},e),{communityPost:(0,u._)((0,c._)({},e.communityPost),{user_last_viewed_timestamp:n})}))})}else{let{parentCommentId:i}=t.payload;e=(0,u._)((0,c._)({},e),{communityComments:(0,ej.FN)(e.communityComments,i,e=>(0,u._)((0,c._)({},e),{comment:(0,u._)((0,c._)({},e.comment),{user_last_viewed_timestamp:n})}))})}return y?(0,c._)({},e,_((0,ej.Rg)(f,y,(0,u._)((0,c._)({},p),{lastViewedAt:n})))):e}case"comments-quote_set":{let{commentId:n}=t.payload;return y?(0,c._)({},e,_((0,ej.Rg)(f,y,(0,u._)((0,c._)({},p),{quoteReply:n})))):e}case"replies-new":case"comments-new":{let n=t.payload,i={comment:(0,u._)((0,c._)({},eW(e,n)),{quote_id:null!==(s=null===(r=n.quoteReply)||void 0===r?void 0:r.comment.id)&&void 0!==s?s:null,post_id:n.postId,parent_id:v}),isNew:!0,is_banned:!1,quote:n.quoteReply,quoteId:null===(a=n.quoteReply)||void 0===a?void 0:a.comment.id,pub_roles:n.pubRoles},o=(0,c._)((0,u._)((0,c._)({},e),{communityComments:(0,ej.Rg)(e.communityComments,i.comment.id,i)}),_((0,ej.Rg)(f,y,(0,u._)((0,c._)({},p),{comments:[i.comment.id,...p.comments],lastViewedAt:new Date().toISOString()}))));if(v){let n=e.communityComments.get(v);if(n&&e6(n)){let i=eV(n.comment,e.user,t.payload.postId);o.communityComments.set(v,(0,u._)((0,c._)({},n),{comment:i}))}}let l=e.communityPosts.get(t.payload.postId);if(l&&e8(l)){let n=eV(l.communityPost,e.user,t.payload.postId);o.communityPosts=(0,ej.Rg)(e.communityPosts,t.payload.postId,(0,u._)((0,c._)({},l),{communityPost:n}))}return o}case"replies-commit":case"comments-commit":{let{id:n,reply:i}=t.payload,o=new Map(e.communityComments);o.delete(n),o.set(i.comment.id,e2(i));let r=p.comments.includes(n)?p.comments.map(e=>e===n?i.comment.id:e):p.after.hasMore?p.comments:[i.comment.id,...p.comments];return(0,c._)((0,u._)((0,c._)({},e),{communityComments:o}),_((0,ej.Rg)(f,y,(0,u._)((0,c._)({},p),{comments:r}))))}case"comments-updated":{let{id:n,reply:i}=t.payload;if(!p.comments.includes(n))return e;let o=p.comments.map(e=>e===n?i.comment.id:e);return(0,c._)((0,u._)((0,c._)({},e),{communityComments:(0,ej.Rg)(e.communityComments,n,e2(i))}),_((0,ej.Rg)(f,y,(0,u._)((0,c._)({},p),{comments:o}))))}case"comments-new_incoming":{let{id:n,reply:i}=t.payload;return(0,c._)((0,u._)((0,c._)({},e),{communityComments:(0,ej.Rg)(e.communityComments,n,e2(i)),users:i.user?(0,ej.Rg)(e.users,i.userId,i.user):e.users}),_((0,ej.Rg)(f,y,(0,u._)((0,c._)({},p),{comments:Array.from(new Set([i.comment.id,...p.comments]))}))))}case"replies-error":case"comments-error":{let{edge:n,error:i}=t.payload;if(i instanceof Q.kp){let t=i.body.post;t&&(e=(0,u._)((0,c._)({},e),{communityPosts:(0,ej.Rg)(e.communityPosts,t.communityPost.id,(0,u._)((0,c._)({},t),{pubRole:null})),users:t.user?(0,ej.Rg)(e.users,t.user.id,t.user):e.users}))}return(0,c._)({},e,_((0,ej.Rg)(f,y,(0,u._)((0,c._)({},p),{[n]:(0,u._)((0,c._)({},p[n]),{error:i})}))))}case"comments-new_reaction":{let{id:n,reaction:i}=t.payload,o=e.communityComments.get(n);if(!o||!e6(o)||!(null===(l=o.comment)||void 0===l?void 0:l.reactions))return console.warn("comment does not exist"),e;if(o.comment.reaction===i)return console.warn("reaction already set"),e;return(0,u._)((0,c._)({},e),{communityComments:(0,ej.Rg)(e.communityComments,n,(0,u._)((0,c._)({},o),{comment:eK(o.comment,i,!0)}))})}case"comments-remove_reaction":{let{id:n,reaction:i}=t.payload,o=e.communityComments.get(n);if(!o||!e6(o)||!(null===(d=o.comment)||void 0===d?void 0:d.reactions))return console.warn("comment does not exist"),e;return(0,u._)((0,c._)({},e),{communityComments:(0,ej.Rg)(e.communityComments,n,(0,u._)((0,c._)({},o),{comment:eK(o.comment,i,!1)}))})}case"comments-delete_comment":{let{id:n}=t.payload,i=e.communityComments.get(n);if(!i)return console.warn("comment does not exist, cannot delete"),e;return(0,u._)((0,c._)({},e),{communityComments:(0,ej.Rg)(e.communityComments,n,(0,u._)((0,c._)({},i),{comment:(0,u._)((0,c._)({},i.comment),{status:"deleted",updated_at:new Date().toISOString()})}))})}case"comments-update_comment":{let{id:n,comment:i}=t.payload,o=e.communityComments.get(n);if(!o||!e6(o))return console.warn("comment does not exist"),e;return(0,u._)((0,c._)({},e),{communityComments:(0,ej.Rg)(e.communityComments,n,(0,u._)((0,c._)({},o),{comment:(0,c._)({},o.comment,i)}))})}case"comments-flag_comment":{let{id:n}=t.payload,i=e.communityComments.get(n);if(!i||!e6(i))return console.warn("comment does not exist"),e;return(0,u._)((0,c._)({},e),{communityComments:(0,ej.Rg)(e.communityComments,n,(0,u._)((0,c._)({},i),{comment:(0,u._)((0,c._)({},i.comment),{reported_by_user:!0})}))})}case"comments-ban_author":{let{id:n,ban:i}=t.payload,o=e.communityComments.get(n);if(!o||!e6(o))return console.warn("comment does not exist"),e;return(0,u._)((0,c._)({},e),{communityComments:(0,ej.Rg)(e.communityComments,n,(0,u._)((0,c._)({},o),{is_banned:i}))})}case"comments-lock_replies":{let{id:n,isLocked:i}=t.payload,o=e.communityComments.get(n);if(!o||!e6(o))return console.warn("comment does not exist"),e;if(o.comment.parent_id)return console.warn("cannot lock replies on a reply to a comment"),e;return(0,u._)((0,c._)({},e),{communityComments:(0,ej.Rg)(e.communityComments,n,(0,u._)((0,c._)({},o),{comment:(0,u._)((0,c._)({},o.comment),{is_locked:i})}))})}default:throw Error("Invalid type")}}(e,t):e}function eV(e,t,n){var i,o;let r;return(t&&t.photo_url&&(r=[{id:t.id,name:t.name,photo_url:t.photo_url,post_id:n}],e.recent_commenters&&(r=eL()([...r,...e.recent_commenters],e=>e.id))),"reply_count"in e)?(0,u._)((0,c._)({},e),{recent_commenters:r,reply_count:1+(null!==(i=e.reply_count)&&void 0!==i?i:0)}):"comment_count"in e?(0,u._)((0,c._)({},e),{recent_commenters:r,comment_count:1+(null!==(o=e.comment_count)&&void 0!==o?o:0)}):e}function eJ(e,t){let n=t.get(e);return!!n&&"deleted"!==n.comment.status&&(t.set(e,(0,u._)((0,c._)({},n),{comment:(0,u._)((0,c._)({},n.comment),{status:"deleted",updated_at:new Date().toISOString()})})),!0)}function eW(e,t){var n,i,o;return(0,u._)((0,c._)({},function(){let e=new Date().toISOString();return{id:"",created_at:e,updated_at:e,user_id:0,post_id:"",body:"",raw_body:"",media_uploads:null,parent_id:null,is_locked:!1,quote_id:null,status:"published",reactions:{}}}()),{id:t.id,body:t.body,raw_body:t.mentions?t.body:void 0,media_uploads:null!==(i=t.mediaUploads)&&void 0!==i?i:null,user_id:null!==(o=null===(n=e.user)||void 0===n?void 0:n.id)&&void 0!==o?o:0,mentions:t.mentions,mediaAttachments:t.mediaAttachments,conversation_id:t.conversationId})}function eY(e,t,n){let i=e4(t),o=e.inbox.threads.get(i),r=(null==o?void 0:o.type)==="direct-message"?o:null,a=(0,u._)((0,c._)({},e),{inbox:(0,u._)((0,c._)({},e.inbox),{threads:(0,ej.Rg)(e.inbox.threads,i,(0,u._)((0,c._)({timestamp:new Date().toISOString()},r),{id:i,type:"direct-message",messageThreadId:t,lastViewedAt:new Date().toISOString(),recentMessageId:n}))})});return(0,u._)((0,c._)({},a),{inbox:(0,u._)((0,c._)({},e.inbox),{threadList:e$(a)})})}function eK(e,t,n){var i,o;let r=e.reaction,a=(0,c._)({},e.reactions);return a[t]=(null!==(i=a[t])&&void 0!==i?i:0)+(n?1:-1),n&&r&&(a[r]=(null!==(o=a[r])&&void 0!==o?o:0)-1),(0,u._)((0,c._)({},e),{reactions:a,reaction:n?t:null})}function eG(e){return(0,u._)((0,c._)({},e),{inbox:(0,u._)((0,c._)({},e.inbox),{threadList:e$(e)})})}function e$(e){return[...e.inbox.threads.values()].sort((t,n)=>n.isPrimary&&!t.isPrimary?1:!n.isPrimary&&t.isPrimary?-1:n.isPinned&&!t.isPinned?1:!n.isPinned&&t.isPinned?-1:e5(eQ(e,t),eQ(e,n))).map(e=>e.id)}function eQ(e,t){var n,i,o,r;return"chat"===t.type?null!==(o=t.communityPostId&&(null===(i=e.communityPosts.get(t.communityPostId))||void 0===i?void 0:i.communityPost.created_at))&&void 0!==o?o:t.timestamp:null!==(r=null===(n=ev(e,t))||void 0===n?void 0:n.comment.created_at)&&void 0!==r?r:t.timestamp}function e0(e,t,n){let i=e.conversations.get(t),o=null==i?void 0:i.thread;if(!i||!o)throw Error("Tried to update a conversation that does not exist.");let r=e.user;if(!r)throw Error("Cannot update conversation if the user does not exist.");return(0,u._)((0,c._)({},e),{conversations:(0,ej.Rg)(e.conversations,t,(0,u._)((0,c._)({},i),{thread:(0,u._)((0,c._)({},o),{members:o.members.map(e=>e.user_id===r.id?(0,c._)({},e,n):e)})}))})}function e1(e){return"chat-".concat(e)}function e4(e){return"direct-message-".concat(e)}function e2(e){var t,n,i,o;return(0,u._)((0,c._)({},e),{userId:null===(t=e.user)||void 0===t?void 0:t.id,quoteId:null!==(o=null!==(i=null===(n=e.quote)||void 0===n?void 0:n.comment.id)&&void 0!==i?i:e.comment.quote_id)&&void 0!==o?o:void 0})}function e8(e){return!0!==e.isNew}function e6(e){return!0!==e.isNew}function e5(e,t){return e===t?0:!t||e&&e>t?-1:1}function e9(e,t,n,i){let o=new Map(e);for(let e of t){let t=n(e),r=o.get(t);if(!r){o.set(t,e);continue}i(e)>=i(r)&&o.set(t,(0,c._)({},r,e))}return o}function e7(e){let t=new Date().toISOString();return e.reduce((e,n)=>{var i;let o=null!==(i=n.timestamp)&&void 0!==i?i:t;return o<e?o:e},t)}let e3=e=>async(t,n)=>{let i=e.reply.comment.post_id;n().conversations.get(i)||await t(eA(i)),t({type:"conversation-comments-commit",payload:{threadId:e.reply.comment.post_id,reply:e.reply}}),(0,eM.JG)("/api/v1/messages/unread-count")},te=e=>async t=>{var n,i;let{post:o}=e;if("deleted"===o.status){t({type:"posts-delete_post",payload:{id:o.id,publication_id:o.publication_id}});return}t({type:"posts-updated",payload:{id:o.id,chatItem:{communityPost:(0,u._)((0,c._)({},o),{user:o.author,user_id:o.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=o.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(i=o.user_pub_role_object)&&void 0!==i?i:null}}})},tt=e=>async t=>{var n,i;let{post:o}=e;t({type:"posts-new_incoming",payload:{publication_id:o.publication_id,id:o.id,chatItem:{communityPost:(0,u._)((0,c._)({},o),{user:o.author,user_id:o.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=o.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(i=o.user_pub_role_object)&&void 0!==i?i:null}}})};function tn(){let[e,t]=(0,o.eJ)(!1);return(0,i.tZ)(eX,{surface:"dropdown",children:(0,i.tZ)(l.sg,{flex:"grow",width:360,style:{maxHeight:"80dvh"},color:"primary",children:e?(0,i.tZ)(tr,{onBack:()=>t(!1)}):(0,i.tZ)(ti,{onSelectRequests:()=>t(!0)})})})}function ti(e){let{onSelectRequests:t}=e,n=function(){let{selectedConversationId:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,b.aF)(),n=(0,el.RN)(),i=(0,eZ.Th)(),r=e=>{var t;let{publicationUserMap:n}=null!==(t=i.result)&&void 0!==t?t:{publicationUserMap:new Map},o=n.get(e);return!!(o&&["contributor","admin"].includes(o.role))};return(0,o.Ye)(()=>{let{threads:i,threadList:o,filter:a}=n.inbox,s=h()(o.map(e=>i.get(e))),l=["chat","direct-message"].includes(a),d=[];for(let i of s){var m,p,g;if(!l||i.type===a){if("chat"===i.type){let e=r(i.publication.id);if(!i.communityPostId&&e){d.push((0,u._)((0,c._)({},i),{communityPost:null,user:t,isOwned:e,isCurrentUserAuthor:!0}));continue}let o=i.communityPostId?n.communityPosts.get(i.communityPostId):null,a=null!==(m=null==o?void 0:o.communityPost)&&void 0!==m?m:null;d.push((0,u._)((0,c._)({},i,o),{communityPost:a,user:null!==(p=a&&n.users.get(a.user_id))&&void 0!==p?p:null,isOwned:e,isCurrentUserAuthor:(null==t?void 0:t.id)==(null==a?void 0:a.user_id)}))}else{let o=n.conversations.get(i.messageThreadId),r=null==o?void 0:o.thread,a=null==r?void 0:r.members.find(e=>e.user_id===(null==t?void 0:t.id));if(r&&(null==a?void 0:a.membership_state)==="accepted"){let t=ev(n,i);(t||e===r.id)&&d.push((0,u._)((0,c._)({subtitleBody:""},i),{messageThread:r,members:r.members.map(e=>{var t;return null!==(t=n.users.get(e.user_id))&&void 0!==t?t:e.user}),recentMessage:t,timestamp:null!==(g=null==t?void 0:t.comment.created_at)&&void 0!==g?g:i.timestamp}))}}}}if("unread"===a){let e=new Date(0).toISOString();d=d.filter(t=>{var n,i;return(null!==(n=t.timestamp)&&void 0!==n?n:e)>(null!==(i=t.lastViewedAt)&&void 0!==i?i:e)})}return d},[n.inbox.threads,n.inbox.threadList,n.inbox.filter,n.communityPosts,n.conversations,t])}(),{setQuery:r,filteredItems:s}=function(e){let t=J(),n=(0,f.R)({items:e,getKeys:e=>{if("chat"===e.type){var t,n,i;return h()([e.publication.name,...e.publication.contributors.map(e=>e.name),null===(t=e.user)||void 0===t?void 0:t.name,null===(i=e.communityPost)||void 0===i?void 0:null===(n=i.body)||void 0===n?void 0:n.substring(0,80)])}let o=e.messageThread.members;return h()(o.flatMap(e=>{var t;let{user:n}=e;return[n.name,n.handle,null===(t=n.handle)||void 0===t?void 0:t.slice(1)]}))}}),{query:i}=n;return(0,o.d4)(()=>{i&&(0,a.j)(a.FP.CHAT_INBOX_SEARCHED,{surface:t})},[i,t]),n}(n);return(0,i.BX)(i.HY,{children:[(0,i.BX)(l.sg,{gap:8,children:[(0,i.BX)(ta,{children:[(0,i.BX)(ts,{children:[(0,i.tZ)(l.xv.H3,{weight:"heavy",flex:"grow",children:"Chat"}),(0,i.tZ)(eC,{href:(0,K.gp)(),newTab:!0,onClick:()=>(0,a.j)(a.FP.CHAT_DROPDOWN_NEW_CHAT_CLICKED)})]}),(0,i.tZ)(d.M,{onChange:r,placeholder:"Search chats"})]}),(0,i.tZ)(eP,{inboxItems:n})]}),(0,i.tZ)(tl,{children:(0,i.tZ)(ex,{filteredItems:s,inboxItems:n,onSelectInvites:t,onSelectConversation:e=>{to((0,K.Rm)(e))},onSelectPub:e=>{to((0,K.aD)(e))}})}),(0,i.tZ)(l.X2,{borderTop:"detail",height:48,flex:"auto",alignItems:"center",justifyContent:"center",children:(0,i.tZ)(l.zx,{priority:"tertiary",href:(0,eb.Cnj)(),newTab:!0,onClick:()=>(0,a.j)(a.FP.CHAT_DROPDOWN_SEE_ALL_CLICKED),children:"See all"})})]})}function to(e){(0,s.uX)(e,{local_navigation:!1,newTab:!0})}function tr(e){let{onBack:t}=e,{data:n,error:o}=(0,ea._I)("/api/v1/messages/dm/invites"),a=function(e){let t=[],n=[...(null==e?void 0:e.threads)||[],...(null==e?void 0:e.spamThreads)||[]];for(let e of null!=n?n:[])if("direct-message"===e.type){var i,o;t.push((0,u._)((0,c._)({},e),{members:e.messageThread.members.map(e=>{let{user:t}=e;return t}),messageThreadId:e.messageThread.id,recentMessageId:null!==(o=null===(i=e.recentMessage)||void 0===i?void 0:i.id)&&void 0!==o?o:null,recentMessage:e.recentMessage?{comment:e.recentMessage,userId:e.recentMessage.user_id}:null}))}return t}(n);return(0,i.BX)(i.HY,{children:[(0,i.tZ)(ta,{children:(0,i.BX)(ts,{children:[(0,i.tZ)(l.hU,{priority:"tertiary",onClick:t,children:(0,i.tZ)(r.Z,{})}),(0,i.tZ)(l.xv.H3,{weight:"heavy",flex:"grow",children:"Requests"}),(0,i.tZ)(eu,{})]})}),(0,i.tZ)(tl,{children:(0,i.tZ)(em,{isLoading:!n,error:o,items:a,onSelect:e=>{to((0,K.Rm)(e))}})})]})}let ta=(0,l.E7)({display:"flex",direction:"column",paddingX:16,paddingTop:16,gap:16}),ts=(0,l.E7)({display:"flex",alignItems:"center",height:40,gap:12}),tl=(0,l.E7)({display:"flex",direction:"column",overflowY:"auto",minHeight:0})},61468:function(e,t,n){"use strict";n.d(t,{$h:()=>p,Ap:()=>c,Vu:()=>g,kF:()=>u,ob:()=>h});var i=n(7409),o=n(99282);n(56303);var r=n(14293),a=n.n(r),s=n(84864);let l=4716==n.j?[{regex:/\((\d{2}):(\d{2}):(\d{2})\):/,parse:e=>3600*parseInt(e[1])+60*parseInt(e[2])+parseInt(e[3])},{regex:/\((\d{2}):(\d{2})\):/,parse:e=>60*parseInt(e[1])+parseInt(e[2])},{regex:/\((\d{2}:\d{2}\.\d{1,3})\)/,parse:e=>{let[t,n]=e[1]?e[1].split(":").map(parseFloat):[0,0];return 60*t+n}}]:null,d=4716==n.j?[{regex:/^(.*?[\w\s’‘,.'-]*)\s\(\d{2}:\d{2}:\d{2}\):/,parse:e=>e[1]},{regex:/^(.*?[\w\s’‘,.'-]*)\s\(\d{2}:\d{2}\):/,parse:e=>e[1]},{regex:/^(.*?[\w\s’‘,.'-]*)\s*\(\d{2}:\d{2}\.\d{1,3}\)$/,parse:e=>e[1]}]:null,c=e=>{let{rows:t,maxWordsPerRow:n=60}=e;if(a()(t[0]))return[];let r=[],s=(0,o._)((0,i._)({},t[0]),{words:t[0].words.map(e=>(0,o._)((0,i._)({},e),{originalIndex:0}))});for(let e=1;e<t.length;e++){let a=t[e];if(!a)continue;let l=(0,o._)((0,i._)({},a),{words:a.words.map(t=>(0,o._)((0,i._)({},t),{originalIndex:e}))});s.speaker===l.speaker&&s.words.length+l.words.length<=n?s={start:s.start,end:l.end,text:"".concat(s.text," ").concat(l.text),words:s.words.concat(...l.words),speaker:s.speaker}:(r.push(s),s=l)}return r.push(s),r},u=(e,t)=>{let n=e.split("\n"),r=[],a="",s="",c=0,u=0,m=new Set,p={},h=0;return n.forEach((e,i)=>{var o,g;let v=null!==(o=l.find(t=>!!e.match(t.regex)))&&void 0!==o?o:null,_=null!==(g=d.find(t=>!!e.match(t.regex)))&&void 0!==g?g:null,f=e.trim();if(v){let t=e.match(v.regex);t&&(u=v.parse(t),s&&(r.push({speaker:p[a],start:c,end:u,text:s.trim(),words:[]}),s=""),c=u,f=f.replace(v.regex,""))}if(_){let t=e.match(_.regex);t&&(a=_.parse(t),m.has(a)||(m.add(a),p[a]="SPEAKER_".concat(h++)),s+="".concat(f.substring(a.length)," "))}else""!==f.trim()&&(s+="".concat(f," "));i===n.length-1&&s&&r.push({speaker:p[a],start:c,end:t,text:s.trim(),words:[]})}),[{segments:r},Object.entries(p).reduce((e,t)=>(0,o._)((0,i._)({},e),{[t[1]]:t[0]}),{})]};function m(e){let[t,n,i]=e.split(":").map(parseFloat);return 3600*t+60*n+i}let p=e=>{let t=e.split("\n").map(e=>e.trim()),n=[],r=new Set,s={},l=0;for(let e=0;e<t.length;e++){let i=t[e];if(a()(i))continue;let o=i.trim();if(o.includes("--\x3e")){let i=o.split(" --\x3e ").map(e=>e.trim()),d=m(i[0]),c=m(i[1]);e++;let u=[],p="";for(;e<t.length&&!a()(t[e])&&""!==t[e].trim();){let n=t[e].trim();if(n.startsWith("<v ")){let e=n.match(/<v\s+([^>]+)>/);if(e&&e[1]){p=e[1].trim(),r.has(p)||(r.add(p),s[p]="SPEAKER_".concat(l++));let t=n.indexOf(">")+1;t<n.length&&u.push(n.substring(t).trim())}}else u.push(n);e++}n.push({speaker:s[p],start:d,end:c,text:u.join(" ").trim(),words:[]})}}return[{segments:n},Object.entries(s).reduce((e,t)=>(0,o._)((0,i._)({},e),{[t[1]]:t[0]}),{})]},h=e=>e?e.segments.some(e=>!e.text)?"Segment text is missing":e.segments.some(e=>a()(e.end)||a()(e.start))?"Segment start or end time is missing":null:"Transcription is missing",g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];return e.forEach(e=>{var i;let o=t[null!==(i=e.speaker)&&void 0!==i?i:""],r="(".concat((0,s.secondsToHHMMSS)(e.start,{strict:!0}),"):\n").concat(e.text.trim(),"\n");o?n.push("".concat(o," ").concat(r)):n.push(r)}),n.join("\n")}},99961:function(e,t,n){"use strict";n.d(t,{U:()=>o,Z:()=>o});var i=n(88897);let o=i.NB.create({name:"hardBreak",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:e}){return["br",(0,i.P1)(this.options.HTMLAttributes,e)]},renderText:()=>"\n",addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:i})=>e.first([()=>e.exitCode(),()=>e.command(()=>{let{selection:e,storedMarks:o}=n;if(e.$from.parent.type.spec.isolating)return!1;let{keepMarks:r}=this.options,{splittableMarks:a}=i.extensionManager,s=o||e.$to.parentOffset&&e.$from.marks();return t().insertContent({type:this.name}).command(({tr:e,dispatch:t})=>{if(t&&s&&r){let t=s.filter(e=>a.includes(e.type.name));e.ensureMarks(t)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}})}}]);