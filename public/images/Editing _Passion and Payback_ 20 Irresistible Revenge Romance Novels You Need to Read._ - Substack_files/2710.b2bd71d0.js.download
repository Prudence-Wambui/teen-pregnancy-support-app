"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["2710"],{54416:function(){},24202:function(e,t,n){n.d(t,{$9:()=>h,Z4:()=>_,dz:()=>b,iv:()=>y,sp:()=>f,yU:()=>g});var o=n(7409),i=n(16584),r=n(30396),a=n(94184),l=n.n(a),d=n(10968),s=n(51938),c=n(3880),u=n(20888),p=n(27625),m=n(19081),v=n(74312),w=n(54796);function f(e){let t=e.assets.filter(e=>"string"!=typeof e&&"number"==typeof e.width&&"number"==typeof e.height&&e.width>0&&e.height>0);return t.length<=1||e.readOnly||e.isDm?(0,i.tZ)(c.E,(0,o._)({},e)):2===t.length?(0,i.tZ)(s.V,(0,o._)({},e)):(0,i.tZ)(d.Li,(0,o._)({},e))}function h(e){let{assets:t,imageViewer:o,setImageViewer:r,readOnly:a}=e;return a||!o?null:(0,i.tZ)(v.cr,{module:"./ImageViewerModal",resolve:e=>e.ImageViewerModal,onRequest:()=>n.e("4713").then(n.bind(n,2563)),showModal:!!o,modalContent:t.map(e=>({attrs:{src:e.src}})),onClose:()=>r(null),step:o.index,includeDownloadButton:!1})}function g(e,t){let[n,o]=(0,r.eJ)(0);return(0,r.bt)(()=>{let n=new ResizeObserver(e=>{for(let n of e)o(n.contentRect.width-t)});return e.current&&n.observe(e.current),()=>{n.disconnect()}},[t,e]),n}function _(e){var t;let{asset:n,explicit:r,onClick:a,readOnly:d,width:s,height:c,children:v,className:f,imageProps:h,maxWidth:g,flex:_="auto",radius:b,style:y,outline:I="detail"}=e,{isHidden:L,onShow:E}=(0,p.Sl)(r),D=null!==(t=null!=g?g:s)&&void 0!==t?t:500;return(0,i.BX)(m.hs,{position:"relative",className:l()(w.Z.imageBubble,!d&&w.Z.clickable,f),flex:_,radius:b,onClick:L?void 0:a,bg:"secondary",outline:I,style:(0,o._)({width:s,height:c},y),overflow:"hidden",draggable:!1,children:[(0,i.tZ)(u.e,{src:n,maxWidth:D,useRetinaSizing:!0,imageIsFixedWidth:!0,imageProps:(0,o._)({smartCrop:!1},h),width:s,height:c,loading:"lazy",ignorePicture:!0,draggable:!1}),v,L&&(0,i.tZ)(p.HU,{onShow:E})]})}function b(e){return e.map(e=>"string"==typeof e?{src:e,explicit:!1}:e)}function y(e){let t=e.some(e=>e.explicit),{isHidden:n}=(0,p.Sl)(t);return n}},50137:function(e,t,n){n.d(t,{Z:()=>l});var o=n(7409),i=n(99282),r=n(16584),a=n(64515);let l=e=>(0,r.tZ)(a.l,(0,i._)((0,o._)({},e),{name:"NoteForwardIcon",svgParams:{height:24,width:24,stroke:e.stroke,strokeWidth:e.strokeWidth},children:(0,r.tZ)("path",{d:"M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12","stroke-linecap":"round","stroke-linejoin":"round"})}))},8923:function(e,t,n){n.d(t,{$1:()=>c});var o=n(7409),i=n(99282),r=n(16584),a=n(6400),l=n(30396);n(80569);let d=(0,a.createContext)({oauthAccessToken:null,isOAuthProvider:!1}),s=()=>(0,l.qp)(d);function c(e){let t=t=>{let{oauthAccessToken:n}=s();return(0,r.tZ)(e,(0,i._)((0,o._)({},t),{oauthAccessToken:n}))};return t.displayName="WithOAuthEmbed(".concat(e.displayName||e.name||"Component",")"),t}},8090:function(e,t,n){n.d(t,{A:()=>P,FP:()=>g,K8:()=>A,Kl:()=>L,Md:()=>N,c$:()=>O,j:()=>T,jA:()=>Z,jJ:()=>k,x6:()=>C,xG:()=>S});var o,i,r=n(7409),a=n(21811),l=n(15872),d=n(55229),s=n(43300),c=n(49762),u=n(96708),p=n(98914),m=n(98012),v=n(37313),w=n(60308),f=n(26111),h=n(41935);let g=v.F,_="undefined"!=typeof window,b=!!(_&&window.navigator&&window.navigator.sendBeacon),y=!(0,p.w1)()&&b,I=new s.T({batchOptions:y?{maxBatchSize:8,maxBatchDataSize:1e4}:void 0,send:function(e,t){_&&(y&&t&&e.push(F(e,t)),new Image().src=(0,w.n1t)(y?"/api/v1/firehose/batch":"/api/v1/firehose",{_:new Date().getTime(),d:e.join(",")}))},beacon:function(e,t){if(!_)return;e.push(F(e,"beacon",t));let n=new Blob([JSON.stringify(e)],{type:"application/json"});navigator.sendBeacon("/api/v1/firehose/batch",n)}}),L=()=>{_&&y&&(window.addEventListener("beforeunload",e=>{I.sendBeacon(e)}),window.addEventListener("pagehide",e=>{I.sendBeacon(e)}),document.addEventListener("visibilitychange",e=>{"hidden"===document.visibilityState&&I.sendBeacon(e)}),setInterval(()=>{I.intervalFlush()},6e4))},E=_&&window!=window.top&&(0,h.l)(p.EH),D="browser";function P(){return E}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(["development","test"].includes("production")&&!e)throw Error("`undefined` event passed to FRONTEND track call");R(e,Object.assign({},t))}function C(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};T(g.PUBLICATION_VISITED,(0,r._)({visited_publication_id:e.id,visited_publication_subdomain:e.subdomain,source:t},n))}function k(e){let{post:t,hasPaywall:n,surface:o,markRead:i,user:r,trackerUuid:a}=e;T(g.POST_SEEN,{post_id:t.id,post_audience:t.audience,post_type:t.type,has_paywall:n,post_age_minutes:t.post_date&&(0,m.Z)().diff(t.post_date,"minute"),surface:o,tracker_uuid:a}),(!r||i)&&O(t.id)}function O(e){return fetch("/api/v1/posts/".concat(e,"/seen"),{method:"POST"})}function S(e){let{post:t,hasPaywall:n,surface:o,trackerUuid:i}=e;T(g.POST_BOTTOM_SEEN,{post_id:t.id,post_audience:t.audience,post_type:t.type,has_paywall:n,surface:o,tracker_uuid:i})}function A(e){let{post:t}=e;(null==t?void 0:t.id)&&(T(g.POST_PAGE_PINGBACK,{seconds:0,post_id:t.id}),setTimeout(()=>{T(g.POST_PAGE_PINGBACK,{seconds:10,post_id:t.id})},1e4))}function Z(e){let{previous:t,url:n}=e;!(!t||n.includes("_no_an=true"))&&N()}_&&(navigator.standalone||(null===(o=(i=window).matchMedia)||void 0===o?void 0:o.call(i,"(display-mode: standalone)").matches))&&(D="standalone");let X=()=>document.location.pathname.startsWith("/p/"),x=()=>{var e,t,n;let o=window._preloads,i=(null==o?void 0:null===(e=o.post)||void 0===e?void 0:e.id)&&(null==o?void 0:o.pub),r=!!(null==o?void 0:null===(t=o.post)||void 0===t?void 0:t.slug)&&(null==o?void 0:null===(n=o.post)||void 0===n?void 0:n.slug)===document.location.pathname.split("/")[document.location.pathname.split("/").length-1];return!!(i&&X()&&r)},M=e=>e?e.is_subscribed?"Paid subs":e.is_free_subscribed?"Free subs":"Anonymous":"Anonymous";function N(){var e,t,n;let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(document.location.pathname.startsWith("/embed")&&_&&(null===(n=window)||void 0===n?void 0:null===(t=n._preloads)||void 0===t?void 0:null===(e=t.pub)||void 0===e?void 0:e.embed_tracking_disabled))return;R(g.PAGES,Object.assign(function(){let e={};if(_){let t=window._preloads&&"post"in window._preloads&&window._preloads.post,n=window.location&&/^\/p\/([^\/]+)/.exec(window.location.pathname);n&&t&&n[1]===t.slug&&(e.post_id=t.id,e.post_audience=t.audience,e.post_type=t.type)}return e}(),o));let i=(0,d.xL)();if(i&&(new Image().src="https://www.facebook.com/tr?id=".concat(i,"&ev=PageView")),(0,u.g)("pageview"),(0,d.XY)("pageview"),(0,d.Hx)("page_view"),_&&window.PARSELY&&window.PARSELY.loaded&&window.PARSELY.beacon&&window.PARSELY.beacon.trackPageView){let e={url:document.location.origin+document.location.pathname+document.location.search,urlref:document.referrer||"",js:1,data:{}};if((0,c.default)("add_section_and_tag_metadata")){if(X()&&!x())return;if(X()){let t=window._preloads;e.data={audience:M(null==t?void 0:t.user)}}}window.PARSELY.beacon.trackPageView(e)}}function B(e){var t,n,o;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null;try{r=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}let d={event:e,timestamp:new Date().toISOString(),properties:Object.assign({browserSessionId:l.W,iframeVisitId:E,r:(0,f.x)("r"),magicUserId:"undefined"!=typeof window&&(null===(o=window)||void 0===o?void 0:null===(n=o._preloads)||void 0===n?void 0:null===(t=n.user)||void 0===t?void 0:t.is_magic)?window._preloads.user.id:void 0},i),context:{client_type:"web",displayMode:D,page:{referrer:document.referrer,title:document.title,url:document.location.href},campaign:(0,a.l)(),timezone:r}};return(0,p.m)(JSON.stringify(d))}function F(e,t,n){let o=e.length,i=e.map(e=>e.length).reduce((e,t)=>e+t,0);return B(g.FIREHOSE_BATCH_SENT,{dataSize:i,batchSize:o,batchType:t,eventType:null==n?void 0:n.type})}function R(e){var t,n,o;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("undefined"==typeof window||"undefined"==typeof document)return;let r=B(e,i);I.add(r),(null===(o=window)||void 0===o?void 0:null===(n=o._preloads)||void 0===n?void 0:null===(t=n.user)||void 0===t?void 0:t.is_global_admin)&&console.log("EVENT: ".concat(e),i)}},17172:function(e,t,n){n.d(t,{aZ:()=>r});var o=n(98661),i=n(41302);function r(e){let t=(0,o.useRef)({isDragging:!1,didDrag:!1,startX:0,startY:0,startTime:0,scrollLeft:0,velX:0,pointerId:0,momentumId:null,overscrollX:0}),{handleOverscroll:n,resetOverscroll:r}=function(e){let t=()=>(e.current&&i.Z.overscrollTransition&&(e.current.classList.add(i.Z.overscrollTransition),e.current.style.transform="",setTimeout(()=>{e.current&&i.Z.overscrollTransition&&e.current.classList.remove(i.Z.overscrollTransition)},200)),0);return{handleOverscroll:(e,n,o)=>{let r=e.scrollWidth-e.clientWidth,a=o;i.Z.overscrollTransition&&e.classList.remove(i.Z.overscrollTransition);let l=t=>{let n=-t/5;return e.style.transform="translateX(".concat(n,"px)"),n};return n<0?(e.scrollLeft=0,a=l(n)):n>r?(e.scrollLeft=r,a=l(n-r)):(a=0,t(),e.scrollLeft=n),a},resetOverscroll:t}}(e),a=()=>{null!==t.current.momentumId&&(cancelAnimationFrame(t.current.momentumId),t.current.momentumId=null)},l=()=>{a(),t.current.momentumId=requestAnimationFrame(d)},d=()=>{if(!e.current)return;let n=t.current;e.current.scrollLeft+=n.velX,n.velX*=.9,Math.abs(n.velX)>.5&&(n.momentumId=requestAnimationFrame(d))},s=()=>{let t=e.current;return!!t&&t.scrollWidth>t.clientWidth},c=n=>{let o=t.current;if(!o.isDragging||n.pointerId!==o.pointerId)return;window.removeEventListener("pointerup",c),window.removeEventListener("pointercancel",c),o.didDrag&&n.preventDefault(),o.isDragging=!1,o.overscrollX=r();let i=e.current;if(i&&(i.releasePointerCapture(n.pointerId),o.didDrag)){let e=e=>{e.preventDefault(),e.stopImmediatePropagation()};i.addEventListener("click",e,{capture:!0,once:!0}),setTimeout(()=>{i.removeEventListener("click",e,{capture:!0})},100),o.didDrag=!1}l()};return{props:{onPointerDown:n=>{if("mouse"!==n.pointerType||0!==n.button||n.ctrlKey||n.metaKey||n.shiftKey||n.altKey||!s()||!e.current)return;n.preventDefault();let o=t.current;o.isDragging=!0,o.didDrag=!1,o.startX=n.pageX,o.startY=n.pageY,o.startTime=Date.now(),o.scrollLeft=e.current.scrollLeft,o.pointerId=n.pointerId,a(),window.addEventListener("pointerup",c),window.addEventListener("pointercancel",c)},onPointerMove:o=>{let i=t.current;if(!i.isDragging||!e.current||o.pointerId!==i.pointerId||!s())return;o.preventDefault(),!i.didDrag&&function(e,t,n,o,i){let r=Math.abs(e-n),a=Math.abs(t-o),l=Date.now()-i;return r>2||a>2||l>50}(o.pageX,o.pageY,i.startX,i.startY,i.startTime)&&(e.current.setPointerCapture(o.pointerId),i.didDrag=!0);let r=o.pageX-i.startX,a=e.current.scrollLeft,l=i.scrollLeft-r;i.overscrollX=n(e.current,l,i.overscrollX),i.velX=e.current.scrollLeft-a},onLostPointerCapture:c},didDrag:()=>t.current.didDrag,hasOverflow:s}}},25479:function(e,t,n){n.d(t,{yk:()=>m,ze:()=>p});var o=n(16584),i=n(6400),r=n(30396),a=n(45578),l=n.n(a);n(60807);var d=n(59176);n(63651),n(54416);let s={surfaces:[],addSurface:()=>void 0},c=e=>{let[t,n]=(0,r.eJ)([]),o=(0,r.Ye)(()=>e?"".concat("user-recent-surfaces","-").concat(e.id):"",[e]);(0,r.d4)(()=>{if(!e)return;let t=(0,d.mM)(o);n(null!=t?t:[])},[e,o]);let i=(0,r.I4)(e=>{var t;let i=null!==(t=(0,d.mM)(o))&&void 0!==t?t:[],r="visited-publication"===e.type?{type:e.type,publication:{id:e.publication.id,name:e.publication.name,base_url:e.publication.base_url,logo_url:e.publication.logo_url,custom_domain:e.publication.custom_domain,custom_domain_optional:e.publication.custom_domain_optional,subdomain:e.publication.subdomain,theme:e.publication.theme,theme_var_background_pop:e.publication.theme_var_background_pop,author_photo_url:e.publication.author_photo_url,author:e.publication.author,cover_photo_url:e.publication.cover_photo_url}}:{type:e.type,profile:{name:e.profile.name,id:e.profile.id,photo_url:e.profile.photo_url}},a=l()([r,...i],e=>"visited-publication"===e.type?"pub-".concat(e.publication.id):"profile-".concat(e.profile.id)).slice(0,10);n(a);try{(0,d.ex)(o,a)}catch(e){console.error("Failed to update local recent surfaces:",e)}},[o]);return e?{surfaces:t,addSurface:i}:s},u=(0,i.createContext)(s);function p(){return(0,r.qp)(u)}function m(e){let{user:t,children:n}=e,{surfaces:i,addSurface:r}=c(t);return(0,o.tZ)(u.Provider,{value:{surfaces:i,addSurface:r},children:n})}},9799:function(e,t,n){n.d(t,{I:()=>f,M:()=>w});var o=n(7409),i=n(99282),r=n(16584),a=n(30396),l=n(23493),d=n.n(l),s=n(80569),c=n.n(s),u=n(95441),p=n(68833),m=n(70379),v=n(47929);let w=e=>{let t=(0,m.pm)(),{iString:n}=(0,u.M1)(),[l,s]=(0,a.eJ)(0),w=d()(e=>{s(e)},100),f=(0,a.I4)(async()=>{var t;let n,o;let i="/api/v1/video/upload/".concat(e.id,"/src.json?type=original"),{body:{src:r}}=await c().get(i),a=await fetch(r),l=null===(t=a.body)||void 0===t?void 0:t.getReader(),d=a.headers.get("Content-Length");if(!l||!d)throw Error("Failed to read the response body or content length is missing.");let u=parseInt(d),m=0,f=[];do{let e=await l.read();n=e.done,(o=e.value)&&(f.push(o),w((m+=o.length)/u*100))}while(!n);let h=new Blob(f),g=window.URL.createObjectURL(h),_=document.createElement("a");_.href=g,_.download="undefined"!==e.name&&e.name?e.name:"original.webm",_.target="_blank",_.rel="noopener noreferrer",_.style.display="none",document.body.appendChild(_),_.click(),document.body.removeChild(_),(0,p.j)(p.FP.VIDEO_CLIP_DOWNLOAD_BUTTON_CLICKED,{name:"download",post_id:e.post_id,utm_campaign:v.VX.substackClips,utm_medium:v.lP.web}),setTimeout(()=>s(0),200)},[e]);return{startDownload:()=>{s(0),f(),t.popToast(e=>(0,r.tZ)(m.FN,(0,i._)((0,o._)({},e),{text:n("Download started, do not close the window until download is completed")})))},downloadPercentage:l}},f=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"original",o="/api/v1/video/upload/".concat(e.id,"/src.json?type=").concat(n),{body:{src:i},status:r}=await c().get(o);if(r>=400){let e="there was an error generating the pre-signed url of the original source";throw console.warn(e),Error(e)}let a=await fetch(i);if(a.status>=400){let e="there was an error downloading the original source";throw console.warn(e),Error(e)}let l=await a.blob(),d=window.URL.createObjectURL(l),s=document.createElement("a");s.href=d,s.download=t?"".concat(t,".mp4"):"".concat(e.name),s.target="_blank",s.rel="noopener noreferrer",s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),(0,p.j)(p.FP.VIDEO_CLIP_DOWNLOAD_BUTTON_CLICKED,{name:"download",post_id:e.post_id,utm_campaign:v.VX.substackClips,utm_medium:v.lP.web})}}}]);