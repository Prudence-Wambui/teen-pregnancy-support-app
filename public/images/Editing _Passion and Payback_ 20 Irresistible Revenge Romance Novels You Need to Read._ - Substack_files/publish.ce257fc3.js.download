(()=>{"use strict";var e={32440:function(e,t,i){i.d(t,{Z:()=>n});let n={bubbleStack:"bubbleStack-umAMnU",bubble:"bubble-LfInju",linkBubble:"linkBubble-t8SyEH",paywallBubble:"paywallBubble-HIFC1C",imageGroup:"imageGroup-hmX9Za",hasFooter:"hasFooter-knDZrK",body:"body-SxXE9l",authorName:"authorName-RUTp3m",facepileAvatar:"facepileAvatar-F_BcFw",outgoing:"outgoing-zRoPvi",facepile:"facepile-_l_hyN",readMore:"readMore-OS5vSy",pixels:"pixels-dEQTfm",textLink:"textLink-TnmBfo",linkImg:"linkImg-kNOnWu",linkUrl:"linkUrl-LW11wp",linkTitle:"linkTitle-oVSOfX",reactionsWrapper:"reactionsWrapper-ls9Csz",actions:"actions-QkU3dI",avatarContainer:"avatarContainer-QgIACu",highlight:"highlight-pSh3e7","highlight-animation":"highlight-animation-kGdFb4",highlightAnimation:"highlight-animation-kGdFb4",isLast:"isLast-UDCLfj",quoteBox:"quoteBox-Dcal5K",quote:"quote-IkMApN",incoming:"incoming-yrKQPL",notFirst:"notFirst-MmF7_s",author:"author-naTBRq",hasUnread:"hasUnread-p_1CFW",noUnread:"noUnread-aWF1i8",paywallReplyTag:"paywallReplyTag-AnU7qK",media:"media-H8ykdm",center:"center-F91XRK",right:"right-dRUlyN",iconOnly:"iconOnly-pLEdW7",paywallFade:"paywallFade-jjuRAC",paywallBlur:"paywallBlur-yZ2js3",paywallText:"paywallText-s4FRye"}},37430:function(e,t,i){i.d(t,{Z:()=>n});let n={avatar:"avatar-KIJVyG",avatarOther:"avatarOther-uvAI8g",avatarOtherIcon:"avatarOtherIcon-FpqVMX",link:"link-OtwxxI",column:"column-ADckUl",row:"row-rF9rT4",button:"button-teBUKU",textFace:"textFace-jeUWz6"}},2180:function(e,t,i){i.d(t,{Z:()=>n});let n={container:"container-u4XWUV",label:"label-gARrM9",input:"input-rLnHxk",selectedInput:"selectedInput-RGkQnW"}},51885:function(e,t,i){i.d(t,{Z:()=>n});let n={mention:"mention-pnpTE1",mentionStatic:"mentionStatic-liMklk"}},7149:function(e,t,i){i.d(t,{Z:()=>n});let n={parentPush:"parentPush-_dbqSM",isPushDrawerOpen:"isPushDrawerOpen-yiZG2i",isClosed:"isClosed-gbnYZB",drawerWrapper:"drawerWrapper-YiGzd_"}},22233:function(e,t,i){i.d(t,{Z:()=>n});let n={icon:"icon-JCPlCw",toggleSetting:"toggleSetting-UDN_Qn",transcriptionPlayer:"transcriptionPlayer-eiECcl",hidePlayer:"hidePlayer-TfzId9",nonActiveText:"nonActiveText-JfTKb8",transcriptionChunk:"transcriptionChunk-bCQeJ2",editableChunk:"editableChunk-k4Fatu",startTime:"startTime-tjpyBE",text:"text-Ou5QC2",activeStartTime:"activeStartTime-ozZC_j",chunkWithSpeaker:"chunkWithSpeaker-iYPDkU",speaker:"speaker-GFTaOB",transcription:"transcription-hfRyWl",popover:"popover-tZdxdX",divider:"divider-ah0vWs",resultsValue:"resultsValue-uYlTxH",searchResult:"searchResult-_1_8Y9",isFocused:"isFocused-CIwNEb",searchForm:"searchForm-gEUJ79"}},20346:function(e,t,i){i.d(t,{Z:()=>n});let n={segment:"segment-LBFzmC",highlight:"highlight-U002IP"}},25390:function(e,t,i){i.d(t,{Z:()=>n});let n={personYouMayKnow:"personYouMayKnow-g7Alxo",personYouMayKnowFeed:"personYouMayKnowFeed-bb1Yh4",withSocialContext:"withSocialContext-bZjv3u",personYouMayKnowFeedButton:"personYouMayKnowFeedButton-JiQmpP",personYouMayKnowImage:"personYouMayKnowImage-peGMNI",personYouMayKnowMutuals:"personYouMayKnowMutuals-ZOuD6k",facepileLink:"facepileLink-N3nvHV",facepileFace:"facepileFace-_GchsT",shareProfile:"shareProfile-nfq3_a",fbConnect:"fbConnect-U6M5tm",avatarContainer:"avatarContainer-Bsasck",close:"close-kHICWg",badge:"badge-S8RI6g",badgeIcon:"badgeIcon-jk16vG"}},77859:function(e,t,i){i.d(t,{Z:()=>n});let n={messageBubbleGroup:"messageBubbleGroup-R4lEWb",bubble:"bubble-JnQPTp",isFirst:"isFirst-cID827",isLast:"isLast-YVpa0l",quote:"quote-NJ4bEy",paywallReplyTag:"paywallReplyTag-_3sIGO",outgoing:"outgoing-hqKZeu",forceIncomingTheme:"forceIncomingTheme-fBbXPp",body:"body-obaIpu",author:"author-M_vI8F","reactions-1":"reactions-1-O8o884",reactions1:"reactions-1-O8o884","reactions-2":"reactions-2-NrnldS",reactions2:"reactions-2-NrnldS","reactions-3":"reactions-3-iPVLb0",reactions3:"reactions-3-iPVLb0",youtubeIframe:"youtubeIframe-rlkjkW",highlight:"highlight-u2yyKp","highlight-animation":"highlight-animation-rBjpTz",highlightAnimation:"highlight-animation-rBjpTz",imageGroup:"imageGroup-KAnMHU bubble-JnQPTp",incoming:"incoming-jCFnDy",postImage:"postImage-eO7gd7",b4:"b4-xXB4IY",bubbs:"bubbs-qLKn32",bubb:"bubb-yci1Gp",isLink:"isLink-NGEdg6",linkImage:"linkImage-FDEYzZ",small:"small-PzwGAf",actions:"actions-utvBvN",actionsWrapper:"actionsWrapper-CEt9E2",dots:"dots-_BmXB7",dot:"dot-XjG0Z6",typing:"typing-vNx1zN",flip:"flip-OUTl4B"}},96164:function(e,t,i){i.d(t,{fg:()=>r}),i(69572);let n={user:"recentUserQ",pub:"recentPubQ",importsReviewPageSize:"importsReviewPageSize",importsReviewColumns:"importsReviewColumns"},r=()=>{"undefined"!=typeof localStorage&&(localStorage.getItem(n.user)&&localStorage.setItem(n.user,"[]"),localStorage.getItem(n.pub)&&localStorage.setItem(n.pub,"[]"),localStorage.removeItem(n.importsReviewPageSize),localStorage.removeItem(n.importsReviewColumns))}},93974:function(e,t,i){i.d(t,{Jg:()=>eu,V8:()=>eN,p6:()=>e2,xk:()=>e7,xn:()=>te});var n=i(7409),r=i(99282),o=i(98848),a=i(58865),l=i(16584);i(6400);var s=i(30396),d=i(94184),c=i.n(d),u=i(28175),p=i.n(u),h=i(10293),m=i(88812),g=i(85200),v=i(45609),b=i(99869),y=i(26141),f=i(7617),_=i(47976),Z=i(7073),w=i(49770),C=i(17048),x=i(27194),S=i(887),k=i(2564),B=i(13639),T=i(41293),I=i(36412),N=i(51534),P=i(45530),E=i(3880),X=i(20888);i(28905);var M=i(19548),A=i(95441),D=i(60807),R=i(37663),F=i(67348),L=i(68833),z=i(48980),O=i(12799),U=i(98914),Y=i(94874),H=i(17540),j=i(15771),J=i(80026),V=i(44424),q=i(63474),W=i(43570),G=i(70379),K=i(33451),Q=i(16913),$=i(32223),ee=i(97842),et=i(11308),ei=i(70125),en=i(64172),er=i(76820),eo=i(23398),ea=i(63651),el=i(32440),es=i(23710),ed=i(77859);function ec(){let e=(0,a._)(["You are not allowed to post or react to this chat. ",""]);return ec=function(){return e},e}function eu(e){var t,i,n;let{communityPost:r,author:o,pubRole:a,extras:d,withAttribution:c,flex:u,hideReply:p,isReadOnly:m,onReply:g,onDelete:v,pub:b,truncate:y=!0,surface:f,useClientSideRouting:_,utmSource:Z,isPaid:w,isFounding:C}=e,{iString:x}=(0,A.M1)(),S=(0,s.sO)(null),k=_?(0,ea.xC8)({pubId:r.publication_id,postId:r.id,noBase:!0}):(0,ea._5K)({postId:r.id,utm_source:Z}),B=(0,et.o)({entityType:"communityPost",publication:b}),T=(0,M.KG)(r.user_id);return(0,l.BX)(eA,{pubThemeAccentColor:null!==(n=null==b?void 0:null===(t=b.theme)||void 0===t?void 0:t.background_pop_color)&&void 0!==n?n:null==b?void 0:b.theme_var_background_pop,pubThemePrintOnPopColor:null==b?void 0:null===(i=b.theme)||void 0===i?void 0:i.print_on_pop,user:o,pubRole:a,flex:u,containerRef:S,extras:d,children:[c&&(0,l.tZ)(te,{text:"From ".concat(o.name,"â€™s subscriber chat")}),!T&&(0,l.tZ)(K.KV,{user:o}),(0,l.tZ)(em,{actionMenuProps:{communityEntity:r,publicationId:r.publication_id,replyAction:g&&!p&&(0,l.tZ)(V.sN,{leading:(0,l.tZ)(h.Z,{}),disabled:r.is_locked,onClick:g,children:x("Reply")}),onReply:m||p||r.is_locked?void 0:g,onDelete:v,onReport:B,isReadOnly:m,isFlagged:r.reported_by_user},flex:u,children:(0,l.tZ)(ep,{communityPost:r,hideReply:p,userBlockStatus:T,isFounding:C,isPaid:w,isReadOnly:m,useClientSideRouting:_,utmSource:Z,pub:b,truncate:y,surface:f,author:o})}),!p&&(0,l.tZ)(q.A0,{href:k,children:(0,l.tZ)(e3,{onClick:g,direction:"incoming",commenters:r.recent_commenters,count:r.comment_count,hasUnread:!!(r.most_recent_comment_created_at&&r.user_last_viewed_timestamp&&r.user_last_viewed_timestamp<r.most_recent_comment_created_at)})}),!p||r.body||r.link_metadata?(0,l.tZ)(K.aE,{direction:"incoming"}):null]})}function ep(e){let{communityPost:t,hideReply:i,userBlockStatus:o,isReadOnly:a,isFounding:s,isPaid:d,pub:u,surface:p,communityPostEmbedPostId:h,useClientSideRouting:m,utmSource:g,truncate:v,onReply:b,reactionsContext:y,handleReactionClick:f,reaction:_,reactions:Z,backAction:w,outline:C}=e,{images:x,video:S}=eh(t.mediaAttachments),k=!(x.length>0||S),B=null!=y?y:{type:"posts",id:t.id},{audience:T}=t,{canReply:I,shouldShowToken:N}=e6({audience:T,isFounding:s,isPaid:d,chatPaywallStatus:null==u?void 0:u.paywall_chat}),P=(0,ee.I0)(),X=m?(0,ea.xC8)({pubId:t.publication_id,postId:t.id,noBase:!0,params:{backAction:w}}):(0,ea._5K)({postId:t.id,utm_source:g}),M=function(e,t){if(!e||!(null==t?void 0:t.url))return e;let i=t.url,n=e.trim();return n.startsWith(i)?n.slice(i.length).trim():n.endsWith(i)?n.slice(0,-i.length).trim():e}(t.body,t.link_metadata),A=e=>{"feed-recommended"!==B.type&&(f?f({id:t.id,reaction:e}):eg(t.id,"posts",P,t.reaction)(e))},D=null!=_?_:t.reaction,F=null!=Z?Z:t.reactions,L=p&&(p.startsWith("chat_inbox")?"chat_inbox":(0,R.T)(p));return(0,l.BX)(eG,{hasFooter:!i,children:[!o&&"media"===t.type&&(x.length>0||S)&&(0,l.BX)($.c,{context:B,reactions:F,currentReaction:D,onReactionClick:A,isReadOnly:a,children:[S&&(0,l.tZ)(er.Jl,{mediaUpload:S.mediaUpload,composing:!1,maxWidth:400,videoPlayerProps:{surface:L,entityType:"community_post",entityKey:t.id,contentType:"communityPost",primaryEntityKey:h,primaryEntityType:h?"post":void 0}},S.mediaUpload.id),x&&(0,l.BX)(J.xu,{children:[(0,l.tZ)(E.E,{assets:x.filter(e=>e.url).map(e=>({src:e.url,explicit:e.explicit,width:e.width,height:e.height})),className:c()(el.Z.imageGroup,i&&!t.body&&el.Z.isLast),maxWidth:400,maxHeight:420,readOnly:a,isContained:!0,outline:C}),N&&!t.body&&(0,l.tZ)(e$,{className:el.Z.right,canReply:!!I,audience:t.audience,style:"media"})]})]}),!o&&t.link_metadata&&(0,l.tZ)($.c,{context:B,reactions:F,currentReaction:null!=_?_:t.reaction,onReactionClick:A,setReactions:!!(k&&t.link_metadata),isReadOnly:a,alignSelf:"stretch",children:(0,l.tZ)(K.xk,{metadata:t.link_metadata,isFirst:k,direction:"incoming"})}),(t.body||k&&!t.link_metadata)&&(0,l.tZ)($.c,{context:B,reactions:F,currentReaction:null!=_?_:t.reaction,onReactionClick:A,setReactions:k&&!t.link_metadata,isReadOnly:a,alignSelf:"stretch",children:M&&(0,l.tZ)(q.A0,{href:X,style:{display:"flex"},children:(0,l.tZ)(eQ,{publication:u,communityEntity:(0,r._)((0,n._)({},t),{body:M}),onClick:e=>{!e.defaultPrevented&&b&&b(e)},truncate:v,isPaid:d,isFounding:s,outline:C})})})]})}let eh=e=>{let t=[],i=null;for(let n of e)"image"===n.type?t.push(n):i||(i=n);return{images:t,video:i}};function em(e){let{children:t,actionMenuProps:i,flex:r="grow"}=e;return(0,l.BX)(J.gq,{alignItems:"start",gap:12,flex:r,children:[(0,l.tZ)(K.pc,{children:t}),(0,l.tZ)(eF,(0,n._)({},i))]})}let eg=(e,t,i,n)=>async r=>{n===r?i(eb(r,e,t)):i(ev(r,e,t,n))},ev=(e,t,i,n)=>async(r,o)=>{let{iString:a,iTemplate:l}=I18N.i("en");r({type:"".concat(i,"-new_reaction"),payload:{id:t,reaction:e}});let s=await (0,T.oQ)(e,t,i);if(s instanceof z.kp){var d,c;(null===(d=s.body)||void 0===d?void 0:d.status)==="PUBLICATION_BAN"?alert(l(ec(),null===(c=s.body)||void 0===c?void 0:c.error)):alert(a("We failed to post your comment. Please try again later."))}s instanceof Error&&r(n?{type:"".concat(i,"-new_reaction"),payload:{id:t,reaction:n}}:{type:"".concat(i,"-remove_reaction"),payload:{id:t,reaction:e}})},eb=(e,t,i)=>async(n,r)=>{n({type:"".concat(i,"-remove_reaction"),payload:{id:t,reaction:e}}),await (0,T.aQ)(e,t,i) instanceof Error&&n({type:"".concat(i,"-new_reaction"),payload:{id:t,reaction:e}})},ey=(e,t)=>async(i,n)=>{i({type:"posts-delete_post",payload:{id:e,publication_id:t}});let r=await eI(e);r instanceof Error&&console.warn("error deleting thread",r)},ef=(e,t,i)=>async(n,r)=>{n({type:"comments-delete_comment",payload:{id:e,postId:t}});let o=await ek(e);if(o instanceof Error&&console.warn("error deleting comment",o),i){let e=await eB(i);e instanceof Error||n({type:"comments-update_comment",payload:{id:i,comment:e.comment}})}let a=await eT(t);a instanceof Error||n({type:"posts-update_post",payload:{id:t,post:a.communityPost}})},e_=(e,t)=>async(i,n)=>{i({type:"posts-lock_replies",payload:{id:e,isLocked:t}});let r=await eC(e,t);r instanceof Error&&(console.warn("error locking post",r),alert("There was an error ".concat(t?"locking":"unlocking"," replies to this post. Please try again later.")),i({type:"posts-lock_replies",payload:{id:e,isLocked:!t}}))},eZ=(e,t)=>async(i,n)=>{i({type:"comments-lock_replies",payload:{id:e,isLocked:t}});let r=await ex(e,t);r instanceof Error&&(console.warn("error locking comment",r),alert("There was an error ".concat(t?"locking":"unlocking"," replies to this comment. Please try again later.")),i({type:"comments-lock_replies",payload:{id:e,isLocked:!t}}))},ew=(e,t)=>async(i,n)=>{i({type:"comments-ban_author",payload:{id:e,ban:t}});let r=await eS(e,t);r instanceof Error&&(console.warn("error toggling ban for comment author",r),alert("There was an error ".concat(t?"banning":"unbanning"," this user. Please try again later.")),i({type:"comments-ban_author",payload:{id:e,ban:!t}}))};async function eC(e,t){try{return await fetch("/api/v1/community/posts/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_locked:t})})}catch(e){return e}}async function ex(e,t){try{return await fetch("/api/v1/community/comments/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_locked:t})})}catch(e){return e}}async function eS(e,t){try{return await fetch("/api/v1/community/comments/".concat(e,"/publication_bans?ban=").concat(t.toString()),{method:"POST"})}catch(e){return e}}async function ek(e){try{return await (0,z.rd)("/api/v1/community/comments/".concat(e),{method:"DELETE",json:{commentId:e}})}catch(e){return e}}async function eB(e){try{return await (0,z.rd)("/api/v1/community/comments/".concat(e),{method:"GET"})}catch(e){return console.warn(e),e}}async function eT(e){try{return await (0,z.rd)("/api/v1/community/posts/".concat(e),{method:"GET"})}catch(e){return console.warn(e),e}}async function eI(e){try{return await (0,z.rd)("/api/v1/community/posts/".concat(e),{method:"DELETE",json:{postId:e}})}catch(e){return e}}function eN(e){let{author:t,extras:i,showReply:o=!0,analyticsParams:a,commenters:d,count:c,audience:u,paywallInfo:p,onClick:h}=e;return(0,s.d4)(()=>{var e;a&&(0,L.j)(L.FP.THREAD_PAYWALL_SCREEN_VIEWED,(0,r._)((0,n._)({},a),{audience:u&&("only_founding"===(e=u)?"founding":"only_paid"===e?"paid":"free")}))},[]),(0,l.BX)(eA,{user:t,extras:i,children:[t&&(0,l.tZ)(K.KV,{user:t}),(0,l.BX)(eG,{children:[p?(0,l.tZ)(e5,{audience:u,paywallInfo:p,onClick:h}):(0,l.tZ)(e8,{audience:u,onClick:h}),o&&(0,l.tZ)(e3,{isLocked:!0,direction:"incoming",commenters:d,count:c,onClick:h})]})]})}function eP(e){return"string"==typeof e.message}function eE(e){let{text:t,rawText:i,specialText:n,mentionMap:r,direction:o="incoming",limit:a=600,linkify:d=!0}=e,{iString:u}=(0,A.M1)(),[p,h]=(0,s.eJ)(!1);if(n)return(0,l.tZ)("em",{children:n});if(!t)return(0,l.tZ)(l.HY,{});let m=[{characters:t.length,message:t}];i&&r&&(m=function(e,t,i){let n=/\$\{(\d+)\}/g,r=n.exec(e),o=[],a=0;for(;r;){var s,d,c,u;let p=t[Number(r[1])],h=p.text.slice(1);p?(r.index>a&&o.push({characters:r.index-a,message:e.slice(a,r.index)}),o.push({characters:p.text.length,message:(s=p.user_id,d=0,c=h,u=i,(0,l.tZ)(F.p,{id:s,label:c,type:"user",unstyled:"outgoing"===u}))})):o.push({characters:n.lastIndex-a,message:e.slice(a,n.lastIndex)}),a=n.lastIndex,r=n.exec(e)}return a<e.length&&o.push({characters:e.length-a,message:e.slice(a)}),o}(i,r,o));let{alwaysShow:g,afterExpansion:v}=function(e,t){let i=0,n=[],r=[];for(let o of e){let e=o;if(i<t){if(i+e.characters>t&&eP(e)){let n=t-i,o={characters:n,message:e.message.slice(0,n)},a={characters:e.characters-n,message:e.message.slice(n)};e=o,r.push(a)}i+=e.characters,n.push(e)}else r.push(e)}return{alwaysShow:n,afterExpansion:r}}(m,a),b=v.length>0;return(0,l.BX)(l.HY,{children:[g.map(e=>d&&eP(e)?(0,l.tZ)(eX,{children:e.message}):e.message),b&&!p&&(0,l.BX)(l.HY,{children:[(0,l.tZ)("span",{children:" "}),(0,l.tZ)(j.kG,{resetCss:!0,className:c()(el.Z.readMore,el.Z[o]),onClick:e=>{e.preventDefault(),h(!0)},children:u("See more")})]}),b&&p&&(0,l.tZ)(l.HY,{children:v.map(e=>d&&eP(e)?(0,l.tZ)(eX,{children:e.message}):e.message)})]})}function eX(e){let{children:t}=e;return(0,l.tZ)(p(),{options:{attributes:{rel:"nofollow ugc",onClick:e=>e.stopPropagation()},className:el.Z.textLink,format:(e,t)=>"url"===t?(0,eo.u)(e,64):e},children:t})}function eM(e){return void 0===e.post_id}function eA(e){var t;let{user:i,children:n,extras:r,flex:o="grow",containerRef:a,id:s,pubRole:d,pubThemeAccentColor:u,pubThemePrintOnPopColor:p}=e,h=(0,M.KG)(null!==(t=null==i?void 0:i.id)&&void 0!==t?t:0);return(0,l.BX)(J.tu,{id:s,flex:o,gap:2,ref:a,className:c()(es.Z.reactionsHoverZone,el.Z.avatarContainer),children:[(0,l.BX)(J.hs,{alignItems:"end",gap:12,children:[(0,l.tZ)(J.hs,{paddingTop:4,children:h?(0,l.tZ)(eD,{user:i}):i?(0,l.tZ)(tt,{pubThemeAccentColor:u,pubThemePrintOnPopColor:p,user:i,pubRole:d,size:32}):(0,l.tZ)(eR,{})}),(0,l.tZ)(J.tu,{flex:"grow",gap:2,position:"relative",alignItems:"start",children:n})]}),r&&(0,l.BX)(J.hs,{gap:12,children:[(0,l.tZ)(J.xu,{width:32}),(0,l.tZ)(J.tu,{flex:"grow",gap:4,children:r})]})]})}function eD(e){let{user:t}=e;return(0,l.tZ)(q.A0,{href:t?(0,ea.NNq)(t,{noBase:!0}):void 0,children:(0,l.tZ)(eR,{children:(0,l.tZ)(m.Z,{size:20,color:"var(--color-fg-tertiary)"})})})}let eR=(0,q.zo)({radius:"full",width:32,height:32,bg:"secondary"},q.M5);function eF(e){var{isNew:t}=e,i=(0,o._)(e,["isNew"]);if(t)return null;let{onNewQuote:r,onReply:a,communityEntity:s}=i;return(0,l.BX)(J.hs,{alignItems:"center",gap:4,className:el.Z.actions,children:[r&&s&&(0,l.tZ)(ez,{onNewQuote:r,communityComment:s}),a&&s&&(0,l.tZ)(eO,{onReply:a}),(0,l.tZ)(V.v2,{trigger:(0,l.tZ)(j.hU,{"aria-label":"Options",size:"sm",priority:"tertiary",children:(0,l.tZ)(g.Z,{size:20})}),hideOnScroll:!0,children:(0,l.tZ)(eL,(0,n._)({},i))})]})}function eL(e){let{communityEntity:t,replyAction:i,onDelete:n,onReport:r,isReadOnly:o,publicationId:a,isBanned:s,isFlagged:d,onNewQuote:c}=e,u=(0,D.aF)(),{isAuthor:p}=(0,en.Y0)(null!=a?a:0),h=a&&p,m=t&&u&&t.user_id===u.id,g=t&&!eM(t),v=g&&"parent_id"in t&&null!==t.parent_id,b=m||h,y=m||h,f=!m&&!d,_=h&&g&&!m,Z=!g&&u&&(null==t?void 0:t.user_id)===u.id;return t?(0,l.BX)(l.HY,{children:[(0,l.tZ)(eH,{communityEntity:t}),t.body&&(0,l.tZ)(eY,{communityEntity:t}),!o&&c&&g&&(0,l.tZ)(eU,{onNewQuote:c,communityComment:t}),!o&&i,Z&&(0,l.tZ)(eJ,{communityEntity:t}),(0,l.BX)(V.xw,{children:[!o&&!v&&y&&(0,l.tZ)(ej,{communityEntity:t}),!o&&b&&(0,l.tZ)(eW,{communityEntity:t,onDelete:n}),!o&&void 0!==s&&_&&(0,l.tZ)(eq,{communityEntity:t,isBanned:s}),!o&&f&&(0,l.tZ)(eV,{onReport:r,communityEntity:t})]}),(0,l.tZ)(V.dW,{children:(0,l.tZ)(J.hs,{paddingY:4,children:(0,l.tZ)(Q.E,{conjunction:!0,timestamp:t.created_at})})})]}):null}function ez(e){let{onNewQuote:t,communityComment:i}=e;return(0,l.tZ)(j.hU,{size:"sm",priority:"tertiary","aria-label":"Reply",onClick:()=>{t(i)},children:(0,l.tZ)(h.Z,{size:20})})}function eO(e){let{onReply:t}=e;return(0,l.tZ)(j.hU,{size:"sm",priority:"tertiary","aria-label":"Reply",onClick:t,children:(0,l.tZ)(h.Z,{size:20})})}function eU(e){let{onNewQuote:t,communityComment:i}=e,{iString:n}=(0,A.M1)();return(0,l.tZ)(V.sN,{leading:(0,l.tZ)(h.Z,{}),onClick:()=>{t(i)},children:n("Reply")})}function eY(e){let{communityEntity:t}=e,{iString:i}=(0,A.M1)(),o=(0,G.pm)();return(0,l.tZ)(V.sN,{leading:(0,l.tZ)(v.Z,{}),onClick:()=>{if(t){let{body:e}=t;(0,U.vQ)(e),o.popToast(e=>(0,l.tZ)(G.FN,(0,r._)((0,n._)({},e),{text:i("Text copied to clipboard"),Icon:v.Z})))}},children:i("Copy text")})}function eH(e){let{communityEntity:t}=e,{iString:i}=(0,A.M1)(),n=(0,O.g)(),{id:r}=t,o=eM(t);return(0,l.tZ)(V.sN,{leading:(0,l.tZ)(b.Z,{}),onClick:()=>{let e;if(o)e=(0,ea._5K)({postId:r});else if(t.parent_id){var i;e=(0,ea.lsD)({commentId:null!==(i=t.parent_id)&&void 0!==i?i:r,targetReplyId:t.parent_id?r:void 0,showTarget:!0})}else e=(0,ea._5K)({postId:t.post_id,targetReplyId:t.id,showTarget:!0});n(e)},children:i("Copy link")})}function ej(e){let{communityEntity:t}=e,{iString:i}=(0,A.M1)(),o=(0,ee.I0)(),a=(0,G.pm)(),{id:s,is_locked:d}=t,c=eM(t),u=async()=>{c?o(e_(s,!d)):o(eZ(s,!d)),d?a.popToast(e=>(0,l.tZ)(G.FN,(0,r._)((0,n._)({},e),{text:i("Enabled replies"),Icon:f.Z}))):a.popToast(e=>(0,l.tZ)(G.FN,(0,r._)((0,n._)({},e),{text:i("Disabled replies"),Icon:y.Z})))};return(0,l.tZ)(V.sN,{leading:(0,l.tZ)(y.Z,{}),onClick:u,priority:"destructive",children:d?i("Re-enable replies"):i("Disable replies")})}function eJ(e){let{communityEntity:t}=e,i=(0,ee.I0)(),n=eM(t),r=async()=>{n&&i({type:"posts-edit_post",payload:{post:t}})};return(0,l.tZ)(V.sN,{leading:(0,l.tZ)(_.Z,{}),onClick:r,priority:"primary",children:"Edit"})}function eV(e){let{onReport:t,communityEntity:i}=e,{iString:n}=(0,A.M1)();return(0,l.tZ)(l.HY,{children:(0,l.tZ)(V.sN,{leading:(0,l.tZ)(Z.Z,{}),onClick:()=>{t(i.id,"admin"!==i.user_pub_role)},priority:"destructive",children:n("Report")})})}function eq(e){let{communityEntity:t,isBanned:i}=e,{iString:n}=(0,A.M1)(),r=(0,ee.I0)(),o=async()=>{if(confirm("Are you sure you want to ban this user?")){let{id:e}=t;r(ew(e,!i))}};return(0,l.tZ)(V.sN,{leading:i?(0,l.tZ)(w.Z,{}):(0,l.tZ)(C.Z,{}),onClick:o,priority:"destructive",children:n(i?"Unban":"Ban")})}function eW(e){let{communityEntity:t,onDelete:i}=e,{iString:n}=(0,A.M1)(),r=(0,ee.I0)(),o=eM(t),a=async()=>{if(confirm("Are you sure you want to delete this ".concat(o?"thread":"comment","?"))){let{id:e}=t;if(o){let{publication_id:i}=t;r(ey(e,i))}else{let{post_id:i,parent_id:n}=t;r(ef(e,i,n))}i&&setTimeout(i,500)}};return(0,l.tZ)(V.sN,{leading:(0,l.tZ)(x.Z,{}),onClick:a,priority:"destructive",children:n("Delete")})}function eG(e){var{hasFooter:t}=e,i=(0,o._)(e,["hasFooter"]);return(0,l.tZ)(J.tu,(0,n._)({className:c()(el.Z.bubbleStack,t&&el.Z.hasFooter),gap:2,alignItems:"start"},i))}function eK(e){var{isTargeted:t,className:i}=e,r=(0,o._)(e,["isTargeted","className"]);return(0,l.tZ)(J.tu,(0,n._)({className:c()(el.Z.bubble,t&&el.Z.highlight,i),sizing:"border-box",paddingY:8,paddingX:12,bg:"secondary",minWidth:0,gap:8},r))}function eQ(e){let{communityEntity:t,publication:i,isTargeted:n,onClick:r,truncate:o=!0,isPaid:a,isFounding:s,outline:d}=e,{audience:c}=t,{canReply:u,shouldShowToken:p}=e6({audience:c,isFounding:s,isPaid:a,chatPaywallStatus:null==i?void 0:i.paywall_chat}),h=p||t.is_edited,m=t.reactions?Object.keys(t.reactions).length:0;return(0,l.BX)(eK,{isTargeted:n,onClick:r,className:ed.Z[m>0?"reactions-".concat(m):""],outline:d,children:[(0,l.tZ)(e4,{communityEntity:t,truncate:o}),h&&(0,l.BX)(J.gq,{justifyContent:"end",gap:2,children:[p&&(0,l.tZ)(e$,{canReply:!!u,audience:c}),t.is_edited&&(0,l.tZ)(e1,{})]})]})}function e$(e){let{canReply:t,audience:i,style:n="default",showLabel:r=!0,className:o}=e,a=r?"media"===n?"var(--vibrance-primary)":"var(--color-chat-incoming-fg-primary)":"var(--color-fg-primary)";return(0,l.BX)(W.Vp,{className:c()(el.Z.paywallReplyTag,"media"===n&&el.Z.media,!r&&el.Z.iconOnly,o),priority:"secondary",children:[t?(0,l.tZ)(P.Z,{size:12,color:a}):(0,l.tZ)(N.Z,{size:12,color:a}),r&&(0,l.tZ)(J.xv.B5,{weight:"medium",children:e0.get(i)})]})}let e0=new Map([["only_paid","Paid subscribers only"],["only_paid_replies","Paid subscriber replies"],["only_founding","Founding members only"],["only_founding_replies","Founding member replies"]]);function e1(){return(0,l.BX)(W.Vp,{className:el.Z.paywallReplyTag,priority:"secondary",children:[(0,l.tZ)(S.Z,{size:12}),(0,l.tZ)(J.xv.B5,{weight:"medium",children:"Edited"})]})}function e2(e){let{author:t,body:i,direction:n,onClick:r,children:o,isFirst:a=!0,pubThemeBackgroundColor:s,isAuthorContributor:d}=e,u="incoming"===n&&d,p=u&&s;return(0,l.tZ)(J.hs,{pullX:4,children:(0,l.BX)(J.hs,{gap:12,className:c()(el.Z.quote,el.Z[n],!a&&el.Z.notFirst,u&&el.Z.author),onClick:r,radius:"md",overflow:"hidden",padding:8,flex:"grow",style:{"--color-chat-author-bg-overlay":p?"".concat(s,"33"):"rgba(var(--color-bg-accent-themed-rgb), 0.2)"},children:[(0,l.BX)(J.tu,{children:[(0,l.tZ)(J.xv.B4,{weight:"bold",children:null!=t?t:""}),(0,l.tZ)(J.xv.B3,{clamp:2,isParagraph:!0,children:i})]}),o]})})}function e4(e){var t,i,n,r,o;let{communityEntity:a,truncate:s=!0}=e,d=null,c=eM(a)?"thread":"reply";a.reported_by_user&&(d="You reported this ".concat(c)),"deleted"!==a.status&&a.body||(d="This ".concat(c," is not available"));let u=(0,M.KG)(a.user_id);d||"blocking"!==u?d||"blocked"!==u||(d="This person is blocked"):d="This person blocked you";let p=null!==(t=a.raw_body)&&void 0!==t?t:a.body;return p?eM(a)&&a.link_url&&!a.link_metadata&&(p="".concat(p,"\n\n").concat(a.link_url).trim()):eM(a)?(null===(n=a.media_assets)||void 0===n?void 0:n.length)?d="".concat(a.media_assets.length," ").concat(a.media_assets.length>1?"photos":"photo","."):a.link_url&&(a.link_metadata?d='Link: "'.concat(a.link_metadata.title,'"'):(p=a.link_url,d=null)):(null===(i=a.media_uploads)||void 0===i?void 0:i.length)&&(d="".concat(a.media_uploads.length," ").concat(a.media_uploads.length>1?"photos":"photo",".")),(0,l.tZ)(J.xv.B3,{className:el.Z.body,isParagraph:!0,children:(p||d)&&(0,l.tZ)(eE,{text:p,rawText:null!==(r=a.raw_body)&&void 0!==r?r:"",mentionMap:Array.isArray(a.mentions)?void 0:null!==(o=a.mentions)&&void 0!==o?o:void 0,specialText:d,limit:s?void 0:9999999})})}function e3(e){let{isLocked:t,count:i=0,commenters:n,hasUnread:r,onClick:o,direction:a,outline:s}=e,{iString:d,iPlural:u}=(0,A.M1)();return(0,l.tZ)(K.xj,{isLast:!0,messageDirection:a,onClick:o,cursor:o?"pointer":void 0,height:36,paddingY:4,paddingRight:12,paddingLeft:12,outline:s,children:(0,l.BX)(J.hs,{justifyContent:"space-between",alignItems:"center",gap:32,children:[(0,l.BX)(J.hs,{alignItems:"center",gap:8,children:[n&&i>0&&(0,l.tZ)(J.hs,{className:el.Z.facepile,alignItems:"center",children:n.map(e=>(0,l.tZ)(Y.qE,{className:c()(el.Z.facepileAvatar,"outgoing"===a&&el.Z.outgoing),user:e,size:22}))}),(0,l.tZ)(J.hs,{gap:8,alignItems:"center",children:(0,l.tZ)(J.xv.B3,{as:"span",className:r?el.Z.hasUnread:el.Z.noUnread,children:0===i?d("Leave a reply"):u("%1 reply","%1 replies",i)})})]}),t?(0,l.tZ)(N.Z,{size:14,color:"var(--color-chat-fg-secondary)"}):(0,l.tZ)(k.Z,{size:20,stroke:r?"var(--color-chat-reply-active)":"var(--color-chat-fg-secondary)"})]})})}function e8(e){let{audience:t,href:i,onClick:n}=e;return(0,l.tZ)(J.tu,{className:el.Z.paywallBubble,as:i?"a":"div",onClick:n,cursor:n?"pointer":void 0,alignSelf:"stretch",alignItems:"center",justifyContent:"center",bg:"secondary",href:i,target:i?"_blank":void 0,children:(0,l.BX)(J.hs,{alignItems:"center",gap:4,children:[(0,l.tZ)(B.Z,{size:12,stroke:"var(--color-fg-secondary)"}),(0,l.tZ)(J.xv.Meta,{weight:"semibold",children:"only_founding"===t?"FOUNDING MEMBERS ONLY":"only_paid"===t?"PAID SUBSCRIBERS ONLY":"SUBSCRIBERS ONLY"})]})})}function e6(e){let{audience:t,isFounding:i,isPaid:n,chatPaywallStatus:r}=e,o=["only_founding","only_founding_replies"].includes(t);return{canReply:i||"all_subscribers"===t||n&&["only_paid","only_paid_replies"].includes(t),shouldShowToken:r&&("free"===r&&"all_subscribers"!==t||"paid"===r&&o)}}function e5(e){let{paywallInfo:t,audience:i,onClick:n}=e,{mediaAttachments:r}=t,{body:o}=t,a=r[0];return o||a||(o=[,,,,].fill("Blah blah blah blahhhhh blah.").join(" ")),(0,l.BX)(l.HY,{children:[a&&(0,l.tZ)(J.tu,{position:"relative",children:(0,l.tZ)(E.E,{className:el.Z.ImageGrid,assets:[{src:a.thumb_url,width:a.width,height:a.height,explicit:!1}],maxWidth:400,maxHeight:420,readOnly:!0,isContained:!0,children:(0,l.tZ)(e9,{className:el.Z.paywallFade,children:(0,l.tZ)(e$,{canReply:!1,audience:null!=i?i:"only_paid",style:"media",showLabel:!o,className:o?el.Z.right:el.Z.center})})})}),o&&(0,l.BX)(eK,{className:el.Z.bubble,onClick:n,children:[(0,l.tZ)(J.xv.B3,{className:el.Z.paywallText,isParagraph:!0,children:o}),(0,l.tZ)(e9,{className:c()(el.Z.paywallFade,el.Z.paywallBlur),children:(0,l.tZ)(J.xu,{className:el.Z.paywallReplyTagAbsolute,children:(0,l.tZ)(e$,{canReply:!1,audience:null!=i?i:"only_paid",style:"media"})})})]})]})}let e9=(0,q.zo)({position:"absolute",inset:0,alignItems:"center",justifyContent:"center"},q.sg);function e7(e){let{linkUrl:t,linkMetadata:i,postId:n}=e,r=(0,ee.I0)(),{data:o}=(0,ei.y)(t,{auto:!i,onReceive:e=>{n&&r({type:"posts-link_metadata",payload:{id:n,link_metadata:e}})}}),a=null!=i?i:o;if(!a)return null;let s=null==a?void 0:a.title,d=null==a?void 0:a.image,c=null==a?void 0:a.host;return(0,l.tZ)(eK,{alignSelf:"stretch",children:(0,l.BX)(J.hs,{as:"a",href:t,target:"_blank",className:el.Z.linkBubble,onClick:e=>e.stopPropagation(),gap:12,justifyContent:"center",bg:"secondary",alignItems:"start",flex:"grow",sizing:"border-box",paddingY:4,minWidth:0,children:[(0,l.BX)(J.tu,{minWidth:0,gap:2,flex:"grow",children:[c&&(0,l.tZ)(J.xv.B4,{color:"secondary",ellipsis:!0,children:c}),s&&(0,l.tZ)(J.xv.B3,{color:"primary",weight:"medium",clamp:2,children:s})]}),d&&(0,l.tZ)(J.tu,{radius:"md",overflow:"hidden",bg:"tertiary",children:(0,l.tZ)(X.e,{src:d,maxWidth:64,useRetinaSizing:!0,imageIsFixedWidth:!0,imageProps:{smartCrop:!0,aspect:"1:1"}})})]})})}function te(e){let{text:t,isStatic:i}=e;return(0,l.tZ)(J.hs,{paddingX:8,paddingY:4,children:(0,l.BX)(J.xv.B5,{color:"secondary",weight:"semibold",children:[(0,l.tZ)(I.Z,{strokeWidth:2,height:12,stroke:"#808080",fill:"transparent",isStatic:i})," ",t]})})}function tt(e){let t,{user:i,size:n,pubRole:r,className:o,disabled:a,pubThemeAccentColor:s,pubThemePrintOnPopColor:d}=e;return(null==r?void 0:r.role)==="admin"||(null==r?void 0:r.role)==="contributor"?t="author":(null==r?void 0:r.is_founding)?t="founding":(null==r?void 0:r.membership_state)==="subscribed"&&(t="paid"),(0,l.tZ)(H.zY,{tier:t,fgOverride:d,bgOverride:s,children:(0,l.tZ)(Y.xV,{user:i,size:n,className:o,disabled:a,linkProps:{target:"_blank"},noBase:!0})})}},12936:function(e,t,i){i.d(t,{Su:()=>l}),i(16584);var n=i(6400),r=i(30396);i(53836),i(97742),i(70522),i(57391),i(95441),i(68833),i(62981),i(98914),i(15771),i(19081),i(58175);var o=i(66611);i(60308),i(63651);let a=(0,n.createContext)({hidden:!1});function l(){let{setHidden:e}=(0,r.qp)(a);return()=>null==e?void 0:e(!0)}(0,o.L)("app-banner"),(0,o.L)("app-banner-text")},42694:function(e,t,i){i.d(t,{QD:()=>y,Y0:()=>f,pI:()=>b});var n=i(16584),r=i(30396),o=i(94184),a=i.n(o),l=i(68494);i(80569);var s=i(20253),d=i(13304);i(95441);var c=i(40647),u=i(68833),p=i(62981),h=i(15771),m=i(63651),g=i(84864);let v=function(){let{children:e,dismissKey:t,dismissDurationInSeconds:i,beforeDismiss:r,className:o,level:l="info"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[s,c]=(0,p.Z)(t,i,r);return s?null:(0,n.BX)("div",{className:a()("banner",l,o),children:[e,(0,n.tZ)(d.Z,{width:12,height:12,className:"banner-close",onClick:e=>{e.preventDefault(),e.stopPropagation(),c()}})]})},b=e=>{let{}=e;return(0,r.d4)(()=>{(0,u.j)(u.FP.GO_PAID_CTA_SHOWN,{type:"banner"})},[]),(0,n.BX)(v,{dismissKey:"go-paid-banner.dismissed",dismissDurationInSeconds:3*g.WEEK_IN_SECONDS,beforeDismiss:()=>{(0,u.j)(u.FP.GO_PAID_CTA_DISMISSED,{type:"banner"})},children:[(0,n.tZ)(l.Z,{fill:"var(--print_pop)",strokeWidth:0,className:"go-paid-banner-bell"}),(0,n.tZ)("a",{href:"/publish/settings#connect",native:!0,onClick:()=>{(0,u.j)(u.FP.GO_PAID_CTA_CLICKED,{type:"banner"})},children:"Turn on paid subscriptions"})," ",(0,n.tZ)("span",{className:"go-paid-banner-text",children:"to get paid for your writing"})]})},y=e=>{let{action:t="connect"}=e,{getConfigFor:i}=(0,c.xR)(),[o,a]=(0,r.eJ)(!1);return o||!i("twitter_connect_flows_enabled")?null:(0,n.BX)(v,{level:"setup",dismissKey:"setup-twitter-banner.dismissed",beforeDismiss:()=>{(0,u.j)(u.FP.SETUP_TWITTER_CTA_DISMISSED,{type:"banner"})},children:[(0,n.tZ)("div",{className:"setup-twitter-banner-header",children:"Help more readers discover your writing"}),(0,n.tZ)("p",{children:"Connect your Twitter account so we can notify your followers about your Substack."}),"connect"===t&&(0,n.tZ)(h.zx,{className:"primary",onClick:()=>{(0,u.j)(u.FP.SETUP_TWITTER_CTA_CONNECT_CLICKED,{type:"banner"}),location.href=(0,m.ISD)({type:"connect_pub"})},children:"Connect Twitter"}),"set-discoverable"===t&&(0,n.BX)(s.ZP,{className:"minimal",action:"/api/v1/twitter/set-discoverable",method:"put",onSuccess:()=>a(!0),children:[(0,n.tZ)("input",{type:"hidden",name:"d",value:"true"}),(0,n.tZ)(h.zx,{priority:"primary",type:"submit",onClick:()=>(0,u.j)(u.FP.SETUP_TWITTER_CTA_SETDISCOVERABLE_CLICKED,{type:"banner"}),children:"Turn on Discoverability"})]}),(0,n.tZ)("div",{className:"twitter-permission-notice",children:"We never tweet without your explicit permission"})]})},f=function(){let{children:e,className:t,level:i="info",onClose:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[l,s]=(0,r.eJ)(!1);return l&&"error"!==i?null:(0,n.BX)("div",{className:a()("banner",i,t),children:["error"!==i&&(0,n.tZ)(d.Z,{width:12,height:12,className:"banner-close",onClick:e=>{e.preventDefault(),e.stopPropagation(),o&&o(),s(!0)}}),e]})}},23254:function(e,t,i){i.d(t,{OZ:()=>m,f8:()=>h});var n=i(16584);i(6400);var r=i(30396),o=i(40423),a=i(80569),l=i.n(a),s=i(42725),d=i(61649);i(45405);var c=i(94442);i(75697),i(12281);var u=i(68833),p=i(62981);i(93687),i(98914),i(71068),i(15771),i(61254),i(19081),i(6490),i(98248),i(58175),i(60308),i(93370),i(9799),i(89451);let h=e=>{let[t,i]=(0,r.eJ)(null),[n,o]=(0,r.eJ)(null),[a]=(0,r.eJ)(!0),[s,d]=(0,r.eJ)(null),[c,u]=(0,r.eJ)(null),p=async()=>{let t=await l().get("/api/v1/video/upload/".concat(e));i(t.body);let{id:r,state:a}=t.body;if(["uploaded","transcoded"].includes(a)&&!n){let{body:{src:e}}=await l().get("/api/v1/video/upload/".concat(r,"/src.json?type=original"));o(e)}},h=async()=>{let{mux_asset:t,mux_preview_asset:i}=(await l().get("/api/v1/video/upload/".concat(e,"/assets"))).body;d(t),u(i)};return(0,r.d4)(()=>{p(),h()},[e]),(0,r.d4)(()=>{let r=setInterval(()=>{let a=async()=>{let t=await l().get("/api/v1/video/upload/".concat(e)),{id:a,mux_rendition_quality:s,state:d}=t.body;if(i(t.body),s&&clearInterval(r),["uploaded","transcoded"].includes(d)&&!n){let{body:{src:e}}=await l().get("/api/v1/video/upload/".concat(a,"/src.json?type=original"));o(e)}else h()};(null==t?void 0:t.state)==="error"?(console.warn("error creating clip"),clearInterval(r)):(null==t?void 0:t.mux_rendition_quality)?clearInterval(r):a()},5e3);return()=>{clearInterval(r)}},[t]),{mediaUpload:t,loading:a,downloadUrl:n,muxAsset:s,muxPreviewAsset:c}},m=e=>{var t;let{post:i,mediaUpload:r,disabled:a,style:l}=e,[,h]=(0,p.Z)(s.pc),{onStartClipping:m}=(0,d.Sr)(),g=(null!==(t=null==r?void 0:r.duration)&&void 0!==t?t:0)>5;return(0,n.tZ)(c.Ng,{title:g?a?"upgrade in order to watch this video and be able to clip it":"":"can't clip videos shorter than 5 seconds",isDisabled:!g||a,style:l,onClick:()=>{h(),g&&(m({source:"post-ufi",title:null}),(0,u.j)(u.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"create",source:"player ufi"}),(0,u.j)(u.FP.VIDEO_CLIP_BUTTON_CLICKED,{post_id:i.id}))},icon:(0,n.tZ)(o.Z,{className:"icon",height:(0,c.Su)(l),strokeWidth:c.PA})})}},42725:function(e,t,i){i.d(t,{pc:()=>n}),i(16584),i(6400),i(30396),i(14068),i(68833),i(62981),i(15771),i(19081),i(58175),i(35144);let n="clip_web_nux_seen_at"},10968:function(e,t,i){i.d(t,{Li:()=>y,ew:()=>Z});var n=i(7409),r=i(99282),o=i(16584),a=i(30396),l=i(94184),s=i.n(l),d=i(16864),c=i(24202);i(92291);var u=i(71068),p=i(15771),h=i(19081),m=i(17172),g=i(45783),v=i(91400),b=i(54796);function y(e){let{className:t,assets:i,readOnly:l,isRestack:d,isPermalink:u,maxHeight:p=420,onClick:y,onSwipe:w,children:C,parent:x}=e,S=(0,c.dz)(i),k=(0,v.XA)(),B=d?12:u?0:k?64:48,T=d?12:16*!!k,I=B+T,N=(0,a.sO)(null),P=(0,c.yU)(N,I),E=Math.max(P-20-6,0),X=(0,a.sO)(!1),M=function(e,t,i){let n=e.filter(e=>"string"!=typeof e&&"number"==typeof e.width&&"number"==typeof e.height&&e.width>0&&e.height>0);return 0===n.length?t:Math.min(i/Math.max(...n.map(e=>e.width/e.height)),t)}(S,p,E),A=x&&""===x.body,[D,R]=(0,a.eJ)(null),F=(0,m.aZ)(N),L=(0,g.eK)(N,{inset:B,pageSizeAdjust:-.4*(P||0),initialState:{showLeft:!1,showRight:!0}}),{state:{showLeft:z,showRight:O},handleArrowClick:U}=k?{state:{showLeft:!1,showRight:!1},handleArrowClick:()=>()=>{}}:L;return(0,a.d4)(()=>{let e=N.current,t=()=>{!X.current&&(X.current=!0,w&&w())};return null==e||e.addEventListener("scroll",t),()=>null==e?void 0:e.removeEventListener("scroll",t)},[w]),(0,o.BX)(h.tu,{className:s()(b.Z.imageCarouselContainer,d&&b.Z.restack),position:"relative",draggable:!1,paddingTop:A?12:void 0,style:{"--carousel-inset-left":"-".concat(B,"px"),"--carousel-inset-right":"-".concat(T,"px")},children:[(0,o.BX)(h.hs,(0,r._)((0,n._)({},F.props),{ref:N,className:s()(b.Z.imageCarousel,d&&b.Z.restack,t),overflow:"auto",flex:"auto",style:{"--carousel-height":"".concat(M,"px"),"--carousel-gap":"".concat(6,"px")},children:[(0,o.tZ)(f,{width:B}),S.map((e,t)=>{let{src:i,explicit:n,width:r,height:a,id:s}=e;return(0,o.tZ)(_,{asset:i,explicit:n,readOnly:l,width:r,height:a,carouselHeight:M,onClick:l?void 0:e=>{e.preventDefault(),y&&y({attachmentId:s,attachmentType:"image"}),R({index:t})},children:C},i)}),(0,o.tZ)(c.$9,{assets:S,imageViewer:D,setImageViewer:R,readOnly:l})]})),!k&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(Z,{direction:"left",visible:z,onClick:U(-1)}),(0,o.tZ)(Z,{direction:"right",visible:O,onClick:U(1)})]})," "]})}function f(e){let{width:t}=e;return(0,o.tZ)(u.xu,{as:"span",className:b.Z.carouselSpacer,width:t})}function _(e){let{asset:t,explicit:i,onClick:n,readOnly:r,width:a,height:l,carouselHeight:s,children:d}=e,u=s*(a&&l?a/l:1);return(0,o.tZ)(c.Z4,{asset:t,explicit:i,onClick:n,readOnly:r,width:u,height:s,className:b.Z.carouselImage,maxWidth:u,children:d})}function Z(e){let{direction:t,visible:i,onClick:n}=e;return(0,o.tZ)(h.hs,{position:"absolute",className:s()(b.Z.arrowContainer,b.Z["".concat(t)]),alignItems:"center",justifyContent:"center",children:(0,o.tZ)(p.kG,{onClick:e=>{e.preventDefault(),e.stopPropagation(),null==n||n()},resetCss:!0,className:s()(b.Z.arrowButton,!i&&b.Z.hidden),display:"flex",alignItems:"center",justifyContent:"center",children:(0,o.tZ)(d.Z,{size:20,className:b.Z.arrowIcon})})})}},47348:function(e,t,i){i.d(t,{j:()=>a});var n=i(27412),r=i(7409),o=i(12281);class a extends o.Z{trackMedia(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i={content_type:"livestream",entity_type:"livestream",primary_entity_type:"livestream",entity_key:String(this.props.liveStreamId),primary_entity_key:String(this.props.liveStreamId)};super.trackMedia(e,(0,r._)({},t,i))}constructor(...e){super(...e),(0,n._)(this,"props",void 0),(0,n._)(this,"getBaseVideoSrc",e=>{let t="/api/v1/live_stream/".concat(this.props.liveStreamId),i=new URLSearchParams;return e&&i.append("type",e),i.append("src","true"),this.props.noJoin&&i.append("noJoin","true"),this.props.portrait&&i.append("portrait","true"),"".concat(t,"?").concat(i.toString())}),(0,n._)(this,"onPreviewClick",e=>{var t;this.player&&this.player.duration&&this.player.duration>1&&!isNaN(this.player.duration)&&(null===(t=this.player)||void 0===t?void 0:t.paused)&&(this.player.currentTime=this.player.duration-1),this.player&&this.player.paused&&(this.player.playbackRate=1),super.onPreviewClick(e)}),(0,n._)(this,"refreshVideoSrc",()=>{var e;this.setState({autoPlay:!(null===(e=this.player)||void 0===e?void 0:e.paused)}),i.e("4754").then(i.t.bind(i,67631,23)).then(e=>{this._initHlsjsWrapped(e.default)})})}}o.Z},50012:function(e,t,i){i.d(t,{C:()=>b,l:()=>f});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(30396),s=i(94184),d=i.n(s),c=i(85685),u=i(93252),p=i(63018),h=i(32700),m=i(63651),g=i(81821),v=i(90271);function b(e){var{children:t,disabled:i}=e,l=(0,o._)(e,["children","disabled"]);return i||(0,g.tq)()||(0,u.P)()?(0,a.tZ)(a.HY,{children:t}):(0,a.tZ)(y,(0,r._)((0,n._)({},l),{children:t}))}function y(e){var t,i,s,d,u,{className:g,children:b,subject:y,placement:_="right-center",utmSource:Z}=e,w=(0,o._)(e,["className","children","subject","placement","utmSource"]);let[C,x]=(0,l.eJ)(!1),S=(t=null!==(u=null!==(d=y.slug)&&void 0!==d?d:y.handle)&&void 0!==u?u:(0,m._IO)(y),i={auto:C},(0,p._I)("/api/v1/user/".concat(t,"/public_profile"),i)),k=S.data,B=(0,h.o)((0,n._)({className:v.Z.profileHoverCard,loading:S.isLoading,hideOnScroll:!0,onOpen:()=>{x(!0)},layerOptions:{placement:_},content:k?(0,a.tZ)(c.ProfileCard,{profile:k,subject:y,utmSource:Z,forceRefresh:()=>S.mutate()}):null},w));return(0,a.BX)(f,(0,r._)((0,n._)({className:g},B.hoverProps),{forwardRef:null===(s=B.triggerProps)||void 0===s?void 0:s.ref,children:[b,B.layer]}))}function f(e){var{inline:t,className:i,forwardRef:r}=e,l=(0,o._)(e,["inline","className","forwardRef"]);return(0,a.tZ)("div",(0,n._)({className:d()("profile-hover-card-target",v.Z.profileHoverCardTarget,t&&v.Z.inline,i),ref:r},l))}},33804:function(e,t,i){i.d(t,{w:()=>a});var n=i(16584),r=i(4615),o=i(5406);function a(e){let{children:t}=e;return(0,n.tZ)(r.f6,{theme:o.Z.pubAccentTheme,children:t})}},5772:function(e,t,i){i.d(t,{R:()=>a});var n=i(30396),r=i(23279),o=i.n(r);function a(e){let{items:t,getKeys:i,sort:r=!0,sortFunc:a,deps:l}=e,s=(e,t)=>{let n=i(e),r=i(t);for(let e=0;e<Math.min(n.length,r.length);e++){let t=n[e].localeCompare(r[e]);if(0!==t)return t}return n.length-r.length},[d,c]=(0,n.eJ)(""),u=(0,n.Ye)(()=>o()(c,100),[c]),p=d.trim();return{setQuery:u,filteredItems:(0,n.Ye)(()=>{if(!p)return t;let e=t.filter(e=>i(e).some(e=>e.toLowerCase().includes(p.toLowerCase())));return(r||a)&&(e=e.sort(a||s)),e},l?[p,...l]:[p,t]),hasFiltered:""!==p,query:p}}},75744:function(e,t,i){i.d(t,{fJ:()=>l});var n=i(16584),r=i(27836);i(95441);var o=i(58175),a=i(60308);let l=e=>{let{publication:t,className:i,themed:r=!1,utm_source:o}=e,a=r?"pub-tertiary-text":"tertiary";switch(null==t?void 0:t.subdomain){case"activisionblizzard":return(0,n.tZ)(d,{className:i,color:a,utm_source:o});case"demographyunplugged":return(0,n.tZ)(c,{className:i,color:a,utm_source:o});default:return(0,n.tZ)(s,{pub:t,className:i,color:a,utm_source:o})}},s=e=>{let{pub:t,className:i,color:l,utm_source:s}=e,d=null;return t.has_custom_tos&&t.has_custom_privacy?d=(0,n.BX)(o.xv,{as:"span",translated:!0,children:["the publisher's ",(0,n.tZ)(r.b,{href:(0,a.P8A)({pub:t,utm_source:s}),children:"Terms of Service"})," and"," ",(0,n.tZ)(r.b,{href:(0,a.RF2)({pub:t,utm_source:s}),children:"Privacy Policy"})]}):t.has_custom_tos?d=(0,n.BX)(o.xv,{as:"span",translated:!0,children:["the publisher's ",(0,n.tZ)(r.b,{href:(0,a.P8A)({pub:t,utm_source:s}),children:"Terms of Service"})]}):t.has_custom_privacy&&(d=(0,n.BX)(o.xv,{as:"span",translated:!0,children:["the publisher's ",(0,n.tZ)(r.b,{href:(0,a.RF2)({pub:t,utm_source:s}),children:"Privacy Policy"})]})),(0,n.tZ)(o.xv.B3,{size:14,color:l,className:null!=i?i:"tos",children:(0,n.tZ)(r.j,{publisherTerms:d,utm_source:s})})},d=e=>{let{className:t,color:i,utm_source:l}=e;return(0,n.BX)(o.xv.B3,{translated:!0,size:14,color:i,className:null!=t?t:"tos",children:["By registering you agree to Substack's"," ",(0,n.tZ)(r.b,{href:(0,a._QN)({utm_source:l}),children:"Terms of Service"}),", our"," ",(0,n.tZ)(r.b,{href:(0,a.Zzu)({utm_source:l}),children:"Privacy Policy"}),", our"," ",(0,n.tZ)(r.b,{href:(0,a.WFt)({utm_source:l}),children:"Information Collection Notice"}),", and Activision's"," ",(0,n.tZ)(r.b,{href:"https://www.activisionblizzard.com/legal/privacy-policy",children:"Privacy Policy"})]})},c=e=>{let{className:t,color:i,utm_source:l}=e;return(0,n.BX)("div",{className:null!=t?t:"tos",children:[(0,n.BX)(o.xv.B3,{translated:!0,size:14,color:i,children:["By registering you agree to Substack's"," ",(0,n.tZ)(r.b,{href:(0,a._QN)({utm_source:l}),children:"Terms of Service"}),", our"," ",(0,n.tZ)(r.b,{href:(0,a.Zzu)({utm_source:l}),children:"Privacy Policy"}),", our"," ",(0,n.tZ)(r.b,{href:(0,a.WFt)({utm_source:l}),children:"Information Collection Notice"}),"."]}),(0,n.BX)(o.xv.B3,{translated:!0,size:14,color:i,children:["You also agree to receive marketing emails from Hedgeye Risk Management, LLC pursuant to its"," ",(0,n.tZ)(r.b,{href:"https://www.demographyunplugged.com/p/privacy-policy",children:"Privacy Policy"})," and"," ",(0,n.tZ)(r.b,{href:"https://www.demographyunplugged.com/p/terms-of-service",children:"Terms of Service"}),"."]}),(0,n.tZ)(o.xv.B3,{translated:!0,size:14,color:i,children:"You may unsubscribe at any time by clicking the unsubscribe link in one of the emails."})]})}},72508:function(e,t,i){i.d(t,{ZP:()=>O,ml:()=>H,sZ:()=>J});var n=i(7409),r=i(99282),o=i(16584),a=i(30396),l=i(94184),s=i.n(l),d=i(74691),c=i.n(d),u=i(18029),p=i.n(u),h=i(44908),m=i.n(h),g=i(40423),v=i(96862),b=i(3039),y=i(19298),f=i(80569),_=i.n(f),Z=i(61649),w=i(29032),C=i(93678),x=i(44881),S=i(95441),k=i(57952),B=i(96904),T=i(53030),I=i(68833),N=i(33224),P=i(71068),E=i(19081),X=i(58175),M=i(17564),A=i(74571),D=i(61468),R=i(84864),F=i(93370),L=i(24271),z=i(63523);function O(e){var t,i;let{disableSelection:l,player:s,postId:d,renderTranscriptionChunk:u,transcription:p,onUpdateActiveRowIndex:h}=e,{iString:g}=(0,S.M1)(),{onStartClipping:v}=(0,Z.Sr)(),b=(0,a.sO)(null),{selection:y,clearSelection:f,selectEndRef:w,selectStartRef:C}=(0,A.LW)({containerRef:b,disable:null!=l&&l,playerRef:s}),[P,M]=(0,a.eJ)(!0),[R,F]=(0,a.eJ)(),[L,O]=(0,a.eJ)(["nick","mills"]),[H,J]=(0,a.eJ)({}),[V,q]=(0,a.eJ)(!1),[W,G]=(0,a.eJ)(!1),[K,Q]=(0,a.eJ)(),{currentTime:$,isPlaying:ee}=(0,T.FI)(s),et=H?Object.values(H).filter(e=>e):[],ei=!!((null==L?void 0:L.length)&&et.length),{setItems:en}=(0,k.pH)(),er=null==R?void 0:R.findIndex(e=>e.start<=$&&e.end>$);if((0,a.d4)(()=>{h&&void 0!==er&&-1!==er&&h(er)},[er,h]),(0,a.d4)(()=>{M(!0),p.cdn_url&&_().get(p.cdn_url).then(e=>{if(!e.text)return;let t=JSON.parse(e.text),i=(0,D.Ap)({rows:t});F(i),en(i);let n=m()(i.map(e=>{var t;return null!==(t=e.speaker)&&void 0!==t?t:""})).filter(e=>e).sort();n.length&&O(n)}).finally(()=>{M(!1)}),p.speaker_map&&Object.values(p.speaker_map).length&&J(p.speaker_map)},[null==R?void 0:R.length,en,p.cdn_url,p.cdn_unaligned_url,p.speaker_map]),P)return(0,o.tZ)(Y,{});if(!(null==R?void 0:R.length))return(0,o.tZ)("div",{className:z.Z.transcriptionStatus,children:(0,o.tZ)(X.xv.Meta,{children:g((null==p?void 0:p.status)==="in_progress"?"Transcription in progress...":"No transcript...")})});let eo=(null==s?void 0:null===(i=s.current)||void 0===i?void 0:null===(t=i.player)||void 0===t?void 0:t.tagName)==="VIDEO",ea=eo?"videogram":"audiogram";return(0,o.BX)(E.tu,{ref:b,children:[y&&(0,o.tZ)(U,{isVideo:eo,selection:y,onSelect:eo?()=>{if(!y||!R||!C.current||!w.current)return;let e=C.current,t=w.current;(e.rowIndex>t.rowIndex||e.rowIndex===t.rowIndex&&e.offset>t.offset)&&([e,t]=[t,e]);let i=(0,N.xm)({startRow:R[e.rowIndex],endRow:R[t.rowIndex],startOffset:e.offset,endOffset:t.offset,startNodeText:e.text,endNodeText:t.text});f(),v((0,r._)((0,n._)({},i),{source:"transcription",title:null}))}:function(){if(y&&w.current&&C.current&&R){let e=(0,n._)({},C.current),t=(0,n._)({},w.current),[i,r]=(0,N.lF)({selectStart:e,selectEnd:t,alignedRows:R});i>r&&([i,r]=[r,i]),q(!0),_().post("/api/v1/audiogram").send({post_id:d,start_idx:i,end_idx:r,use_draft:!1}).then(e=>{var t,i;(null===(t=e.body)||void 0===t?void 0:t.data)&&(Q(e.body.data),f(),(null==s?void 0:null===(i=s.current)||void 0===i?void 0:i.player)&&s.current.player.pause())}).finally(()=>q(!1))}}}),u&&R.map((e,t)=>{var i;return u({isPlaying:ee,row:e,rowIndex:t,words:e.words,showSpeaker:(0===t?void 0:null===(i=R[t-1])||void 0===i?void 0:i.speaker)!==e.speaker,speakerName:ei&&e.speaker?H[e.speaker]:void 0,onPause:()=>{var e;(null==s?void 0:null===(e=s.current)||void 0===e?void 0:e.player)&&s.current.player.pause()},onPlay:()=>{var t;(null==s?void 0:null===(t=s.current)||void 0===t?void 0:t.player)&&(s.current.player.currentTime=e.start+1e-4,s.current.player.play())}})}),!u&&R.map((e,t)=>(0,o.tZ)(j,{idx:t,row:e,rows:R,speakerName:ei&&e.speaker?H[e.speaker]:void 0,onReassign:()=>G(!0),currentTime:$,isPlaying:ee,isSelected:!!(y&&w.current&&C.current&&t===c()(t,Math.min(C.current.rowIndex,w.current.rowIndex),Math.max(C.current.rowIndex,w.current.rowIndex))),onClick:()=>{f()},onPause:()=>{var e;(null==s?void 0:null===(e=s.current)||void 0===e?void 0:e.player)&&s.current.player.pause()},onPlay:()=>{var t;(null==s?void 0:null===(t=s.current)||void 0===t?void 0:t.player)&&(s.current.player.currentTime=e.start+1e-4,s.current.player.play())}},t)),(0,o.tZ)(B.G,{isOpen:!!(V||K),onClose:()=>Q(void 0),isGenerating:V,finishedGram:K,noun:ea,postId:d,onDownload:function(e){return(0,I.j)(I.FP.AUDIOGRAM_DOWNLOAD_CLICKED,{post_id:d,audiogram_id:null==K?void 0:K.id,media_upload_id:p.media_upload_id}),fetch(e,{method:"GET"}).then(e=>e.blob()).then(e=>{var t;let i=null==K?void 0:null===(t=K.video_url)||void 0===t?void 0:t.split("/").pop(),n=null==i?void 0:i.match(/^([^-]+-[^_]+)_/),r=(null==n?void 0:n[1])||"",o=URL.createObjectURL(e),a=document.createElement("a");a.href=o,a.download="substack-".concat(ea,"-").concat(d,"-").concat(r,".mp4"),document.body.appendChild(a),a.click(),URL.revokeObjectURL(o),a.remove()})}}),(0,o.tZ)(x.O,{isOpen:L&&!!L.length&&!!W,onClose:()=>G(!1),speakers:L,speakerMap:H,onChangeSpeakerMap:J,postId:d})]})}function U(e){var t,i;let{isVideo:n,selection:r,onSelect:a}=e,{iString:l}=(0,S.M1)(),d=null===(i=r.anchorNode)||void 0===i?void 0:null===(t=i.parentElement)||void 0===t?void 0:t.getBoundingClientRect();return d?(0,o.tZ)(w.C,{children:(0,o.tZ)(E.tu,{style:{top:(0,R.isTouchDevice)()?Math.max(d.y,0)+d.height+12:Math.max(d.bottom,0)+12,left:d.x+d.width/2,transform:"translateX(-50%)",pointerEvents:"auto",maxWidth:240},justifyContent:"center",outline:"detail",shadow:"md",radius:"md",className:s()(L.Z.popover,L.Z.mounted),padding:4,gap:4,children:n?(0,o.BX)(C.O7,{onClick:a,children:[(0,o.tZ)(g.Z,{color:"var(--color-utility-white)",size:20}),(0,o.tZ)(X.xv.B4,{color:"white",weight:"medium",children:l("Create clip")})]}):(0,o.BX)(C.O7,{onClick:a,children:[(0,o.tZ)(v.Z,{color:"var(--color-utility-white)",size:20}),(0,o.tZ)(X.xv.B4,{color:"white",weight:"medium",children:l("Make audiogram")})]})})}):null}function Y(){return(0,o.BX)(o.HY,{children:[(0,o.tZ)(M.S,{width:"80%",height:"24px",className:z.Z.loadingSilhouette}),(0,o.tZ)(M.S,{width:"34%",height:"24px",className:z.Z.loadingSilhouette}),(0,o.tZ)(M.S,{width:"75%",height:"24px",className:z.Z.loadingSilhouette}),(0,o.tZ)(M.S,{width:"100%",height:"24px",className:z.Z.loadingSilhouette}),(0,o.tZ)(M.S,{width:"68%",height:"24px",className:z.Z.loadingSilhouette})]})}function H(e){if(!e)return"Unknown Speaker";let t=e.split("_"),i=parseInt(t[1]);return"".concat(p()(t[0])," ").concat(i+1)}function j(e){let{row:t,currentTime:i,onPlay:l,isPlaying:d,onPause:c,isSelected:u,onClick:p,idx:h,rows:m,onReassign:g,speakerName:v}=e,[f,_]=(0,a.eJ)(!1),Z=(0,a.sO)(null),w=t.start<=i&&t.end>=i,C=t.words.map(e=>e.start<=i&&e.end>=i?(0,o.BX)(o.HY,{children:[(0,o.tZ)("span",{className:z.Z.activeWord,children:e.word})," "]}):"".concat(e.word," "));C.length||(C=t.text.split(" ").map(e=>(0,o.BX)("span",{children:[e," "]})));let x=null;if(t.speaker&&v){var S;let e=0===h?void 0:null===(S=m[h-1])||void 0===S?void 0:S.speaker;t.speaker!==e&&(x=(0,o.tZ)("div",{className:z.Z.speakerText,onClick:g,children:v}))}return(0,o.BX)("div",{ref:Z,onClick:p,onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1),style:{display:"flex",width:"100%",alignItems:"center"},children:[d&&(!f||w)?(0,o.tZ)(y.Z,{onClick:c,size:24,className:z.Z.playCircle,style:(0,r._)((0,n._)({},f&&{color:"var(--color-accent-themed)"}),{visibility:w||f?"visible":"hidden"})}):(0,o.tZ)(b.Z,{onClick:l,size:24,className:z.Z.playCircle,style:(0,r._)((0,n._)({},f&&{color:"var(--color-accent-themed)"}),{visibility:w||f?"visible":"hidden"})}),(0,o.BX)("div",{className:s()(z.Z.transcriptionChunk,{[z.Z.activeRow]:w||u,[z.Z.hoverChunk]:f}),"data-chunk-index":h,children:[(0,o.tZ)("div",{className:s()(z.Z.rowIndicator,{[z.Z.hoverRow]:f})}),(0,o.BX)("div",{style:{display:"flex",flexDirection:"column",flex:1,padding:"5px 0"},children:[x,(0,o.tZ)("div",{className:z.Z.rowText,"data-chunk-index":h,children:C})]})]})]})}let J=e=>{let{isActiveRow:t,isPlaying:i,row:n,rowIndex:r,onPause:a,onPlay:l,postId:d,children:c,className:u,activeClassName:p,editable:h}=e,m=t&&i;return(0,o.tZ)(P.xu,{id:"transcription-".concat(r),paddingRight:16,className:s()(u,{[null!=p?p:""]:m}),onClick:()=>{var e;(null===(e=window.getSelection())||void 0===e||!e.toString())&&!h&&((0,I.j)(I.FP.TRANSCRIPTION_TIMESTAMP_CLICKED,{post_id:d,timestamp:(0,F.DL)(n.start)}),m?a():l())},children:c})}},86374:function(e,t,i){i.d(t,{Z:()=>s});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(64515);let s=e=>{var{size:t=18,color:i="var(--color-fg-primary)",className:s}=e,d=(0,o._)(e,["size","color","className"]);return(0,a.tZ)(l.l,(0,r._)((0,n._)({},d),{name:"DropdownIcon",svgParams:{viewBox:"0 0 20 20"},stroke:"none",width:t,height:t,fill:i,className:s,children:(0,a.tZ)("path",{d:"M5.72845 8.252C5.25083 7.59067 5.72336 6.6665 6.53913 6.6665H13.461C14.2767 6.6665 14.7493 7.59067 14.2716 8.25199L10.8107 13.044C10.4116 13.5967 9.58852 13.5967 9.18936 13.044L5.72845 8.252Z",stroke:"none"})}))}},83330:function(e,t,i){i.d(t,{Z:()=>l});var n=i(7409),r=i(99282),o=i(16584),a=i(64515);let l=e=>(0,o.BX)(a.l,(0,r._)((0,n._)({},e),{name:"ImageIcon",svgParams:{height:52.13,width:63.67},children:[(0,o.tZ)("path",{d:"M58.55,52.13H5.13A5.13,5.13,0,0,1,0,47V5.13A5.13,5.13,0,0,1,5.13,0H58.55a5.13,5.13,0,0,1,5.13,5.13V47A5.13,5.13,0,0,1,58.55,52.13ZM5.13,4A1.13,1.13,0,0,0,4,5.13V47a1.13,1.13,0,0,0,1.13,1.13H58.55A1.13,1.13,0,0,0,59.67,47V5.13A1.13,1.13,0,0,0,58.55,4Z"}),(0,o.tZ)("path",{d:"M12.08,43.46H51.59A1.69,1.69,0,0,0,53,40.77l-5.45-7.4A1.69,1.69,0,0,0,45,33.15l-5.6,5.33-13-17.65a1.69,1.69,0,0,0-2.78.08l-13,19.94A1.69,1.69,0,0,0,12.08,43.46Z"}),(0,o.tZ)("circle",{cx:"44.13",cy:"15.12",r:"5.93"})]}))},43389:function(e,t,i){i.d(t,{Z:()=>s});var n=i(7409),r=i(99282),o=i(16584),a=i(66298),l=i(64515);let s=e=>(0,o.tZ)(l.l,(0,r._)((0,n._)({},e),{name:"LucideArrowUpRight",svgParams:{height:24,width:24},children:(0,o.tZ)(a.Z,{height:24,stroke:e.stroke,fill:e.fill,strokeWidth:e.strokeWidth})}))},25265:function(e,t,i){i.d(t,{Z:()=>s});var n=i(7409),r=i(99282),o=i(16584),a=i(7617),l=i(64515);let s=e=>(0,o.tZ)(l.l,(0,r._)((0,n._)({},e),{name:"LucideComments",svgParams:{height:24,width:24,fill:"#000000",strokeWidth:0},children:(0,o.tZ)(a.Z,{height:24,stroke:e.stroke,fill:e.fill,strokeWidth:e.strokeWidth})}))},36412:function(e,t,i){i.d(t,{Z:()=>s});var n=i(7409),r=i(99282),o=i(16584),a=i(84146),l=i(64515);let s=e=>(0,o.tZ)(l.l,(0,r._)((0,n._)({},e),{name:"LucideCornerDownRight",svgParams:{height:24,width:24,fill:"#000000",strokeWidth:0},children:(0,o.tZ)(a.Z,{height:24,stroke:e.stroke,fill:e.fill,strokeWidth:e.strokeWidth})}))},666:function(e,t,i){i.d(t,{Z:()=>s});var n=i(7409),r=i(99282),o=i(16584),a=i(8618),l=i(64515);let s=e=>(0,o.tZ)(l.l,(0,r._)((0,n._)({},e),{name:"LucideHeart",svgParams:{height:24,width:24,fill:"#000000",strokeWidth:0},children:(0,o.tZ)(a.Z,{height:24,stroke:e.stroke,fill:e.fill,strokeWidth:e.strokeWidth})}))},95398:function(e,t,i){i.d(t,{Z:()=>l});var n=i(7409),r=i(99282),o=i(16584),a=i(64515);let l=e=>(0,o.tZ)(a.l,(0,r._)((0,n._)({},e),{name:"LucideShare",svgParams:{height:24,width:24,fill:"#000000",strokeWidth:0},children:(0,o.tZ)("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,o.tZ)("path",{d:"M12.4376 15.6C4.77778 15.6 2 20.3999 2 20.3999C2 12.5999 5.88889 8.4 12.4376 8.4V3L22 11.9812L12.4376 21V15.6Z","stroke-width":e.strokeWidth,fill:e.fill,className:"lucide","stroke-linecap":"round","stroke-linejoin":"round"})})}))},38457:function(e,t,i){i.d(t,{Z:()=>s});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(64515);let s=e=>{var{size:t=24,color:i="var(--color-fg-primary)"}=e,s=(0,o._)(e,["size","color"]);return(0,a.tZ)(l.l,(0,r._)((0,n._)({},s),{name:"NoteQuoteForwardIcon",svgParams:{viewBox:"0 0 24 24"},width:t,height:t,stroke:i,strokeWidth:2,fill:"none",children:(0,a.tZ)("path",{d:"M13.4147 2.09993C10.4072 1.67249 7.2423 2.61548 4.92891 4.92887C1.02366 8.83411 1.02366 15.1658 4.92891 19.071C8.83415 22.9762 15.1658 22.9762 19.071 19.071C21.3844 16.7576 22.3274 13.5927 21.9 10.5852M18.5 2.62126C18.8978 2.22343 19.4374 1.99994 20 1.99994C20.5626 1.99994 21.1021 2.22343 21.5 2.62126C21.8978 3.01908 22.1213 3.55865 22.1213 4.12126C22.1213 4.68387 21.8978 5.22343 21.5 5.62126L13 14.1213L8.99998 15.1213L9.99998 11.1213L18.5 2.62126Z","stroke-linecap":"round","stroke-linejoin":"round"})}))}},1055:function(e,t,i){i.d(t,{Z:()=>l});var n=i(7409),r=i(99282),o=i(16584),a=i(64515);let l=e=>(0,o.tZ)(a.l,(0,r._)((0,n._)({},e),{name:"PlayIconRounded",svgParams:{height:16,width:16},stroke:"none",children:(0,o.tZ)("path",{d:"M3.35866 16C2.58101 16 2 15.4101 2 14.4447V1.55531C2 0.598883 2.58101 0 3.35866 0C3.75196 0 4.10056 0.134078 4.54749 0.393296L15.1575 6.54302C15.9531 7.00782 16.3106 7.39218 16.3106 8C16.3106 8.61676 15.9531 9.00112 15.1575 9.45698L4.54749 15.6067C4.10056 15.8659 3.75196 16 3.35866 16Z"})}))},51534:function(e,t,i){i.d(t,{Z:()=>s});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(64515);let s=e=>{var{size:t=24,color:i="var(--color-fg-primary)",className:s}=e,d=(0,o._)(e,["size","color","className"]);return(0,a.tZ)(l.l,(0,r._)((0,n._)({},d),{name:"SkinnyLockIcon",svgParams:{viewBox:"0 0 24 24"},stroke:"none",width:t,height:t,fill:i,className:s,children:(0,a.tZ)("path",{d:"M6.63672 23.4922H17.3594C19.082 23.4922 19.9961 22.5547 19.9961 20.7031V12.6289C19.9961 10.7773 19.082 9.85156 17.3594 9.85156H6.63672C4.91406 9.85156 4 10.7773 4 12.6289V20.7031C4 22.5547 4.91406 23.4922 6.63672 23.4922ZM6.05078 10.7539H7.91406V6.79297C7.91406 3.83984 9.80078 2.26953 11.9922 2.26953C14.1836 2.26953 16.0938 3.83984 16.0938 6.79297V10.7539H17.9453V7.05078C17.9453 2.64453 15.0625 0.5 11.9922 0.5C8.93359 0.5 6.05078 2.64453 6.05078 7.05078V10.7539Z",stroke:"none"})}))}},45530:function(e,t,i){i.d(t,{Z:()=>s});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(64515);let s=e=>{var{size:t=24,color:i="var(--color-fg-primary)",className:s}=e,d=(0,o._)(e,["size","color","className"]);return(0,a.tZ)(l.l,(0,r._)((0,n._)({},d),{name:"SkinnyUnlockIcon",svgParams:{viewBox:"0 0 24 24"},stroke:"none",width:t,height:t,fill:i,className:s,children:(0,a.tZ)("path",{d:"M2.5862 23.8914H13.1034C14.793 23.8914 15.6896 22.9366 15.6896 21.051V12.8282C15.6896 10.9545 14.793 9.99975 13.1034 9.99975H2.5862C0.896549 9.99975 0 10.9545 0 12.8282V21.051C0 22.9366 0.896549 23.8914 2.5862 23.8914ZM11.9885 10.9306H13.8046V6.90875C13.8046 3.88935 15.6667 2.30209 17.8161 2.30209C19.9655 2.30209 21.8275 3.88935 21.8275 6.90875V9.55818C21.8275 10.2623 22.2299 10.6203 22.7471 10.6203C23.2413 10.6203 23.6551 10.2981 23.6551 9.55818V7.15937C23.6551 2.67205 20.8161 0.5 17.8161 0.5C14.8046 0.5 11.9885 2.67205 11.9885 7.15937V10.9306Z"})}))}},16808:function(e,t,i){i.d(t,{_q:()=>f,xt:()=>_});var n=i(7409),r=i(16584),o=i(30396),a=i(94184),l=i.n(a);i(36808),i(51014);var s=i(40647),d=i(68833),c=i(98914),u=i(15771),p=i(19081);i(6490);var h=i(58175);i(98012);var m=i(31742),g=i(63651),v=i(84864),b=i(47929),y=i(2180);m.Ic.LIKE_UPSELL_LAST_SHOWN_AT;let f=e=>{var t,i;let{pub:a}=e,m=(0,s.xR)(),[f,_]=(0,o.eJ)(null==a?void 0:null===(t=a.plans)||void 0===t?void 0:t[0]),Z=m.getConfigFor("disable_monthly_subscriptions"),w=m.getConfigFor("disable_annual_subscriptions");return(0,r.BX)(p.tu,{gap:20,children:[(0,r.BX)(p.tu,{gap:4,children:[(0,r.BX)(h.xv.H4,{weight:"semibold",children:["Support ",a.name]}),(0,r.BX)(h.xv.B4,{color:"secondary",children:["Since you liked this post, why not support ",a.name," with a subscription?"]})]}),(0,r.tZ)("form",{className:y.Z.form,children:(0,r.tZ)(p.tu,{gap:12,children:null==a?void 0:null===(i=a.plans)||void 0===i?void 0:i.map(e=>{if(("month"!==e.interval||!Z)&&("year"!==e.interval||!w))return(0,r.tZ)("label",{className:y.Z.label,children:(0,r.BX)(p.gq,{gap:12,alignItems:"center",children:[(0,r.tZ)("input",{name:"plan",type:"radio",value:e.id,onInput:()=>_(e),checked:f&&f.id===e.id,className:l()({[y.Z.selectedInput]:f&&f.id===e.id},y.Z.input)}),(0,r.BX)(p.gq,{gap:8,children:[(0,r.tZ)(h.xv.B4,{as:"span",weight:"semibold",color:f&&f.id===e.id?"primary":"secondary",children:(0,v.getPlanTitle)(e,a.language)}),(0,r.tZ)(h.xv.B4,{as:"span",color:"secondary",children:(0,v.planBasePricing)(e)})]})]})},e.id)})})}),(0,r.tZ)(u.zx,{onClick:()=>{(0,d.j)(d.FP.LIKE_UPSELL_PLAN_SELECTED),(0,c.uX)((0,g.W1P)(a,{params:(0,n._)({utm_source:b.b3.likeButtonUpsell},f&&{selectedPlanId:f.id})}),{local_navigation:!1})},flex:"grow",priority:"primary",children:"Select"})]})},_=e=>{let{onClose:t,shareDialogRef:i}=e;return(0,r.BX)(p.tu,{gap:20,children:[(0,r.BX)(p.tu,{gap:4,children:[(0,r.tZ)(h.xv.H4,{weight:"semibold",children:"Share this post with a friend"}),(0,r.tZ)(h.xv.B4,{color:"secondary",children:"Since you liked this post, why not share it to help spread the word?"})]}),(0,r.tZ)(u.zx,{onClick:()=>{var e;(0,d.j)(d.FP.LIKE_UPSELL_SHARE_CLICKED),null===(e=i.current)||void 0===e||e.open(),null==t||t()},flex:"grow",priority:"primary",children:"Share"})]})}},3258:function(e,t,i){i.d(t,{ZP:()=>g,wg:()=>b});var n=i(7409),r=i(99282),o=i(16584),a=i(94184),l=i.n(a),s=i(80569),d=i.n(s),c=i(85685),u=i(85095),p=i(33017),h=i(63651),m=i(51885);let g=e=>{let{id:t,type:i,name:n,url:r,photo_url:a,uuid:s,mentionText:d,isStatic:g=!1,isEditorContext:v=!1}=e;return g?(0,o.tZ)("span",{className:l()(m.Z.mention,m.Z.mentionStatic),"data-component-name":"MentionStatic",children:(0,o.tZ)("a",{href:(0,h.gpq)(i,t,n,r),children:n||"Substack user"})}):"user"===i?(0,o.tZ)(u.am,{children:(0,o.tZ)(c.ProfileHoverCard,{subject:{id:t,name:n||"Substack user",photo_url:a},utmSource:"mention",children:(0,o.tZ)("a",{className:m.Z.mention,href:v?void 0:(0,h.gpq)(i,t,n,r),target:"_blank",rel:"noopener","data-attrs":JSON.stringify({name:n,id:t,type:i,url:r,photo_url:a,uuid:s}),onClick:e=>e.stopPropagation(),"data-component-name":"MentionUser",children:null!=d?d:n})})}):"pub"===i?(0,o.tZ)(p.Sm,{publication_id:t,utmSource:"mention",children:(0,o.tZ)("a",{className:m.Z.mention,href:r,target:"_blank",rel:"noopener","data-attrs":JSON.stringify({name:n,id:t,type:i,url:v?void 0:(0,h.gpq)(i,t,n,r),uuid:s}),onClick:e=>e.stopPropagation(),"data-component-name":"MentionPub",children:null!=d?d:n})}):(0,o.tZ)("a",{className:m.Z.mention,target:"_blank",rel:"noopener",href:(0,h.gpq)(i,t,n,r),"data-attrs":JSON.stringify({name:n,id:t,type:i,url:r,photo_url:a,uuid:s}),"data-component-name":"Mention",children:null!=d?d:n})},v={},b=async function(e){let{pathname:t="/api/v1/posts/mention"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(v[e])return v[e];let{profiles:i,publications:o}=(await d().get(t).query({query:e,include_unmentionables:!0})).body,a=new Map;return i&&i.length&&a.set("Writers",i.map(e=>(0,r._)((0,n._)({},e),{type:"user",disabledReason:e.is_mentionable?void 0:"unmentionable"}))),o&&o.length&&a.set("Publications",null==o?void 0:o.map(e=>(0,r._)((0,n._)({},e),{type:"pub",url:(0,h.HQ5)({subdomain:e.subdomain}),photo_url:e.logo_url}))),v[e]=a,a}},93666:function(e,t,i){i.d(t,{Z:()=>h,p:()=>m});var n=i(27412),r=i(7409),o=i(99282),a=i(16584),l=i(6400),s=i(94184),d=i.n(s),c=i(71375),u=i(98914),p=i(15771);class h extends l.Component{componentDidMount(){document.addEventListener("keydown",this.onDocumentKeyDown),this.props.openByDefault&&this.openImmediately()}componentWillUnmount(){document.removeEventListener("keydown",this.onDocumentKeyDown),this._timeout&&clearTimeout(this._timeout)}openImmediately(e){e&&(this._callback=e);let t=document.getElementsByTagName("html")[0];t&&!(0,u.pv)(t,"modal-in")&&(0,u.cn)(t,"modal-in"),this.setState({display:!0,open:!0})}async open(e){e&&(this._callback=e);let t=document.getElementsByTagName("html")[0];t&&!(0,u.pv)(t,"modal-in")&&(0,u.cn)(t,"modal-in"),this.onBeforeOpen(),this.props.onBeforeOpen&&this.props.onBeforeOpen(),await new Promise(e=>{this.setState({display:!0},()=>{this._timeout&&clearTimeout(this._timeout);let t=setTimeout(()=>{this.setState({open:!0},()=>{this.onOpen(),this.props.onOpen&&this.props.onOpen(),e()})},50);this._timeout=t})})}async close(e){this.isOpen()&&!1!==this.onBeforeClose(e)&&(!this.props.onBeforeClose||!1!==this.props.onBeforeClose(e))&&((0,u.IV)(document.getElementsByTagName("html")[0],"modal-in"),await new Promise(t=>{this.setState({open:!1},()=>{let i=setTimeout(()=>{this.setState({display:!1},()=>{this.onClose(e),this.props.onClose&&this.props.onClose(e),this._callback&&this._callback(e),t()})},750);this._timeout=i})}))}isOpen(){return this.state.open}onClickOuter(e){var t,i;e.stopPropagation(),null===(t=(i=this.props).onClick)||void 0===t||t.call(i,e),!this.props.noExit&&!this.props.noExitOnClick&&this.popup&&(this.noFullscreen||window.innerWidth>540)&&e.target&&this.container&&this.close()}onClickInner(e){var t,i;e.stopPropagation(),null===(t=(i=this.props).onClick)||void 0===t||t.call(i,e)}render(e,t){let i=this.state.open?"in":"out",n=!1===this.state.display?"gone":"",l="structured"===this.props.variant,s=!this.state.open;return(0,a.tZ)("div",{className:d()("modal typography",i,n,this.props.className,this.getClassName(),{"has-close-pill":this.props.closePill,"structured-modal":l,popup:this.popup}),inert:s,onClick:e=>this.onClickOuter(e),"data-testid":this.props.testID,role:"dialog",style:this.props.zIndex?{zIndex:this.props.zIndex}:{},children:(0,a.tZ)("div",{className:"modal-table",children:(0,a.tZ)("div",{className:"modal-row",children:(0,a.tZ)("div",{ref:this.assignContent,className:d()("modal-cell modal-content",{"no-fullscreen":this.noFullscreen}),children:(0,a.BX)("div",(0,o._)((0,r._)({className:d()({container:!l}),ref:this.assignContainer,onClick:e=>this.onClickInner(e)},this.props.trackInputsID&&{"data-track-inputs":this.props.trackInputsID}),{children:[!this.props.noExit&&(!this.props.noCloseButton||(0,u.K1)())&&(l?(0,a.tZ)("div",{className:"structured-modal__close-button",children:(0,a.tZ)(p.hU,{"data-testid":"close-modal",priority:"tertiary",onClick:()=>this.close(),children:(0,a.tZ)(c.Z,{size:20,color:"secondary"})})}):(0,a.tZ)(p.hU,{"data-testid":"close-modal",priority:"tertiary",className:d()("modal-btn modal-exit-btn no-margin",{"button btn btn-secondary btn-pill icon-only":this.props.closePill}),onClick:()=>this.close(),children:(0,a.tZ)(c.Z,{size:20,color:"secondary"})})),l?(0,a.BX)("div",{className:"structured-modal__wrapper",children:[(0,a.tZ)("div",{className:"structured-modal__header",children:this.props.modalTitle?(0,a.tZ)("h3",{children:this.props.modalTitle}):(0,a.tZ)("h3",{children:"\xa0"})}),(0,a.tZ)("div",{className:"structured-modal__body",children:(0,a.tZ)("div",{className:"container",children:this.renderChildren(this.props,this.state)})}),this.props.modalFooter&&(0,a.tZ)("div",{className:"structured-modal__footer",children:this.props.modalFooter})]}):this.renderChildren(this.props,this.state)]}))})})})})}getClassName(){}onBeforeOpen(){}onOpen(e){}onBeforeClose(e){}onClose(e){}renderChildren(e,t){let{children:i}=e;return i}constructor(e,t){super(e,t),(0,n._)(this,"popup",void 0),(0,n._)(this,"_timeout",void 0),(0,n._)(this,"_callback",void 0),(0,n._)(this,"content",void 0),(0,n._)(this,"container",void 0),(0,n._)(this,"assignContent",e=>{this.content=e}),(0,n._)(this,"assignContainer",e=>{this.container=e}),(0,n._)(this,"noFullscreen",void 0),(0,n._)(this,"state",void 0),(0,n._)(this,"onDocumentKeyDown",e=>{"Escape"!==e.key||this.props.noExit||(0,u.$Z)(this.base)||this.close()}),this.open=this.open.bind(this),this.close=this.close.bind(this),this.popup=!1,this.state={open:!1,display:!1,callback:null}}}class m extends h{constructor(e,t){super(e,t),this.popup=!0}}},56219:function(e,t,i){i.d(t,{Ao:()=>e0,Rs:()=>e1,SO:()=>eW,eu:()=>eJ,mV:()=>eQ,nM:()=>eK,xw:()=>eV});var n=i(27412),r=i(7409),o=i(99282),a=i(58865),l=i(16584),s=i(6400),d=i(30396),c=i(94184),u=i.n(c),p=i(39693),h=i.n(p),m=i(85564),g=i.n(m),v=i(7739),b=i.n(v),y=i(93220),f=i.n(y),_=i(59543),Z=i(80569),w=i.n(Z),C=i(60826),x=i(7464),S=i(84844),k=i(16564),B=i(9573),T=i(89074),I=i(59708),N=i(92828),P=i(75021),E=i(18787),X=i(90311),M=i(17350),A=i(16944),D=i(94442),R=i(3862),F=i(21316),L=i(85685),z=i(11712),O=i(94594),U=i(51014),Y=i(33665),H=i(90156),j=i(72392),J=i(16506),V=i(89276),q=i(25956),W=i(79160),G=i(70522),K=i(58319),Q=i(57391),$=i(37168),ee=i(95441),et=i(30372),ei=i(56629),en=i(68833),er=i(48980),eo=i(49762),ea=i(27036),el=i(98914),es=i(29927),ed=i(15771),ec=i(61254),eu=i(19081),ep=i(1844),eh=i(58175),em=i(70379),eg=i(71460),ev=i(23776),eb=i(57641),ey=i(98012),ef=i(24791),e_=i(6070),eZ=i(67914),ew=i(60308),eC=i(26111),ex=i(63651),eS=i(81821),ek=i(84864),eB=i(47929),eT=i(59961);function eI(){let e=(0,a._)(["The full video is for subscribers in the "," plan"]);return eI=function(){return e},e}function eN(){let e=(0,a._)(["The full video is for subscribers in the Founding Member plan"]);return eN=function(){return e},e}function eP(){let e=(0,a._)(["The full video is for paid subscribers"]);return eP=function(){return e},e}function eE(){let e=(0,a._)(["This email is for subscribers in the "," plan"]);return eE=function(){return e},e}function eX(){let e=(0,a._)(["This email is for subscribers in the Founding Member plan"]);return eX=function(){return e},e}function eM(){let e=(0,a._)(["This email is for paid subscribers"]);return eM=function(){return e},e}function eA(){let e=(0,a._)(["Continue reading this post for free, courtesy of ","."]);return eA=function(){return e},e}function eD(){let e=(0,a._)(["This post is for subscribers in the "," plan"]);return eD=function(){return e},e}function eR(){let e=(0,a._)(["This post is for subscribers in the Founding Member plan"]);return eR=function(){return e},e}function eF(){let e=(0,a._)(["This post is for paid subscribers"]);return eF=function(){return e},e}function eL(){let e=(0,a._)(["Subscribe to "," to continue reading"]);return eL=function(){return e},e}function ez(){let e=(0,a._)(["Visit the authorâ€™s Substack to subscribe and read more."]);return ez=function(){return e},e}function eO(){let e=(0,a._)(["Visit ",""]);return eO=function(){return e},e}function eU(){let e=(0,a._)(["Support ",""]);return eU=function(){return e},e}function eY(){let e=(0,a._)(["Subscribe to ",""]);return eY=function(){return e},e}function eH(){let e=(0,a._)(["By ",""]);return eH=function(){return e},e}function ej(){let e=(0,a._)(["Subscribe to ",""]);return ej=function(){return e},e}let eJ=(e,t)=>!!e&&!e.invite_only&&!!t&&t.has_publication&&!t.is_admin&&!t.is_contributor&&!t.is_public_admin&&(0,ea.P)(t,e),eV=(e,t,i,n)=>"enabled"===e.payments_state?!(null==t?void 0:t.is_subscribed):(null==t?void 0:t.is_free_subscribed)&&"disabled"===e.payments_state&&!e.invite_only?!n&&i&&!(null==t?void 0:t.is_pledged):!(null==t?void 0:t.is_free_subscribed);class eq extends s.Component{async loadReactors(){let e=await w().get("/api/v1/post/".concat(this.props.post.id,"/facepile"));this.setState({reactors:e.body.reactors,restackers:e.body.restackers})}async componentDidMount(){var e;this.props.paywall&&!this.props.postPreview&&(0,en.j)(en.FP.POST_PAYWALL_SHOWN,{post_id:this.props.post.id,post_audience:this.props.post.audience,post_type:this.props.post.type,user:this.props.user}),this._triggerShare=()=>this.triggerShare(),null===(e=this.containerRef.current)||void 0===e||e.addEventListener("share-post",this._triggerShare),this.props.post&&this.loadReactors(),.001>Math.random()&&(0,en.K8)({post:this.props.post});let t=(0,eC.x)("subscribe_prompt");t&&("paid"===t?this.props.popToast(e=>(0,l.tZ)(em.FN,(0,o._)((0,r._)({},e),{text:"Subscription purchased for ".concat(this.props.pub.name)}))):this.props.popToast(e=>(0,l.tZ)(em.FN,(0,o._)((0,r._)({},e),{text:"Subscribed to ".concat(this.props.pub.name)})))),this.setPostPromptState()}componentWillUnmount(){if(this._triggerShare){var e;null===(e=this.containerRef.current)||void 0===e||e.removeEventListener("share-post",this._triggerShare)}this.props.stopInterval&&this.props.stopInterval()}isGiftPostEligible(){var e,t;let{getSettingFor:i,post:n,pub:r,referringUser:o,user:a}=this.props;return i("paywall_unlock_tokens")&&"only_paid"===n.audience&&n.teaser_post_eligible&&(!a||!a.is_subscribed)&&(0,eS.tq)({checkFirst4:!0})&&(null==o?void 0:null===(t=o.subscriptions)||void 0===t?void 0:null===(e=t.find(e=>e.publication_id===r.id))||void 0===e?void 0:e.membership_state)==="subscribed"}async setPostPromptState(){var e;let{post:t,disableSubscribePrompt:i,readerIsSearchCrawler:n,pub:r,user:o,readerInstalledAt:a,referringUser:l,forceFollowPrompt:s}=this.props,d="newsletter"===t.type&&!0===this.props.getSettingFor("enable_post_page_conversion")&&!i&&!(0,el.AE)()&&!n,c=!1;if(null===(e=document)||void 0===e?void 0:e.referrer)try{let e=new URL(document.referrer);c=!!e.hostname.match(/(^|\.)substack\.com$/)||e.hostname===window.location.hostname}catch(e){}let u=!1,p=this.props.skipFollowPrompt;this.isGiftPostEligible()&&["treatment_more_gifty","treatment_popover_gifty"].includes(this.context.getExperimentVariant("gift_post_unlocks_recipient_2"))&&(u=!0,p=!0);let h=!1;if(s)h=!0;else if(!ek.PUB_IDS_TO_NOT_SHOW_FOLLOW_PROMPT_ON.includes(r.id)&&!p&&d&&l&&l.name&&l.id!==(null==o?void 0:o.id)&&r.author_id!==l.id&&r.contributors.every(e=>e.user_id!==l.id)){let e=[];if(o)try{e=await (0,er.rd)("/api/v1/feed/following")}catch(e){console.warn("Failed to fetch following state",e)}h=!e.includes(l.id)}let m=d&&!u&&!h&&!this.props.paywall&&!this.props.freeSignup&&!o,g=!u&&!["video","podcast"].includes(t.type)&&!n&&(0,eS.tq)({checkFirst4:!0})&&!a&&!c,v=!1;g&&!m&&(this.context.exposeExperiment("app_install_prompts"),"drawer"===this.context.getExperimentVariant("app_install_prompts")&&(v=!0,h=!1)),this.setState({shouldShowGiftPostPrompt:u,shouldShowFollowPrompt:h,shouldShowSubscribePrompt:m,appUpsellEligible:g,mountAppUpsellFooter:v})}triggerShare(){var e,t;let{fromEmail:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i?null===(e=this.shareDialogRef.current)||void 0===e||e.fromEmail():null===(t=this.shareDialogRef.current)||void 0===t||t.open()}onBottomReached(e){this.state.bottomReached||this.props.postPreview||(this.setState({bottomReached:!0}),(0,en.xG)({post:this.props.post,hasPaywall:e,surface:"publication",trackerUuid:this.props.getCurrentUuid()}))}shouldShowUFI(){let{fromPostPage:e,user:t,pub:i,getSettingFor:n}=this.props,{canShowSubscribeFooterAfterPost:r}=this.state;return!!e&&!!r&&eV(i,t,!!n("payment_pledges_enabled"),this.shouldShowRecommendCta)}shouldTrackPaywallPostSeen(){if("undefined"==typeof window)return!1;let e=document.createElement("div"),t=this.props.post.body_html;e.innerHTML=t;let i=this.props.pub.post_preview_limit||ek.DEFAULT_PREVIEW_LIMIT,n="",r=!1;for(let t=e.childNodes.length-1;t>=0;t--){let o=e.childNodes[t];if(o&&(n+=o.textContent).length>i){r=!0;break}}return r}render(e,t){var i,n,a,s,d,c,p;let h,{user:m,pub:g,post:v,freeSignup:b,freeSignupEmail:y,isServingFreePodcastUrl:f,isShowsPost:Z,isTheFreePressTheme:w,reaction_token:C,invisible:S,paywall:B,onChange:A,hideTitle:R,noTitleLink:F,showComments:L,fromPostPage:Y,freeTrialCoupon:q,showRestackModal:G,stripe_publishable_key:Q,crossPostInfo:$,iString:ee,iTemplate:et,themeVariables:ei,referringUser:er,renderComments:ea,renderContent:el,getSettingFor:es,startInterval:ec,forceFollowPrompt:ep}=e,{showTranscription:eh,truncated:eg,autoPlayVoiceOver:eb,reactors:ey,restackers:eZ,shouldShowFollowPrompt:ew,shouldShowSubscribePrompt:eC,shouldShowGiftPostPrompt:ek,appUpsellEligible:eB,mountAppUpsellFooter:eT}=t;if(v.is_geoblocked)return(0,l.tZ)(e3,{});let eL=!!this.context.getConfigFor("like_posts_enabled"),ez=(0,I.N1)(null!==(s=eg||v.body_html)&&void 0!==s?s:""),eO=!B||B&&this.shouldTrackPaywallPostSeen();ec&&eO&&ec({postId:this.props.post.id,containerElementRef:this.containerRef,elementIsStatic:!0});let eU="video"===v.type&&!B&&(null===(i=v.videoUpload)||void 0===i?void 0:i.transcription),eY=this.shouldShowUFI()&&!(0,e_.HD)({pub:g}),eH=e4(v),ej=!!ey&&ey.length>0,eJ=!!(es("paywall_unlock_tokens")&&"only_paid"===v.audience&&v.teaser_post_eligible),eV=eJ&&!(null==m?void 0:m.is_subscribed)&&((null==m?void 0:m.is_free_subscribed)||b)&&!(null==m?void 0:m.has_redeemed_post_unlock_token),eq=(0,eS.tq)({checkFirst4:!0});eJ&&this.isGiftPostEligible()&&(this.context.exposeExperiment("gift_post_unlocks_recipient_2"),["treatment_more_gifty","treatment_popover_gifty"].includes(this.context.getExperimentVariant("gift_post_unlocks_recipient_2"))&&(eV=!0,h=this.context.getExperimentVariant("gift_post_unlocks_recipient_2")));let eW="";eW="video"===v.type?"founding"===v.audience&&(0,ef.H$)(g)?et(eI(),null!==(d=(0,ef.H$)(g))&&void 0!==d?d:""):et("founding"===v.audience?eN():eP()):"adhoc_email"===v.type?"founding"===v.audience&&(0,ef.H$)(g)?et(eE(),null!==(c=(0,ef.H$)(g))&&void 0!==c?c:""):et("founding"===v.audience?eX():eM()):eV?eq?ee("Continue reading this post for free in the Substack app"):et(eA(),g.author_name||g.name):"founding"===v.audience&&(0,ef.H$)(g)?et(eD(),null!==(p=(0,ef.H$)(g))&&void 0!==p?p:""):et("founding"===v.audience?eR():eF());let e0=(0,l.BX)(V.j,{disabled:!w,post:v,isShowsPost:Z,children:[(0,l.tZ)("div",{className:"available-content",children:eh?(0,l.tZ)("div",{className:"container tw-py-12",children:(0,l.tZ)(ev.Z,{post:v,pub:g,user:m,playerRef:this.videoPlayer})}):(0,l.tZ)(z.Z,{html:eg||v.body_html||null,pub:g,trackSelection:!0,post:v,themeVariables:ei,canRestackImage:this.context.getConfigFor("restack_with_image"),user:m,freeSignup:b,freeSignupEmail:y,paywall:B,showing_behind_paywall:!!v.post_paywall_content_for_google})}),v.post_paywall_content_for_google&&(0,l.tZ)("div",{className:"paywall-content",children:(0,l.tZ)(z.Z,{html:v.post_paywall_content_for_google,pub:g,trackSelection:!1,post:v,user:m,freeSignup:b,freeSignupEmail:y,paywall:B})}),!S&&eO&&(0,l.tZ)(K.Z,{onVisible:()=>this.onBottomReached(!!B)})]}),e1=(0,e_.HD)({pub:g}),e8=(0,e_.kb)({pub:g}),e6=e1?(0,l.tZ)(J.Z,{post:v,user:m,pub:g,freeSignupEmail:y}):(0,l.tZ)(E.f1,(0,r._)({user:m,freeSignupEmail:y,freeSignup:b,publication:g,post:v,coupon:!0===this.props.paywall&&this.props.pub.paywall_free_trial_enabled?q:null,showPostUnlockPrompt:!!eV,magicToken:C,giftingUser:er,treatmentVariantForGiftPostPaywall:h,onPostUnlockError:()=>this.props.popToast(e=>(0,l.tZ)(em.FN,(0,o._)((0,r._)({},e),{text:ee("Teaser posts are not currently available for this content")})))},Object.assign({title:eW,reauthenticationTitle:ee("To read this, please re-authenticate.")},B)));return(0,l.BX)("article",{className:u()("typography ".concat(v.type,"-post post"),{"tw-p-0":"podcast"===v.type,"shows-post":Z,"full-width-image-header":(null===(n=v.postTheme)||void 0===n?void 0:n.header_variant)==="full-width-image"}),ref:this.containerRef,children:[(null==m?void 0:m.is_contributor)&&(null==v?void 0:v.id)&&(null==v?void 0:v.type)==="page"&&(0,l.tZ)(ed.zx,{priority:"secondary",href:(0,ex.ANx)(g,v.id,{params:{back:document.location.href}}),localNavigation:!1,leading:(0,l.tZ)(_.Z,{size:20}),children:ee("Edit")}),(0,l.tZ)(e2,{post:v,user:m,onChange:A}),(0,l.tZ)(U.ZP,{ref:this.shareDialogRef,user:m,pub:g,post:v,reaction_token:C,source:"email-share"}),ek&&(0,l.tZ)(P.f,{user:m,post:v,pub:g,referringUser:er,freeSignupEmail:y,variant:this.context.getExperimentVariant("gift_post_unlocks_recipient_2")}),ew&&(0,l.tZ)(N.yi,{pub:g,post:v,referringUser:er,freeSignupEmail:y,forceFollowPrompt:ep,surface:"post-follow-referrer-prompt"}),eC&&(0,l.tZ)(H.H,{pub:g,post:v,stripe_publishable_key:Q,sharer:er,appUpsellEligible:!!eB}),eT&&(0,l.tZ)(x.m,{pub:g,slug:v.slug}),el?(0,l.BX)(l.HY,{children:[!S&&(0,l.tZ)(K.Z,{onVisible:()=>{this.onTopReached(!!B)}}),el({comments:ea?ea():null,crossPostInfo:$,postContent:(0,l.BX)(l.HY,{children:[e0,!!(B&&!v.post_paywall_content_for_google&&!f)&&e6]})})]}):(0,l.BX)(l.HY,{children:[(0,l.tZ)(eQ,{user:null!=m?m:null,pub:g,post:v,isOnPostPage:!0,reaction_token:C,allowEdit:!0,showShare:!0,showSubtitle:!0,showPhoto:!0,showCommentRestack:!g.hide_post_restacks,hideTitle:!!R,noTitleLink:!!F,onChange:A,hideDate:"page"===v.type,hideAudience:"page"===v.type,showReactions:eL,showComments:!!L,showLabel:!0,showUpdatedIcons:!0,fromPostPage:!!Y,onClickCommentButton:this.onCommentButtonClicked,reactors:ey,showRestackModal:!!G,showTranscriptionButton:!!eU,onTranscriptionClick:this.onTranscriptionClick,autoPlayVoiceOver:eb}),!S&&eO&&(0,l.tZ)(K.Z,{onVisible:()=>this.onTopReached(!!B)}),(v.has_voiceover||!!v.voiceoverUpload)&&!w&&(0,l.tZ)(k.KH,{pub:g,post:v,mediaUploadId:v.voiceover_upload_id,duration:null===(a=v.voiceoverUpload)||void 0===a?void 0:a.duration,autoPlay:eb,href:v.canonical_url,isPaywalled:!v.voiceover_upload_id}),!v.voiceoverUpload&&eb&&eH&&(0,l.tZ)(W.r,{postId:v.id,onClose:()=>{(0,en.j)(en.FP.LISTEN_TO_THIS_POST_MODAL_DISMISSED,{post_id:v.id}),this.setState({autoPlayVoiceOver:!1})}}),$?(0,l.tZ)(T.F,{postType:v.type,crossPostInfo:$}):null,(0,l.BX)("div",{children:[ez&&(0,l.tZ)(j.o,{toc:ez,position:"fixed"}),e0,B&&!v.post_paywall_content_for_google?(0,l.BX)(l.HY,{children:[e6,(0,l.tZ)(M.i,{post:v})]}):eg?(0,l.tZ)("p",{children:(0,l.BX)(ed.zx,{className:"expander",onClick:()=>this.setState({truncated:null}),children:["+ ",ee("show full post")]})}):!["page"].includes(null==v?void 0:v.type)&&(0,l.BX)(l.HY,{children:[eY&&(0,l.tZ)(eK,{pub:g,post:v,user:m,freeSignup:!!b,freeSignupEmail:y}),!eY&&this.shouldShowRecommendCta&&(0,l.tZ)(O.o,{pub:g}),$&&("only_paid"===v.audience||"founding"===v.audience)&&(0,l.tZ)(eG,{pub:g}),(0,eo.default)("like_posts_enabled")&&g.community_enabled&&ej&&!w&&(0,l.tZ)(eu.X2,{borderTop:"detail-themed",paddingY:16,children:(0,l.tZ)(X.fB,{post:v,pub:g,user:m,reactors:ey,secondaryFaces:eZ})}),!w&&(0,l.tZ)("div",{className:"post-footer",children:(0,l.tZ)(D.Mp,{post:v,pub:g,user:m,onChange:A,postReactionToken:C})}),(0,l.tZ)(M.i,{post:v})]}),v.show_guest_bios&&"podcast"!==v.type&&!e1&&!e8&&(0,l.tZ)(e$,{user:m,pub:g,post:v})]})]})]})}constructor(e,t){var i,r;super(e,t),(0,n._)(this,"containerRef",void 0),(0,n._)(this,"shareDialogRef",void 0),(0,n._)(this,"podcastCommentInput",void 0),(0,n._)(this,"podcastPlayer",void 0),(0,n._)(this,"videoPlayer",void 0),(0,n._)(this,"shouldShowRecommendCta",void 0),(0,n._)(this,"_triggerShare",void 0),(0,n._)(this,"onTopReached",e=>{this.state.topReached||this.props.postPreview||(this.setState({topReached:!0}),(0,en.jJ)({post:this.props.post,hasPaywall:e,surface:"publication",markRead:!!this.props.user&&!this.props.noPageView,user:this.props.user,trackerUuid:this.props.getCurrentUuid()}))}),(0,n._)(this,"onTranscriptionClick",()=>{this.setState(e=>({showTranscription:!e.showTranscription}))}),(0,n._)(this,"onCommentButtonClicked",e=>{this.props.showComments&&!this.props.post.comment_count&&(e.stopPropagation(),e.preventDefault(),document.dispatchEvent(new CustomEvent("focus-comment-input")))});let o={showTranscription:!1,autoPlay:!1,autoPlayVoiceOver:!1,commentSort:null!==(r=e.post.default_comment_sort)&&void 0!==r?r:"best_first",loadedWithHeaderLink:"undefined"!=typeof window&&(null===(i=window.location.hash)||void 0===i?void 0:i.startsWith("#".concat(encodeURIComponent("\xa7")))),reactors:null,feedUrl:null,shouldShowSubscribePrompt:!1,shouldShowFollowPrompt:!1};e.paywall||e.post.hidden||!e.post.body_html||(o.canShowSubscribeFooterAfterPost=e1(e.post.body_html),o.truncated=e.truncateAt?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if("undefined"==typeof window)return null;let n=document.createElement("div");if(n.innerHTML=e,null===n.textContent||n.textContent.length<t||n.childNodes.length<=1)return null;do n.removeChild(n.lastChild);while(n.childNodes.length>1&&n.textContent.length>i);return n.innerHTML}(e.post.body_html,e.truncateAt,e.truncateTo):null),"undefined"!=typeof window&&window.history.replaceState&&("true"===(0,eC.x)("autoPlay")&&(window.history.replaceState({},document.title,(0,ew.rhs)({autoPlay:null})),o.autoPlay=!0),"true"===(0,eC.x)("play_audio")&&(window.history.replaceState({},document.title,(0,ew.rhs)({play_audio:null})),o.autoPlayVoiceOver=!0)),this.state=o,this.containerRef=(0,s.createRef)(),this.shareDialogRef=(0,s.createRef)(),this.podcastCommentInput=(0,s.createRef)(),this.podcastPlayer=(0,s.createRef)(),this.videoPlayer=(0,s.createRef)(),this.shouldShowRecommendCta=eJ(e.pub,e.user)}}(0,n._)(eq,"contextType",$.WH),(0,n._)(eq,"displayName","Post");let eW=(0,em.dd)((0,Q.f9)((0,ei.us)((0,ee.fz)((0,et.aG)(eq))))),eG=e=>{let{pub:t}=e,{iTemplate:i}=(0,ee.M1)();return(0,l.BX)(l.HY,{children:[(0,l.tZ)(ec.iz,{paddingTop:16}),(0,l.BX)(eu.sg,{gap:16,paddingY:32,alignItems:"center",children:[(0,l.BX)(eu.sg,{gap:8,paddingBottom:8,children:[(0,l.tZ)(eh.xv.H4,{flex:"grow",align:"center",children:i(eL(),t.name)}),(0,l.tZ)(eh.xv.B3,{flex:"grow",align:"center",color:"secondary",children:i(ez())})]}),(0,l.tZ)(ed.zx,{priority:"primary",onClick:()=>{(0,en.j)(en.FP.POST_END_CTA_CLICKED,{type:"cross-post"}),(0,el.uX)((0,ex.W1P)(t,{params:{utm_source:eB.b3.postEndCta,addBase:!0}}),{local_navigation:!1})},children:i(eO(),t.name)})]})]})},eK=e=>{let{pub:t,post:i,user:n,freeSignup:r,freeSignupEmail:o,overridePledgesEnabled:a}=e,{iString:s,iTemplate:c}=(0,ee.M1)(),{getSettingFor:u}=(0,ei.So)(),[p,h]=(0,d.eJ)(null),m=(0,eC.x)("just_subscribed"),g="disabled"===t.payments_state&&!t.invite_only&&(u("payment_pledges_enabled")||a),v="enabled"===t.payments_state&&(null==n?void 0:n.is_free_subscribed)&&!(null==n?void 0:n.is_subscribed)?"paid_upsell":g&&(null==n?void 0:n.is_free_subscribed)&&!(null==n?void 0:n.is_pledged)?"pledge_upsell":"free_upsell",b=g&&(null==n?void 0:n.is_free_subscribed)&&!(null==n?void 0:n.is_pledged);(0,d.d4)(()=>{(0,en.j)(en.FP.POST_END_CTA_RENDERED,{pub_id:t.id,post_id:i.id,type:v})},[t.id,i.id,v,b,null==n?void 0:n.is_free_subscribed]);let y=(0,ek.getByLine)(t);return(0,l.BX)(l.HY,{children:[(0,l.tZ)(ec.iz,{paddingTop:16}),(0,l.tZ)(K.Z,{onVisible:()=>{(0,en.j)(en.FP.POST_END_CTA_SEEN,{pub_id:t.id,post_id:i.id,type:v})}}),(0,l.BX)(eu.sg,{gap:16,paddingY:32,children:[(0,l.BX)(eu.sg,{gap:8,paddingBottom:8,children:[(0,l.tZ)(eh.xv.H4,{flex:"grow",align:"center",children:c(g&&(null==n?void 0:n.is_free_subscribed)?eU():eY(),t.name)}),(0,l.BX)(eh.xv.B3,{flex:"grow",align:"center",color:"secondary",children:[y?c(eH(),y):null,y&&t.rankingDetail?" \xb7 ":null,t.rankingDetail]}),t.hero_text&&(0,l.tZ)(eh.xv.B3,{color:"primary",flex:"grow",align:"center",children:t.hero_text})]}),(0,l.tZ)(eu.sg,{alignItems:"center",gap:16,children:b?(0,l.tZ)(ed.zx,{priority:"primary",onClick:()=>{(0,en.j)(en.FP.POST_END_CTA_CLICKED,{type:"pledge"}),(0,el.uX)((0,ex.W1P)(t,{params:{utm_source:eB.b3.postEndCta}}),{local_navigation:!1})},children:s("Pledge your support")}):(0,l.BX)(l.HY,{children:[(0,l.tZ)(Y.Z,{pub:t,post:i,user:n,freeSignup:r,freeSignupEmail:o,isStatic:!1,onPrepareData:()=>{h(null)},source:"post-end-cta",className:eT.Z.subscribeWidget}),p&&(0,l.tZ)(ep.y,{align:"center",children:p}),!(null==n?void 0:n.is_free_subscribed)&&!m&&(0,l.tZ)(eu.sg,{maxWidth:400,children:(0,l.tZ)(eb.O,{includeCheckbox:!1,addSubscribePreamble:!0,color:"secondary",textAlign:"center"})})]})})]})]})},eQ=e=>{var t,i,n,r;let o,{allowEdit:a,allowSendEmail:s,allowTruncate:d,base_url:c,children:p,className:h,hideAudience:m,hideDate:g,hideTitle:v,hidePinning:b,noTitleLink:y,isStatic:f,isFreePreview:_,is_draft:Z,onChange:w,post:x,pub:k,reaction_token:T,showComments:I,showDatetime:N,showEmailSent:P,showReactions:E,showShare:M,showAppUpsell:L,showSubtitle:z,showPhoto:O,showLabel:U,showRestack:Y,showCommentRestack:H,hideAuthor:j,user:J,utm_source:V,showUpdatedIcons:W,fromPostPage:G,onClickCommentButton:K,reactors:Q,inThreadHead:$,publishedPost:et,compEndsSoon:ei,compEndedRecently:en,siteConfigValues:er={},eligibleForTTS:eo,showRestackModal:ea,showIcon:el,isOnPostPage:es,showTranscriptionButton:ed,onTranscriptionClick:ec,isAppMode:ep=!1,republishingPost:em,autoPlayVoiceOver:eg=!1}=e,{iString:ev}=(0,ee.M1)(),eb=(0,eS.tq)({checkFirst4:!0}),ey=em||x,ef="number"==typeof d?d:45,ew=x.title&&x.title.length>ef,eC=Z?x.draft_title:x.title,eT=[(el||"thread"===x.type)&&(0,l.tZ)(F.m,{postType:x.type,isStatic:f,height:15,className:x.type}),ew&&d?(0,ek.truncateWords)(eC,ef):eC],eI=Z?x.draft_subtitle:x.subtitle;x.section_id&&k.sections&&k.sections.length&&(x.section=k.sections.find(e=>e.id===x.section_id));let eN=(0,eZ.B9)({pub:k,subscriptionType:null==J?void 0:J.subscription_type}),eP=!["page"].includes(null==x?void 0:x.type),eE=eP&&f&&ei&&!eN&&(null==er?void 0:er.continue_support_cta_in_newsletter_emails),eX=e4(x)||eo||x.voiceoverUpload,eM=(null==x?void 0:x.type)==="adhoc_email",eA=eP&&f&&!eM&&!ep,eD=(0,e_.HD)({pub:k})&&(!!x.postTheme||["video","podcast"].includes(x.type)&&$);o=x.post_url_override?x.post_url_override:f&&ep?C.W.POST_TITLE_APP_MODE_URL:f?C.W.POST_TITLE_URL:"".concat((0,ex.uRy)(k,x)).concat(V?"?utm_source=".concat(V):"");let eR="".concat(k.base_url+(ey.section?(0,ex.Ucy)(k,{section:ey.section}):""),"/?utm_source=").concat(eB.b3.substack,"&utm_medium=").concat(eB.lP.menu);return eD?(0,l.tZ)(q.I,{post:x,postTheme:x.postTheme,title:eC,subtitle:eI,pub:k,inThreadHead:!!$,autoPlayVoiceOver:eg}):(0,l.BX)("div",{className:u()("post-header",h),role:"region","aria-label":ev("Post header"),children:[(0,e_.kb)({pub:k})&&(null!==(r=null===(t=x.postTags)||void 0===t?void 0:t.length)&&void 0!==r?r:0)>0&&(0,l.tZ)(eu.X2,{alignItems:"center",gap:4,paddingBottom:8,children:null===(i=x.postTags)||void 0===i?void 0:i.map((e,t)=>(0,l.BX)(l.HY,{children:[0!==t&&(0,l.tZ)(eh.xv.Meta,{children:"â€”"}),(0,l.tZ)(eh.xv.Meta,{as:"a",size:14,href:(0,ex.Mk9)(k,e),children:e.name})]}))}),U&&x.section&&(0,l.tZ)(eu.X2,{className:"post-label",children:(0,l.tZ)(eh.xv.Meta,{as:"a",size:14,href:eR,children:null===(n=ey.section)||void 0===n?void 0:n.name})}),eE&&(0,l.tZ)(B.v,{post:x,compAlreadyExpired:en}),!v&&(0,l.tZ)("h1",{className:u()("post-title",x.is_published?"published":"restack"!==x.type||em?"adhoc_email"===x.type?"adhoc":"unpublished":"email-only-cross-post",{"post-title--the-pillar":(0,e_.kb)({pub:k})}),children:y?eT:(0,l.tZ)("a",{href:o,children:eT})}),z&&eI&&(0,l.tZ)("h3",{className:u()("subtitle",{"subtitle--the-pillar":(0,e_.kb)({pub:k})}),children:eI}),"page"===x.type?(0,l.tZ)("div",{style:{height:32}}):es&&!f?(0,l.BX)(eu.sg,{paddingBottom:16,"aria-label":ev("Post UFI"),role:"region",children:[(0,l.tZ)(eu.sg,{paddingY:16,children:(0,l.tZ)(R.E,{post:x,pub:k})}),(0,l.tZ)(S.j,{user:J,isMobile:eb,post:x}),eb?G&&(0,l.tZ)(D.mt,{post:x,pub:k,user:J,isStatic:!!f,postReactionToken:T,onChange:w,allowEdit:a,hidePinning:b,showEmailSent:P,allowSendEmail:s,hideComments:!I,onCommentsClick:K,showRestackModal:ea}):(0,l.tZ)(D.Mp,{post:x,pub:k,user:J,onChange:w,showRestackModal:ea,showTranscriptionButton:ed,onTranscriptionClick:ec,showClipping:"video"===x.type,postReactionToken:T})]}):(0,l.BX)(l.HY,{children:[!eP||f||et||$?eP&&!f&&et?(0,l.tZ)(D._2,{post:x,pub:k,user:J,style:"compressed",labelStyle:"counts-or-none",postReactionToken:T,showEmailSent:P,hideShare:!M||"restack"===x.type,hideComments:"restack"===x.type,hideSavePost:"restack"===x.type,hideReactions:"restack"===x.type,showPreamble:!0,onChange:void 0,allowEdit:a,allowSendEmail:s,editButtonIsLast:!0,preambleConfig:{showAudience:!m,showDate:!g,showDatetime:N,showAuthor:!j},isStatic:f,position:"publisher-post-list"}):$&&!f?(0,l.tZ)(D._2,{post:x,pub:k,user:J,style:"compressed",labelStyle:"counts-or-none",postReactionToken:T,hideSavePost:!0,showPreamble:!0,allowEdit:a,allowSendEmail:s,editButtonIsLast:!0,onChange:w,preambleConfig:{showAudience:!m,showDate:!g,showDatetime:N,showAuthor:!j},hideShare:!M,position:"publisher-post-list",isStatic:f}):eP?(0,l.tZ)(X.SP,{user:J,pub:k,post:x,showDate:!g,showDatetime:N,showEmailSent:P,showAudience:!m,showReactions:!eA&&E,showComments:!eA&&I,showShare:!eA&&M,showRestack:!eA&&Y,reaction_token:T,onChange:w,isStatic:f,isFreePreview:_,sharedShareDialog:!0,base_url:c,allowSendEmail:s,allowEdit:a,showAuthor:!j,showPhoto:O,hidePinning:b,showUpdatedIcons:W,inThreadHead:$,fromPostPage:G,onClickCommentButton:K,reactors:Q,isAppMode:ep}):(0,l.tZ)("div",{className:"spacer",style:{height:24}}):(0,l.tZ)(A.a,{className:"meta-subheader",pub:k,post:x,user:J,showDate:!g,showDatetime:!!N,isStatic:!!f,postReactionToken:T,onChange:w,allowEdit:a,hidePinning:b,showEmailSent:P,allowSendEmail:s,allowMobileFooter:G,onCommentsClick:K,showRestackModal:ea}),eP&&eA&&(0,l.tZ)(D.yT,{customization:{showShare:M,showComments:I,showReactions:E,showListen:!Y&&!_&&!!eX,showSave:!Y,showRestack:Y,showCommentRestack:H,showAppUpsell:L}}),eM&&(0,l.tZ)("div",{className:"email-ufi-2-empty"})]}),p]})},e$=e=>{let{user:t,pub:i,post:n}=e,{iString:r,iTemplate:o}=(0,ee.M1)(),a=(0,ek.getBylineUsers)(n).filter(e=>e.is_guest);return 0===a.length?null:(0,l.BX)("div",{className:"post-contributor-footer",children:[(0,l.tZ)("div",{className:"container-border"}),a.map(e=>{let n=(0,ek.guessFirstName)(e.name),a=e.primaryPublicationSubscribeUrl;a&&(null==t?void 0:t.email)&&(a=(0,ew.rhs)(a,{email:t.email,autoSubmit:!0,utm_source:eB.b3.substack,utm_campaign:eB.VX.guestPostBio,utm_medium:eB.lP.web}));let s=(0,ew.rhs)((0,ex.NNq)(e),{utm_campaign:eB.VX.guestPostBio,utm_medium:eB.lP.web}),d=G.ZP.hasCustomProfilePhoto(e);return(0,l.tZ)("div",{className:u()("post-contributor-bio",{"post-contributor-bio-no-text":!e.bio}),"data-user-id":e.id,children:(0,l.tZ)("table",{cellpadding:"0",cellspacing:"0",className:"post-contributor-bio-table",children:(0,l.BX)("tr",{className:"post-contributor-bio-table-row",children:[d&&(0,l.tZ)("td",{className:"post-contributor-bio-userhead-cell post-contributor-bio-userhead-cell-web",children:(0,l.tZ)(L.ProfileHoverCard,{subject:e,utmSource:"byline",children:(0,l.tZ)(G.ZP,{size:52,user:t,pub:i,subject:e})})}),(0,l.tZ)("td",{className:"post-contributor-bio-body-cell post-contributor-bio-body-cell-web",children:(0,l.BX)("div",{className:"post-contributor-bio-body",children:[e.bio&&(0,l.tZ)("div",{className:"post-contributor-bio-preamble",children:r("A guest post by")}),(0,l.tZ)("table",{cellpadding:"0",cellspacing:"0",className:"post-contributor-bio-body-table",children:(0,l.BX)("tr",{className:"post-contributor-bio-body-table-row",children:[(0,l.BX)("td",{className:"post-contributor-bio-copy-cell",children:[!e.bio&&(0,l.tZ)("div",{className:"post-contributor-bio-preamble",children:r("A guest post by")}),(0,l.BX)(eu.X2,{gap:4,alignItems:"center",paddingBottom:4,children:[(0,l.tZ)(L.ProfileHoverCard,{subject:e,utmSource:"byline",children:(0,l.tZ)("a",{className:"post-contributor-bio-title no-margin",href:s,native:!0,children:e.name})}),(0,l.tZ)(eg.UserBadge,{size:"sm",tier:e.bestseller_tier,userId:e.id})]}),e.bio&&(0,l.tZ)("div",{className:"post-contributor-bio-text",children:e.bio})]}),(0,l.tZ)("td",{className:"post-contributor-bio-controls-cell post-contributor-bio-controls-cell-web",children:(0,l.tZ)("div",{className:"post-contributor-bio-controls",children:a&&(0,l.tZ)("a",{className:"post-contributor-bio-subscribe-button button primary",href:a,native:!0,children:(0,l.tZ)("span",{className:"post-contributor-bio-subscribe-button-label",children:o(ej(),n)})})})})]})})]})})]})})})})]})};class e0 extends s.Component{render(e){let{renderPost:t,posts:i,hideFirstHeading:n,className:r,top:o,children:a}=e;return i=i.slice(0).sort((e,t)=>(0,ey.Z)(t.post_date)-(0,ey.Z)(e.post_date)),(0,l.BX)("div",{className:"calendared-post-list ".concat(r||""),children:[o,h()(g()(this.renderByHeading(i,"year",(e,n)=>[!n.isSameNow("year")&&(0,l.tZ)("h2",{date:n,children:n.year()}),this.renderByHeading(e,"month",(e,r)=>[!(r.isSameNow("year")&&r.isSameNow("month"))&&(0,l.BX)("h3",{date:n,children:[(0,ek.get_month_name)(r)," ",!r.isSameNow("year")&&r.year()]}),e.map(e=>t(e,i.indexOf(e),i))])]))).filter((e,t,i)=>!n||t>=i.findIndex(e=>!e.props||!e.props.date)),a]})}renderByHeading(e,t,i){let n=b()(e,e=>(0,ey.Z)(e.post_date)[t]());return f()(n).sort((e,t)=>Number(t[0])-Number(e[0])).map(e=>{var t;let[,n]=e;return i(n,(0,ey.Z)(null===(t=n[0])||void 0===t?void 0:t.post_date))})}}function e1(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if("undefined"==typeof window)return!1;let i=document.createElement("div");i.innerHTML=e;let n="",r=!1;for(let e=i.childNodes.length-1;e>=0;e--){let o=i.childNodes[e];if(o){if((0,el.pv)(o,"button-wrapper")||(0,el.pv)(o,"subscription-widget-wrap")||(0,el.pv)(o,"subscribe-widget")){r=!0;break}if((n+=o.textContent).length>t)break}}return!r}function e2(e){let{post:t,user:i,onChange:n}=e,[a,s]=(0,d.eJ)(!1),{getExperimentVariant:c}=(0,Q.jc)(),u="treatment"===c("video_email_watch_later_experiment"),{onSave:p}=(0,D.vk)({post:t,isSaved:!1});return((0,d.d4)(()=>{if("save"===new URL(location).searchParams.get("action")&&(history.replaceState({},"",(0,ew.rhs)({action:null})),i)){let e=p();n({post:(0,o._)((0,r._)({},t),{is_saved:e})}),e&&u&&s(!0)}},[]),a)?(0,l.tZ)(es.X,{onClose:()=>s(!1)}):null}function e4(e){var t;return!!(null===(t=e.audio_items)||void 0===t?void 0:t.some(e=>"tts"===e.type))}let e3=()=>(0,l.tZ)("article",{className:u()("typography post",{"shows-post":!1}),children:(0,l.tZ)("div",{className:"container tw-p-12",children:(0,l.tZ)("p",{align:"center",children:(0,l.tZ)(eh.xv,{translated:!0,as:"span",children:"This content has been withheld in your country in response to a legal requirement."})})})})},30329:function(e,t,i){i.d(t,{dJ:()=>N,fS:()=>k});var n=i(27412),r=i(7409),o=i(16584),a=i(6400),l=i(94184),s=i.n(l),d=i(12297),c=i.n(d),u=i(80569),p=i.n(u),h=i(60826),m=i(12620),g=i(666),v=i(93666),b=i(95441),y=i(8923),f=i(35702),_=i(68833),Z=i(98914),w=i(19081),C=i(58175),x=i(60308),S=i(84864);let k=(e,t)=>B(e,t,!t.reaction),B=(e,t,i)=>{let n="reaction"in t?t.reaction:void 0,{reactions:o={"â¤":0},reactor_names:a=[]}=t;if(o=(0,r._)({},o),a=[...a],i&&!n){let t=o[n="â¤"];o[n]=t?t+1:1,e&&e.is_public_admin&&a.push(e.name||"author")}else!i&&n&&(o["â¤"]=o["â¤"]?o["â¤"]-1:0,e&&e.is_public_admin&&(a=a.filter(t=>t!==(e.name||"author"))),n=null);return{reaction:n,reactions:o,reactor_names:a}},T=(e,t,i,n)=>{e.reaction=t,e.reactions=i,e.reactor_names=n};class I extends a.Component{notifyParent(e){let{reaction:t,reactions:i,reactor_names:n}=e,o=(0,r._)({},this.props.post),a=this.props.comment&&(0,r._)({},this.props.comment);T(a||o,t,i,n),this.props.onChange&&this.props.onChange({post:o,comment:a})}async reactionRejected(e){(0,_.j)(_.FP.REACTION_REJECTED,{comment_id:this.props.comment&&this.props.comment.id,post_id:this.props.post&&this.props.post.id,reason:"Not logged in",unreact:!e}),await new Promise(e=>{this.state.includeModal?this.modalRef.current.open(e):this.setState({includeModal:!0},()=>this.modalRef.current.open(e))})}render(e){let t,{className:i,user:n,pub:r,comment:a,height:l,isStatic:d,post:u,buttonStyle:p,hideReactionCount:m,countInParenthesesStyle:v,iString:b}=e,y=a||u,f=null==y?void 0:y.reaction,_=(null==y?void 0:y.reactions)||{},Z=c()(Object.values(_));return t=u&&u.reaction_url_override?u.reaction_url_override:d?h.W.REACTION_URL:"javascript:void(0)",(0,o.BX)(C.xv,{as:"span",decoration:"hover-underline",color:f?"accent-red":"pub-secondary-text",className:i,children:[this.props.render?this.props.render({liked:f,numReactions:Z>0?(0,S.numberToString)(Z):null,onClick:e=>{this.react(e)}}):(0,o.tZ)("a",{href:t,className:s()("like-button",{button:p,"post-meta-button":p,liked:f}),onClick:e=>this.react(e),children:(0,o.BX)(w.hs,{gap:6,alignItems:"center",className:i,children:[d?(0,o.tZ)(g.Z,{ampProps:{layout:"fixed"},isStatic:!0,height:l,stroke:"var(--color-secondary-themed)",fill:"transparent"}):(0,o.BX)(w.hs,{className:"reaction-container",children:[(0,o.tZ)(g.Z,{className:"animation"}),!f&&(0,o.tZ)(g.Z,{strokeWidth:2,height:l,fill:"transparent",stroke:"var(--color-secondary-themed)"}),f&&(0,o.tZ)(g.Z,{height:l,strokeWidth:2})]}),v?(0,o.BX)(C.xv.Meta,{color:f?"accent-red":"pub-secondary-text",className:"like-count",children:[b(f?"Liked":"Like"),!m&&Z>0?" (".concat((0,S.numberToString)(Z),")"):""]}):!m&&Z>0?(0,o.tZ)("span",{className:"like-count",children:(0,S.numberToString)(Z)}):p?(0,o.tZ)("span",{className:"like-count",children:b("Like")}):null]})}),!d&&this.state.includeModal&&(0,o.tZ)(P,{modalRef:this.modalRef,user:n,pub:r,comment:a,react:this.react})]})}constructor(...e){super(...e),(0,n._)(this,"state",{includeModal:!1}),(0,n._)(this,"modalRef",(0,a.createRef)()),(0,n._)(this,"react",async e=>{if(this.props.isStatic)return;e&&e.stopPropagation();let t=this.props.comment||this.props.post;if(!t){console.warn("LikeButton: no subject");return}let i=!t.reaction;if(this.props.onReactedChange&&this.props.onReactedChange(i),this.props.noSelfUpdate)return;let n=await (0,Z.Se)(this,"locked",async(e,t)=>{let n;let r=t.comment||t.post;if(!r){console.warn("LikeButton: no subject");return}let o=function(e,t,i,n){let r=(0,x.n1t)("/api/v1/".concat(t?"comment":"post","/").concat(e.id,"/reaction"),{token:n});return i?p().post(r).send({reaction:"â¤"}):p().delete(r)}(r,!!t.comment,i,t.token);t.oauthAccessToken&&o.set("Authorization","Bearer ".concat(t.oauthAccessToken));let{reaction:a,reactions:l,reactor_names:s}=k(t.user,r);this.notifyParent({reactions:l,reaction:a,reactor_names:s});try{await o}catch(e){n=e,this.notifyParent(r)}return{error:n,reaction:a}});return n&&n.error&&(n.error.response&&401===n.error.response.statusCode?await this.reactionRejected(n.reaction):alert((0,Z.zx)(n.error))),!!n&&!n.error})}}let N=(0,b.fz)((0,y.$1)(I));function P(e){let{comment:t,pub:i,user:n,modalRef:r,onClose:a,react:l}=e,{iString:s}=(0,b.M1)();return(0,o.tZ)(v.Z,{ref:r,onClose:a,children:(0,o.BX)(w.tu,{alignItems:"center",paddingTop:80,gap:24,children:[(0,o.tZ)(C.xv.H2,{children:s(t?"Subscribe to like this comment":"Subscribe to like this post")}),(0,o.tZ)(m.Z,{user:n,pub:i,showLogin:!0,showTerms:!0,source:"like_button",onSuccess:async e=>{let t=e&&e.body&&e.body.email;e&&e.body&&e.body.prompt_to_login||!await l()?window.location.href=(0,x.uXE)({for_pub:i.subdomain,email:t}):(null==r?void 0:r.current)&&((0,f.a)({freeSignup:!0,freeSignupEmail:t}),await r.current.close())}})]})})}},51014:function(e,t,i){i.d(t,{Gj:()=>K,Wi:()=>j,ZP:()=>J});var n=i(27412),r=i(7409),o=i(99282),a=i(98848),l=i(16584),s=i(18446),d=i.n(s),c=i(25380),u=i(85200),p=i(20160),h=i(83330),m=i(59154),g=i(79138),v=i(90443),b=i(37632),y=i(18573),f=i(82653),_=i(77559),Z=i(82695),w=i(4473),C=i(39535),x=i(93666),S=i(347),k=i(20888),B=i(75697),T=i(70522),I=i(95441),N=i(77906),P=i(72572),E=i(98170),X=i(60225),M=i(68833),A=i(59176),D=i(98914);i(15771);var R=i(19081),F=i(44424),L=i(58175),z=i(31065);i(23398);var O=i(60308),U=i(84864),Y=i(47929),H=i(46518);let j=e=>{let{pub:t,post:i,profile:n,comment:r}=e,o="undefined"!=typeof document?document.title:"",a="",s="",d=(0,O.SVA)(t).replace(/^https?:\/\//,"").replace(/\/$/);return r&&t&&i?(o=r.name?"Comment by ".concat(r.name," on ").concat(t.name):"Comment on ".concat(t.name),a=(0,U.truncateText)(r.body,100),s=i.cover_image||null):i?(o=i.title||i.draft_title,a=d,s=i.cover_image||null):t?(o=t.name,a=d,s=t.logo_url):n&&(o=n.name,a=n.bio,s=(0,O.SMH)(n)),(0,l.BX)(R.gq,{className:"social-preview-box ".concat(i?"post":t?"pub":"user"),radius:"md",border:"detail",padding:8,children:[(0,l.BX)("div",{className:"social-image-box",children:[(i||t)&&s&&(0,l.tZ)(k.e,{className:"social-image",src:s,alt:"",maxWidth:120,loading:"lazy"}),!i&&!t&&s&&(0,l.tZ)(T.cy,{className:"social-image",imageUrl:s,size:52}),!s&&(0,l.tZ)(h.Z,{className:"social-image-default"})]}),(0,l.BX)(R.tu,{paddingLeft:12,paddingY:8,children:[(0,l.tZ)(L.xv.H4,{children:o}),(0,l.tZ)(L.xv.B4,{color:"secondary",children:a})]})]})};class J extends x.p{shouldComponentUpdate(e,t){return!d()(this.props,e)||!d()(this.state,t)}async open(){let e={title:(0,B.B8)((0,r._)({},this.props)),url:this.props.shareUrl||(0,B.O1)("direct",(0,r._)({medium:this.state.medium},this.props))};if((0,D.K1)()&&navigator.share&&navigator.canShare&&navigator.canShare(e))try{var t;await navigator.share(e),(0,M.j)(M.FP.NATIVE_SHARE_SUCCESS,{medium:this.state.medium||this.props.medium||"web",post_id:this.props.post?this.props.post.id:null,utm_campaign:this.state.utm_campaign||this.props.utm_campaign||"default"}),(0,A.ex)("".concat(null===(t=this.props.pub)||void 0===t?void 0:t.subdomain," shared"),!0);return}catch(e){if("AbortError"===e.name)return;(0,M.j)(M.FP.NATIVE_SHARE_FAILED,{errorName:e.name,errorMessage:e.message})}super.open()}fromEmail(){this.setState({medium:"email"},()=>{this.open()})}getClassName(){return"share-dialog"}onBeforeOpen(){this.setState({showButtons:!0})}onOpen(){(0,M.j)(M.FP.SHARE_DIALOG_OPENED,{medium:this.state.medium||this.props.medium||"web",post_id:this.props.post?this.props.post.id:null,utm_campaign:this.state.utm_campaign||this.props.utm_campaign||Y.VX.default})}onClose(){this.setState({copied:!1,utm_campaign:null})}renderChildren(e){var t;let{post:i,pub:n,comments:a,commentId:s,shareUrl:d}=e,c=a&&s&&a.find(e=>e.id===s),u=c?"comment":n&&!i?"publication":i?"post":void 0;return(0,l.tZ)(S.h,{children:(0,l.tZ)(p.W,{children:(0,l.BX)(R.tu,{className:H.Z.container,gap:24,padding:24,bg:"primary",radius:"md",border:"detail",children:[(0,l.tZ)(V,{type:u}),(0,l.tZ)(q,{type:u,pub:n,post:i,comment:c,shareUrl:d}),(0,l.tZ)(R.tu,{gap:16,children:(0,l.tZ)(K,(0,o._)((0,r._)({utm_campaign:null!==(t=this.state.utm_campaign)&&void 0!==t?t:void 0},this.props),{shareName:(0,B.B8)((0,r._)({},this.props)),shareUrl:d||(0,B.O1)(null,(0,r._)({medium:this.state.medium},this.props))}))})]})})})}constructor(e,t){super((0,r._)({},e),t),this.noFullscreen=!0}}(0,n._)(J,"contextType",I.wj);let V=e=>{let{type:t}=e,{iString:i}=(0,I.M1)();return(0,l.tZ)(L.xv.H4,{align:"center",flex:"grow",children:i(t?"Share this ".concat(t):"Share")})},q=e=>{let{type:t,pub:i,post:n,comment:r,shareUrl:o}=e;return(0,l.BX)(W,{post:n,children:["comment"==t&&r&&(0,l.tZ)(N.UK,{comment:r,readOnly:!0}),"post"==t&&n&&i&&(0,l.tZ)(E.tg,{post:n,publication:i,readOnly:!0}),"publication"==t&&i&&(0,l.tZ)(X.U,{publication:i,readOnly:!0}),void 0==t&&(0,l.tZ)(P.N,{url:o,readOnly:!0})]})},W=e=>{let{post:t,onChange:i,children:n}=e,r=(0,B.O1)(null,{medium:"web",post:t}),{handleCopyLink:o}=(0,B.Uo)();return(0,l.tZ)(R.tu,{as:"a",onClick:()=>{o({shareUrl:r}),null==i||i()},href:r,cursor:"pointer",animate:!0,gap:8,children:n})},G=e=>{let{onClick:t,icon:i,name:n}=e;return(0,l.tZ)(z.X,{onClick:t,label:n,icon:i,size:64,radius:"lg"})};function K(e){let{iString:t}=(0,I.M1)(),i=()=>{var t;null===(t=e.onChange)||void 0===t||t.call(e)},n=(0,l.BX)(l.HY,{children:[(0,l.tZ)(F.sN,{onClick:()=>{(0,B.bI)((0,r._)({},e)),i()},leading:(0,l.tZ)(m.Z,{}),children:"Bluesky"}),(0,l.tZ)(F.sN,{onClick:()=>{(0,B.Wn)((0,r._)({},e)),i()},leading:(0,l.tZ)(C.Z,{}),children:"X (Twitter)"}),!e.disableNotes&&(0,l.tZ)(F.sN,{onClick:()=>{(0,B.lc)((0,r._)({},e)),i()},leading:(0,l.tZ)(b.Z,{}),children:"LinkedIn"}),(0,l.tZ)(F.sN,{onClick:()=>{(0,B.sn)((0,r._)({},e)),i()},leading:(0,l.tZ)(Z.Z,{}),children:"Reddit"}),(0,l.tZ)(F.sN,{onClick:()=>{(0,B.Vn)((0,r._)({},e)),i()},leading:(0,l.tZ)(_.Z,{}),children:"Pinterest"}),(0,l.tZ)(F.sN,{onClick:()=>{(0,B.b6)((0,r._)({},e)),i()},leading:(0,l.tZ)(v.Z,{}),children:"Hacker News"})]}),o={size:20,stroke:"var(--color-fg-primary)"},{handleCopyLink:s,justCopied:d}=(0,B.Uo)();return(0,l.BX)(R.gq,{justifyContent:"space-between",children:[(0,l.tZ)(G,{onClick:()=>{s((0,r._)({},e)),i()},icon:d?(0,l.tZ)(c.Z,(0,r._)({},o)):(0,l.tZ)(y.Z,(0,r._)({},o)),name:d?t("Copied"):t("Copy link")}),(0,l.tZ)(G,{onClick:()=>{(0,B.Po)((0,r._)({},e)),i()},icon:(0,l.tZ)(g.Z,(0,r._)({},o)),name:"Facebook"}),(0,l.tZ)(G,{onClick:()=>{(0,B.WZ)((0,r._)({},e)),i()},icon:(0,l.tZ)(f.Z,(0,r._)({},o)),name:"Email"}),e.disableNotes?(0,l.tZ)(G,{onClick:()=>{(0,B.lc)((0,r._)({},e)),i()},icon:(0,l.tZ)(b.Z,(0,r._)({},o)),name:"Linkedin"}):(0,l.tZ)(G,{onClick:()=>{(0,B.BZ)((0,r._)({},e)),i()},icon:(0,l.tZ)(w.Z,(0,r._)({},o)),name:"Notes"}),(0,l.tZ)(F.v2,{layerOptions:{triggerOffset:-20},trigger:e=>{var{ref:i}=e,n=(0,a._)(e,["ref"]);return(0,l.tZ)(z.X,(0,r._)({forwardRef:i,label:t("More"),icon:(0,l.tZ)(u.Z,(0,r._)({},o)),size:64,radius:"lg"},n))},onOpen:()=>{(0,M.j)(M.FP.SHARE_DIALOG_MORE_OPTION_CLICKED,{medium:e.medium||"web",post_id:e.post?e.post.id:null,utm_campaign:e.utm_campaign||Y.VX.default})},children:n})]})}},93783:function(e,t,i){i.d(t,{A:()=>_,Vs:()=>y,t5:()=>f});var n=i(27412),r=i(7409),o=i(99282),a=i(98848),l=i(16584),s=i(6400),d=i(20042),c=i(56232),u=i(95441),p=i(98914),h=i(40225),m=i(21200),g=i(60308),v=i(26111);let b=(0,s.createContext)(void 0);class y extends s.Component{componentDidMount(){document.addEventListener("keydown",this.onDocumentKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.onDocumentKeyDown)}render(){let e=this.props,{searchKey:t,onInput:i,onKeyDown:n,placeholder:s,value:d}=e,u=(0,a._)(e,["searchKey","onInput","onKeyDown","placeholder","value"]);return(0,l.tZ)(c.Match,{path:"/",children:e=>{let{url:i}=e,a=(0,v.x)(i,t||"search");return(0,l.tZ)(h.M,(0,o._)((0,r._)({placeholder:void 0!==s?s:this.context.iString("Searchâ€¦"),defaultValue:a,onChange:this.handleChange,onKeyDown:n},u),{ref:this.assignBase}))}})}constructor(...e){super(...e),(0,n._)(this,"assignBase",e=>{this.base=e}),(0,n._)(this,"onDocumentKeyDown",e=>{this.props.slash&&"/"===e.key&&!(document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.nodeName))?(e.preventDefault(),document.documentElement.scrollTop=Math.max((0,p.LG)(this.base,"top")-142,0),(0,p.UG)(this.base),this.base&&"focus"in this.base&&"function"==typeof this.base.focus&&this.base.focus()):"Escape"===e.key&&(0,p.$Z)(this.base)&&(this.base&&"blur"in this.base&&"function"==typeof this.base.blur&&this.base.blur(),this.base&&"value"in this.base&&this.base.value&&(this.base.value="",this.updateSearchUrl("")))}),(0,n._)(this,"updateSearchUrl",e=>{let t=(0,g.rhs)({search:e||null},null,{skipHash:!0});"replaceState"in window.history&&(0,d.route)(t,!0)}),(0,n._)(this,"handleChange",e=>{this.updateSearchUrl(e),this.props.onInput&&this.props.onInput({currentTarget:{value:e}})})}}(0,n._)(y,"contextType",u.wj);class f extends s.Component{componentDidMount(){if(this.base){var e;this.textContent="".concat(this.base.textContent).concat(null!==(e=this.context)&&void 0!==e?e:""," ").concat(this.props.extraKeywords?" ".concat(this.props.extraKeywords):""),this.setState({thisWillForceFirstResultsRender:!0})}}render(){return(0,l.tZ)(b.Consumer,{children:e=>(null==e?void 0:e(this.textContent))?(0,l.tZ)(s.Fragment,{children:this.props.children}):null})}constructor(...e){super(...e),(0,n._)(this,"textContent",void 0)}}(0,n._)(f,"contextType",m.p);class _ extends s.Component{componentDidMount(){this.textContents={},setTimeout(()=>this.setState({thisWillForceFirstResultsRender:!0}),0)}componentWillUnmount(){this.textContents=null}showResultParent(e){if(!this.textContents)return!0;for(let t in this.textContents)if(this.showResult(t,e))return!0;return!1}showResult(e,t){if(!e)return!0;e=e.toLowerCase(),this.textContents&&(this.textContents[e]=!0);let i=((0,v.x)(t,this.props.searchKey||"search")||"").split(/[^A-Za-z0-9]/g).map(e=>e.toLowerCase()).filter(e=>e);return 0===i.length||i.reduce((t,i)=>t&&!!(null==e?void 0:e.includes(i)),!0)}render(){return(0,l.tZ)(c.Match,{path:"/",children:e=>{let{url:t}=e;return(0,l.tZ)(b.Consumer,{children:e=>{let i=(0,v.x)(t,this.props.searchKey||"search")||"";return this.showResultParent(t)?(0,l.tZ)(b.Provider,{value:i=>(e&&e(i,t),this.showResult(i,t)),children:this.props.children}):this.props.noResults&&this.props.noResults(i)}})}})}constructor(...e){super(...e),(0,n._)(this,"textContents",void 0)}}},50515:function(e,t,i){i.d(t,{J:()=>u,Z:()=>p});var n=i(27412),r=i(7409),o=i(99282),a=i(98848),l=i(16584),s=i(6400),d=i(98914),c=i(84864);let u={"data-gramm":"false","data-gramm_editor":"false","data-enable-grammarly":"false"};class p extends s.Component{componentDidMount(){this.setAutoHeight(),window.addEventListener("resize",this.onWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}componentDidUpdate(e){e.value!==this.props.value&&this.setAutoHeight()}get value(){return this.base?this.base.value:""}setAutoHeight(){this.props.autoHeight&&this.base&&"undefined"!=typeof window&&window.getComputedStyle&&(0,d.nn)(this,async e=>{if(!this.base)return;this.base.style.height="";let t=window.getComputedStyle(this.base),i=parseInt(t.getPropertyValue("height")),n=parseInt(t.getPropertyValue("padding-top"))+parseInt(t.getPropertyValue("padding-bottom")),r=parseInt(t.getPropertyValue("line-height")),o=Math.min(Math.round((this.base.scrollHeight-n)/r),this.props.maxLines||1/0);this.base.style.height="".concat(Math.max(o*r+n,i),"px"),this.base.style.height!==e.height&&this.setState({height:this.base.style.height})})}render(e,t){var{children:i,ref:n,style:s,onKeyDown:d,onInput:c,inline:p,autoHeight:h,maxLines:m}=e,g=(0,a._)(e,["children","ref","style","onKeyDown","onInput","inline","autoHeight","maxLines"]),{height:v}=t;return h&&(s=Object.assign({},s,{height:v})),(0,l.tZ)("textarea",(0,o._)((0,r._)({style:s,onKeyDown:this.onKeyDown,onInput:this.onInput,onBlur:this.onBlur},u,g),{children:i}))}constructor(...e){super(...e),(0,n._)(this,"base",void 0),(0,n._)(this,"onWindowResize",()=>{this.setAutoHeight()}),(0,n._)(this,"onKeyDown",e=>(this.props.inline&&"Enter"===e.key&&e.preventDefault(),this.props.onKeyDown&&this.props.onKeyDown(e))),(0,n._)(this,"onInput",e=>(this.setAutoHeight(),this.props.onInput&&this.props.onInput(e))),(0,n._)(this,"onBlur",e=>{if(this.props.inline){var t;let e=null===(t=this.base)||void 0===t?void 0:t.value,i=(0,c.sanitizeInlineText)(e);e&&e!==i&&this.base&&(this.base.value=i,this.props.onInput&&this.props.onInput(event))}})}}},40281:function(e,t,i){i.d(t,{f:()=>d});var n=i(16584);i(58319);var r=i(61264),o=i(61254),a=i(19081);i(98248);var l=i(14773),s=i(17043);let d=e=>{let{isEvents:t,posts:i}=e;return(0,n.tZ)(a.tu,{gap:24,children:i.map((e,i)=>(0,n.BX)(n.HY,{children:[0!==i&&(t?(0,n.BX)(a.gq,{alignItems:"center",gap:24,paddingY:16,children:[(0,n.tZ)(a.gq,{flex:"grow",children:(0,n.tZ)(o.iz,{})}),(0,n.tZ)("img",{src:(0,s.zF)("".concat((0,l.ZJ)(),"/img/thefp/fp-stars.svg"),154)}),(0,n.tZ)(a.gq,{flex:"grow",children:(0,n.tZ)(o.iz,{})})]}):(0,n.tZ)(o.iz,{})),(0,n.tZ)(r.X,{post:e,variant:t?"event-page":"archive"})]}))})}},8845:function(e,t,i){i.d(t,{T:()=>a}),i(16584);var n=i(6400),r=i(30396);i(6070);let o=(0,n.createContext)({theme:null,setTheme:()=>void 0}),a=()=>(0,r.qp)(o)},12980:function(e,t,i){i.d(t,{H:()=>N});var n=i(27412),r=i(58865),o=i(16584),a=i(6400),l=i(80569),s=i.n(l),d=i(60826),c=i(56219),u=i(94442),p=i(11712),h=i(89276),m=i(3900),g=i(95441),v=i(19081);let b=e=>{let{post:t,ctaUrl:i,ctaText:n,hidden:r}=e,{iString:a}=(0,g.M1)(),l=n;return r||"podcast"!==t.type?r||"newsletter"!==t.type||(l=a("Back to article")):l=a("Back to episode"),(0,o.tZ)(v.tu,{alignItems:"start",paddingY:8,children:(0,o.tZ)(m._,{href:i,leadingIcon:"chevron-left",native:!0,size:"md",variant:"tertiary",children:l})})};var y=i(58319),f=i(75905),_=i(90099),Z=i(68833),w=i(98914),C=i(6070),x=i(31377),S=i(60308),k=i(84864),B=i(47929);function T(){let e=(0,r._)(["This thread is only visible to "," subscribers of ",""]);return T=function(){return e},e}class I extends a.Component{onTopReached(){this.state.topReached||(this.setState({topReached:!0}),(0,Z.j)(Z.FP.POST_SEEN,{post_id:this.props.post.id,post_audience:this.props.post.audience,post_type:this.props.post.type}))}onBottomReached(){this.state.bottomReached||(this.setState({bottomReached:!0}),(0,Z.j)(Z.FP.POST_BOTTOM_SEEN,{post_id:this.props.post.id,post_audience:this.props.post.audience,post_type:this.props.post.type}))}async enableEmailNotifications(){try{await s().post("/api/v1/post/".concat(this.props.post.id,"/subscribe")),window.location.reload()}catch(e){console.error("Failed to subscribe to email notifications:",e),alert((0,w.zx)(e))}}render(e){let t,i,{className:n,pub:r,post:l,user:s,freeSignup:m,freeSignupEmail:g,isStatic:v,hidden:f,truncated:Z,invisible:w,post_reaction_token:I,onChange:N,showCta:P=Z,showUnsubscribeNotice:E,dataForEmailRender:X={},showReactions:M=!0,gap:A=16,iString:D,iTemplate:R,iPlural:F,language:L,showShare:z}=e;"boolean"!=typeof f&&(f=l.hidden),f?(t=D("Subscribe to view"),i=(0,S.n1t)("/subscribe",{simple:!0,next:document.location.href,utm_source:B.b3.thread,utm_medium:B.lP.web,utm_content:l.id})):(i=(0,S.uRy)(r,l,{noBase:!0}),t="thread"!==l.type||Z?(0,k.getPostCtaText)(l,L):l.comment_count?F("View 1 comment","View %1 comments",l.comment_count):D("Reply"));let O=v&&!this.context.isAmp,U=(0,C.HD)({pub:r}),Y=U?h.j:a.Fragment;return(0,o.tZ)(_.YF,{className:"thread-head typography ".concat(n||""),children:(0,o.tZ)("tr",{children:(0,o.tZ)("td",{children:(0,o.BX)(_.i$,{width:"100%",children:[!w&&!f&&(0,o.tZ)(y.Z,{onVisible:()=>this.onTopReached()}),(0,o.BX)(_.i$,{gap:A,width:"100%",children:[P&&U&&(0,o.tZ)(b,{post:l,ctaUrl:i,ctaText:t,hidden:f}),(0,o.tZ)(c.mV,{pub:r,post:l,user:s,isStatic:v,reaction_token:I,allowEdit:!0,allowTruncate:Z,showReactions:!!P||M,showShare:z,showComments:!!l.comment_count,inThreadHead:!0,onChange:N,showLabel:!0}),(0,o.tZ)(Y,{inThreadHead:!0,children:(0,o.tZ)(p.Z,{user:s,freeSignup:m,freeSignupEmail:g,pub:r,post:l,html:f||Z||!l.body_html?null:l.body_html,isStatic:v,dataForEmailRender:X,children:f?(0,o.tZ)("p",{children:(0,o.tZ)("i",{children:R(T(),(0,x.isFoundingAudience)(l.audience)?"founding":"paid",r.name)})}):Z?(0,o.tZ)("p",{children:l.description}):null})}),P?!U&&(0,o.BX)("a",{className:"thread-head-cta",href:i,native:!0,children:[t," â†’"]}):f&&(0,o.BX)("p",{className:"thread-head-cta",children:[(0,o.tZ)("a",{href:(0,S.W1P)(r,{simple:!0,next:document.location.href,utm_source:B.b3.thread,utm_medium:B.lP.web,utm_content:l.id}),className:"button primary subscribe-btn",native:!v,children:(0,k.getSubscribeText)(r)}),(0,o.tZ)("a",{href:(0,S.uXE)({for_pub:r.subdomain}),className:"button",native:!0,children:D("Sign in")})]})]}),O&&(0,o.BX)(_.i$,{gap:A,style:{width:"100%"},children:[(0,o.tZ)(_.i$,{style:{width:"100%",textAlign:"center"},children:(0,o.tZ)("a",{role:"button",className:"button primary",style:{margin:"0 auto"},href:d.W.HALF_MAGIC_COMMENTS_URL,children:D("See the discussion")})}),(0,o.tZ)(u.yT,{isFooter:!0,customization:{showShare:!0,showComments:!0,showReactions:{showReactions:M},showRestack:!1,showLabels:!0,showCommentRestack:!r.hide_post_restacks}})]}),E&&l.unsubscribed&&(0,o.BX)("div",{className:"notifications-alert",children:[D("Email notifications are disabled for this thread.")," ",(0,o.tZ)("a",{href:"javascript:void(0)",onClick:()=>this.enableEmailNotifications(),children:D("Re-enable")})]}),!w&&!f&&(0,o.tZ)(y.Z,{onVisible:()=>this.onBottomReached()})]})})})})}}(0,n._)(I,"contextType",f.E);let N=(0,g.fz)(I)},70522:function(e,t,i){i.d(t,{ZP:()=>y,cy:()=>x,m1:()=>f});var n=i(27412),r=i(16584),o=i(6400),a=i(94184),l=i.n(a),s=i(81094),d=i(70149),c=i(15702),u=i(82621),p=i(86092),h=i(20888),m=i(86603),g=i(32261),v=i(68833),b=i(60308);class y extends o.Component{static getSubject(e){return e?"author_id"in e&&e.author_id?{id:e.author_id,name:e.author_name,photo_url:(0,b.SMH)(e,{preferAuthorPhoto:!0}),publications:e.subdomain?[e]:[]}:"user_id"in e&&e.user_id?{id:e.user_id,name:e.name,photo_url:(0,b.SMH)(e),publications:[]}:{id:"id"in e?e.id:void 0,name:"name"in e?e.name:void 0,photo_url:(0,b.SMH)(e),publications:[]}:{id:null,name:null,photo_url:b.zUJ,publications:[]}}static hasCustomProfilePhoto(e){return!!y.getSubject(e).photo_url}isSelf(){return this.props.user&&this.props.user.id===y.getSubject(this.props.subject).id||!this.props.subject}profileUrl(){return this.props.url?this.props.url:this.props.isAuthor?(0,b.LwU)(y.getSubject(this.props.subject),this.props.pub):(0,b.NNq)(y.getSubject(this.props.subject))}onBeforeProfileClose(e){if(e){if(!this.props.onEdit)return document.location.reload(),!1;this.props.onEdit()}}render(e){let{subject:t,pub:i,user:n,badge:o,freeSignup:a,freeSignupEmail:s,token:d,isStatic:c,size:u,modalProfile:h,isBanned:m,lazy:v,tooltip:b,noLink:_,className:Z}=e;u=u||33;let w=y.getSubject(t);return(0,r.BX)("div",{className:l()("user-head",{banned:m},Z),children:[_?(0,r.tZ)(f,{photo_url:w.photo_url,size:u,isStatic:c,isBanned:m,lazy:v,badge:o,tooltip:b,className:"default-pointer"}):(0,r.tZ)("a",{href:c||!h?this.profileUrl():void 0,onClick:this.onClick,children:(0,r.tZ)(f,{photo_url:w.photo_url,size:u,isStatic:c,isBanned:m,lazy:v,badge:o,tooltip:b})}),this.props.modalProfile&&!c&&"undefined"!=typeof window&&this.state.includeProfile&&(this.isSelf()?(0,r.tZ)(p.EB,{ref:this.assignProfile,user:n,freeSignup:a,freeSignupEmail:s,needsPhoto:!0,token:d,onBeforeClose:e=>this.onBeforeProfileClose(e)}):(0,r.tZ)(g.FI,{ref:this.assignProfile,profileUser:w,pub:i,isBanned:null!=m&&m}))]})}constructor(...e){super(...e),(0,n._)(this,"profileShown",void 0),(0,n._)(this,"profile",void 0),(0,n._)(this,"assignProfile",e=>{this.profile=e}),(0,n._)(this,"onClick",e=>{if(this.props.onClick)this.props.onClick(e);else if(!this.props.modalProfile)return!1;else if(e.preventDefault(),e.stopPropagation(),this.profileShown||(this.profileShown=!0,(0,v.j)(v.FP.USER_HEAD_CLICKED,{is_self:this.isSelf()})),this.state.includeProfile){var t;null===(t=this.profile)||void 0===t||t.open()}else this.setState({includeProfile:!0},()=>{var e;return null===(e=this.profile)||void 0===e?void 0:e.open()})})}}let f=e=>{let{photo_url:t,size:i,isStatic:n,isBanned:o,lazy:a,badge:u,tooltip:p,style:h,children:m,className:g}=e,v=!t&&!!m,b={founding:(0,r.tZ)(c.Z,{height:14,width:14,stroke:"var(--print_on_pop)",strokeWidth:1,title:p}),author:(0,r.tZ)(s.Z,{height:14,width:14,stroke:"var(--print_on_pop)",title:p})}[null!=u?u:"undefined"];return(0,r.BX)("div",{className:l()("profile-img-wrap",g),children:[v?m:a?(0,r.tZ)(Z,{photo_url:t,size:i,isStatic:n,badge:u,style:h}):(0,r.tZ)(w,{photo_url:t,size:i,isStatic:n,badge:u,style:h}),b&&(0,r.tZ)("div",{className:"profile-img-badge",title:null!=p?p:void 0,children:b}),o&&(0,r.tZ)(d.Z,{})]})},_=(e,t)=>(0,b.zF4)(e,2*t,{height:2*t,crop:"fill"}),Z=e=>{let{photo_url:t,size:i,isStatic:n,badge:o,style:a}=e,[l,s]=(0,m.Z)({}),d=!s||s.isIntersecting?t:b.zUJ;return(0,r.tZ)(C,{url:_(d,i),size:i,ref:l,badge:o,isStatic:n,style:a})},w=e=>{let{photo_url:t,size:i,isStatic:n,badge:o,style:a}=e;return(0,r.tZ)(C,{url:_(t,i),size:i,badge:o,isStatic:n,style:a})},C=e=>{let{url:t,size:i,isStatic:n,ref:o,badge:a,className:l}=e;return n?(0,r.tZ)(u.Z,{className:l,src:(0,b.zF4)(t,2*i,{height:2*i,crop:"fill"}),ref:o,height:i,width:i,alt:a||""}):(0,r.tZ)(h.e,{className:l,src:t,imageProps:{height:2*i,crop:"fill"},maxWidth:2*i,ref:o,alt:a||""})},x=e=>{let{imageUrl:t,alt:i,size:n,className:o}=e;return(0,r.tZ)(C,{className:"user-photo ".concat(o||""),url:t,badge:i,size:n})}},58319:function(e,t,i){i.d(t,{Z:()=>d});var n=i(27412),r=i(16584),o=i(6400),a=i(94184),l=i.n(a),s=i(98914);class d extends o.Component{async componentDidMount(){"undefined"!=typeof window&&(this.ref||await new Promise(e=>setTimeout(e,0)),this.checkVisibility(),(this.props.parent||window).addEventListener("scroll",this.checkVisibility))}componentWillUnmount(){"undefined"!=typeof window&&(this.props.parent||window).removeEventListener("scroll",this.checkVisibility)}render(e){let{className:t,children:i}=e;return(0,r.tZ)("div",{ref:this.assignRef,className:l()("visibility-check",t),children:i})}constructor(...e){super(...e),(0,n._)(this,"ref",void 0),(0,n._)(this,"assignRef",e=>{this.ref=e}),(0,n._)(this,"checkVisibility",()=>{if(!this.ref)return;let e=this.ref.getBoundingClientRect(),t=this.props.threshold||0,i=this.props.parent?this.props.parent.clientHeight:Math.max(document.documentElement.clientHeight,window.innerHeight),n=!(e.bottom<0-t||e.top>=i+t);(0,s.nn)(this,async(e,t)=>{if(e.isVisible!==n)this.setState({isVisible:n});else if(!t.noDedupe)return;let i=n?"hadFirstVisible":"hadFirstInvisible",r=!e[i];r&&this.setState({[i]:!0}),(await Promise.all([n&&t.onVisible&&t.onVisible(),n&&t.onFirstVisible&&r&&t.onFirstVisible(),!n&&t.onInvisible&&t.onInvisible(),!n&&t.onFirstInvisible&&r&&t.onFirstInvisible()])).reduce((e,t)=>!0===t||e)&&this.checkVisibility()})})}}},45634:function(e,t,i){i.d(t,{H:()=>a});var n=i(16584),r=i(98661),o=i(58175);let a=e=>{var t;let{children:i,className:a,title:l,subscript:s,subtitle:d,headerCTA:c,bigTitle:u}=e,p=null===(t=document)||void 0===t?void 0:t.getElementById("homepage-nav-header-cta");return(0,n.BX)("div",{className:"signup-box-wrap",children:[c&&p&&"undefined"!=typeof window&&(0,r.createPortal)(c,p),u?(0,n.tZ)(o.xv.H1,{children:l}):(0,n.tZ)(o.xv.H2,{children:l}),d&&(0,n.tZ)("div",{className:"signup-box-subtitle",children:d}),(0,n.tZ)("div",{className:"signup-box ".concat(a||""),children:i}),s&&(0,n.tZ)("div",{className:"signup-box-subscript",children:s})]})}},75778:function(e,t,i){i.d(t,{LC:()=>a}),i(16584);var n=i(6400),r=i(30396);let o=(0,n.createContext)(null);function a(){return(0,r.qp)(o)}o.displayName="CrossPostContext"},14952:function(e,t,i){i.d(t,{G5:()=>s,Ij:()=>d,u0:()=>c}),i(16584);var n,r,o=i(6400),a=i(30396);let l="undefined"!=typeof window&&null!==(r=null===(n=window._preloads)||void 0===n?void 0:n.pub)&&void 0!==r?r:null,s=(0,o.createContext)(l);function d(){return(0,a.qp)(s)}function c(){let e=d();if(!e)throw Error("Expected a pub outside a pub context.");return e}s.displayName="PubContext"},44471:function(e,t,i){i.d(t,{Eh:()=>g,m$:()=>m});var n,r,o=i(7409),a=i(99282),l=i(16584),s=i(6400);i(98661);var d=i(30396),c=i(48980);let u="undefined"!=typeof window&&null!==(r=null===(n=window._preloads)||void 0===n?void 0:n.publicationUserSettings)&&void 0!==r?r:{},p=e=>({getSettingForPubUser:t=>{if(!t||!e)return null;let i=e[t];return void 0===i?null:i}}),h=(0,s.createContext)((0,a._)((0,o._)({},p(u)),{changeUserSetting:()=>Promise.resolve(void 0)}));function m(e){let{preloadPubUserSettings:t={},children:i}=e,[n,r]=(0,d.eJ)(t),s=(0,d.I4)(async(e,t)=>{r(i=>(0,a._)((0,o._)({},i),{[e]:t}));try{await (0,c.rd)("/api/v1/publication_user_settings/user",{method:"PUT",json:{type:e,value:t}})}catch(e){console.error(e)}},[r]),u=(0,d.Ye)(()=>(0,a._)((0,o._)({},p(n)),{changeUserSetting:s}),[n,s]);return(0,l.tZ)(h.Provider,{value:u,children:i})}function g(){return(0,d.qp)(h)}h.displayName="PublicationUserSettingsContext"},45261:function(e,t,i){i.d(t,{Tf:()=>l,ze:()=>s});var n=i(16584),r=i(6400),o=i(30396);let a=(0,r.createContext)({hasThemedBackground:!1});function l(){var e;return!!(null===(e=(0,o.qp)(a))||void 0===e?void 0:e.hasThemedBackground)}function s(e){let{value:t,children:i}=e,r=(0,o.Ye)(()=>t,Object.values(t));return(0,n.tZ)(a.Provider,{value:r,children:i})}a.displayName="ThemeContext"},28771:function(e,t,i){i.d(t,{DQ:()=>v,M$:()=>b,rf:()=>g});var n=i(7409),r=i(99282),o=i(16584),a=i(6400),l=i(30396),s=i(94184),d=i.n(s),c=i(1852),u=i(71068),p=i(70379),h=i(7149);let m={openDrawerId:null,wrapperId:"drawer-portal",preventDrawerChange:!1},g=(0,a.createContext)({initialTab:"settings",isDrawerOpen:()=>!1,openDrawerId:null,setInitialTab:()=>void 0,setIsDrawerOpen:()=>void 0,setPreventChange:()=>void 0});function v(e){let{children:t,drawerIds:i}=e,[a,s]=(0,l.eJ)(m),[v,b]=(0,l.eJ)("settings"),y=(0,c.useMediaQuery)({maxWidth:631}),{popToast:f}=(0,p.pm)(),_=(0,l.I4)(e=>{let{preventChange:t,preventChangeMessage:i}=e;s((0,r._)((0,n._)({},a),{preventDrawerChange:t,preventDrawerChangeMessage:t?i:null}))},[a,s]);return(0,o.tZ)(g.Provider,{value:{initialTab:v,isDrawerOpen:e=>a.openDrawerId===e,openDrawerId:a.openDrawerId,setInitialTab:b,setIsDrawerOpen:e=>{let{isOpen:t,clearPreventChange:i,drawerId:r,variant:l="overlay",onOpenCallback:d}=e;(!a.preventDrawerChange||i)&&(s({openDrawerId:t?r:null,variant:l,wrapperId:null!=r?r:"drawer-portal",preventDrawerChange:!1}),d&&d()),a.preventDrawerChange&&a.preventDrawerChangeMessage&&a.openDrawerId!==r&&f(e=>{var t;return(0,o.tZ)(p.FN,(0,n._)({text:null!==(t=a.preventDrawerChangeMessage)&&void 0!==t?t:""},e))})},setPreventChange:_},children:(0,o.BX)(u.xu,{className:d()(h.Z.parentPush,{[h.Z.isPushDrawerOpen]:!y&&"push"===a.variant&&!!a.openDrawerId}),children:[t,i.length&&[...i,m.wrapperId].map(e=>(0,o.tZ)("div",{className:d()(h.Z.drawerWrapper,{[h.Z.isClosed]:a.openDrawerId!==e}),id:e},e))]})})}function b(){return(0,l.qp)(g)}},62718:function(e,t,i){i.d(t,{b:()=>Q,J:()=>el});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(98661),s=i(30396),d=i(94184),c=i.n(d),u=i(39693),p=i.n(u),h=i(23279),m=i.n(h),g=i(44908),v=i.n(g),b=i(10844),y=i(887),f=i(45609),_=i(96862),Z=i(80569),w=i.n(Z),C=i(16564),x=i(86657),S=i(72508),k=i(95441),B=i(24763),T=i(38242),I=i(57952),N=i(96904),P=i(53030),E=i(68833),X=i(98914),M=i(57649),A=i(1864),D=i(44989);let R=(0,l.forwardRef)((e,t)=>{let{id:i,items:r,getItemHeight:o,renderItem:l,containerHeight:d,containerWidth:c,itemData:u,measurementProps:p,innerElementType:h,onScroll:m}=e,[g,v]=(0,s.eJ)(null),b=(0,s.sO)(null);(0,s.d4)(()=>{if(g||!c||o)return;let e=document.createElement("div");e.classList.add("hidden-sizing-element"),e.style.position="absolute",e.style.top="0",e.style.width="".concat(c,"px"),e.style.pointerEvents="none",e.style.visibility="hidden",v(e),document.body.appendChild(e)},[c,g,b]);let y=(0,s.I4)(e=>g?(g.innerHTML=(0,M.Dq)(l({index:e,data:(0,n._)({},u,p)})),g.clientHeight||0):0,[g,u,p,l]);return g||o?(0,a.tZ)("div",{id:i,children:(0,a.tZ)(A.S_,{ref:t,itemCount:r.length,itemSize:null!=o?o:y,height:d,width:c,innerRef:b,itemData:u,innerElementType:h,outerElementType:F,onScroll:m,children:l})}):(0,a.tZ)(a.HY,{})}),F=(0,l.forwardRef)((e,t)=>{var{style:i}=e,l=(0,o._)(e,["style"]);return(0,a.tZ)("div",(0,r._)((0,n._)({ref:t,style:i},l),{className:D.Z.listOuter}))});var L=i(71068),z=i(15771),O=i(19081),U=i(58175),Y=i(51776),H=i(70379),j=i(87077),J=i(17564),V=i(60308),q=i(84864),W=i(93370),G=i(22233);let K=m()((e,t,i,n)=>{e.current.resetAfterIndex(t,!0),i(n)}),Q=e=>{var t,i,o,l,d,u,h,m,g;let{transcription:y,setCurrentTranscript:f,postId:_,audioUpload:Z,pub:C,onEdit:x,isEditing:S,setIsEditingSpeakerName:k,isEditingSpeakerName:B,edits:X}=e,M=(0,s.sO)(null),[A,D]=(0,s.eJ)(!1),[F,z]=(0,s.eJ)(),[Y,H]=(0,s.eJ)(),[j,J]=(0,s.eJ)({}),[V,q]=(0,s.eJ)(!1),[W,Q]=(0,s.eJ)(),[ee,et]=(0,s.eJ)(),[ea,el]=(0,s.eJ)(),{isPlaying:ed}=(0,P.FI)(M),[ec,eu]=(0,s.eJ)(0),ep=(0,s.sO)(null),eh=(0,s.sO)(null),{setItems:em,searchTerm:eg,focusedItemStart:ev,isSearching:eb}=(0,I.pH)(),ey=(0,s.Ye)(()=>({isEditing:S,rows:F,speakerMap:j,isPlaying:ed,activeRowIndex:ec,onEditText:(e,t)=>{K(eh,t,x,e)},audioPlayerRef:M,setIsEditingSpeakerName:k,postId:_,edits:X,searchTerm:eg,searchFocusedItemStart:ev,isSearching:eb}),[S,F,j,ed,ec,k,_,X,eg,ev,x,eb]);(0,s.d4)(()=>{eh.current&&!Object.keys(X).length&&eh.current.resetAfterIndex(0)},[X]),(0,s.d4)(()=>{ev&&F&&(null==eh?void 0:eh.current)&&eh.current.scrollToItem(F.findIndex(e=>e.start===ev),"start")},[ev,F]),(0,s.d4)(()=>{ed&&ec&&(null==eh?void 0:eh.current)&&eh.current.scrollToItem(ec,"start")},[ec,ed]),(0,s.d4)(()=>{y.cdn_url?(D((null==F?void 0:F.length)===0),w().get(y.cdn_url).then(e=>{if(e.text){let t=JSON.parse(e.text);z(t),em(t);let i=v()(p()(t.map(e=>e.speaker))).sort();i.length&&H(i)}}).finally(()=>D(!1))):z(void 0),y.speaker_map&&Object.values(y.speaker_map).length&&J(y.speaker_map)},[null==F?void 0:F.length,em,y.cdn_url,y.speaker_map]),(0,s.d4)(()=>{let e=()=>{setTimeout(()=>{var e,t,i,n,r;let o=window.getSelection();if(!o||0===o.rangeCount||o.isCollapsed){el(void 0),et(void 0);return}let a=o.getRangeAt(0),l=a.startContainer.parentNode,s=a.endContainer.parentNode,d=null==l?void 0:null===(e=l.dataset)||void 0===e?void 0:e.chunkIndex,c=null==s?void 0:null===(t=s.dataset)||void 0===t?void 0:t.chunkIndex;if(d&&c){let e=parseInt(d),t=parseInt(c);a.startOffset===(null==l?void 0:null===(i=l.textContent)||void 0===i?void 0:i.length)&&(e+=1),0===a.endOffset&&(t-=1),null==M||null===(r=M.current)||void 0===r||null===(n=r.player)||void 0===n||n.pause(),el(o),et([e,t])}else el(void 0),et(void 0)},0)};return document.addEventListener("mouseup",e),()=>{document.removeEventListener("mouseup",e)}},[M]),(0,s.d4)(()=>{var e,t,i,n,r,o;if(!(null===(t=M.current)||void 0===t?void 0:null===(e=t.player)||void 0===e?void 0:e.textTracks.length)&&F&&(null==y?void 0:y.signed_captions.length)){let e;null==y||null===(i=y.signed_captions)||void 0===i||i.map(e=>{var t,i;null===(i=M.current)||void 0===i||null===(t=i.player)||void 0===t||t.addTextTrack("captions",e.language,e.language)});let t=null===(r=M.current)||void 0===r?void 0:null===(n=r.player)||void 0===n?void 0:n.textTracks;if(!(null==t?void 0:t.length))return;let a=y.signed_captions.find(e=>e.original);for(let i=0;i<t.length;i++){let n=t[i];n&&n.language===(null==a?void 0:a.language)&&(e=n)}e&&((null==e?void 0:null===(o=e.cues)||void 0===o?void 0:o.length)===0&&F.forEach(t=>{null==e||e.addCue(new VTTCue(t.start,t.end,t.text))}),null==e||e.addEventListener("cuechange",e=>{var t,i;let n=null===(i=e.target)||void 0===i?void 0:null===(t=i.activeCues)||void 0===t?void 0:t[0],r=n?null==F?void 0:F.findIndex(e=>e.start===n.startTime&&e.end===n.endTime):null;r&&eu(r)}))}},[F,null==y?void 0:y.signed_captions,null===(i=M.current)||void 0===i?void 0:null===(t=i.player)||void 0===t?void 0:t.textTracks]);let ef=(null==M?void 0:null===(l=M.current)||void 0===l?void 0:null===(o=l.player)||void 0===o?void 0:o.tagName)==="VIDEO"?"videogram":"audiogram";return A?(0,a.tZ)(T.S,{paddingX:16,paddingTop:24,children:(0,a.tZ)(ei,{})}):(null==F?void 0:F.length)?(0,a.BX)(O.tu,{ref:ep,gap:16,border:"detail",radius:"md",flex:"grow",paddingX:16,paddingTop:24,overflow:"hidden",children:[(0,a.BX)(O.tu,{className:G.Z.transcription,justifyContent:"end",children:[!S&&ea&&ee&&(0,a.tZ)(en,{noun:ef,selection:ea,onMakeAudiogram:function(){if(ee){let[e,t]=ee;q(!0),w().post("/api/v1/audiogram").send({post_id:_,start_idx:e,end_idx:t,use_draft:!0}).then(e=>{var t,i;(null===(t=e.body)||void 0===t?void 0:t.data)&&(Q(e.body.data),el(void 0),et(void 0),(null==M?void 0:null===(i=M.current)||void 0===i?void 0:i.player)&&M.current.player.pause())}).finally(()=>q(!1))}}}),!B&&F&&(0,a.tZ)(R,{measurementProps:{useEditedText:!0},ref:eh,itemData:ey,items:F,containerHeight:null!==(m=null==ep?void 0:null===(d=ep.current)||void 0===d?void 0:d.clientHeight)&&void 0!==m?m:0,containerWidth:(null==ep?void 0:null===(u=ep.current)||void 0===u?void 0:u.clientWidth)?(null===(h=ep.current)||void 0===h?void 0:h.clientWidth)-24:0,renderItem:$,innerElementType:es}),(0,a.tZ)(N.G,{isOpen:!!(V||W),onClose:()=>Q(void 0),isGenerating:V,finishedGram:W,noun:ef,postId:_,onDownload:function(e){return(0,E.j)(E.FP.AUDIOGRAM_DOWNLOAD_CLICKED,{post_id:_,audiogram_id:null==W?void 0:W.id,media_upload_id:y.media_upload_id}),fetch(e,{method:"GET"}).then(e=>e.blob()).then(e=>{var t;let i=null==W?void 0:null===(t=W.video_url)||void 0===t?void 0:t.split("/").pop(),n=null==i?void 0:i.match(/^([^-]+-[^_]+)_/),r=(null==n?void 0:n[1])||"",o=URL.createObjectURL(e),a=document.createElement("a");a.href=o,a.download="substack-".concat(ef,"-").concat(_,"-").concat(r,".mp4"),document.body.appendChild(a),a.click(),URL.revokeObjectURL(o),a.remove()})}}),Y&&!!Y.length&&!!B&&(0,a.tZ)(er,{speakerMap:j,speakers:Y,onChangeSpeaker:(e,t)=>J(i=>{var o;return(0,r._)((0,n._)({},i),{[t]:null===(o=e.target)||void 0===o?void 0:o.value})}),onSaveSpeakerChanges:()=>j&&Object.keys(j).length>0?w().put("/api/v1/drafts/".concat(_,"/transcript")).send({speaker_map:j}).then(e=>{e.body.data&&(f(e.body.data),k(!1))}):((0,E.j)(E.FP.TRANSCRIPTION_SPEAKER_NAME_UPDATED,{speakerMap:j,post_id:_}),Promise.resolve()),resetSpeakerMap:()=>{var e;J(null!==(e=null==y?void 0:y.speaker_map)&&void 0!==e?e:{})},setIsEditingSpeakerName:k})]}),(0,a.tZ)(L.xu,{width:420,position:"fixed",paddingTop:16,paddingBottom:24,className:c()(G.Z.transcriptionPlayer,{[null!==(g=G.Z.hidePlayer)&&void 0!==g?g:"undefined"]:B}),children:(0,a.tZ)(eo,{audioUpload:Z,ref:M,pub:C})})]}):(0,a.BX)(T.S,{paddingX:16,paddingTop:24,justifyContent:"center",alignItems:"center",children:[(0,a.tZ)(L.xu,{color:"primary",children:(0,a.tZ)(b.Z,{})}),(0,a.BX)(O.tu,{alignItems:"center",children:[(0,a.tZ)(U.xv.B2,{weight:"semibold",translated:!0,color:"primary",children:"Transcription unavailable"}),(0,a.tZ)(U.xv.B3,{translated:!0,color:"primary",children:"There is no dialog for this video"})]})]})},$=e=>{var t,i,r,o;let{style:l,index:s,data:d}=e,{rows:c,isEditing:u,speakerMap:p,isPlaying:h,activeRowIndex:m,onEditText:g,setIsEditingSpeakerName:v,postId:b,audioPlayerRef:y,edits:f,useEditedText:_=!1,searchTerm:Z,searchFocusedItemStart:w,isSearching:C}=d,x=e=>{var t;(null==y?void 0:null===(t=y.current)||void 0===t?void 0:t.player)&&(y.current.player.currentTime=e+1e-4,y.current.player.play())},k=null==c?void 0:c[s],B=(0===s?void 0:null==c?void 0:null===(t=c[s-1])||void 0===t?void 0:t.speaker)!==(null==k?void 0:k.speaker),T=k?"".concat((0,S.ml)(null!==(i=k.speaker)&&void 0!==i?i:"")).concat(p[null!==(r=k.speaker)&&void 0!==r?r:""]?": ".concat(p[null!==(o=k.speaker)&&void 0!==o?o:""]):""):"",I={isPlaying:h,row:k,rowIndex:s,words:null==k?void 0:k.words,showSpeaker:B,speakerName:T,onPause:()=>{var e;(null==y?void 0:null===(e=y.current)||void 0===e?void 0:e.player)&&y.current.player.pause()},onPlay:()=>x(null==k?void 0:k.start),onEdit:g,editable:u,isActiveRow:m===s,postId:b,setIsEditingSpeakerName:v,edits:f,useEditedText:_,searchTerm:Z,searchFocusedItemStart:w,isSearching:C};return(0,a.tZ)("div",{style:l,children:k?(0,a.tZ)(ee,(0,n._)({},I)):(0,a.tZ)(a.HY,{})})},ee=e=>{var t,i,l,d,{isActiveRow:u,postId:p,setIsEditingSpeakerName:h,edits:m,useEditedText:g,searchTerm:v,searchFocusedItemStart:b,isSearching:f}=e,_=(0,o._)(e,["isActiveRow","postId","setIsEditingSpeakerName","edits","useEditedText","searchTerm","searchFocusedItemStart","isSearching"]);let{speakerName:Z,row:w,showSpeaker:C,rowIndex:x,isPlaying:B,onEdit:T,editable:I}=_,N=u&&B,P=!B&&v&&w.text.toLowerCase().includes(v.toLowerCase()),{iString:E}=(0,k.M1)(),X=(0,s.Ye)(()=>{var e;return null!==(e=m[x.toString()])&&void 0!==e?e:w.text},[m,w.text,x]);return(0,a.tZ)(S.sZ,(0,r._)((0,n._)({},_),{isActiveRow:u,postId:p,editable:I,children:(0,a.BX)(L.xu,{className:c()(G.Z.transcriptionChunk,{[null!==(t=G.Z.chunkWithSpeaker)&&void 0!==t?t:"undefined"]:C,[null!==(i=G.Z.editableChunk)&&void 0!==i?i:"undefined"]:I}),paddingTop:0!==x?16*!!C:0,children:[C&&(0,a.tZ)(j.u,{leading:(0,a.tZ)(y.Z,{}),preferPlacement:"top-start",className:G.Z.speaker,text:E("Edit name"),children:(0,a.tZ)(U.xv.Meta,{color:"pub-accent",className:G.Z.speaker,onClick:e=>{e.stopPropagation(),h(!0)},children:Z})}),(0,a.tZ)(L.xu,{className:c()(G.Z.startTime,{[null!==(l=G.Z.activeStartTime)&&void 0!==l?l:"undefined"]:B?N:C}),children:(0,a.tZ)(U.xv.B5,{className:G.Z.text,paddingX:4,radius:"sm",bg:"secondary",weight:"semibold",color:"primary",children:(0,W.DL)(w.start)})}),I?(0,a.tZ)(ea,{rowIndex:x,value:w.text,editedText:X,useEdited:g,onChange:e=>{"string"==typeof e&&(e===w.text?null==T||T({[String(x)]:void 0},x):null==T||T({[String(x)]:e},x))}}):f&&P?(0,a.tZ)(el,{isFocused:w.start===b,searchTerm:v,rowIndex:x,text:w.text}):(0,a.tZ)(U.xv.B3,{padding:2,color:"primary",className:c()(G.Z.text,{[null!==(d=G.Z.nonActiveText)&&void 0!==d?d:"undefined"]:B&&!N}),"data-chunk-index":x,children:X})]})}))},et=e=>{let{paddingTop:t}=e;return(0,a.BX)(a.HY,{children:[(0,a.BX)(O.gq,{justifyContent:"start",paddingTop:t,children:[(0,a.tZ)(J.S,{width:"48px",height:"0px"}),(0,a.tZ)(J.S,{height:"16px",width:"20%"})]}),(0,a.BX)(O.gq,{gap:8,children:[(0,a.tZ)(J.S,{width:"40px",height:"16px"}),(0,a.tZ)(J.S,{height:"16px",width:"80%"})]}),(0,a.BX)(O.gq,{children:[(0,a.tZ)(J.S,{width:"48px",height:"0px"}),(0,a.tZ)(J.S,{height:"16px",width:"60%"})]})]})},ei=()=>(0,a.BX)(O.tu,{gap:8,paddingTop:16,children:[(0,a.tZ)(et,{}),(0,a.tZ)(et,{paddingTop:8}),(0,a.tZ)(et,{paddingTop:8})]}),en=e=>{let{onMakeAudiogram:t,selection:i,noun:r}=e,{popToast:o}=(0,H.pm)(),{iString:l}=(0,k.M1)(),[d,c]=(0,s.eJ)(!1),[u,p]=(0,s.eJ)("");(0,s.d4)(()=>{var e;c(!!i),p(null!==(e=null==i?void 0:i.toString())&&void 0!==e?e:"")},[i]);let h=null==i?void 0:i.getRangeAt(0).getBoundingClientRect();return h?(0,a.tZ)(L.xu,{children:d&&(0,a.BX)(O.gq,{style:{top:(0,q.isTouchDevice)()?Math.max(h.y,0)+h.height+12:Math.max(h.y,0)-52,transform:"translateX(150px)",pointerEvents:"auto"},height:40,alignItems:"center",paddingX:16,radius:"sm",gap:12,className:G.Z.popover,children:[(0,a.tZ)(f.Z,{height:20,onClick:()=>{let e=u.replace(/(\r\n|\r|\n)\d+:\d+(\r\n|\r|\n)/g,"\n");(0,X.vQ)(e),o(e=>(0,a.tZ)(H.FN,(0,n._)({text:l("Copied to clipboard")},e)))}}),(0,a.tZ)(L.xu,{bg:"glass-thick",className:G.Z.divider}),(0,a.BX)(O.gq,{gap:8,onClick:e=>{e.stopPropagation(),t()},children:[(0,a.tZ)(_.Z,{height:20}),(0,a.tZ)(U.xv.B3,{color:"white",children:r})]})]})}):null},er=e=>{let{setIsEditingSpeakerName:t,speakers:i,speakerMap:n,onChangeSpeaker:r,onSaveSpeakerChanges:o,resetSpeakerMap:l}=e,{iString:s}=(0,k.M1)();return(0,a.BX)(O.tu,{flex:"fill",justifyContent:"space-between",gap:24,children:[(0,a.BX)(O.tu,{gap:24,children:[(0,a.BX)(O.tu,{gap:8,children:[(0,a.tZ)(U.xv.H4,{color:"primary",weight:"heavy",translated:!0,children:"Edit name"}),(0,a.tZ)(U.xv.B3,{color:"primary",translated:!0,children:"Assign a name to each of the identified speakers."})]}),(0,a.tZ)(O.tu,{gap:24,children:i.map(e=>(0,a.BX)(O.tu,{gap:8,children:[(0,a.tZ)(U.xv.B4,{weight:"semibold",color:"pub-accent",children:(0,S.ml)(e)}),(0,a.tZ)(Y.oi,{value:(null==n?void 0:n[e])||"",onChange:t=>r(t,e),placeholder:s("Speaker name...")})]}))})]}),(0,a.BX)(O.gq,{alignSelf:"end",gap:8,justifyContent:"end",children:[(0,a.tZ)(z.zx,{priority:"secondary",onClick:()=>{t(!1),l()},children:s("Cancel")}),(0,a.tZ)(z.zx,{priority:"primary",onClick:async()=>{await o(),t(!1)},children:s("Save")})]})]})},eo=(0,l.forwardRef)((e,t)=>{var i;let{pub:o,audioUpload:l,onTimeUpdate:s,captions:d}=e;return l?(0,a.tZ)(x.Z,{ref:t,feature:C.MR.Podcast,pub:o,src:(0,V.rhs)("/api/v1/audio/upload/".concat(null==l?void 0:l.id,"/src")),duration:null==l?void 0:l.duration,onTimeUpdate:s,mediaUpload:l,trackingProps:{surface:"editor",contentType:"post",entityKey:null!==(i=null==l?void 0:l.post_id)&&void 0!==i?i:"unknown",entityType:"post"},render:e=>(0,a.tZ)(B.Z,(0,r._)((0,n._)({},e),{togglePlayback:()=>{var i,n,r;t&&"current"in t&&(null===(i=t.current)||void 0===i?void 0:i.player)&&(null===(n=t.current)||void 0===n?void 0:n.player.paused)?(0,E.j)(E.FP.TRANSCRIPTION_PLAY_BUTTON_CLICKED):t&&"current"in t&&(null===(r=t.current)||void 0===r?void 0:r.player)&&(0,E.j)(E.FP.TRANSCRIPTION_PAUSE_BUTTON_CLICKED),e.togglePlayback()}})),captions:d}):null}),ea=e=>{let{value:t,rowIndex:i,onChange:n,editedText:r,useEdited:o}=e;return(0,a.tZ)(U.xv.B3,{style:{content:t},padding:2,className:c()(G.Z.text),color:"primary","data-chunk-index":i,contentEditable:!0,onInput:e=>{var t;return n(null===(t=e.target)||void 0===t?void 0:t.textContent)},children:o?r:t})},el=e=>{let{searchTerm:t,rowIndex:i,isFocused:n,text:r}=e,o=RegExp("(".concat(t,")"),"gi"),l=r.split(o);return(0,a.tZ)(U.xv.B3,{padding:2,color:"primary","data-chunk-index":i,className:G.Z.text,children:l.map(e=>{var t;return e.match(o)?(0,a.tZ)("span",{className:c()(G.Z.searchResult,{[null!==(t=G.Z.isFocused)&&void 0!==t?t:"undefined"]:n}),children:e}):e})})},es=(0,l.forwardRef)((e,t)=>{var i,l,{style:s}=e,d=(0,o._)(e,["style"]);return(0,a.tZ)("div",(0,n._)({ref:t,style:(0,r._)((0,n._)({},s),{height:"".concat(parseFloat(null!==(l=null===(i=s.height)||void 0===i?void 0:i.toString())&&void 0!==l?l:"0")+140,"px")})},d))})},57952:function(e,t,i){i.d(t,{Rq:()=>L,Xf:()=>D,_F:()=>M,pH:()=>A});var n=i(16584),r=i(6400),o=i(30396),a=i(23279),l=i.n(a),s=i(62686),d=i(71375),c=i(24840),u=i(53716),p=i(85200),h=i(887),m=i(71212),g=i(27194),v=i(84967),b=i(49336),y=i(5772),f=i(95441),_=i(4796),Z=i(68833),w=i(98422),C=i(15771),x=i(61254),S=i(19081),k=i(44424),B=i(58175),T=i(98905),I=i(98012),N=i(61468),P=i(84864),E=i(22233);let X=(0,r.createContext)({isSearching:!1,items:[],setIsSearching:()=>void 0,setItems:()=>void 0,focusedItemStart:null,setFocusedItemStart:()=>void 0,filteredItems:[],searchTerm:null,setSearchTerm:()=>void 0,hasFiltered:!1}),M=e=>{let{children:t}=e,[i,r]=(0,o.eJ)(!1),[a,l]=(0,o.eJ)([]),[s,d]=(0,o.eJ)(null),[c,u]=(0,o.eJ)(null),{filteredItems:p,setQuery:h,hasFiltered:m}=(0,y.R)({items:a,getKeys:e=>[e.text],sortFunc:(e,t)=>e.start-t.start});return(0,o.d4)(()=>{var e,t;d(null!==(t=null===(e=p[0])||void 0===e?void 0:e.start)&&void 0!==t?t:null)},[p]),(0,n.tZ)(X.Provider,{value:{isSearching:i,setIsSearching:r,items:a,setItems:l,focusedItemStart:s,setFocusedItemStart:d,filteredItems:p,hasFiltered:m,searchTerm:c,setSearchTerm:e=>{u(e),h(e)}},children:t})},A=()=>(0,o.qp)(X),D=e=>{let{isEditing:t,setIsEditing:i,setEdits:r,hasEdits:o,handleSubmitEdits:a,handleRegenerateTranscription:l,handleCancelTranscription:c,isTranscribing:u,transcription:p,postId:h,audioUpload:m,onTranscriptionUploadCancelled:g,onTranscriptionUploadError:v,onTranscriptionUploadStarted:b,onTranscriptionUploaded:y,uploadedFile:f,setUploadedFile:_,isEditingSpeakers:w}=e,{isSearching:x}=A();return(0,n.BX)(S.tu,{gap:16,children:[f&&(0,n.BX)(S.gq,{alignItems:"center",justifyContent:"space-between",padding:16,radius:"sm",border:"detail",gap:16,children:[(0,n.BX)(S.gq,{gap:16,alignItems:"center",children:[(0,n.tZ)(S.hs,{alignItems:"center",padding:8,radius:"sm",color:"primary",bg:"secondary",children:(0,n.tZ)(s.Z,{})}),(0,n.BX)(S.tu,{children:[(0,n.tZ)(B.xv.B3,{weight:"semibold",color:"primary",children:f.name}),(0,n.tZ)(B.xv.B4,{children:(0,P.numberToHumanFileSize)(f.size)})]})]}),(0,n.tZ)(C.hU,{onClick:()=>{(0,Z.j)(Z.FP.TRANSCRIPTION_EDIT_CANCELLED_CLICKED,{post_id:h}),_(null),c()},children:(0,n.tZ)(d.Z,{})})]}),t&&(0,n.tZ)(F,{hasEdits:o,setIsEditing:i,setEdits:r,handleSubmitEdits:a}),!t&&!x&&(0,n.tZ)(R,{isEditingSpeakers:w,setIsEditing:i,transcription:p,isTranscribing:u,handleCancelTranscription:c,handleRegenerateTranscription:l,setUploadedFile:_,postId:h,audioUpload:m,onTranscriptionUploadCancelled:g,onTranscriptionUploadError:v,onTranscriptionUploadStarted:b,onTranscriptionUploaded:y}),x&&(0,n.tZ)(L,{postId:h})]})},R=e=>{var t,i,r;let{transcription:o,isTranscribing:a,handleCancelTranscription:l,handleRegenerateTranscription:s,setUploadedFile:d,postId:v,audioUpload:b,onTranscriptionUploadStarted:y,onTranscriptionUploadCancelled:w,onTranscriptionUploadError:B,onTranscriptionUploaded:T,setIsEditing:P,isEditingSpeakers:X}=e,{iString:M}=(0,f.M1)(),D=(null==o?void 0:o.created_at)&&new Date(o.created_at)<(0,I.Z)().subtract(5,"minutes").toDate(),R=(null==o?void 0:o.status)==="failed",F=(null==o?void 0:o.status)==="transcribed",{setIsSearching:L}=A(),z=null===(t=(null!==(i=null==o?void 0:o.signed_captions)&&void 0!==i?i:[]).find(e=>"True"===e.original))||void 0===t?void 0:t.url,O=async e=>{if(e.cdn_unaligned_url&&e.cdn_url)try{var t,i,n,r;let o=await fetch(e.cdn_unaligned_url,{headers:{Accept:"text/plain"}}),a=await o.text(),l=JSON.parse(a),s=null!==(i=l.segments)&&void 0!==i?i:[];Object.keys(null!==(n=l.speaker_map)&&void 0!==n?n:{}).length>0&&(null==s?void 0:null===(t=s[0])||void 0===t?void 0:t.speaker)||(o=await fetch(e.cdn_url,{headers:{Accept:"text/plain"}}),a=await o.text(),s=JSON.parse(a));let d=(0,N.Vu)(s,null!==(r=e.speaker_map)&&void 0!==r?r:{}),c=new Blob([d],{type:"text/plain"}),u=URL.createObjectURL(c),p=document.createElement("a");p.href=u,p.download="transcript_".concat(new Date().toISOString(),".txt"),document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(u)}catch(e){console.error("Failed to fetch and download transcript:",e)}};return(0,n.BX)(S.gq,{justifyContent:"space-between",gap:8,children:[(0,n.tZ)(C.hU,{onClick:()=>{(0,Z.j)(Z.FP.TRANSCRIPTION_SEARCH_CLICKED,{post_id:v}),L(!0)},disabled:X,children:(0,n.tZ)(c.Z,{})}),(0,n.BX)(S.gq,{gap:8,children:[(0,n.tZ)(C.zx,{onClick:s,disabled:!(F&&!D||!a||R)||X,leading:(0,n.tZ)(u.Z,{}),priority:"secondary",children:M("Regenerate")}),(0,n.tZ)(_.z,{setUploadedFile:d,postId:v,mediaUpload:b,transcription:null!=o?o:null,onTranscriptionUploadStarted:y,onTranscriptionUploadCancelled:w,onTranscriptionUploadError:B,onTranscriptionUploaded:T,disabled:!v||!b||(null==b?void 0:b.state)!=="transcoded"||X}),(0,n.BX)(k.v2,{trigger:(0,n.tZ)(C.hU,{priority:"secondary",rounded:!1,children:(0,n.tZ)(p.Z,{className:E.Z.icon})}),children:[(null==o?void 0:o.status)==="transcribed"&&(0,n.BX)(n.HY,{children:[(0,n.tZ)(k.sN,{disabled:X,onClick:()=>{(0,Z.j)(Z.FP.TRANSCRIPTION_EDIT_CLICKED,{post_id:v}),P(!0)},leading:(0,n.tZ)(h.Z,{}),children:M("Correct transcript")}),(0,n.tZ)(x.iz,{}),(0,n.BX)(k.LY,{leading:(0,n.tZ)(m.Z,{}),content:M("Download"),children:[(0,n.tZ)(k.sN,{disabled:X,onClick:()=>{(0,Z.j)(Z.FP.TRANSCRIPTION_DOWNLOAD_CLICKED,{post_id:v,type:"txt"}),O(o)},children:M("Download .txt file")}),(0,n.tZ)(k.sN,{disabled:X,href:null!==(r=o.cdn_url)&&void 0!==r?r:void 0,onClick:()=>{(0,Z.j)(Z.FP.TRANSCRIPTION_DOWNLOAD_CLICKED,{post_id:v,type:"json"})},children:M("Download .json file")}),z&&(0,n.tZ)(k.sN,{disabled:X,href:z,onClick:()=>{(0,Z.j)(Z.FP.TRANSCRIPTION_DOWNLOAD_CLICKED,{post_id:v,type:"vtt"})},children:M("Download .vtt file")})]}),(0,n.tZ)(x.iz,{})]}),(0,n.tZ)(k.sN,{disabled:!o||X,priority:"destructive",leading:(0,n.tZ)(g.Z,{}),onClick:l,children:M("Remove")})]})]})]})},F=e=>{let{setIsEditing:t,setEdits:i,hasEdits:r,handleSubmitEdits:o}=e,{iString:a}=(0,f.M1)();return(0,n.BX)(S.gq,{justifyContent:"end",gap:8,children:[(0,n.tZ)(C.zx,{onClick:()=>{t(!1),i({})},priority:"secondary",children:a("Cancel")}),(0,n.tZ)(C.zx,{priority:"primary",disabled:!r,onClick:o,children:a("Save")})]})},L=e=>{let{postId:t,closeAlwaysVisible:i=!0}=e,{iString:r}=(0,f.M1)(),{isMobile:a}=(0,w.v9)(),s=(0,o.sO)(null),{setSearchTerm:u,setIsSearching:p,hasFiltered:h,filteredItems:m,setFocusedItemStart:g,focusedItemStart:y,searchTerm:_}=A();(0,o.d4)(()=>{!_&&s.current&&(s.current.value="")},[_]);let x=m.findIndex(e=>e.start===y),k=()=>{let e=x+1>=m.length?0:x+1;g(m[e].start)},I=()=>{u(""),p(!1),(0,Z.j)(Z.FP.TRANSCRIPTION_SEARCH_CANCELLED,{post_id:t})};return(0,n.BX)(S.gq,{gap:8,justifyContent:"space-between",alignItems:"center",className:E.Z.searchForm,children:[(0,n.tZ)(T.K,{ref:s,leftIcon:(0,n.tZ)(S.gq,{children:(0,n.tZ)(c.Z,{size:16})}),rightIcon:(0,n.tZ)(S.gq,{cursor:"pointer",onClick:I,children:_||i?(0,n.tZ)(d.Z,{size:16}):null}),placeholder:r("Search"),onChange:l()(e=>{u(e.target.value),(0,Z.j)(Z.FP.TRANSCRIPTION_SEARCHED,{post_id:t})},100),onKeyDown:e=>{"Enter"===e.key&&k(),"Escape"===e.key&&I()}}),h&&(0,n.tZ)(S.gq,{gap:8,paddingRight:8*!!a,children:(0,n.BX)(S.gq,{alignItems:"center",gap:8,children:[(0,n.tZ)(B.xv.B4,{paddingLeft:a?4:16,className:E.Z.resultsValue,color:"primary",weight:"semibold",children:"".concat(x+1," / ").concat(m.length)}),(0,n.BX)(S.gq,{children:[(0,n.tZ)(C.hU,{priority:"tertiary",size:"sm",onClick:()=>{let e=x-1<0?m.length-1:x-1;g(m[e].start)},children:(0,n.tZ)(v.Z,{size:20})}),(0,n.tZ)(C.hU,{priority:"tertiary",size:"sm",onClick:k,children:(0,n.tZ)(b.Z,{size:20})})]})]})})]})}},38242:function(e,t,i){i.d(t,{S:()=>s});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(19081);let s=e=>{var{children:t}=e,i=(0,o._)(e,["children"]);return(0,a.tZ)(l.tu,(0,r._)((0,n._)({gap:16,border:"detail",radius:"md",flex:"grow",overflowY:"auto",overflowX:"hidden"},i),{children:t}))}},96904:function(e,t,i){i.d(t,{G:()=>m});var n=i(58865),r=i(16584),o=i(71212),a=i(33804),l=i(95441),s=i(68833),d=i(15771),c=i(6490),u=i(98248);function p(){let e=(0,n._)(["Generating ","..."]);return p=function(){return e},e}function h(){let e=(0,n._)(["Shareable ",""]);return h=function(){return e},e}function m(e){let{isOpen:t,onClose:i,isGenerating:n,finishedGram:m,noun:g,postId:v,onDownload:b}=e,{iString:y,iTemplate:f}=(0,l.M1)();return(0,r.tZ)(c.u_,{isOpen:t,onClose:i,children:(0,r.BX)(a.w,{children:[(0,r.tZ)(c.xB,{title:f(n?p():h(),g),showClose:!0,showDivider:!0,onClose:i}),(0,r.tZ)(c.fe,{children:m?(0,r.tZ)("video",{src:m.cdn_url,style:{borderRadius:12},controls:!0,download:!0,width:400}):(0,r.tZ)(u.$j,{alignItems:"center",justifyContent:"center",minHeight:220})}),m&&(0,r.tZ)(c.mz,{direction:"column",primaryButton:(0,r.tZ)(d.zx,{priority:"primary",leading:(0,r.tZ)(o.Z,{size:20}),onClick:()=>{(0,s.j)(s.FP.AUDIOGRAM_DOWNLOAD_CLICKED,{post_id:v,audiogram_id:null==m?void 0:m.id,media_upload_id:null==m?void 0:m.media_upload_id}),b(m.cdn_url)},children:y("Download")})})]})})}},4796:function(e,t,i){i.d(t,{z:()=>f});var n=i(16584),r=i(30396),o=i(32224),a=i(98661),l=i(80569),s=i.n(l),d=i(95441),c=i(6400);let u=(e,t)=>{let i=new FileReader;i.onload=e=>{var i;t(null===(i=e.target)||void 0===i?void 0:i.result)},i.readAsText(e)};var p=i(68833),h=i(15771),m=i(61254),g=i(19081),v=i(44424),b=i(61468);let y=[".txt",".srt",".vtt"],f=e=>{let{postId:t,mediaUpload:i,transcription:l,onTranscriptionUploadStarted:f,onTranscriptionUploadCancelled:_,onTranscriptionUploadError:Z,onTranscriptionUploaded:w,disabled:C,setUploadedFile:x}=e,{iString:S}=(0,d.M1)(),[k,B]=(0,r.eJ)(!1),[T,I]=(0,r.eJ)(""),N=l&&"in_progress"===l.status,[P,E]=(0,r.eJ)(null),X=async e=>{if(E(e),null==f||f(),e.length>0&&e[0]){var n;x&&x(e[0]);let r=null!==(n=e[0].name.split(".").pop())&&void 0!==n?n:"";(0,p.j)(p.FP.TRANSCRIPTION_UPLOAD_FILE_STARTED,{post_id:t,audio_upload_id:null==i?void 0:i.id,type:r}),u(e[0],async t=>{I(t);let n=null,o={};try{if("txt"===r){var a;[n,o]=(0,b.kF)(t,null!==(a=null==i?void 0:i.duration)&&void 0!==a?a:0)}else"vtt"===r?[n,o]=(0,b.$h)(t):"srt"===r&&([n,o]=(0,b.$h)(t));let l=(0,b.ob)(n);if(n&&!l)await M(e[0],r,n,o);else{let e=S("Error validating transcription file"),t="".concat(e,": ").concat(l);console.error(t),null==Z||Z(t)}}catch(t){let e=S("Error parsing transcription file");console.error(e,t),null==Z||Z(e),x&&x(null)}finally{F()}})}},M=async(e,n,r,o)=>{let{body:a}=await s().post("/api/v1/drafts/".concat(t,"/upload_transcription/start")).send({speaker_map:o}),{originalTranscriptionFileKey:l,unalignedTranscriptionFileKey:d,alignedTranscriptionFileKey:c}=a;B(!0);try{var u;await s().put(l).send(e).set("Content-Type",e.type),await s().put(d).send(JSON.stringify(r)).set("Content-Type","application/json"),await s().put(c).send(JSON.stringify(null!==(u=null==r?void 0:r.segments)&&void 0!==u?u:[])).set("Content-Type","application/json"),await s().post("/api/v1/drafts/".concat(t,"/upload_transcription/complete")).send(),await s().post("/api/v1/drafts/".concat(t,"/realign_transcription")).send({edits:{}}).then(e=>{var r;(null===(r=e.body)||void 0===r?void 0:r.data)&&((0,p.j)(p.FP.TRANSCRIPTION_UPLOAD_FILE_COMPLETED,{post_id:t,audio_upload_id:null==i?void 0:i.id,type:n}),B(!1),w(e.body.data),F())})}catch(e){(0,p.j)(p.FP.TRANSCRIPTION_UPLOAD_FILE_FAILED,{post_id:t,audio_upload_id:null==i?void 0:i.id,type:n}),console.error("File upload failed:",e),null==Z||Z(S("Error uploading transcription file"))}};(0,a.useEffect)(()=>{},[T]);let{openFileDialog:A,fileInputRef:D}=function(e){let{onFilesSelected:t}=e,i=(0,c.createRef)(),n=e=>{let i=e.target;i.files&&i.files.length>0&&t(i.files)};return(0,a.useEffect)(()=>{let e=i.current;if(e)return e.addEventListener("change",n),()=>{e.removeEventListener("change",n)}},[i]),{openFileDialog:()=>{var e;null===(e=i.current)||void 0===e||e.click()},fileInputRef:i}}({onFilesSelected:X}),{dropRef:R}=function(e){let{onFilesSelected:t}=e,[i,n]=(0,a.useState)(!1),r=(0,a.useRef)(null),o=e=>{e.preventDefault(),e.stopPropagation()},l=e=>{e.preventDefault(),e.stopPropagation(),n(!1)},s=e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&e.dataTransfer.items&&e.dataTransfer.items.length>0&&n(!0)},d=e=>{e.preventDefault(),e.stopPropagation(),n(!1),e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0&&(t(e.dataTransfer.files),e.dataTransfer.clearData())};return(0,a.useEffect)(()=>{let e=r.current;if(e)return e.addEventListener("dragenter",o),e.addEventListener("dragleave",l),e.addEventListener("dragover",s),e.addEventListener("drop",d),()=>{e.removeEventListener("dragenter",o),e.removeEventListener("dragleave",l),e.removeEventListener("dragover",s),e.removeEventListener("drop",d)}},[r]),{dropRef:r,dragging:i}}({onFilesSelected:X}),F=()=>{E(null),D.current&&(D.current.value=""),null==_||_()},L=null==P?void 0:P[0],z=e=>{(0,p.j)(p.FP.TRANSCRIPTION_UPLOAD_FILE_TYPE_CLICKED,{post_id:t,audio_upload_id:null==i?void 0:i.id,type:e}),D.current&&(D.current.accept=e,setTimeout(()=>A(),50))};return N?null:(0,n.BX)(g.tu,{gap:8,children:[!k&&(0,n.BX)(v.v2,{ref:R,layerOptions:{placement:"bottom-center"},onOpen:()=>{(0,p.j)(p.FP.TRANSCRIPTION_UPLOAD_FILE_CLICKED,{post_id:t,audio_upload_id:null==i?void 0:i.id})},trigger:(0,n.tZ)(h.zx,{disabled:C,priority:"secondary",leading:(0,n.tZ)(o.Z,{size:18}),children:S("Upload transcript")}),children:[(0,n.tZ)(v.sN,{onClick:()=>z(".txt"),children:S("Upload .txt file")}),(0,n.tZ)(m.iz,{}),(0,n.tZ)(v.sN,{onClick:()=>z(".vtt"),children:S("Upload .vtt file")}),(0,n.tZ)(m.iz,{}),(0,n.tZ)(v.sN,{onClick:()=>z(".srt"),children:S("Upload .srt file")})]}),L&&(0,n.tZ)(g.tu,{gap:8}),(0,n.tZ)("input",{type:"file",ref:D,style:{display:"none"},accept:y.join(",")})]})}},20898:function(e,t,i){i.d(t,{F5:()=>Z,ZP:()=>w,xK:()=>_});var n=i(7409),r=i(99282),o=i(16584),a=i(30396),l=i(94184),s=i.n(l),d=i(28549),c=i(25380),u=i(55519),p=i(86374),h=i(95441),m=i(15771),g=i(96745),v=i(19081),b=i(44424),y=i(98012),f=i(60308);let _=e=>{let{pub:t,sectionId:i,onChange:n}=e,{iString:r}=(0,h.M1)(),l=(0,a.Ye)(()=>t.sections.filter(e=>e.is_live),[t.sections]),s=[];s.push({value:null,label:t.name,description:null,iconUrl:t.logo_url,isPodcast:t.podcast_enabled}),l.length>0&&s.push(...l.map(e=>({value:e.id,label:e.name,description:e.description,iconUrl:e.logo_url,isPodcast:e.is_podcast})));let u=s.find(e=>e.value===i),g=u&&-1!==u.value;return(0,o.tZ)(b.v2,{trigger:(0,o.tZ)(m.zx,{size:"sm",priority:"secondary",trailing:(0,o.tZ)(p.Z,{}),leading:g&&u.iconUrl?(0,o.tZ)("img",{style:{width:20,height:20,borderRadius:4},src:(0,f.zF4)(u.iconUrl,32)}):void 0,children:g?r(u.label):r("Choose a section")}),className:"sectionMenu-ovz2Yk",layerOptions:{placement:"bottom-start"},children:s.map((e,t)=>{let{value:a,label:l,iconUrl:s}=e;return(0,o.tZ)(b.sN,{leading:s?(0,o.tZ)(v.M5,{children:(0,o.tZ)("img",{style:{width:20,height:20,borderRadius:4},src:(0,f.zF4)(s,48)})}):(0,o.tZ)(d.Z,{}),trailing:a===i?(0,o.tZ)(c.Z,{}):void 0,onClick:()=>n(a?Number(a):null),children:r(l)},t)})})},Z=e=>{let{className:t,sections:i,onChange:a,primarySection:l,minimumDate:d,scheduledRepublishes:c=[]}=e,{iString:p}=(0,h.M1)(),b={container:e=>(0,r._)((0,n._)({},e),{display:"block",cursor:"pointer"}),menu:e=>(0,r._)((0,n._)({},e),{zIndex:100}),option:e=>(0,r._)((0,n._)({},e),{cursor:"pointer"}),indicatorSeparator:e=>(0,r._)((0,n._)({},e),{display:"none"}),control:e=>(0,r._)((0,n._)({},e),{cursor:"pointer",borderColor:"var(--border_subtle)"}),singleValue:e=>(0,r._)((0,n._)({},e),{color:"inherit"}),dropdownIndicator:e=>(0,r._)((0,n._)({},e),{color:"inherit !important"})},f=[{value:-1,label:p("Choose a section...")},...i.filter(e=>e.id!==l).map(e=>({value:e.id,label:e.name,hasPodcast:e.is_podcast}))],_=c.map(e=>e.section_id);return(0,o.BX)(v.tu,{gap:12,children:[c.map((e,i)=>{let n=f.find(t=>t.value===e.section_id),r=f.filter(t=>t.value===e.section_id||!_.includes(t.value));return(0,o.BX)(v.tu,{border:"detail",gap:4,padding:8,children:[(0,o.tZ)(u.ZP,{className:s()("post-section-selector",t),styles:b,name:"section",value:n,options:r,onChange:t=>{let{value:i}=t;e.section_id=i,a(c)},menuPlacement:"top"}),(0,o.tZ)(g.Tz,{value:e.date,min:(0,y.Z)(d).add(i,"hours").toDate(),max:new Date(Date.now()+79488e5),onChange:t=>{let{value:i}=t.currentTarget;e.date=new Date(i),a(c)}}),(0,o.tZ)(v.gq,{justifyContent:"end",children:(0,o.tZ)(m.zx,{onClick:()=>{a(c.filter(t=>t.section_id!==e.section_id))},priority:"tertiary",size:"xs",children:"Delete"})})]})}),c.length<2&&(0,o.tZ)(m.zx,{onClick:()=>{a(c.concat([{section_id:-1,date:(0,y.Z)(d).add(1,"hours").toDate()}]))},priority:"secondary",size:"xs",children:"Add Republish"})]})},w=e=>{let{className:t,pubName:i,pubHasPodcast:l,sections:d,onChange:c,showRoot:p,currentValue:m,wysiwyg:g}=e,{iString:v}=(0,h.M1)(),b=(0,a.Ye)(()=>d.filter(e=>e.is_live),[d]),y=(0,a.Ye)(()=>{let e=[{value:-1,label:v("Choose a section...")},...b.map(e=>({value:e.id,label:e.name,hasPodcast:e.is_podcast}))];return p&&(e=[e[0],{value:null,label:i,hasPodcast:l},...e.slice(1)]),e},[b,i,p]);if((0,a.d4)(()=>{2===y.length&&m!==(y[1].value&&Number(y[1].value))&&c(y[1].value&&Number(y[1].value))},[m,y,c]),2===y.length)return(0,o.tZ)("h5",{className:"post-section-selector",children:y[1].label});let f=y.find(e=>e.value===m);return(0,o.tZ)(u.ZP,{className:s()("post-section-selector",t),styles:{container:e=>(0,r._)((0,n._)({},e),{display:"block",cursor:"pointer"}),menu:e=>(0,r._)((0,n._)({},e),{zIndex:100}),option:e=>(0,r._)((0,n._)({},e),{cursor:"pointer"}),indicatorSeparator:e=>(0,r._)((0,n._)({},e),{display:"none"}),control:e=>(0,n._)((0,r._)((0,n._)({},e),{cursor:"pointer",borderColor:"var(--border_subtle)"}),g&&{backgroundColor:"var(--web_bg_color, white)"}),singleValue:e=>(0,r._)((0,n._)({},e),{color:"inherit"}),dropdownIndicator:e=>(0,r._)((0,n._)({},e),{color:"inherit !important"})},name:"section",value:f,options:y,onChange:e=>{let{value:t}=e;return c(t?Number(t):null)}})}},67348:function(e,t,i){i.d(t,{p:()=>u});var n=i(16584),r=i(94184),o=i.n(r),a=i(85685),l=i(60807),s=i(33017),d=i(36186),c=i(22402);function u(e){let{id:t,label:i,type:r,url:o,unstyled:a}=e;return(0,n.tZ)("span",{className:"node-substack_mention",children:"pub"===r?(0,n.tZ)(h,{id:t,url:o,label:i,unstyled:a}):(0,n.tZ)(p,{id:t,label:i,unstyled:a})})}function p(e){let{id:t,label:i,unstyled:r}=e,s=(0,l.aF)(),u=s&&s.id===t;return(0,n.tZ)(a.ProfileHoverCard,{inline:!0,subject:{id:t,name:i},children:(0,n.tZ)("a",{className:o()(c.Z.mention,u&&c.Z.self,r&&c.Z.unstyled),href:(0,d.GR)(t,i),children:i})})}function h(e){let{id:t,url:i,label:r,unstyled:a}=e,d=(0,l.aF)(),u=d&&d.id===t;return(0,n.tZ)(s.Sm,{publication_id:t,inline:!0,children:(0,n.tZ)("a",{className:o()(c.Z.mention,u&&c.Z.self,a&&c.Z.unstyled),href:i,children:r})})}},16451:function(e,t,i){i.d(t,{Ku:()=>h,Zb:()=>m,sP:()=>g});var n=i(16584),r=i(94184),o=i.n(r);i(85685),i(80143);var a=i(94874);i(19081);var l=i(63474),s=i(58175);i(2009),i(50312);var d=i(98012);i(63651);var c=i(5749);o()((0,l.oB)({gap:12}),l.sg.styles);let u=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"}),p=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric"});function h(e){let t,{timestamp:i}=e,r=(0,d.Z)(),o=(0,d.Z)(i),a=r.diff(o,"day");return t=r.diff(o,"year")>=1?p.format(o.toDate()):a>7?u.format(o.toDate()):o.fromNowShort(),(0,n.tZ)(s.xv.B4,{as:"span",color:"secondary",children:i&&t})}function m(e){let{user:t,className:i,size:r=36}=e;return(0,n.tZ)(a.qE,{size:r,user:t,className:i})}function g(e){let{children:t}=e;return(0,n.tZ)(s.xv.B3,{className:c.Z.feedCommentBodyInner,color:"primary",children:t})}},68733:function(e,t,i){i.d(t,{Fm:()=>a,N1:()=>r,uk:()=>l,zN:()=>o});var n=i(30396);function r(e){let{fileType:t}=e;return t.startsWith("image/")}function o(e){let{fileType:t}=e;return t.startsWith("video/")}function a(e){let{onAddFiles:t,acceptFile:i}=e,r=(0,n.sO)(),o=(0,n.sO)(),[a,l]=(0,n.eJ)(!1),s=e=>Array.from(e.items).filter(e=>"file"===e.kind&&i({fileType:e.type})),d=e=>s(e).length>0,c=e=>{let{current:t}=o;t&&t===e.target&&(o.current=void 0,l(!1))};return{isDragging:a,props:{onDragEnter:e=>{let{current:t}=r,{target:i}=e;t&&i&&i instanceof HTMLElement&&(t===i||t.contains(i))&&e.dataTransfer&&(d(e.dataTransfer)||0===e.dataTransfer.items.length)&&(e.preventDefault(),o.current=i,l(!0))},onDragOver:e=>{o.current&&e.preventDefault()},onDragLeave:c,onDragEnd:c,onDrop:e=>{e instanceof DragEvent&&!e.defaultPrevented&&e.dataTransfer&&d(e.dataTransfer)&&0!==s(e.dataTransfer).length&&(e.preventDefault(),t(Array.from(e.dataTransfer.files)),l(!1),o.current=void 0)},ref:r}}}function l(e){let t=a(e),i=(0,n.sO)(!1);return(0,n.d4)(()=>{let{props:{onDragEnter:e,onDragOver:n,onDragLeave:r,onDragEnd:o,onDrop:a}}=t,l=document.body;t.props.ref.current=l;let s={dragenter:t=>{i.current||(i.current=!0,e(t))},dragover:n,dragleave:e=>{i.current&&(e.clientX<=0||e.clientX>=window.innerWidth||e.clientY<=0||e.clientY>=window.innerHeight)&&(i.current=!1,r(e))},dragend:e=>{i.current&&(i.current=!1,o(e))},drop:e=>{i.current&&(i.current=!1,a(e))}};for(let[e,t]of Object.entries(s))l.addEventListener(e,t);return()=>{for(let[e,t]of Object.entries(s))l.removeEventListener(e,t)}},[]),t}},68833:function(e,t,i){i.d(t,{A:()=>o.A,FP:()=>o.FP,IU:()=>n.IU,K8:()=>o.K8,NA:()=>r.NA,XY:()=>r.XY,j:()=>o.j,jA:()=>o.jA,jJ:()=>o.jJ,uF:()=>a.S,x6:()=>o.x6,xG:()=>o.xG});var n=i(47102),r=i(55229),o=i(8090),a=i(53516)},62981:function(e,t,i){i.d(t,{Z:()=>s,f:()=>d});var n=i(30396),r=i(68833),o=i(59176),a=i(98012);let l=()=>{};function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,[s,c]=(0,n.eJ)(!!e&&d(e,t,a));return((0,n.d4)(()=>{let t=()=>{c(!0)};if(e){document.addEventListener("dismiss: ".concat(e),t,!1);let i=(0,o.mM)("".concat(e,"-seen-count"))||0;(!a||i<a)&&(0,o.ex)("".concat(e,"-seen-count"),i+1)}return()=>{document.removeEventListener("dismiss: ".concat(e),t)}},[e]),e)?[s,()=>{i(),(0,r.j)(r.FP.DASHBOARD_ACTION_BOX_DISMISSED,{key:e});let t=new Date;(0,o.ex)(e,t.toString()),c(!0);let n=new Event("dismiss: ".concat(e));document.dispatchEvent(n)}]:[!0,l]}function d(e,t,i){let n;let r="undefined"==typeof window?new Date().toString():(0,o.mM)(e),l="undefined"==typeof window?0:(0,o.mM)("".concat(e,"-seen-count")),s=r||i&&l>=i;return s&&t?(0,a.Z)(r).add(t,"second").isAfterNow():!!(r||s)}},90406:function(e,t,i){i.d(t,{Aw:()=>u,B_:()=>s,E5:()=>c,Hu:()=>n,Zr:()=>a,di:()=>r,g:()=>l,h1:()=>d,sj:()=>o,yK:()=>p});let n="#ff6719",r="#00a363",o="#7b61ff",a="#eb5757",l="#18a0fb",s="#d8a600",d="#363737",c="#fafafa",u="#777777",p=48},12799:function(e,t,i){i.d(t,{g:()=>d});var n=i(7409),r=i(99282),o=i(16584),a=i(99869),l=i(98914),s=i(70379);function d(){let e=(0,s.pm)();return function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"link";(0,l.vQ)(t),e.popToast(e=>(0,o.tZ)(s.FN,(0,r._)((0,n._)({},e),{text:"Copied ".concat(i," to clipboard"),Icon:a.Z})))}}},55480:function(e,t,i){i.d(t,{EP:()=>b,Tn:()=>v,XH:()=>f,aF:()=>y,aL:()=>h,d_:()=>p,fP:()=>g,jU:()=>m,pp:()=>_});var n=i(7409),r=i(99282),o=i(39693),a=i.n(o);i(94654);var l=i(48980);i(98012),i(24791);var s=i(60308),d=i(63651),c=i(84864);let u=e=>{if(!e)return[];let t=[];for(let i of e){if(2===t.length)break;let e=i.toLowerCase();for(let[i,n]of Object.entries(c.PODCAST_CATEGORIES)){if(2===t.length)break;if(i.toLowerCase()===e||i.toLowerCase().split(" & ").includes(e)){t.push({category:i});break}for(let r of n){if(2===t.length)break;if(r.toLowerCase()===e||r.toLowerCase().split(" & ").includes(e)){t.push({category:i,subcategory:r});break}}}}return t},p=e=>{var t,i,o,a,l,c,u,p,h,m;let{fallbackToLogosInsteadOfGenericArt:g,pub:v,section:b}=e,y=null==b?void 0:b.podcastSettings,f=null!==(i=null!==(t=null==y?void 0:y.podcast_title)&&void 0!==t?t:null==b?void 0:b.name)&&void 0!==i?i:null,_=null!==(a=null!==(o=null==y?void 0:y.podcast_description)&&void 0!==o?o:null==b?void 0:b.description)&&void 0!==a?a:null,Z=null!==(l=null==y?void 0:y.itunes_podcast_primary_category)&&void 0!==l?l:null,w=null!==(c=null==y?void 0:y.itunes_podcast_primary_subcategory)&&void 0!==c?c:null,C=null!==(u=null==y?void 0:y.itunes_podcast_secondary_category)&&void 0!==u?u:null,x=null!==(p=null==y?void 0:y.itunes_podcast_secondary_subcategory)&&void 0!==p?p:null,S=(null==y?void 0:y.itunes_explicit)||!1,k=(null==y?void 0:y.podcast_art_url)||(0,s.AmV)(),B=!(null==y?void 0:y.podcast_art_url)||(0,d.lsY)(y.podcast_art_url),T=(null==y?void 0:y.paid_podcast_episode_art_url)||null,I=(null==y?void 0:y.podcast_byline)||v.podcast_byline||v.author_name||"",N=(null==y?void 0:y.language)||v.podcast_language||"",P=!!y&&!!y.podcast_feed_url,E=P?y.podcast_feed_url:(0,s.fw6)({pub:(0,r._)((0,n._)({},v),{section:b})});return{title:f,description:_,primaryCategory:Z,primarySubcategory:w,secondaryCategory:C,secondarySubcategory:x,isExplicit:S,artUrl:B&&g?null!==(m=null!==(h=b.logo_url)&&void 0!==h?h:v.logo_url)&&void 0!==m?m:"":k,byline:I,language:N,isRedirected:P,podcastRssUrl:E,paidEpisodeArtUrl:T}},h=e=>{var t,i;let{pub:n,section:r}=e,o=null!==(t=null==r?void 0:r.name)&&void 0!==t?t:null,a=null!==(i=null==r?void 0:r.description)&&void 0!==i?i:null,l=(0,s.AmV)(),d=n.podcast_byline||n.author_name||"";return{title:o,description:a,primaryCategory:null,primarySubcategory:null,secondaryCategory:null,secondarySubcategory:null,isExplicit:!1,artUrl:l,byline:d,language:n.podcast_language||"",isRedirected:!1,podcastRssUrl:null,paidEpisodeArtUrl:null}},m=e=>{var t,i,r;let{fallbackToLogosInsteadOfGenericArt:o,pub:a}=e,l=a.podcast_title||a.name,c=a.podcast_description||a.hero_text,u=a.itunes_podcast_primary_category,p=a.itunes_podcast_primary_subcategory,h=a.itunes_podcast_secondary_category,m=a.itunes_podcast_secondary_subcategory,g=null!==(t=a.itunes_explicit)&&void 0!==t&&t,v=a.podcast_art_url||(0,s.AmV)(),b=!a.podcast_art_url||(0,d.lsY)(a.podcast_art_url),y=a.podcast_byline||a.author_name,f=a.podcast_language||"",_=!!a.show_pub_podcast_tab,Z=!!a.podcast_feed_url,w=(0,n._)({},a);delete w.section;let C=Z?a.podcast_feed_url:(0,s.fw6)({pub:w});return{title:l,description:c,primaryCategory:u,primarySubcategory:p,secondaryCategory:h,secondarySubcategory:m,isExplicit:g,artUrl:b&&o?null!==(i=a.logo_url)&&void 0!==i?i:"":v,byline:y,language:f,isRedirected:Z,podcastRssUrl:C,showPodcastTab:_,paidEpisodeArtUrl:null!==(r=a.paid_podcast_episode_art_url)&&void 0!==r?r:null}},g=e=>{var t,i,n;let{pub:r,publication:o}=e,[a,l]=u(o.tags.map(e=>{let{canonical_name:t}=e;return t})),d="".concat(r.name," Podcast"),c=r.hero_text,p=null==a?void 0:a.category,h=null!==(t=null==a?void 0:a.subcategory)&&void 0!==t?t:null,m=null==l?void 0:l.category,g=null!==(i=null==l?void 0:l.subcategory)&&void 0!==i?i:null,v=r.explicit||!1,b=(0,s.AmV)();return{title:d,description:c,primaryCategory:p,primarySubcategory:h,secondaryCategory:m,secondarySubcategory:g,isExplicit:v,artUrl:b,byline:r.author_name,language:"",isRedirected:null,podcastRssUrl:null,showPodcastTab:!0,paidEpisodeArtUrl:null!==(n=r.paid_podcast_episode_art_url)&&void 0!==n?n:null}};function v(e,t){var i;return null!==(i=(null==t?void 0:t.cover_image)||(null==t?void 0:t.podcast_art_url)||(null==e?void 0:e.podcast_art_url))&&void 0!==i?i:null}let b=e=>{var t,i;let n;let r=null!==(i=null===(t=e.sections)||void 0===t?void 0:t.filter(e=>{let{is_podcast:t}=e;return t}).map(t=>{var i;let n=p({pub:e,section:t});return{slug:t.slug,podcastTitle:null!==(i=n.title)&&void 0!==i?i:"",description:n.description,artUrl:n.artUrl,sectionId:t.id}}))&&void 0!==i?i:[];return e.podcast_enabled&&(n=m({pub:e})),a()([n&&{slug:e.subdomain,podcastTitle:n.title,description:n.description,artUrl:n.artUrl,sectionId:null},...r])},y=e=>{let{podcasts:t,urlSlug:i,isSection:n,defaultPodcastSlug:r}=e;if(!t.length)return null;if(i){let e=t.find(e=>{let{sectionId:t,slug:r}=e;return r===i&&!!t===n});if(e)return e;"undefined"!=typeof window&&window.alert("No podcast was found at that URL")}return r&&t.find(e=>{let{slug:t}=e;return t==r})||t[0]};async function f(e){let{sectionId:t}=e;return await (0,l.rd)("/api/v1/can-syndicate-feed",{query:(0,n._)({},t&&{sectionId:t})})}function _(e){var t,i;let{pub:n,section:r}=e;return r?null!==(t=r.spotify_podcast_settings)&&void 0!==t?t:null:null!==(i=n.spotify_podcast_settings)&&void 0!==i?i:null}},49762:function(e,t,i){i.r(t),i.d(t,{SiteConfigGate:()=>l,default:()=>a,getConfigFor:()=>o});var n=i(16584),r=i(40647);function o(e){var t;if(!e||"undefined"==typeof window||!(null===(t=window._preloads)||void 0===t?void 0:t.siteConfigs))return null;let i=window._preloads.siteConfigs[e];return void 0===i?null:i}let a=o;function l(e){let{configKey:t,children:i,value:o=!0}=e;return(0,r.xR)().getConfigFor(t)==o?(0,n.tZ)(n.HY,{children:i}):null}},63018:function(e,t,i){i.d(t,{OV:()=>s,_I:()=>l,kp:()=>a.kp});var n=i(7409),r=i(98848),o=i(69241),a=i(48980);function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;var{deps:l,auto:s=!0,massage:d=async e=>e,shouldRevalidate:c=!0}=t,u=(0,r._)(t,["deps","auto","massage","shouldRevalidate"]);return(0,o.ZP)(s?l?[...l,e]:e:null,()=>(0,a.rd)(e,u).then(d),(0,n._)({},c?null:{revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1},i))}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var{deps:i}=t,n=(0,r._)(t,["deps"]);(0,o.MA)(i?[...i,e]:e,()=>(0,a.rd)(e,n))}},10656:function(e,t,i){i.d(t,{G5:()=>o,Iw:()=>a,Nm:()=>l}),i(16584);var n=i(6400),r=i(95441);i(31582),i(84864);let o=(e,t)=>{var i,o,a;let l="undefined"!=typeof window&&null!==(a=null===(o=window._preloads)||void 0===o?void 0:null===(i=o.pub)||void 0===i?void 0:i.language)&&void 0!==a?a:"en";(0,n.render)((0,n.h)(r._7,{language:l,children:e}),t)};async function a(e){let{timeout:t=5e3}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=document.createElement("video");i.volume=0;let n=!1,r=Promise.race([new Promise(e=>{i.onloadedmetadata=()=>{i.onloadedmetadata=null,i.duration===1/0?(i.currentTime=Number.MAX_SAFE_INTEGER,i.ontimeupdate=()=>{i.ontimeupdate=null,n=!0,e(i.duration),i.currentTime=0}):e(i.duration)},i.onerror=t=>{n=!0;let i=null;"string"==typeof t?i=t:t.target&&"error"in t.target&&(i=t.target.error),e({is_error:!0,err:i})}}),new Promise(e=>{setTimeout(()=>{n||e({is_error:!0,err:Error("Blob duration fetching timed out")})},t)})]);try{i.src="string"==typeof e||"string"==typeof e?e:window.URL.createObjectURL(e)}catch(e){return{is_error:!0,err:e}}return r}let l=(e,t)=>{let{decimals:i=0}=t||{};return Math.round(e*Math.pow(10,i))/Math.pow(10,i)}},98914:function(e,t,i){i.d(t,{$Z:()=>eh,AE:()=>es,Bb:()=>eE,Br:()=>eC,Dt:()=>G,EH:()=>eR,Fo:()=>L,G6:()=>$,GL:()=>ek,HM:()=>U,Hl:()=>eJ,IV:()=>eu,IW:()=>eM,K1:()=>V,L:()=>K,LG:()=>el,Mi:()=>ee,P_:()=>eT,Po:()=>e0,Pu:()=>j,QM:()=>er,Qg:()=>eH,Qu:()=>H,Se:()=>eD,UG:()=>eo,V5:()=>Q,VA:()=>e2,WC:()=>e1,YU:()=>ea,Yk:()=>ej,Zk:()=>ex,_I:()=>ez,aZ:()=>eZ,bs:()=>eI,bt:()=>eY,cn:()=>ec,dr:()=>eb,e5:()=>J,er:()=>eV,fo:()=>D,iO:()=>eO,ig:()=>R,kE:()=>ef,lf:()=>eq,m:()=>eN,nn:()=>eA,oA:()=>eS,pK:()=>ed,pt:()=>F,pv:()=>ep,rG:()=>eW,rm:()=>eU,rs:()=>em,sz:()=>A,tu:()=>eF,uX:()=>eX,ut:()=>ey,vQ:()=>en,vU:()=>W,w1:()=>q,yU:()=>e_,yY:()=>eg,zm:()=>Y,zw:()=>eB,zx:()=>O});var n=i(7409),r=i(99282),o=i(58865),a=i(16584),l=i(20042),s=i(91561);i(55480);var d=i(98012),c=i(48884),u=i(86458),p=i(40121),h=i(60308),m=i(69332),g=i(81821),v=i(84864);function b(){let e=(0,o._)(["","% off first month"]);return b=function(){return e},e}function y(){let e=(0,o._)(["","% off first year"]);return y=function(){return e},e}function f(){let e=(0,o._)(["","% off first week"]);return f=function(){return e},e}function _(){let e=(0,o._)(["","% off first day"]);return _=function(){return e},e}function Z(){let e=(0,o._)(["","% off first payment"]);return Z=function(){return e},e}function w(){let e=(0,o._)(["","% off forever"]);return w=function(){return e},e}function C(){let e=(0,o._)([""," off first month"]);return C=function(){return e},e}function x(){let e=(0,o._)([""," off first year"]);return x=function(){return e},e}function S(){let e=(0,o._)([""," off first week"]);return S=function(){return e},e}function k(){let e=(0,o._)([""," off first day"]);return k=function(){return e},e}function B(){let e=(0,o._)([""," off first payment"]);return B=function(){return e},e}function T(){let e=(0,o._)([""," off forever"]);return T=function(){return e},e}function I(){let e=(0,o._)([" at ",""]);return I=function(){return e},e}function N(){let e=(0,o._)([" at ",""]);return N=function(){return e},e}function P(){let e=(0,o._)([" at ",""]);return P=function(){return e},e}function E(){let e=(0,o._)([" at ",""]);return E=function(){return e},e}let X=["text","password","file","search","email","number","date","color","datetime","datetime-local","month","range","search","tel","time","url","week"],M="undefined"==typeof window||!window.addEventListener;M||window.addEventListener("load",()=>{M=!0},!1),"undefined"!=typeof window&&window._preloads;let A="undefined"!=typeof window?new s.Z:null,D=e=>{M?e():window.addEventListener("load",e,!1)},R=function(e,t){var i,n,r,o,a,l;let s,{language:d="en"}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{iTemplate:u,iPlural:p}=c.mb.i(d);if(e&&!e.loading&&!e.error){if(e.trial_period_days)s=p("1 day free trial","%1 day free trial",e.trial_period_days);else if(e.extra_seats)s=p("an additional seat","%1 additional seats",e.extra_seats);else if(e.percent_off){if("once"===e.duration){if(t)switch(t.interval){case"month":s=u(b(),Math.round(e.percent_off_precise||e.percent_off));break;case"year":s=u(y(),Math.round(e.percent_off_precise||e.percent_off));break;case"week":s=u(f(),Math.round(e.percent_off_precise||e.percent_off));break;case"day":s=u(_(),Math.round(e.percent_off_precise||e.percent_off))}else s=u(Z(),Math.round(e.percent_off_precise||e.percent_off))}else s="repeating"===e.duration?null===e.duration_in_months||e.duration_in_months%12==0?p("%2% off for 1 year","%2% off for %1 years",(null!==(i=e.duration_in_months)&&void 0!==i?i:0)/12,"".concat(Math.round(e.percent_off_precise||e.percent_off))):p("%2% off for 1 month","%2% off for %1 months",e.duration_in_months,"".concat(Math.round(e.percent_off_precise||e.percent_off))):u(w(),Math.round(e.percent_off_precise||e.percent_off))}else if(e.amount_off){if("once"===e.duration){if(t)switch(t.interval){case"month":s=u(C(),(0,v.centsToPriceString)(e.amount_off,t.currency));break;case"year":s=u(x(),(0,v.centsToPriceString)(e.amount_off,t.currency));break;case"week":s=u(S(),(0,v.centsToPriceString)(e.amount_off,t.currency));break;case"day":s=u(k(),(0,v.centsToPriceString)(e.amount_off,t.currency))}else{let i=(0,v.centsToPriceString)(e.amount_off,null!==(n=null==t?void 0:t.currency)&&void 0!==n?n:"");s=u(B(),i)}}else if("repeating"===e.duration){if(null===e.duration_in_months||e.duration_in_months%12==0){let i=(0,v.centsToPriceString)(e.amount_off,null!==(r=null==t?void 0:t.currency)&&void 0!==r?r:"");s=p("%2 off for 1 year","%2 off for %1 years",(null!==(o=e.duration_in_months)&&void 0!==o?o:0)/12,i)}else{let i=(0,v.centsToPriceString)(e.amount_off,null!==(a=null==t?void 0:t.currency)&&void 0!==a?a:"");s=p("%2 off for 1 month","%2 off for %1 months",e.duration_in_months,i)}}else{let i=(0,v.centsToPriceString)(e.amount_off,null!==(l=null==t?void 0:t.currency)&&void 0!==l?l:"");s=u(T(),i)}}return s}},F=function(e,t){let i=new Image;i.onload=()=>{i.onload=i.onerror=null,t&&t(i)},i.onerror=i.onload,i.src=e},L=e=>{let t=document.createElement("a");return t.href=e,(t.hostname||"").replace(/\.localhost$/,"")},z=e=>{let t=document.createElement("a");return t.href=e,(t.pathname||"")+(t.search||"")+(t.hash||"")},O=(e,t)=>{var i;return H((null==e?void 0:e.body)||(null==e?void 0:null===(i=e.response)||void 0===i?void 0:i.body),t)},U=e=>{var t,i,n;let r=(null==e?void 0:e.body)||(null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.body);return r&&r.error?{msg:r.error}:r&&r.errors&&r.errors.length>0?{html:null===(i=r.errors[r.errors.length-1])||void 0===i?void 0:i.msgHTML,msg:null===(n=r.errors[r.errors.length-1])||void 0===n?void 0:n.msg}:void 0},Y=(e,t)=>{let i;try{i=e?JSON.parse(e&&e.responseText):e}catch(e){}return H(i,t)},H=(e,t)=>{if(t=t||"Something went wrong",e&&e.error)return e.error;if(e&&e.errors&&e.errors.length>0){var i;return(null===(i=e.errors[e.errors.length-1])||void 0===i?void 0:i.msg)||t}return t},j=e=>{var t,i;if(!(null==e?void 0:null===(i=e.response)||void 0===i?void 0:null===(t=i.body)||void 0===t?void 0:t.errors)||0===e.response.body.errors.length)return null;let n={};for(let t of e.response.body.errors)n[t.param]={msg:t.msg,value:t.value};return n},J=function(){return[(0,a.tZ)("input",{type:"email",name:"fake_email",placeholder:"email",style:"position:absolute;top:-10000px;left:-10000px","aria-hidden":"true",tabIndex:-1}),(0,a.tZ)("input",{type:"password",name:"fake_password",placeholder:"password",style:"position:absolute;top:-10000px;left:-10000px","aria-hidden":"true",tabIndex:-1})]},V=function(){if("undefined"!=typeof navigator||"undefined"!=typeof window){let e=navigator.userAgent||navigator.vendor||window.opera;if(e&&(0,g.r3)(e,{checkFirst4:!0}))return!0}return!1},q=()=>"undefined"!=typeof window&&!!window.navigator&&!!window.navigator.userAgent&&/(MSIE|Trident)/i.test(window.navigator.userAgent),W=()=>"undefined"!=typeof window&&!!window.navigator&&!!window.navigator.userAgent&&/Firefox/i.test(window.navigator.userAgent),G=()=>"undefined"!=typeof window&&!!window.navigator&&!!window.navigator.userAgent&&/Android/i.test(window.navigator.userAgent),K=()=>!!et(),Q=e=>{if("undefined"==typeof window||e||(e=window.navigator),!e)return!1;let t=e;return t.userAgentData&&t.userAgentData.platform?/macOS/.test(t.userAgentData.platform):/Mac/.test(e.platform)},$=()=>!!navigator&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent),ee=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q();return e?"âŒ˜":"^"},et=()=>"undefined"==typeof window?null:(0,g.Xq)(),ei=e=>((t,i)=>{let n;let r=()=>i.userAgent.match(/ipad|iphone/i),o=e=>{(n=t.createElement("textArea")).value=e,t.body.appendChild(n)},a=()=>{let i,o;r()?((i=t.createRange()).selectNodeContents(n),(o=e.getSelection()).removeAllRanges(),o.addRange(i),n.setSelectionRange(0,999999)):n.select()},l=()=>{t.execCommand("copy"),t.body.removeChild(n)};return{copy:e=>{o(e),a(),l()}}})(document,navigator),en=e=>{if("undefined"==typeof window)return;ei(window).copy(e);let t=t=>{t&&t.clipboardData?(t.clipboardData.setData("text/plain",e),t.preventDefault()):window.clipboardData&&window.clipboardData.setData("Text",e)};et()||window.addEventListener("copy",t),setTimeout(()=>{try{let t=document.createElement("input");t.style="position: absolute; top: 0; right: 0; height: 1px; width: 1px;",document.documentElement.appendChild(t),t.value=e,t.contentEditable="true",t.readOnly=!1;let i=document.createRange();i.selectNodeContents(t);let n=window.getSelection();null==n||n.removeAllRanges(),null==n||n.addRange(i),t.setSelectionRange(0,999999),document.execCommand("copy"),document.documentElement.removeChild(t)}catch(e){}window.removeEventListener("copy",t)},0)},er=e=>{try{eo(e),document.execCommand("copy")}catch(e){console.error("Failed to copy text:",e)}},eo=e=>{if(e)try{if("nodeName"in e&&["INPUT","TEXTAREA"].includes(e.nodeName)&&"select"in e&&e.select)e.select();else if("createTextRange"in document.body&&document.body.createTextRange){let t=document.body.createTextRange();t.moveToElementText(e),t.select()}else if(window.getSelection){let t=window.getSelection(),i=document.createRange();i.selectNodeContents(e),null==t||t.removeAllRanges(),null==t||t.addRange(i)}else console.warn("Could not select text in node: Unsupported browser")}catch(e){console.error("Failed to select node:",e)}},ea=e=>{try{let t=window.getSelection?window.getSelection():document.selection;t&&t.anchorNode===e&&(t.empty?t.empty():t.removeAllRanges&&t.removeAllRanges())}catch(e){console.error("Failed to deselect node:",e)}},el=(e,t)=>{let i="offset".concat((0,v.toTitleCase)(t)),n=0;for(;e&&e!==document.body;)n+=e[i],e="offsetParent"in e&&e.offsetParent||e.parentNode;return n},es=()=>"undefined"!=typeof window&&window.location.hash?decodeURIComponent(window.location.hash.slice(1)):null,ed=function(e){let t=es();if(!t)return;let i=document.getElementById(t);i&&("number"!=typeof e&&(e=-122),document.documentElement.scrollTop=Math.max(0,el(i,"top")+e))},ec=(e,t)=>{e.className+=" ".concat(t)},eu=(e,t)=>{e&&(e.className=e.className.replace(RegExp("\\b".concat(t,"\\b"),"g"),"").trim())},ep=(e,t)=>RegExp("\\b".concat(t,"\\b"),"g").test(e.className),eh=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return em(document.activeElement,...t)},em=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];let r=e;for(;r;){for(let e of i)if("function"==typeof e?e(r):r===e)return!0;r=r.parentNode}return!1},eg=(e,t)=>e?t(e)?e:eg(e.parentNode,t):null,ev=()=>{let e,t;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),{visibilityChange:e,hidden:t}},eb=()=>{let{hidden:e}=ev();return!e||!document[e]},ey=e=>{let{visibilityChange:t}=ev();t&&document.addEventListener(t,e,!1)},ef=e=>{let{visibilityChange:t}=ev();t&&document.removeEventListener(t,e,!1)},e_=()=>{document.addEventListener("keydown",ew,!1)},eZ=()=>{document.removeEventListener("keydown",ew,!1)};function ew(e){if(8!==e.keyCode)return;let t=e.srcElement||e.target;if(t){if(!t.readonly&&!t.disabled){if("isContentEditable"in t&&t.isContentEditable)return;if("nodeName"in t&&"TEXTAREA"===t.nodeName)return;if("nodeName"in t&&"INPUT"===t.nodeName&&X.indexOf((t.getAttribute("type")||"").toLowerCase())>-1)return}return e.preventDefault(),!1}}let eC=e=>new Promise((t,i)=>{let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onerror=i,n.onload=e=>{200==n.status?t(n.response):i(Error("Failed to fetch blob"))},n.send()}),ex=e=>new Promise((t,i)=>{if(!window.FileReader){i(TypeError("File reader API not found"));return}let n=new FileReader;n.onerror=i,n.onload=()=>{t(n.result)},n.readAsDataURL(e)}),eS=e=>new Promise((t,i)=>{if(!window.FileReader){i(TypeError("File reader API not found"));return}if(!window.DataView){i(TypeError("DataView API not found"));return}let n=new FileReader;n.onerror=i,n.onload=()=>{let e=new DataView(n.result);if(65496!=e.getUint16(0,!1))return t(-2);let i=e.byteLength,r=2;for(;r<i;){if(8>=e.getUint16(r+2,!1))return t(-1);let i=e.getUint16(r,!1);if(r+=2,65505==i){if(0x45786966!=e.getUint32(r+=2,!1))return t(-1);let i=18761==e.getUint16(r+=6,!1);r+=e.getUint32(r+4,i);let n=e.getUint16(r,i);r+=2;for(let o=0;o<n;o++)if(274==e.getUint16(r+12*o,i))return t(e.getUint16(r+12*o+8,i))}else if((65280&i)!=65280)break;else r+=e.getUint16(r,!1)}t(-1)},n.readAsArrayBuffer(e)}),ek=async e=>{let t,i;if(e){try{t=await ex(e)}catch(e){console.error("Failed to get data URL from file:",e),alert(e.message);return}try{i=await eS(e)}catch(e){console.error("Failed to extract EXIF data from file:",e)}}return{url:t,orientation:i}},eB=async e=>{let t=(null==e?void 0:e.files)?e.files[0]:null;return e.value="",ek(t)},eT=e=>{switch(e){case 2:return"rotateY(180deg)";case 3:return"rotateZ(-180deg)";case 4:return"rotateZ(-180deg) rotateY(180deg)";case 5:return"rotateZ(-90deg) rotateY(180deg)";case 6:return"rotateZ(90deg)";case 7:return"rotateZ(90deg) rotateY(180deg)";case 8:return"rotateZ(-90deg)";default:return""}},eI=()=>Math.max(document.documentElement.scrollHeight,document.body.scrollHeight)-window.innerHeight,eN=e=>{let t,i,n,r,o,a,l;let s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",d="",c=0;for(e=eP(e);c<e.length;)t=e.charCodeAt(c++),i=e.charCodeAt(c++),n=e.charCodeAt(c++),r=t>>2,o=(3&t)<<4|i>>4,a=(15&i)<<2|n>>6,l=63&n,isNaN(i)?a=l=64:isNaN(n)&&(l=64),d=d+s.charAt(r)+s.charAt(o)+s.charAt(a)+s.charAt(l);return d},eP=e=>{let t="";for(let i=0;i<e.length;i++){let n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):(n>127&&n<2048?t+=String.fromCharCode(n>>6|192):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128)),t+=String.fromCharCode(63&n|128))}return t},eE=e=>{let t=[window.scrollX,window.scrollY];eX(e),window.scrollTo(...t)},eX=function(e){let{event:t=null,local_navigation:i=!0,replace:n=!1,newTab:r=!1,state:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t&&t.preventDefault(),!e||e.trim().startsWith("javascript:"))return;if(e.startsWith("#")&&i){if(window.location.hash!==e){var a;n&&(null===(a=window.history)||void 0===a?void 0:a.replaceState)?window.history.replaceState(null!=o?o:window.history.state,null,e):window.location.hash=e}ed();return}if(i&&L(e)&&L(e)!==L(window.location.href)&&(i=!1),r||t&&("metaKey"in t&&t.metaKey||"ctrlKey"in t&&t.ctrlKey)){window.open(e,"_blank");return}let s=history.state;if(i&&(0,l.route)(z(e),n)){void 0!==o?history.replaceState(o,""):n&&void 0!==s&&history.replaceState(s,""),setTimeout(()=>ed(),0);return}window.location.href=e},eM=(e,t)=>new Promise(i=>{e.setState(t,i)}),eA=(e,t)=>new Promise((i,n)=>{let r=async function(){for(var r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];try{i(await t.apply(e,o))}catch(e){n(e)}};e.setState(r)}),eD=async function(e,t,i){let{force:n}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return"function"==typeof t&&(i=t,t="lock"),await eA(e,async function(r){for(var o=arguments.length,a=Array(o>1?o-1:0),l=1;l<o;l++)a[l-1]=arguments[l];if(r[t]&&!n)return;await eM(e,{[t]:!0});let s=await i.call(e,r,...a);return await eM(e,{[t]:!1}),s})},eR=()=>{let e=window.crypto||window.msCrypto;if("function"==typeof(null==e?void 0:e.randomUUID))return e.randomUUID();if(e)return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,t=>(t^e.getRandomValues(new Uint8Array(1)[0])&15>>t/4).toString(16));let t=new Date().getTime(),i="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let n=16*Math.random();return t>0?(n=(t+n)%16|0,t=Math.floor(t/16)):(n=(i+n)%16|0,i=Math.floor(i/16)),("x"===e?n:3&n|8).toString(16)})},eF=(e,t)=>e?e.user_id===t.author_id?"owner":e.role:"byline",eL=(e,t)=>{if(!e)return e;let i=parseInt((e=e.replace("#","")).substring(0,2),16),n=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16);return"rgba(".concat(i,",").concat(n,",").concat(r,",").concat(t/100,")")},ez=e=>{let{primary:t,neutral0:i="#f8f8f8",neutral20:o="#d8d8d8",danger:a="var(--color-accent-fg-red)",dangerLight:l="var(--color-accent-bg-red)"}=e;return e=>(0,r._)((0,n._)({},e),{colors:(0,r._)((0,n._)({},e.colors),{primary:t,primary25:eL(t,25),primary50:eL(t,50),primary75:eL(t,75),neutral0:i,neutral20:o,danger:a,dangerLight:l})})},eO=function(e){var t;let{stripHash:i=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("undefined"!=typeof window&&(null===(t=window.history)||void 0===t?void 0:t.replaceState)){let t=(0,m.m)(window.location.href);if(Array.isArray(e))for(let i of e)delete t[i];else delete t[e];let n="".concat((0,h.n1t)(window.location.pathname,t)).concat(i?"":window.location.hash);window.history.replaceState(window.history.state,document.title,n)}},eU=()=>"undefined"!=typeof window&&(void 0!==document.webkitCurrentFullScreenElement?null!==document.webkitCurrentFullScreenElement:void 0!==document.fullscreenElement&&null!==document.fullscreenElement),eY=e=>"undefined"!=typeof window&&(e.requestFullScreen?(e.requestFullScreen(),!0):e.webkitRequestFullScreen?(e.webkitRequestFullScreen(),!0):!!e.mozRequestFullScreen&&(e.mozRequestFullScreen(),!0)),eH=()=>{if(!eU())return!1;if(document.exitFullscreen)return document.exitFullscreen(),!0;if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)return document.mozCancelFullScreen(),!0;else if(document.msExitFullscreen)return document.msExitFullscreen(),!0;return!1},ej=()=>"undefined"!=typeof window&&!!document.pictureInPictureElement&&!!document.exitPictureInPicture&&(document.exitPictureInPicture(),!0),eJ=e=>{let t=document.createElement("a");document.body.appendChild(t),t.href=e,t.target="_blank",t.click(),document.body.removeChild(t)},eV=function(e){let{skipFoundingPlan:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(null==e?void 0:e.length))return[];let i=[];for(let o of e)t&&o.is_founding?i.push((0,n._)({},o)):o.amount?i.push((0,r._)((0,n._)({},o),{amount:o.amount})):i.push((0,n._)({},o));return i},eq=(e,t,i,n)=>{if(i<=t)return"Your founding price must be greater than your yearly price";let r=(0,u.JK)({value:e,interval:"month",is_founding:!1,currency:n});if(r)return r;let o=(0,u.JK)({value:t,interval:"year",is_founding:!1,currency:n});if(o)return o;let a=(0,u.JK)({value:i,interval:"year",is_founding:!0,currency:n});return a||null},eW=e=>{let t="string"==typeof e?parseFloat(e):e;return"".concat(Math.round(100*t),"%")},eG=new Intl.DateTimeFormat(void 0,{timeStyle:"short"}),eK=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"}),eQ=new Intl.DateTimeFormat(void 0,{dateStyle:"long"}),e$=new Intl.DateTimeFormat(void 0,{dateStyle:"long"}),e0=function(e){let{includeTime:t,language:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,d.Z)(e).locale(i||"en"),r=(0,d.Z)(),{iTemplate:o}=c.mb.i(i);return n.isBefore(r.startOf("year"))?eQ.format(n.toDate())+(t?o(I(),eG.format(n.toDate())):""):n.isBefore(r.startOf("day"))?eK.format(n.toDate())+(t?o(N(),eG.format(n.toDate())):""):n.isAfter(r.endOf("year"))?e$.format(n.toDate())+(t?o(P(),eG.format(n.toDate())):""):n.isAfter(r.endOf("day"))?eK.format(n.toDate())+(t?o(E(),eG.format(n.toDate())):""):eG.format(n.toDate())},e1=()=>"undefined"!=typeof window&&!!window._preloads.isDevelopmentEnvironment,e2=(e,t)=>(0,p.Hm)((0,v.truncateText)(e,500,{ellipsis:""}),{allowUnicode:t})},95050:function(e,t,i){i.d(t,{PageMetaData:()=>c});var n=i(16584),r=i(3312),o=i.n(r),a=i(32351),l=i(40647),s=i(72968),d=i(6163);let c=e=>{let t,i,{pub:r,section:c,isPodcast:u,isHomepage:p}=e,{getConfigFor:h}=(0,l.xR)(),m=h("publication_author_display_override")?String(h("publication_author_display_override")):void 0;if(u&&r.podcast_title)({title:t}=(0,s.getPubPageTitleAndMeta)(r,{primaryTitleOverride:r.podcast_title,primaryAuthorOverride:m})),i=r.podcast_description;else if(c)({title:t,description:i}=(0,s.getPubPageTitleAndMeta)(r,{primaryTitleOverride:"".concat(c.name," | ").concat(r.name),primaryAuthorOverride:m,primaryDescriptionOverride:c.description}));else if(p){let e=h("publication_homepage_title_display_override")?String(h("publication_homepage_title_display_override")):void 0;({title:t,description:i}=(0,s.getPubPageTitleAndMeta)(r,{primaryAuthorOverride:m,completeTitleOverride:e}))}else({title:t,description:i}=(0,s.getPubPageTitleAndMeta)(r,{primaryAuthorOverride:m}));return(0,n.BX)(n.HY,{children:[(0,n.tZ)("script",{dangerouslySetInnerHTML:{__html:o()((0,d.hd)(r),{json:!0,isScriptContext:!0})},type:"application/ld+json"}),(0,n.tZ)(a.Metadata,{title:t,description:i})]})}},98422:function(e,t,i){i.d(t,{Qy:()=>p,qU:()=>u,v9:()=>c});var n=i(7409),r=i(99282),o=i(30396),a=i(1852),l=i(80569),s=i.n(l),d=i(81821);let c=()=>{let e;let t=(0,d.tq)(),i=(0,a.useMediaQuery)({query:"only screen and (max-width: 1024px)"}),n=(0,a.useMediaQuery)({query:"only screen and (max-width: 768px)"}),r=(0,a.useMediaQuery)({query:"(orientation: landscape)"});return e="undefined"==typeof window?t?"mobile":"desktop":n?"mobile":i?"tablet":"desktop",(0,o.Ye)(()=>({breakpoint:e,isMobile:"mobile"===e,isMobileLandscape:t&&r,isTablet:"tablet"===e,isDesktop:"desktop"===e}),[e,r,t])},u=e=>{let{preloadedHomepageData:t,isPreview:i}=e,[n,r]=(0,o.eJ)(null);return(0,o.d4)(()=>{let e=async()=>{r((await s().get("/api/v1/homepage_data").query({preview:i})).body)};t||e()},[t,i]),null!=t?t:n},p=e=>{let{contentBlocks:t}=e,[i,a]=(0,o.eJ)({}),[l,d]=(0,o.eJ)({});return(0,o.d4)(()=>{(async()=>{for(let e of t){if("section"===e.post_source&&e.section_id&&!i[e.section_id]){let{body:t}=await s().get("/api/v1/archive").query({section_id:e.section_id,sort:"new",limit:13});a(i=>(0,r._)((0,n._)({},i),{[String(e.section_id)]:t}))}if("tag"===e.post_source&&e.post_tag_id&&!l[e.post_tag_id]){let{body:t}=await s().get("/api/v1/archive").query({post_tag_id:e.post_tag_id,sort:"new",limit:13});d(i=>(0,r._)((0,n._)({},i),{[String(e.post_tag_id)]:t}))}}})()},[t]),{contentBlocks:t,postsBySectionId:i,postsByTagId:l}}},60885:function(e,t,i){i.d(t,{DE:()=>l,QI:()=>s});var n=i(16584),r=i(6400),o=i(30396);let a=(0,r.createContext)({getPubPinInfo:()=>({showPin:!1}),getSectionPinInfo:()=>({showPin:!1})}),l=()=>(0,o.qp)(a),s=e=>{let{children:t,pub:i,showPubPins:r,showSectionPins:l}=e,s=(0,o.I4)(e=>{var t;let{post:n}=e;return{showPin:r&&!!(null===(t=n.pins)||void 0===t?void 0:t.includes(i.id))}},[i.id,r]),d=(0,o.I4)(e=>{let{post:t}=e;return{showPin:l&&t.is_section_pinned}},[l]);return(0,n.tZ)(a.Provider,{value:{getPubPinInfo:s,getSectionPinInfo:d},children:t})}},32129:function(e,t,i){i.d(t,{getPostMetaImage:()=>o,getPostMetaImageForTwitter:()=>a}),i(16584),i(32351),i(49762),i(2748);var n=i(6070);i(1835);var r=i(60308);function o(e,t){let i,o;return(null==t?void 0:t.cover_image)?(i=(0,r.zF4)(t.cover_image,1200,{height:600,smartCrop:!0,format:"jpg"}),o=!0):"numlock"===e.subdomain?(i=(0,r.zF4)("/img/numlock_square.png?v=2",840),o=!1):(i=(0,n.HD)({pub:e})?(0,r.zF4)("/img/thefp/thefp-preview-card.png",1200,{height:600,smartCrop:!0,format:"jpg",quality:"auto:best"}):(0,r.d54)(e),o=!0),[i,o]}function a(e,t){return(null==t?void 0:t.cover_image)?(0,r.h75)(e,t):null}i(84864),i(93370)},72968:function(e,t,i){i.d(t,{getPubPageTitleAndMeta:()=>a}),i(16584),i(32351),i(40647);var n=i(2748);i(32129);var r=i(93903),o=i(1835);function a(e,t){var i,a;let l,{primaryTitleOverride:s,primaryDescriptionOverride:d,primaryAuthorOverride:c,completeTitleOverride:u}=t,p=c||(null===(i=(0,o.Im)(e.contributors))||void 0===i?void 0:i.owner),h=p&&!(null===(a=e.name)||void 0===a?void 0:a.toLowerCase().includes(null==p?void 0:p.toLowerCase())),m=null!=s?s:e.name;return{title:u||(h?"".concat(m," | ").concat(p," | Substack"):"".concat(m," | Substack")),description:(0,r.Z)((0,n.F)(e,d))}}},79408:function(e,t,i){i.d(t,{C:()=>b});var n=i(7409),r=i(99282),o=i(58865),a=i(16584),l=i(30396),s=i(14293),d=i.n(s);i(80569),i(32351);var c=i(95441),u=i(68833);i(65205),i(98914),i(15771);var p=i(10510),h=i(60308);i(84864);var m=i(47929);function g(){let e=(0,o._)(["View all ",""]);return g=function(){return e},e}let v=e=>{var t,i,o;let{recommendation:l,pub:s,signedIn:d,render:c}=e,{recommendedPublication:g}=l,v=(0,h.TJI)(g,{params:{utm_source:m.b3.homepageRecommendations,utm_campaign:s.id},signedIn:d}),b=()=>{(0,u.j)(u.FP.PUBLICATION_RECOMMENDATION_LINK_CLICKED,{recommending_publication_id:s.id,recommended_publication_id:g.id,source:"homepage-recommendations"})},y={pub:g,openInNewTab:!0,belowTheFold:!0};return c?c({pubAvatarProps:y,pubName:g.name,pubAuthor:null===(i=g.author)||void 0===i?void 0:i.name,url:v,onClick:b}):(0,a.tZ)("div",{className:"home-right-col",children:(0,a.tZ)("div",{className:"recommendation-row",children:(0,a.BX)("div",{className:"left",children:[(0,a.tZ)("a",{onClick:b,children:(0,a.tZ)(p.jM,(0,r._)((0,n._)({},y),{size:32}))}),(0,a.BX)("div",{className:"pub-meta",children:[(0,a.tZ)("a",{href:v,target:"_blank",onClick:b,children:g.name}),(0,a.tZ)("div",{className:"pub-author",children:null!==(o=null===(t=g.author)||void 0===t?void 0:t.name)&&void 0!==o?o:""})]})]})})})},b=e=>{let{recommendations:t,numRecommendations:i,pub:n,user:r,render:o,renderRecommendation:s}=e,{iString:p,iTemplate:m}=(0,c.M1)(),b=t.map(e=>(0,a.tZ)(v,{recommendation:e,pub:n,signedIn:!!r,render:s}));return((0,l.d4)(()=>{(0,u.j)(u.FP.PUBLICATION_RECOMMENDATIONS_SHOWN,{source:"pub-home",recommendations:t.map(e=>{let{recommendedPublication:t}=e;return t.id})})},[t]),o)?o({recommendations:b,canManage:!!(null==r?void 0:r.is_admin),manageUrl:(0,h.Li8)(n),hasMore:!d()(i)&&i>t.length,hasMoreUrl:(0,h.kfT)(n),recommendationsCount:i}):(0,a.BX)("div",{className:"home-right-group recommendations",children:[(0,a.BX)("div",{className:"home-right-group-title",children:[(0,a.tZ)("a",{href:(0,h.kfT)(n),children:"Recommendations"}),(null==r?void 0:r.is_admin)?(0,a.tZ)("a",{href:(0,h.Li8)(n),native:!0,children:p("Manage")}):!d()(i)&&i>t.length?(0,a.tZ)("a",{href:(0,h.kfT)(n),native:!0,children:m(g(),i)}):null]}),b]})}},96745:function(e,t,i){i.d(t,{Mt:()=>v,Tz:()=>b,lH:()=>y});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(94184),s=i.n(l),d=i(79774),c=i(98661),u=i(95441),p=i(19081),h=i(51776),m=i(24548),g=i(68686);function v(e){var{className:t,min:i,max:l,value:d,defaultValue:u,onChange:h,disabled:v,readOnly:b,flex:y="auto",error:Z=!1}=e,w=(0,o._)(e,["className","min","max","value","defaultValue","onChange","disabled","readOnly","flex","error"]);let C=(0,c.useRef)(null);return(0,a.BX)(p.hs,{position:"relative",flex:y,minWidth:0,children:[(0,a.tZ)("input",(0,r._)((0,n._)({},w),{type:"date",ref:C,className:s()(t,m.Z.datePicker,g.Z.input,g.Z.inputText,Z&&g.Z.error,v&&g.Z.disabled,b&&g.Z.readOnly),defaultValue:u,value:_(d),min:_(i),max:_(l),onChange:h,disabled:v})),(0,a.tZ)(f,{inputRef:C})]})}function b(e){var{className:t,min:i,max:l,value:d,onChange:u,disabled:h,readOnly:v,flex:b="auto",error:y=!1}=e,_=(0,o._)(e,["className","min","max","value","onChange","disabled","readOnly","flex","error"]);let w=(0,c.useRef)(null);return(0,a.BX)(p.hs,{position:"relative",flex:b,minWidth:0,children:[(0,a.tZ)("input",(0,r._)((0,n._)({},_),{type:"datetime-local",ref:w,className:s()(t,m.Z.datePicker,g.Z.input,g.Z.inputText,y&&g.Z.error,h&&g.Z.disabled,v&&g.Z.readOnly),value:Z(d),min:Z(i),max:Z(l),onChange:u,disabled:h})),(0,a.tZ)(f,{inputRef:w})]})}function y(e){var{className:t,min:i,max:l,value:d,onChange:c,disabled:u,readOnly:h,flex:v="auto",error:b=!1}=e,y=(0,o._)(e,["className","min","max","value","onChange","disabled","readOnly","flex","error"]);return(0,a.tZ)(p.hs,{position:"relative",flex:v,minWidth:0,children:(0,a.tZ)("input",(0,r._)((0,n._)({},y),{type:"month",className:s()(t,m.Z.datePicker,g.Z.input,g.Z.inputText,b&&g.Z.error,u&&g.Z.disabled,h&&g.Z.readOnly),value:Z(d),min:Z(i),max:Z(l),onChange:c,disabled:u}))})}let f=e=>{let{inputRef:t}=e,{iString:i}=(0,u.M1)();return(0,a.tZ)(h.cv,{className:m.Z.trailing,onClick:e=>{let{current:i}=t;if(i){var n;e.preventDefault(),e.stopPropagation(),i.focus(),null===(n=i.showPicker)||void 0===n||n.call(i)}},onMouseDown:e=>{e.preventDefault()},children:(0,a.tZ)(d.Z,{size:16,"aria-label":i("Calendar icon")})})};function _(e){return e instanceof Date?"".concat(e.getFullYear(),"-").concat(w(e.getMonth()+1),"-").concat(w(e.getDate())):e}function Z(e){return e instanceof Date?"".concat(e.getFullYear(),"-").concat(w(e.getMonth()+1),"-").concat(w(e.getDate()),"T").concat(w(e.getHours()),":").concat(w(e.getMinutes())):e}function w(e){let t=String(e);return t.length<2?"0".concat(t):t}},68709:function(e,t,i){i.d(t,{OV:()=>h,__:()=>p});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(94184),s=i.n(l),d=i(98661),c=i(19081),u=i(58175);let p=(0,d.forwardRef)((e,t)=>{var{className:i}=e,r=(0,o._)(e,["className"]);return(0,a.tZ)(u.xv.B4,(0,n._)({as:"label",weight:"medium",color:"primary",ref:t,cursor:"inherit",className:s()("pencraft",i)},r))}),h=(0,d.forwardRef)((e,t)=>{var{className:i,children:l,hint:d}=e,u=(0,o._)(e,["className","children","hint"]);return(0,a.tZ)(p,(0,r._)((0,n._)({ref:t,className:s()("pencraft",i)},u),{children:(0,a.BX)(c.gq,{gap:4,justifyContent:"space-between",children:[l,(0,a.tZ)(m,{text:d})]})}))}),m=e=>{let{text:t}=e;return(0,a.tZ)(u.xv,{color:"secondary",weight:"regular",children:t})}},44424:function(e,t,i){i.d(t,{$j:()=>P,LF:()=>O,LY:()=>M,Mz:()=>X,dW:()=>L,sN:()=>N,v2:()=>k,xw:()=>A,yU:()=>F});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(19425),s=i(94184),d=i.n(s),c=i(2564),u=i(25380),p=i(98661),h=i(62372),m=i(60684),g=i(71068),v=i(15771),b=i(61254),y=i(19081),f=i(10903),_=i(47295),Z=i(50368),w=i(4615),C=i(58175),x=i(91400),S=i(42450);let k=(0,p.forwardRef)((e,t)=>{var{trigger:i,children:s,ariaLabel:d="View more",hideOnScroll:c,layerOptions:u,layerClassName:h,onOpen:g,onClose:v,useMobileBottomSheet:b=!0,stopPropagation:y=!1,padding:_=4,disableMenu:w=!1,title:C,Theme:k,customShowClass:N,customHideClass:P}=e,E=(0,o._)(e,["trigger","children","ariaLabel","hideOnScroll","layerOptions","layerClassName","onOpen","onClose","useMobileBottomSheet","stopPropagation","padding","disableMenu","title","Theme","customShowClass","customHideClass"]);"function"!=typeof i&&"string"!=typeof i.type&&i.type.$$typeof!==Symbol.for("react.forward_ref")&&console.error("Menu trigger must be a valid component that forwards a ref that react-laag uses, or a native dom element. See Button/IconButton for example, and preferably use those.");let X=(0,x.XA)(),{triggerProps:M,layerProps:A,renderLayer:D,isOpen:R,setOpen:F}=(0,f.x)({layerOptions:(0,n._)({auto:!0,possiblePlacements:["bottom-start","bottom-center","bottom-end","top-start","top-center","top-end"],preferY:"bottom"},u),hideOnScroll:c&&!(b&&X),onClose:v}),[L,O]=(0,p.useState)(!1),U=()=>{F(!1),v&&v()},Y=p.Children.map(s,e=>(0,p.cloneElement)(e,{useMobileBottomSheet:b,closeMenu:U})),H=(0,p.useMemo)(()=>({useMobileBottomSheet:b,close:U}),[v,b]),j=(0,r._)((0,n._)({},M),{ariaLabel:d,onClick:e=>{e.preventDefault(),y&&e.stopPropagation(),w||F(!R),R?null==v||v():null==g||g()}});return(0,a.BX)(Z.p.Provider,{value:H,children:["function"==typeof i?i(j):(0,p.cloneElement)(i,j),(R||L)&&D(b&&X?(0,a.tZ)(l.u,{appear:!0,show:R,beforeEnter:()=>O(!0),afterLeave:()=>O(!1),className:S.Z.actionSheetTransition,enterFrom:S.Z.actionSheetHide,enterTo:S.Z.actionSheetShow,leaveFrom:S.Z.actionSheetShow,leaveTo:S.Z.actionSheetHide,children:(0,a.tZ)(z,{Theme:k,children:(0,a.tZ)("div",(0,r._)((0,n._)({},A,E),{children:(0,a.tZ)(m.V,{title:C,onClose:U,ref:t,className:h,children:Y})}))})}):(0,a.tZ)(T,{isOpen:R,setAnimating:O,children:(0,a.tZ)(z,{Theme:k,children:(0,a.tZ)("div",(0,r._)((0,n._)({},A,E),{children:(0,a.tZ)(B,{isOpen:R,customHideClass:P,customShowClass:N,children:(0,a.tZ)(I,(0,r._)((0,n._)({className:h,ref:t,padding:_},!c&&{style:{overflowY:"auto"}}),{children:Y}))})}))})}))]})});function B(e){let{isOpen:t,customHideClass:i,customShowClass:n,children:r}=e;return(0,a.tZ)(l.u,{appear:!0,unmount:!1,show:t,className:S.Z.transition,enterFrom:null!=i?i:S.Z.hide,enterTo:null!=n?n:S.Z.show,leaveFrom:null!=n?n:S.Z.show,leaveTo:null!=i?i:S.Z.hide,children:r})}function T(e){let{children:t,isOpen:i,setAnimating:n}=e;return(0,a.tZ)(l.u,{appear:!0,unmount:!1,show:i,beforeEnter:()=>n(!0),afterLeave:()=>n(!1),className:S.Z.transition,children:t})}let I=(0,p.forwardRef)((e,t)=>{var{className:i,padding:r=4}=e,l=(0,o._)(e,["className","padding"]);return(0,a.tZ)(w.Sf,{children:(0,a.tZ)(y.tu,(0,n._)({className:d()(S.Z.menu,"elevated",i),bg:"elevated",shadow:"md",border:"detail",radius:"sm",sizing:"border-box",showFocus:!0,gap:2,padding:r,ref:t},l))})}),N=(0,p.forwardRef)((e,t)=>{var i;return(0,a.tZ)(E,(0,r._)((0,n._)({},e),{className:d()(S.Z.menuItem,S.Z["priority_".concat(null!==(i=e.priority)&&void 0!==i?i:"primary")],e.className,{[S.Z.disabled]:!!e.disabled,[S.Z.relative]:!!e.hiddenInput}),children:e.children,ref:t}))}),P=(0,g.zo)({width:16,height:16}),E=(0,p.forwardRef)((e,t)=>{var{children:i,onClick:l,closeMenu:s,leading:d,trailing:c,priority:u="primary",className:h,disabled:m,href:g,download:b,hiddenInput:y}=e,f=(0,o._)(e,["children","onClick","closeMenu","leading","trailing","priority","className","disabled","href","download","hiddenInput"]);let w=g?"a":v.kG,{close:C}=(0,Z.X)();return(0,a.BX)(w,(0,r._)((0,n._)({className:h,resetCss:!0,onClick:e=>{!m&&(l&&l(e),!e.defaultPrevented&&(C?C():s&&s()))},href:m?"javascript:void(0)":g,download:b,ref:t},f),{children:[d&&(0,a.tZ)(X,{children:(0,p.cloneElement)(d,{size:16})}),(0,a.tZ)(D,{priority:u,children:i}),c&&(0,a.tZ)(X,{children:(0,p.cloneElement)(c,{size:16})}),y&&(0,a.tZ)(_.U,{children:y})]}))}),X=(0,g.zo)({display:"flex",flex:"auto",width:24,height:24,alignItems:"center",justifyContent:"center"});function M(e){let{content:t,children:i,leading:o,trailing:l=(0,a.tZ)(c.Z,{size:20}),priority:s="primary"}=e,[d,u,p]=(0,h.XI)(),{triggerProps:m,layerProps:v,renderLayer:b}=(0,h.sJ)({isOpen:d,onParentClose:p,auto:!0,snap:!0,placement:"right-start",possiblePlacements:["left-start","right-start","left-end","right-end"],triggerOffset:0});return(0,a.BX)(a.HY,{children:[(0,a.tZ)(N,(0,r._)((0,n._)({},u,m),{onClick:e=>{e.preventDefault()},leading:o,trailing:l,priority:s,children:t})),d&&b((0,a.tZ)(g.xu,(0,r._)((0,n._)({},v,u),{children:(0,a.tZ)(I,{className:S.Z.submenu,padding:4,bg:"elevated",children:i})})))]})}function A(e){let{title:t,children:i,isFirst:n=!1}=e;return(0,a.BX)(y.tu,{gap:2,children:[!n&&(0,a.tZ)(b.iz,{paddingY:4,pullX:4}),t&&(0,a.tZ)(R,{children:t}),i]})}function D(e){let{priority:t,children:i}=e;return(0,a.tZ)(C.xv.B4,{color:"destructive"===t?"accent-red":"accent"===t?"pub-accent":t,weight:"medium",align:"left",flex:"grow",children:i})}function R(e){let{children:t}=e;return(0,a.tZ)(C.xv.B5,{transform:"uppercase",color:"secondary",weight:"regular",paddingX:4,paddingTop:4,children:t})}function F(e){let{children:t}=e;return(0,a.BX)(a.HY,{children:[(0,a.tZ)(y.tu,{paddingY:4,paddingX:8,children:(0,a.tZ)(C.xv.B4,{color:"secondary",children:t})}),(0,a.tZ)(b.iz,{pullX:8})]})}function L(e){let{children:t}=e;return(0,a.tZ)(A,{children:(0,a.tZ)(y.tu,{paddingY:4,paddingX:8,children:(0,a.tZ)(C.xv.B5,{color:"secondary",children:t})})})}function z(e){let{Theme:t,children:i}=e;return t?(0,a.tZ)(t,{children:i}):i}function O(e){let{children:t,subtitle:i,onClick:n,onMouseEnter:r,closeMenu:o,leading:l,trailing:s,href:d,target:c,className:p,disabled:h=!1,selected:m=!1,native:g=!1,rel:v,download:b,hiddenInput:f,ref:_,useMobileBottomSheet:Z}=e;return(0,a.tZ)(N,{onClick:n,onMouseEnter:r,closeMenu:o,leading:l,trailing:m?(0,a.tZ)(u.Z,{}):s,href:d,target:c,className:p,disabled:h,native:g,rel:v,download:b,hiddenInput:f,ref:_,useMobileBottomSheet:Z,children:(0,a.BX)(y.sg,{alignItems:"start",children:[(0,a.tZ)(C.xv,{weight:"bold",color:"primary",children:t}),(0,a.tZ)(C.xv.B4,{color:"secondary",children:i})]})})}},43570:function(e,t,i){i.d(t,{D7:()=>Z,NH:()=>y,Vp:()=>_,Wm:()=>C});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(94184),s=i.n(l),d=i(37513),c=i(42861),u=i(5463),p=i(98661),h=i(15771),m=i(19081),g=i(58175),v=i(76641),b=i(66327);let y={size:14,strokeWidth:2.5},f={display:"flex",height:20,paddingX:6,paddingY:2,gap:4,fontSize:11,fontWeight:"medium",alignItems:"center"},_=(0,p.forwardRef)((e,t)=>{var{className:i,theme:l="default",priority:d="secondary",leading:c,trailing:u,children:p,fillIcon:g,radius:v="xs",onClick:y,href:_}=e,Z=(0,o._)(e,["className","theme","priority","leading","trailing","children","fillIcon","radius","onClick","href"]);let w=void 0!==y||void 0!==_;return(0,a.BX)(h.kG,(0,r._)((0,n._)((0,r._)((0,n._)({},Z),{className:s()(i,b.Z.tag,b.Z["theme_".concat(l)],b.Z["priority_".concat(d)],w&&b.Z.clickable),onClick:y,href:_,ref:t,radius:v,cursor:w?"pointer":"inherit",tabIndex:w?0:-1}),f),{children:[c&&(0,a.tZ)(m.hs,{className:s()(b.Z.leading,g&&b.Z.fillIcon),alignItems:"center",children:c}),p,u&&(0,a.tZ)(m.hs,{className:s()(b.Z.trailing,g&&b.Z.fillIcon),alignItems:"center",children:u})]}))}),Z=(0,p.forwardRef)((e,t)=>{var{className:i,priority:l="primary",leading:d,trailing:c,children:u,fillIcon:p,radius:g="xs",onClick:v,href:y}=e,_=(0,o._)(e,["className","priority","leading","trailing","children","fillIcon","radius","onClick","href"]);let Z=void 0!==v||void 0!==y;return(0,a.BX)(h.kG,(0,r._)((0,n._)((0,r._)((0,n._)({},_),{className:s()(i,b.Z.tag,b.Z.media,b.Z["priority_".concat(l)],Z&&b.Z.clickable),onClick:v,href:y,ref:t,radius:g,cursor:Z?"pointer":"inherit",tabIndex:Z?0:-1}),f),{children:[d&&(0,a.tZ)(m.hs,{className:s()(b.Z.leading,p&&b.Z.fillIcon),alignItems:"center",children:d}),u,c&&(0,a.tZ)(m.hs,{className:s()(b.Z.trailing,p&&b.Z.fillIcon),alignItems:"center",children:c})]}))});Z.displayName="MediaTag";let w={color:"var(--color-fg-secondary)"};function C(e){let{value:t,format:i,currency:r,currencyIsCents:o,suffix:l}=e;if(!t)return null;let s=t>0,p=t<0,h=(0,v.L)(t,i,r,o,"tag"),m=s?(0,a.tZ)(d.Z,(0,n._)({},y)):p?(0,a.tZ)(c.Z,(0,n._)({},y,w)):(0,a.tZ)(u.Z,(0,n._)({},y,w));return(0,a.tZ)(_,{theme:s?"success":"default",priority:"secondary",leading:m,children:(0,a.BX)(g.Zx,{color:s?void 0:"secondary",children:[h," ",l]})})}},95901:function(e,t,i){i.d(t,{P:()=>s,h:()=>d});var n=i(7409),r=i(99282),o=i(16584),a=i(71375),l=i(15771);function s(e){return(0,o.tZ)(l.GI,(0,r._)((0,n._)({rounded:!0},e),{children:(0,o.tZ)(a.Z,{size:20})}))}function d(e){return(0,o.tZ)(l.hU,(0,r._)((0,n._)({rounded:!0},e),{children:(0,o.tZ)(a.Z,{size:20})}))}},80026:function(e,t,i){i.d(t,{Av:()=>l.A,E7:()=>r.E7,GI:()=>n.GI,M5:()=>o.M5,X2:()=>o.X2,ZC:()=>s.ZC,et:()=>a.et,gq:()=>o.gq,hU:()=>n.hU,hh:()=>a.hh,hs:()=>o.hs,iz:()=>s.iz,kG:()=>n.kG,oB:()=>r.oB,sg:()=>o.sg,tu:()=>o.tu,xu:()=>r.xu,xv:()=>a.xv,zo:()=>r.zo,zx:()=>n.zx});var n=i(15771),r=i(71068),o=i(19081),a=i(58175),l=i(91021),s=i(61254)},87185:function(e,t,i){i.d(t,{m:()=>a});var n=i(16584),r=i(54278),o=i(17688);let a=e=>{let{details:t,helpText:i,label:a,name:l,options:s,paddingBottom:d,paddingTop:c,flex:u,value:p,disabled:h,onChange:m}=e;return(0,n.tZ)(r.g,{label:a,details:t,helpText:i,paddingTop:c,paddingBottom:d,flex:u,wrapWithLabel:!0,children:(0,n.tZ)(o.i,{name:l,value:p,onChange:e=>{let t=e.target;m(t.value,{name:t.name})},disabled:h,children:s.map(e=>(0,n.tZ)("option",{value:e.value,children:e.label},e.value))})})}},31892:function(e,t,i){i.d(t,{M5:()=>a,X2:()=>r,sg:()=>o});var n=i(71068);let r=(0,n.zo)({display:"flex"}),o=(0,n.zo)({display:"flex",direction:"column"}),a=(0,n.zo)({display:"flex",justifyContent:"center",alignItems:"center"})},17564:function(e,t,i){i.d(t,{S:()=>l});var n=i(16584),r=i(94184),o=i.n(r),a=i(12517);let l=e=>{let{animated:t=!0,width:i,height:r,aspectRatio:l,className:s,multiply:d}=e,c=o()(a.Z.container,s,{[a.Z.containerAnimated]:t,[a.Z.containerMultiply]:d});return l?(0,n.tZ)("div",{style:"aspect-ratio:".concat(l),children:(0,n.tZ)("div",{className:c,style:{width:i,height:null!=r?r:"100%"}})}):(0,n.tZ)("div",{className:c,style:{width:i,height:r}})}},9450:function(e,t,i){i.d(t,{E:()=>u,m:()=>p});var n=i(16584),r=i(94184),o=i.n(r),a=i(20042),l=i(15771),s=i(19081),d=i(58175);let c={tabGroup:"tabGroup-JMjIOW",large:"large-uOBgTi",small:"small-SmRAaE",tab:"tab-vDUfFK",tabButton:"tabButton-rlJuxr",tabLink:"tabLink-_Je2nx",active:"active-eC7E3M"},u=e=>{let{title:t,href:i,isActive:r,onClick:s,disabled:u=!1}=e;if(!i&&!s)throw Error("You must supply either href or onClick");return s?(0,n.tZ)(l.zx,{rounded:!1,disabled:u,priority:"secondary",className:o()(c.tab,c.tabButton,{[c.active]:r}),onClick:s,children:t}):(0,n.tZ)(d.xv.B4,{weight:"medium",color:r?"primary":"secondary",className:o()(c.tab,c.tabLink,{[c.active]:r}),children:(0,n.tZ)(a.Link,{href:i,children:t})})},p=e=>{let{children:t,size:i="large"}=e;return(0,n.tZ)(s.gq,{alignItems:"end",gap:8,borderBottom:"detail",className:o()(c.tabGroup,c[i]),children:t})}},21200:function(e,t,i){i.d(t,{p:()=>n});let n=(0,i(6400).createContext)("")},11280:function(e,t,i){i.d(t,{Uo:()=>w,ZR:()=>y,_R:()=>b,dk:()=>_,he:()=>C,sY:()=>Z,xQ:()=>f});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(52307),s=i(93783),d=i(71068),c=i(15771),u=i(61254),p=i(19081),h=i(58175),m=i(21200),g=i(91400),v=i(60308);i(80188);let b=e=>{var t,{title:i,children:s,id:d,pub:g,withSubdomainLink:b}=e,y=(0,o._)(e,["title","children","id","pub","withSubdomainLink"]);return(0,a.tZ)(m.p.Provider,{value:null!=i?i:"",children:(0,a.tZ)(p.tu,{gap:12,id:d,paddingTop:{desktop:20,mobile:8},children:(0,a.BX)(p.tu,(0,r._)((0,n._)({radius:"sm",bg:"primary",shadow:"xs",border:"detail"},y),{children:[(0,a.BX)(p.gq,{alignItems:"center",justifyContent:"space-between",gap:8,padding:20,children:[(0,a.tZ)(h.xv.B2,{weight:"bold",children:i}),g&&b&&(0,a.tZ)(c.zx,{href:(0,v.TJI)(g),newTab:!0,priority:"secondary",size:"sm",leading:(0,a.tZ)(l.Z,{size:16}),children:(0,a.tZ)(h.xv.B4,{color:"primary",children:null!==(t=g.custom_domain)&&void 0!==t?t:"".concat(g.subdomain,".substack.com")})})]}),(0,a.tZ)(u.iz,{}),(0,a.tZ)(p.tu,{gap:20,padding:20,children:s})]}))})})},y=e=>{let{id:t,children:i}=e;return(0,a.tZ)(p.gq,{justifyContent:"space-between",alignItems:"center",id:t,gap:24,minHeight:48,children:i})},f=e=>{let{id:t,children:i}=e;return(0,a.tZ)(p.tu,{id:t,gap:8,children:i})},_=e=>{let{id:t,children:i}=e,n=(0,g.XA)();return(0,a.tZ)(p.hs,{direction:n?"column":"row",alignItems:n?"stretch":"center",id:t,gap:n?12:20,minHeight:48,children:i})},Z=e=>{let{primaryText:t,secondaryText:i}=e;return(0,a.BX)(p.tu,{gap:2,flex:"grow",children:[(0,a.tZ)(h.xv.B4,{weight:"semibold",children:t}),i&&(0,a.tZ)(h.xv.B4,{color:"secondary",children:i})]})},w=e=>{let{title:t,children:i}=e;return(0,a.BX)(s.t5,{children:[(0,a.tZ)(u.iz,{pullX:20}),(0,a.tZ)(p.tu,{gap:12,children:(0,a.BX)(p.gq,{justifyContent:"space-between",alignItems:"center",height:24,children:[(0,a.tZ)(h.xv.B2,{weight:"bold",children:t}),i]})})]})},C=(0,d.zo)({display:"flex",direction:"column",gap:20,paddingLeft:{desktop:20,mobile:12},borderLeft:"detail"})},6630:function(e,t,i){i.d(t,{Z:()=>u,o:()=>c});var n=i(16584),r=i(94184),o=i.n(r),a=i(15771),l=i(19081),s=i(58175),d=i(87089);let c=e=>{let{min:t,max:i,value:r,onChange:o}=e,a=[];for(let e=t;e<=i;e++)a.push(e);return(0,n.tZ)(l.gq,{gap:8,children:a.map(e=>(0,n.tZ)(p,{onClick:()=>{o(e)},selected:e===r,children:e}))})},u=e=>{let{options:t,value:i,onChange:r}=e;return(0,n.tZ)(l.gq,{gap:4,children:t.map(e=>{let t="string"==typeof e?e:e.value;return(0,n.tZ)(p,{onClick:()=>{r(t)},selected:t===i,children:"string"==typeof e?e:(0,n.BX)(l.gq,{alignItems:"center",gap:8,paddingY:4,children:[e.icon?e.icon:null,e.label]})},t)})})},p=e=>{let{children:t,selected:i,onClick:r}=e;return(0,n.tZ)(a.kG,{resetCss:!0,onClick:r,children:(0,n.tZ)(s.xv.B4,{className:o()(d.Z.pill,{[d.Z.pillSelected]:i}),children:t})})}},11672:function(e,t,i){let n,r;var o,a,l,s,d,c,u,p,h,m,g,v,b,y=i(35702),f=i(7409),_=i(99282),Z=i(16584),w=i(6400),C=i(59143),x=i(90547),S=i(94184),k=i.n(S),B=i(20042),T=i(56232),I=i(80569),N=i.n(I),P=i(42694),E=i(66328),X=i(32351),M=i(27412),A=i(30396),D=i(34835),R=(i(77187),i(74937)),F=(i(30379),i(98435)),L=i(93666),z=i(51014),O=i(49995),U=i(68833),Y=i(98914),H=i(98012),j=i(60308),J=i(47929);let V=e=>{let t,{post:i,user:n,pub:r,isAlreadyPublished:o,scheduledFor:a,audience:l}=e,[s,d]=(0,A.eJ)(!1);if(s)return null;if(o)t="Now it's time to get the word out.";else{let e,i;e=a?(0,H.Z)(a).fromNow():"soon",i="everyone"===l?"Your whole list":"founding"===l?"Founding members":"only_paid"===l?"Your subscribers":"only_free"===l?"Your free readers":"Your readers",t="".concat(i," should receive this post ").concat(e)}return(0,Z.BX)("div",{className:"congrats-box",children:[(0,Z.BX)("div",{className:"congrats-box-left",children:[(0,Z.tZ)("div",{className:"star",children:(0,Z.tZ)(D.Z,{fill:"#1C110B",stroke:"#1C110B",strokeWidth:0})}),(0,Z.BX)("div",{className:"text",children:[(0,Z.BX)("h4",{children:["Your post has been ",o?"published":"scheduled","!"]}),(0,Z.tZ)("h5",{children:t})]})]}),(0,Z.BX)("div",{className:"congrats-box-right",children:[o?(0,Z.tZ)(q,{user:n,pub:r,post:i}):null,(0,Z.tZ)("button",{className:"button secondary",style:{fontWeight:500},onClick:()=>d(!0),children:"Dismiss"})]})]})},q=e=>{let{user:t,pub:i,post:n}=e,r=(0,A.sO)(null);return(0,Z.BX)(w.Fragment,{children:[(0,Z.tZ)("button",{className:"button primary",style:{fontWeight:500},onClick:()=>{r.current&&r.current.open()},children:"Share"}),(0,Z.tZ)(z.ZP,{ref:r,user:t,pub:i,post:n})]})};L.Z;var W=i(10605),G=i(58865),K=i(71375),Q=i(95441),$=i(62981),ee=i(15771),et=i(19081),ei=i(58175),en=i(63651),er=i(84864),eo=i(37175);let ea={container:"container-nnoSIn",banner:"banner-H2qnjs",priority_default:"priority_default-rFfaAY",priorityDefault:"priority_default-rFfaAY",close:"close-DC4nhL",priority_substack:"priority_substack-VD_Ce1",prioritySubstack:"priority_substack-VD_Ce1",closeIcon:"closeIcon-hQ1dNm",priority_select:"priority_select-yS8U_b",prioritySelect:"priority_select-yS8U_b",priority_success:"priority_success-gylIPx",prioritySuccess:"priority_success-gylIPx",priority_warn:"priority_warn-UHw2az",priorityWarn:"priority_warn-UHw2az",priority_error:"priority_error-k8coHg",priorityError:"priority_error-k8coHg"};function el(){let e=(0,G._)(["Substack will undergo planned maintenance on Thursday, December 26, from 20:00-21:00 PST. During this hour, the site will be temporarily unavailable, and publishing from the app will also be disabled. For more information, check ","."]);return el=function(){return e},e}function es(){let e=(0,G._)(["Alert: Beware of phishing attempts. We have been notified of unauthorized emails claiming to be from Substack's team. Please remember, we will never change your account information without your express authorization. Double-check the sender's address and report any suspicious emails to our Standards and Enforcement team at ","."]);return es=function(){return e},e}function ed(){let e=(0,G._)(["Your payments appear to be blocked on Stripe. Check "," for instructions on how to resolve this."]);return ed=function(){return e},e}function ec(){let e=(0,G._)(["","","","."]);return ec=function(){return e},e}var eu=((o={}).DatabaseMaintenance="{database_maintenance}",o.PlannedMaintenance="{planned_maintenance}",o.PhishingWarning="{phishing_warning}",o.StripePaymentsBlocked="{stripe_payments_blocked}",o.PublicationBanned="{publication_banned}",o);function ep(e){let{pub:t,banners:i,flagged_reason:n}=e,{iString:r,iTemplate:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)([]);(0,A.d4)(()=>{Promise.all(i.map(em)).then(e=>l(e))},[i]);let s=(0,A.Ye)(()=>{for(let[e,t]of a.entries())if(t&&!(0,$.f)(t,604800))return e;return -1},[a]);if(s<0)return null;let d=a[s];switch(i[s]){case"{database_maintenance}":return eh({pub:t,text:r("We are performing maintenance on the database powering the publisher dashboard. Subscription count and subscriber dashboard data may be missing or out of date."),priority:"warn",key:d});case"{planned_maintenance}":{let e="[".concat(r("the status page"),"](https://substack.statuspage.io/)");return eh({pub:t,text:o(el(),e),priority:"warn",key:d})}case"{phishing_warning}":return eh({pub:t,text:o(es(),"[tos@substackinc.com](mailto:tos@substackinc.com)"),priority:"warn",key:d});case"{stripe_payments_blocked}":{let e="[".concat(r("your Stripe dashboard"),"]({stripe_dashboard_url})");return eh({pub:t,text:o(ed(),e),priority:"error",key:d})}case"{publication_banned}":{let e="[".concat(r("here"),"](").concat(j.Y9U,")");return eh({pub:t,text:o(ec(),(0,er.getPublicationBanMessage)(n)," ",e&&e),priority:"error",key:d,dismissible:!1})}default:return eh({pub:t,text:i[s],priority:"substack",key:d})}}function eh(e){let{pub:t,text:i,priority:n="default",key:r,dismissible:o=!0}=e,a=(0,A.Ye)(()=>{var e,n;return(0,eo.toHtml)((e=i,n=t,e.replace("{base_url}",(0,j.SVA)(n)).replace("{stripe_dashboard_url}",(0,en.AKp)(n))),!0,{pubId:t.id,transform:e=>{for(let t of e.getElementsByTagName("a"))t.target="_blank"}})},[i,t]),[l,s]=(0,$.Z)(r,604800);return!i||!a||!r||r&&l&&o?null:(0,Z.tZ)(et.tu,{className:ea.container,children:(0,Z.BX)(et.gq,{flex:"grow",gap:12,paddingX:16,paddingY:12,className:k()(ea.banner,ea["priority_".concat(n)]),alignItems:"center",radius:"md",children:[(0,Z.tZ)(ei.xv.B3,{className:ea.text,weight:"medium",flex:"grow",children:(0,Z.tZ)("div",{dangerouslySetInnerHTML:{__html:a}})}),o&&(0,Z.tZ)(ee.hU,{priority:"tertiary",size:"sm",onClick:e=>{e.preventDefault(),e.stopPropagation(),s()},className:ea.close,children:(0,Z.tZ)(K.Z,{size:20,className:ea.closeIcon})})]})})}async function em(e){var t;if(!e||"undefined"==typeof window||!(null===(t=crypto)||void 0===t?void 0:t.subtle))return null;let i=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",i))).map(e=>e.toString(16).padStart(2,"0")).join("")}var eg=i(63639);let ev=(0,w.createContext)({publication:{},pub:{},setPublication:e=>{}});ev.displayName="PublishContext";let eb=e=>{let t=t=>{let i=ey();return(0,Z.tZ)(e,(0,f._)({},i,t))};return t.displayName="withPublishContext(".concat(e.name||e.displayName||"Anonymous",")"),t};function ey(){return(0,A.qp)(ev)}var ef=i(98848),e_=i(51584),eZ=i.n(e_),ew=i(18446),eC=i.n(ew),ex=i(14293),eS=i.n(ex),ek=i(43174),eB=i.n(ek),eT=i(78718),eI=i.n(eT),eN=i(24830),eP=i(67669),eE=i(25380),eX=i(72910),eM=i(13639),eA=i(84488),eD=i(78796),eR=i(92027),eF=i(60484),eL=i(7073),ez=i(2564),eO=i(62372),eU=i(70075),eY=i(86790),eH=i(64515);let ej=e=>(0,Z.tZ)(eH.l,(0,_._)((0,f._)({},e),{name:"AddUserButtonIcon",svgParams:{viewBox:"0 0 40 40",height:40,width:40,fill:"none"},children:(0,Z.BX)("g",{children:[(0,Z.tZ)("circle",{cx:"20",cy:"20",r:"20"}),(0,Z.tZ)("path",{className:"add-user-button-icon-cross",d:"M20 14 V26 M14 20 H26","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",stroke:e.stroke})]})}));var eJ=i(13304),eV=i(92798),eq=i(14952),eW=i(49762),eG=i(94874),eK=i(6490);let eQ={"user-selector":"user-selector-wzik6d",userSelector:"user-selector-wzik6d","user-selector-expanded":"user-selector-expanded-wQjwNW",userSelectorExpanded:"user-selector-expanded-wQjwNW",disabled:"disabled-CKfyLi","no-selected-bylines":"no-selected-bylines-QoxUIG",noSelectedBylines:"no-selected-bylines-QoxUIG","user-selector-new":"user-selector-new-OuEGmR",userSelectorNew:"user-selector-new-OuEGmR","add-user-button":"add-user-button-zggfrL",addUserButton:"add-user-button-zggfrL","selector-by-label":"selector-by-label-PpqVpM",selectorByLabel:"selector-by-label-PpqVpM","user-selector-row":"user-selector-row-oBoD5o",userSelectorRow:"user-selector-row-oBoD5o","selected-user-name":"selected-user-name-XMHu37",selectedUserName:"selected-user-name-XMHu37",selected:"selected-PAG2BA",invited:"invited-Q2LfvU","remove-user-icon":"remove-user-icon-N2wa37",removeUserIcon:"remove-user-icon-N2wa37","remove-user-icon-expanded":"remove-user-icon-expanded-xoy5Ck",removeUserIconExpanded:"remove-user-icon-expanded-xoy5Ck","remove-user-link":"remove-user-link-EYT3Ne",removeUserLink:"remove-user-link-EYT3Ne","dropdown-menu-wrapper":"dropdown-menu-wrapper-hw30dW",dropdownMenuWrapper:"dropdown-menu-wrapper-hw30dW","user-photo":"user-photo-ZK8bGM",userPhoto:"user-photo-ZK8bGM","user-photo-expanded":"user-photo-expanded-torOYn",userPhotoExpanded:"user-photo-expanded-torOYn","new-user-link":"new-user-link-dyFPSe",newUserLink:"new-user-link-dyFPSe","invite-guest-input":"invite-guest-input-NWLlEy",inviteGuestInput:"invite-guest-input-NWLlEy","invite-guest-input-field":"invite-guest-input-field-uPkFLW",inviteGuestInputField:"invite-guest-input-field-uPkFLW","dropdown-menu":"dropdown-menu-Hyc5oj",dropdownMenu:"dropdown-menu-Hyc5oj","rotate-plus":"rotate-plus-RUUlEZ",rotatePlus:"rotate-plus-RUUlEZ","add-user-button-icon":"add-user-button-icon-ep0RPb",addUserButtonIcon:"add-user-button-icon-ep0RPb","add-user-button-icon-cross":"add-user-button-icon-cross-KudFoi",addUserButtonIconCross:"add-user-button-icon-cross-KudFoi","invite-blurb":"invite-blurb-dj3Sm0",inviteBlurb:"invite-blurb-dj3Sm0"};function e$(){let e=(0,G._)(["Add "," as a guest"]);return e$=function(){return e},e}let e0=/.@./;class e1 extends w.Component{render(){let{className:e,isDisabled:t,expandedView:i,postType:n,scrollContainer:r,bylines:o=[],pendingInvites:a=[]}=this.props,l=a.map(e=>Number(e.user_id)),s=o.filter(e=>!l.includes(e.user_id)),d=(0,eW.default)("publication_max_bylines")||er.DEFAULT_MAX_BYLINES,c=s.length+a.length<d;return(0,Z.tZ)("div",{"data-testid":"user-selector",className:k()(eQ["user-selector"],e,{[eQ["no-selected-bylines"]]:!s.length&&!a.length,[eQ.disabled]:t}),children:i?(0,Z.tZ)(e4,{onSelect:this.selectUserId,pendingInvites:a,unselect:this.unselect,onInviteDetails:(e,t)=>this.inviteEmail(e,t),removeInvitation:this.removeInvitation,bylines:s.map(e=>(0,_._)((0,f._)({},e),{invitePending:!1})),postType:n,scrollContainer:r}):(0,Z.BX)(Z.HY,{children:[s.map(e=>(0,Z.tZ)(e3,{byline:(0,_._)((0,f._)({},e),{invitePending:!1}),onUnselect:()=>this.unselect((0,_._)((0,f._)({},e),{invitePending:!1}))})),a.map(e=>{let{id:t,user:i,acceptance_required:n}=e;return(0,Z.tZ)(e9,{name:null==i?void 0:i.name,email:null==i?void 0:i.name,acceptanceRequired:n,onUninvite:()=>this.removeInvitation(t)})}),c&&(0,Z.tZ)(e7,{onSelect:this.selectUserId,onInviteDetails:(e,t)=>this.inviteEmail(e,t),selected:s,postType:n,scrollContainer:r})]})})}constructor(...e){super(...e),(0,M._)(this,"inviteEmail",async(e,t)=>{let{postId:i}=this.props;try{var n,r;if(!i&&this.props.setPostId&&await this.props.setPostId(),!i)return;let o=await N().post("/api/v1/publication_user_invite/").send({email:e,name:t,post_id:i}),{user_id:a}=o.body;null===(n=(r=this.props).onChange)||void 0===n||n.call(r,[...this.props.bylines,{is_guest:!0,is_draft:!0,user_id:a,user:{id:a,name:null!=t?t:null}}],this.props.pendingInvites.concat([o.body]))}catch(t){let e=(0,Y.zx)(t);throw e&&alert(e),t}}),(0,M._)(this,"removeInvitation",async e=>{try{await N().delete("/api/v1/publication_user_invite/".concat(e));let n=this.props.pendingInvites.find(t=>t.id===e);if(n){var t,i;null===(t=(i=this.props).onChange)||void 0===t||t.call(i,this.props.bylines.filter(e=>e.user_id!==Number(n.user_id)),this.props.pendingInvites.filter(t=>t.id!==e))}}catch(t){let e=(0,Y.zx)(t);if(e)alert(e);else throw t}}),(0,M._)(this,"unselect",async e=>{var t,i,n;if(e.invitePending){let t=null===(n=this.props.pendingInvites.find(t=>Number(t.user_id)===e.user_id))||void 0===n?void 0:n.id;if(t)await this.removeInvitation(t);else throw Error("Could not find invite for user ".concat(e.user_id))}null===(t=(i=this.props).onChange)||void 0===t||t.call(i,this.props.bylines.filter(t=>t.user_id!==e.user_id),this.props.pendingInvites)}),(0,M._)(this,"selectUserId",async e=>{let{iString:t}=this.props,i=this.props.postId;try{var n,r,o;if(!i&&this.props.setPostId&&(i=await this.props.setPostId()),this.props.bylines.some(t=>t.user_id===e)){alert(t("This user has already been added as a guest."));return}let{userProfile:a,invite:l}=(await N().post("/api/v1/publication_user_invite/add_byline_by_user_id").send({user_id:e,post_id:this.props.postId})).body,s={user_id:a.id,is_guest:null!==(o=a.is_byline_only)&&void 0!==o&&o,is_draft:!0,user:a,invitePending:!!l};null===(n=(r=this.props).onChange)||void 0===n||n.call(r,this.props.bylines.concat([s]),l?this.props.pendingInvites.concat([(0,_._)((0,f._)({},l),{user:s.user})]):this.props.pendingInvites)}catch(t){let e=(0,Y.zx)(t);if(e)alert(e);else throw t}})}}let e2=(0,Q.fz)(e1),e4=e=>{let{onSelect:t,unselect:i,onInviteDetails:n,removeInvitation:r,bylines:o,pendingInvites:a,postType:l,scrollContainer:s}=e,d=o.map(e=>({name:e.user.name,row:(0,Z.tZ)(e8,{byline:e,onUnselect:()=>i(e)})})).sort((e,t)=>(e.name||"").localeCompare(t.name||"")).map(e=>e.row);return(0,Z.BX)("div",{className:eQ["user-selector-expanded"],children:[(0,Z.tZ)(ti,{onInviteDetails:async(e,t)=>{await n(e,t)},onSelect:t,postType:l,scrollContainer:s,includeHeader:!1}),d,a.map(e=>{let{id:t,name:i,email:n}=e;return(0,Z.tZ)(e6,{name:i,email:n,onUninvite:()=>r(t)})})]})},e3=e=>{let{byline:t,onUnselect:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)("span",{className:k()(eQ["user-selector-row"],{[eQ.selected]:!t.invitePending,[eQ.pending]:t.invitePending}),onClick:()=>i(t.user),children:[(0,Z.BX)("span",{className:eQ["selected-user-name"],children:[t.user.name,t.invitePending?" ".concat(n("(pending)")):""]}),(0,Z.tZ)("a",{className:eQ["remove-user-link"],href:"javascript:void(0)",children:(0,Z.tZ)(eJ.Z,{className:eQ["remove-user-icon"],height:20})})]})},e8=e=>{let{byline:t,onUnselect:i}=e,{user:n}=t;return(0,Z.BX)(et.gq,{alignItems:"center",gap:12,children:[(0,Z.tZ)(eG.qE,{user:n,size:32}),(0,Z.BX)(et.tu,{ellipsis:!0,children:[(0,Z.tZ)(ei.xv.B4,{weight:"bold",children:"".concat(n.name||n.email)}),t.invitePending&&(0,Z.tZ)(ei.xv.B5,{color:"secondary",translated:!0,children:"invitation pending"})]}),(0,Z.tZ)(eJ.Z,{className:eQ["remove-user-icon-expanded"],onClick:()=>i(n),height:20})]})},e6=e=>{let{name:t,email:i,onUninvite:n}=e;return(0,Z.BX)(et.gq,{alignItems:"center",gap:12,children:[(0,Z.tZ)(eG.qE,{photoUrl:j.zUJ,size:32}),(0,Z.BX)(et.tu,{ellipsis:!0,children:[(0,Z.tZ)(ei.xv.B4,{weight:"bold",children:t||i}),(0,Z.tZ)(ei.xv.B5,{color:"secondary",translated:!0,children:"invitation pending"})]}),(0,Z.tZ)(eJ.Z,{className:eQ["remove-user-icon-expanded"],onClick:()=>n(),height:20})]})},e5=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.BX)("span",{className:k()(eQ["user-selector-row"],eQ.selected),children:[(0,Z.tZ)("span",{className:eQ["selected-user-name"],children:e("Choose author")}),(0,Z.tZ)("a",{className:eQ["remove-user-link"],href:"javascript:void(0)",children:(0,Z.tZ)(eV.Z,{className:eQ["remove-user-icon"]})})]})},e9=e=>{let{name:t,email:i,acceptanceRequired:n,onUninvite:r}=e,{iString:o}=(0,Q.M1)();return(0,Z.BX)("span",{className:k()(eQ["user-selector-row"],eQ.invited),onClick:()=>r(i),children:[(0,Z.BX)("span",{className:eQ["selected-user-name"],children:[t||i," ",n?o("(pending)"):""]}),(0,Z.tZ)("a",{className:eQ["remove-user-link"],href:"javascript:void(0)",children:(0,Z.tZ)(eJ.Z,{className:eQ["remove-user-icon"],height:20})})]})},e7=e=>{let{onInviteDetails:t,onSelect:i,selected:n,postType:r,scrollContainer:o}=e,a=(0,A.sO)(null),[l,s]=(0,A.eJ)(!1),d=n.length>0?()=>(0,Z.tZ)(ej,{className:k()(eQ["add-user-button-icon"],{[eQ["rotate-plus"]]:l}),height:40,stroke:"var(--color-fg-secondary)"}):e5;return(0,Z.BX)("span",{className:eQ["user-selector-new"],children:[(0,Z.tZ)("div",{className:eQ["add-user-button"],onClick:()=>{a.current&&a.current.toggle()},children:(0,Z.tZ)(d,{})}),(0,Z.tZ)(eY.ZP,{wrapperClassName:eQ["dropdown-menu-wrapper"],className:eQ["dropdown-menu"],ref:a,onToggle:()=>a.current&&s(a.current.isOpen()),noTail:!0,children:(0,Z.tZ)(ti,{onInviteDetails:async(e,i)=>{await t(e,i),a.current&&a.current.close()},onSelect:i,isOpenDropdown:l,postType:r,scrollContainer:o})})]})},te={},tt=async(e,t)=>{if(te[e])return te[e];let{iString:i}=I18N.i(t),{users:n,contributors:r}=(await N().get("/api/v1/posts/search_users_for_byline").query({query:e})).body,o=new Map;return r&&r.length>0&&o.set(i("Contributors"),r.map(e=>({name:e.name,id:e.id,type:"user",photo_url:e.photo_url,publications:[],meta:e.role||"owner"}))),n&&n.length>0&&o.set(i("People"),n.map(e=>(0,_._)((0,f._)({},e),{type:"user"}))),te[e]=o,o},ti=e=>{let{onInviteDetails:t,onSelect:i,isOpenDropdown:n,postType:r,scrollContainer:o,includeHeader:a=!0}=e,l=(0,eq.Ij)(),s=(0,A.sO)(null),d=(0,A.sO)(null),{iString:c,iTemplate:u,language:p}=(0,Q.M1)(),[h,m]=(0,A.eJ)(!1),[g,v]=(0,A.eJ)(new Map),[b,y]=(0,A.eJ)(!1),[w,C]=(0,A.eJ)(!1),[x,S]=(0,A.eJ)(!1),[B,T]=(0,A.eJ)(!1),[I,N]=(0,A.eJ)(void 0),[P,E]=(0,A.eJ)(null),{triggerProps:X,layerProps:M,renderLayer:D}=(0,eO.sJ)({isOpen:B,overflowContainer:!1,trigger:{getBounds:()=>{var e;return(null===(e=s.current)||void 0===e?void 0:e.getBoundingClientRect())||{top:0,left:0,width:0,height:0}},getParent:o},placement:"bottom-start",triggerOffset:4}),R=(0,A.I4)(async()=>{if(s.current){var e;let t=null===(e=s.current)||void 0===e?void 0:e.value,i=e0.test(t);m(i),i?T(!1):(S(!0),T(!0),N(t),v(await tt(t,p)),S(!1))}},[m,s,v,S,T,N]),F=(0,A.I4)(()=>{R()},[R]),L=async e=>{if(t&&s.current)try{C(!0),await t(s.current.value,e),s.current.value=""}catch(e){}finally{C(!1)}},z=(0,A.I4)(e=>{var t;let i=null===(t=d.current)||void 0===t?void 0:t.getElement(),n=e.nativeEvent.relatedTarget;!B||(null==i?void 0:i.contains(n))||T(!1)},[B]),O=(0,A.I4)(e=>{T(!0),e.stopPropagation()},[]);(0,A.d4)(()=>{!0===n&&s.current?(s.current.focus(),s.current.value=""):!1===n&&s.current&&(s.current.blur(),T(!1))},[n,s]);let U=e=>{i(e),E(null),s.current&&(s.current.value="")},Y=()=>{E(null)},H=()=>{(null==l?void 0:l.tier)===2?y(!0):L(null)};return(0,Z.BX)(Z.HY,{children:[a&&(0,Z.BX)("div",{className:eQ["invite-blurb"],children:[(0,Z.tZ)(ei.xv.B2,{weight:"semibold",color:"primary",paddingBottom:8,children:c("podcast"===r?"Add hosts and guests":"Add a guest byline")}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:c("podcast"===r?"Add participants for a more accurate transcription and visibility on platforms like Apple and Spotify. We'll notify them via email.":"Collaborating on this post? List your collaborators in the byline. We will notify them via email.")})]}),(0,Z.tZ)("div",(0,_._)((0,f._)({className:eQ["invite-guest-input"]},X),{children:(0,Z.tZ)("input",{className:k()(eQ["invite-guest-input-field"],{[eQ.disabled]:w}),disabled:w,maxLength:300,type:"search",placeholder:c("Find guest by name or email"),ref:s,onChange:R,onFocus:F,onBlur:z,autocomplete:"off",name:"searchEmail",onKeyDown:e=>{if("Escape"===e.key&&T(!1),h&&"Enter"===e.key){H();return}return d.current&&d.current.onKeyDown({event:e})}})})),(0,Z.BX)(eK.u_,{isOpen:!!P,onClose:Y,testId:"confirm-add-guest",children:[P&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{showClose:!1,title:u(e$(),P.name)}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(ei.xv.B3,{translated:!0,paddingTop:16,children:["We will let ",I18N.p(P.name)," know you added them via email."]})})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{P&&U(P.id)},children:c("Add guest and send email")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:Y,children:c("Cancel")})})]}),B&&!h&&D((0,Z.tZ)("div",{onMouseUp:O,ref:M.ref,style:(0,_._)((0,f._)({},M.style),{zIndex:9999}),children:(0,Z.tZ)(eU.c,{ref:d,items:g,isLoading:x,noResultsText:c("No people found"),selectItem:e=>{T(!1),e&&("owner"===e.meta||"admin"===e.meta||"contributor"===e.meta||"byline"===e.meta?U(e.id):E(e))},query:I,language:p})})),h&&(0,Z.tZ)(et.gq,{direction:"row-reverse",children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:H,disabled:w,children:c("Invite")})}),h&&(0,Z.tZ)(tn,{isOpen:b,onClose:()=>y(!1),onSubmit:L})]})},tn=e=>{let{isOpen:t,onSubmit:i,onClose:n}=e,[r,o]=(0,A.eJ)(!0),a=(0,A.sO)(null),l=e=>{i(e),n()},{iString:s}=(0,Q.M1)();return(0,Z.BX)(eK.u_,{isOpen:t,onClose:()=>{o(!0),n()},children:[(0,Z.tZ)(eK.xB,{title:s("What is your guest's name?"),description:s("Let your audience know a bit more about this guest."),showClose:!1}),(0,Z.BX)(eK.fe,{children:[(0,Z.tZ)(et.tu,{paddingBottom:4,children:(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",children:"Name"})}),(0,Z.tZ)(et.tu,{children:(0,Z.tZ)("input",{type:"text",ref:a,onChange:()=>o(!a.current.value),onKeyDown:e=>{"Escape"===e.key&&(e.stopPropagation(),n()),"Enter"===e.key&&(e.stopPropagation(),l(a.current.value))},className:eQ["invite-guest-input-field"],placeholder:s("Type guest's name...")})})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",disabled:r,onClick:()=>l(a.current.value),children:s("Add")})})]})};var tr=i(71993),to=i(98661),ta=i(32224),tl=i(51534),ts=i(71068);let td={iframe:"iframe-GneRvi",mobile:"mobile-ZQR_61",desktopPreview:"desktopPreview-T3mwfK",emailPreview:"emailPreview-xvObeX",mobileBezel:"mobileBezel-ZgIiDV",mobilePreview:"mobilePreview-IJkK4c",emailHeaderRow:"emailHeaderRow-TZlhnB",mobileStatusBar:"mobileStatusBar-pmiM67",mobileTime:"mobileTime-BbDPkO",mobileIsland:"mobileIsland-x3rkQ5",mobileIconFill:"mobileIconFill-EjzBjl",mobileIconStroke:"mobileIconStroke-RaxOJK"},tc=e=>{let{children:t,hidden:i=!1,pub:n}=e;return(0,Z.BX)(et.sg,{className:td.desktopPreview,overflow:"hidden",outline:"detail",position:"relative",flex:"grow",radius:"sm",children:[(0,Z.tZ)(tu,{pub:n}),!i&&t]})},tu=e=>{let{pub:t}=e,i=(0,j.TJI)(t).replace(/^https?:\/\//,"");return(0,Z.BX)(et.hs,{className:td.desktopStatusBar,justifyContent:"space-between",alignItems:"center",sizing:"border-box",padding:12,bg:"secondary",borderBottom:"detail",children:[(0,Z.BX)(et.X2,{gap:8,alignItems:"center",children:[(0,Z.tZ)(ts.xu,{width:12,height:12,radius:"full",outline:"detail",style:{backgroundColor:"#F3605C"}}),(0,Z.tZ)(ts.xu,{width:12,height:12,radius:"full",outline:"detail",style:{backgroundColor:"#F8BE39"}}),(0,Z.tZ)(ts.xu,{width:12,height:12,radius:"full",outline:"detail",style:{backgroundColor:"#50C845"}})]}),(0,Z.BX)(et.hs,{flex:"grow",alignItems:"center",justifyContent:"center",radius:"sm",bg:"tertiary",height:32,gap:4,style:{maxWidth:"540px"},minWidth:0,paddingX:12,overflow:"hidden",children:[(0,Z.tZ)(et.X2,{flex:"auto",children:(0,Z.tZ)(tl.Z,{size:12,color:"var(--color-fg-secondary)"})}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",ellipsis:!0,children:i})]}),(0,Z.tZ)(ee.hU,{size:"sm",priority:"tertiary",disabled:!0,children:(0,Z.tZ)(ta.Z,{size:20})})]})};var tp=i(65575);let th=e=>{let{children:t,hidden:i=!1,pub:n,post:r}=e;return(0,Z.BX)(et.sg,{className:td.emailPreview,overflow:"hidden",border:"detail",borderBottom:"unset",position:"relative",flex:"grow",bg:"primary",children:[(0,Z.tZ)(tm,{pub:n,post:r}),!i&&t]})},tm=e=>{let{pub:t,post:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(et.hs,{className:td.emailStatusBar,justifyContent:"space-between",alignItems:"start",sizing:"border-box",paddingY:20,paddingX:24,bg:"secondary",borderBottom:"detail",children:(0,Z.BX)(et.sg,{gap:4,children:[(0,Z.BX)(ts.xu,{className:td.emailHeaderRow,gap:8,minWidth:0,overflow:"hidden",children:[(0,Z.tZ)(ei.xv.B4,{color:"secondary",weight:"medium",children:n("From:")}),(0,Z.tZ)(ei.xv.B4,{as:"span",children:(0,Z.BX)(et.X2,{gap:4,children:[(0,Z.tZ)(ei.Zx,{color:"primary",weight:"medium",children:t.name}),(0,Z.tZ)(ei.Zx,{color:"secondary",weight:"regular",opacity:70,children:"<".concat(t.subdomain,"@substack.com>")})]})})]}),(0,Z.BX)(ts.xu,{className:td.emailHeaderRow,gap:8,minWidth:0,overflow:"hidden",children:[(0,Z.tZ)(ei.xv.B4,{color:"secondary",weight:"medium",children:n("To:")}),(0,Z.tZ)(ei.xv.B4,{as:"span",children:(0,Z.BX)(et.X2,{gap:4,children:[(0,Z.tZ)(ei.Zx,{color:"primary",weight:"medium",children:"Konstantin Levin"}),(0,Z.tZ)(ei.Zx,{color:"secondary",weight:"regular",opacity:70,children:"<konstantin@example.com>"})]})})]}),(0,Z.BX)(ts.xu,{className:td.emailHeaderRow,gap:8,minWidth:0,overflow:"hidden",children:[(0,Z.tZ)(ei.xv.B4,{color:"secondary",weight:"medium",children:n("Subject:")}),(0,Z.tZ)(ei.xv.B4,{color:"primary",weight:"medium",ellipsis:!0,children:i.title||i.draft_title||"New post"})]})]})})},tg=e=>{let{audience:t,sub:i,openSettings:n}=e;if("everyone"===t)return(0,Z.tZ)(Z.HY,{});let r=t.replace("only_","");return(0,Z.tZ)(et.sg,{"data-testid":"noemail-settings",flex:"grow",alignItems:"center",justifyContent:"center",padding:32,bg:"secondary",children:(0,Z.tZ)(tp._Y,{icon:(0,Z.tZ)(eL.Z,{size:24}),title:"This post is set to ".concat(r,"-only and will not be sent as an email to ").concat(i," subscribers."),action:(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-outline",onClick:()=>n(),children:"Edit settings"})})})},tv=e=>{let{children:t,hidden:i=!1}=e;return(0,Z.tZ)(et.hs,{className:td.mobileBezel,overflow:"hidden",outline:"detail",children:(0,Z.BX)(et.hs,{className:td.mobilePreview,overflow:"hidden",outline:"detail",position:"relative",children:[(0,Z.tZ)(tb,{}),!i&&t]})})},tb=()=>{let e=(0,Z.BX)("svg",{height:"18",viewBox:"0 0 126 20",xmlns:"http://www.w3.org/2000/svg",children:[(0,Z.tZ)("path",{className:td.mobileIconFill,d:"M23.7129 16.311C23.4004 16.311 23.1465 16.2134 22.9512 16.0181C22.7559 15.8276 22.6582 15.5786 22.6582 15.271V12.1582C22.6582 11.8506 22.7559 11.6016 22.9512 11.4111C23.1465 11.2207 23.4004 11.1255 23.7129 11.1255H25.3096C25.627 11.1255 25.8809 11.2207 26.0713 11.4111C26.2666 11.6016 26.3643 11.8506 26.3643 12.1582V15.271C26.3643 15.5786 26.2666 15.8276 26.0713 16.0181C25.8809 16.2134 25.627 16.311 25.3096 16.311H23.7129ZM29.3745 16.311C29.0571 16.311 28.8008 16.2134 28.6055 16.0181C28.415 15.8276 28.3198 15.5786 28.3198 15.271V9.88037C28.3198 9.56787 28.415 9.31641 28.6055 9.12598C28.8008 8.93555 29.0571 8.84033 29.3745 8.84033H30.9712C31.2886 8.84033 31.5425 8.93555 31.7329 9.12598C31.9282 9.31641 32.0259 9.56787 32.0259 9.88037V15.271C32.0259 15.5786 31.9282 15.8276 31.7329 16.0181C31.5425 16.2134 31.2886 16.311 30.9712 16.311H29.3745ZM35.0288 16.311C34.7163 16.311 34.4624 16.2134 34.2671 16.0181C34.0718 15.8276 33.9741 15.5786 33.9741 15.271V7.14844C33.9741 6.83594 34.0718 6.58447 34.2671 6.39404C34.4624 6.19873 34.7163 6.10107 35.0288 6.10107H36.6328C36.9453 6.10107 37.1992 6.19873 37.3945 6.39404C37.5898 6.58447 37.6875 6.83594 37.6875 7.14844V15.271C37.6875 15.5786 37.5898 15.8276 37.3945 16.0181C37.1992 16.2134 36.9453 16.311 36.6328 16.311H35.0288ZM40.6831 16.311C40.3706 16.311 40.1167 16.2134 39.9214 16.0181C39.7261 15.8276 39.6284 15.5786 39.6284 15.271V4.15283C39.6284 3.84033 39.7261 3.58887 39.9214 3.39844C40.1167 3.20801 40.3706 3.11279 40.6831 3.11279H42.2944C42.6069 3.11279 42.8584 3.20801 43.0488 3.39844C43.2441 3.58887 43.3418 3.84033 43.3418 4.15283V15.271C43.3418 15.5786 43.2441 15.8276 43.0488 16.0181C42.8584 16.2134 42.6069 16.311 42.2944 16.311H40.6831Z"}),(0,Z.tZ)("path",{className:td.mobileIconFill,d:"M61 17.0874C60.8893 17.0874 60.7786 17.057 60.668 16.9961C60.5628 16.9352 60.4272 16.8218 60.2612 16.6558L58.2109 14.6885C58.1335 14.611 58.0837 14.528 58.0615 14.4395C58.0449 14.3454 58.0615 14.2568 58.1113 14.1738C58.4157 13.7699 58.8224 13.4323 59.3315 13.1611C59.8462 12.8844 60.4023 12.7461 61 12.7461C61.5811 12.7461 62.1234 12.8761 62.627 13.1362C63.1305 13.3963 63.5345 13.7173 63.8389 14.0991C63.9163 14.1932 63.9468 14.2956 63.9302 14.4062C63.9191 14.5169 63.8721 14.611 63.7891 14.6885L61.7388 16.6558C61.5728 16.8218 61.4344 16.9352 61.3237 16.9961C61.2186 17.057 61.1107 17.0874 61 17.0874ZM56.0278 12.439L54.708 11.1523C54.625 11.0693 54.5807 10.978 54.5752 10.8784C54.5697 10.7733 54.6029 10.6764 54.6748 10.5879C55.1175 10.0622 55.6654 9.59733 56.3184 9.19336C56.9714 8.78385 57.6963 8.46289 58.4932 8.23047C59.2956 7.99805 60.1312 7.88184 61 7.88184C61.8688 7.88184 62.7017 7.99805 63.4985 8.23047C64.2954 8.46289 65.0203 8.78385 65.6733 9.19336C66.3319 9.59733 66.8797 10.0622 67.3169 10.5879C67.3944 10.6764 67.4276 10.7733 67.4165 10.8784C67.411 10.9836 67.3667 11.0749 67.2837 11.1523L65.9639 12.439C65.8587 12.5386 65.7453 12.5884 65.6235 12.5884C65.5073 12.5884 65.4022 12.5386 65.3081 12.439C64.7824 11.88 64.1377 11.4235 63.374 11.0693C62.6159 10.7152 61.8245 10.5409 61 10.5464C60.1865 10.5409 59.3979 10.7124 58.6343 11.061C57.8761 11.4041 57.2397 11.8524 56.7251 12.4058C56.6255 12.5164 56.5093 12.5773 56.3765 12.5884C56.2492 12.5939 56.133 12.5441 56.0278 12.439ZM52.5415 8.99414L51.3711 7.79883C51.2881 7.71029 51.2438 7.61344 51.2383 7.5083C51.2327 7.39762 51.266 7.30078 51.3379 7.21777C52.0075 6.38216 52.8514 5.64339 53.8696 5.00146C54.8879 4.354 56.0057 3.85042 57.2231 3.49072C58.4461 3.12549 59.7051 2.94287 61 2.94287C62.2894 2.94287 63.5456 3.12549 64.7686 3.49072C65.9915 3.85596 67.1094 4.35954 68.1221 5.00146C69.1403 5.64339 69.9842 6.38216 70.6538 7.21777C70.7313 7.30078 70.7673 7.39762 70.7617 7.5083C70.7617 7.61344 70.7174 7.71029 70.6289 7.79883L69.4502 8.97754C69.3561 9.07161 69.2454 9.12142 69.1182 9.12695C68.9909 9.13249 68.8802 9.08822 68.7861 8.99414C67.7679 7.89844 66.5947 7.06836 65.2666 6.50391C63.944 5.93392 62.5218 5.64893 61 5.64893C59.4893 5.64893 58.0726 5.93392 56.75 6.50391C55.4274 7.06836 54.2515 7.89567 53.2222 8.98584C53.1281 9.08545 53.0146 9.13802 52.8818 9.14355C52.7546 9.14355 52.6411 9.09375 52.5415 8.99414Z"}),(0,Z.tZ)("path",{className:td.mobileIconStroke,d:"M79.4379 7.81014C79.4379 6.11708 80.8104 4.74458 82.5035 4.74458H97.3934C99.0864 4.74458 100.459 6.11708 100.459 7.81014V12.1895C100.459 13.8826 99.0864 15.2551 97.3934 15.2551H82.5035C80.8104 15.2551 79.4379 13.8826 79.4379 12.1895V7.81014Z","stroke-width":"0.875874"}),(0,Z.tZ)("path",{className:td.mobileIconFill,d:"M101.773 8.31641V12.7522C102.665 12.3765 103.245 11.5026 103.245 10.5343C103.245 9.56604 102.665 8.69209 101.773 8.31641Z"}),(0,Z.tZ)("path",{className:td.mobileIconFill,d:"M80.7517 7.81034C80.7517 6.84288 81.536 6.05859 82.5035 6.05859H97.3933C98.3608 6.05859 99.1451 6.84288 99.1451 7.81034V12.1897C99.1451 13.1572 98.3608 13.9415 97.3933 13.9415H82.5035C81.536 13.9415 80.7517 13.1572 80.7517 12.1897V7.81034Z"})]}),t=new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}).replace(/\s[AP]M/,"");return(0,Z.BX)(et.hs,{className:td.mobileStatusBar,justifyContent:"space-between",alignItems:"center",sizing:"border-box",children:[(0,Z.tZ)(et.hs,{flex:"grow",alignItems:"center",justifyContent:"center",children:(0,Z.tZ)(ei.xv.B3,{weight:"semibold",className:td.mobileTime,children:t})}),(0,Z.tZ)(ts.xu,{className:td.mobileIsland}),(0,Z.tZ)(et.hs,{flex:"grow",alignItems:"center",justifyContent:"center",children:e})]})};var ty=i(31377);let tf=e=>{let{settings:t,post:i,pub:n,open:r,openPostSettings:o,freePreview:a=!1,audienceToggleValue:l}=e,[s,d]=(0,A.eJ)(""),{device:c,sub:u}=t;(0,A.d4)(()=>{d((0,j.uRy)(n,i,{noBase:void 0,edit:void 0,comments:void 0,commentId:void 0,highlightComment:void 0,replyToComment:void 0,uuid:!0,email:"email"===c,urlParams:{updated:null==i?void 0:i.draft_updated_at,postPreview:(0,ty.isPaidAudience)(null!=l?l:i.audience)||i.free_podcast_url?t.sub:"paid",sub:t.sub,device:c,audience:null!=l?l:i.audience,free_preview:!(0,ty.previewSubHasFullAccessToPost)(t.sub,i,{audienceOverride:l}),freemail:"free"===t.sub||""}}))},[t,i,l,c,n]);let p=a||"everyone"===i.audience||(0,ty.isPaidAudience)(i.audience)&&"founding"===u||"only_paid"===i.audience&&"paid"===u||"only_free"===i.audience&&"free"===u,h="email"===c&&!p,m="mobile"===c?tv:"email"===c?th:tc;return(0,Z.tZ)(m,{hidden:!r,pub:n,post:i,children:h?(0,Z.tZ)(tg,{audience:i.audience,sub:u,openSettings:o}):(0,Z.tZ)("iframe",{"data-testid":"preview-iframe",src:s,loading:"lazy",className:k()(td.iframe,"mobile"===c?td.mobile:td.desktop)})})};var t_=i(50361),tZ=i.n(t_),tw=i(86374),tC=i(44424),tx=i(15186);let tS={device:{mobile:{label:"Mobile"},desktop:{label:"Desktop"},email:{label:"Email"}},sub:{free:{label:"Free subscriber view"},paid:{label:"Paid subscriber view"},founding:{label:"Founding member view"}}};function tk(e){let{presets:t,canSendToOnlyFounding:i}=e,n=tZ()(t);return!i&&n.sub&&delete n.sub.founding,n}let tB=e=>{let{value:t,onSelect:i}=e,n=tk({presets:tS,canSendToOnlyFounding:!0}),{iString:r}=(0,Q.M1)(),o=Object.entries(n.device).map(e=>{let[t,i]=e;return{value:t,label:r(i.label)}});return(0,Z.tZ)(tx.Z,{tabs:o,value:t,onChange:i,ariaLabel:r("Select device")})},tT=e=>{var t;let{value:i,onSelect:n,canSendToOnlyFounding:r,pub:o}=e,a=tk({presets:tS,canSendToOnlyFounding:r}),{iString:l}=(0,Q.M1)();return"enabled"===o.payments_state?(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-outline",trailing:(0,Z.tZ)(tw.Z,{}),"data-testid":"preview-sub-".concat(i),children:l((null===(t=a.sub[i])||void 0===t?void 0:t.label)||"View as...")}),children:Object.entries(a.sub).map(e=>{let[t,r]=e;return(0,Z.tZ)(tC.sN,{onClick:()=>{n(t)},leading:i===t?(0,Z.tZ)(eE.Z,{size:16}):(0,Z.tZ)(tC.$j,{}),children:l(r.label)},t)})}):null};var tI=i(99869),tN=i(28596),tP=i(20253),tE=i(75697),tX=i(61254),tM=i(1844),tA=i(68709),tD=i(51776);function tR(){let e=(0,G._)(["Test email sent to ","!"]);return tR=function(){return e},e}let tF=e=>{let{post:t,pub:i,user:n,resetLink:r,shouldSendFreePreview:o,canSendFreePreview:a,audienceToggleValue:l,subscriberType:s}=e,{iString:d}=(0,Q.M1)(),c=tO({pub:i,post:t,subscriberType:s,audienceToggleValue:l}),u=t?t.type:"newsletter";return(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(ee.zx,{position:"relative",priority:"secondary","data-testid":"share-preview",children:d("Share")}),layerOptions:{placement:"bottom-end"},children:(0,Z.BX)(et.sg,{maxWidth:480,pullX:4,pullY:4,children:["page"!==u&&(0,Z.tZ)(tz,{post:t,user:n,shouldSendFreePreview:o,canSendFreePreview:a}),"adhoc_email"!==u&&t&&t.uuid&&(0,Z.tZ)(tL,{postUrl:c,resetLink:r})]})})},tL=e=>{let{postUrl:t,resetLink:i}=e,{iString:n}=(0,Q.M1)(),{handleCopyLink:r}=(0,tE.Uo)();return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(et.sg,{padding:20,children:(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{children:n("Secret draft link")}),(0,Z.BX)(et.X2,{gap:8,children:[(0,Z.tZ)(tD.oi,{flex:"grow",type:"text",value:t,readOnly:!0,onClick:()=>{r({shareUrl:t}),(0,U.j)(U.FP.SECRET_LINK_COPIED,{source:"input"})},leading:(0,Z.tZ)(tI.Z,{size:18})}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{r({shareUrl:t}),(0,U.j)(U.FP.SECRET_LINK_COPIED,{source:"button"})},children:n("Copy")})]}),(0,Z.BX)(tM.p6,{children:[n("Anyone with this link will be able to access the latest version of this draft, even if it is not yet published. "),(0,Z.tZ)(ei.hh,{decoration:"underline",href:"javascript:void(0)",onClick:i,children:n("Reset the link")}),n(" to revoke access.")]})]})})]})},tz=e=>{let{post:t,user:i,shouldSendFreePreview:n,canSendFreePreview:r}=e,{iString:o,iTemplate:a}=(0,Q.M1)(),l=(0,A.sO)(null);return(0,Z.tZ)(et.sg,{padding:20,children:(0,Z.tZ)(tP.ZP,{action:"/api/v1/drafts/".concat(null==t?void 0:t.id,"/email"),analyticsName:"Test Draft Email",onSuccess:()=>{var e,t;return alert(a(tR(),null!==(t=null===(e=l.current)||void 0===e?void 0:e.value)&&void 0!==t?t:""))},onError:e=>alert((0,Y.zx)(e,"Failed to send test email")),autoLock:!0,className:"new-form",children:(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{children:o("Send test email")}),(0,Z.BX)(et.X2,{gap:8,children:[(0,Z.tZ)(tD.oi,{flex:"grow",ref:l,type:"email",name:"email",placeholder:o("Enter an email address"),defaultValue:i&&i.email,leading:(0,Z.tZ)(tN.Z,{size:18})}),(0,Z.tZ)("input",{type:"hidden",name:"send_free_preview",value:"".concat(r)}),(0,Z.tZ)(ee.zx,{type:"submit",priority:"primary",children:o("Send")})]}),(n||"everyone"===t.audience)&&(0,Z.tZ)(tM.p6,{children:o("This will send two test emails: one with the version your free subscribers will receive and another with the verison for paid subscribers.")})]})})})},tO=e=>{let{pub:t,post:i,subscriberType:n,audienceToggleValue:r}=e;return(0,j.uRy)(t,i,{uuid:!0,urlParams:{postPreview:(0,ty.isPaidAudience)(null!=r?r:i.audience)||i.free_podcast_url?n:"paid",updated:i.draft_updated_at,audience:null!=r?r:i.audience,free_preview:!(0,ty.previewSubHasFullAccessToPost)(n,i,{audienceOverride:r}),freemail:"free"===n||""}})};var tU=i(33804);let tY=(0,to.memo)(e=>{let{user:t,post:i,pub:n,resetSecretLink:r,openSettingsModal:o,canSendFreePreview:a,canSendToOnlyFounding:l,shouldSendFreePreview:s,audienceToggleValue:d,isOpen:c,onClose:u}=e,{iString:p}=(0,Q.M1)(),[h,m]=(0,A.eJ)({device:"mobile",sub:"free"});return(0,Z.tZ)(eK.u_,{isOpen:c,onClose:u,testId:"preview-modal",className:"modal-cpzjij",children:(0,Z.BX)(tU.w,{children:[(0,Z.BX)(et.X2,{padding:16,gap:8,justifyContent:"space-between",alignItems:"center",bg:"primary",borderBottom:"detail",children:[(0,Z.tZ)(et.X2,{flex:"grow",children:(0,Z.tZ)(tB,{value:h.device,onSelect:e=>{let t=(0,_._)((0,f._)({},h),{device:e});(0,U.j)(U.FP.POST_PREVIEW_OPTION,{settings:t,audience:i.audience}),m(t)}})}),(0,Z.tZ)(tT,{value:h.sub,onSelect:e=>{let t=(0,_._)((0,f._)({},h),{sub:e});(0,U.j)(U.FP.POST_PREVIEW_OPTION,{settings:t,audience:i.audience}),m(t)},canSendToOnlyFounding:l,pub:n}),(0,Z.BX)(et.X2,{gap:8,flex:"grow",justifyContent:"end",children:[(0,Z.tZ)(tF,{user:t,post:i,pub:n,resetLink:r,canSendFreePreview:a,shouldSendFreePreview:s,audienceToggleValue:d,subscriberType:h.sub}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:u,children:p("Done")})]})]}),(0,Z.tZ)(et.X2,{position:"relative",alignItems:"center",justifyContent:"center",flex:"grow",sizing:"border-box",padding:20,paddingBottom:20*("email"!==h.device),className:"previewContainer-gSGNtl",children:(null==i?void 0:i.id)&&(0,Z.tZ)(tf,{open:c,settings:h,post:i,pub:n,audienceToggleValue:d,freePreview:s,openPostSettings:()=>{u(),o()}})})]})})});var tH=i(347);let tj=e=>{let{children:t,title:i="",content:n="",className:r="",showFirst:o=!1,disabled:a=!1}=e;return a?(0,Z.tZ)(Z.HY,{children:t}):(0,Z.BX)("div",{className:"popover-container ".concat(r),children:[(0,Z.BX)("div",{className:k()("popover typography",{showfirst:o}),children:[(0,Z.BX)("div",{className:"content",children:[i&&(0,Z.tZ)("strong",{children:i}),n&&(0,Z.tZ)("section",{children:n})]}),(0,Z.tZ)("div",{className:"popover-tail"})]}),t]})};var tJ=i(50515),tV=i(37168),tq=i(40482),tW=i(87077);let tG={indicator:"indicator-PSr0mW",pulse:"pulse-Dowssv","pulse-error":"pulse-error-z451wV",pulseError:"pulse-error-z451wV"};function tK(){let e=(0,G._)([" - last saved at ",""]);return tK=function(){return e},e}function tQ(){let e=(0,G._)(["Changes saved at ",""]);return tQ=function(){return e},e}function t$(){let e=(0,G._)(["Changes saved on ",""]);return t$=function(){return e},e}let t0=e=>{let t,{draftSyncedAt:i,saving:n,pendingUploads:r=0,isOffline:o,error:a}=e,l=(0,Y.K1)(),{iString:s,iTemplate:d,language:c}=(0,Q.M1)(),[u,p]=(0,A.eJ)(null),h=!!i&&(0,H.Z)(i).isAfter((0,H.Z)().startOf("day")),m=h?"hh:mm A":"MMM DD, hh:mm A";(0,A.d4)(()=>{if(n){let e=setTimeout(()=>{p(null)},3e3);p(e)}},[n]),(0,A.d4)(()=>()=>{u&&clearTimeout(u)},[]);let g=s("Draft");return a?"network"===a?(g=s(l?"Network issues":"Network connection issues"),i&&!l&&(g+=d(tK(),(0,H.Z)(i).locale(c).format(m))),t=s("Changes have been saved to your device but will not be synced to Substack until a connection is established. Try refreshing your browser.")):(g=s(l?"Error":"Error - Please refresh your browser"),t=s("There was an error saving, refresh to avoid losing work")):(n||r>0)&&!o?g=s(l?"Saving...":"Saving changes..."):o?(g=s(l?"Offline":"Working offline"),t=s("Attempting to reconnect. Changes will be synced when you are back online.")):i&&(u&&(g=s("Draft - Saved")),t=d(h?tQ():t$(),(0,H.Z)(i).locale(c).format(m))),(0,Z.tZ)(tW.u,{disabled:!t,text:t,preferPlacement:"bottom-end",children:(0,Z.BX)(et.gq,{alignItems:"center",gap:8,children:[o?(0,Z.tZ)(eP.Z,{stroke:"var(--color-fg-secondary)",height:18}):(0,Z.tZ)(ts.xu,{height:8,width:8,radius:"full",className:k()(tG.indicator,a&&tG.error)}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:g})]})})};var t1=i(28771),t2=i(83311);class t4 extends t2.h8{apply(e){return this.oldValue=e.attrs[this.key],e.attrs[this.key]=this.value,t2.oo.ok(e)}invert(){return new t4(this.key,this.oldValue,"RevertDocumentAttribute")}map(){return null}toJSON(){return{stepType:this.stepType,key:this.key,value:this.value}}static fromJSON(e){return new t4(e.key,e.value,e.stepType)}constructor(e,t,i="SetDocumentAttribute"){super(),(0,M._)(this,"stepType",void 0),(0,M._)(this,"key",void 0),(0,M._)(this,"value",void 0),(0,M._)(this,"oldValue",void 0),this.stepType=i,this.key=e,this.value=t}}var t3=i(92007),t8=i(45901);let t6=/\((TK)+\)|\[(TK)+\]|<(TK)+>|(TK)+:|\b(TK)+\b/gi,t5=new t3.Sy({state:{init(e,t){let{doc:i}=t;return t9(i)},apply:(e,t)=>e.docChanged?t9(e.doc):t},props:{decorations(e){return this.getState(e)},handleClick(e,t,i){if(i.target instanceof Element&&"tkMatch"in i.target){let{from:t,to:n}=i.target.tkMatch;return e.dispatch(e.state.tr.setSelection(t3.Bs.create(e.state.doc,t,n)).scrollIntoView()),!0}}}});function t9(e){let t=[];return(function(e){let t=[];return e.descendants((e,i)=>{if(e.isText&&void 0!==e.text)for(let n of e.text.matchAll(t6))void 0!==n.index&&t.push({from:i+n.index,to:i+n.index+n[0].length})}),t})(e).forEach(e=>{t.push(t8.p.inline(e.from,e.to,{class:"tk"})),t.push(t8.p.widget(e.from,()=>{let t=document.createElement("span");return t.textContent="TK",t.className="tk-icon",t.tkMatch=e,t}))}),t8.EH.create(e,t)}var t7=i(66586);let ie=e=>JSON.stringify({type:"doc",content:[{type:"paragraph"},{type:"button",attrs:{url:"%%checkout_url%%",text:"Subscribe now",action:null,class:null}},{type:"heading",attrs:{level:2},content:[{type:"text",text:"[EDIT ME] Beginnings are hard. [EDIT ME]"}]},{type:"paragraph",content:[{type:"text",text:"A blinking cursor on a fresh blank page can be intimidating for even seasoned writers. Here are some tips from our Partnerships team on how to go about your first Substack post:"}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"1. Why this, why now "}]},{type:"paragraph",content:[{type:"text",text:"Tell your readers why you are launching this space. What brought you here and what inspired you to do it now. Think of it as a mini personal manifesto."}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"2. What kind of community are you looking to build here"}]},{type:"paragraph",content:[{type:"text",text:" You are not just starting a newsletter when you start a Substack, you are starting a community. You are inviting people to subscribe to your thinking. What kind of space will this be? "}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"3. Be specific "}]},{type:"paragraph",content:[{type:"text",text:"Readers love clarity. Be clear when you explain what they should expect: how often will you be posting? Can they expect certain posts on specific days? What will the free subscribers get? What does a paid subscription buy them? (You can list these benefits in bullets.) "}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"4. Use an image and â€œsubscribeâ€ buttons"}]},{type:"paragraph",content:[{type:"text",text:"A picture will look nicer when you share the post on your social media (click the image icon in the editor to search for copyright-free photos), and it will give color to your archive as you build it."}]},{type:"captionedImage",content:[{type:"image2",attrs:{src:"https://images.unsplash.com/photo-1513542789411-b6a5d4f31634?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwzMDAzMzh8MHwxfHNlYXJjaHwyfHxyYW5kb218ZW58MHx8fHwxNjY3MzQ5Njkx&ixlib=rb-4.0.3&q=80&w=1080",fullscreen:null,imageSize:null,height:810,width:1080,resizeWidth:null,bytes:null,alt:"colored pencil lined up on top of white surface",title:null,type:"image/jpg",href:null,belowTheFold:!0,internalRedirect:null}},{type:"caption",content:[{type:"text",text:"Photo by "},{type:"text",marks:[{type:"link",attrs:{href:"https://unsplash.com/@jessbaileydesigns",target:"_blank"}}],text:"Jess Bailey"},{type:"text",text:" on "},{type:"text",marks:[{type:"link",attrs:{href:"https://unsplash.com",target:"_blank"}}],text:"Unsplash"}]}]},{type:"paragraph",content:[{type:"text",text:"[EDIT ME]â€œSubscribeâ€ buttons (found in your editor under â€œButtons'â€œ) will make it easy for new readers to subscribe to your newsletter with one click.[EDIT ME]"}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"5. Ignore our advice "}]},{type:"paragraph",content:[{type:"text",text:"There is no one true way to go about building a Substack. This is your playground,  experiment with it. If youâ€™re having fun, your readers will too. "}]},{type:"paragraph",content:[{type:"text",text:"(But trust us on the â€œsubscribeâ€ buttons!) "}]},{type:"horizontal_rule"},{type:"subscribeWidget",attrs:{url:"%%checkout_url%%",text:"Subscribe"},content:[{type:"ctaCaption",content:[{type:"text",text:"Thanks for reading ".concat(e,"! Subscribe for free to receive new posts and support my work.")}]}]},{type:"paragraph"}]}),it=e=>({body:ie(e),title:"",subtitle:""});var ii=i(53716),ir=i(79721),io=i(40647),ia=i(61381),il=i(89871),is=i(16564);let id=e=>{let{postId:t,bylines:i,pendingInvites:n,onChange:r}=e;return(0,Z.BX)(et.tu,{gap:8,flex:"fill",children:[(0,Z.tZ)(ei.xv.B3,{weight:"semibold",color:"primary",translated:!0,children:"Add guests"}),(0,Z.tZ)(ei.xv.B4,{translated:!0,color:"secondary",children:"Listing who is on an episode helps you expand your reach."}),(0,Z.tZ)(e2,{postId:t,postType:"podcast",bylines:i,pendingInvites:n,isDisabled:!1,onChange:r,setPostId:null,expandedView:!0,scrollContainer:()=>document.getElementsByClassName("drawer-scroll")[0]||document.body})]})};var ic=i(50486),iu=i(23279),ip=i.n(iu),ih=i(41609),im=i.n(ih),ig=i(23855),iv=i(84967),ib=i(49336),iy=i(66298),i_=i(52103),iZ=i(20888),iw=i(17391);function iC(e){let{paddingTop:t,value:i,onChange:n,label:r,name:o,action:a,disabled:l,extras:s,trackInput:d}=e;return(0,Z.BX)(et.gq,{gap:8,alignItems:"start",direction:{desktop:"row",mobile:"column"},paddingTop:t,children:[(0,Z.tZ)(et.tu,{flex:"grow",children:(0,Z.tZ)(iw.j,{value:i,contentBelow:s,disabled:l,label:r,testid:o,track:d,onChange:n})}),a]})}var ix=i(48980),iS=i(7882),ik=i(12900),iB=i(82402),iT=i(87185),iI=i(98248),iN=i(70379),iP=i(26111);let iE={statusSignIn:"statusSignIn-NeJ5L6"},iX="https://support.substack.com/hc/en-us/articles/30627373184532",iM=()=>{let{result:e,isLoading:t,refetch:i}=(0,iS.ib)({pathname:"/api/v1/video/youtube/check-authorization",method:"GET",auto:!0});return{isLoading:t,connectedAccountEmail:(null==e?void 0:e.hasCredentials)?e.email:void 0,refetch:i}},iA=e=>{let{mediaUploadId:t,createDefault:i}=e,{iString:n}=(0,Q.M1)(),r=(0,iN.pm)(),[o,a]=(0,A.eJ)(!1),{result:l,isLoading:s,error:d,setResult:c}=(0,iS.ib)({pathname:"/api/v1/video/youtube/status/".concat(t),method:"GET",auto:!0}),u=(0,A.I4)(async()=>{a(!0),c(await (0,ix.rd)("/api/v1/video/youtube/status",{method:"POST",json:{media_upload_id:t,auto_upload:!0,privacy_status:"public",include_watermark:!0}})),a(!1)},[c,t]),p=(0,A.I4)(async e=>{try{let i=await (0,ix.rd)("/api/v1/video/youtube/status/".concat(t),{method:"PATCH",json:e});c(i)}catch(e){r.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:n("Failed to update YouTube upload.")})))}},[t]);return(0,A.d4)(()=>{if(!s&&!l&&d&&!o){var e;(null==d?void 0:null===(e=d.response)||void 0===e?void 0:e.status)===404&&i&&u()}},[l,s,d,i,u,o]),{status:l,isLoading:s,createDefaultStatus:u,updateStatus:p}},iD=e=>{let{source:t,postId:i}=e,[n,r]=(0,A.eJ)(!1),o=(0,iN.pm)(),a=async()=>{(0,U.j)(U.FP.UPLOAD_TO_YOUTUBE_SIGNIN_CLICKED,{post_id:i});let e=await (0,ix.rd)("/api/v1/video/youtube/authorize?source=".concat(t));window.location.href=e.url},l=async()=>{await (0,ix.rd)("/api/v1/video/youtube/authorize",{method:"DELETE"})};return(0,A.d4)(()=>{if(n)return;r(!0);let e=(0,iP.x)("yt_error");if(e){let t=e.replace(/\+/g," "),i=new URL(window.location.href);i.searchParams.delete("yt_error"),window.history.replaceState(null,"",i),o.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:t,Icon:ig.Z})))}},[n,o]),{connectAccount:a,disconnectAccount:l}},iR=e=>{let{postId:t,customText:i,className:n="",source:r="media_drawer"}=e,{iString:o}=(0,Q.M1)(),{connectAccount:a}=iD({source:r,postId:t});return(0,Z.BX)(et.gq,{justifyContent:"space-between",flex:"grow",className:n,children:[(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.tZ)(et.tu,{className:"youtube-logo-container",height:36,paddingX:6,bg:"secondary",alignItems:"center",justifyContent:"center",radius:"sm",children:(0,Z.tZ)(iZ.e,{src:"/img/youtube_icon.png",alt:o("YouTube"),maxWidth:24})}),(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ei.xv.B3,{font:"display",size:15,weight:"semibold",children:i?i.primary:o("Auto-upload to YouTube")}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",font:"display",size:13,children:i?i.secondary:o("Sign in to your account to get started")})]})]}),(0,Z.tZ)(et.tu,{children:(0,Z.tZ)(ee.zx,{onClick:a,priority:"secondary",size:"sm",children:o("Sign in")})})]})},iF=e=>{let{connectedAccountEmail:t,mediaUploadId:i,post:n,freePreview:r=!1}=e,{iString:o}=(0,Q.M1)(),{status:a,updateStatus:l}=iA({mediaUploadId:i}),[s,d]=(0,A.eJ)(!0),[c,u]=(0,A.eJ)(!0),[p,h]=(0,A.eJ)(!1),[m,g]=(0,A.eJ)(""),[v,b]=(0,A.eJ)(""),[y,f]=(0,A.eJ)("private"),[_,w]=(0,A.eJ)(!0);(0,A.d4)(()=>{let e=async()=>{h(!0);let e={},t=(null==n?void 0:n.title)||(null==n?void 0:n.draft_title),i=(null==n?void 0:n.subtitle)||(null==n?void 0:n.draft_subtitle),r=(null==a?void 0:a.status)==="pending";if(a){var o;d(!!a.auto_upload),f(a.privacy_status),w(null!==(o=a.include_watermark)&&void 0!==o&&o),a.title?g(a.title):t&&r&&(g(t),e.title=t),a.description?b(a.description):i&&r&&(b(i),e.description=i),im()(e)||await l(e)}};!p&&a&&e()},[a,l,y,p,h]);let C=(0,A.I4)(async e=>{await l(e)},[l]),x=(0,A.Ye)(()=>ip()(C,500),[C]);(0,A.d4)(()=>{let e={};(null==n?void 0:n.draft_title)&&n.draft_title!==m&&(g(n.draft_title),e.title=n.draft_title),(null==n?void 0:n.draft_subtitle)&&n.draft_subtitle!==v&&(b(n.draft_subtitle),e.description=n.draft_subtitle),im()(e)||x(e)},[null==n?void 0:n.draft_title,null==n?void 0:n.draft_subtitle]);let S=e=>{let t={};switch(e.param){case"auto_upload":d(e.value),u(e.value),t.auto_upload=e.value,(0,U.j)(U.FP.UPLOAD_TO_YOUTUBE_TOGGLED,{post_id:null==n?void 0:n.id,value:e.value});break;case"include_watermark":w(e.value),t.include_watermark=e.value;break;case"title":g(e.value),t.title=e.value;break;case"description":b(e.value),t.description=e.value;break;case"privacy_status":f(e.value),t.privacy_status=e.value}x(t)};return a&&(null==a?void 0:a.status)!=="pending"?(0,Z.tZ)(iz,{initialStatus:a,mediaUploadId:i,postId:null==n?void 0:n.id}):(0,Z.BX)(et.tu,{gap:16,flex:"fill",children:[(0,Z.tZ)(iO,{connectedAccountEmail:t,shouldUpload:s,onChange:e=>S({param:"auto_upload",value:e}),children:(0,Z.tZ)(et.tu,{cursor:"pointer",onClick:()=>u(!c),children:c?(0,Z.tZ)(iv.Z,{}):(0,Z.tZ)(ib.Z,{})})}),(0,Z.tZ)(ik.H,{expanded:c,children:(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.BX)(et.gq,{wrap:"wrap",gap:8,children:[(0,Z.tZ)(ei.xv.B3,{font:"display",size:14,weight:"semibold",translated:!0,color:"primary",children:"Name"}),(0,Z.tZ)(tD.oi,{placeholder:o("Title"),value:m,onChange:e=>S({param:"title",value:e.currentTarget.value}),minLength:1})]}),(0,Z.BX)(et.gq,{wrap:"wrap",gap:8,children:[(0,Z.tZ)(ei.xv.B3,{font:"display",size:14,weight:"semibold",translated:!0,color:"primary",children:"Description"}),(0,Z.tZ)(tD.oi,{placeholder:o("Add description"),value:v,onChange:e=>S({param:"description",value:e.currentTarget.value}),minLength:4})]}),(0,Z.BX)(et.gq,{wrap:"wrap",gap:8,children:[(0,Z.tZ)(ei.xv.B3,{font:"display",size:14,weight:"semibold",translated:!0,color:"primary",children:"Visibility"}),(0,Z.tZ)(et.gq,{style:{width:"100%"},children:(0,Z.tZ)(iT.m,{onChange:e=>S({param:"privacy_status",value:e}),value:y,options:iL,flex:"grow"})})]}),!r&&(0,Z.BX)(et.gq,{wrap:"wrap",gap:8,children:[(0,Z.tZ)(iC,{label:o("Include Substack watermark"),trackInput:"include_watermark",value:_,onChange:e=>S({param:"include_watermark",value:e})}),(0,Z.tZ)(ei.xv,{})]})]})}),r&&(0,Z.tZ)(ei.xv.B4,{font:"display",size:13,color:"secondary",translated:!0,children:"Only your free preview will be uploaded to YouTube"})]})},iL=[{value:"private",label:"Private"},{value:"public",label:"Public"},{value:"unlisted",label:"Unlisted"}],iz=e=>{let{initialStatus:t,mediaUploadId:i,className:n,postId:r,source:o}=e,{iString:a}=(0,Q.M1)(),l=(0,iN.pm)(),[s,d]=(0,A.eJ)(!1),[c,u]=(0,A.eJ)(!1),[p,h]=(0,A.eJ)(null),{connectedAccountEmail:m}=iM(),{result:g,refetch:v,error:b}=(0,iS.ib)({pathname:"/api/v1/video/youtube/status/".concat(i),method:"GET",auto:!t,initialResult:t}),y=["failed","deleted","rejected"].includes((null==g?void 0:g.status)||"");if((0,A.d4)(()=>{if(b){let e=b.getMessage();403===b.response.status&&e.includes("access token")&&u(!0)}},[b]),(0,A.d4)(()=>{y&&!m&&u(!0),m&&u(!1)},[m,y]),(0,A.d4)(()=>(!p&&(["uploaded","uploading"].includes((null==g?void 0:g.status)||"")||(null==g?void 0:g.clip_media_upload_id)&&(null==g?void 0:g.status)==="pending")&&h(setInterval(()=>{v()},2e4)),()=>{p&&clearInterval(p)}),[null==g?void 0:g.status,null==g?void 0:g.clip_media_upload_id,v,p,h]),!g)return null;if(c)return(0,Z.tZ)(iR,{className:k()(n,iE.statusSignIn),postId:r,customText:{primary:a("Sign in to YouTube"),secondary:a("Check the status of your upload")},source:o});if(!(null==g?void 0:g.status)||!g.auto_upload)return null;let w="https://studio.youtube.com/video/".concat(g.youtube_video_id,"/edit"),C=async()=>{d(!0),await (0,ix.rd)("/api/v1/video/youtube/upload",{method:"POST",json:{media_upload_id:g.media_upload_id}}),l.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:a("Retrying upload to YouTube")}))),setTimeout(()=>{d(!1),v()},2e3)},x=y?a("Upload failed"):"processed"===g.status?a("Published to YouTube"):a("Uploading to YouTube...");return(0,Z.BX)(et.gq,{className:n,justifyContent:"space-between",alignItems:"center",flex:"grow",children:[(0,Z.BX)(et.gq,{gap:16,alignItems:"center",height:32,children:[(0,Z.tZ)(iZ.e,{src:"/img/youtube_icon.png",alt:a("YouTube"),maxWidth:24}),(0,Z.tZ)(ei.xv.B3,{weight:"semibold",fontSize:13,color:y?"accent-red":"primary",children:x})]}),!y&&g.youtube_video_id&&(0,Z.BX)(ee.zx,{className:"action-btn",href:w,size:"sm",newTab:!0,priority:"tertiary",fontSize:13,onClick:()=>{(0,U.j)(U.FP.VIEW_ON_YOUTUBE_CLICKED,{media_upload_id:i,youtube_video_id:g.youtube_video_id,post_id:r})},children:[a("View")," ",(0,Z.tZ)(iy.Z,{height:18})]}),y&&!s&&(0,Z.BX)(ee.zx,{className:"action-btn",size:"sm",priority:"secondary-outline",onClick:C,fontSize:13,children:[(0,Z.tZ)(i_.Z,{height:18})," ",a("Retry")]}),y&&s&&(0,Z.tZ)(iI.$j,{style:{padding:"0px"}})]})},iO=e=>{let{connectedAccountEmail:t,shouldUpload:i,onChange:n,children:r}=e,{iString:o}=(0,Q.M1)();return(0,Z.BX)(et.gq,{justifyContent:"space-between",flex:"grow",children:[(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.tZ)(et.tu,{height:36,paddingX:6,bg:"secondary",alignItems:"center",justifyContent:"center",radius:"sm",children:(0,Z.tZ)(iZ.e,{src:"/img/youtube_icon.png",alt:o("YouTube"),maxWidth:24})}),(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ei.xv.B3,{color:"primary",font:"display",size:15,weight:"semibold",translated:!0,children:"Auto-upload to YouTube"}),(0,Z.tZ)(ei.xv.B4,{font:"display",size:13,color:"secondary",children:t})]})]}),(0,Z.tZ)(et.tu,{justifyContent:"center",children:(0,Z.BX)(et.gq,{gap:12,alignItems:"center",children:[(0,Z.tZ)(iB.X,{size:"sm",checked:i,onChange:n}),r]})})]})},iU=e=>{let{mediaUploadId:t}=e,{iString:i}=(0,Q.M1)(),n=(0,iN.pm)(),{isLoading:r,connectedAccountEmail:o}=iM(),{status:a,isLoading:l}=iA({mediaUploadId:t,createDefault:!!o}),[s,d]=(0,A.eJ)(!0),c=async e=>{d(e);try{await (0,ix.rd)("/api/v1/video/youtube/status/".concat(t),{method:"PATCH",json:{auto_upload:e}})}catch(t){n.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:i("Failed to update YouTube upload status")}))),d(!e)}};return((0,A.d4)(()=>{a&&d(!!a.auto_upload)},[a]),r||l)?null:o?(0,Z.tZ)(iO,{connectedAccountEmail:o,shouldUpload:s,onChange:c}):(0,Z.tZ)(iR,{})},iY=e=>{let{post:t,mediaUploadId:i,renderForm:n,freePreview:r}=e,{isLoading:o,connectedAccountEmail:a}=iM();return!i||o?null:a?(0,Z.tZ)(iF,{mediaUploadId:i,connectedAccountEmail:a,post:t,freePreview:r,renderForm:n}):(0,Z.tZ)(iR,{postId:null==t?void 0:t.id})};var iH=i(42684),ij=i(89263);let iJ=e=>{let{error:t,isDirty:i,isSaving:n,value:r,onChange:o,onSave:a}=e,{iString:l}=(0,Q.M1)();return(0,Z.BX)("div",{children:[(0,Z.tZ)(ij.n,{errors:t?[t]:null,label:l("Free podcast URL"),value:r,onChange:o}),(0,Z.tZ)(ik.H,{expanded:i,children:(0,Z.tZ)(et.gq,{paddingTop:16,children:(0,Z.tZ)(ee.zx,{disabled:n,onClick:a,children:l("Save")})})})]})};var iV=i(2647),iq=i(25425),iW=i(27194),iG=i(38464),iK=i(98961),iQ=i(44276),i$=i(77475);let i0=e=>{let{currentTime:t,isPlaying:i,progress:n,progressBarRef:r,progressBarOnMouseDown:o,remainingTime:a,togglePlayback:l,type:s="audio",thumbnailUrl:d=""}=e;return(0,Z.BX)(et.gq,{flex:"grow",gap:16,children:[(0,Z.tZ)(et.hs,{radius:"sm",children:"audio"===s?(0,Z.tZ)(et.hs,{radius:"xs",height:40,width:40,bg:"secondary",alignItems:"center",justifyContent:"center",children:(0,Z.tZ)(iG.Z,{size:24,color:"var(--color-fg-tertiary)"})}):d?(0,Z.tZ)(iZ.e,{src:d,maxWidth:40,radius:"xs",imageProps:{height:Math.round(40),smartCrop:!0}}):(0,Z.tZ)(et.hs,{radius:"xs",height:40,width:40,bg:"secondary",alignItems:"center",justifyContent:"center",children:(0,Z.tZ)(iK.Z,{size:24,color:"var(--color-fg-tertiary)"})})}),(0,Z.BX)(et.gq,{flex:"grow",gap:8,children:[(0,Z.tZ)(et.hs,{cursor:"pointer",onClick:l,alignItems:"center",justifyContent:"center",children:i?(0,Z.tZ)(iQ.Z,{color:"var(--color-fg-primary)",fill:"var(--color-fg-primary)",size:24}):(0,Z.tZ)(i$.Z,{color:"var(--color-fg-primary)",fill:"var(--color-fg-primary)",size:24})}),(0,Z.tZ)(is.ko,{currentTime:t,remainingTime:a,containerRef:r,progress:n,onMouseDown:o,theme:is._g.PubAccent})]})]})};var i1=i(54278),i2=i(96302);let i4=e=>{var t,i,n,r;let{askToRemoveLegacyPodcast:o,hideFromFeed:a,language:l,podcastPreviewUpload:s,podcastUpload:d,postId:c,pub:u,selectedSectionId:p,setPostId:h,uploadingPrimary:m,videoUpload:g,onHideFromFeedChange:v,onPodcastPreviewUploadChanged:b,onPodcastUploadChanged:y}=e,{iString:C}=(0,Q.M1)(),x=(null==d?void 0:d.state)==="error",S=async e=>{if((0,U.j)(U.FP.DISTRIBUTE_TO_FEED_CLICKED,{distributeToFeed:e}),v(!e),e){var t,i,n,r;if(d||s)return;let{body:e}=await N().get("/api/v1/video/upload/".concat(null==g?void 0:g.id,"/audio"));y({mediaUpload:null!==(n=null==e?void 0:e.extractedAudio)&&void 0!==n?n:null,podcastPreviewUpload:(null==g?void 0:null===(t=g.extractedPreviewAudio)||void 0===t?void 0:t.id)!==(null==e?void 0:null===(i=e.extractedAudio)||void 0===i?void 0:i.id)&&null!==(r=null==e?void 0:e.extractedPreviewAudio)&&void 0!==r?r:null})}},k=async()=>{var e;let{body:t}=await N().get("/api/v1/video/upload/".concat(null==g?void 0:g.id,"/audio"));y({mediaUpload:null!==(e=null==t?void 0:t.extractedAudio)&&void 0!==e?e:null})},B=async()=>{var e;let{body:t}=await N().get("/api/v1/video/upload/".concat(null==g?void 0:g.id,"/audio"));b({mediaUpload:null!==(e=null==t?void 0:t.extractedPreviewAudio)&&void 0!==e?e:null})},T=g&&(null!==(t=null==g?void 0:g.preview_duration)&&void 0!==t?t:0)>0&&!s,I=g&&(null!==(i=null==g?void 0:g.preview_duration)&&void 0!==i?i:0)===0&&!!s,P=C("Your video contains a free preview. Upload a free audio file if youâ€™d like a preview in your public RSS feed."),E=C("Adding a free audio preview doesn't create a free video preview; you'll need to create one in the video editor"),X=T?P:I?E:"",M=null!==(r=(null!==(n=u.sections)&&void 0!==n?n:[]).find(e=>e.id===p))&&void 0!==r?r:null,A=M&&M.is_podcast||!M&&u.podcast_enabled,D="undefined"!=typeof window?(0,j.UA6)(window.location.pathname,p):void 0,R=!a&&!(null==d?void 0:d.src_media_upload_id),F=!a&&!(null==s?void 0:s.src_media_upload_id);return(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"Podcast"}),(0,Z.BX)(et.tu,{radius:"md",padding:16,border:"detail",gap:8,shadow:"sm",children:[A?(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(i1.g,{label:C("Add audio to podcast RSS feed"),details:x?C("No audio found"):C("Allow listeners to access your post on external podcast players"),compact:!0}),(0,Z.tZ)(i2.ZP,{disabled:m||!g||x,checked:!a,onChange:S})]}):(0,Z.tZ)(et.tu,{gap:16,children:(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(i1.g,{label:C("Add audio to podcast RSS feed"),details:x?C("No audio found"):C("Allow listeners to access your post on external podcast players"),compact:!0}),(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-outline",href:D,disabled:x,children:C("Set up podcast")})]})}),A&&!a&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(tX.iz,{paddingY:8}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",color:"primary",children:C("Podcast audio")}),(0,Z.tZ)(iH.Z,{initialFile:null,feature:is.MR.Podcast,mediaType:"audio",pub:u,postId:c,setPostId:h,language:l,onChange:e=>{let{mediaUpload:t}=e;y({mediaUpload:t})},mediaUpload:d,mediaUploadId:null==d?void 0:d.id,hideRecorder:!0,hideReset:!1,onResetToDefault:k,components:{AuditionPlayer:e=>(0,Z.BX)(et.gq,{border:"detail",radius:"sm",alignItems:"center",paddingY:16,paddingX:12,gap:8,children:[(0,Z.tZ)(i0,(0,_._)((0,f._)({},e),{type:R?"audio":g?"video":"audio",thumbnailUrl:g?(0,j.kOB)(g):""})),(0,Z.BX)(tC.v2,{layerOptions:{placement:"bottom-end"},trigger:(0,Z.tZ)(ee.hU,{priority:"tertiary",rounded:!0,children:(0,Z.tZ)(iV.Z,{})}),children:[(0,Z.tZ)(ei.xv.B5,{color:"secondary",padding:8,children:R?null==d?void 0:d.name:C("Audio extracted from video file")}),R&&(0,Z.BX)(w.Fragment,{children:[(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(iq.Z,{}),onClick:k,children:C("Reset audio to default")})]}),(0,Z.tZ)(tX.iz,{}),R?(0,Z.tZ)(tC.sN,{priority:R?"destructive":"primary",leading:(0,Z.tZ)(iW.Z,{}),onClick:()=>y({mediaUpload:null}),children:C("Remove")}):(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(ii.Z,{}),onClick:()=>y({mediaUpload:null}),children:C("Replace")})]})]})}}),(0,Z.BX)(w.Fragment,{children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",color:"primary",children:C("Free preview")}),X&&(0,Z.tZ)(i3,{message:X}),(0,Z.tZ)(iH.Z,{initialFile:null,feature:is.MR.PodcastPreview,mediaType:"audio",pub:u,postId:c,setPostId:h,language:l,onChange:e=>{let{mediaUpload:t}=e;b({mediaUpload:t})},mediaUpload:s,mediaUploadId:null==s?void 0:s.id,onRemoveLegacyUrl:o,hideRecorder:!0,hideReset:!1,onResetToDefault:B,components:{AuditionPlayer:e=>(0,Z.BX)(et.gq,{border:"detail",radius:"sm",alignItems:"center",paddingY:16,paddingX:12,gap:8,children:[(0,Z.tZ)(i0,(0,_._)((0,f._)({},e),{type:F?"audio":g?"video":"audio",thumbnailUrl:g?(0,j.kOB)(g):""})),(0,Z.BX)(tC.v2,{layerOptions:{placement:"bottom-end"},trigger:(0,Z.tZ)(ee.hU,{priority:"tertiary",rounded:!0,children:(0,Z.tZ)(iV.Z,{})}),children:[(0,Z.tZ)(ei.xv.B5,{color:"secondary",padding:8,children:F?null==s?void 0:s.name:C("Audio extracted from video preview")}),F&&(0,Z.BX)(w.Fragment,{children:[(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(iq.Z,{}),onClick:B,children:C("Reset audio to default")})]}),(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(tC.sN,{priority:"destructive",leading:(0,Z.tZ)(iW.Z,{}),onClick:()=>b({mediaUpload:null}),children:C("Remove")})]})]})}})]})]})]})]})]})},i3=e=>{let{message:t,className:i}=e;return(0,Z.tZ)(i8,{message:t,className:k()("warningPanel-eX6mxG",i)})},i8=e=>{let{message:t,className:i}=e,[n,r]=(0,A.eJ)(!1);return n?null:(0,Z.BX)(et.gq,{className:i,paddingX:16,paddingY:12,gap:12,radius:"md",alignItems:"center",children:[(0,Z.tZ)(eR.Z,{}),(0,Z.tZ)(et.tu,{flex:"grow",children:(0,Z.tZ)(ei.xv.B4,{weight:"semibold",children:t})}),(0,Z.tZ)(et.hs,{cursor:"pointer",onClick:()=>r(!0),children:(0,Z.tZ)(K.Z,{})})]})};var i6=i(27856),i5=i.n(i6),i9=i(56070),i7=i(43557),ne=i(99961),nt=i(51127),ni=i(75481),nn=i(91077),nr=i(38621),no=i(55963),na=i(55679),nl=i(38664),ns=((a={})[a.Bold=0]="Bold",a[a.Italic=1]="Italic",a[a.Link=2]="Link",a);function nd(){let e=(0,G._)(["Bold ","B"]);return nd=function(){return e},e}function nc(){let e=(0,G._)(["Italic ","I"]);return nc=function(){return e},e}function nu(){let e=(0,G._)(["Link ","K"]);return nu=function(){return e},e}let np=e=>{let{editor:t,includeExtensions:i}=e,n=(0,Y.Mi)(),{iTemplate:r}=(0,Q.M1)();return(0,Z.BX)("div",{className:"dynamic-tiptap-menu",children:[(null==i?void 0:i.includes(ns.Bold))&&(0,Z.tZ)(nh,{onClick:e=>{e.preventDefault(),t.chain().focus().toggleBold().run()},enabled:t.can().toggleBold(),active:t.isActive("bold"),title:r(nd(),n),children:(0,Z.tZ)(nl.mY,{})}),(null==i?void 0:i.includes(ns.Italic))&&(0,Z.tZ)(nh,{onClick:e=>{e.preventDefault(),t.chain().focus().toggleItalic().run()},enabled:t.can().toggleItalic(),active:t.isActive("italic"),title:r(nc(),n),children:(0,Z.tZ)(nl.h3,{})}),(null==i?void 0:i.includes(ns.Link))&&(0,Z.tZ)(nh,{onClick:e=>{e.preventDefault(),t.chain().addLink().run()},enabled:!0,active:t.isActive("link"),title:r(nu(),n),children:(0,Z.tZ)(nl.xP,{})})]})},nh=e=>{let{onClick:t,enabled:i,children:n,active:r,title:o}=e;return(0,Z.tZ)("button",{className:k()("tiptap-menu-button",{active:r,disabled:!i}),onClick:t,disabled:!i,title:o,children:n})};var nm=i(98738);let ng={[ns.Bold]:i9.ZP,[ns.Italic]:ni.ZP,[ns.Link]:nm.d},nv=e=>{let{editorRef:t,initialContent:i,includeExtensions:n=[],showMenu:r=!1,onEditorReady:o,onEditorDestroyed:a,onContentUpdated:l,autofocus:s=!1}=e,d=n.map(e=>ng[e]),c=[i7.Z,nn.Z,no.Z,nt.Z,ne.Z,nr.Z,...d],u=()=>{},p=l?e=>{let{editor:t}=e;l(t.getJSON())}:u,h=(0,na.jE)({extensions:c,content:i,onUpdate:p,autofocus:s,onCreate:o||u,onDestroy:a||u});return h?(t&&(t.current=h),(0,Z.BX)(Z.HY,{children:[r&&(0,Z.tZ)(np,{editor:h,includeExtensions:n}),(0,Z.tZ)(et.tu,{alignItems:"stretch",border:"detail",shadow:"sm",className:k()("tiptap-editor",{"has-menu":r}),children:(0,Z.tZ)(na.kg,{editor:h})})]})):null},nb={editText:"editText-GEhexe",editorContainer:"editorContainer-LVonGm",episodeNotesView:"episodeNotesView-kO3KEI",disabled:"disabled-WUiYOY"},ny=e=>{let{hide:t,initialContent:i,onSave:n,editorRef:r,onEditorReady:o,onEditorDestroyed:a,setEditing:l}=e,[s,d]=(0,A.eJ)(null),{iString:c}=(0,Q.M1)();return(0,Z.BX)("div",{className:k()(nb.editorContainer,{hide:t}),children:[(0,Z.tZ)(nv,{editorRef:r,initialContent:i,includeExtensions:[ns.Bold,ns.Italic,ns.Link],showMenu:!0,onEditorReady:o,onEditorDestroyed:a,onContentUpdated:d,autofocus:"start"}),(0,Z.BX)(et.gq,{justifyContent:"end",gap:8,paddingTop:16,children:[(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{l(!1)},children:c("Cancel")}),(0,Z.tZ)(ee.zx,{priority:"primary",disabled:!s,onClick:()=>n(JSON.stringify(s)),children:c("Save")})]})]})},nf=e=>{let{content:t}=e;return(0,Z.tZ)(et.hs,{radius:"md",padding:16,border:"detail",shadow:"sm",children:(0,Z.tZ)(ei.xv.B4,{as:"p",className:nb.episodeNotesView,dangerouslySetInnerHTML:{__html:t}})})};var n_=i(65433);let nZ=e=>{var t;let{post:i,postBody:n,podcastDescription:r,hasPodcastPreview:o,savePodcastDescription:a,variant:l="voiceover",label:s}=e,{iString:d}=(0,Q.M1)(),[c,u]=(0,A.eJ)(!1),[p,h]=(0,A.eJ)(!1),m=(0,A.sO)(null);if(!i)return null;let g=n?(0,eo.getDefaultPodcastDescriptionWithoutFeedCTAs)(i,{body:n,hasPodcastPreview:o}):null,v=r||g||"",b=(null!==(t=i5().sanitize)&&void 0!==t?t:i5()().sanitize)(v,{USE_PROFILES:{html:!0}}),y=async e=>{(0,U.j)(U.FP.PODCAST_EPISODE_NOTES_SAVE_CLICKED,{post_id:i?i.id:null}),await a(e),u(!1)};return(0,Z.BX)(i1.g,{label:s||("voiceover"===l?d("Episode Notes"):(0,Z.tZ)(ei.xv.B3,{weight:"semibold",color:"primary",children:d("Show Notes")})),disabled:!!i.hide_from_feed,helpText:d("Changing information here will update your podcast description on external podcast players like Apple Podcasts and Spotify."),className:k()({[nb.disabled]:!!i.hide_from_feed}),action:c?void 0:(0,Z.tZ)(n_.J,{disabled:!0,onClick:()=>u(!0),children:(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",as:"span",className:nb.editText,children:"Edit"})}),children:[c&&(0,Z.tZ)(ny,{hide:!p,initialContent:v,onSave:y,editorRef:m,onEditorReady:()=>{h(!0)},onEditorDestroyed:()=>{h(!1)},setEditing:u}),!p&&(0,Z.tZ)(nf,{content:b})]})};var nw=i(82061),nC=i(24791);let nx={addFreeVersionCheckbox:"addFreeVersionCheckbox-GSkRXK",checked:"checked-EJDLWe"},nS=e=>{var t,i;let{mediaType:n,legacyPodcastUrl:r,file:o,setFile:a,postId:l,pub:s,setPostId:d,onVideoPodcastUploadChanged:c,onRemoveVideoPodcast:u,onPodcastUploadChanged:p,videoUpload:h,podcastUpload:m,podcastPreviewUpload:g,onPodcastPreviewUploadChanged:v,onUploadStarted:b,onUploadCancelled:y,onPreviewUploadStarted:w,onPreviewUploadCancelled:C,askToRemoveLegacyPodcast:x,errors:S,freePodcastUrl:B,freePodcastUrlHasChanged:T,freePodcastUrlIsSaving:I,onClickSaveFreePodcastUrl:N,bylines:P,pendingInvites:E,onBylinesAndInvitesChanged:X,setFreePodcastUrl:M,uploadingPrimary:D,uploadingPreview:R,setUploadingPrimary:F,setUploadingPreview:L,hideFromFeed:z,onHideFromFeedChange:O,selectedSectionId:U,showNotesProps:Y,postMediaComposition:H}=e,{getConfigFor:j}=(0,io.xR)(),{iString:J,language:V}=(0,Q.M1)(),{setPreventChange:q}=(0,ia.y)(),{setUploadProgress:W}=(0,il.z)(),[G,$]=(0,A.eJ)(!!g),[en,er]=(0,A.eJ)(g?"audio_preview":"free_podcast_url"),eo=j("enable_free_podcast_urls"),ea=!!r;return(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(et.tu,{gap:24,children:[(0,Z.BX)(et.tu,{border:"detail",padding:16,radius:"md",shadow:"sm",children:[(0,Z.tZ)(ei.xv.B3,{weight:"semibold",color:"primary",paddingBottom:16,children:J("Create media")}),"video"===n?(0,Z.tZ)(nw.ZP,{language:V,initialFile:o||null,mediaType:"video",pub:s,videoFeature:"podcastDrawer",postId:l,setPostId:d,onProgress:e=>{let{percentComplete:t}=e;W(t)},onChange:e=>{let{mediaUpload:t}=e;F(!1),q(!1),c({mediaUpload:t}),a(null),null===t&&(u({skipConfirm:!0}),O(!1),L(!1),v({mediaUpload:null}),F(!1),p({mediaUpload:null}))},onAudioExtractChange:e=>{let{mediaUpload:t}=e;p({mediaUpload:t})},onUploadStarted:()=>{F(!0),b()},onUploadCanceled:()=>{a(null),F(!1),q(!1),y()},mediaUpload:h,mediaUploadId:null==h?void 0:h.id,audioExtractMediaUpload:m,audioExtractMediaUploadId:null==m?void 0:m.id,audioExtractPreviewMediaUpload:g,audioExtractPreviewMediaUploadId:null==g?void 0:g.id,postMediaComposition:H}):(0,Z.tZ)(iH.Z,{initialFile:o,feature:is.MR.Podcast,mediaType:"audio",pub:s,setPostId:d,postId:l,language:V,onChange:e=>{let{mediaUpload:t}=e;F(!1),p({mediaUpload:t}),a(null)},onUploadStarted:()=>{F(!0),b()},onUploadCanceled:()=>{F(!1),y(),a(null)},mediaUpload:m,mediaUploadId:null==m?void 0:m.id,legacyPodcastUrl:r,onRemoveLegacyUrl:()=>x(),components:{AuditionPlayer:e=>(0,Z.BX)(et.gq,{border:"detail",radius:"sm",alignItems:"center",paddingY:16,paddingX:12,gap:8,children:[(0,Z.tZ)(i0,(0,_._)((0,f._)({},e),{type:"audio"})),(0,Z.tZ)(ee.hU,{priority:"tertiary",onClick:()=>p({mediaUpload:null}),children:(0,Z.tZ)(K.Z,{})})]})}}),"video"===n&&eo&&(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.tZ)(iJ,{error:null!==(t=null==S?void 0:S.free_podcast_url)&&void 0!==t?t:null,isDirty:T,isSaving:I,value:null!=B?B:"",onChange:M,onSave:N})}),!ea&&"audio"===n&&(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",paddingTop:24,paddingBottom:16,children:[(0,Z.tZ)(ei.xv.B3,{weight:"semibold",color:"primary",translated:!0,children:"Options"}),eo&&("free_podcast_url"===en?(0,Z.tZ)(tW.u,{text:J("Remove the free podcast URL to switch"),disabled:!B,children:(0,Z.tZ)(ee.zx,{disabled:!!B,priority:"secondary-outline",size:"sm",onClick:()=>{er("audio_preview")},children:J("Switch to audio preview")})}):(0,Z.tZ)(ee.zx,{priority:"secondary-outline",size:"sm",onClick:()=>{er("free_podcast_url")},children:J("Switch to free podcast URL")}))]}),eo&&"free_podcast_url"===en&&(0,Z.tZ)(iJ,{error:null!==(i=null==S?void 0:S.free_podcast_url)&&void 0!==i?i:null,isDirty:T,isSaving:I,value:null!=B?B:"",onChange:M,onSave:N}),!eo&&(0,Z.tZ)(tW.u,{text:J("Enable payments for your publication to use this feature"),disabled:(0,nC.oH)(s),preferPlacement:"bottom-start",children:(0,Z.tZ)(ic.p,{className:k()(nx.addFreeVersionCheckbox,{[nx.checked]:G},"free-version-checkbox"),isRow:!1,name:"add-free-version",label:J("Add free version"),checked:G,onChange:()=>$(!G),disabled:!(0,nC.oH)(s)||!m||D||R||!!g})}),(eo?"audio_preview"===en:G)&&(0,Z.BX)(Z.HY,{children:[!eo&&(0,Z.tZ)(tX.iz,{paddingY:8}),(0,Z.tZ)(ei.xv.B4,{translated:!0,color:"secondary",paddingBottom:8,children:"Upload or record a different version of your audio for free subscribers."}),(0,Z.tZ)(iH.Z,{initialFile:null,feature:is.MR.PodcastPreview,mediaType:"audio",pub:s,postId:l,setPostId:d,language:V,onChange:e=>{let{mediaUpload:t}=e;L(!1),v({mediaUpload:t})},onUploadStarted:()=>{L(!0),w()},onUploadCanceled:()=>{L(!1),C()},mediaUpload:g,mediaUploadId:null==g?void 0:g.id,onRemoveLegacyUrl:x,components:{AuditionPlayer:e=>(0,Z.BX)(et.gq,{border:"detail",radius:"sm",alignItems:"center",paddingY:16,paddingX:12,gap:8,children:[(0,Z.tZ)(i0,(0,_._)((0,f._)({},e),{type:"audio"})),(0,Z.tZ)(ee.hU,{onClick:()=>v({mediaUpload:null}),children:(0,Z.tZ)(K.Z,{})})]})}})]})]})]}),"video"===n&&(0,Z.tZ)(i4,{askToRemoveLegacyPodcast:x,hideFromFeed:z,language:V,podcastPreviewUpload:g,podcastUpload:m,postId:l,pub:s,selectedSectionId:U,setPostId:d,uploadingPrimary:D,videoUpload:h,onHideFromFeedChange:O,onPodcastPreviewUploadChanged:v,onPodcastUploadChanged:p}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"Guests"}),(0,Z.tZ)(et.hs,{radius:"md",padding:16,border:"detail",shadow:"sm",children:(0,Z.tZ)(id,{postId:l,bylines:P,pendingInvites:E,onChange:X})})]}),(null==h?void 0:h.id)&&(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"Connected Accounts"}),(0,Z.tZ)(et.hs,{radius:"md",padding:16,border:"detail",shadow:"sm",children:(0,Z.tZ)(iU,{mediaUploadId:null==h?void 0:h.id})})]}),(null==Y?void 0:Y.post)&&!(null==Y?void 0:Y.post.hide_from_feed)&&(0,Z.tZ)(et.tu,{className:"editor",children:(0,Z.tZ)(nZ,{post:Y.post,postBody:Y.postBody,hasPodcastPreview:Y.hasPodcastPreview,podcastDescription:Y.podcastDescription,savePodcastDescription:Y.savePodcastDescription,variant:"podcast-drawer",label:(0,Z.tZ)(Z.HY,{children:(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"Show Notes"})})})})]})})};var nk=i(61649),nB=i(39693),nT=i.n(nB),nI=i(24350),nN=i.n(nI),nP=i(71212),nE=i(31131),nX=i(887),nM=i(24353),nA=i(74945),nD=i(10120),nR=i(12281),nF=i(5786),nL=i(53030),nz=i(70717),nO=i(87131),nU=i(12988),nY=i(9799),nH=i(66824);let nj=e=>{var t,i;let{pub:n,videoUpload:r,clip:o,canEdit:a=!1,useCaptions:l=!1,onShareClipLinkToNotes:s,onDownloadClicked:d,aspectRatio:c="standard",surface:u,hoverOptions:p,filters:h}=e,{iString:m}=(0,Q.M1)(),g=(0,nD.r)(),v=(0,A.sO)(null),b=(0,A.sO)(null),y=(0,nL.On)(v),[w,C]=(0,A.eJ)(!1),[x,S]=(0,A.eJ)(!1),B=!y&&!w;(0,A.d4)(()=>{v.current&&v.current.player&&(v.current.player.disablePictureInPicture=!0)},[v.current]);let T=(e,t)=>(0,U.j)(e,(0,_._)((0,f._)({},t),{is_post_editor:!0,video_upload_id:r.id})),I="landscape";(null==r?void 0:r.height)&&(null==r?void 0:r.width)&&(I=r.height>r.width?"portrait":"landscape");let N=(0,nU.SQ)(o,e=>(0,nU.n3)(null==e?void 0:e.mediaUpload)===h.aspectRatio),P=(0,nU.SQ)(o,e=>{var t;return(null==e?void 0:null===(t=e.mediaUpload)||void 0===t?void 0:t.state)==="transcoded"&&(0,nU.n3)(null==e?void 0:e.mediaUpload)===h.aspectRatio}),E=["uploaded","created"].includes(null!==(t=null==N?void 0:N.state)&&void 0!==t?t:""),X={contentType:"clip",surface:"media_drawer"===u?"editor":"post",entityType:"post",entityKey:null!==(i=r.post_id)&&void 0!==i?i:"unknown"};return(0,Z.tZ)(et.gq,{position:"relative",flex:"grow",justifyContent:"center",alignItems:"center",className:nH.Z.container,onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),children:(0,Z.tZ)(ts.xu,{position:"relative",onClick:e=>{e.stopPropagation()},ref:b,style:{width:"100%",height:"100%",overflow:"clip"},children:(0,Z.BX)(nD.I,{handle:g,className:nH.Z.fullScreenContainer,children:[P?(0,Z.BX)(et.hs,{position:"relative",className:nH.Z["playerContainer-".concat(c)],overflow:"hidden",style:{maxWidth:["vertical_fit","vertical_fill"].includes(c)?"".concat(31.64,"%"):void 0,height:"100%",borderRadius:"vertical_fill"===c?0:void 0},children:[(0,Z.tZ)(nR.Z,(0,f._)({ref:v,className:nH.Z["videoContainer-".concat(c)],videoClassName:nH.Z["video-".concat(c)],videoPlayerClassName:k()({[nH.Z.videoPlayer]:"landscape"===c}),pub:n,mediaUpload:P,omitBackgroundColor:!0,noControls:!0,noKeyboardShortcuts:!0,duration:P.duration,renderPlayButton:()=>null,isClip:!0,videoType:"clip"},X),"".concat(o.id,"-").concat(null==P?void 0:P.id)),(0,Z.tZ)(nO.Vo,{pub:n,mediaRef:v,mediaUpload:P,handle:g,isActive:w,size:"sm",isFocused:!0,showPaywall:!1,hideCaptions:!0,disableShortcuts:!0,onBlur:()=>{var e,t;return null===(t=v.current)||void 0===t?void 0:null===(e=t.player)||void 0===e?void 0:e.pause()},hoverOptions:p},"".concat(null==r?void 0:r.id,"-controls"))]}):"portrait"===I?(0,Z.BX)(et.hs,{position:"relative",overflow:"hidden",style:{height:"100%"},children:[(0,Z.tZ)(nR.Z,(0,f._)({ref:v,videoPlayerClassName:nH.Z["playerContainer-vertical"],pub:n,mediaUpload:r,omitBackgroundColor:!0,noControls:!0,noKeyboardShortcuts:!0,duration:r.duration,renderPlayButton:()=>null,isClip:!0,videoType:"clip"},X),"".concat(o.id,"-").concat(null==r?void 0:r.id)),(0,Z.tZ)(nO.to,{pub:n,mediaRef:v,mediaUpload:r,handle:g,isActive:w,startTime:o.start_time,duration:o.duration,size:"sm",useCaptions:l,captionsStyle:{maxWidth:"75%",fontSize:g.active?48:16,paddingBottom:5},hoverOptions:p,onBlur:()=>{var e,t;return null===(t=v.current)||void 0===t?void 0:null===(e=t.player)||void 0===e?void 0:e.pause()}},"".concat(null==r?void 0:r.id,"-controls"))]}):(0,Z.BX)(et.hs,{position:"relative",className:nH.Z["playerContainer-".concat(c)],overflow:"hidden",style:{maxWidth:["vertical_fit","vertical_fill"].includes(c)?"".concat(31.64,"%"):void 0,height:"100%",borderRadius:"vertical_fill"===c?0:void 0},children:[(0,Z.tZ)(nR.Z,(0,f._)({ref:v,className:nH.Z["videoContainer-".concat(c)],videoClassName:nH.Z["video-".concat(c)],videoPlayerClassName:k()({[nH.Z.videoPlayer]:"landscape"===c}),pub:n,mediaUpload:r,omitBackgroundColor:!0,noControls:!0,noKeyboardShortcuts:!0,duration:r.duration,renderPlayButton:()=>null,isClip:!0,videoType:"clip"},X),"".concat(o.id,"-").concat(null==r?void 0:r.id)),(0,Z.tZ)(nO.to,{pub:n,mediaRef:v,mediaUpload:r,handle:g,isActive:w,startTime:o.start_time,duration:o.duration,size:"sm",useCaptions:l,captionsStyle:"vertical_fill"===c?{maxWidth:"75%",fontSize:g.active?42:14,paddingBottom:20}:"vertical_fit"===c?{maxWidth:"75%",fontSize:g.active?48:16,paddingBottom:20}:"landscape"===c?{maxWidth:"60%",fontSize:g.active?60:20,paddingBottom:20}:{maxWidth:"75%",fontSize:g.active?60:18,paddingBottom:0},hoverOptions:p,onBlur:()=>{var e,t;return null===(t=v.current)||void 0===t?void 0:null===(e=t.player)||void 0===e?void 0:e.pause()}},"".concat(null==r?void 0:r.id,"-controls"))]}),E&&(0,Z.tZ)(et.gq,{alignItems:"center",gap:6,position:"absolute",radius:"sm",style:{left:8,top:8,backdropFilter:"var(--material-blur)",backgroundBlendMode:"overlay, normal",background:"var(--material-dark-regular)"},paddingX:8,paddingY:6,children:(0,Z.tZ)(tW.u,{text:m("Clip is being exported. This might take a few minutes. We'll send you an email when is ready."),children:(0,Z.tZ)(et.gq,{gap:4,justifyContent:"center",alignItems:"center",children:(0,Z.tZ)(ei.xv.B4,{weight:"semibold",color:"white",children:m("Downloading...")})})})}),B&&!g.active&&(0,Z.tZ)(nz.w,{duration:o.duration,icon:"ai"===o.source?(0,Z.tZ)(nA.Z,{color:"white",size:14}):null,position:"bottom-right"}),a&&!g.active&&(0,Z.tZ)(et.hs,{position:"absolute",style:{top:10,right:10},children:(0,Z.BX)(et.tu,{gap:4,alignItems:"end",children:[(0,Z.tZ)(nF.H,{label:m("Share"),children:(0,Z.tZ)(nF.o,{size:"sm",onClick:async()=>{T(U.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"share_to_notes",source:"media_drawer"}),S(!0),await (null==s?void 0:s()),S(!1)},children:x?(0,Z.tZ)(iI.$j,{size:20}):(0,Z.tZ)(nE.Z,{size:14})})}),E?(0,Z.tZ)(nF.H,{label:null,children:(0,Z.tZ)(tW.u,{text:m("Clip is being exported. This might take a few minutes. We'll send you an email when is ready."),children:(0,Z.tZ)(et.hs,{style:{cursor:"not-allowed"},children:(0,Z.tZ)(et.hs,{style:{opacity:.5,pointerEvents:"none"},children:(0,Z.tZ)(nF.o,{size:"sm",children:(0,Z.tZ)(nP.Z,{size:14})})})})})}):(0,Z.tZ)(nF.H,{label:E?null:m("Download"),children:(0,Z.tZ)(et.hs,{style:E?{cursor:"not-allowed"}:void 0,children:(0,Z.tZ)(et.hs,{style:E?{opacity:.5,pointerEvents:"none"}:void 0,children:(0,Z.tZ)(nF.o,{size:"sm",onClick:async()=>{if(T(U.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"start_download_export",source:"media_drawer"}),P){var e,t,i,n;try{await (0,nY.I)(P,null!==(t=o.title)&&void 0!==t?t:"".concat(null!==(e=r.name)&&void 0!==e?e:r.post_id,"_clip"))}catch(e){try{await (0,nY.I)(P,null!==(n=o.title)&&void 0!==n?n:"".concat(null!==(i=r.name)&&void 0!==i?i:r.post_id,"_clip"),"mp4")}catch(e){null==d||d()}}}else null==d||d()},children:(0,Z.tZ)(nP.Z,{size:14})})})})})]})})]})})},"".concat(o.id,"-").concat(null==r?void 0:r.id))},nJ=e=>{var t,i;let{pub:n,videoUpload:r,clip:o,onClipRemoved:a,onShareClipLinkToNotes:l,onRenameClipClicked:s,onDownloadClipClicked:d,onCloneClipClicked:c,filters:u}=e,p=(0,iN.pm)(),{iString:h}=(0,Q.M1)(),[m,g]=(0,A.eJ)(!1),v=(null==r?void 0:null===(i=r.extractedAudio)||void 0===i?void 0:null===(t=i.transcription)||void 0===t?void 0:t.status)==="transcribed",[b,y]=(0,A.eJ)(!1),w=async()=>{try{g(!0),await N().delete("/api/v1/video/assets/".concat(r.id,"/clips/").concat(o.id)),null==a||a(o.id),p.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:h("Removed clip.")})))}catch(e){console.error(e)}finally{g(!1)}};return(0,Z.BX)(nV,{children:[(0,Z.tZ)(nj,{pub:n,videoUpload:r,clip:o,canEdit:!m,onShareClipLinkToNotes:l,onDownloadClicked:d,useCaptions:v,hoverOptions:{transition:0,transitionDelay:0},filters:u}),(0,Z.BX)(nq,{children:[(0,Z.BX)(nW,{children:[o.title&&(0,Z.tZ)(ei.xv.B3,{color:"primary",weight:"semibold",clamp:2,title:o.title,children:o.title}),o.description&&(0,Z.BX)(ei.xv.B4,{color:"secondary",cursor:"pointer",children:[(0,er.truncateText)(o.description,b?Number.MAX_SAFE_INTEGER:160)," ",o.description.length>160&&(0,Z.tZ)(ei.hh,{color:"secondary",weight:"semibold",cursor:"pointer",onClick:()=>y(!b),children:b?h("Show less"):h("Show more")})]})]}),(0,Z.tZ)(nG,{onRenameClipClicked:s,onCloneClipClicked:c,onDownloadClipClicked:d,onShareClipLinkToNotes:l,removeClip:w,videoUpload:r})]})]})},nV=(0,ts.zo)({display:"flex",direction:"column",flex:"grow",radius:"sm",bg:"primary",overflow:"hidden",position:"relative",className:"container-FaTwKo"}),nq=(0,ts.zo)({display:"flex",direction:"row",padding:12,justifyContent:"space-between"}),nW=(0,ts.zo)({display:"flex",direction:"column",flex:"grow",gap:2,justifyContent:"center"}),nG=e=>{let{onRenameClipClicked:t,onCloneClipClicked:i,onDownloadClipClicked:n,onShareClipLinkToNotes:r,removeClip:o,videoUpload:a}=e,{iString:l}=(0,Q.M1)(),s=(0,A.I4)((e,t)=>{a&&(0,U.j)(e,(0,_._)((0,f._)({},t),{is_post_editor:!0,video_upload_id:a.id}))},[a]),d=n||r,c=i||t;return(0,Z.BX)(tC.v2,{layerOptions:{placement:"bottom-end"},trigger:(0,Z.tZ)(ee.hU,{size:"xs",priority:"tertiary",children:(0,Z.tZ)(iV.Z,{size:16})}),children:[d&&(0,Z.BX)(tC.xw,{isFirst:!0,children:[n&&(0,Z.tZ)(tC.sN,{onClick:()=>{s(U.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"download",source:"media_drawer"}),null==n||n()},leading:(0,Z.tZ)(nP.Z,{}),children:l("Download")}),r&&(0,Z.tZ)(tC.sN,{onClick:()=>{s(U.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"share",source:"media_drawer"}),null==r||r()},leading:(0,Z.tZ)(nE.Z,{}),children:l("Share")})]}),c&&(0,Z.BX)(tC.xw,{isFirst:!d,children:[i&&(0,Z.tZ)(tC.sN,{onClick:()=>{s(U.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"edit",source:"media_drawer"}),null==i||i()},leading:(0,Z.tZ)(nX.Z,{}),children:l("Edit")}),t&&(0,Z.tZ)(tC.sN,{onClick:()=>{s(U.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"rename",source:"media_drawer"}),null==t||t()},leading:(0,Z.tZ)(nM.Z,{}),children:l("Rename")})]}),o&&(0,Z.tZ)(tC.xw,{isFirst:!d&&!c,children:(0,Z.tZ)(tC.sN,{onClick:()=>{s(U.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"delete",source:"media_drawer"}),null==o||o()},priority:"destructive",leading:(0,Z.tZ)(iW.Z,{}),children:l("Remove")})})]})};var nK=i(25784);let nQ=e=>{let{carouseSelectedIndex:t,setCarouselSelectedIndex:i,selectedClip:n,existingClips:r,pub:o,post:a,videoUpload:l,onClipRemoved:s,canEdit:d,onClipUpdated:c,setEditState:u,handleShareClipLinkToNotes:p,filters:h}=e,m=t===r.length-1;return(0,Z.BX)(et.sg,{gap:12,children:[(0,Z.tZ)(ts.xu,{position:"relative",children:(0,Z.tZ)(nJ,{pub:o,clip:n,videoUpload:l,onClipRemoved:s,canEdit:d,onClipUpdated:e=>c(e),onDownloadClipClicked:()=>u({clip:n,action:"download"}),onShareClipLinkToNotes:()=>p({clip:n,isPublished:a.is_published}),filters:h},"".concat(n.id,"-").concat(null==l?void 0:l.id))}),r.length>1&&(0,Z.tZ)(n$,{isAtStart:0===t,isAtEnd:m,setCarouselSelectedIndex:i,carouseSelectedIndex:t,existingClips:r})]})},n$=e=>{let{isAtStart:t,isAtEnd:i,setCarouselSelectedIndex:n,carouseSelectedIndex:r,existingClips:o}=e;return(0,Z.BX)(nK.tl,{children:[(0,Z.BX)(et.X2,{gap:8,children:[(0,Z.tZ)(nK.Gt,{onClick:()=>n(0),disabled:t}),(0,Z.tZ)(nK.FS,{onClick:()=>n(r-1),disabled:t})]}),(0,Z.tZ)(nK.bp,{currentPage:r+1,totalPages:o.length}),(0,Z.BX)(et.X2,{gap:8,children:[(0,Z.tZ)(nK.$W,{onClick:()=>n(r+1),disabled:i}),(0,Z.tZ)(nK.kt,{onClick:()=>n(o.length-1),disabled:i})]})]})};var n0=i(40423),n1=i(45790);let n2=e=>{let{onGenerateClick:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(Z.HY,{children:(0,Z.tZ)(tp._Y,{title:i("Something went wrong"),text:i("Please try again"),icon:(0,Z.tZ)(eL.Z,{}),action:(0,Z.tZ)(et.gq,{gap:8,children:(0,Z.tZ)(ee.zx,{size:"sm",priority:"primary-mono",onClick:()=>{(0,U.j)(U.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"retry",source:"media_drawer"}),t()},children:i("Retry")})})})})},n4=e=>{let{videoHasNoAudio:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(tp._Y,{title:i("No clips created"),text:i(t?"Clips couldn't be generated because the video has no audio":"Automatically generate new clips or create a custom clip"),icon:(0,Z.tZ)(n0.Z,{size:24})})},n3=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(tp._Y,{title:e("No video yet"),text:e("Clips will be automatically generated once a video is uploaded"),icon:(0,Z.tZ)(n1.Z,{size:24})})},n8=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(tp._Y,{title:e("Generating transcription"),text:e("Clips will be automatically generated once the transcription is available"),icon:(0,Z.tZ)(iI.$j,{padding:0})})},n6=e=>{let{cancelRequest:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(tp._Y,{title:i("Generating clips"),text:i("This may take a few minutes"),icon:(0,Z.tZ)(iI.$j,{padding:0}),action:(0,Z.tZ)(ee.zx,{priority:"secondary",size:"sm",onClick:()=>{(0,U.j)(U.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"cancel generate",source:"media_drawer"}),t()},children:i("Cancel")})})};var n5=i(59663),n9=i(46299),n7=i(22885),re=i(60807);let rt=e=>{let{disabled:t,onClipSuggestionsGeneration:i,onSendPushNotification:n,onDownloadClips:r,onStartClipping:o,filters:a,setFilters:l}=e,s=(0,re.aF)();return(0,Z.BX)(et.gq,{gap:8,justifyContent:"end",children:[(0,Z.tZ)(ro,{aspectRatio:a.aspectRatio,setAspectRatio:e=>l((0,_._)((0,f._)({},a),{aspectRatio:e}))}),(null==s?void 0:s.is_global_admin)&&(0,Z.tZ)(rr,{disabled:t,onClipSuggestionsGeneration:i,onSendPushNotification:n}),(0,Z.tZ)(ri,{disabled:t,onClick:r}),(0,Z.tZ)(rn,{disabled:t,onClick:()=>o({source:"editor",title:null})})]})},ri=e=>{let{disabled:t,onClick:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary",disabled:t,onClick:i,leading:(0,Z.tZ)(nP.Z,{size:16}),children:n("Download all")})},rn=e=>{let{disabled:t,onClick:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{size:"sm",priority:"primary-mono",disabled:t,onClick:()=>{(0,U.j)(U.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"create",source:"media_drawer"}),i()},leading:(0,Z.tZ)(ta.Z,{size:16}),children:n("Create")})},rr=e=>{let{disabled:t,onClipSuggestionsGeneration:i,onSendPushNotification:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(et.gq,{flex:"grow",children:(0,Z.BX)(tC.v2,{layerOptions:{placement:"bottom-end"},trigger:(0,Z.tZ)(ee.hU,{size:"sm",priority:"secondary-outline",disabled:t,onClick:()=>{i()},children:(0,Z.tZ)(iV.Z,{size:16})}),children:[(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(nA.Z,{}),onClick:()=>{i()},children:r("Generate clips")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(nA.Z,{}),onClick:()=>{i("opus")},children:r("Generate opus clips")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(nA.Z,{}),onClick:()=>{i("vizard")},children:r("Generate vizard clips")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(n5.Z,{}),onClick:()=>{n()},children:r("Send push notification")})]})})},ro=e=>{let{aspectRatio:t,setAspectRatio:i,buttonProps:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(tC.v2,{layerOptions:{placement:"bottom-start"},trigger:(0,Z.tZ)(ee.zx,(0,_._)((0,f._)({size:"sm",priority:"secondary-outline",trailing:(0,Z.tZ)(tw.Z,{}),leading:"portrait"===t?(0,Z.tZ)(n9.Z,{size:16}):(0,Z.tZ)(n7.Z,{size:16})},n),{children:"portrait"===t?r("Portrait"):r("Landscape")})),children:nU.Hb.map(e=>(0,Z.tZ)(tC.sN,{leading:"portrait"===e?(0,Z.tZ)(n9.Z,{}):(0,Z.tZ)(n7.Z,{}),onClick:()=>i(e),children:"portrait"===e?r("Portrait"):r("Landscape")}))})},ra=e=>{let{pageClips:t,totalPages:i,page:n,setPage:r,pub:o,post:a,videoUpload:l,onClipRemoved:s,canEdit:d,onClipUpdated:c,handleShareClipLinkToNotes:u,setEditState:p,onStartClipping:h,filters:m}=e,{iString:g}=(0,Q.M1)();return(0,Z.BX)(et.tu,{flex:"grow",children:[(0,Z.tZ)(et.tu,{gap:12,flex:"grow",overflowY:"auto",scrollBar:"hidden",children:t.map(e=>(0,Z.tZ)(ts.xu,{children:(0,Z.tZ)(nJ,{pub:o,clip:e,videoUpload:l,onClipRemoved:s,canEdit:d,onClipUpdated:e=>c(e),onShareClipLinkToNotes:async()=>{await u({clip:e,isPublished:a.is_published})},onRenameClipClicked:()=>p({clip:e,action:"rename"}),onDownloadClipClicked:()=>p({clip:e,action:"download",source:"media_drawer"}),onCloneClipClicked:()=>h({start:e.start_time,end:e.start_time+e.duration,title:"".concat(g("Copy of")," ").concat(e.title),source:"editor"}),filters:m})},e.id))}),i>1&&(0,Z.tZ)(et.gq,{justifyContent:"center",paddingY:12,children:(0,Z.BX)(nK.tl,{children:[(0,Z.tZ)(nK.FS,{onClick:()=>{r(n-1)},disabled:0===n}),(0,Z.tZ)(nK.bp,{currentPage:n+1,totalPages:i}),(0,Z.tZ)(nK.$W,{onClick:()=>{r(n+1)},disabled:n===i-1})]})})]})};var rl=i(72355);let rs=e=>{var t;let{videoUpload:i,clip:n,onClipUpdated:r,isOpen:o,onClose:a}=e,l=(0,iN.pm)(),{iString:s}=(0,Q.M1)(),[d,c]=(0,A.eJ)(!1),[u,p]=(0,A.eJ)(null!==(t=n.title)&&void 0!==t?t:""),h=(0,A.sO)(null),m=(e,t)=>(0,U.j)(e,(0,_._)((0,f._)({},t),{is_post_editor:!0,video_upload_id:i.id}));(0,A.d4)(()=>{o&&setTimeout(()=>{var e;null==h||null===(e=h.current)||void 0===e||e.focus()},50)},[o]);let g=async()=>{if(!(u.length>=5&&u.length<=255)){l.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:s("Please enter a title between 5 and 255 characters long.")})));return}try{c(!0);let{body:e}=await N().put("/api/v1/video/assets/".concat(i.id,"/clips/").concat(n.id)).send({title:u});null==r||r(e),a(),l.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:s("Saved clip title.")})))}catch(e){console.error(e)}finally{c(!1)}};return(0,Z.tZ)(eK.u_,{isOpen:o,onClose:a,children:(0,Z.BX)(tU.w,{children:[(0,Z.tZ)(eK.xB,{title:s("Rename clip"),showClose:!0,onClose:a,showDivider:!0}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{children:s("Clip name")}),(0,Z.tZ)(tD.oi,{ref:h,placeholder:s("Enter a name"),value:u,onChange:e=>p(e.currentTarget.value)})]})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{disabled:d,onClick:()=>{m(U.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"save",source:"rename modal"}),g()},children:s("Save")}),secondaryButton:(0,Z.tZ)(ee.zx,{disabled:d,onClick:()=>{m(U.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"cancel",source:"rename modal"}),a()},priority:"secondary",children:s("Cancel")})})]})})};var rd=i(46543),rc=i(54687),ru=i(57952),rp=i(43905);let rh=e=>{let{label:t,value:i,onChange:n}=e,[r,o]=(0,A.eJ)((0,rp.mr)(i,{decimals:1}));return(0,A.d4)(()=>{o((0,rp.mr)(i,{decimals:1}))},[i]),(0,Z.tZ)(tD.oi,{"aria-label":t,style:{width:100,textAlign:"center"},value:r,onBlur:()=>{n(rm(r))},onChange:e=>{o(e.currentTarget.value)},onKeyDown:e=>{if(" "!==e.key?e.stopPropagation():e.preventDefault(),"ArrowLeft"===e.key||"ArrowDown"===e.key){let t=e.shiftKey||e.metaKey?1:.1;n(Math.max(rm(r)-t,0)),e.preventDefault()}if("ArrowRight"===e.key||"ArrowUp"===e.key){let t=e.shiftKey||e.metaKey?1:.1;n(rm(r)+t),e.preventDefault()}}})},rm=e=>{let t=e.trim();for(let{regex:e,factors:i}of[{regex:/^(\d+):(\d+):([\d.]+)$/,factors:[3600,60,1]},{regex:/^(\d+)h(\d+)m([\d.]+)s?$/,factors:[3600,60,1]},{regex:/^(\d+)h(\d+)m$/,factors:[3600,60]},{regex:/^(\d+)h([\d.]+)s?$/,factors:[3600,1]},{regex:/^(\d+)h$/,factors:[3600]},{regex:/^(\d+):([\d.]+)$/,factors:[60,1]},{regex:/^(\d+)m([\d.]+)s?$/,factors:[60,1]},{regex:/^(\d+)m$/,factors:[60]},{regex:/^([\d.]+)s?$/,factors:[1]}]){let n=t.match(e);if(n)return n.slice(1).reduce((e,t,n)=>e+parseFloat(t)*i[n],0)}let i=parseFloat(t);return isNaN(i)?(console.error("Invalid time format:",e),0):i};var rg=i(10656),rv=i(18618),rb=i(23493),ry=i.n(rb),rf=i(37513),r_=i(42861),rZ=i(8746),rw=i(33224),rC=i(74571);let rx=e=>{let{clipWordAndRowIndices:t,containerRef:i,onFinishSelection:n}=e,[r,o]=(0,A.eJ)(!1),[a,l]=(0,A.eJ)(!1),[s,d]=(0,A.eJ)(!1),[c,u]=(0,A.eJ)(!1),[p,h]=(0,A.eJ)(null),[m,g]=(0,A.eJ)(null),v=p&&m&&(m.rowIndex<p.rowIndex||m.rowIndex===p.rowIndex&&m.wordIndex<p.wordIndex),b=v?m:p,y=v?p:m,f=(0,A.I4)(()=>{u(!1),d(!1),h(null),g(null);let e=window.getSelection();e&&(e.removeAllRanges?e.removeAllRanges():e.empty&&e.empty())},[]),_=(0,A.I4)(()=>{b&&y&&(n({selectionBegin:b,selectionFinish:y}),f())},[f,n,b,y]);return(0,A.d4)(()=>{if(!i.current)return;let e=i.current,n=e=>{let i=Number(e.target.dataset.rowIndex),n=Number(e.target.dataset.wordIndex);isNaN(i)||isNaN(n)||(o(!0),t&&t.startRowIndex===i&&t.startWordIndex===n?h({rowIndex:t.endRowIndex,wordIndex:t.endWordIndex}):t&&t.endRowIndex===i&&t.endWordIndex===n?h({rowIndex:t.startRowIndex,wordIndex:t.startWordIndex}):h({rowIndex:i,wordIndex:n}),g({rowIndex:i,wordIndex:n}))},c=e=>{let t=Number(e.target.dataset.rowIndex),i=Number(e.target.dataset.wordIndex);if(!(isNaN(t)||isNaN(i))){if(r&&!a){l(!0),d(!0),g({rowIndex:t,wordIndex:i});return}if(a||s){g({rowIndex:t,wordIndex:i});return}}},u=()=>{if(o(!1),!a){f();return}l(!1),_()};return e.addEventListener("mousedown",n),e.addEventListener("mousemove",c),e.addEventListener("mouseup",u),()=>{e.removeEventListener("mousedown",n),e.removeEventListener("mousemove",c),e.removeEventListener("mouseup",u)}},[f,t,i,_,a,r,c,s,p]),{clearSelection:f,isSelecting:s,containerRef:i,selectionBegin:b,selectionFinish:y,onClickWord:(0,A.I4)(e=>{let{rowIndex:t,wordIndex:i}=e;n({selectionBegin:{rowIndex:t,wordIndex:i},selectionFinish:{rowIndex:t,wordIndex:i}})},[n])}};var rS=i(57649),rk=i(1864),rB=i(18029),rT=i.n(rB);let rI={textContainerEditor:"textContainerEditor-zrR0JE",hideSelectionBackground:"hideSelectionBackground-Vfr3AW",word:"word-hNy06k",wordSelectedEditor:"wordSelectedEditor-r6tOqi",wordClippedEditor:"wordClippedEditor-Kb4suq",wordAtClipStart:"wordAtClipStart-anGYp_",wordAtClipEnd:"wordAtClipEnd-D8hluK",wordIsSelecting:"wordIsSelecting-GIFGaq",textHidden:"textHidden-LjKsuF",searchResult:"searchResult-Ncw33Z",isFocused:"isFocused-DSCwQ9"},rN=(0,to.memo)(e=>{var t;let{clipBoundaryEnd:i,clipBoundaryStart:n,clipWordEnd:r,clipWordStart:o,focusedItemStart:a,isMeasuring:l,isSelecting:s,rowIndex:d,rows:c,searchTerm:u,selectedWordEnd:p,selectedWordStart:h,speakerMap:m,onClickWord:g}=e,v=(0,A.sO)(null),b=c[d];if(!b)return null;let y=0===d?null:c[d-1],w=d===c.length-1?null:c[d+1],C=0===d?null:c[d-1],x=(!C||C.speaker!==b.speaker)&&b.speaker?null!==(t=m[b.speaker])&&void 0!==t?t:function(e){if(!e)return"Unknown Speaker";let t=e.split("_"),i=parseInt(t[1]);return"".concat(rT()(t[0])," ").concat(i+1)}(b.speaker):null,S=u&&b.text.toLowerCase().includes(u.toLowerCase()),B=y?{"data-in-between":!0,"data-prev-row-index":d-1,"data-prev-word-index":y.words.length-1,"data-next-row-index":d,"data-next-word-index":0}:{},T=w?{"data-in-between":!0,"data-prev-row-index":d,"data-prev-word-index":b.words.length-1,"data-next-row-index":d+1,"data-next-word-index":0}:{};return(0,Z.BX)(et.gq,{alignItems:"start",gap:12,paddingX:16,"data-transcript-row-index":d,style:l?{overflowY:"scroll"}:void 0,children:[(0,Z.tZ)(et.gq,{paddingX:4,radius:"sm",userSelect:"none",children:(0,Z.tZ)(ei.xv.Meta,{color:"secondary",lineHeight:20,children:(0,er.secondsToHHMMSS)(b.start)})}),(0,Z.BX)(et.tu,{flex:"grow",gap:2,children:[x&&(0,Z.tZ)(ei.xv.Meta,(0,_._)((0,f._)({color:"pub-accent",userSelect:"none",weight:"semibold"},B),{children:x})),(0,Z.BX)(et.tu,{position:"relative",children:[S&&(0,Z.tZ)(rP,{isFocused:b.start===a,searchTerm:u,text:b.text.trim()}),(0,Z.tZ)(et.tu,{ref:v,position:"relative",children:(0,Z.tZ)(ei.xv.B3,(0,_._)((0,f._)({className:k()(rI.hideSelectionBackground,rI.textContainerEditor),cursor:"pointer",lineHeight:20,paddingBottom:12},T),{children:b&&b.words.length?b.words.map((e,t)=>{var a,l,c,u,m;let v=!(eS()(h)||eS()(p))&&t>=h&&t<=p,b=!eS()(r)&&!eS()(o)&&t>=o&&t<=r;return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("span",{className:k()(rI.word,{[null!==(a=rI.wordSelectedEditor)&&void 0!==a?a:"undefined"]:v,[null!==(l=rI.wordClippedEditor)&&void 0!==l?l:"undefined"]:b&&!s,[null!==(c=rI.wordAtClipStart)&&void 0!==c?c:"undefined"]:n===t,[null!==(u=rI.wordAtClipEnd)&&void 0!==u?u:"undefined"]:i===t,[null!==(m=rI.wordIsSelecting)&&void 0!==m?m:"undefined"]:s}),"data-row-index":d,"data-word-index":t,onClick:g?()=>g({rowIndex:d,wordIndex:t}):void 0,children:e.word})," "]})}):null==b?void 0:b.text}))})]})]})]})}),rP=e=>{let{searchTerm:t,isFocused:i,text:n}=e,r=RegExp("(".concat(t,")"),"gi"),o=n.split(r);return(0,Z.tZ)(ei.xv.B3,{className:rI.textHidden,position:"absolute",inset:0,children:o.map(e=>{var t;return e.match(r)?(0,Z.tZ)("span",{className:k()(rI.searchResult,{[null!==(t=rI.isFocused)&&void 0!==t?t:"undefined"]:i}),children:e}):(0,Z.tZ)("span",{children:e})})})},rE=(0,to.memo)(e=>{let{style:t,index:i,data:n}=e,{clipWordAndRowIndices:r,rows:o,selectionBegin:a,selectionFinish:l,speakerMap:s,onClickWord:d}=n,{searchTerm:c,focusedItemStart:u}=(0,ru.pH)(),p=o[i],h=null,m=null;if(a&&l){let e=i===a.rowIndex&&i===l.rowIndex,t=i===a.rowIndex,n=i===l.rowIndex,r=i>a.rowIndex&&i<l.rowIndex;e?(h=a.wordIndex,m=l.wordIndex):t&&p?(h=a.wordIndex,m=p.words.length-1):n?(h=0,m=l.wordIndex):r&&p&&(h=0,m=p.words.length-1)}let g=null,v=null;return r&&(i===r.startRowIndex?g=r.startWordIndex:i>r.startRowIndex&&i<=r.endRowIndex&&(g=0),i===r.endRowIndex?v=r.endWordIndex:i>=r.startRowIndex&&i<r.endRowIndex&&p&&(v=p.words.length-1)),(0,Z.tZ)("div",{className:rI.hideSelectionBackground,style:t,children:(0,Z.tZ)(rN,{clipBoundaryEnd:l&&a?i===l.rowIndex?l.wordIndex:null:r&&i===r.endRowIndex?r.endWordIndex:null,clipBoundaryStart:l&&a?i===a.rowIndex?a.wordIndex:null:r&&i===r.startRowIndex?r.startWordIndex:null,clipWordEnd:v,clipWordStart:g,focusedItemStart:u,isSelecting:!!(a&&l),rows:o,rowIndex:i,searchTerm:c,selectedWordStart:h,selectedWordEnd:m,speakerMap:s,onClickWord:d})})},rk.wy),rX=e=>{let{clipWordAndRowIndices:t,height:i,id:n,listRef:r,rows:o,selectionBegin:a,selectionFinish:l,speakerMap:s,width:d,onClickRow:c,onClickWord:u,onScroll:p}=e,[h,m]=(0,A.eJ)(null);(0,A.bt)(()=>{if(h||!d)return;let e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.width="".concat(d,"px"),e.style.pointerEvents="none",e.style.visibility="hidden",m(e),document.body.appendChild(e)},[h,d]);let g=(0,A.I4)(e=>h?(h.innerHTML=(0,rS.Dq)((0,Z.tZ)(rN,{isMeasuring:!0,rows:o,rowIndex:e,selectedWordEnd:null,selectedWordStart:null,speakerMap:s})),h.clientHeight||0):0,[h,o,s]),v=(0,A.Ye)(()=>({clipWordAndRowIndices:t,rows:o,selectionBegin:a,selectionFinish:l,speakerMap:s,onClickRow:c,onClickWord:u}),[t,o,a,l,s,c,u]);return h?(0,Z.tZ)("div",{id:n,children:(0,Z.tZ)(rk.S_,{ref:r,itemCount:o.length,itemSize:g,height:i,width:d,itemData:v,outerElementType:rM,useIsScrolling:!0,onScroll:p,children:rE})}):null},rM=(0,to.forwardRef)((e,t)=>{var{style:i}=e,n=(0,ef._)(e,["style"]);return(0,Z.tZ)("div",(0,f._)({ref:t,style:(0,_._)((0,f._)({},i),{overflowY:"scroll"})},n))});var rA=i(61468);let rD="video-transcription",rR=e=>{let{playerRef:t,postId:i,videoUpload:n,transcription:r}=e,{iString:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(!1),{clipTimes:s,virtualizedListRef:d,onStartClipping:c}=(0,nk.Sr)(),u=(0,A.sO)(null),p=(0,A.sO)(null),{rows:h,speakerMap:m}=(0,rC.Oi)({transcription:r,processAlignedRows:rA.Ap}),g=(0,A.Ye)(()=>{if(!s)return null;let e=rF(h,s.start),t=rF(h,s.end);if(-1===e||-1===t)return null;let i=h[e].words.findIndex(e=>s.start<=e.end),n=h[t].words.findIndex((e,i)=>{var n;return i===h[t].words.length-1||s.end>=e.start&&s.end<=(null===(n=h[t].words[i+1])||void 0===n?void 0:n.start)});return{startRowIndex:e,startWordIndex:i,endRowIndex:t,endWordIndex:n}},[s,h]),{setItems:v,focusedItemStart:b,searchTerm:y}=(0,ru.pH)(),{width:w,height:C}=(0,rZ.y)({containerRef:u}),[x,S]=(0,A.eJ)("in-view"),k=!!(null==y?void 0:y.trim()),B=(e,t)=>(0,U.j)(e,(0,_._)((0,f._)({},t),{is_post_editor:!0,video_upload_id:n.id})),{isSelecting:T,selectionBegin:I,selectionFinish:N,onClickWord:P}=rx({clipWordAndRowIndices:g,containerRef:p,onFinishSelection:(0,A.I4)(e=>{let{selectionBegin:t,selectionFinish:i}=e,{start:n,end:r}=(0,rw.up)({finishedSelection:{begin:t,finish:i},transcriptionRows:h});B(U.FP.MEDIA_CLIP_SELECTION_MADE,{start_time:n,end_time:r,source:"transcript"}),S("in-view"),c({start:n,end:r,source:"side-by-side-transcript",title:null})},[c,h,n.id])}),E=s&&rF(h,s.start),X=s&&rF(h,s.end);(0,to.useEffect)(()=>{v(h)},[h,v]),(0,to.useEffect)(()=>{var e,i,n,r;!T||(null===(i=t.current)||void 0===i?void 0:null===(e=i.player)||void 0===e?void 0:e.paused)||null===(r=t.current)||void 0===r||null===(n=r.player)||void 0===n||n.pause()},[T,t]),(0,to.useEffect)(()=>{if(!k||!(null==d?void 0:d.current))return;let e=h.findIndex(e=>e.start===b);d.current.scrollToItem(e,"start")},[b,k,h,d]);let M=(0,A.I4)(ry()(()=>{if(eS()(E)||eS()(X))return;let e=document.querySelector("#".concat(rD,' [data-transcript-row-index="').concat(E,'"]')),t=document.querySelector("#".concat(rD,' [data-transcript-row-index="').concat(X,'"]')),i=document.querySelector("#".concat(rD," [data-transcript-row-index]"));if(!i)return;let n=(null==i?void 0:i.dataset.transcriptRowIndex)?parseInt(i.dataset.transcriptRowIndex):-1;if(e||t||n>E&&n<X){S("in-view");return}S(n>E?"is-before":"is-after")},100),[X,E]),D=(0,A.I4)(e=>{let{scrollUpdateWasRequested:t}=e;t||M()},[M]),R=(0,A.I4)(()=>{(null==d?void 0:d.current)&&(d.current.scrollToItem(E,"start"),S("in-view"),l(!0))},[E,d]);return(0,to.useEffect)(()=>{a||R()},[R,a]),(0,Z.BX)(et.tu,{inset:0,paddingTop:16,position:"absolute",children:[(0,Z.tZ)(et.gq,{paddingX:16,paddingBottom:16,onKeyDown:e=>{e.stopPropagation()},children:(0,Z.tZ)(ru.Rq,{postId:i,closeAlwaysVisible:!1})}),(0,Z.BX)(et.tu,{ref:u,flex:"grow",position:"relative",children:[(0,Z.tZ)(et.tu,{ref:p,position:"absolute",inset:0,children:!!w&&(0,Z.tZ)(rX,{clipWordAndRowIndices:g,height:C,id:rD,listRef:d,rows:h,selectionBegin:I,selectionFinish:N,speakerMap:m,width:w,onClickWord:P,onScroll:D})}),!T&&"in-view"!==x&&(0,Z.tZ)(et.tu,{position:"absolute",style:(0,f._)({left:16,right:16},"is-before"===x?{top:0}:{bottom:16}),children:(0,Z.tZ)(ee.zx,{leading:"is-before"===x?(0,Z.tZ)(rf.Z,{size:16}):(0,Z.tZ)(r_.Z,{size:16}),priority:"secondary",onClick:R,children:o("Back to clipped segment")})})]})]})},rF=(e,t)=>{for(let i=0;i<e.length;i++){if(e[i].start<=t&&e[i].end>=t)return i;if(t<e[i].start)return i>0?i-1:0}return e.length-1},rL={aspectRatioButtonContainer:"aspectRatioButtonContainer-DpghVI",aspectRatioButton:"aspectRatioButton-TT8zmt"},rz=e=>{var t,i,n;let{audioUpload:r,isOpen:o,postId:a,pub:l,transcription:s,videoPlayerRef:d,videoUpload:c,onClose:u,onSaveClip:p,onShareNote:h}=e,{iString:m}=(0,Q.M1)(),{clipTitle:g,clipTimes:v,setClipEnd:b,setClipStart:y,setClipTitle:w}=(0,nk.Sr)(),[C,x]=(0,A.eJ)(!1),S=(0,A.sO)(null),{isPlaying:k}=(0,nL.FI)(d),B=(0,nD.r)(),{postMediaComposition:T,postMediaCompositionWithOtherAspect:I}=(0,il.z)(),[N,P]=(0,A.eJ)(),[E,X]=(0,A.eJ)(c),[M,D]=(0,A.eJ)(s);(0,A.d4)(()=>{N||P(null==T?void 0:T.aspect_ratio)},[T]),(0,A.d4)(()=>{let e;if(d.current&&N){var t,i;null===(t=d.current.player)||void 0===t||t.pause(),e=null===(i=d.current.player)||void 0===i?void 0:i.currentTime}setTimeout(()=>{(null==I?void 0:I.aspect_ratio)===N&&(null==I?void 0:I.videoUpload)?(X(I.videoUpload),I.videoUpload.transcription&&D(I.videoUpload.transcription)):(null==T?void 0:T.aspect_ratio)===N&&(null==T?void 0:T.videoUpload)?(X(T.videoUpload),T.videoUpload.transcription&&D(T.videoUpload.transcription)):(X(c),D(s)),setTimeout(()=>{var t;e&&(null===(t=d.current)||void 0===t?void 0:t.player)&&(d.current.player.currentTime=e)})})},[N]),(0,A.d4)(()=>{o&&L(U.FP.MEDIA_CLIP_CREATE_MODAL_OPENED,{video_upload_id:E.id,post_id:a,is_post_editor:!0,source:(null!=g?g:"").startsWith("Copy of")?"edit":"create"})},[o]),(0,A.d4)(()=>{let e=e=>{if(" "===e.key){var t,i,n,r;k?null===(i=d.current)||void 0===i||null===(t=i.player)||void 0===t||t.pause():null===(r=d.current)||void 0===r||null===(n=r.player)||void 0===n||n.play(),e.preventDefault()}};return o&&window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[o,k,d]);let R=async()=>{v&&(x(!0),await p({start:(0,rg.Nm)(v.start,{decimals:3}),duration:(0,rg.Nm)(v.end-v.start,{decimals:3}),title:g,overrideVideoUpload:E}),x(!1))},F=async()=>{v&&(x(!0),await h({start:(0,rg.Nm)(v.start,{decimals:3}),duration:(0,rg.Nm)(v.end-v.start,{decimals:3}),title:g,overrideVideoUpload:E}),x(!1))},L=(e,t)=>(0,U.j)(e,(0,_._)((0,f._)({},t),{is_post_editor:!0,video_upload_id:E.id}));return(0,Z.tZ)(eK.u_,{isOpen:o,width:(null==M?void 0:M.cdn_url)?1600:900,children:(0,Z.tZ)(tU.w,{children:(0,Z.BX)(et.tu,{gap:16,padding:32,children:[(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(rc.U,{clipTitle:null!=g?g:m("Untitled Clip"),onSaveTitle:w}),(0,Z.tZ)(ee.hU,{priority:"tertiary",size:"md",onClick:()=>{L(U.FP.MEDIA_CLIP_CREATE_MODAL_CLOSED,{video_upload_id:E.id,post_id:a,is_post_editor:!0}),u()},children:(0,Z.tZ)(K.Z,{})})]}),(0,Z.BX)(et.gq,{radius:"sm",overflow:"hidden",style:(null==M?void 0:M.cdn_url)?{height:800,maxHeight:"calc(100vh - 240px)"}:void 0,children:[(0,Z.tZ)(et.tu,{bg:"black",flex:"grow",justifyContent:"center",position:"relative",children:(0,Z.BX)(et.tu,{overflow:"hidden",children:[I?(0,Z.tZ)(ts.xu,{position:"absolute",className:rL.aspectRatioButtonContainer,zIndex:1,children:(0,Z.tZ)(ro,{aspectRatio:N,setAspectRatio:e=>P(e),buttonProps:{className:rL.aspectRatioButton}})}):null,(0,Z.tZ)(nR.Z,{ref:d,doNotResetOnEnd:!0,mediaUpload:E,noControls:!0,noKeyboardShortcuts:!0,pub:l,renderPlayButton:()=>(0,Z.tZ)(rv.f,{isPlaying:!1,size:72}),videoType:"post",entityType:"post",entityKey:String(a),surface:"editor",contentType:"clip"}),(0,Z.tZ)(nO.Vo,{disableShortcuts:!0,handle:B,hideNextVideoButton:!0,hidePip:!0,isActive:!0,isFocused:!0,mediaRef:d,mediaUpload:E,podcastUpload:null!==(t=E.extractedAudio)&&void 0!==t?t:r,pub:l,showPaywall:!1})]})}),(null==M?void 0:M.cdn_url)&&(0,Z.tZ)(et.tu,{border:"detail",flex:"auto",radius:"sm",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},width:500,children:(0,Z.tZ)(et.tu,{flex:"grow",position:"relative",children:(0,Z.tZ)(ru._F,{children:(0,Z.tZ)(rR,{playerRef:d,postId:a,videoUpload:E,transcription:M})})})})]}),(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(rd.i,{containerRef:S,hideBottomControls:!0,isInline:!0,postId:a,videoPlayerRef:d,videoUpload:E,visible:!0}),(0,Z.BX)(et.gq,{justifyContent:"space-between",children:[(0,Z.tZ)(nk.l7,{}),(0,Z.BX)(et.gq,{position:"absolute",gap:8,style:{left:"50%",transform:"translateX(-50%)"},alignItems:"center",justifyContent:"center",children:[(0,Z.tZ)(rh,{label:m("Clip start"),value:null!==(i=null==v?void 0:v.start)&&void 0!==i?i:0,onChange:e=>{L(U.FP.MEDIA_CLIP_SELECTION_MADE,{start_time:e,end_time:null==v?void 0:v.end,source:"typed"}),y(e)}}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:"â€“"}),(0,Z.tZ)(rh,{label:m("Clip end"),value:null!==(n=null==v?void 0:v.end)&&void 0!==n?n:0,onChange:e=>{L(U.FP.MEDIA_CLIP_SELECTION_MADE,{start_time:null==v?void 0:v.start,end_time:e,source:"typed"}),b(e)}})]}),(0,Z.BX)(et.gq,{gap:8,children:[(0,Z.tZ)(ee.zx,{disabled:C,priority:"secondary",onClick:R,children:m("Download clip")}),(0,Z.tZ)(ee.zx,{disabled:C,priority:"primary",onClick:F,children:m("Share to Notes")})]})]})]})]})})})};var rO=i(93862),rU=i(75419),rY=i(69332);let rH=(e,t)=>{let i=[];for(let r of e){var n;let e=null!==(n=null==r?void 0:r.assets)&&void 0!==n?n:[],o=(t?e.filter(t):e).map(e=>e.mediaUpload);i.push(...nT()(o))}return i},rj=e=>{let{pub:t,audioUpload:i,postId:n,post:r,transcription:o,videoPlayerRef:a,videoUpload:l,canEdit:s=!1,variant:d="standard",initialClipId:c}=e,{iString:u}=(0,Q.M1)(),p=(0,iN.pm)(),{isClipping:h,onCancelClipping:m,onStartClipping:g}=(0,nk.Sr)(),{existingClips:v,mediaClipsRequest:b,setExistingClips:y,setMediaClipsRequest:w,syncClips:C}=(0,il.z)(),[x,S]=(0,A.eJ)(0),[k,B]=(0,A.eJ)(l),[T,I]=(0,A.eJ)(!1),[P,E]=(0,A.eJ)({aspectRatio:k?(0,nU.n3)(k):"landscape"});(0,A.d4)(()=>{l&&(E(e=>(0,_._)((0,f._)({},e),{aspectRatio:(0,nU.n3)(l)})),B(l))},[l]);let X=v.filter(e=>{var t,i,n;return(null===(t=e.assets)||void 0===t?void 0:t.length)===0||("portrait"===P.aspectRatio?null===(n=e.assets)||void 0===n?void 0:n.some(e=>{var t,i,n,r;return(null!==(n=null===(t=e.mediaUpload)||void 0===t?void 0:t.width)&&void 0!==n?n:0)<(null!==(r=null===(i=e.mediaUpload)||void 0===i?void 0:i.height)&&void 0!==r?r:0)}):null===(i=e.assets)||void 0===i?void 0:i.some(e=>{var t,i,n,r;return(null!==(n=null===(t=e.mediaUpload)||void 0===t?void 0:t.width)&&void 0!==n?n:0)>(null!==(r=null===(i=e.mediaUpload)||void 0===i?void 0:i.height)&&void 0!==r?r:0)}))}),M=X[4*x]?X.slice(4*x,(x+1)*4):[],D=Math.ceil(X.length/4),R=(null==i?void 0:i.state)==="error",F=(null==b?void 0:b.status)==="started",L=(null==b?void 0:b.status)==="failed",z=(null==b?void 0:b.status)==="completed",O=null==b?void 0:b.clips_count,[Y,H]=(0,A.eJ)(0),j=X[Y],J=(0,rU.i3)(),[V,q]=(0,A.eJ)(null);(0,A.d4)(()=>{let e="undefined"!=typeof window?(0,rY.m)(window.location.href):{};if(e.clipId&&!T){let i=nN()(rH(X,e=>{var t;return(null==e?void 0:null===(t=e.mediaUpload)||void 0===t?void 0:t.state)==="transcoded"}),e=>e.id)[e.clipId];if(i){var t;let n=X.find(t=>{var i,n;return nT()((null!==(i=t.assets)&&void 0!==i?i:[]).map(e=>e.media_upload_id)).includes(null!==(n=e.clipId)&&void 0!==n?n:"")});(0,nY.I)(i,null!==(t=null==n?void 0:n.title)&&void 0!==t?t:""),I(!0)}}},[X]),(0,A.d4)(()=>{if(c&&X.length){let e=X.findIndex(e=>e.id===c);-1!==e&&H(e)}},[c,X.length,X]);let W=(0,A.I4)((e,t)=>{k&&(0,U.j)(e,(0,_._)((0,f._)({},t),{is_post_editor:!0,video_upload_id:k.id}))},[k]),G=async e=>{y(X.filter(t=>t.id!==e)),H(0)},K=e=>{y(X.map(t=>t.id===e.id?e:t)),H(0)},$=async()=>{var e,t;let i=null==k?void 0:null===(e=k.extractedAudio)||void 0===e?void 0:e.id;if(!i){let{body:e}=await N().get("/api/v1/video/upload/".concat(null==k?void 0:k.id,"/audio"));if(!(i=null==e?void 0:null===(t=e.extractedAudio)||void 0===t?void 0:t.id)){p.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:u("Audio not found for video.")})));return}}let{body:n}=await N().post("/api/v1/video/assets/".concat(i,"/ai-clips"));p.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:u("Generating AI clips")}))),w(n)},ee=async()=>{b&&(null==k?void 0:k.id)&&(await N().delete("/api/v1/video/assets/".concat(k.id,"/clips-requests/").concat(b.id)),p.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:u("AI generated clips request cancelled.")}))),setTimeout(()=>C(),1e3))},et=async()=>{let e=X.reduce((e,t)=>{var i;let n=(0,nU.SQ)(t,e=>{var t;return(null===(t=e.mediaUpload)||void 0===t?void 0:t.state)==="transcoded"});return n?[...e,(0,nY.I)(n,null!==(i=t.title)&&void 0!==i?i:"")]:e},[]);await Promise.all(e)},ei=async e=>{if(!(null==k?void 0:k.id))return null;await N().post("/api/v1/video/assets/".concat(k.id,"/generate_media_clips")).send({vendor:e})},en=async()=>{if(!(null==k?void 0:k.id))return null;await N().post("/api/v1/video/assets/".concat(k.id,"/send_push_notification")).send({})},er=(0,A.I4)(async e=>{var t;let{start:i,duration:n,title:r,overrideVideoUpload:o}=e,a=null!==(t=null==o?void 0:o.id)&&void 0!==t?t:null==k?void 0:k.id;a&&(W(U.FP.MEDIA_CLIP_BUTTON_CLICKED,{button:"save clip",source:"create_modal"}),q({clip:{id:"",created_at:new Date,media_upload_id:a,title:r,start_time:i,duration:n,source:"user",assets:[],user_id:null,description:""},action:"download",source:"create_modal"}),o&&B(o),m())},[W,rO.C,y,m,k]),eo=(0,A.I4)(async e=>{var i;let{clip:n,videoUpload:r}=e,o=null!=r?r:k;if(!o)return;let a=u("Click to watch the full video:\n"),l=null===(i=(0,nU.SQ)(n,e=>{var t;return(null==e?void 0:null===(t=e.mediaUpload)||void 0===t?void 0:t.state)==="transcoded"}))||void 0===i?void 0:i.id;if(!l){let{mediaUpload:e}=await (0,rO.O)({aspectRatio:"landscape",clip:n,useCaptions:!1,captionsStyle:null,videoUpload:o,shareToNotes:!0,pub:t});l=e.id}J.open({initialText:"".concat(a),mediaClipId:n.id,onCompose:e=>{W(U.FP.MEDIA_CLIP_SHARED,{note_id:e.id,destination:"notes",clip_video_upload_id:l})}})},[J,u,r,t,W,k]),ea=(0,A.I4)(async e=>{var i;let{clip:n,videoUpload:r}=e,o=null!=r?r:k;if(!o)return;let a=null===(i=(0,nU.SQ)(n,e=>{var t;return(null==e?void 0:null===(t=e.mediaUpload)||void 0===t?void 0:t.state)==="transcoded"}))||void 0===i?void 0:i.id;if(!a){let{mediaUpload:e}=await (0,rO.O)({aspectRatio:"landscape",clip:n,useCaptions:!1,captionsStyle:null,videoUpload:o,shareToNotes:!0,pub:t});a=e.id}let l="".concat(u("Subscribe to get the full video when it's released."),"\n");J.open({initialText:"".concat(l),videoUploadId:a,onCompose:e=>{W(U.FP.MEDIA_CLIP_SHARED,{note_id:e.id,destination:"notes",clip_video_upload_id:a})}})},[J,u,t,W,k]),el=(0,A.I4)(async e=>{let{clip:t,isPublished:i=!1,videoUpload:n}=e;return i?eo({clip:t,videoUpload:n}):ea({clip:t,videoUpload:n})},[eo,ea]),es=(0,A.I4)(async e=>{let{start:t,duration:i,title:n,overrideVideoUpload:o}=e,a=null!=o?o:k;if(!a)return;o&&B(o);let l=await (0,rO.C)({videoUpload:a,start:t,duration:i,title:n});l&&(await el({clip:l,isPublished:r.is_published,videoUpload:a}),y(e=>[l,...e]),m())},[el,m,r.is_published,y,k]),ed=(null==k?void 0:k.state)==="transcoded",ec=(null==o?void 0:o.status)==="in_progress",eu=ed&&0===X.length,ep=k&&ed&&X.length>0&&j;return(0,Z.BX)(tU.w,{children:[(X.length>0||"standard"===d)&&(0,Z.BX)(rJ,{children:[s&&(0,Z.tZ)(rt,{disabled:!ed,onClipSuggestionsGeneration:ei,onSendPushNotification:en,onDownloadClips:et,onStartClipping:g,filters:P,setFilters:E}),ec&&(0,Z.tZ)(n8,{}),F&&(0,Z.tZ)(n6,{cancelRequest:ee}),eu&&(0,Z.tZ)(n4,{videoHasNoAudio:R}),!ed&&(0,Z.tZ)(n3,{}),(L||z&&0===O)&&(0,Z.tZ)(n2,{onGenerateClick:$}),ep&&"download"===d&&(0,Z.tZ)(nQ,{carouseSelectedIndex:Y,setCarouselSelectedIndex:H,selectedClip:j,existingClips:X,pub:t,post:r,videoUpload:k,onClipRemoved:G,canEdit:s,onClipUpdated:K,setEditState:q,handleShareClipLinkToNotes:el,filters:P}),ep&&"standard"===d&&(0,Z.tZ)(ra,{pageClips:M,totalPages:D,page:x,setPage:S,pub:t,post:r,videoUpload:k,onClipRemoved:G,canEdit:s,onClipUpdated:K,handleShareClipLinkToNotes:el,setEditState:q,onStartClipping:g,filters:P})]}),k&&(0,Z.BX)(Z.HY,{children:[a&&"number"==typeof n&&(0,Z.tZ)(rz,{audioUpload:i,isOpen:h,postId:n,pub:t,transcription:null!=o?o:null,videoPlayerRef:a,videoUpload:k,onClose:()=>{m()},onSaveClip:er,onShareNote:es}),V&&"rename"===V.action&&(0,Z.tZ)(rs,{isOpen:!0,onClose:()=>q(null),clip:V.clip,videoUpload:k,onClipUpdated:K}),V&&"download"===V.action&&(0,Z.tZ)(rl._,{isOpen:!0,onClose:e=>{q(null),e&&(C(),H(0))},clip:V.clip,videoUpload:k,transcription:o,surface:"media_drawer",source:"download"===V.action?"media_drawer":"create_modal",useDownloadsCenter:!0,onSave:e=>{let{videoUpload:t,aspectRatio:i}=e;E((0,_._)((0,f._)({},P),{aspectRatio:t.live_stream_id&&t.width&&t.height&&t.width<t.height?"portrait":"landscape"===i?"landscape":"portrait"}))}})]})]})},rJ=(0,ts.zo)({display:"flex",direction:"column",gap:20,flex:"grow"}),rV=e=>{let{audioUpload:t,postForEditor:i,postId:n,pub:r,transcription:o,videoUpload:a}=e,l=(0,A.sO)(null),s=(0,A.sO)(null);return(0,Z.tZ)(nk.BY,{postId:n,videoPlayerRef:l,virtualizedListRef:s,children:(0,Z.tZ)(et.tu,{position:"relative",flex:"grow",gap:32,children:(0,Z.tZ)(rj,{audioUpload:t,post:i,postId:n,pub:r,transcription:o,videoPlayerRef:l,videoUpload:a,canEdit:!0})})})};var rq=i(61308),rW=i(53569),rG=i(55519);let rK=[{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"fr",name:"French"},{code:"it",name:"Italian"},{code:"de",name:"German"},{code:"pt",name:"Portuguese"}],rQ=e=>2!==(e=e.toUpperCase()).length?null:"PT"===e?"\uD83C\uDDE7\uD83C\uDDF7":Array.from(e).map(e=>String.fromCodePoint(127462+e.charCodeAt(0)-65)).join(""),r$=e=>{let{languages:t,setLanguages:i,onLanguageRemoved:n,onLanguageSelected:r,disabledLanguages:o=[]}=e;return(0,Z.tZ)(rG.ZP,{value:t,onChange:(e,t)=>{switch(t.action){case"remove-value":n(t.removedValue);break;case"clear":break;case"select-option":r(t.option)}i(e)},options:rK.filter(e=>!o.includes(e.code)),isMulti:!0,styles:{placeholder:e=>(0,_._)((0,f._)({},e),{fontSize:15,fontFamily:"var(--font-family-text)"}),input:e=>(0,_._)((0,f._)({},e),{fontSize:15,fontFamily:"var(--font-family-text)"}),multiValueLabel:e=>(0,_._)((0,f._)({},e),{fontSize:15,fontFamily:"var(--font-family-text)"}),multiValueRemove:e=>(0,_._)((0,f._)({},e),{cursor:"pointer"}),option:e=>(0,_._)((0,f._)({},e),{fontSize:15,cursor:"pointer",fontFamily:"var(--font-family-text)"}),noOptionsMessage:e=>(0,_._)((0,f._)({},e),{fontSize:15,fontFamily:"var(--font-family-text)"})},components:{MultiValueLabel:e=>{let t=rQ(e.data.code);return(0,Z.tZ)(rW.F.MultiValueLabel,(0,_._)((0,f._)({},e),{children:(0,Z.BX)(et.gq,{alignItems:"center",gap:8,children:[t&&(0,Z.tZ)(et.gq,{children:t}),(0,Z.tZ)(et.gq,{children:e.data.name})]})}))},Option:e=>{let t=rQ(e.data.code);return(0,Z.tZ)(rW.F.Option,(0,_._)((0,f._)({},e),{children:(0,Z.BX)(et.gq,{alignItems:"center",gap:8,children:[t&&(0,Z.tZ)(et.gq,{children:t}),(0,Z.tZ)(et.gq,{children:e.data.name})]})}))}},getOptionLabel:e=>e.name,getOptionValue:e=>e.code,isClearable:!1,theme:(0,Y._I)({primary:"var(--color-accent-themed)",neutral0:"white",danger:"var(--color-accent-themed)",dangerLight:"var(--color-bg-accent-themed)"}),name:"colors",className:"basic-multi-select",classNamePrefix:"select"})};var r0=i(62718),r1=i(38242),r2=i(55077),r4=i(22233);let r3=e=>{let{postId:t,setCurrentTranscript:i,transcription:n,pub:r,audioUpload:o,isTranscribing:a,setIsTranscribing:l,onTranscriptionUploadCancelled:s,onTranscriptionUploadError:d,onTranscriptionUploadStarted:c,onTranscriptionUploaded:u,transcriptionUploadError:p,mediaType:h}=e,{iString:m}=(0,Q.M1)(),[g,v]=(0,A.eJ)(!!(null==n?void 0:n.approved_at)),[b,y]=(0,A.eJ)(!1),[_,w]=(0,A.eJ)(!1),[C,x]=(0,A.eJ)({}),[S,k]=(0,A.eJ)(null),B=(null==n?void 0:n.status)==="transcribed";async function T(){i(null),l(!0),(0,U.j)(U.FP.TRANSCRIPTION_EDITOR_EDIT_CHUNK_CLICKED,{postId:t}),N().post("/api/v1/drafts/".concat(t,"/realign_transcription")).send({edits:C}).then(e=>{var t;(null===(t=e.body)||void 0===t?void 0:t.data)&&(i(e.body.data),l("in_progress"===e.body.data.status))}),y(!1)}async function I(e){v(e),(0,U.j)(U.FP.TRANSCRIPTION_EDITOR_SHOW_ON_POST_CLICKED,{approved:e}),N().put("/api/v1/drafts/".concat(t,"/transcript")).send({approved:e}).then(e=>{e.body.data&&(i(e.body.data),v(!!e.body.data.approved_at))})}async function P(){(0,U.j)(U.FP.TRANSCRIPTION_REGENERATE_CLICKED,{post_id:t,audio_upload_id:null==o?void 0:o.id}),a||(l(!0),k(null),N().post("/api/v1/drafts/".concat(t,"/transcribe")).send({restart:!0}).then(e=>{var t;(null===(t=e.body)||void 0===t?void 0:t.data)&&(i(e.body.data),l("in_progress"===e.body.data.status))}))}async function E(){(0,U.j)(U.FP.TRANSCRIPTION_REMOVE_CLICKED,{post_id:t,audio_upload_id:null==o?void 0:o.id}),k(null),N().post("/api/v1/drafts/".concat(t,"/cancel_transcription")).send().then(()=>{i(null),v(!1),l(!1)})}let X=(null==o?void 0:o.state)==="transcoded";return(0,Z.tZ)(ru._F,{children:(0,Z.BX)(et.tu,{gap:32,flex:"grow",paddingBottom:32,children:[(0,Z.tZ)(r6,{toggleApproved:I,approved:g,hasTranscript:n&&(null==n?void 0:n.status)!=="in_progress"}),(0,Z.tZ)(eW.SiteConfigGate,{configKey:"enable_transcription_translations",children:(null==n?void 0:n.status)==="transcribed"&&t&&(0,Z.tZ)(r5,{postId:t,transcription:n})}),!X&&(0,Z.tZ)(et.tu,{gap:8,flex:"grow",children:(0,Z.tZ)(et.tu,{radius:"md",border:"detail",shadow:"xs",padding:16,gap:16,flex:"grow",children:(0,Z.tZ)(et.gq,{justifyContent:"center",alignItems:"center",gap:8,style:{height:X?void 0:"calc(100vh - 276px)"},children:(0,Z.BX)(et.tu,{justifyContent:"center",textAlign:"center",gap:4,paddingX:32,children:[(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:(0,Z.tZ)(rq.Z,{size:24})}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B2,{weight:"semibold",color:"secondary",children:m("No media")}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:m("Transcription will automatically generate when media has been uploaded")})]})]})})})}),X&&(0,Z.BX)(et.tu,{gap:16,flex:"grow",children:[(0,Z.tZ)(ru.Xf,{isEditingSpeakers:_,postId:t,audioUpload:o,handleSubmitEdits:T,isEditing:b,setIsEditing:y,setEdits:x,hasEdits:Object.keys(C).length>0,isTranscribing:a,transcription:n,handleRegenerateTranscription:P,handleCancelTranscription:E,onTranscriptionUploadCancelled:s,onTranscriptionUploadError:d,onTranscriptionUploadStarted:c,onTranscriptionUploaded:u,uploadedFile:S,setUploadedFile:k}),(0,Z.tZ)(r8,{mediaType:h,transcription:n,isTranscribing:a,handleCancelTranscription:E,uploadedFile:S,transcriptionUploadError:p,handleRegenerateTranscription:P}),!a&&B&&t&&(0,Z.tZ)(r0.b,{isEditingSpeakerName:_,setIsEditingSpeakerName:w,isEditing:b,onEdit:e=>{x(Object.entries((0,f._)({},C,e)).reduce((e,t)=>{let[i,n]=t;return void 0!==n&&(e[i]=n),e},{}))},edits:C,setCurrentTranscript:i,transcription:n,postId:t,audioUpload:o,pub:r})]})]})})},r8=e=>{let{transcriptionUploadError:t,isTranscribing:i,transcription:n,handleCancelTranscription:r,uploadedFile:o,handleRegenerateTranscription:a,mediaType:l}=e,{iString:s}=(0,Q.M1)();return(null==n?void 0:n.status)==="failed"?(0,Z.BX)(r1.S,{alignItems:"center",justifyContent:"center",children:[(0,Z.tZ)(ts.xu,{color:"primary",children:(0,Z.tZ)(eL.Z,{})}),(0,Z.tZ)(ei.xv.B3,{weight:"semibold",translated:!0,color:"primary",children:"There was a problem generating the transcript"})]}):t?(0,Z.BX)(r1.S,{alignItems:"center",justifyContent:"center",children:[(0,Z.tZ)(ts.xu,{color:"primary",children:(0,Z.tZ)(eL.Z,{})}),(0,Z.tZ)(ei.xv.B3,{weight:"semibold",translated:!0,color:"primary",children:"There was a problem uploading this file"})]}):i||(null==n?void 0:n.status)==="in_progress"?(0,Z.BX)(r1.S,{alignItems:"center",justifyContent:"center",children:[(0,Z.tZ)(ts.xu,{padding:8,children:(0,Z.tZ)(iI.$j,{})}),o?(0,Z.tZ)(ei.xv.B2,{weight:"semibold",color:"primary",translated:!0,children:"Processing..."}):(0,Z.tZ)(ei.xv.B2,{weight:"semibold",color:"primary",translated:!0,children:"Transcribing..."}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:r,children:s("Cancel")})]}):n||i?(0,Z.tZ)(Z.HY,{}):(0,Z.BX)(r1.S,{alignItems:"center",justifyContent:"center",children:[(0,Z.tZ)(nA.Z,{className:r4.Z.icon}),(0,Z.BX)(et.tu,{alignItems:"center",children:[(0,Z.tZ)(ei.xv.B2,{color:"primary",weight:"semibold",translated:!0,children:"Generate transcript"}),(0,Z.tZ)(ei.xv.B3,{color:"primary",children:s("Get an AI generated transcript of your ".concat(String(l).toLowerCase()))})]}),(0,Z.tZ)(ee.zx,{onClick:a,children:s("Generate")})]})},r6=e=>{let{toggleApproved:t,approved:i,hasTranscript:n}=e;return(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(et.tu,{padding:16,justifyContent:"space-between",border:"detail",radius:"md",alignItems:"start",shadow:"sm",children:[(0,Z.BX)(et.gq,{className:r4.Z.toggleSetting,justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.B3,{color:"primary",weight:"semibold",translated:!0,children:"Show transcript and captions"}),(0,Z.tZ)(i2.ZP,{disabled:!n,onChange:t,checked:i})]}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Let readers view an auto-generated transcript and closed captions on the post page"})]})})},r5=e=>{var t,i,n,r,o;let{postId:a}=e,{setTranscription:l,transcription:s}=(0,il.z)(),[d,c]=(0,A.eJ)({}),u=Object.keys(null!==(i=null==s?void 0:s.captions_map)&&void 0!==i?i:{}),p=null===(t=Object.entries(null!==(n=null==s?void 0:s.captions_map)&&void 0!==n?n:{}).find(e=>{let[t,i]=e;return i.original}))||void 0===t?void 0:t[1].language,[h,m]=(0,A.eJ)(u.length>1),[g,v]=(0,A.eJ)(rK.filter(e=>u.includes(e.code)&&p!==e.code).map(e=>{var t,i;return(0,_._)((0,f._)({},e),{status:null===(t=(null!==(i=null==s?void 0:s.captions_map)&&void 0!==i?i:{})[e.code])||void 0===t?void 0:t.status})})),b=async e=>{l((await N().post("/api/v1/drafts/".concat(a,"/transcription/translation")).send(e)).body),c((0,_._)((0,f._)({},d),{[e.code]:.02}))},y=async e=>{l((await N().delete("/api/v1/drafts/".concat(a,"/transcription/translation/").concat(e.code))).body)},w=Object.values(null!==(r=null==s?void 0:s.captions_map)&&void 0!==r?r:{}).filter(e=>"in_progress"===e.status),C=Object.values(null!==(o=null==s?void 0:s.captions_map)&&void 0!==o?o:{}).filter(e=>!!e.url);return(0,to.useEffect)(()=>{if(w.length>0){let e=setInterval(async()=>{try{let e=await N().get("/api/v1/drafts/".concat(a,"/transcription"));l(e.body.data)}catch(e){console.error("Failed to fetch transcription:",e)}},5e3);return()=>clearInterval(e)}},[w.length]),(0,to.useEffect)(()=>{let e=Object.assign({},d);for(let t of C)delete e[t.language];c(e)},[C.length]),(0,Z.BX)(et.tu,{gap:16,padding:16,justifyContent:"space-between",border:"detail",radius:"md",alignItems:"start",shadow:"sm",children:[(0,Z.BX)(et.gq,{gap:8,justifyContent:"space-between",alignItems:"start",children:[(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ei.xv.B3,{color:"primary",weight:"semibold",translated:!0,children:"Provide auto-generated subtitles in other languages"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"You can choose languages you want to make available for auto-generated subtitles"})]}),(0,Z.tZ)(i2.ZP,{onChange:m,checked:h})]}),h&&(0,Z.tZ)(et.tu,{style:{width:"100%"},children:(0,Z.tZ)(r$,{languages:g,setLanguages:v,onLanguageSelected:b,onLanguageRemoved:y,disabledLanguages:p?[p]:[]})}),w.length>0&&(0,Z.tZ)(et.tu,{gap:8,style:{width:"100%"},children:w.sort((e,t)=>e.language>t.language?1:-1).map(e=>{var t,i;let n=rQ(e.language);return(0,Z.BX)(et.gq,{gap:16,alignItems:"center",justifyContent:"space-between",children:[(0,Z.BX)(et.gq,{alignItems:"center",flex:"grow",gap:8,children:[n&&(0,Z.tZ)(et.gq,{children:n}),(0,Z.BX)(ei.xv.B3,{children:[null===(t=rK.find(t=>t.code===e.language))||void 0===t?void 0:t.name," "]})]}),(0,Z.tZ)(r2.k,{color:"primary-themed",value:Math.abs((null!==(i=d[e.language])&&void 0!==i?i:.02)*100)})]},e.language)})})]})};var r9=i(47921),r7=i(9450);let oe=(0,iN.dd)(function(e){let{initialFile:t,pub:i,postForEditor:n,postId:r,bylines:o,pendingInvites:a,onBylinesAndInvitesChanged:l,onPodcastUploadChanged:s,onPodcastPreviewUploadChanged:d,onBylineChange:c,onClose:u,setPostId:p,freePodcastUrl:h,podcastPreviewUpload:m,legacyPodcastUrl:g,askToRemoveLegacyPodcast:v,onSaveFreePodcastUrl:b,onUploadStarted:y,onUploadCancelled:w,onPreviewUploadStarted:C,onPreviewUploadCancelled:x,onVideoPodcastUploadChanged:S,onRemoveVideoPodcast:k,mediaType:B,skipToRecordStep:T,hideFromFeed:I,onHideFromFeedChange:N,selectedSectionId:P,showNotesProps:E}=e,{getConfigFor:X}=(0,io.xR)(),M=!!X("clip_focused_video_upload_flow")&&"video"===B,[D,R]=(0,A.eJ)(!1),{isTranscribing:F,podcastUpload:L,setIsTranscribing:z,setTranscription:O,transcription:Y,transcriptionGenerated:H,videoUpload:j,postMediaComposition:J}=(0,il.z)(),{initialTab:V,isPodcastDrawerOpen:q,setIsPodcastDrawerOpen:W,setInitialTab:G}=(0,ia.y)(),K=(null==j?void 0:j.extractedAudio)||L,[$,ei]=(0,A.eJ)(!1),[en,er]=(0,A.eJ)(!1),[eo,ea]=(0,A.eJ)(null!=V?V:"settings"),{iString:el}=(0,Q.M1)(),[es,ed]=(0,A.eJ)(null!=h?h:""),[ec,eu]=(0,A.eJ)(null),[ep,eh]=(0,A.eJ)(null!=t?t:null),[em,eg]=(0,A.eJ)(""),ev=es!==(null!=h?h:"");(0,A.d4)(()=>{"clips"===("undefined"!=typeof window?(0,rY.m)(window.location.href):{}).tab&&(W({isOpen:!0}),G("clips"))},[]);let eb=()=>{let e="video"===B?{video_upload_id:null==j?void 0:j.id}:{audio_upload_id:null==L?void 0:L.id};return(0,f._)({},{type:"podcast",post_id:r,tab:eo},e)};(0,A.d4)(()=>{q&&ea(null!=V?V:"settings")},[V,q]),(0,A.d4)(()=>{j||ea("settings")},[j]);let ey=(0,A.I4)(async()=>{R(!0),eu(null);let{error:e}=await b({freePodcastUrl:es});return R(!1),!e||(eu(e),!1)},[es,b]),ef=(0,A.I4)(e=>{ed(e),eu(null)},[]),e_=async()=>{(0,U.j)(U.FP.POST_EDITOR_MEDIA_DRAWER_CLOSED,eb()),W({isOpen:!1}),u()};(0,A.d4)(()=>{q&&(0,U.j)(U.FP.POST_EDITOR_MEDIA_DRAWER_VIEWED,(0,_._)((0,f._)({},eb()),{tab:V,source:"clips"===V?"player ufi clips":"player ufi open settings"}))},[q,V]),(0,A.d4)(()=>{eh(t)},[t]);let eZ=(0,iN.pm)();(0,A.d4)(()=>{H&&eZ.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:el("Generated transcription"),Icon:ii.Z,cta:el("View"),onAccept:()=>{ea("transcript")}})))},[H]);let ew="video"===B?(0,Z.tZ)(r7.E,{disabled:$,title:el("Clips"),onClick:()=>{(0,U.j)(U.FP.POST_EDITOR_MEDIA_DRAWER_VIEWED,(0,_._)((0,f._)({},eb()),{tab:"clips"})),ea("clips")},isActive:"clips"===eo}):null;return(0,Z.BX)(r9.n,{drawerClassName:"podcastDrawerParent-o2BqqA",width:500,variant:"push",isOpen:q,wrapperId:"podcast",className:"podcastDrawerContainer-yUMjQH",children:[(0,Z.BX)(et.gq,{paddingTop:16,justifyContent:"space-between",children:[(0,Z.BX)(et.gq,{alignItems:"end",gap:16,children:[M&&ew,(0,Z.tZ)(r7.E,{title:"video"===B?el("Video settings"):el("Audio Settings"),onClick:()=>{(0,U.j)(U.FP.POST_EDITOR_MEDIA_DRAWER_VIEWED,(0,_._)((0,f._)({},eb()),{tab:"settings"})),ea("settings")},isActive:"settings"===eo}),(0,Z.tZ)(r7.E,{disabled:$,title:el("Transcript"),isActive:"transcript"===eo,onClick:()=>{(0,U.j)(U.FP.POST_EDITOR_MEDIA_DRAWER_VIEWED,(0,_._)((0,f._)({},eb()),{tab:"transcript"})),ea("transcript")}}),!M&&ew]}),(0,Z.tZ)(tW.u,{text:el("Please save the free podcast URL before closing"),disabled:!ev,children:(0,Z.tZ)(ee.hU,{priority:"tertiary",disabled:D||ev,onClick:e_,children:(0,Z.tZ)(ir.Z,{})})})]}),(0,Z.BX)(et.tu,{flex:"grow",paddingTop:32,children:["settings"===eo&&(0,Z.tZ)(nS,{postId:r,setPostId:p,pub:i,mediaType:B,postForEditor:n,legacyPodcastUrl:g,initialFile:t,onVideoPodcastUploadChanged:S,onRemoveVideoPodcast:k,videoUpload:j,podcastUpload:L,onPodcastUploadChanged:s,podcastPreviewUpload:m,onPodcastPreviewUploadChanged:d,onUploadStarted:y,onUploadCancelled:w,onPreviewUploadStarted:C,onPreviewUploadCancelled:x,askToRemoveLegacyPodcast:v,skipToRecordStep:T,errors:ec?{free_podcast_url:ec}:null,freePodcastUrl:es,onBylineChange:c,bylines:o,pendingInvites:a,onBylinesAndInvitesChanged:l,setFreePodcastUrl:ef,freePodcastUrlHasChanged:ev,freePodcastUrlIsSaving:D,onClickSaveFreePodcastUrl:ey,uploadingPrimary:$,uploadingPreview:en,setUploadingPrimary:ei,setUploadingPreview:er,file:ep,setFile:eh,hideFromFeed:I,onHideFromFeedChange:N,selectedSectionId:P,showNotesProps:E,postMediaComposition:J}),"transcript"==eo&&(0,Z.tZ)(r3,{onTranscriptionUploadStarted:()=>{z(!0)},onTranscriptionUploadCancelled:()=>{eg("")},onTranscriptionUploadError:e=>{eg(e)},onTranscriptionUploaded:e=>{O(e),z("in_progress"===e.status),eg("")},pub:i,postId:r,setCurrentTranscript:O,transcription:Y,audioUpload:K,isTranscribing:F,setIsTranscribing:z,transcriptionUploadError:em,mediaType:j?"video":"audio"}),"clips"===eo&&"number"==typeof r&&n&&(0,Z.tZ)(rV,{audioUpload:K,postForEditor:n,postId:r,pub:i,transcription:null!=Y?Y:null,videoUpload:j})]})]})});var ot=i(13229);function oi(){let e=(0,G._)(["Last active ",""]);return oi=function(){return e},e}class on extends w.Component{componentDidMount(){this.canShowPresence()&&"undefined"!=typeof window&&(this.updatePresence(),(0,Y.ut)(this.updatePresence),window.addEventListener("beforeunload",this.setPresenceGone),window.addEventListener("unload",this.setPresenceGone))}componentWillUnmount(){this.canShowPresence()&&"undefined"!=typeof window&&(this.setPresenceGone(),(0,Y.kE)(this.updatePresence),window.removeEventListener("beforeunload",this.setPresenceGone),window.removeEventListener("unload",this.setPresenceGone))}render(){if(!this.canShowPresence())return null;let{user:e,iString:t,iTemplate:i,language:n}=this.props,{presence:r}=this.state,o=e=>(0,H.Z)(e).add(3e4,"milliseconds").isAfterNow(),a=(e,r,a)=>"pinging"===r&&o(a)?"".concat(e.name," \xb7 ").concat(t("Active now")):"".concat(e.name," \xb7 ").concat(i(oi(),(0,H.Z)(a).locale(n).fromNow())),l=r.filter(t=>t.user_id!==(null==e?void 0:e.id)).sort((e,t)=>{let i="pinging"===e.state&&o(e.updated_at);return+!!("pinging"===t.state&&o(t.updated_at))-+!!i});return(0,Z.tZ)(et.hs,{justifyContent:"end",flex:"grow",className:"post-presence",cursor:"pointer",children:l.length>0&&(0,Z.tZ)(ot.H,{direction:"rtl",users:l.map(e=>e.user),max:5,renderAvatar:e=>{let t=r.find(t=>{var i;return t.user.id===(null===(i=e.user)||void 0===i?void 0:i.id)});if(!t)return(0,Z.tZ)(eG.qE,(0,f._)({},e));let i="pinging"===t.state&&o(t.updated_at);return(0,Z.tZ)(tW.u,{text:a(t.user,t.state,t.updated_at),children:(0,Z.tZ)(eG.qE,(0,_._)((0,f._)({},e),{disabled:!i,title:void 0}))})}})})}constructor(...e){super(...e),(0,M._)(this,"checkTimeout",null),(0,M._)(this,"state",{isPresent:!0,presence:[],presenceError:null}),(0,M._)(this,"canShowPresence",()=>!!this.props.pub.has_multiple_users),(0,M._)(this,"updatePresence",async()=>{if(!(0,Y.dr)()){await this.setPresenceGone();return}this.checkTimeout&&clearTimeout(this.checkTimeout),this.setState({isPresent:!0});try{let e=await N().post("/api/v1/drafts/".concat(this.props.postId,"/presence")).query({editor_id:this.props.editorId});this.setState({presence:e.body})}catch(e){this.setState({presenceError:e})}this.checkTimeout&&clearTimeout(this.checkTimeout);let e=setTimeout(this.updatePresence,3e4);this.checkTimeout=e}),(0,M._)(this,"setPresenceGone",async()=>{if(this.checkTimeout&&clearTimeout(this.checkTimeout),this.state.isPresent){this.setState({isPresent:!1,presenceError:null});try{await N().del("/api/v1/drafts/".concat(this.props.postId,"/presence"))}catch(e){console.error("Failed to mark presence as gone",e)}}})}}let or=(0,Q.fz)(on);var oo=i(6070);let oa=e=>{let{suggestions:t,errors:i,onAddPaywall:n,onAddSubscribeCta:r,onAddVoiceover:o,onSendByEmail:a,onCancel:l}=e,s=t.concat(i).map(e=>e.identifier),d=(0,eq.Ij)(),[c,u]=(0,A.eJ)(!1);return s.includes("MISSING_VOICEOVER")?(0,Z.tZ)(os,{onAddVoiceover:o,onCancel:l}):s.includes("UNMENTIONABLE_USER_MENTIONED")?(0,Z.tZ)(ou,{}):s.includes("MISSING_SEND_AS_EMAIL_PROMPT")?(0,Z.tZ)(oc,{onSendByEmail:a,onCancel:l,disablePrompt:c,setDisablePrompt:u}):s.includes("MISSING_PAYWALL")?(0,Z.tZ)(ol,{onAddPaywall:n,onCancel:l,disablePrompt:c,hideDisablePrompt:(0,oo.HD)({pub:d}),setDisablePrompt:u}):s.includes("MISSING_SUBSCRIBE_CTA")?(0,Z.tZ)(od,{onAddSubscribeCta:r,onCancel:l,disablePrompt:c,setDisablePrompt:u}):(0,Z.tZ)("div",{})},ol=e=>{let{onAddPaywall:t,onCancel:i,disablePrompt:n,setDisablePrompt:r,hideDisablePrompt:o}=e,{iString:a}=(0,Q.M1)();return(0,Z.tZ)(tU.w,{children:(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.tZ)(ei.xv.H3,{weight:"heavy",children:a("Send a preview of this post to your free subscribers")}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:a("Publications that send free previews see a 15% increase in free-to-paid conversion on average.")}),!o&&(0,Z.tZ)(op,{disablePrompt:n,setDisablePrompt:r,name:"disable-paywall-prompt"}),(0,Z.BX)(et.gq,{gap:12,children:[(0,Z.tZ)(ee.zx,{onClick:()=>i(n,"MISSING_PAYWALL"),priority:"secondary",flex:"grow",children:a("Publish without preview")}),(0,Z.tZ)(ee.zx,{onClick:()=>t(n),flex:"grow",children:a("Add a paywall break")})]})]})})},os=e=>{let{onAddVoiceover:t,onCancel:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(tU.w,{children:(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.tZ)(ei.xv.H3,{weight:"heavy",children:n("Add a voiceover")}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:n("Most posts should have a voiceover, either AI generated or recorded.")}),(0,Z.BX)(et.gq,{gap:12,children:[(0,Z.tZ)(ee.zx,{onClick:()=>i(!1,"MISSING_VOICEOVER"),priority:"secondary",flex:"grow",children:n("Publish without voiceover")}),(0,Z.tZ)(ee.zx,{onClick:()=>t(),flex:"grow",children:n("Add a voiceover")})]})]})})},od=e=>{let{onAddSubscribeCta:t,onCancel:i,disablePrompt:n,setDisablePrompt:r}=e,{iString:o}=(0,Q.M1)();return(0,Z.tZ)(tU.w,{children:(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.tZ)(ei.xv.H3,{weight:"heavy",children:o("Add subscribe buttons to your post")}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:o("Your post has no buttons asking readers to subscribe. Posts that include subscribe buttons convert twice as many readers to subscribers on average.")}),(0,Z.tZ)(op,{disablePrompt:n,setDisablePrompt:r,name:"disable-cta-prompt"}),(0,Z.BX)(et.gq,{gap:12,children:[(0,Z.tZ)(ee.zx,{onClick:()=>i(n,"MISSING_SUBSCRIBE_CTA"),priority:"secondary",flex:"grow",children:o("Publish without buttons")}),(0,Z.tZ)(ee.zx,{onClick:()=>t(n),flex:"grow",children:o("Add subscribe buttons")})]})]})})},oc=e=>{let{onSendByEmail:t,onCancel:i,disablePrompt:n,setDisablePrompt:r}=e,{iString:o}=(0,Q.M1)();return(0,Z.tZ)(tU.w,{children:(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.tZ)(ei.xv.H3,{weight:"heavy",children:o("Are you sure you don't want to send your post via email?")}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:o("Your subscribers won't be notified about posts published only on web. Posts published on web are seen by less than 1% of subscribers.")}),(0,Z.tZ)(op,{disablePrompt:n,setDisablePrompt:r,name:"disable-email-prompt"}),(0,Z.BX)(et.gq,{gap:12,children:[(0,Z.tZ)(ee.zx,{onClick:()=>i(n,"MISSING_SEND_AS_EMAIL_PROMPT"),priority:"secondary",flex:"grow",children:o("Publish on web only")}),(0,Z.tZ)(ee.zx,{onClick:()=>t(n),flex:"grow","data-testid":"publish-button",children:o("Also send via email")})]})]})})},ou=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(tU.w,{children:(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.tZ)(ei.xv.H3,{weight:"heavy",children:e("An unmentionable user is mentioned in this post")}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:e("At least one user mentioned in this post has mentions disabled.")})]})})},op=e=>{let{disablePrompt:t,setDisablePrompt:i,name:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.BX)(et.gq,{gap:12,alignItems:"center",paddingY:4,children:[(0,Z.tZ)(iB.X,{name:n,checked:t,onChange:()=>i(!t),disabled:!1}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:r("Don't ask again")})]})},oh={edit:"edit-VlGkNh",socialPreview:"socialPreview-inYmSK",socialPreviewContent:"socialPreviewContent-YZJzQe",socialPreviewTitle:"socialPreviewTitle-NU3F2F",socialPreviewDescription:"socialPreviewDescription-GxEfz9",uploadButton:"uploadButton-uhtS8L",socialPreviewImageBox:"socialPreviewImageBox-n_BjuO",socialPreviewImageSelector:"socialPreviewImageSelector-hd5qO8",socialPreviewImage:"socialPreviewImage-wwbdfT",empty:"empty-OMFElm",socialPreviewImageOption:"socialPreviewImageOption-X8zRML",active:"active-qjZUrW",socialPreviewImageHelp:"socialPreviewImageHelp-JToff9",hasImages:"hasImages-nnoYHc"},om=e=>{let{post:t,audienceToggle:i}=e,{iString:n}=(0,Q.M1)(),{videoUpload:r}=(0,il.z)(),o="number"==typeof(null==r?void 0:r.preview_start)&&!!i&&["only_paid","founding"].includes(i);return r?(0,Z.tZ)(i1.g,{label:n("Connected accounts"),paddingBottom:24,children:(0,Z.tZ)(et.gq,{border:"detail",radius:"sm",padding:16,gap:16,className:k()("social-preview",oh.socialPreview),children:(0,Z.tZ)(iY,{mediaUploadId:r.id,post:t,freePreview:o,renderForm:!0})})}):null};var og=i(12766),ov=i(86603);function ob(e){var t,i;let{pub:n,post:r}=e,[o,a]=(0,ov.Z)(),{iString:l}=(0,Q.M1)(),s=(0,iS.ib)({pathname:"/api/v1/publication/post-tag",auto:!1,deps:[n]}),d=(0,iS.ib)({pathname:"/api/v1/post/".concat(r.id,"/tag"),auto:!1,deps:[n,r.id]}),[c,u]=(0,A.eJ)(!1),p=(null===(t=s.result)||void 0===t?void 0:t.filter(e=>!e.hidden))||[],h=(null===(i=s.result)||void 0===i?void 0:i.filter(e=>e.hidden))||[],m=(0,A.I4)(async()=>{!oy(r)||c||s.isLoading||d.isLoading||await Promise.all([s.refetch(),d.refetch()])},[c,r,s,d]);(0,A.d4)(()=>{(null==a?void 0:a.isIntersecting)&&m()},[null==a?void 0:a.isIntersecting]);let g=(0,A.I4)(async(e,t)=>{if(!c&&s.hasLoadedOnce&&d.hasLoadedOnce){u(!0);try{var i,n;if("select-option"===t.action){let e=await N().post("/api/v1/post/".concat(r.id,"/tag/").concat(null===(i=t.option)||void 0===i?void 0:i.id));d.setResult(d.result.concat([e.body]))}else"remove-value"===t.action&&(await N().delete("/api/v1/post/".concat(r.id,"/tag/").concat(null===(n=t.removedValue)||void 0===n?void 0:n.id)),d.setResult(d.result.filter(e=>{var i;return e.post_tag_id!==(null===(i=t.removedValue)||void 0===i?void 0:i.id)})))}catch(e){console.error("Failed to update tags:",e),alert((0,Y.zx)(e))}u(!1)}},[c,r,s,d]),v=(0,A.I4)(async e=>{if(!c&&s.hasLoadedOnce&&d.hasLoadedOnce){u(!0);try{var t;let i=null===(t=s.result)||void 0===t?void 0:t.find(t=>{var i;return(null===(i=t.name)||void 0===i?void 0:i.toLowerCase())===(null==e?void 0:e.toLowerCase())});if(i||(i=(await N().post("/api/v1/publication/post-tag").send({name:e})).body,s.setResult(s.result.concat([i]))),!d.result.find(e=>e.post_tag_id===i.id)){let e=await N().post("/api/v1/post/".concat(r.id,"/tag/").concat(i.id));d.setResult(d.result.concat([e.body]))}}catch(e){console.error("Failed to update tags:",e),alert((0,Y.zx)(e))}u(!1)}},[c,r,s,d]);return oy(r)?(0,Z.tZ)(i1.g,{ref:o,label:l("Add tags"),paddingBottom:24,children:(0,Z.tZ)(og.ZP,{placeholder:l("Select..."),options:h.length>0?[{label:l("Public Tags"),options:p},{label:l("Internal Tags"),options:h}]:p,value:(d.result||[]).map(e=>(s.result||[]).find(t=>t.id===e.post_tag_id)),getOptionLabel:e=>e.name,getOptionValue:e=>e.id,isMulti:!0,isClearable:!1,isLoading:c||!s.hasLoadedOnce||!d.hasLoadedOnce,disabled:c||!s.hasLoadedOnce||!d.hasLoadedOnce,onChange:g,onCreateOption:v,isValidNewOption:e=>e.length>1,getNewOptionData:e=>({name:e}),theme:(0,Y._I)({primary:"var(--color-accent-themed)",neutral0:"white",danger:"var(--color-accent-themed)",dangerLight:"var(--color-bg-accent-themed)"}),styles:{placeholder:e=>(0,_._)((0,f._)({},e),{fontSize:15,fontFamily:"var(--font-family-text)"}),input:e=>(0,_._)((0,f._)({},e),{fontSize:15,fontFamily:"var(--font-family-text)"}),multiValueLabel:e=>(0,_._)((0,f._)({},e),{fontSize:15,fontFamily:"var(--font-family-text)"}),multiValueRemove:e=>(0,_._)((0,f._)({},e),{cursor:"pointer"}),option:e=>(0,_._)((0,f._)({},e),{fontSize:15,cursor:"pointer",fontFamily:"var(--font-family-text)"}),noOptionsMessage:e=>(0,_._)((0,f._)({},e),{fontSize:15,fontFamily:"var(--font-family-text)"})},noOptionsMessage:()=>l("Start typingâ€¦")})}):null}function oy(e){return!["page"].includes(e.type)}let of=e=>{let{iString:t}=(0,Q.M1)();return(0,Z.tZ)(iC,(0,_._)((0,f._)({},e),{label:t("Share to Twitter"),name:"share-to-twitter",trackInput:"automatically_share"}))},o_=e=>(0,Z.tZ)(ee.zx,(0,_._)((0,f._)({},e),{priority:"primary",style:{backgroundColor:"var(--color-accent-fg-cyan)",height:36},leading:(0,Z.tZ)(F.Z,{fill:"white",height:16}),"data-testid":"twitter-connect-button"})),oZ=(e,t)=>{let i=t?(0,j.uRy)(e,t,{edit:!0,urlParams:{showPublishModal:!0}}):(0,j.wI3)(e,{section:"twitter-account"});return(0,en.ISD)({type:"enable_write_for_pub",redirect:i})},ow=e=>{let{pub:t,post:i,handleInput:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(of,{disabled:!0,onChange:n,value:!1,action:(0,Z.tZ)(o_,{href:oZ(t,i),children:r("Connect Twitter")})})},oC=e=>{let{pub:t,post:i,handleInput:n}=e,{iString:r}=(0,Q.M1)(),o=(0,Z.BX)(ei.xv,{translated:!0,color:"secondary",size:12,lineHeight:20,font:"text",children:["Connected as @",I18N.p(t.twitter_screen_name)]});return(0,Z.tZ)(of,{disabled:!0,onChange:n,value:!1,extras:o,action:(0,Z.tZ)(o_,{href:oZ(t,i),children:r("Upgrade permissions")})})},ox=e=>{let{pub:t,handleInput:i,shouldShareAutomatically:n}=e,{iString:r}=(0,Q.M1)(),o=(0,Z.BX)(ei.xv,{translated:!0,color:"secondary",size:12,lineHeight:20,font:"text",children:["Connected as @",I18N.p(t.twitter_screen_name)]});return(0,Z.tZ)(of,{onChange:i,value:n,extras:o,action:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",href:(0,j.wI3)(t,{section:"twitter-account"}),style:{height:36},children:r("Settings")})})},oS=e=>{let{pub:t,post:i,onToggleShareAutomatically:n,shouldShareAutomatically:r,canUpgradeTwitterPermissions:o}=e,a=(0,io.xR)(),l=e=>{(0,U.j)(U.FP.TWITTER_AUTO_SHARE_OPTION_TOGGLED,{pubId:t.id,inputChecked:e}),n(e)};if(a.getConfigFor("twitter_connect_flows_enabled")){if(t.twitter_screen_name&&"write"===t.twitter_permissions)return(0,Z.tZ)(ox,{handleInput:l,shouldShareAutomatically:r,pub:t});if(t.twitter_screen_name&&o)return(0,Z.tZ)(oC,{handleInput:l,post:i,pub:t});if(o)return(0,Z.tZ)(ow,{handleInput:l,pub:t,post:i})}return null};var ok=i(45705),oB=i(50364);class oT extends w.Component{render(){var e,t;let i=!!(0,eW.default)("like_comments_enabled");return(0,Z.tZ)(ok.g,{label:this.context.iString("Order comments byâ€¦"),name:"commentSort",options:(0,oB.Hz)({likesEnabled:i,language:this.context.language}).map(e=>{let{key:t,description:i}=e;return{value:t,label:i}}),paddingTop:16,value:null!==(t=null!==(e=this.props.value)&&void 0!==e?e:this.props.defaultValue)&&void 0!==t?t:"",onChange:e=>{this.onChange(e)}})}constructor(...e){super(...e),(0,M._)(this,"onChange",e=>{this.props.onChange&&this.props.onChange(e===this.props.defaultValue?null:e)})}}(0,M._)(oT,"contextType",Q.wj);let oI=e=>{let{locked:t,onUpdate:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(ok.g,{label:n("This thread is..."),name:"threadLock",options:[{value:"locked",label:n("Locked")},{value:"unlocked",label:n("Unlocked")}],value:t?"locked":"unlocked",onChange:e=>{i&&i("locked"===e)}})},oN=e=>{let{audience:t,currentValue:i,hasPaidPlans:n,name:r,onUpdate:o,postType:a}=e,{iString:l}=(0,Q.M1)();return(0,Z.tZ)(ok.g,{label:l("Allow comments from..."),name:r,options:nT()([(0,er.isValidCommentLevel)("everyone",t,a,n)&&{value:"everyone",label:l("Everyone"),track:"allow_comments_from_everyone"},(0,er.isValidCommentLevel)("only_paid",t,a,n)&&n&&{value:"only_paid",label:l("founding"===t?"Founding members only":"Paid subscribers only"),track:"allow_comments_from_only_paid"},(0,er.isValidCommentLevel)("none",t,a,n)&&{value:"none",label:l("No one (disable comments)"),track:"allow_comments_from_none"}]),value:i,onChange:e=>{o(e)}})},oP={disabled:"disabled-w0q8Pv"},oE=e=>{let{children:t,gap:i=0,disabled:n=!1}=e;return(0,Z.tZ)(et.tu,{as:"form",paddingBottom:{mobile:16,desktop:24},"data-testid":"form-section",children:(0,Z.tZ)(et.tu,{padding:16,paddingBottom:{mobile:16,desktop:24},shadow:n?void 0:"xs",border:"detail",radius:"sm",gap:i,color:n?"secondary":"primary",className:n?oP.disabled:void 0,children:t})})},oX=e=>{let{pub:t,post:i,postType:n,audienceToggle:r,commentLevel:o,onChangeCommentLevel:a,omitCommentSort:l=!1,commentSort:s,setCommentSort:d}=e,c="thread"===n&&!!(null==i?void 0:i.is_published),u=!["thread","page"].includes(n)&&"only_free"!==r&&t.community_enabled,p=!l&&(u&&"none"!==o||"thread"===n),h=u||c||p;return(0,Z.tZ)(ik.H,{expanded:h,children:(0,Z.BX)(oE,{children:[(0,Z.tZ)(ik.H,{expanded:u,children:(0,Z.tZ)(oN,{name:"commentLevel",onUpdate:a,currentValue:o,audience:r,postType:n,hasPaidPlans:(0,er.pubHasPaymentsEnabled)(t)})}),(0,Z.tZ)(ik.H,{expanded:c,children:(0,Z.tZ)(oI,{locked:"none"===o,onUpdate:e=>{e?a("none"):a(r)}})}),(0,Z.tZ)(ik.H,{expanded:p,children:(0,Z.tZ)(oT,{pub:t,onChange:d,defaultValue:t.default_comment_sort,value:s})})]})})},oM={freePreviewText:"freePreviewText-VXR95R"};function oA(){let e=(0,G._)(["Free and non-founding subscribers"]);return oA=function(){return e},e}function oD(){let e=(0,G._)(["Free subscribers"]);return oD=function(){return e},e}let oR=e=>{let{postType:t,createFreePreviewVideoAndClose:i,insertPaywallAndClose:n,insertPodcastPreviewAndClose:r,audienceToggle:o}=e;if("podcast"===t&&"founding"===o)return(0,Z.BX)(ei.xv,{translated:!0,size:14,color:"secondary",className:oM.freePreviewText,font:"text",children:["To send a preview of the episode to your free and non-founding subscribers, first"," ",(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:n,children:"add a paywall break"})," ","or"," ",(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:r,children:"add free audio"}),"."]});if("podcast"===t)return(0,Z.BX)(ei.xv,{translated:!0,size:14,color:"secondary",className:oM.freePreviewText,font:"text",children:["To send a preview of the episode to your free subscribers, first"," ",(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:n,children:"add a paywall break"})," ","or"," ",(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:r,children:"add free audio"}),"."]});if("video"===t&&"founding"===o)return(0,Z.BX)(ei.xv,{translated:!0,size:14,color:"secondary",className:oM.freePreviewText,font:"text",children:["To send a preview of the video to your free and non-founding subscribers, first"," ",(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:n,children:"add a paywall break"})," ","or"," ",(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:i,children:"create a video preview"}),"."]});if("video"===t)return(0,Z.BX)(ei.xv,{translated:!0,size:14,color:"secondary",className:oM.freePreviewText,font:"text",children:["To send a preview of the video to your free subscribers, first"," ",(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:n,children:"add a paywall break"})," ","or"," ",(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:i,children:"create a video preview"}),"."]});if("newsletter"===t&&"founding"===o)return(0,Z.BX)(ei.xv,{translated:!0,size:14,color:"secondary",className:oM.freePreviewText,font:"text",children:["To send a preview of the post to your free and non-founding subscribers, first"," ",(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:n,children:"add a paywall break"}),"."]});return(0,Z.BX)(ei.xv,{translated:!0,size:14,color:"secondary",className:oM.freePreviewText,font:"text",children:["To send a preview of the post to your free subscribers, first"," ",(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:n,children:"add a paywall break"}),"."]})},oF=e=>{let{sendFreePreviewToggle:t,setSendFreePreview:i,audienceToggle:n}=e,{iTemplate:r}=(0,Q.M1)();return(0,Z.tZ)(iw.j,{label:r("founding"===n?oA():oD()),track:"send_paywalled_preview",value:t,onChange:i})},oL=e=>{let{canSendFreePreview:t,audienceToggle:i,postType:n,createFreePreviewVideoAndClose:r,insertPaywallAndClose:o,insertPodcastPreviewAndClose:a,sendFreePreviewToggle:l,setSendFreePreview:s}=e,{iString:d}=(0,Q.M1)();return(0,Z.tZ)(oE,{children:(0,Z.tZ)(i1.g,{label:d("Send free preview"),helpText:(e=>{let t,{postType:i,audienceToggle:n}=e;return"podcast"===i&&"founding"===n?t=(0,Z.BX)(ei.xv,{as:"span",translated:!0,children:["When you add a paywall or a free audio preview, free and non-founding subscribers will see a list of benefits. You can modify your publication's subscription benefits on your"," ",(0,Z.tZ)("a",{href:"/publish/settings#connect",target:"_blank",children:"settings page"}),"."]}):"podcast"===i?t=(0,Z.BX)(ei.xv,{as:"span",translated:!0,children:["When you add a paywall or a free audio preview, free subscribers will see a list of benefits. You can modify your publication's subscription benefits on your"," ",(0,Z.tZ)("a",{href:"/publish/settings#connect",target:"_blank",children:"settings page"}),"."]}):"newsletter"===i&&"founding"===n?t=(0,Z.BX)(ei.xv,{as:"span",translated:!0,children:["When you add a paywall, free and non-founding subscribers will see a list of benefits. You can modify your publication's subscription benefits on your"," ",(0,Z.tZ)("a",{href:"/publish/settings#connect",target:"_blank",children:"settings page"}),"."]}):"newsletter"===i?t=(0,Z.BX)(ei.xv,{as:"span",translated:!0,children:["When you add a paywall, free subscribers will see a list of benefits. You can modify your publication's subscription benefits on your"," ",(0,Z.tZ)("a",{href:"/publish/settings#connect",target:"_blank",children:"settings page"}),"."]}):"video"===i&&"founding"===n?t=(0,Z.BX)(ei.xv,{as:"span",translated:!0,children:["When you add a paywall or a free video preview, free and non-founding subscribers will see a list of benefits. You can modify your publication's subscription benefits on your"," ",(0,Z.tZ)("a",{href:"/publish/settings#connect",target:"_blank",children:"settings page"}),"."]}):"video"===i&&(t=(0,Z.BX)(ei.xv,{as:"span",translated:!0,children:["When you add a paywall or a free video preview, free subscribers will see a list of benefits. You can modify your publication's subscription benefits on your"," ",(0,Z.tZ)("a",{href:"/publish/settings#connect",target:"_blank",children:"settings page"}),"."]})),t})({postType:n,audienceToggle:i}),children:(0,Z.tZ)(et.tu,{children:t&&(0,ty.isPaidAudience)(i)?(0,Z.tZ)(oF,{sendFreePreviewToggle:l,setSendFreePreview:s,audienceToggle:i}):(0,Z.tZ)(oR,{postType:n,createFreePreviewVideoAndClose:r,insertPaywallAndClose:o,insertPodcastPreviewAndClose:a,audienceToggle:i})})})})},oz=e=>{let{post:t,postType:i,audienceToggle:n}=e,[r,o]=(0,A.eJ)(!!(null==t?void 0:t.free_unlock_required)),[a,l]=(0,A.eJ)(!1),{iString:s}=(0,Q.M1)(),d=(0,A.I4)(async()=>{if(!a){l(!0);try{await N().put("/api/v1/drafts/".concat(t.id,"/free_unlock_required")).send({free_unlock_required:!r}),t.free_unlock_required=!r,o(!r)}catch(e){alert((0,Y.zx)(e))}l(!1)}},[t,r,a]);return(0,eW.default)("free_unlock_required")&&(null==t?void 0:t.id)&&"everyone"===n&&"adhoc_email"!==i?(0,Z.tZ)(oE,{children:(0,Z.tZ)(i1.g,{label:s("Free subscribe required to read full post"),children:(0,Z.tZ)(iw.j,{value:r,label:s("When turned on, visitors will only be allowed to read the full post if they are on your email list"),onChange:d})})}):null};var oO=i(84146),oU=i(69791),oY=i(17688),oH=i(11280);function oj(){let e=(0,G._)(["Test title ",""]);return oj=function(){return e},e}function oJ(){let e=(0,G._)(["Subtitle for test ",""]);return oJ=function(){return e},e}function oV(){let e=(0,G._)(["Once your post is published, ","% of recipients will receive an email with one of the titles below. After ",", the title with the highest open rate will win and be sent to the remaining ","% of recipients."]);return oV=function(){return e},e}let oq=e=>{let{pub:t,post:i,hasTest:n,setHasTest:r,enabled:o}=e,[a,l]=(0,A.eJ)(!1),[s,d]=(0,A.eJ)([{headline:i.draft_title||i.title||"",subtitle:i.draft_subtitle||i.subtitle||""},{headline:"",subtitle:""}]),[c,u]=(0,A.eJ)(30),[p,h]=(0,A.eJ)(36e5),[m,g]=(0,A.eJ)(30),{iString:v}=I18N.i({pub:t}),[b,y]=(0,A.eJ)(!1),[w,C]=(0,A.eJ)(!1),[x,S]=(0,A.eJ)([]),k=e=>{let t=e.variants.filter(e=>e.headline),i=[];return t.length<=1&&i.push(v("You must have at least two titles.")),e.showSubtitles&&!t.every(e=>e.subtitle)&&i.push(v("All titles must have a subtitle.")),S(i),0===i.length},B=async e=>{if(!k(e))return;let t=e.variants.filter(e=>e.headline);try{await (0,ix.rd)("/api/v1/headline-tests/".concat(i.id),{method:"PUT",json:{testInfo:{options:t.map(t=>(0,f._)({headline:t.headline},t.subtitle&&e.showSubtitles&&{subtitle:t.subtitle})),percent_traffic:e.testCohortPercent,duration:e.plannedDurationMs}}}),C(!0)}catch(e){console.error("Failed to save headline test:",e)}},T=(0,A.sO)(ip()(e=>{B(e)},1e3)),I=e=>{var t,i,n,r;return T.current({variants:null!==(t=e.variants)&&void 0!==t?t:s,showSubtitles:null!==(i=e.showSubtitles)&&void 0!==i?i:a,testCohortPercent:null!==(n=e.testCohortPercent)&&void 0!==n?n:c,plannedDurationMs:null!==(r=e.plannedDurationMs)&&void 0!==r?r:p})};(0,A.d4)(()=>{d([{headline:i.draft_title||i.title||"",subtitle:i.draft_subtitle||i.subtitle||""},...s.slice(1)])},[i.draft_title,i.title,i.draft_subtitle,i.subtitle]),(0,A.d4)(()=>{w&&r(!0)},[w]),(0,A.d4)(()=>{let e=async()=>{let e=await (0,ix.rd)("/api/v1/headline-tests/".concat(i.id));(null==e?void 0:e.test)&&e.test.options?(d(e.test.options.map(e=>({headline:e.headline,subtitle:e.subtitle||""}))),u(e.test.test_cohort_percent),h(e.test.planned_duration_ms),l(e.test.options.some(e=>e.subtitle)),C(!0)):(null==e?void 0:e.metadata)&&u(e.metadata.recommendedTestCohortPercent),g(e.metadata.recommendedTestCohortPercent),y(!0)};b||e()},[i.id,s.length,s,b]);let N=e=>{if(s.length<=2)return;let t=s.filter((t,i)=>i!==e);d(t),I({variants:t})},P=(e,t,i)=>{let n=s.map((n,r)=>r===e?(0,_._)((0,f._)({},n),{[t]:i}):n);d(n),I({variants:n})},E=(0,A.I4)(async()=>{try{await (0,ix.rd)("/api/v1/headline-tests/".concat(i.id),{method:"DELETE"}),C(!1),r(!1)}catch(e){console.error("Failed to delete headline test:",e)}},[i.id,r]);return((0,A.d4)(()=>{(async()=>{n&&!o&&await E()})()},[n,o,E]),i)?(0,Z.tZ)(oE,{disabled:!o,children:(0,Z.BX)(et.sg,{children:[(0,Z.BX)(oH.ZR,{children:[o?(0,Z.tZ)(oH.sY,{primaryText:v("Run a title test"),secondaryText:v("Test different post titles and automatically publish the winner")}):(0,Z.tZ)(oH.sY,{primaryText:v("Title testing unavailable"),secondaryText:v("You can only run tests when sending a post via email.")}),(0,Z.tZ)(i2.ZP,{checked:!!o&&n,disabled:!o,onChange:async e=>{e?(s.filter(e=>e.headline).length>1&&I({variants:s,showSubtitles:a,testCohortPercent:c,plannedDurationMs:p}),r(!0)):w?await E():r(!1)}})]}),(0,Z.tZ)(ik.H,{expanded:n&&o,renderWhenCollapsed:!1,children:(0,Z.BX)(et.sg,{gap:20,paddingTop:20,children:[(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(o4,{testCohortPercent:c,plannedDurationMs:p}),(0,Z.BX)(et.sg,{gap:8,children:[(0,Z.BX)(et.X2,{justifyContent:"space-between",children:[(0,Z.tZ)(tA.__,{children:v("Experimental titles")}),(0,Z.tZ)(et.X2,{gap:16,alignItems:"center",children:(0,Z.tZ)(oW,{showSubtitles:a,onChange:e=>{l(e),I({showSubtitles:e})}})})]}),(0,Z.tZ)(et.sg,{gap:a?20:8,children:s.map((e,t)=>(0,Z.BX)(et.X2,{gap:8,alignItems:"start",children:[(0,Z.BX)(tD.fv,{flex:"grow",children:[(0,Z.tZ)(oG,{index:t,variant:e,onHeadlineChange:e=>P(t,"headline",e)}),a&&(0,Z.tZ)(oK,{index:t,variant:e,onSubtitleChange:e=>P(t,"subtitle",e)})]}),t>1&&(0,Z.tZ)(o$,{onClick:()=>N(t)})]},t))}),s.length<4&&(0,Z.tZ)(o0,{addVariant:()=>{if(s.length>=4)return;let e=[...s,{headline:"",subtitle:""}];d(e),I({variants:e})}})]}),(0,Z.tZ)(o1,{testCohortPercent:c,onTestCohortChange:e=>{u(Number(e)),I({testCohortPercent:Number(e)})},recommendedCohortSize:m}),(0,Z.tZ)(o2,{plannedDurationMs:p,onDurationChange:e=>{h(Number(e)),I({plannedDurationMs:Number(e)})}}),x.length>0&&(0,Z.tZ)(tM.y,{children:x[0]})]})})]})}):null},oW=e=>{let{showSubtitles:t,onChange:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)(et.X2,{alignItems:"center",gap:8,children:[(0,Z.tZ)(ei.xv.B4,{as:"label",htmlFor:"show-subtitles",children:n("Include subtitles")}),(0,Z.tZ)(iB.X,{size:"sm",checked:t,onChange:e=>i(e),id:"show-subtitles"})]})},oG=e=>{let{index:t,variant:i,onHeadlineChange:n}=e,{iString:r,iTemplate:o}=(0,Q.M1)();return(0,Z.tZ)(tD.oi,{disabled:0===t,placeholder:0===t?r("Original title"):o(oj(),t+1),value:i.headline,trailing:0===t?(0,Z.tZ)(oQ,{text:r("This value is tied to the title of your post in the editor.")}):null,onChange:e=>{n(e.currentTarget.value)},flex:"grow"})},oK=e=>{let{index:t,variant:i,onSubtitleChange:n}=e,{iString:r,iTemplate:o}=(0,Q.M1)();return(0,Z.BX)(et.X2,{flex:"grow",children:[(0,Z.tZ)(et.M5,{width:40,height:40,paddingBottom:4,sizing:"border-box",children:(0,Z.tZ)(oO.Z,{size:24,color:"var(--color-fg-tertiary)",strokeWidth:1.5})}),(0,Z.tZ)(tD.oi,{disabled:0===t,placeholder:0===t?r("Original subtitle"):o(oJ(),t+1),value:i.subtitle||"",trailing:0===t?(0,Z.tZ)(oQ,{text:r("This value is tied to the subtitle of your post in the editor.")}):null,onChange:e=>{n(e.currentTarget.value)},flex:"grow"})]})},oQ=e=>{let{text:t}=e;return(0,Z.tZ)(tW.u,{text:t,children:(0,Z.tZ)(ts.xu,{cursor:"pointer",children:(0,Z.tZ)(tl.Z,{size:16,color:"var(--color-fg-tertiary)"})})})},o$=e=>{let{onClick:t}=e;return(0,Z.tZ)(o6,{children:(0,Z.tZ)(ee.hU,{priority:"quaternary",size:"sm",onClick:t,children:(0,Z.tZ)(iW.Z,{size:18})})})},o0=e=>{let{addVariant:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(et.X2,{pullX:8,justifyContent:"start",children:(0,Z.tZ)(ee.zx,{priority:"quaternary",size:"sm",onClick:t,leading:(0,Z.tZ)(ta.Z,{size:16}),children:i("Add another title")})})},o1=e=>{let{testCohortPercent:t,onTestCohortChange:i,recommendedCohortSize:n}=e,{iString:r}=(0,Q.M1)(),o=[{label:r("5% of recipients"),value:String(5)},{label:r("10% of recipients"),value:String(10)},{label:r("20% of recipients"),value:String(20)},{label:r("30% of recipients"),value:String(30)},{label:r("40% of recipients"),value:String(40)},{label:r("50% of recipients"),value:String(50)}],a={label:r("".concat(n,"% of recipients (recommended)")),value:String(n)},l=o.filter(e=>e.value!==a.value);return l.push(a),l.sort((e,t)=>Number(e.value)-Number(t.value)),(0,Z.BX)(tD.fv,{flex:"grow",children:[(0,Z.BX)(o8,{children:[(0,Z.tZ)(tA.__,{children:r("Test size")}),(0,Z.tZ)(o3,{text:r("The percent of total post recipients who will receive test emails")})]}),(0,Z.BX)(oY.i,{value:String(t),onChange:e=>{i(e.target.value)},children:[(0,Z.tZ)(oY.d,{children:r("Select a size")}),l.map(e=>(0,Z.tZ)("option",{value:e.value,children:e.label},e.value))]})]})},o2=e=>{let{plannedDurationMs:t,onDurationChange:i}=e,{iString:n}=(0,Q.M1)(),r=[{label:n("30 minutes"),value:String(18e5)},{label:n("1 hour"),value:String(36e5)},{label:n("2 hours"),value:String(72e5)},{label:n("3 hours"),value:String(108e5)},{label:n("6 hours"),value:String(216e5)}];return(0,Z.BX)(tD.fv,{flex:"grow",children:[(0,Z.BX)(o8,{children:[(0,Z.tZ)(tA.__,{children:n("Test duration")}),(0,Z.tZ)(o3,{text:n("How long your test will run before selecting a winner")})]}),(0,Z.BX)(oY.i,{value:String(t),onChange:e=>{i(e.target.value)},children:[(0,Z.tZ)(oY.d,{children:n("Select a duration")}),r.map(e=>(0,Z.tZ)("option",{value:e.value,children:e.label},e.value))]})]})},o4=e=>{let{testCohortPercent:t,plannedDurationMs:i}=e,{iString:n,iTemplate:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(!0),l=H.Z.duration(i,"milliseconds").humanize();return o?(0,Z.tZ)(oU.b,{theme:"default",priority:"secondary",title:n("How does title testing work?"),description:r(oV(),t,l,100-t),onDismiss:()=>a(!1)}):null},o3=e=>{let{text:t}=e;return(0,Z.tZ)(tW.u,{text:t,children:(0,Z.tZ)(eR.Z,{size:14,color:"var(--color-fg-secondary)",cursor:"pointer"})})},o8=(0,ts.zo)({display:"flex",direction:"row",alignItems:"center",justifyContent:"start",gap:6}),o6=(0,ts.zo)({display:"flex",alignItems:"center",justifyContent:"center",height:40});var o5=i(53501);let o9=e=>{var{ref:t,className:i,error:n=!1,font:r}=e,o=(0,ef._)(e,["ref","className","error","font"]);return(0,Z.tZ)("input",(0,f._)({type:"number",ref:t,className:k()(i,o5.Z.input,o5.Z.number,{[o5.Z.error]:n},r&&o5.Z["font-".concat(r)])},o))},o7=e=>{var{fill:t="#1C110B"}=e,i=(0,ef._)(e,["fill"]);return(0,Z.BX)(eH.l,(0,_._)((0,f._)({},i),{name:"CaretDownIcon",svgParams:{height:6,width:10,fill:t},children:[(0,Z.tZ)("path",{d:"M4.61589 5.53907L0.68341 0.820092C0.412024 0.494429 0.643602 0 1.06752 0H8.93248C9.3564 0 9.58798 0.494428 9.31659 0.820091L5.38411 5.53907C5.18421 5.77894 4.81579 5.77894 4.61589 5.53907Z"}),");"]}))},ae=e=>{let{isCollapsed:t}=e;return(0,Z.tZ)("div",{className:k()("icon-fqxGs8",{"iconCollapsed-lAPuM2":t}),children:(0,Z.tZ)(o7,{height:4})})},at=[{label:"None",value:""},{label:"Full",value:"full"},{label:"Trailer",value:"trailer"},{label:"Bonus",value:"bonus"}],ai=e=>(e=null!=e?e:"",at.find(t=>t.value===e)),an=e=>{let{tag:t}=e;return(0,Z.tZ)(ei.xv,{color:"secondary",size:12,font:"monospace",children:"<itunes:".concat(t,">")})},ar=e=>{let{label:t,itunesTag:i,children:n,style:r}=e;return(0,Z.BX)(et.tu,{gap:8,style:r,as:"label",children:[(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(et.gq,{alignItems:"center",gap:4,children:(0,Z.tZ)(ei.xv.B4,{weight:"semibold",children:t})}),i&&(0,Z.tZ)(an,{tag:i})]}),(0,Z.tZ)("div",{children:n})]})},ao=e=>{var t;let{metadata:i,setMetadata:n}=e,{episodeNumber:r,seasonNumber:o,episodeType:a,isExplicit:l}=i,s=ai(a),{iString:d}=(0,Q.M1)(),c=e=>{n((0,f._)({},i,e))},[u,p]=(0,A.eJ)(!1);return(0,Z.BX)(et.tu,{border:"detail",radius:"sm",style:{marginBottom:24},children:[(0,Z.tZ)(n_.J,{onClick:()=>{p(!u)},"data-testid":"podcast-metadata-toggle",children:(0,Z.BX)(et.gq,{padding:16,justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(i1.g,{label:d("Episode metadata"),helpText:d("Customize the metadata that appears in external podcast players. All of this is optional.")}),(0,Z.tZ)(ae,{isCollapsed:!u})]})}),(0,Z.tZ)(ik.H,{expanded:u,children:(0,Z.BX)(et.tu,{gap:16,padding:16,paddingBottom:{mobile:16,desktop:24},children:[(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(iw.j,{value:null!=l&&l,label:d("Explicit"),testid:"syndicate-explicit-toggle",track:"podcast_episode_explicit",onChange:e=>{c({isExplicit:e})}}),(0,Z.tZ)(an,{tag:"explicit"})]}),(0,Z.BX)(et.hs,{gap:16,direction:{desktop:"row",mobile:"column"},children:[(0,Z.tZ)(ar,{label:d("Episode"),itunesTag:"episode",style:{flexGrow:1},children:(0,Z.tZ)(o9,{name:"episodeNumber","data-testid":"episode-number-input",value:null!=r?r:"",placeholder:d("Episode number"),maxLength:10,onChange:e=>{c({episodeNumber:e.target.value})}})}),(0,Z.tZ)(ar,{label:d("Season"),itunesTag:"season",style:{flexGrow:1},children:(0,Z.tZ)(o9,{name:"seasonNumber","data-testid":"season-number-input",value:null!=o?o:"",placeholder:d("Season number"),maxLength:10,onChange:e=>{c({seasonNumber:e.target.value})}})})]}),(0,Z.tZ)(ar,{label:d("Episode type"),itunesTag:"episodeType",children:(0,Z.tZ)(ok.g,{name:"episodeType",options:at.map(e=>({label:e.label,value:e.value,track:"podcast_episode_type_".concat(e.value||"none"),testid:"podcast_episode_type_".concat(e.value||"none")})),value:null!==(t=null==s?void 0:s.value)&&void 0!==t?t:"none",onChange:e=>{c({episodeType:e})}})})]})})]})},aa=e=>{var t,i;let{metadata:n,saving:r,onSave:o}=e,[a,l]=(0,A.eJ)(n),{iString:s}=(0,Q.M1)();return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ao,{metadata:a,setMetadata:l}),(0,Z.tZ)(ik.H,{expanded:n.isExplicit!=a.isExplicit||n.episodeNumber!=a.episodeNumber||n.seasonNumber!=a.seasonNumber||(null===(t=ai(n.episodeType))||void 0===t?void 0:t.value)!=(null===(i=ai(a.episodeType))||void 0===i?void 0:i.value),children:(0,Z.BX)(et.gq,{gap:4,paddingBottom:16,children:[(0,Z.tZ)(ee.zx,{disabled:r,priority:"primary",onClick:()=>{o(a)},children:s("Save")}),(0,Z.tZ)(ee.zx,{disabled:r,priority:"secondary",onClick:()=>l(n),children:s("Cancel")})]})})]})},al=e=>{var t,i,n,r;let{pub:o,post:a,postBody:l,podcastDescription:s,savePodcastDescription:d,hasPodcastPreview:c,onHideFromFeedChange:u,selectedSectionId:p,isVoiceover:h}=e,m="undefined"!=typeof window?(0,j.UA6)(window.location.pathname,p):void 0,[g,v]=(0,A.eJ)(!1),[b,y]=(0,A.eJ)(!1),{iString:f}=(0,Q.M1)();(0,A.d4)(()=>v(!1),[s]),(0,A.d4)(()=>y(!1),[g]),(0,A.d4)(()=>{var e;(null!==(e=i5().addHook)&&void 0!==e?e:i5()().addHook)("afterSanitizeAttributes",e=>{"target"in e&&e.setAttribute("target","_blank")})},[]),(0,A.d4)(()=>{var e;(null==a?void 0:null===(e=a.draftPodcastUpload)||void 0===e?void 0:e.state)!=="error"||a.hide_from_feed||u(!0)},[a]);let _=(null==a?void 0:null===(t=a.draftPodcastUpload)||void 0===t?void 0:t.state)==="error",w=(0,A.sO)(null);if(!a)return null;let C=l?(0,eo.getDefaultPodcastDescriptionWithoutFeedCTAs)(a,{body:l,hasPodcastPreview:c}):null,x=s||C||"",S=(null!==(i=i5().sanitize)&&void 0!==i?i:i5()().sanitize)(x,{USE_PROFILES:{html:!0}}),B=null!==(r=(null!==(n=o.sections)&&void 0!==n?n:[]).find(e=>e.id===p))&&void 0!==r?r:null,T=B&&B.is_podcast||!B&&o.podcast_enabled,I=async e=>{(0,U.j)(U.FP.PODCAST_EPISODE_NOTES_SAVE_CLICKED,{post_id:a?a.id:null}),await d(e),v(!1)};return h?(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.tZ)(nZ,{post:a,postBody:l,podcastDescription:s,hasPodcastPreview:c,savePodcastDescription:d})}):(0,Z.tZ)(oE,{children:T?(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(i1.g,{label:f("Add audio to podcast RSS feed"),details:f("Allow listeners to access your post on external podcast players"),compact:!0}),(0,Z.tZ)(i2.rs,{disabled:_,checked:!a.hide_from_feed,onChange:e=>u(!e)})]}),(0,Z.tZ)(tX.iz,{}),(0,Z.BX)(i1.g,{label:f("Episode Notes"),disabled:!!a.hide_from_feed,helpText:f("Changing information here will update your podcast description on external podcast players like Apple Podcasts and Spotify."),className:k()({[nb.disabled]:!!a.hide_from_feed}),action:g?void 0:(0,Z.tZ)(n_.J,{onClick:()=>v(!0),children:(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",as:"span",className:nb.editText,children:"Edit"})}),children:[g&&(0,Z.tZ)(ny,{hide:!b,initialContent:x,onSave:I,editorRef:w,onEditorReady:()=>y(!0),onEditorDestroyed:()=>y(!1),setEditing:v}),!b&&(0,Z.tZ)(nf,{content:S})]})]}):(0,Z.tZ)(et.tu,{gap:16,children:(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(i1.g,{label:f("Add audio to podcast RSS feed"),details:f("Allow listeners to access your post on external podcast players"),compact:!0}),(0,Z.tZ)(ee.zx,{size:"sm",priority:"primary",href:m,children:"Set up podcast"})]})})})};function as(){let e=(0,G._)(["Posts more than "," old are\n            automatically paywalled according to your "]);return as=function(){return e},e}let ad=e=>{let{onRemoveArchivePaywall:t,publicationSettings:i,pub:n}=e,[r,o]=((null==i?void 0:i.enable_archive_paywall)||"").split("-"),{iString:a,iTemplate:l}=(0,Q.M1)();return(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:a("This post is auto-paywalled"),secondaryText:(0,Z.BX)(Z.HY,{children:[l(as(),H.Z.duration(Number(r),o).humanize()),(0,Z.tZ)(ei.hh,{target:"_blank",decoration:"underline",rel:"noopener",native:!0,href:(0,en.wI3)(n,{section:"payments-settings"}),children:a("settings")}),"."]})}),(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:e=>{e.preventDefault(),t()},children:a("Remove paywall")})]})},ac={caretDownIcon:"caretDownIcon-EnPMOR",active:"active-bWosJX",moreButton:"moreButton-pBCc_A"},au=e=>{let{postType:t,audienceToggle:i}=e;return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ik.H,{expanded:"thread"===t&&"everyone"===i,children:(0,Z.tZ)(ei.xv.B5,{color:"secondary",translated:!0,paddingTop:12,children:"Note: non-subscribers will be able to comment on this thread."})}),(0,Z.tZ)(ik.H,{expanded:"only_free"===i,children:(0,Z.tZ)(ei.xv.B5,{color:"secondary",translated:!0,paddingTop:12,children:"Note: Free-only posts are sent as emails but will not be visible in your publication archive."})})]})},ap=e=>{let{audienceToggle:t,onChangeAudience:i,canSendToOnlyFree:n,canSendToOnlyFounding:r,cannotSendToSubscribers:o}=e,a=!o&&(r||n),l="founding"===t||"only_free"===t,[s,d]=(0,A.eJ)(!1),{iString:c}=(0,Q.M1)();return((0,A.d4)(()=>{("founding"===t||"only_free"===t)&&d(!0)},[t]),a)?(0,Z.BX)(et.tu,{paddingTop:8,alignItems:"start",children:[(0,Z.tZ)(ee.zx,{className:ac.moreButton,onClick:e=>{e.preventDefault(),d(!s)},size:"sm",priority:"tertiary",disabled:l,trailing:(0,Z.tZ)(o7,{height:6,className:"".concat(ac.caretDownIcon," ").concat(s?ac.active:"")}),children:c("More options")}),(0,Z.tZ)(ik.H,{expanded:s,children:(0,Z.tZ)(ok.g,{paddingTop:8,name:"audience",options:nT()([r&&{value:"founding",label:c("Founding members only"),track:"send_to_founding_only"},n&&{value:"only_free",label:c("Free subscribers only"),track:"send_to_free_only"}]),value:t,onChange:e=>{i(e)}})})]}):null},ah=e=>{let{pub:t,publicationSettings:i,postType:n,audienceToggle:r,onChangeAudience:o,audienceBeforeArchived:a,onRemoveArchivePaywall:l,cannotSendToSubscribers:s,canSendToOnlyFree:d,canSendToOnlyFounding:c,canOnlySendToEveryone:u,isMetered:p,onChangeIsMetered:h}=e,{iString:m}=(0,Q.M1)(),{getConfigFor:g}=(0,io.xR)(),v=g("post_metering_enabled")&&(null==i?void 0:i.post_metering_enabled),b=u?[{value:"everyone",label:m("Everyone"),track:"send_to_everyone"}]:[{value:"everyone",label:m("Everyone"),track:"send_to_everyone"},{value:"only_paid",label:(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("span",{className:s?"crossed-out":"",children:m("Paid subscribers only")})," ",s&&(0,Z.BX)("a",{href:(0,j.wI3)(t,{section:"payments-settings"}),children:["(",m("Turn on paid subscriptions"),")"]})]}),disabled:s,track:"send_to_paid_only",testid:"send_to_paid_only"}];return(0,Z.tZ)(oE,{children:a?(0,Z.tZ)(ad,{pub:t,publicationSettings:i,onRemoveArchivePaywall:l}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ok.g,{label:m("Audience"),name:"audience",options:b,value:r,onChange:e=>{o(e)}}),!u&&(0,Z.tZ)(ap,{audienceToggle:r,onChangeAudience:o,canSendToOnlyFree:d,cannotSendToSubscribers:s,canSendToOnlyFounding:c}),v&&(0,Z.tZ)(i1.g,{label:m("Metering"),paddingTop:24,paddingBottom:0,children:(0,Z.tZ)(iw.j,{value:p,label:m("Enable post metering"),onChange:h})}),(0,Z.tZ)(au,{postType:n,audienceToggle:r})]})})},am={selectContainer:"selectContainer-woVieq",singleValue:"singleValue-y5mM0l"},ag=e=>e.data.can_publish_to?(0,Z.tZ)(rW.F.Option,(0,f._)({},e)):(0,Z.tZ)(tW.u,{text:e.data.hover_text,children:(0,Z.tZ)(rW.F.Option,(0,f._)({},e))}),av=e=>(0,_._)((0,f._)({},e),{label:e.name,value:e.section_id,isDisabled:!e.can_publish_to}),ab=e=>{let{activeFeeds:t,inactiveFeeds:i,onChange:n,selectedSectionId:r}=e,{iString:o}=(0,Q.M1)(),{allFeeds:a,options:l,feedOptions:s}=(0,A.Ye)(()=>{let e=[...t,...i],n=[],r=t.map(av),a=i.map(av),l=[...r,...a];return 0===i.length?n.push(...l):(t.length>0&&n.push({label:o("Active"),options:[...r]}),i.length>0&&n.push({label:o("Inactive"),options:[...a]})),{allFeeds:e,options:n,feedOptions:l}},[t,i]),d=s.find(e=>e.section_id===r);return 1===a.length&&a[0]?(0,Z.tZ)("div",{className:am.singleValue,children:a[0].name}):(0,Z.tZ)("div",{className:am.selectContainer,children:(0,Z.tZ)(rG.ZP,{className:"post-section-selector",components:{Option:ag},styles:{container:e=>(0,_._)((0,f._)({},e),{display:"block",cursor:"pointer"}),menu:e=>(0,_._)((0,f._)({},e),{zIndex:100}),option:e=>(0,_._)((0,f._)({},e),{cursor:"pointer"}),indicatorSeparator:e=>(0,_._)((0,f._)({},e),{display:"none"}),control:e=>(0,_._)((0,f._)({},e),{cursor:"pointer",borderColor:"var(--border_subtle)"}),singleValue:e=>(0,_._)((0,f._)({},e),{color:"inherit"}),dropdownIndicator:e=>(0,_._)((0,f._)({},e),{color:"inherit !important"})},name:"section",value:d,options:l,onChange:e=>{n(e)}})})},ay={showNotesContainer:"showNotesContainer-XRv0gP"},af=e=>{let{pub:t,post:i,canSyndicate:n,shouldSyndicate:r,syndicateToSectionId:o,setSyndicateInfo:a,showNotesProps:l}=e,{iString:s}=(0,Q.M1)(),{allFeeds:d,activeFeeds:c,inactiveFeeds:u,sectionIdToFeed:p}=(0,A.Ye)(()=>{let e=(0,nC.rD)({pub:t}),i=[],n=[],r={};return e.forEach(e=>{e.can_publish_to?i.push(e):n.push(e),r[e.section_id]=e}),{allFeeds:e,activeFeeds:i,inactiveFeeds:n,sectionIdToFeed:r}},[t]);return(0,Z.BX)(oE,{children:[(0,Z.tZ)(iw.j,{value:r,label:s("Add voiceover to podcast RSS feed"),details:s("This will allow listeners to access your post on external podcast players"),testid:"syndicate-voiceover-toggle",track:"syndicate_voiceover_to_rss",onChange:e=>{let t=null;if(!r){let e=p[i.section_id];t=(null==e?void 0:e.can_publish_to)?i.section_id:c[0].section_id}a({shouldSyndicate:e,syndicateToSectionId:t,shouldSyndicateToOtherFeed:!0})}}),n&&r&&(0,Z.BX)(Z.HY,{children:[d.length>1&&(0,Z.tZ)(ab,{activeFeeds:c,inactiveFeeds:u,selectedSectionId:o,onChange:e=>{a({shouldSyndicate:r,syndicateToSectionId:e.section_id,shouldSyndicateToOtherFeed:!0})}}),(0,Z.tZ)("div",{className:ay.showNotesContainer,children:(0,Z.tZ)(al,(0,_._)((0,f._)({},l),{isVoiceover:!0}))})]})]})},a_=e=>{var{shouldSyndicate:t,syndicateToSectionId:i,shouldSyndicateToOtherFeed:n,saving:r,onSave:o}=e,a=(0,ef._)(e,["shouldSyndicate","syndicateToSectionId","shouldSyndicateToOtherFeed","saving","onSave"]);let l={shouldSyndicate:t,syndicateToSectionId:i,shouldSyndicateToOtherFeed:n},[s,d]=(0,A.eJ)(l),{iString:c}=(0,Q.M1)();return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(af,(0,_._)((0,f._)({},a),{setSyndicateInfo:d,shouldSyndicate:s.shouldSyndicate,shouldSyndicateToOtherFeed:s.shouldSyndicateToOtherFeed,syndicateToSectionId:s.syndicateToSectionId})),(0,Z.tZ)(ik.H,{expanded:l.shouldSyndicate!==s.shouldSyndicate||l.syndicateToSectionId!==s.syndicateToSectionId||l.shouldSyndicateToOtherFeed!==s.shouldSyndicateToOtherFeed,children:(0,Z.BX)(et.gq,{paddingBottom:16,gap:4,children:[(0,Z.tZ)(ee.zx,{disabled:r,priority:"primary",onClick:()=>{o(s)},children:c("Save")}),(0,Z.tZ)(ee.zx,{disabled:r,priority:"secondary",onClick:()=>d(l),children:c("Cancel")})]})})]})},aZ=e=>{let{post:t,postType:i,publicationSettings:n,audienceToggle:r,setTeaserPostEligible:o,sendFreePreviewToggle:a,teaserPostEligibleToggle:l}=e,{iString:s}=(0,Q.M1)();return(null==n?void 0:n.paywall_unlock_tokens)&&(null==t?void 0:t.id)&&"only_paid"===r&&a&&"adhoc_email"!==i?(0,Z.tZ)(oE,{children:(0,Z.tZ)(i1.g,{label:s("Include in teaser posts"),helpText:(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(ei.xv,{as:"span",translated:!0,children:["Teaser posts grants your free subscribers a one-time unlock of a single paywalled post."," ",(0,Z.tZ)("a",{href:"/publish/settings#boost",target:"_blank",children:"Manage teaser post settings"}),"."]})}),children:(0,Z.tZ)(iw.j,{value:l,onChange:o,label:s("Enable free subscribers to redeem their single-use unlock on this paywalled content")})})}):null};var aw=i(20898);class aC extends w.Component{getValue(){return this.base?this.base[this.props.plainText?"textContent":"innerHTML"]:null}setValue(){this.base&&(this.base[this.props.plainText?"textContent":"innerHTML"]=this.props.value)}shouldComponentUpdate(e){return!!this.base&&!(0,Y.$Z)(this.base)||e.value!==this.getValue()}componentDidUpdate(){this.lastValue=this.props.value,this.setValue()}render(e){var{ref:t,children:i,className:n,disabled:r,readOnly:o,value:a,plainText:l,onInput:s,onPaste:d,onBlur:c,onKeyDown:u,onEnter:p}=e,h=(0,ef._)(e,["ref","children","className","disabled","readOnly","value","plainText","onInput","onPaste","onBlur","onKeyDown","onEnter"]);return(0,Z.tZ)("div",(0,_._)((0,f._)({className:"content-editable ".concat(n||""),onKeyDown:e=>{this.onKeyDown(e),u&&u(e)},onInput:e=>{this.onChange(e),s&&s(e)},onBlur:e=>{this.onChange(e),c&&c(e)},onPaste:e=>{this.onPaste(e),d&&d(e)},contentEditable:!r&&!o,dangerouslySetInnerHTML:l?null:{__html:a}},h),{children:l?a:null}))}constructor(...e){super(...e),(0,M._)(this,"lastValue",void 0),(0,M._)(this,"onChange",e=>{let t=this.getValue();this.props.onChange&&t!==this.lastValue&&this.props.onChange(t),this.lastValue=t}),(0,M._)(this,"onKeyDown",e=>{if("Enter"===e.key){if(this.props.onEnter)this.props.onEnter(e);else{var t;e.preventDefault(),null===(t=e.currentTarget)||void 0===t||t.blur()}}}),(0,M._)(this,"onPaste",e=>{if(this.props.plainText)try{var t;let i=null===(t=(e.originalEvent||e).clipboardData||window.clipboardData)||void 0===t?void 0:t.getData("Text");e.preventDefault(),document.execCommand("insertText",!1,i)}catch(e){console.error("Failed to handle pasted value:",e),setTimeout(()=>this.setValue(),0)}})}}var ax=i(83330);let aS=e=>{let{useDraft:t,draftTitle:i,title:n}=e;return t?i:n},ak=e=>{let{useDraft:t,post:i,pub:n,language:r}=e;return(0,eo.getDescription)(t?null==i?void 0:i.draft_body:null==i?void 0:i.body,t?null==i?void 0:i.draft_subtitle:null==i?void 0:i.subtitle,{post:Object.assign({},i,{videoUpload:t?null==i?void 0:i.draftVideoUpload:null==i?void 0:i.videoUpload}),maxStopAfter:n.post_preview_limit,language:r})||(0,er.postSocialDescription)(i,n,r)},aB=e=>{let{showSave:t,useDraft:i,pub:n,post:r,postType:o,audienceToggle:a,socialTitle:l,onChangeSocialTitle:s,socialDescription:d,onChangeSocialDescription:c,socialImage:u,onChangeSocialImage:p,saving:h,saveSocialMetadata:m,resetSocialMetadata:g}=e,[v,b]=(0,A.eJ)(!1),{iString:y,language:f}=(0,Q.M1)(),_=(0,A.sO)(null),w=async e=>{b(!0);try{let t=await N().post("/api/v1/image").send({image:e,postId:r?r.id:void 0});p(t.body.url)}catch(e){alert((0,Y.zx)(e))}b(!1)};if(!r||"page"===o||"only_free"===a)return null;r.is_published||(i=!0);let C=aS({useDraft:i,draftTitle:r.draft_title,title:r.title}),x=ak({useDraft:i,post:r,pub:n,language:f}),S=r?(0,eo.getCoverImages)(i?r.draft_body:r.body,r):[],B=S.length?S[0]:null;S=S.concat([n.logo_url,n.email_banner_url,n.author_photo_url]).filter(e=>e);let T=u||B,I=(r.social_title||C)!==(l||C)||(r.description||x)!==(d||x)||(r.cover_image||B)!==(u||B);if(!C||!x)return(0,Z.tZ)(i1.g,{label:y("Social preview"),children:(0,Z.tZ)(ei.xv.B3,{translated:!0,color:"secondary",children:"Not available"})});let P="".concat((0,j.uRy)(n,r,{uuid:!0}),"/media-assets"),E="podcast"===o?(0,Z.BX)(ei.xv.B4,{translated:!0,as:"span",children:["Changes here will affect how your episode is listed in public places (e.g. Twitter) and your shareable images (",(0,Z.tZ)(ei.hh,{href:P,target:"_blank",rel:"noopener",children:"view images"}),") â€” not the episode itself."]}):(0,Z.BX)(ei.xv.B4,{translated:!0,as:"span",children:["Changes here will affect how your post is listed in public places (e.g. Twitter) and your shareable images (",(0,Z.tZ)(ei.hh,{href:P,target:"_blank",rel:"noopener",children:"view images"}),") â€” not the post itself."]});return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(i1.g,{className:"social-preview-wrap",label:y("Social preview"),action:(0,Z.tZ)(n_.J,{onClick:e=>{(0,Y.UG)(e.currentTarget.parentNode.parentNode.parentNode.querySelector(".social-preview-title"))},children:(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",as:"span",className:oh.edit,children:"Edit"})}),paddingBottom:24,details:E,children:(0,Z.BX)(et.gq,{border:"detail",radius:"sm",padding:16,gap:16,className:k()("social-preview",oh.socialPreview),children:[(0,Z.BX)("div",{className:k()("social-preview-content",oh.socialPreviewContent),onClick:e=>{e.target===e.currentTarget&&(0,Y.UG)(e.currentTarget.querySelector(".social-preview-description"))},children:[(0,Z.tZ)(aC,{className:k()("social-preview-title",oh.socialPreviewTitle),plainText:!0,value:l||C,onChange:s,onEnter:e=>{var t;return(0,Y.UG)(null===(t=e.currentTarget)||void 0===t?void 0:t.nextSibling)},onFocus:e=>(0,Y.UG)(e.currentTarget),onBlur:e=>(0,Y.YU)(e.currentTarget)}),(0,Z.tZ)(aC,{className:k()("social-preview-description",oh.socialPreviewDescription),plainText:!0,value:d||x,onChange:c,onFocus:e=>(0,Y.UG)(e.currentTarget),onBlur:e=>(0,Y.YU)(e.currentTarget)})]}),(0,Z.BX)("div",{children:[(0,Z.BX)("div",{className:k()("social-preview-image-box",oh.socialPreviewImageBox),children:[(0,Z.tZ)("div",{className:k()("social-preview-image",oh.socialPreviewImage,{empty:!(u||B),[oh.empty]:!(u||B)}),style:T?{backgroundImage:'url("'.concat((0,j.zF4)(T,200,{height:144,smartCrop:!0}),'")')}:void 0,onClick:()=>{var e;"undefined"!=typeof document&&(null===(e=document.getElementById("image-picker"))||void 0===e||e.click())},children:!(u||B)&&(0,Z.tZ)(ax.Z,{})}),(0,Z.BX)("div",{className:k()("social-preview-image-selector",oh.socialPreviewImageSelector),children:[S.map(e=>(0,Z.tZ)("div",{className:k()("social-preview-image-option",oh.socialPreviewImageOption,{active:(u||B)===e,[oh.active]:(u||B)===e}),style:{backgroundImage:'url("'.concat((0,j.zF4)(e,200,{height:144,smartCrop:!0}),'")')},onClick:()=>p(e)})),(0,Z.tZ)("div",{className:k()("social-preview-image-help",oh.socialPreviewImageHelp,{"has-images":S.length>0,[oh.hasImages]:S.length>0}),children:y("podcast"===o?"Choose an image from your episode larger than 420x300 pixels or upload a new one":"Choose an image from your post larger than 420x300 pixels or upload a new one")})]})]}),(0,Z.BX)("div",{className:k()("upload-button",oh.uploadButton),children:[(0,Z.tZ)("label",{htmlFor:"image-picker",children:y(v?"Uploading":"Upload New")}),(0,Z.tZ)("input",{disabled:v,type:"file",id:"image-picker",accept:"image/*",ref:_,onChange:async()=>{var e,t;let i=null===(t=_.current)||void 0===t?void 0:null===(e=t.files)||void 0===e?void 0:e[0];if(i){let e=await (0,Y.Zk)(i);await w(e)}else console.warn("could not find file on input")}})]})]})]})}),(0,Z.tZ)(ik.H,{expanded:t&&I,children:(0,Z.BX)(et.gq,{gap:4,paddingBottom:24,children:[(0,Z.tZ)(ee.zx,{disabled:h,priority:"primary",onClick:()=>{var e;return m({socialTitle:l||C,socialDescription:d||x,socialImage:null!==(e=u||B)&&void 0!==e?e:null})},children:y("Save")}),(0,Z.tZ)(ee.zx,{disabled:h,priority:"secondary",onClick:g,children:y("Cancel")})]})})]})};var aT=i(96745),aI=i(81821);let aN={noHover:"noHover-On7ruH",textarea:"textarea-tzHZKE",modalBackground:"modalBackground-HhdMkH",modalContent:"modalContent-lhyaMb",modalHeader:"modalHeader-MdcsFB",modalFooter:"modalFooter-PFR5Y1",sectionSelector:"sectionSelector-z575zA"};function aP(){let e=(0,G._)(["Publish ",""]);return aP=function(){return e},e}function aE(){let e=(0,G._)(["Start experiment ",""]);return aE=function(){return e},e}function aX(){let e=(0,G._)(["Send to everyone ",""]);return aX=function(){return e},e}function aM(){let e=(0,G._)(["Update ",""]);return aM=function(){return e},e}function aA(){let e=(0,G._)(["Publish ",""]);return aA=function(){return e},e}function aD(){let e=(0,G._)(["Start experiment ",""]);return aD=function(){return e},e}function aR(){let e=(0,G._)(["Send post and free previews ",""]);return aR=function(){return e},e}function aF(){let e=(0,G._)(["Update post and free previews ",""]);return aF=function(){return e},e}function aL(){let e=(0,G._)(["Publish post and free previews ",""]);return aL=function(){return e},e}function az(){let e=(0,G._)(["Start experiment ",""]);return az=function(){return e},e}function aO(){let e=(0,G._)(["Send to founding members ",""]);return aO=function(){return e},e}function aU(){let e=(0,G._)(["Update ",""]);return aU=function(){return e},e}function aY(){let e=(0,G._)(["Publish ",""]);return aY=function(){return e},e}function aH(){let e=(0,G._)(["Start experiment ",""]);return aH=function(){return e},e}function aj(){let e=(0,G._)(["Send to paid subscribers ",""]);return aj=function(){return e},e}function aJ(){let e=(0,G._)(["Update ",""]);return aJ=function(){return e},e}function aV(){let e=(0,G._)(["Publish ",""]);return aV=function(){return e},e}function aq(){let e=(0,G._)(["Start experiment ",""]);return aq=function(){return e},e}function aW(){let e=(0,G._)(["Send to free subscribers ",""]);return aW=function(){return e},e}function aG(){let e=(0,G._)(["Update ",""]);return aG=function(){return e},e}function aK(){let e=(0,G._)(["Publish ",""]);return aK=function(){return e},e}function aQ(){let e=(0,G._)(["This video belongs inâ€¦"]);return aQ=function(){return e},e}function a$(){let e=(0,G._)(["This post belongs inâ€¦"]);return a$=function(){return e},e}function a0(){let e=(0,G._)(["This email is scheduled for ",""]);return a0=function(){return e},e}function a1(){let e=(0,G._)(["This post is scheduled for ",""]);return a1=function(){return e},e}let a2=i(49762);function a4(e){let t,{modalRef:i,post:n,pub:r,publicationSettings:o,publishing:a,saving:l,lastScheduledAt:s,scheduledAt:d,scheduledRepublishes:c,onChangeScheduledRepublishes:u,unlockAt:p,onChangeScheduledAt:h,onChangeUnlockAt:m,postType:g,audienceToggle:v,sendFreePreviewToggle:b,teaserPostEligibleToggle:y,onChangeAudience:f,cannotSendToSubscribers:_,canSendToOnlyFree:w,canSendToOnlyFounding:C,canOnlySendToEveryone:x,onChangeCommentLevel:S,commentLevel:B,canSendEmail:T,shouldSendEmail:I,shouldShareAutomatically:N,setSendFreePreview:P,canSendFreePreview:E,shouldSendFreePreview:X,canSeeSendFreePreviewOption:M,setTeaserPostEligible:D,canSeeTeaserPostSettings:R,insertPaywallAndClose:F,insertPodcastPreviewAndClose:L,createFreePreviewVideoAndClose:z,mustSendEmail:O,dontSendEmail:U,onToggleSendEmail:Y,onToggleShareAutomatically:j,audienceBeforeArchived:J,onRemoveArchivePaywall:V,closeModal:q,publishPost:W,socialMetadataProps:G,showSectionSelector:K,setSection:$,section_id:en,section_chosen:er,showNotesProps:eo,commentSort:ea,setCommentSort:el,hasPendingImports:es,user:ed,syndicateVoiceoverProps:ec,podcastEpisodeMetadataProps:eu,onBeforeClose:ep,isEditor2:eh=!1,isMetered:em,onChangeIsMetered:eg}=e,{iString:ev,iTemplate:eb,language:ey}=(0,Q.M1)(),[ef,e_]=(0,A.eJ)(!0),[eZ,ew]=(0,A.eJ)(!1);(0,A.d4)(()=>{if((0,oo.HD)({pub:r})&&r.authorPagesInfo&&er&&!c&&(null==n?void 0:n.postBylines)&&!(null==n?void 0:n.is_published)&&"adhoc_email"!==n.type){var e;let t=null===(e=n.postBylines[0])||void 0===e?void 0:e.user_id,i=t?r.authorPagesInfo.find(e=>e.user_id===t):null;(null==i?void 0:i.primary_section_id)&&(null==i?void 0:i.primary_section_id)!==en&&u([{section_id:i.primary_section_id,date:(0,H.Z)(d||Date.now()).add(1,"hours").toDate()}])}},[er,null==n?void 0:n.postBylines,u,r,d,c]);let eC=(e,t)=>{let i=new Date(e);return i.setHours(i.getHours()+t),i.setSeconds(0),i.setMilliseconds(0),i},ex=eC(new Date,24),eS=[{section_id:-1,date:(0,H.Z)(d||Date.now()).add(1,"hours").toDate()}],ek=eC(new Date,25),eB=!d||!isNaN(d.getTime()),eT=d?(0,H.Z)(d).locale(ey).max(Date.now()+2).fromNow():null,eI=er&&null===en&&(0,oo.HD)({pub:r});s?t=ev(I?"Un-schedule Email":"Un-schedule Publishing"):eI?t=eT?eb(aP(),eT):ev("Publish now"):"everyone"===v?t=I?eT?eb(eZ?aE():aX(),eT):ev(eZ?"Start experiment now":"Send to everyone now"):(null==n?void 0:n.is_published)?eT?eb(aM(),eT):ev("Update now"):eT?eb(aA(),eT):ev("Publish now"):X?t=I?eT?eb(eZ?aD():aR(),eT):ev(eZ?"Start experiment now":"Send post and free previews now"):(null==n?void 0:n.is_published)?eT?eb(aF(),eT):ev("Update post and free previews now"):eT?eb(aL(),eT):ev("Publish post and free previews now"):"founding"===v?t=I?eT?eb(eZ?az():aO(),eT):ev(eZ?"Start experiment now":"Send to founding members now"):(null==n?void 0:n.is_published)?eT?eb(aU(),eT):ev("Update now"):eT?eb(aY(),eT):ev("Publish now"):"only_paid"===v?t=I?eT?eb(eZ?aH():aj(),eT):ev(eZ?"Start experiment now":"Send to paid subscribers now"):(null==n?void 0:n.is_published)?eT?eb(aJ(),eT):ev("Update now"):eT?eb(aV(),eT):ev("Publish now"):"only_free"===v&&(t=I?eT?eb(eZ?aq():aW(),eT):ev(eZ?"Start experiment now":"Send to free subscribers now"):(null==n?void 0:n.is_published)?eT?eb(aG(),eT):ev("Update now"):eT?eb(aK(),eT):ev("Publish now")),a&&(t=ev("Publishing..."),(null==n?void 0:n.is_published)&&!p&&(t=ev("Updating...")),s?t=ev("Un-scheduling..."):d&&(t=ev("Scheduling...")));let eN=K&&(0,nC.i$)(r,g),eP=null==ec?void 0:ec.canSyndicate,eE=(0,H.Z)(d||Date.now()).add(1,"hour").toDate(),eX="podcast"===g||eP&&(null==ec?void 0:ec.shouldSyndicate),eM="podcast"===g,eA=!n||!n.is_published,eD=a2.getConfigFor("twitter_connect_flows_enabled"),eR="";p&&eC(d||new Date,1)>eC(p,0)&&(eR=ev(d?"Unlock must be at least 1 hour after the scheduled send time.":"Unlock must be scheduled at least 1 hour in the future."));let eF=(0,aI.tq)(),eL=s?null:(0,Z.tZ)(et.tu,{gap:4,className:eF?"post-settings-section mobile-ctas":"",children:(0,Z.BX)(et.gq,{gap:12,direction:"row-reverse",children:[(0,Z.tZ)(ee.zx,{disabled:l||a||!eB||!!eR,priority:s?"destructive":"primary",onClick:W,children:t}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:q,disabled:a,className:k()({[aN.noHover]:a}),children:ev("Cancel")}),(0,Z.tZ)("input",{type:"hidden","data-track-input":"publish_button_text",value:t})]})});return(0,Z.tZ)(tU.w,{children:(0,Z.BX)(a3,{modalRef:i,useMobileFooter:eF,footerCTAs:eL,onBeforeClose:ep,isOpen:void 0,pub:r,closeModal:q,isEditor2:eh,children:[s&&(0,Z.tZ)(a8,{closeModal:q,postType:g,publishPost:W,publishButtonText:t,saving:l,scheduledAt:s}),!s&&v&&n&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ah,{pub:r,publicationSettings:o,postType:g,audienceToggle:v,onChangeAudience:f,audienceBeforeArchived:J,onRemoveArchivePaywall:V,cannotSendToSubscribers:_,canSendToOnlyFree:w,canSendToOnlyFounding:C,canOnlySendToEveryone:x,isMetered:em,onChangeIsMetered:eg}),(0,Z.tZ)(ik.H,{expanded:M,children:(0,Z.tZ)(oL,{canSendFreePreview:E,audienceToggle:v,postType:g,createFreePreviewVideoAndClose:z,insertPaywallAndClose:F,insertPodcastPreviewAndClose:L,sendFreePreviewToggle:b,setSendFreePreview:P})}),(0,Z.tZ)(oz,{post:n,postType:g,audienceToggle:v}),B&&(0,Z.tZ)(oX,{pub:r,post:n,postType:g,audienceToggle:v,commentLevel:B,onChangeCommentLevel:S,omitCommentSort:!0,commentSort:ea,setCommentSort:el}),(0,Z.tZ)(ik.H,{expanded:R,children:(0,Z.tZ)(aZ,{post:n,postType:g,publicationSettings:o,audienceToggle:v,sendFreePreviewToggle:b,teaserPostEligibleToggle:y,setTeaserPostEligible:D})}),eN&&eN.length>0&&(0,Z.tZ)(i1.g,{label:eb("video"===g?aQ():a$()),paddingBottom:24,children:(0,Z.tZ)(aw.ZP,{className:aN.sectionSelector,pubName:r.name,pubHasPodcast:r.podcast_enabled,sections:eN,showRoot:!0,onChange:$,currentValue:er?en:-1,wysiwyg:!1})}),n&&(0,Z.tZ)(ob,{pub:r,post:n}),eP&&(0,Z.tZ)(af,{pub:ec.pub,post:ec.post,showNotesProps:ec.showNotesProps,canSyndicate:ec.canSyndicate,shouldSyndicate:ec.shouldSyndicate,setSyndicateInfo:ec.setSyndicateInfo,selectedSectionId:ec.selectedSectionId,syndicateToSectionId:ec.syndicateToSectionId,shouldSyndicateToOtherFeed:ec.shouldSyndicateToOtherFeed}),eM&&(0,Z.tZ)(al,{pub:eo.pub,post:eo.post,selectedSectionId:eo.selectedSectionId,postBody:eo.postBody,isVoiceover:eo.isVoiceover,hasPodcastPreview:eo.hasPodcastPreview,podcastDescription:eo.podcastDescription,onHideFromFeedChange:eo.onHideFromFeedChange,savePodcastDescription:eo.savePodcastDescription}),(0,Z.tZ)(aB,{pub:G.pub,post:G.post,postType:G.postType,saving:G.saving,socialImage:G.socialImage,socialTitle:G.socialTitle,audienceToggle:G.audienceToggle,socialDescription:G.socialDescription,saveSocialMetadata:G.saveSocialMetadata,onChangeSocialImage:G.onChangeSocialImage,onChangeSocialTitle:G.onChangeSocialTitle,resetSocialMetadata:G.resetSocialMetadata,onChangeSocialDescription:G.onChangeSocialDescription,showSave:!1,useDraft:!0}),eX&&(0,Z.tZ)(ao,{metadata:eu.metadata,setMetadata:eu.setMetadata}),(0,Z.tZ)(om,{pub:G.pub,post:G.post,audienceToggle:G.audienceToggle}),!(null==n?void 0:n.is_published)&&(0,eW.getConfigFor)("headline_testing_enabled")&&!["page"].includes(g)&&(0,Z.tZ)(oq,{post:n,pub:r,enabled:ef,hasTest:eZ,setHasTest:ew}),!["page"].includes(g)&&(0,Z.BX)(oE,{gap:24,children:[eA&&eD&&(0,Z.tZ)(i1.g,{label:ev("Sharing"),children:(0,Z.tZ)(oS,{canUpgradeTwitterPermissions:!!ed.is_admin,shouldShareAutomatically:N,post:n,pub:r,onToggleShareAutomatically:j})}),T&&(0,Z.BX)(i1.g,{label:ev("Delivery"),children:[!eI&&(0,Z.tZ)(iC,{label:ev("Send via email and the Substack app"),disabled:O,trackInput:"send_email",value:I,onChange:e=>{Y(!e),e_(e)}}),eI&&(0,Z.tZ)(ei.xv.B4,{fontStyle:"italic",translated:!0,children:"This post will only be published to the web and on the app. Email will not be sent. To send this post as an email, select a newsletter other than The Free Press."}),es&&(0,Z.BX)(ei.xv,{as:"div",translated:!0,className:"post-settings-email-warning tw-mt-2",children:[(0,Z.tZ)("span",{className:"warning-text",children:"Warning: "}),"Some of your subscribers are still importing and won't get this email. You can find the status of these imports on the"," ",(0,Z.tZ)("a",{href:"/publish/subscribers/add",target:"_blank",native:!0,children:"Add Subscribers page"})]})]}),(0,Z.BX)(i1.g,{label:ev("Scheduling"),children:[(0,Z.tZ)(iC,{label:ev(U?"Schedule time to publish":"Schedule time to email and publish"),trackInput:"schedule_post",name:"scheduled-at",value:!!d,onChange:e=>h(e?d||ex:null),extras:(0,Z.tZ)(ik.H,{expanded:!!d,children:(0,Z.tZ)(et.tu,{paddingTop:4,children:(0,Z.tZ)(a6,{value:null!=d?d:ex,onChange:e=>{p&&e>p&&m(e),h(e)}})})})}),(0,Z.tZ)(ik.H,{expanded:(0,ty.isPaidAudience)(v),children:(0,Z.tZ)(iw.j,{label:ev("Schedule time to unlock post and email free subscribers"),paddingTop:8,track:"schedule_unlock_time",value:!!p,onChange:e=>{m(e?p||ek:null)},contentBelow:(0,Z.tZ)(ik.H,{expanded:!!p,children:(0,Z.BX)(et.tu,{paddingTop:4,children:[(0,Z.tZ)(a6,{value:null!=p?p:ek,onChange:e=>{d&&e<d&&h(e),m(e)},min:eC(new Date,1)}),eR&&(0,Z.tZ)(ei.xv,{color:"error",className:"notice",as:"span",paddingTop:4,children:eR})]})})})}),eN&&eN.length>0&&er&&(0,oo.HD)({pub:r})&&!(null==n?void 0:n.is_published)&&(0,Z.BX)(et.tu,{gap:8,paddingTop:8,children:[(0,Z.tZ)(iC,{label:ev("Schedule republishes to a specific section"),trackInput:"schedule_republishes",name:"scheduled-republishes",value:!!c,onChange:e=>u(e?c||eS:void 0)}),(0,Z.tZ)(ik.H,{expanded:!!c,children:(0,Z.tZ)(aw.F5,{sections:eN,primarySection:en,scheduledRepublishes:c,onChange:e=>{u(e)},minimumDate:eE})})]})]})]})]}),eF&&eL]})})}let a3=e=>{let{children:t,isOpen:i,modalRef:n,useMobileFooter:r,footerCTAs:o,onBeforeClose:a,pub:l,closeModal:s,isEditor2:d}=e,{iString:c}=I18N.i({pub:l});return d?(0,Z.tZ)(eK.u_,{position:"full",isOpen:i,children:(0,Z.BX)(ts.xu,{className:aN.modalBackground,children:[(0,Z.BX)(ts.xu,{padding:12,borderBottom:"detail",className:aN.modalHeader,children:[(0,Z.tZ)(ee.hU,{onClick:()=>{a(),s()},priority:"tertiary",children:(0,Z.tZ)(K.Z,{size:20})}),(0,Z.tZ)(ei.xv.H2,{font:"pub-headings",children:c("Publish")})]}),(0,Z.tZ)(ts.xu,{padding:12,className:aN.modalContent,children:t}),o&&(0,Z.tZ)(ts.xu,{padding:12,borderTop:"detail",className:aN.modalFooter,children:o})]})}):(0,Z.tZ)(L.Z,{ref:n,className:"force-light-theme",testID:"publish-modal",trackInputsID:"publish-form",variant:"structured",modalTitle:c("Publish"),modalFooter:r?null:o,onBeforeClose:a,children:t})},a8=e=>{let{saving:t,closeModal:i,postType:n,publishButtonText:r,publishPost:o,scheduledAt:a}=e,{iString:l,iTemplate:s,language:d}=(0,Q.M1)(),c=(0,H.Z)(a).locale(d).standardDatetime();return(0,Z.BX)(et.tu,{alignItems:"center",gap:16,paddingTop:16,children:[(0,Z.tZ)(ei.xv.B3,{children:s("adhoc_email"===n?a0():a1(),c)}),(0,Z.BX)(et.gq,{gap:12,children:[(0,Z.tZ)(ee.zx,{disabled:t,priority:"destructive",onClick:o,children:r}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:i,children:l("Dismiss")}),(0,Z.tZ)("input",{type:"hidden","data-track-input":"publish_button_text",value:r})]})]})};function a6(e){let{value:t,onChange:i,min:n=new Date}=e,[r,o]=(0,A.eJ)(t);return(0,Z.tZ)(aT.Tz,{className:aN.datePicker,"data-testid":"date-editor",value:r,min:n,max:new Date(Date.now()+79488e5),onChange:e=>{let{value:t}=e.currentTarget;o(t),i(new Date(t))}})}var a5=i(73943),a9=i(40121);let a7={pubUrlReadOnly:"pubUrlReadOnly-NV1crA",postUrlInput:"postUrlInput-MnqTnE",postUrlInputCopyButton:"postUrlInputCopyButton-pLdLcZ"};function le(){let e=(0,G._)(["Your post URL is currently "," characters (maximum: ",")"]);return le=function(){return e},e}let lt=e=>{var t;let{pub:i,post:n,slugDraft:r,setSlugDraft:o,saveSlug:a,saving:l,setSlugFormIsDirty:s}=e,[d,c]=(0,A.eJ)(!1),{iString:u,iTemplate:p}=(0,Q.M1)();if(!n)return(0,Z.tZ)(Z.HY,{});let h=!!r&&n.slug!==r||d,m=n.slug||(0,a9.Of)(n.title||n.draft_title),g=()=>{null==s||s(!1),c(!1),o(n.slug)},v=()=>null!=r?r:m,b=async e=>{if(e.preventDefault(),(n.is_published||(0,er.getScheduledAt)(n))&&!window.confirm(u("Are you sure you want to change this post's slug? Doing so will break any existing links to this post."))){g();return}let{success:t}=await a(v());c(!t),null==s||s(!t)},y=async()=>{if(n.slug)(0,Y.vQ)((0,j.uRy)(i,n));else{let{post:e,success:t}=await a(v());c(!t),null==s||s(!t),t&&e&&(0,Y.vQ)((0,j.uRy)(i,e))}};return(0,Z.BX)(et.tu,{as:"form",onSubmit:b,children:[(0,Z.tZ)(i1.g,{label:u("Post URL"),details:p(le(),(null===(t=null!=r?r:m)||void 0===t?void 0:t.length)||0,a5.$j),children:(0,Z.BX)(et.gq,{children:[(0,Z.tZ)(tD.oi,{className:a7.pubUrlReadOnly,readOnly:!0,value:"".concat((0,j.G1C)((0,j.SVA)(i)),"/p/"),onFocus:e=>(0,Y.UG)(e.currentTarget.nextSibling)}),(0,Z.tZ)(tD.oi,{className:a7.postUrlInput,disabled:l,value:null!=r?r:m,onChange:e=>{c(!1),null==s||s(!0),o(e.currentTarget.value)},maxLength:a5.$j}),(0,Z.tZ)(ee.zx,{disabled:h||l,className:a7.postUrlInputCopyButton,priority:"primary",onClick:y,children:u("Copy link")})]})}),(0,Z.tZ)(ik.H,{expanded:h,children:(0,Z.BX)(et.tu,{paddingTop:16,gap:16,children:[n.is_published&&(0,Z.BX)(ei.xv,{translated:!0,size:14,color:"error",children:[(0,Z.tZ)("strong",{children:"Warning:"})," Since your post is published, if you change the post url then any existing links to the old post url will no longer work."]}),(0,er.getScheduledAt)(n)&&(0,Z.BX)(ei.xv,{translated:!0,size:14,color:"error",children:[(0,Z.tZ)("strong",{children:"Warning:"})," Since your post is scheduled, if you change the post url then any existing links to the old post url will no longer work."]}),d&&(0,Z.BX)(ei.xv,{translated:!0,size:14,color:"error",children:[(0,Z.tZ)("strong",{children:"Error:"})," There was an error saving your post URL, please edit the URL and try again."]}),h&&(0,Z.BX)(et.gq,{gap:12,children:[(0,Z.tZ)(ee.zx,{disabled:l,type:"submit",priority:"primary",children:u("Save")}),(0,Z.tZ)(ee.zx,{disabled:l,priority:"secondary-outline",onClick:g,children:u("Cancel")})]})]})})]})};var li=i(38023);let ln=e=>{var{details:t,disabled:i,helpText:n,label:r,paddingBottom:o,paddingTop:a,value:l,onChange:s}=e,d=(0,ef._)(e,["details","disabled","helpText","label","paddingBottom","paddingTop","value","onChange"]);let c=(0,A.I4)(e=>{s(e.target.value)},[s]);return(0,Z.tZ)(i1.g,{details:t,helpText:n,label:r,paddingBottom:o,paddingTop:a,wrapWithLabel:!0,children:(0,Z.tZ)(li.g,(0,_._)((0,f._)({},d),{disabled:i,value:l,onChange:c}))})};function lr(){let e=(0,G._)(["The recommended length for a SEO title is under 60 characters. Your SEO title is currently "," characters"]);return lr=function(){return e},e}function lo(){let e=(0,G._)(["The recommended length for a SEO description is between 50-160 characters. Your SEO description is currently "," characters"]);return lo=function(){return e},e}let la=e=>{var t,i;let n,r,{pub:o,post:a,searchTitle:l,searchDescription:s,setSearchTitle:d,setSearchDescription:c,saveSearchMetadata:u,saving:p}=e,{iString:h,iTemplate:m}=(0,Q.M1)();if(!a)return(0,Z.tZ)(Z.HY,{});let g=a.search_engine_title!==l||a.search_engine_description!==s;return a.is_published?(n=a.social_title||a.title,r=a.description||(0,eo.getDescription)(a.body,a.subtitle,{post:a,maxStopAfter:o.post_preview_limit})):(n=a.social_title||a.draft_title,r=a.description||(0,eo.getDescription)(a.draft_body,a.draft_subtitle,{post:a,maxStopAfter:o.post_preview_limit})),(0,Z.BX)(et.tu,{as:"form",onSubmit:e=>{e.preventDefault(),u({searchTitle:l,searchDescription:s})},children:[(0,Z.tZ)(ij.n,{label:h("SEO title"),helpText:h("This corresponds to the title tag on the post. This will not alter how your post appears on Substack or in emails."),details:m(lr(),(null===(t=null!=l?l:n)||void 0===t?void 0:t.length)||0),disabled:p,paddingBottom:16,value:null!=l?l:n,onChange:d}),(0,Z.tZ)(ln,{label:h("SEO description"),helpText:h("This corresponds to the meta description on the post. This will not alter how your post appears on Substack or in emails."),details:m(lo(),(null===(i=null!=s?s:r)||void 0===i?void 0:i.length)||0),disabled:p,paddingBottom:16,value:null!=s?s:r,onChange:c}),(0,Z.tZ)(ik.H,{expanded:g,children:(0,Z.BX)(et.gq,{gap:12,paddingBottom:16,children:[(0,Z.tZ)(ee.zx,{disabled:p,type:"submit",priority:"primary",children:h("Save")}),(0,Z.tZ)(ee.zx,{disabled:p,priority:"secondary",onClick:()=>{d(a.search_engine_title),c(a.search_engine_description)},children:h("Cancel")})]})})]})},ll=e=>{let{searchMetadataProps:t,postUrlProps:i}=e,[n,r]=(0,A.eJ)(!1);return(0,Z.tZ)(et.tu,{as:"form",paddingBottom:24,children:(0,Z.BX)(et.tu,{border:"detail",radius:"sm",children:[(0,Z.tZ)(n_.J,{onClick:()=>{r(!n)},children:(0,Z.BX)(et.gq,{padding:16,justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",as:"div",children:"SEO Options"}),(0,Z.tZ)(ae,{isCollapsed:!n})]})}),(0,Z.tZ)(ik.H,{expanded:n,children:(0,Z.BX)(et.tu,{alignItems:"stretch",paddingBottom:{desktop:24,mobile:16},paddingX:16,children:[(0,Z.tZ)(la,(0,f._)({},t)),(0,Z.tZ)(lt,(0,f._)({},i))]})})]})})};var ls=i(14518);let ld={modalBackground:"modalBackground-watvUB",modalContent:"modalContent-zb5zzO",modalHeader:"modalHeader-jzsQe5",sectionSelector:"sectionSelector-Qs3Zk0"};function lc(){let e=(0,G._)(["Sent to ","!"]);return lc=function(){return e},e}let lu=e=>{let{modalRef:t,post:i,pub:n,publicationSettings:r,user:o,postType:a,onChangeAudience:l,canSendFreePreview:s,shouldSendFreePreview:d,sendFreePreviewToggle:c,setTeaserPostEligible:u,teaserPostEligibleToggle:p,showTeaserPostSettings:h,cannotSendToSubscribers:m,showSectionSelector:g,socialMetadataProps:v,searchMetadataProps:b,postUrlProps:y,isPublished:f,canSendToOnlyFree:_,canSendToOnlyFounding:w,canOnlySendToEveryone:C,audienceToggle:x,audienceBeforeArchived:S,exemptFromArchivePaywall:k,onRemoveArchivePaywall:B,setSection:T,section_id:I,section_chosen:N,commentLevel:P,onChangeCommentLevel:E,commentSort:X,setCommentSort:M,unpublishPost:D,saveWith:R,saving:F,resetSecretLink:L,showGuestBios:z,setShowGuestBios:O,deletePost:U,resetAudienceCommentAndSectionSettings:H,showNotesProps:J,syndicateVoiceoverProps:V,podcastEpisodeMetadataProps:q,isEditor2:W=!1,isMetered:G,onChangeIsMetered:K}=e,$=(0,A.sO)(null),{iString:en,iTemplate:er}=(0,Q.M1)(),eo=i&&i.postBylines&&i.postBylines.some(e=>e.is_guest),ea=null==V?void 0:V.canSyndicate,el=ea&&(null==V?void 0:V.shouldSyndicate),es="podcast"===a||el,ed="podcast"===a||el,ec=en("adhoc_email"===a?"Email settings":"Post settings"),eu=en("adhoc_email"===a?"This email belongs in..":"This post belongs in..."),ep=(0,Z.tZ)(ei.xv,{as:"span",children:en("This will send two test emails: one with the version your free subscribers will receive and another with the version for paid subscribers.")}),eh=(0,Z.BX)(ei.xv,{as:"span",children:[en("Anyone can view your draft using this link, even if it is not published. "),(0,Z.tZ)(ei.hh,{href:"javascript:void(0)",onClick:L,decoration:"underline",children:en("Reset link")})]});return(0,Z.tZ)(lp,{isOpen:void 0,setIsOpen:void 0,modalRef:t,modalTitle:ec,isEditor2:W,children:(0,Z.BX)(tU.w,{children:["adhoc_email"!==a&&x&&i&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ah,{pub:n,publicationSettings:r,postType:a,audienceToggle:x,onChangeAudience:l,audienceBeforeArchived:S,onRemoveArchivePaywall:B,cannotSendToSubscribers:m,canSendToOnlyFree:_,canSendToOnlyFounding:w,canOnlySendToEveryone:C,isMetered:G,onChangeIsMetered:K}),P&&(0,Z.tZ)(oX,{pub:n,post:i,postType:a,audienceToggle:x,commentLevel:P,onChangeCommentLevel:E,commentSort:X,setCommentSort:M}),h&&(0,Z.tZ)(aZ,{post:i,postType:a,setTeaserPostEligible:u,audienceToggle:x,teaserPostEligibleToggle:p,sendFreePreviewToggle:c,publicationSettings:r}),g&&(0,Z.BX)(i1.g,{label:eu,paddingBottom:24,children:[(0,Z.tZ)(aw.ZP,{className:ld.sectionSelector,pubName:n.name,pubHasPodcast:n.podcast_enabled,sections:n.sections,showRoot:!0,onChange:T,currentValue:N?I:-1,wysiwyg:!1}),g&&i&&i.is_published&&i.draft_section_id!==i.section_id&&(0,Z.BX)(ei.xv,{as:"div",translated:!0,className:"notice",children:[(0,Z.tZ)("strong",{children:"Note:"})," The section is saved but not published. You need to update the post for the change to go live."]})]}),(0,Z.tZ)(ik.H,{expanded:i&&(i.audience!==x||i.audience_before_archived!==S||i.write_comment_permissions!==P||i.default_comment_sort!==X||i.draft_section_id!==I||i.section_chosen!==N||i.teaser_post_eligible!==p),children:(0,Z.BX)(et.gq,{gap:8,paddingBottom:24,children:[(0,Z.tZ)(ee.zx,{disabled:F,onClick:()=>R({audience:x,commentLevel:P,commentSort:X,audienceBeforeArchived:S,exemptFromArchivePaywall:k,teaserPostEligible:p}),children:en("Save")}),(0,Z.tZ)(ee.zx,{disabled:F,priority:"secondary",onClick:H,children:en("Cancel")})]})})]}),i&&(0,Z.tZ)(ob,{pub:n,post:i}),i&&x&&(0,Z.tZ)(oz,{post:i,postType:a,audienceToggle:x}),"page"!==a&&[(0,Z.tZ)(tP.ZP,{className:"unstyled",action:"/api/v1/drafts/".concat(null==i?void 0:i.id,"/email"),analyticsName:"Test Draft Email",onSuccess:()=>{var e;return alert(er(lc(),null===(e=$.current)||void 0===e?void 0:e.value))},onError:e=>alert((0,Y.zx)(e,"Failed to send test email")),autoLock:!0,children:(0,Z.tZ)(i1.g,{paddingBottom:24,wrapWithLabel:!0,children:(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{children:en(d?"Send test emails":"Send test email")}),(0,Z.tZ)(ls.H,{ref:$,type:"email",name:"email",placeholder:en("Email address..."),defaultValue:null==o?void 0:o.email,button:(0,Z.tZ)(ee.zx,{type:"submit",children:en("Send")})}),(0,Z.tZ)("input",{type:"hidden",name:"send_free_preview",value:s&&c?"true":"false"}),(d||"everyone"===x)&&(0,Z.tZ)(tM.p6,{children:ep})]})})})],"adhoc_email"!==a&&(null==i?void 0:i.uuid)&&(0,Z.tZ)(i1.g,{paddingBottom:24,children:(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{children:en("Secret draft link")}),(0,Z.tZ)(ls.H,{type:"text",value:(0,j.uRy)(n,i,{uuid:!0}),readOnly:!0,onClick:e=>{(0,Y.QM)(e.target),(0,Y.UG)(e.target)},button:(0,Z.tZ)(ee.zx,{onClick:()=>(0,Y.vQ)((0,j.uRy)(n,i,{uuid:!0})),children:en("Copy link")})}),(0,Z.tZ)(tM.p6,{children:eh})]})}),eo&&(0,Z.BX)(i1.g,{label:en("Guest posts"),paddingBottom:24,children:[(0,Z.tZ)(iw.j,{value:z,label:en("Display guest writer biographies at the bottom of this post"),onChange:e=>O(e)}),(0,Z.tZ)(ik.H,{expanded:i&&i.show_guest_bios!==z,children:(0,Z.BX)(et.gq,{gap:4,paddingTop:16,alignItems:"end",flex:"grow",children:[(0,Z.tZ)(ee.zx,{disabled:F,onClick:()=>R({showGuestBios:z}),children:en("Save")}),(0,Z.tZ)(ee.zx,{disabled:F,onClick:()=>O(i.show_guest_bios),children:en("Cancel")})]})})]}),ea&&(0,Z.tZ)(a_,{saving:F,onSave:e=>V.setSyndicateInfo(e),pub:V.pub,post:V.post,showNotesProps:V.showNotesProps,canSyndicate:V.canSyndicate,shouldSyndicate:V.shouldSyndicate,setSyndicateInfo:V.setSyndicateInfo,selectedSectionId:V.selectedSectionId,syndicateToSectionId:V.syndicateToSectionId,shouldSyndicateToOtherFeed:V.shouldSyndicateToOtherFeed}),es&&!ea&&(0,Z.tZ)(al,{pub:J.pub,post:J.post,selectedSectionId:J.selectedSectionId,postBody:J.postBody,isVoiceover:J.isVoiceover,hasPodcastPreview:J.hasPodcastPreview,podcastDescription:J.podcastDescription,onHideFromFeedChange:J.onHideFromFeedChange,savePodcastDescription:J.savePodcastDescription}),"adhoc_email"!==a&&(0,Z.tZ)(aB,{pub:v.pub,post:v.post,postType:v.postType,saving:v.saving,socialImage:v.socialImage,socialTitle:v.socialTitle,audienceToggle:v.audienceToggle,socialDescription:v.socialDescription,saveSocialMetadata:v.saveSocialMetadata,onChangeSocialImage:v.onChangeSocialImage,onChangeSocialTitle:v.onChangeSocialTitle,resetSocialMetadata:v.resetSocialMetadata,onChangeSocialDescription:v.onChangeSocialDescription,useDraft:v.useDraft,showSave:!0}),i&&"adhoc_email"!==a&&(0,Z.tZ)(ll,{searchMetadataProps:b,postUrlProps:y}),ed&&(0,Z.tZ)(aa,{metadata:q.metadata,setMetadata:q.setMetadata,saving:F,onSave:e=>{R(e)}}),f&&"page"!==a&&(null==i?void 0:i.post_date)&&(0,Z.tZ)(i1.g,{label:en("Displayed publication date"),paddingBottom:24,children:(0,Z.tZ)(aT.Tz,{value:new Date(i.post_date),min:new Date(1900,0,1),max:new Date,onChange:e=>{e.currentTarget.value&&R({publishDate:new Date(e.currentTarget.value)})}})}),(0,Z.tZ)(i1.g,{label:en("Danger zone"),paddingBottom:24,children:(0,Z.BX)(et.gq,{gap:8,children:[f&&(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:D,children:en("Unpublish")}),(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:()=>U(),children:en("adhoc_email"===a?"Delete Email":"Delete Post")})]})})]})})},lp=e=>{let{children:t,isOpen:i,modalRef:n,modalTitle:r,setIsOpen:o,isEditor2:a}=e;return a?(0,Z.tZ)(eK.u_,{position:"full",isOpen:i,children:(0,Z.BX)(ts.xu,{className:ld.modalBackground,children:[(0,Z.BX)(ts.xu,{padding:12,borderBottom:"detail",className:ld.modalHeader,children:[(0,Z.tZ)(ee.hU,{onClick:()=>{o(!1)},children:(0,Z.tZ)(K.Z,{})}),(0,Z.tZ)(ei.xv.H2,{font:"pub-headings",children:r})]}),(0,Z.tZ)(ts.xu,{padding:12,paddingTop:24,className:ld.modalContent,children:t})]})}):(0,Z.tZ)(L.Z,{ref:n,testID:"settings-modal",variant:"structured",className:"force-light-theme",modalTitle:r,children:t})};var lh=i(66067),lm=i(21680);let lg=e=>{var t,i,n;let{onProcessingStarted:r,onProcessingEnded:o,postId:a}=e,l=(0,A.sO)(null),[s,d]=(0,A.eJ)(null),[c,u]=(0,A.eJ)(!1),[p,h]=(0,A.eJ)(!1),{result:m,error:g,isLoading:v}=(0,iS.ib)({pathname:"/api/v1/audio/tts/elevenlabs/voices",auto:!0}),{isLoading:b,error:y,refetch:f}=(0,iS.ib)({pathname:"/api/v1/audio/tts/elevenlabs/initiate?post_id=".concat(a,"&voice_id=").concat(s||(null==m?void 0:null===(t=m[0])||void 0===t?void 0:t.voice_id)),method:"POST",auto:!1}),{isLoading:_,result:w,refetch:C}=(0,iS.ib)({pathname:"/api/v1/audio/tts/elevenlabs/status?post_id=".concat(a,"&voice_id=").concat(s||(null==m?void 0:null===(i=m[0])||void 0===i?void 0:i.voice_id)),method:"GET",auto:!1});(0,A.d4)(()=>(c?l.current=setInterval(()=>{C()},3e3):l.current&&clearInterval(l.current),()=>{l.current&&clearInterval(l.current)}),[c]),(0,A.d4)(()=>{var e;if(!_&&w){if(w.media_upload){o({mediaUpload:w.media_upload}),u(!1);return}if((null===(e=w.synthesis)||void 0===e?void 0:e.status)==="failed"){u(!1),o({mediaUpload:w.media_upload}),h(!0);return}}},[_]);let x=!v&&m&&m.length>0;return p?(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(ei.xv.B2,{weight:"semibold",translated:!0,children:"Text to Speech"}),(0,Z.tZ)(ei.xv.B4,{children:"The voiceover could not be synthesized at this time."})]}):g?(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(ei.xv.B2,{weight:"semibold",translated:!0,children:"Text to Speech"}),(0,Z.tZ)(ei.xv.B4,{children:"Voices could not be fetched from ElevenLabs. Please check your API Key and try agian."})]}):(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(ei.xv.B2,{weight:"semibold",translated:!0,children:"Text to Speech"}),(0,Z.BX)(et.tu,{children:[x&&!c&&!b&&(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(oY.i,{value:s||(null===(n=m[0])||void 0===n?void 0:n.voice_id),onChange:e=>{d(e.target.value)},children:m.map(e=>(0,Z.tZ)("option",{value:e.voice_id,children:e.voice_display_name}))}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{f(),u(!0),r()},children:"Create voiceover"}),y&&(0,Z.tZ)(ei.xv,{color:"error",children:"Something went wrong."})]}),v&&(0,Z.tZ)(ei.xv.B4,{children:"Loading voices from Elevenlabs."}),!v&&!x&&(0,Z.tZ)(ei.xv.B4,{children:"There are no custom voices on this Elevenlabs account."}),(b||c)&&(0,Z.tZ)(lm.O,{onCancel:()=>{u(!1),o({mediaUpload:null})}})]})]})},lv=e=>{let{uploading:t,recording:i}=e;return t?"Uploading in progress":i?"Recording in progress":null},lb=e=>{let{open:t,pub:i,postId:n,onVoiceoverUploadChanged:r,onClose:o,setPostId:a,initialMediaUpload:l}=e,[s,d]=(0,A.eJ)(l),[c,u]=(0,A.eJ)(!1),[p,h]=(0,A.eJ)(!1),[m,g]=(0,A.eJ)(!1),{getConfigFor:v}=(0,io.xR)();(0,A.d4)(()=>{d(l)},[l,t]);let b=lv({uploading:p,recording:c}),{iString:y,language:f}=(0,Q.M1)();return(0,Z.BX)(r9.n,{wrapperId:"voiceover",title:y(is.MR.Voiceover),isOpen:t,primaryButton:(0,Z.tZ)(tW.u,{disabled:!b,text:b,children:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:()=>{(0,U.j)(U.FP.AUDIO_DRAWER_DONE_CLICKED,{type:"voiceover"}),o()},disabled:!!b,children:y("Done")})}),children:[(0,Z.tZ)(ei.xv.B4,{paddingBottom:24,children:y(is.PN.Voiceover)}),(0,Z.BX)(et.tu,{border:"detail",padding:16,radius:"md",gap:16,children:[!m&&(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(ei.xv.B2,{weight:"semibold",translated:!0,children:"Create audio"}),(0,Z.tZ)(iH.Z,{initialFile:null,feature:is.MR.Voiceover,mediaType:"audio",pub:i,postId:n,setPostId:a,language:f,onChange:e=>{let{mediaUpload:t}=e;h(!1),d(t),r(t)},onRecorderStarted:()=>{u(!0)},onRecorderStopped:()=>{u(!1)},onUploadStarted:()=>{h(!0)},onUploadCanceled:()=>{h(!1)},mediaUpload:s,mediaUploadId:null==s?void 0:s.id})]}),!s&&!p&&n&&!c&&v("enable_elevenlabs_voiceovers")&&(0,Z.tZ)(lg,{postId:n,onProcessingStarted:()=>{g(!0)},onProcessingEnded:e=>{let{mediaUpload:t}=e;g(!1),t&&(d(t),r(t))}})]})]})},ly=e=>{let{showConfirm:t,onConfirm:i,onDismiss:n,className:r}=e,{iString:o}=(0,Q.M1)();return(0,Z.tZ)(tH.h,{children:(0,Z.BX)(et.tu,{className:r,radius:"md",border:"detail",padding:16,gap:12,children:[(0,Z.tZ)(ei.xv.H4,{translated:!0,color:"primary",children:"Help your friends start a Substack"}),(0,Z.tZ)(ei.xv.B4,{translated:!0,color:"primary",children:"Know someone who would be great on Substack? Insert your referral button to get credit for bringing them onboard and expand your network for recommendations, cross posts, and more."}),(0,Z.BX)(et.hs,{gap:12,paddingTop:8,children:[(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary",onClick:async()=>{await N().put("/api/v1/publication_settings").send({seen_writer_referral_explainer:!0}),n()},children:o("Not now")}),t&&(0,Z.tZ)(ee.zx,{size:"sm",priority:"primary",onClick:async()=>{await N().put("/api/v1/publication_settings").send({seen_writer_referral_explainer:!0}),i()},children:o("Add referral button")})]})]})})},lf=Intl.Segmenter;function l_(){let e=(0,G._)(["About "," minutes"]);return l_=function(){return e},e}lf&&(n=new lf(void 0,{granularity:"grapheme"}),r=new lf(void 0,{granularity:"word"}));let lZ=e=>{let{text:t=()=>""}=e,{iString:i,iTemplate:o}=(0,Q.M1)(),a=(0,A.sO)(null),[l,s]=(0,A.eJ)({charCount:0,wordCount:0,sentenceCount:0,readTime:0,speakTime:0}),d=()=>{s(function(e){let{readWpm:t=er.READ_WORDS_PER_MINUTE,speakWpm:i=er.SPEAK_WORDS_PER_MINUTE}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=0,a=0;if(n&&r){for(let t of n.segment(e))o+=1;for(let t of r.segment(e))t.isWordLike&&(a+=1)}else o=e.replace(/(\r\n|\n|\r)/gm,"").length,a=(e.match(RegExp("(?<=[\\s,.:;\"']|^)\\S+(?=[\\s,.:;\"']|$)","g"))||[]).length;let l=e.split(RegExp("(?<=[^\\s.ã€‚]+)[.ã€‚?!\\n\\r](?:[\\s,.:;\"'ã€‚]|$)*","g")).filter(e=>e.trim()).length||+(a>0),s=Math.ceil(a/t),d=Math.ceil(a/i);return{charCount:o,wordCount:a,sentenceCount:l,readTime:s,speakTime:d}}(t()))},c=(0,iS.Kt)(()=>{d()},200,[]);(0,A.d4)(()=>{var e;(null===(e=a.current)||void 0===e?void 0:e.isOpen())&&c()},[t]);let u=()=>{var e;d(),null===(e=a.current)||void 0===e||e.open(),(0,U.j)(U.FP.POST_INFO_VIEWED)},p=e=>e<=1?i("Less than a minute"):o(l_(),e);return(0,Z.BX)("div",{className:"post-info",children:[(0,Z.tZ)(eY.Fx,{ref:a,noList:!0,className:"explanation",children:(0,Z.BX)("div",{className:"post-info-content","data-testid":"post-info-btn",children:[(0,Z.tZ)("h3",{children:i("Post info")}),(0,Z.BX)("div",{children:[(0,Z.tZ)("span",{children:i("Characters")})," ",(0,Z.tZ)("span",{children:(0,er.numberToString)(l.charCount)})]}),(0,Z.BX)("div",{children:[(0,Z.tZ)("span",{children:i("Words")})," ",(0,Z.tZ)("span",{children:(0,er.numberToString)(l.wordCount)})]}),(0,Z.BX)("div",{children:[(0,Z.tZ)("span",{children:i("Sentences")})," ",(0,Z.tZ)("span",{children:(0,er.numberToString)(l.sentenceCount)})]}),(0,Z.tZ)("div",{className:"border"}),(0,Z.BX)("div",{children:[(0,Z.tZ)("span",{children:i("Reading time")})," ",(0,Z.tZ)("span",{children:p(l.readTime)})]}),(0,Z.BX)("div",{children:[(0,Z.tZ)("span",{children:i("Speaking time")}),(0,Z.tZ)("span",{children:p(l.speakTime)})]})]})}),(0,Z.tZ)(ee.hU,{onClick:u,onMouseEnter:u,onMouseLeave:()=>{var e;null===(e=a.current)||void 0===e||e.close()},"data-testid":"post-info-btn",priority:"secondary",children:(0,Z.tZ)(eR.Z,{size:20})})]})},lw=e=>{var t,i;let{isOpen:n,onClose:r,onSave:o}=e,{iString:a}=(0,Q.M1)(),{postMediaComposition:l,setUpdatingActivePostMediaComposition:s}=(0,il.z)(),[d,c]=(0,A.eJ)(null!==(t=null==l?void 0:l.aspect_ratio)&&void 0!==t?t:"landscape"),[u,p]=(0,A.eJ)((null==l?void 0:l.layout)==="speaker_focus"),[h,m]=(0,A.eJ)(null!==(i=null==l?void 0:l.enable_ai_trimming)&&void 0!==i&&i),[g,v]=(0,A.eJ)((null==l?void 0:l.audio_enhancement_mode)==="noise_reduction"),[b,y]=(0,A.eJ)(!!(null==l?void 0:l.intro_media_upload_id)),[f,_]=(0,A.eJ)(!1);(0,A.d4)(()=>{n&&(0,U.j)(U.FP.LIVE_STREAM_PODCAST_SETTINGS_MODAL_SEEN,{post_media_composition_id:null==l?void 0:l.id,post_id:null==l?void 0:l.post_id,live_stream_id:null==l?void 0:l.live_stream_id})},[n]);let w=d!==(null==l?void 0:l.aspect_ratio)||u!==((null==l?void 0:l.layout)==="speaker_focus")||h!==(null==l?void 0:l.enable_ai_trimming)||g!==((null==l?void 0:l.audio_enhancement_mode)==="noise_reduction")||!!(null==l?void 0:l.intro_media_upload_id)!==b;(0,A.d4)(()=>{if(n&&l){var e,t;c(null!==(e=l.aspect_ratio)&&void 0!==e?e:"landscape"),p("speaker_focus"===l.layout),m(null!==(t=l.enable_ai_trimming)&&void 0!==t&&t),v("noise_reduction"===l.audio_enhancement_mode),y(!!l.intro_media_upload_id)}},[n,l]);let C=async()=>{if((null==l?void 0:l.live_stream_id)&&(null==l?void 0:l.post_id))try{_(!0),s(!0);let e=await N().put("/api/v1/live_stream/".concat(l.live_stream_id,"/reprocess_draft/").concat(l.post_id)).send({use_audio_enhancer:g,use_ai_trimming:h,aspect_ratio:d,layout:u?"speaker_focus":"grid",version:6,force_update:!0});(0,U.j)(U.FP.LIVE_STREAM_PODCAST_SETTINGS_CHANGE_REQUESTED,{post_media_composition_id:null==l?void 0:l.id,post_id:null==l?void 0:l.post_id,live_stream_id:null==l?void 0:l.live_stream_id});let t=e.body;t.media_upload?null==o||o({mediaUpload:t.media_upload}):t.workflow_id&&(null==o||o({mediaUpload:null})),r()}catch(e){console.error("Failed to save video settings:",e)}finally{_(!1),s(!1)}};return(0,Z.BX)(eK.u_,{isOpen:n,onClose:r,width:480,children:[(0,Z.tZ)(eK.xB,{title:a("Edit video"),onClose:r}),(0,Z.BX)(eK.fe,{children:[(0,Z.BX)(et.tu,{direction:"column",gap:24,padding:24,border:"detail",radius:"md",style:{marginBottom:16},children:[(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(ei.xv.B3,{children:a("Aspect ratio")}),(0,Z.tZ)(iT.m,{value:d,onChange:e=>c(e),options:[{value:"landscape",label:"Landscape"},{value:"portrait",label:"Portrait"}]})]}),(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.B3,{children:a("Automatically trim video")}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:a("Remove dead space from the beginning of the video")})]}),(0,Z.tZ)(i2.rs,{checked:h,onChange:e=>m(e)})]}),(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.B3,{children:a("Enhance audio")}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:a("Noise reduction and clarity for a balanced sound")})]}),(0,Z.tZ)(i2.rs,{checked:g,onChange:e=>v(e)})]}),(0,Z.tZ)(ei.xv.B4,{color:"error",children:a("Applying changes can take up to 30 minutes.")})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{onClick:C,loading:f,disabled:!w,children:a("Apply changes")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:r,disabled:f,children:a("Cancel")})})]})]})},lC=e=>{let{post:t}=e,{iString:i}=(0,Q.M1)(),{popToast:n}=(0,iN.pm)(),[r,o]=(0,A.eJ)(null),{result:a}=(0,iS.ib)({pathname:"/api/v1/post/".concat(t.id,"/theme"),method:"GET",auto:!0}),{refetch:l,result:s,error:d}=(0,iS.ib)({pathname:"/api/v1/post/".concat(t.id,"/theme"),method:"PATCH"}),c=e=>{l({json:{header_variant:e}})};(0,A.d4)(()=>{(null==a?void 0:a.theme)&&o(null==a?void 0:a.theme)},[a]),(0,A.d4)(()=>{d?n(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:i("There was an error when trying to update the header theme")}))):(null==s?void 0:s.theme)&&(o(null==s?void 0:s.theme),n(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:i("The header theme has been updated")}))))},[s,d]);let u={"portrait-image":{label:"Portrait image header"},"landscape-image":{label:"Landscape image header"},"full-width-image":{label:"Full width image header"},title_and_image_only:{label:"Event header"}};return(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary",trailing:(0,Z.tZ)(tw.Z,{}),children:(null==r?void 0:r.header_variant)?u[null==r?void 0:r.header_variant].label:i("Choose header theme")}),layerOptions:{placement:"bottom-start"},children:Object.keys(u).map(e=>(0,Z.tZ)(tC.sN,{onClick:()=>c(e),children:u[e].label},e))})};var lx=i(53678),lS=i(7436),lk=i.n(lS),lB=i(62195),lT=i.n(lB),lI=i(39627),lN=i.n(lI),lP=i(8728),lE=i.n(lP);let lX=lT().createStore([lN(),lE()],[]),lM=".buffer",lA="ss-version-backups-local",lD=e=>{var t,i,n,r;return(null===(i=window._preloads)||void 0===i?void 0:null===(t=i.pub)||void 0===t?void 0:t.id)&&(null===(r=window._preloads)||void 0===r?void 0:null===(n=r.user)||void 0===n?void 0:n.id)?lF().filter(t=>{var i,n,r,o;return!(!(null===(n=window._preloads)||void 0===n?void 0:null===(i=n.pub)||void 0===i?void 0:i.id)||!(null===(o=window._preloads)||void 0===o?void 0:null===(r=o.user)||void 0===r?void 0:r.id)||t.publication_id!==window._preloads.pub.id||t.user_id&&t.user_id!==window._preloads.user.id||t.post_id!==e||t.local_version_saved_at&&Date.now()-new Date(t.local_version_saved_at).getTime()>6048e5)}):[]},lR=e=>{if(!(null==e?void 0:e.post_id)||!(null==e?void 0:e.draft_updated_at)||!(null==e?void 0:e.draft_body))return;let t=lF();if(t.filter(t=>t.post_id===e.post_id).length>=4){let i=lk()(t,t=>t.post_id===e.post_id);i>=0&&t.splice(i,1)}lV(lA,[e].concat(t.filter(t=>t.post_id!==e.post_id||t.draft_updated_at!==e.draft_updated_at&&t.draft_body&&t.draft_body!==e.draft_body)).slice(0,32))},lF=()=>lX.get(lA,[]).filter(Boolean),lL=()=>lX.get(lA+lM,{}),lz=e=>{var t,i;(null===(t=window._preloads.pub)||void 0===t?void 0:t.id)&&(null===(i=window._preloads.user)||void 0===i?void 0:i.id)&&(null==e?void 0:e.post_id)&&(null==e?void 0:e.draft_updated_at)&&(null==e?void 0:e.draft_body)&&lV(lA+lM,(0,_._)((0,f._)({},e),{publication_id:window._preloads.pub.id,user_id:window._preloads.user.id,local_version_saved_at:new Date}))},lO=()=>{lX.remove(lA+lM)},lU=e=>{(null==e?void 0:e.post_id)&&(null==e?void 0:e.draft_updated_at)&&lV(lA,lF().filter(t=>t.post_id!==e.post_id||t.draft_updated_at!==e.draft_updated_at))},lY=e=>{let{postId:t,editorId:i}=e;return!!lF().find(e=>e.post_id===t&&e.editor_id&&e.editor_id!==i)},lH=e=>{let{postId:t,editorId:i}=e;lV(lA,lF().filter(e=>!!e.editor_id&&(e.post_id!==t||e.editor_id!==i)))},lj=()=>{let e=lL();(null==e?void 0:e.draft_body)&&(lR(e),lO())},lJ=()=>{lO(),lX.remove(lA)},lV=(e,t)=>{try{if(lX.set(e,t),JSON.stringify(lX.get(e))!==JSON.stringify(t))throw Error("localStorage.setItem claimed to work but then getItem didnt return the expected value for key=".concat(e))}catch(e){console.error("localStorage.setItem failed:",e),lJ()}};var lq=i(84753),lW=i.n(lq),lG=i(19834);let lK=e=>{var t;let{publication:i,innerHTML:n}=e,r=[i.public_post_free_signup_preamble_html,i.public_post_subscriber_preamble_html,i.subscriber_post_subscriber_preamble_html,(null===(t=i.email_render_elements)||void 0===t?void 0:t.email_preamble_for_free_writer_html)||i.email_preamble_for_free_writer_html||""],o=lW()(r,"length"),a=["email_postscript_for_free_writer_html","public_post_free_signup_postscript_html","public_post_subscriber_postscript_html","subscriber_post_subscriber_postscript_html"].map(e=>{var t;return(null===(t=i.email_render_elements)||void 0===t?void 0:t[e])||i[e]||""}),l=o+n+lW()(a,"length");l=l.replace(/href="([^"]+)"/g,'href="'.concat(Array(426).join("a"),'"'));let s=(l=(0,lG.Z)(l,{only_non_ascii:!0})).length;return s+(l.split("image-link").length-1)*488};var lQ=i(86551),l$=i(57208),l0=i(68303);let l1={scheduleErrorIcon:"scheduleErrorIcon-yVsqXQ"};function l2(){let e=(0,G._)(["Editing "," - Substack"]);return l2=function(){return e},e}function l4(){let e=(0,G._)(["Scheduled for ",""]);return l4=function(){return e},e}let l3="https://support.substack.com/hc/en-us/articles/360038866571-Why-does-it-say-Email-too-long-in-the-post-editor-",l8=e=>{let{postBylines:t,draftBylines:i}=e;if(i){if(t.length!==i.length)return!0;let e=i.map(e=>eI()(e,["user_id","is_guest"])),n=t.map(e=>eI()(e,["user_id","is_guest"]));if(!eC()(e,n))return!0}let[n,r]=eB()(t,e=>e.is_draft),o=n.map(e=>eI()(e,["user_id","is_guest"])),a=r.map(e=>eI()(e,["user_id","is_guest"]));return!eC()(o,a)},l6=(e,t,i,n)=>{let{iString:r}=I18N.i(n);return se((0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eN.Z,{stroke:"white"}),(0,Z.BX)("section",{children:[(0,Z.tZ)("span",{children:r(t?"Your offline changes were synced, but there may be conflicts.":"Your changes were synced, but there may be conflicts.")}),(0,Z.tZ)("a",{href:e,children:r("Review changes")})]})]}),1,{dismissable:!0,className:"conflict-toast",beforeDismiss:()=>(0,U.j)(U.FP.CONFLICT_TOAST_DISMISSED,{editor_id:i})})},l5=()=>se((0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eP.Z,{}),(0,Z.tZ)(ei.xv,{translated:!0,as:"section",children:"You've gone offline."})]})),l9=()=>se((0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eE.Z,{stroke:"var(--color-utility-white)"}),(0,Z.tZ)(ei.xv,{as:"section",translated:!0,children:"Your offline changes were synced."})]})),l7=e=>{se((0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eN.Z,{stroke:"var(--color-utility-white)"}),(0,Z.tZ)("section",{children:e})]}))},se=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,{dismissable:i,className:n,beforeDismiss:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{dismissable:!1,className:"",beforeDismiss:null},o=document.getElementsByClassName("post typography container")[0];if(!o){setTimeout(()=>{0!==t&&se(e,t--)},2e3);return}(0,O.ZP)(e,{timeout:5e3,dismissable:i,beforeDismiss:r,className:n},o)};class st extends tq.ZP{async componentDidMount(){let{iString:e}=this.getI18NProps(),t=(0,iP.x)("podcastSettings");if(super.componentDidMount().then(()=>{}),(0,Y.ut)(this._onVisibilityChange),this.loadVerifyState(),this.props.showPublishModal&&((0,Y.iO)("showPublishModal"),this.setShowPublishModal(!!this.props.showPublishModal&&!!this.props.post_id&&!this.props.twitter_error)),this.props.twitter_error&&((0,Y.iO)("twitter_error"),l7(e("There was an error while connecting your Twitter account. Please try again."))),"adhoc_email"===this.props.type&&this.setHideSharePostAndComment(!0),t){var i,n;null===(i=(n=this.props).setIsDrawerOpen)||void 0===i||i.call(n,{drawerId:"podcast",isOpen:!0}),(0,Y.iO)("podcastSettings")}window.addEventListener("online",this.onNetworkChange),window.addEventListener("offline",this.onNetworkChange),window.removeEventListener("beforeunload",this.onUnload)}componentDidUpdate(){this.state.showPublishModal&&this.publishModal&&(this.setShowPublishModal(!1),this.openPublishModal())}componentWillUnmount(){super.componentWillUnmount(),(0,Y.kE)(this._onVisibilityChange),window.removeEventListener("online",this.onNetworkChange),window.removeEventListener("offline",this.onNetworkChange)}getPostType(){return(this.state.post?this.state.post.type:this.props.type)||"newsletter"}getI18NProps(){let e=e=>e;return{iString:this.props.iString||e,iTemplate:this.props.iTemplate||e,iPlural:this.props.iPlural||e}}canSendToOnlyFree(){return!["thread","page"].includes(this.getPostType())}shouldRenderTitle(){return!0}shouldRenderSubtitle(){return!["thread","page"].includes(this.getPostType())}shouldRenderPodcast(){return"podcast"===this.getPostType()}shouldRenderVideo(){return"video"===this.getPostType()}shouldRenderVoiceover(){var e;return"newsletter"===this.getPostType()&&!eS()(null===(e=this.state.doc)||void 0===e?void 0:e.voiceover_upload_id)}shouldFillEditorHeight(){return"thread"!==this.getPostType()}async recoverPreviousOfflineContent(){var e;let t,i;let n=this.props.post_id?Number(this.props.post_id):null===(e=this.state.post)||void 0===e?void 0:e.id;if(!n)return;lj();let r=lD(n);if(0===r.length)return;this.setState({saving:!0});let o=[];for(let e of r.reverse()){let{post_id:r,draft_updated_at:a}=e,l=(0,ef._)(e,["post_id","draft_updated_at"]);if(r===n)try{for(let t of(await N().put("/api/v1/drafts/".concat(r)).send((0,f._)({last_updated_at:a},l)),lU(e),o))lU(t);o.splice(0)}catch(n){o.push(e),t=n,i=e,console.error("Unable to sync",n)}}this.setState({saving:!1}),t?this.onSaveError(t,i):l9()}async loadDocument(){var e,t,i,n,r,o,a;let l;if(await this.recoverPreviousOfflineContent(),this.props.post_id){let e=(await N().get("/api/v1/drafts/".concat(this.props.post_id))).body,l=(0,er.getScheduledAt)(e),s=!1;try{let i=JSON.parse(e.draft_body);s=null===(t=i.attrs)||void 0===t?void 0:t.frozen}catch(t){console.warn("failed to parse post.draft_body",e.draft_body)}this.setState({post:e,unpublishedChanges:e.is_published&&(e.draft_title!=e.title||e.draft_subtitle!=e.subtitle||l8(e)||e.draft_podcast_url!=e.podcast_url||e.draft_podcast_duration!=e.podcast_duration||e.draft_video_upload_id!=e.video_upload_id||e.draft_podcast_upload_id!=e.podcast_upload_id||e.draft_podcast_preview_upload_id!=e.podcast_preview_upload_id||e.draft_voiceover_upload_id!=e.voiceover_upload_id||e.draft_body!=e.body||e.draft_section_id!==e.section_id),audienceToggle:e.audience,audienceBeforeArchived:e.audience_before_archived,syndicateToggle:e.syndicate_voiceover_to_rss,syndicateToSectionId:null!==(i=e.syndicate_to_section_id)&&void 0!==i?i:null,shouldSyndicateToOtherFeed:null!==(n=e.should_syndicate_to_other_feed)&&void 0!==n?n:null,commentLevel:e.write_comment_permissions||this.props.pub.default_write_comment_permissions,commentSort:e.default_comment_sort,socialTitle:e.social_title,socialDescription:e.description,socialImage:e.cover_image,searchTitle:e.search_engine_title,searchDescription:e.search_engine_description,dontSendEmail:!!e.email_sent_at||!e.should_send_email,shareAutomatically:e.is_published,section_id:e.draft_section_id,section_chosen:e.section_chosen,showGuestBios:e.show_guest_bios,lastScheduledAt:l,scheduledAt:l,unlockAt:null,episodeNumber:e.podcast_episode_number,seasonNumber:e.podcast_season_number,episodeType:e.podcast_episode_type,hideFromFeed:null!==(r=e.hide_from_feed)&&void 0!==r&&r,isExplicit:e.explicit,isFrozen:s,podcastMediaType:e.draftVideoUpload?"video":"audio",teaserPostEligibleToggle:null===(o=e.teaser_post_eligible)||void 0===o||o,meterType:null!==(a=e.meter_type)&&void 0!==a?a:"none"}),setTimeout(()=>{let e=this.estimateEmailHtmlLength();this.setState({bodyIsAlmostTooLong:!eS()(e)&&e>52700,bodyIsTooLong:!eS()(e)&&e>62e3}),(0,Y.pK)()},0);let d=e.draft_body;return{title:e.draft_title,subtitle:e.draft_subtitle,bylines:e.postBylines.filter(e=>e.is_draft),pending_invites:e.pendingInvites,podcast_url:e.draft_podcast_url,podcast_duration:e.draft_podcast_duration,video_upload_id:e.draft_video_upload_id,videoUpload:e.draftVideoUpload,podcast_upload_id:e.draft_podcast_upload_id,podcastUpload:e.draftPodcastUpload,podcast_preview_upload_id:e.draft_podcast_preview_upload_id,podcastPreviewUpload:e.draftPodcastPreviewUpload,voiceover_upload_id:e.draft_voiceover_upload_id,voiceoverUpload:e.draftVoiceoverUpload,body:d,free_podcast_url:e.free_podcast_url,activePostMediaComposition:e.activePostMediaComposition,meterType:e.meter_type}}if(this.props.coupon)try{l=JSON.parse(this.props.coupon)}catch(e){console.error("Failed to insert coupon:",e)}let s=new URLSearchParams((null===(e=window)||void 0===e?void 0:e.location.search)||""),d=s.get("section"),c=s.get("firstPost"),u="",p="",h="";if(this.props.template){let e=(await N().get("/api/v1/posts/templates/".concat(this.props.template)).query({coupon:this.props.couponId,surveyId:this.props.surveyId})).body;u=e.title,p=e.subtitle,h=e.body}else if(c){let{title:e,subtitle:t,body:i}=it(this.props.pub.name);u=e,p=t,h=i}d&&this.setState({section_chosen:!0,section_id:"pub"===d?null:parseInt(d,10)});let m=this.props.audience||(0,er.defaultAudienceForPub)(this.props.pub,{type:this.getPostType(),coupon:null});if("adhoc_email"===this.getPostType()&&!this.props.subscriber_set_id){let e={query:{subscription_type_in:void 0}};"only_paid"!==m||this.props.surveyId||(e.query.subscription_type_in=["paid","founding"]);let t=await N().post("/api/v1/subscriber_set").send(e);this.setState({subscriber_set_id:t.body.id})}let g=(0,er.defaultCommentLevelForPub)(m,this.props.type,this.props.pub,(0,er.pubHasPaymentsEnabled)(this.props.pub)),v=(0,er.defaultSendEmailForPub)(this.props.pub,this.props.type,m);this.setState({audienceToggle:m,commentLevel:g,commentSort:null,shouldSendEmail:v,dontSendEmail:!v}),l&&setTimeout(()=>{this.insertCoupon(l)},0);let b=this.props.user||{id:this.props.pub.author_id,name:this.props.pub.author_name,photo_url:this.props.pub.author_photo_url,bio:this.props.pub.author_bio};return{title:u,subtitle:p,bylines:[{user_id:b.id,is_guest:!1,is_draft:!0,user:b}],podcast_url:"",podcast_duration:null,video_upload_id:null,podcast_upload_id:null,podcast_preview_upload_id:null,voiceover_upload_id:null,body:h}}async saveDocument(e){var t,i,n,r,o;let a,{audience:l,audienceBeforeArchived:s,exemptFromArchivePaywall:d,commentLevel:c,commentSort:u,episodeNumber:p,episodeType:h,hideFromFeed:m,forceSave:g,isExplicit:v,newDraft:b,podcastDescription:y,postDate:f,seasonNumber:_,shouldSendEmail:Z,shouldSendFreePreview:w,showGuestBios:C,slug:x,socialDescription:S,socialImage:k,socialTitle:B,searchTitle:T,searchDescription:I,syndicateVoiceover:P,syndicateToSectionId:E,shouldSyndicateToOtherFeed:X,teaserPostEligible:M,hasDismissedTkWarning:A,meterType:D}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!g&&!b&&!this.state.post&&!e.title&&!e.subtitle&&!e.podcast_url&&!e.podcast_duration&&!e.video_upload_id&&!e.podcast_upload_id&&!e.podcast_preview_upload_id&&!e.voiceover_upload_id&&!x&&(0,l0.Dc)(e.body)&&!["video","podcast"].includes(this.getPostType()))return l&&this.setState({audienceToggle:l}),B&&this.setState({socialTitle:B}),S&&this.setState({socialDescription:S}),k&&this.setState({socialImage:k}),T&&this.setState({searchTitle:T}),I&&this.setState({searchDescription:I}),c&&this.setState({commentLevel:c}),u&&this.setState({commentSort:u}),void 0!==P&&this.setState({syndicateVoiceover:P}),void 0!==E&&this.setState({syndicateToSectionId:E}),void 0!==X&&this.setState({shouldSyndicateToOtherFeed:X}),this.setState({dontSendEmail:!1===Z}),null;let R={draft_title:null!==(i=e.title)&&void 0!==i?i:void 0,draft_subtitle:null!==(n=e.subtitle)&&void 0!==n?n:void 0,draft_podcast_url:e.podcast_url,draft_podcast_duration:e.podcast_duration,draft_video_upload_id:e.video_upload_id,draft_podcast_upload_id:e.podcast_upload_id,draft_podcast_preview_upload_id:e.podcast_preview_upload_id,draft_voiceover_upload_id:e.voiceover_upload_id,draft_body:e.body,section_chosen:this.state.section_chosen,draft_section_id:this.state.section_id,free_podcast_url:e.free_podcast_url};R.draft_bylines=null===(t=e.bylines)||void 0===t?void 0:t.map(e=>({id:e.user_id,is_guest:e.is_guest}));let F={};this.state.ignoreLastUpdated||b||!this.state.post||(R.last_updated_at=null!==(r=this.state.post.draft_updated_at)&&void 0!==r?r:void 0),!b&&f&&(R.post_date=f),l?R.audience=l:this.state.post||(R.audience=this.state.audienceToggle),void 0!==s&&(R.audience_before_archived=s),void 0!==d&&(R.exempt_from_archive_paywall=d),void 0!==P&&(R.syndicate_voiceover_to_rss=P),void 0!==E&&(R.syndicate_to_section_id=E),void 0!==X&&(R.should_syndicate_to_other_feed=X),void 0!==v&&(R.explicit=v),void 0!==p&&(R.podcast_episode_number=p),void 0!==_&&(R.podcast_season_number=_),void 0!==h&&(R.podcast_episode_type=h),void 0!==m&&(R.hide_from_feed=m),c&&(R.write_comment_permissions=c),(u||null===u)&&(R.default_comment_sort=u),eZ()(Z)&&(R.should_send_email=Z),eZ()(w)&&(R.should_send_free_preview=w),eZ()(M)&&(R.teaser_post_eligible=M),eZ()(C)&&(R.show_guest_bios=C),eZ()(A)&&(R.has_dismissed_tk_warning=A),D&&(R.meter_type=D),B&&(R.social_title=B),S&&(R.description=S),k&&(R.cover_image=k),void 0!==T&&(R.search_engine_title=T),void 0!==I&&(R.search_engine_description=I),void 0!==y&&(R.podcast_description=y),x&&(R.slug=x),(!this.state.post||b)&&(R.type=this.props.type,(this.props.subscriber_set_id||this.state.subscriber_set_id)&&(R.subscriber_set_id=Number(this.props.subscriber_set_id||this.state.subscriber_set_id))),this.props.launchAnnouncement&&(F.launchAnnouncement=!0),this.props.marketingTemplate&&(F.marketingTemplate=this.props.marketingTemplate),a=!b&&this.state.post?N().put("/api/v1/drafts/".concat(this.state.post.id)):N().post("/api/v1/drafts").query(F);let L=(await a.timeout({response:3e4}).retry(1).send(R)).body;lO(),lH({postId:L.id,editorId:this.editorId}),lY({postId:L.id,editorId:this.editorId})&&document.location.reload();let{pathname:z}=window.location;b?(0,Y.uX)((0,j.uRy)(this.props.pub,L,{noBase:!0,edit:!0})):!this.props.post_id&&z&&(z.endsWith("/post")||z.endsWith("/email"))&&window.history.replaceState&&window.history.replaceState({},document.title,"".concat(z,"/").concat(L.id));let O=this.estimateEmailHtmlLength();return await (0,Y.IW)(this,{post:L,unpublishedChanges:L.is_published&&(L.draft_title!=L.title||L.draft_subtitle!=L.subtitle||l8(L)||L.draft_podcast_url!=L.podcast_url||L.draft_podcast_duration!=L.podcast_duration||L.draft_video_upload_id!=L.video_upload_id||L.draft_podcast_upload_id!=L.podcast_upload_id||L.draft_podcast_preview_upload_id!=L.podcast_preview_upload_id||L.draft_voiceover_upload_id!=L.voiceover_upload_id||L.draft_body!=L.body),audienceToggle:l?L.audience:this.state.audienceToggle,socialTitle:L.social_title,socialDescription:L.description,socialImage:L.cover_image,searchTitle:L.search_engine_title,searchDescription:L.search_engine_description,bodyIsAlmostTooLong:!eS()(O)&&O>52700,bodyIsTooLong:!eS()(O)&&O>62e3,commentLevel:L.write_comment_permissions,commentSort:L.default_comment_sort,shouldSendEmail:L.should_send_email,showGuestBios:L.show_guest_bios,ignoreLastUpdated:!1,syndicateToggle:L.syndicate_voiceover_to_rss,episodeNumber:L.podcast_episode_number,seasonNumber:L.podcast_season_number,episodeType:L.podcast_episode_type,hideFromFeed:null!==(o=L.hide_from_feed)&&void 0!==o&&o,isExplicit:L.explicit,meterType:L.meter_type}),L.id||this.props.post_id}getWritablePlugins(){let e=[];return this.tkRemindersEnabled()&&e.push(t5),e}onSaveError(e,t){var i,n,r,o,a;if((null==e?void 0:null===(i=e.response)||void 0===i?void 0:i.status)===409&&((0,U.j)(U.FP.AUTOSAVE_CONFLICT_DISPLAYED,{post_id:(null==t?void 0:t.post_id)||(null===(r=this.state.post)||void 0===r?void 0:r.id),editor_id:this.editorId,last_updated_at:(null==t?void 0:t.draft_updated_at)||(null===(o=this.state.post)||void 0===o?void 0:o.draft_updated_at)}),l6("".concat((0,j.uRy)(this.props.pub,{id:(null==t?void 0:t.post_id)||(null===(a=this.state.post)||void 0===a?void 0:a.id)||this.props.post_id},{edit:!0,noBase:!0}),"/versions"),this.state.isOffline,this.editorId,this.props.pub.language),lO(),t&&lU(t),this.setState({ignoreLastUpdated:!0})),(null==e?void 0:null===(n=e.response)||void 0===n?void 0:n.status)===400){if(e.response.text.includes("locked")){document.location.reload();return}lO()}else lj()}openAudioDnDModal(e){var t,i;"adhoc_email"!==this.getPostType()&&(null===(t=(i=this.props).setIsDrawerOpen)||void 0===t||t.call(i,{drawerId:"audioEmbedDnD",isOpen:!0}),this.setState({droppedAudioFile:e}))}openVideoModal(e){var t,i;"adhoc_email"!==this.getPostType()&&(null===(t=(i=this.props).setIsDrawerOpen)||void 0===t||t.call(i,{drawerId:"videoEmbedDnD",isOpen:!0}),this.setState({droppedVideoFile:e}))}async maybeCreatePost(){var e,t;if(this.state.post)return;let i=(await N().post("/api/v1/drafts").send({type:this.getPostType(),draft_bylines:null===(t=this.state.doc)||void 0===t?void 0:null===(e=t.bylines)||void 0===e?void 0:e.map(e=>({id:e.user_id,is_guest:e.is_guest}))})).body;await new Promise(e=>this.setState({post:i},e))}canCheckIfUpToDate(){return!!this.state.post&&!this.state.saving&&!this.state.savingError&&!this.state.unsaved}canSendEmail(){return"page"!==this.getPostType()&&!(this.state.post&&this.state.post.email_sent_at)}mustSendEmail(){return this.canSendEmail()&&"only_free"===this.state.audienceToggle}shouldSendEmail(){return"adhoc_email"===this.getPostType()||!(this.state.section_chosen&&null===this.state.section_id&&(0,oo.HD)({pub:this.props.pub}))&&this.canSendEmail()&&(this.mustSendEmail()||!this.state.dontSendEmail)}shouldShareAutomatically(){var e;return!!this.state.shareAutomatically&&!(null===(e=this.state.post)||void 0===e?void 0:e.is_published)&&["newsletter","podcast","video","thread"].includes(this.getPostType())}canSetPaywall(){var e;return(!(null===(e=this.state.doc)||void 0===e?void 0:e.free_podcast_url)||this.hasVideoPaywall())&&["newsletter","podcast","video","page"].includes(this.getPostType())&&(0,er.pubHasPaymentsEnabled)(this.props.pub)}canSeeSendFreePreviewOption(){return!!this.state.audienceToggle&&this.shouldSendEmail()&&this.canSetPaywall()&&(0,ty.isPaidAudience)(this.state.audienceToggle)}canSendFreePreview(){return this.canSeeSendFreePreviewOption()&&(this.hasPaywall()||this.hasPodcastPreview())}shouldSendFreePreview(){return this.canSendFreePreview()&&this.state.sendFreePreviewToggle&&!!this.state.audienceToggle&&(0,ty.isPaidAudience)(this.state.audienceToggle)}canSeeTeaserPostSettings(){var e;return!!this.state.audienceToggle&&!!(this.canSetPaywall()&&(0,ty.isPaidAudience)(this.state.audienceToggle)&&(null===(e=this.props.publicationSettings)||void 0===e?void 0:e.paywall_unlock_tokens))}estimateEmailHtmlLength(){return this.editorView&&this.editorView.dom?lK({publication:this.props.publication,innerHTML:this.editorView.dom.innerHTML}):null}getDirtyFiles(){var e;let t=[];return null===(e=this.editorView)||void 0===e||e.state.doc.descendants(e=>{var i;let{attrs:n,type:r}=e;(null==r?void 0:null===(i=r.spec)||void 0===i?void 0:i.isFileEmbed)&&n.dirty&&t.push(n)}),t}async updateFile(e){await fetch("/api/v1/file/".concat(e.fileKey),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),e.dirty=!1}async updateFiles(){let e=this.getDirtyFiles();await Promise.all(e.map(this.updateFile))}getClassName(){return k()("".concat(this.getPostType(),"-post-editor"))}getBackButton(){return"Dashboard"}getTitle(){var e;let{iString:t}=this.getI18NProps();return(0,Z.tZ)(tJ.Z,{ref:this.assignTitleTextarea,id:"post-title","data-testid":"post-title","aria-label":"title",className:"page-title mousetrap",placeholder:this.props.titlePlaceholder||t("Title"),maxLength:200,autoHeight:!0,inline:!0,defaultValue:null===(e=this.state.doc)||void 0===e?void 0:e.title,onInput:()=>this.onEdit(),disabled:this.state.isOffline})}getSubTitle(){var e;let{iString:t}=this.getI18NProps();return(0,Z.tZ)(tJ.Z,{ref:this.assignSubtitleTextarea,className:"subtitle mousetrap",placeholder:this.props.subtitlePlaceholder||t("Add a subtitleâ€¦"),maxLength:200,autoHeight:!0,inline:!0,defaultValue:null===(e=this.state.doc)||void 0===e?void 0:e.subtitle,onInput:()=>this.onEdit(),disabled:this.state.isOffline})}getStatus(){let{iString:e}=this.getI18NProps(),{post:t,passVerify:i}=this.state;if("boolean"==typeof i&&!i)return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv,{as:"div",translated:!0,children:"Weâ€™ve temporarily disabled your publishing ability because of potential problems with your email list."}),(0,Z.BX)(ei.xv,{as:"div",translated:!0,children:["Please contact our Standards & Enforcement team"," ",(0,Z.tZ)("a",{className:"status-info",href:"https://support.substack.com/hc/en-us/requests/new?ticket_form_id=14793522353556&tf_14811460381460=i_own_a_publication_&tf_14818271924756=my_publication_is_publicly_visible__but_i_m_unable_to_publish_new_posts_",target:"_blank",rel:"noopener",children:"here"})," ","for more information."]})]});if(t&&!t.is_published&&this.state.bodyIsTooLong)return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("div",{children:e("Post too long for email")}),(0,Z.tZ)("a",{className:"status-info",href:l3,target:"_blank",rel:"noopener",children:e("Learn more")})]});if(t&&!t.is_published&&this.state.bodyIsAlmostTooLong)return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("div",{children:e("Near email length limit")}),(0,Z.tZ)("a",{className:"status-info",href:l3,target:"_blank",rel:"noopener",children:e("Learn more")})]});if(this.state.savingError)return(0,Z.tZ)("div",{children:(0,Y.zx)(this.state.savingError,e("Network Error"))});if(this.state.isFrozen)return(0,Z.tZ)("div",{children:e("Post is locked, please unlock before making changes.")})}getStatusClass(){var e,t;let{post:i}=this.state;if(this.state.savingError&&"status"in this.state.savingError&&(null===(e=this.state.savingError)||void 0===e?void 0:e.status)!==409)return"error";if((null===(t=this.state.savingError)||void 0===t?void 0:t.errno)==="ETIMEDOUT")return"warn";if(i&&!i.is_published&&(this.state.bodyIsTooLong||this.state.bodyIsAlmostTooLong))return"warn";if("boolean"==typeof this.state.passVerify&&!this.state.passVerify)return"warn";if(this.state.isFrozen)return"warn"}getPlaceholderText(){let{iString:e}=this.getI18NProps();return e("Start writing...")}getVersionHistoryButton(){let{post:e}=this.state,t=!(null==e?void 0:e.draft_updated_at),{iString:i}=this.getI18NProps();return(0,Z.tZ)(tj,{content:i("View draft history"),className:k()("inverse left",{disabled:t}),children:(0,Z.tZ)(ee.hU,{priority:"secondary",disabled:t,href:"".concat(e&&(0,j.uRy)(this.props.pub,e,{edit:!0,noBase:!0}),"/versions"),"aria-label":i("Saving"),children:(0,Z.tZ)(eX.Z,{size:20})})})}renderBottomBar(){let{post:e,isOffline:t,isFrozen:i}=this.state,{iString:n}=this.getI18NProps(),r=async()=>{if(!this.editorView)return;let e=this.editorView.state.tr.step(new t4("frozen",!this.state.isFrozen)),t=this.editorView.state.apply(e);this.editorView.updateState(t),this.setState({isFrozen:!this.state.isFrozen},async()=>{if(this.editorView&&(await this.save(),!this.state.isFrozen)){let e=this.editorView.state.tr.step(new t4("frozen",null)),t=this.editorView.state.apply(e);this.editorView.updateState(t)}})};return(0,Z.tZ)(t1.rf.Consumer,{children:o=>{let{setIsDrawerOpen:a,isDrawerOpen:l}=o;return(0,Z.tZ)(tH.h,{children:(0,Z.BX)(et.hs,{padding:16,justifyContent:"space-between",className:"bottom-bar transparent",pointerEvents:"none",children:[(0,Z.BX)(et.hs,{gap:12,pointerEvents:"auto",children:[this.getVersionHistoryButton(),(0,Z.tZ)(lZ,{text:()=>{var e,t;return(null===(t=this.editorView)||void 0===t?void 0:null===(e=t.dom)||void 0===e?void 0:e.innerText)||""}}),(0,eW.getConfigFor)("allow_document_freeze")&&(0,Z.tZ)(ee.hU,{type:"button",priority:"secondary",onClick:()=>r(),children:this.state.isFrozen?(0,Z.tZ)(eM.Z,{size:20}):(0,Z.tZ)(eA.Z,{size:20})})]}),(0,Z.BX)(ee.zx,{id:"settings",priority:"secondary","data-testid":"settings-button",style:{pointerEvents:"auto"},onClick:()=>{l("podcast")&&a({isOpen:!1,drawerId:"podcast"}),this.openSettingsModal()},disabled:!e||t||i,children:[(0,Z.tZ)(eD.Z,{size:20}),n("Settings")]})]})})}})}hasUnpublishedChanges(){return!!this.state.post&&(this.state.unsaved||this.state.post.draft_title!=this.state.post.title||this.state.post.draft_subtitle!=this.state.post.subtitle||l8(this.state.post)||this.state.post.draft_podcast_url!=this.state.post.podcast_url||this.state.post.draft_podcast_duration!=this.state.post.podcast_duration||this.state.post.draft_video_upload_id!=this.state.post.video_upload_id||this.state.post.draft_podcast_upload_id!=this.state.post.podcast_upload_id||this.state.post.draft_podcast_preview_upload_id!=this.state.post.podcast_preview_upload_id||this.state.post.draft_voiceover_upload_id!=this.state.post.voiceover_upload_id||this.state.post.draft_body!=this.state.post.body||this.state.section_id!==this.state.post.section_id)}renderMetadata(){let e;let{iTemplate:t}=this.getI18NProps(),{post:i}=this.state;return e=i&&i.draft_title?'"'.concat(i.draft_title,'"'):i&&i.title?'"'.concat(i.title,'"'):"adhoc_email"===this.getPostType()?"email":this.getPostType(),(0,Z.tZ)(X.Metadata,{title:t(l2(),e)})}renderHeader(){var e,t,i,n,r,o,a;let{iString:l,iPlural:s}=this.getI18NProps(),d=this.getStatusClass(),{post:c,pendingUploads:u,isOffline:p,saving:h,savingError:m}=this.state,g="error"===d?(0,Z.tZ)(eN.Z,{}):(0,Z.tZ)(eR.Z,{}),v=this.getStatus(),b=null!==(a=null==v?void 0:null===(n=v.props)||void 0===n?void 0:null===(i=n.children)||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:null===(e=t.props)||void 0===e?void 0:e.children)&&void 0!==a?a:"",y=!!(null===(r=this.state.dismissed)||void 0===r?void 0:r[b]),w="warn"===d&&(null==m?void 0:m.errno)==="ETIMEDOUT",C=e=>{"error"!==d&&this.setState({dismissed:(0,_._)((0,f._)({},this.state.dismissed),{[e]:!0})})};return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(tH.h,{children:(0,Z.tZ)(et.gq,{paddingX:16,paddingY:12,top:0,bg:"primary",className:"editorHeader",children:(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",flex:"grow",children:[(0,Z.BX)(et.gq,{alignItems:"center",gap:24,children:[(0,Z.tZ)(ee.hU,{onClick:this.backButtonClose()?this.closeTab:this.maybeGoBack,disabled:p,children:this.backButtonClose()?(0,Z.tZ)(K.Z,{size:20}):(0,Z.tZ)(eF.Z,{size:20})}),(0,Z.tZ)(t0,{draftSyncedAt:null==c?void 0:c.draft_updated_at,saving:h,isOffline:p,pendingUploads:u,error:w?"network":null})]}),(0,Z.BX)(eK.u_,{className:"unpublished-changes-modal",isOpen:this.state.showUnpublishedChangesModal||!1,onClose:()=>this.setShowUnpublishedChangesModal(!1),children:[(0,Z.tZ)(eK.xB,{title:l("Are you sure you want to leave this page?"),showClose:!0,onClose:()=>this.setShowUnpublishedChangesModal(!1)}),(0,Z.tZ)(eK.fe,{children:(0,Z.tZ)(ei.xv.B3,{translated:!0,children:"It looks like you're in the middle of writing and you haven't published your changes. Publish your changes before you go!"})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{onClick:this.goBack,priority:"destructive",children:l("Leave")}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:()=>this.setShowUnpublishedChangesModal(!1),priority:"secondary",children:l("Stay")})})]}),(0,Z.BX)(eK.u_,{className:"tk-warning-modal",isOpen:this.state.showTkWarningModal||!1,onClose:()=>this.setShowTkWarningModal(!1),children:[(0,Z.tZ)(eK.xB,{title:l("Something still to come?"),showClose:!0,onClose:()=>this.setShowTkWarningModal(!1)}),(0,Z.tZ)(eK.fe,{children:(0,Z.tZ)(ei.xv.B3,{children:s("It looks like there's a TK reminder in this post.  Are you sure you want to continue?","It looks like there's %1 TK reminders in this post.  Are you sure you want to continue?",this.getTkInlineDecorations().length)})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{onClick:this.dismissTkWarning,priority:"primary",children:this.getCtaButtonText()}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:this.acceptTkWarning,priority:"secondary",children:l("Keep Editing")})})]}),(0,Z.BX)(et.gq,{alignItems:"center",gap:24,children:[(null===(o=this.state.post)||void 0===o?void 0:o.id)&&this.state.loaded&&!this.state.loadingError&&(0,Z.tZ)(or,{editorId:this.editorId,pub:this.props.pub,postId:this.state.post.id,user:this.props.user}),this.renderHeaderExtras(),(0,Z.tZ)(et.gq,{gap:8,children:this.renderButtons()})]})]})})}),!y&&d&&!w&&(0,Z.tZ)(P.Y0,{className:"sticky",level:d,onClose:()=>C(b),children:(0,Z.BX)("div",{className:"container",children:[g,(0,Z.tZ)("section",{children:v})]})})]})}renderHeaderExtras(){var e;let t;let{scheduledAt:i,lastScheduledAt:n,post:r}=this.state,{iString:o,iTemplate:a}=this.getI18NProps();if(null==r?void 0:null===(e=r.postSchedules)||void 0===e?void 0:e.length)t=null==r?void 0:r.postSchedules.map(e=>{let t="";return t=e.email_audience?"everyone"===e.email_audience?o("Send email to everyone"):"only_free"===e.email_audience?o("Send email to free subscribers"):"only_paid"===e.email_audience?o("Send email to paid subscribers"):"founding"===e.email_audience?o("Send email to founding subscribers"):o("Send Email"):"everyone"===e.email_audience?o("Allow access to everyone"):"only_free"===e.email_audience?o("Limit access to free subscribers"):"only_paid"===e.email_audience?o("Limit access to paid subscribers"):"founding"===e.email_audience?o("Limit access to founding subscribers"):"",(0,Z.tZ)(ei.Zx,{children:t})});else{let e="";t=(null==r?void 0:r.should_send_email)?(null==r?void 0:r.audience)==="everyone"?o("Send email to everyone"):(null==r?void 0:r.audience)==="only_free"?o("Send email to free subscribers"):(null==r?void 0:r.audience)==="only_paid"?o("Send email to paid subscribers"):(null==r?void 0:r.audience)==="founding"?o("Send email to founding subscribers"):o("Send Email"):(null==r?void 0:r.audience)==="everyone"?o("Allow access to everyone"):(null==r?void 0:r.audience)==="only_free"?o("Limit access to free subscribers"):(null==r?void 0:r.audience)==="only_paid"?o("Limit access to paid subscribers"):(null==r?void 0:r.audience)==="founding"?o("Limit access to founding subscribers"):""}return n?(0,Z.BX)(et.hs,{className:"schedule-wrap",children:[!(null==r?void 0:r.draft_title)&&(0,Z.tZ)(ts.xu,{paddingRight:8,className:l1.scheduleErrorIcon,children:(0,Z.tZ)(tW.u,{text:o("Please set a title"),children:(0,Z.tZ)(eL.Z,{})})}),(0,Z.BX)(et.tu,{className:"schedule-button",children:[(0,Z.tZ)(ei.xv.B4,{color:"primary",children:a(l4(),(0,H.Z)(null!=i?i:void 0).standardDatetime())}),(0,Z.BX)(ei.xv.B4,{color:"secondary",children:[t," âˆ™ ",(0,Z.tZ)(lx.hh,{onClick:this.openPublishModal,children:"Edit"})]})]})]}):null}renderLoadingError(e){let{iString:t}=this.getI18NProps();return"status"in e&&404===e.status?[t("Draft not found."),(0,Z.tZ)("a",{href:(0,en.Bdn)(this.props.pub,"drafts"),native:!0,children:t("View drafts")})]:super.renderLoadingError(e)}renderAboveTitle(){var e,t;let i=this.getPostType(),n=(null===(e=this.state.post)||void 0===e?void 0:e.subscriber_set_id)||this.props.subscriber_set_id||this.state.subscriber_set_id,r="adhoc_email"===i&&n,o=(0,oo.HD)({pub:this.props.pub}),a=(null===(t=this.props.pub.sections)||void 0===t?void 0:t.length)>0;return(0,Z.BX)(Z.HY,{children:[(!r||o)&&a&&(0,Z.tZ)(tH.h,{children:(0,Z.tZ)(et.tu,{"data-testid":"above-title",alignItems:"start",className:k()("post-editor-above-title",{disabled:this.state.isOffline}),children:(0,Z.tZ)(aw.xK,{pub:this.props.pub,onChange:e=>{this.setAndSaveSection(e)},sectionId:this.state.section_chosen?this.state.section_id:-1})})}),this.state.post&&o&&!r&&(0,Z.tZ)(et.tu,{"data-testid":"above-title",alignItems:"start",className:k()("post-editor-above-title",{disabled:this.state.isOffline}),children:(0,Z.tZ)(lC,{post:this.state.post})})]})}renderFirst(){var e,t;let i=this.getPostType(),n=(null===(e=this.state.post)||void 0===e?void 0:e.subscriber_set_id)||this.props.subscriber_set_id||this.state.subscriber_set_id,r="adhoc_email"===i&&n,{iString:o}=this.getI18NProps();return(0,Z.tZ)(tH.h,{children:(0,Z.BX)(et.tu,{gap:12,alignItems:"start",className:k()("post-editor-above-title",{disabled:this.state.isOffline}),children:[this.state.showWriterReferralExplainer&&(0,Z.tZ)(ly,{showConfirm:!!this.state.writerReferralCode,onConfirm:()=>{var e,t;null===(t=this.tipTapEditor)||void 0===t||t.chain().focus().insertCaptionedWriterReferralButton({writerReferralCode:this.state.writerReferralCode,publication:this.props.pub,postId:null===(e=this.state.post)||void 0===e?void 0:e.id}).run(),this.setState({showWriterReferralExplainer:!1})},onDismiss:()=>this.setState({showWriterReferralExplainer:!1})}),r&&(0,Z.tZ)(ee.zx,{href:(0,j.dIB)(this.props.pub,{params:{subscriber_set_id:n}}),trailing:(0,Z.tZ)(ez.Z,{size:20}),priority:"secondary",size:"sm",newTab:!0,children:o("View email recipients")}),!["page"].includes(i)&&(null===(t=this.props.user)||void 0===t?void 0:t.is_admin)&&(0,Z.tZ)(ee.zx,{href:(0,en.n1t)("/publish/settings/preamble",this.state.section_chosen&&this.state.section_id?{section:this.state.section_id}:void 0),trailing:(0,Z.tZ)(ez.Z,{size:20}),priority:"secondary",size:"sm",newTab:!0,children:o("Edit email header / footer")})]})})}renderBelowEditor(){var e;let{iString:t}=this.getI18NProps();if("thread"===this.getPostType())return(0,Z.tZ)("div",{className:"tip",children:t("Tip: Write something concise (1-3 sentences) that encourages general discussion.")});let i=!!(null===(e=this.state.anchorLink)||void 0===e?void 0:e.text);return(0,Z.tZ)(Z.HY,{children:i&&this.state.anchorLink&&this.state.post&&(0,Z.tZ)(et.hs,{className:"header-anchor-editor",style:{top:this.state.anchorLink.top,height:this.state.anchorLink.height},children:(0,Z.tZ)(tr.Z,{text:this.state.anchorLink.text,pub:this.props.pub,post:this.state.post})})})}getPublishStatus(){var e,t,i,n,r,o,a,l,s,d,c,u,p,h;let{post:m,publishing:g,pendingUploads:v,showingAudioModal:b,showingVideoModal:y,droppedAudioFile:f,droppedVideoFile:_,saving:Z,section_id:w}=this.state,{iString:C}=this.getI18NProps(),x="adhoc_email"===this.getPostType();if(Z&&x)return{status:"disabled",message:C("Saving draft...")};if(x&&!w&&(0,oo.HD)({pub:this.props.pub}))return{status:"disabled",message:C("Choose a newsletter...")};if(g)return{status:"disabled",message:C("Publishing in progress...")};if(v>0)return{status:"disabled",message:C("Uploading images...")};if(this.props.openDrawerId)return{status:"disabled",message:C("Cannot publish with drawer open")};if(b||f)return{status:"disabled",message:C("Cannot publish with pending audio file")};if(y||_)return{status:"disabled",message:C("Cannot publish with pending video file")};if("video"===this.getPostType()&&(null==m?void 0:null===(e=m.draftVideoUpload)||void 0===e?void 0:e.state)!=="transcoded")return(null==m?void 0:null===(n=m.draftVideoUpload)||void 0===n?void 0:n.state)==="uploaded"?{status:"disabled",message:C("Processing video upload...")}:{status:"disabled",message:C("Cannot publish without video.")};if("podcast"===this.getPostType()&&(null==m?void 0:null===(t=m.activePostMediaComposition)||void 0===t?void 0:t.workflow_state)==="processing")return{status:"disabled",message:C("Processing video upload...")};if("podcast"===this.getPostType()&&(null==m?void 0:null===(i=m.activePostMediaComposition)||void 0===i?void 0:i.workflow_state)==="error")return{status:"disabled",message:C("Video upload error, please upload again.")};if("podcast"===this.getPostType()&&!(null==m?void 0:m.draft_podcast_url)&&!(null==m?void 0:m.draft_podcast_upload_id)&&!(null==m?void 0:m.draft_video_upload_id))return{status:"disabled",message:C("Cannot publish without podcast episode.")};if("podcast"===this.getPostType()&&(null==m?void 0:m.draftPodcastUpload)&&"audio"===this.state.podcastMediaType){if((null==m?void 0:null===(r=m.draftPodcastUpload)||void 0===r?void 0:r.state)==="uploaded"||(null==m?void 0:null===(o=m.draftPodcastPreviewUpload)||void 0===o?void 0:o.state)==="uploaded")return{status:"disabled",message:C("Processing audio upload...")};if((0,nC.Os)(null==m?void 0:m.draftPodcastPreviewUpload))return{status:"disabled",message:C("Podcast free audio invalid, please upload again.")}}if("podcast"===this.getPostType()&&(null==m?void 0:m.draftVideoUpload)&&"video"===this.state.podcastMediaType){if(!(null==m?void 0:m.draftVideoUpload))return{status:"disabled",message:C("Cannot publish without video.")};if((null==m?void 0:null===(a=m.draftVideoUpload)||void 0===a?void 0:a.state)==="uploaded")return{status:"disabled",message:C("Processing video upload...")};if((0,nC.Os)(null==m?void 0:m.draftVideoUpload))return{status:"disabled",message:C("Podcast video invalid, please upload again.")};let e=!["transcoded","error"].includes(null!==(h=null==m?void 0:null===(l=m.draftPodcastUpload)||void 0===l?void 0:l.state)&&void 0!==h?h:""),t=!!(null==m?void 0:m.draftPodcastPreviewUpload)&&!["transcoded","error"].includes(null==m?void 0:null===(s=m.draftPodcastPreviewUpload)||void 0===s?void 0:s.state),i=!!(null==m?void 0:m.draftPodcastPreviewUpload),n=(null==m?void 0:m.draftVideoUpload.preview_start)!=null&&(null==m?void 0:m.draftVideoUpload.preview_duration)!=null,r=!!(null==m?void 0:m.draftVideoUpload)&&(null==m?void 0:null===(c=m.draftVideoUpload)||void 0===c?void 0:null===(d=c.extractedAudio)||void 0===d?void 0:d.id)!==(null==m?void 0:null===(u=m.draftPodcastUpload)||void 0===u?void 0:u.id);if(r&&!(null==m?void 0:m.draftPodcastUpload))return{status:"disabled",message:C("Missing audio file for RSS feed")};if((null==m?void 0:null===(p=m.draftPodcastUpload)||void 0===p?void 0:p.state)=="error")return{status:"warning",message:C("Audio RSS error. This can happen if video has no audio")};if(e||(r?i&&t:n&&t))return{status:"disabled",message:C("Processing audio for podcast feeds...")}}return!m||(null==m?void 0:m.is_published)&&(m.email_sent_at||m.inbox_sent_at||"page"===m.type)&&!this.hasUnpublishedChanges()?{status:"disabled",message:C("No changes to publish.")}:m.draft_body&&(m.draft_body.includes("[EDIT ME] Beginnings are hard. [EDIT ME]")||m.draft_body.includes("â€œSubscribeâ€ buttons (found in your editor under â€œButtonsâ€"))?{status:"disabled",message:C("Please replace the template text before you publish")}:{status:"enabled",message:null}}getCtaButtonText(){let{post:e,publishing:t}=this.state,{iString:i}=this.getI18NProps(),n=(0,Z.tZ)("span",{children:i("Continue")});return"adhoc_email"===this.getPostType()?n=(0,Z.tZ)(Z.HY,{children:(0,Z.tZ)("span",{children:i(t?"Sending email":(null==e?void 0:e.email_sent_at)?"Send again":"Send email")})}):(null==e?void 0:e.is_published)&&this.hasUnpublishedChanges()&&!this.canSendEmail()&&(n=(0,Z.tZ)("span",{children:i("Update")})),n}renderButtons(){let{post:e,isOffline:t,isFrozen:i}=this.state,{pub:n,inSignupFlow:r}=this.props,{iString:o}=this.getI18NProps(),a="adhoc_email"===this.getPostType(),l=this.getCtaButtonText(),s=this.getPublishStatus(),d=i||t||"disabled"===s.status,c="warning"===s.status,u=s.message;return[(0,Z.tZ)(Z.HY,{children:!(0,Y.K1)()&&!a&&(r?(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>(0,Y.uX)((0,j.QK7)(n)),children:o("Write a post later")}):(0,Z.tZ)(ee.zx,{priority:"secondary",disabled:!(null==e?void 0:e.id)||t,onClick:this.openPreviewModal,"data-testid":"preview-post",children:o("Preview")}))}),r?(0,Z.tZ)(ee.zx,{id:"publish","data-testid":"publish-button",disabled:!!u,title:"string"==typeof u?u:"",onClick:()=>{if(!e){console.error("post not defined, cannot publish");return}let t={send:!0,share_automatically:!1,publication_id:n.id};N().post("/api/v1/drafts/".concat(e.id,"/publish")).send(t).then(()=>(0,Y.uX)("".concat((0,j.SVA)({subdomain:n.subdomain}),"/p/").concat(e.slug)))},children:o("Send Now")}):d&&u?(0,Z.tZ)(tW.u,{text:u,children:(0,Z.tZ)(ee.zx,{id:"publish","data-testid":"publish-button-wtooltip",disabled:!0,children:l})}):(0,Z.tZ)(ee.zx,{id:"publish","data-testid":"publish-button",disabled:d,onClick:()=>{(!c||confirm(o("It looks like there's a problem getting the audio from the video. This might happen if the video doesn't have any sound. Do you still want to go ahead and publish it, even if we can't distribute it via RSS?")))&&this.onClickCTA()},title:null!=u?u:"",children:l})].filter(e=>e)}renderModals(){var e,t,i,n,r,o,a,l,s,d,c,u,p,h,m,g,v,b,y,f,_,w,C,x,S,k,B,T,I,N,P,E,X,M,A,D,R,F,z,O,U,H,j,J,V;let q;let W=!(0,er.pubHasPaymentsEnabled)(this.props.pub);q="page"!==this.getPostType()&&(null===(m=this.props.pub.sections)||void 0===m?void 0:m.length)>0;let G={post:null!==(g=this.state.post)&&void 0!==g?g:null,postType:this.getPostType(),pub:this.props.pub,socialTitle:null!==(v=this.state.socialTitle)&&void 0!==v?v:null,onChangeSocialTitle:this.setSocialTitle,socialDescription:null!==(b=this.state.socialDescription)&&void 0!==b?b:null,onChangeSocialDescription:this.setSocialDescription,socialImage:null!==(y=this.state.socialImage)&&void 0!==y?y:null,onChangeSocialImage:this.setSocialImage,saving:null!==(f=this.state.savingModal)&&void 0!==f&&f,saveSocialMetadata:this.saveSocialMetadata,resetSocialMetadata:this.resetSocialMetadata,audienceToggle:null!==(_=this.state.audienceToggle)&&void 0!==_?_:null,showSave:!1,useDraft:!1},K={pub:this.props.pub,post:this.state.post,searchTitle:null!==(w=this.state.searchTitle)&&void 0!==w?w:null,searchDescription:null!==(C=this.state.searchDescription)&&void 0!==C?C:null,setSearchTitle:this.setSearchTitle,setSearchDescription:this.setSearchDescription,saveSearchMetadata:this.saveSearchMetadata,saving:null!==(x=this.state.savingModal)&&void 0!==x&&x},Q={pub:this.props.pub,post:this.state.post,slugDraft:null!==(S=this.state.slugDraft)&&void 0!==S?S:null,setSlugDraft:this.setSlugDraft,saveSlug:this.saveSlug,saving:null!==(k=this.state.savingModal)&&void 0!==k&&k},$={pub:this.props.pub,post:this.state.post,postBody:null!==(B=null===(e=this.state.doc)||void 0===e?void 0:e.body)&&void 0!==B?B:void 0,hasPodcastPreview:!!(null===(t=this.state.doc)||void 0===t?void 0:t.podcast_preview_upload_id),podcastDescription:(null===(i=this.state.post)||void 0===i?void 0:i.podcast_description)&&(0,eo.normalizeDbPodcastDescriptionToHtmlString)(this.state.post.podcast_description),savePodcastDescription:this.savePodcastDescription,onHideFromFeedChange:this.saveHideFromFeed,selectedSectionId:this.state.section_id},ee={metadata:{isExplicit:null!==(T=this.state.isExplicit)&&void 0!==T&&T,episodeNumber:null!==(I=this.state.episodeNumber)&&void 0!==I?I:null,seasonNumber:null!==(N=this.state.seasonNumber)&&void 0!==N?N:null,episodeType:null!==(P=this.state.episodeType)&&void 0!==P?P:null,hideFromFeed:null!==(E=this.state.hideFromFeed)&&void 0!==E&&E},setMetadata:this.setPodcastMetadata},et={canSyndicate:(0,nC.lf)(this.props.pub,this.state.post),shouldSyndicate:this.state.syndicateToggle,syndicateToSectionId:this.state.syndicateToSectionId,shouldSyndicateToOtherFeed:this.state.shouldSyndicateToOtherFeed,selectedSectionId:this.state.section_id,pub:this.props.pub,post:this.state.post,setSyndicateInfo:this.setSyndicateInfo,showNotesProps:$},ei=e=>{if(e){var t,i;let n={mediaUpload:e},r=e.preview_duration&&e.preview_duration>0;e.extractedAudio&&(n.podcastUpload=e.extractedAudio),r&&e.extractedPreviewAudio&&(n.podcastPreviewUpload=e.extractedPreviewAudio),this.onVideoPodcastUploadChanged(n),null===(t=(i=this.props).setIsDrawerOpen)||void 0===t||t.call(i,{drawerId:null,isOpen:!1})}else this.removeVideoPodcast({skipConfirm:!0})};return[(0,Z.tZ)(lu,{modalRef:this.settingsModalRef,audienceToggle:this.state.audienceToggle,postType:this.getPostType(),saving:!!this.state.savingModal,pub:this.props.pub,post:null!==(X=this.state.post)&&void 0!==X?X:null,user:this.props.user,section_id:this.state.section_id,commentSort:this.state.commentSort,commentLevel:this.state.commentLevel,onChangeCommentLevel:this.setCommentLevel,section_chosen:!!this.state.section_chosen,setCommentSort:this.setCommentSort,showNotesProps:$,onChangeAudience:this.setAudience,canSendToOnlyFree:this.canSendToOnlyFree(),canSendFreePreview:this.canSendFreePreview(),canOnlySendToEveryone:this.canOnlySendToEveryone(),publicationSettings:this.props.publicationSettings,showSectionSelector:q,socialMetadataProps:G,canSendToOnlyFounding:this.canSendToOnlyFounding(),sendFreePreviewToggle:this.state.sendFreePreviewToggle,shouldSendFreePreview:this.shouldSendFreePreview(),setTeaserPostEligible:this.setTeaserPostEligible,teaserPostEligibleToggle:!!this.state.teaserPostEligibleToggle,showTeaserPostSettings:this.canSeeTeaserPostSettings(),audienceBeforeArchived:this.state.audienceBeforeArchived,onRemoveArchivePaywall:this.removeArchivePaywall,cannotSendToSubscribers:W,syndicateVoiceoverProps:et,podcastEpisodeMetadataProps:ee,searchMetadataProps:K,saveWith:this.saveWith,deletePost:this.deletePost,isPublished:!!this.state.post&&this.state.post.is_published,postUrlProps:Q,showGuestBios:!!this.state.showGuestBios,unpublishPost:this.unpublishPost,setShowGuestBios:this.setShowGuestBios,resetSecretLink:this.resetSecretLink,exemptFromArchivePaywall:!!this.state.exemptFromArchivePaywall,resetAudienceCommentAndSectionSettings:this.resetAudienceCommentAndSectionSettings,isEditor2:!1,setSection:this.setAndSaveSection,isMetered:"metered"===this.state.meterType,onChangeIsMetered:this.changeIsMetered}),(0,Z.tZ)(a4,{audienceToggle:this.state.audienceToggle,postType:this.getPostType(),saving:!!this.state.savingModal,hasPendingImports:this.state.hasPendingImports,onBeforeClose:()=>({}),pub:this.props.pub,post:null!==(M=this.state.post)&&void 0!==M?M:null,user:this.props.user,unlockAt:null!==(A=this.state.unlockAt)&&void 0!==A?A:null,publishing:null!==(D=this.state.publishing)&&void 0!==D&&D,section_id:this.state.section_id,commentSort:this.state.commentSort,publishPost:this.publishPost,scheduledAt:null!==(R=this.state.scheduledAt)&&void 0!==R?R:null,onChangeScheduledAt:this.setScheduledAt,scheduledRepublishes:this.state.scheduledRepublishes,onChangeScheduledRepublishes:this.setScheduledRepublishes,canSendEmail:this.canSendEmail(),commentLevel:this.state.commentLevel,onChangeCommentLevel:this.setCommentLevel,dontSendEmail:this.state.dontSendEmail,mustSendEmail:this.mustSendEmail(),section_chosen:!!this.state.section_chosen,setCommentSort:this.setCommentSort,showNotesProps:$,lastScheduledAt:null!==(F=this.state.lastScheduledAt)&&void 0!==F?F:null,shouldSendEmail:this.shouldSendEmail(),onChangeAudience:this.setAudience,onChangeUnlockAt:this.setUnlockAt,canSendToOnlyFree:this.canSendToOnlyFree(),onToggleSendEmail:this.setDontSendEmail,canSendFreePreview:this.canSendFreePreview(),setSendFreePreview:this.setSendFreePreview,setTeaserPostEligible:this.setTeaserPostEligible,publicationSettings:this.props.publicationSettings,showSectionSelector:q,socialMetadataProps:G,canSendToOnlyFounding:this.canSendToOnlyFounding(),canOnlySendToEveryone:this.canOnlySendToEveryone(),insertPaywallAndClose:()=>{var e;null===(e=this.publishModal)||void 0===e||e.close(),setTimeout(this.openInsertMenu,500)},sendFreePreviewToggle:this.state.sendFreePreviewToggle,teaserPostEligibleToggle:!!this.state.teaserPostEligibleToggle,shouldSendFreePreview:this.shouldSendFreePreview(),audienceBeforeArchived:this.state.audienceBeforeArchived,onRemoveArchivePaywall:this.removeArchivePaywall,cannotSendToSubscribers:W,syndicateVoiceoverProps:et,shouldShareAutomatically:this.shouldShareAutomatically(),onToggleShareAutomatically:this.setShareAutomatically,canSeeSendFreePreviewOption:this.canSeeSendFreePreviewOption(),canSeeTeaserPostSettings:this.canSeeTeaserPostSettings(),podcastEpisodeMetadataProps:ee,insertPodcastPreviewAndClose:()=>{var e;null===(e=this.publishModal)||void 0===e||e.close(),setTimeout(this.openPodcastPaywallMenu,500)},createFreePreviewVideoAndClose:()=>{var e;null===(e=this.publishModal)||void 0===e||e.close(),setTimeout(()=>{var e;null===(e=this._videoEditor)||void 0===e||e.activatePreviewSetter()},500)},isEditor2:!1,modalRef:this.publishModalRef,closeModal:this.closePublishModal,setSection:this.setAndSaveSection,isMetered:"metered"===this.state.meterType,onChangeIsMetered:this.changeIsMetered}),this.createConfirmChangeAudienceModal(),(0,Z.tZ)(L.p,{ref:this.assignPrepublishModal,noCloseButton:!0,className:"publish-warning-modal force-light-theme",onBeforeClose:()=>{this.setState({publishing:!1})},children:(0,Z.tZ)(oa,{suggestions:this.state.prepublishSuggestions,errors:this.state.prepublishErrors,onAddPaywall:e=>{this.setState({showPublishModal:!1,publishing:!1,justPublished:!1}),this.addPrepublishPaywall(e)},onAddSubscribeCta:e=>{this.setState({showPublishModal:!1,publishing:!1,justPublished:!1}),this.addPrepublishSubscribeCta(e)},onAddVoiceover:()=>{this.setState({showPublishModal:!1,publishing:!1,justPublished:!1}),this.addVoiceover()},onSendByEmail:this.addPrepublishSendAsEmail,onCancel:this.rejectPrepublishChanges})}),(0,Z.tZ)(Z.HY,{children:!(0,Y.K1)()&&(0,Z.tZ)(tY,{user:this.props.user,post:this.state.post||{},pub:this.props.pub,resetSecretLink:this.resetSecretLink,openSettingsModal:this.openSettingsModal,canSendFreePreview:this.canSendFreePreview()&&this.state.sendFreePreviewToggle,canSendToOnlyFounding:this.canSendToOnlyFounding(),shouldSendFreePreview:this.shouldSendFreePreview(),audienceToggleValue:null!==(z=this.state.audienceToggle)&&void 0!==z?z:null,isOpen:this.state.previewModalOpen,onClose:this.closePreviewModal})}),(0,Z.tZ)(t7.k,{id:"audioEmbedDnD",droppedFile:this.state.droppedAudioFile,open:"audioEmbedDnD"===this.props.openDrawerId,pub:this.props.pub,postId:null===(n=this.state.post)||void 0===n?void 0:n.id,onClose:()=>{var e,t;null===(e=(t=this.props).setIsDrawerOpen)||void 0===e||e.call(t,{drawerId:null,isOpen:!1}),this.setState({droppedAudioFile:null})},onSave:e=>{var t,i;let{mediaUploadId:n,duration:r}=e;if(!this.tipTapEditor){console.warn("No tipTapEditor, cannot save audio");return}this.tipTapEditor.chain().focus().insertAudio({mediaUploadId:n,duration:r}).run(),null===(t=(i=this.props).setIsDrawerOpen)||void 0===t||t.call(i,{drawerId:null,isOpen:!1}),this.setState({droppedAudioFile:null})},setPostId:this.setPostId}),(0,Z.tZ)(lh.t,{id:"videoEmbedDnD",editorDroppedFile:null!==(O=this.state.droppedVideoFile)&&void 0!==O?O:null,mediaUploadId:null,open:"videoEmbedDnD"===this.props.openDrawerId,pub:this.props.pub,postId:null!==(U=null===(r=this.state.post)||void 0===r?void 0:r.id)&&void 0!==U?U:null,onClose:()=>{var e,t;null===(e=(t=this.props).setIsDrawerOpen)||void 0===e||e.call(t,{drawerId:null,isOpen:!1}),this.setState({droppedVideoFile:null})},onSave:e=>{var t,i;let{mediaUploadId:n,duration:r}=e;if(!this.tipTapEditor){console.warn("No tipTapEditor, cannot save video");return}this.tipTapEditor.chain().focus().insertVideo({mediaUploadId:n,duration:r}).run(),null===(t=(i=this.props).setIsDrawerOpen)||void 0===t||t.call(i,{drawerId:null,isOpen:!1}),this.setState({droppedVideoFile:null})},setPostId:this.setPostId}),(0,Z.tZ)(lw,{isOpen:this.state.isVideoSettingsModalOpen,onSave:e=>{let{mediaUpload:t}=e;return ei(t)},onClose:()=>this.setState({isVideoSettingsModalOpen:!1})}),this.tipTapEditor&&(0,Z.tZ)(oe,{initialFile:this.state.droppedPodcastFile,open:"podcast"===this.props.openDrawerId,postForEditor:this.state.post,pub:this.props.pub,postId:null===(o=this.state.post)||void 0===o?void 0:o.id,bylines:null!==(H=null===(a=this.state.doc)||void 0===a?void 0:a.bylines)&&void 0!==H?H:[],pendingInvites:null!==(j=null===(l=this.state.doc)||void 0===l?void 0:l.pending_invites)&&void 0!==j?j:[],onBylinesAndInvitesChanged:this.onBylinesAndInvitesChanged,onClose:()=>{var e,t;null===(e=(t=this.props).setIsDrawerOpen)||void 0===e||e.call(t,{drawerId:null,isOpen:!1})},hideFromFeed:null!==(J=null===(s=this.state.post)||void 0===s?void 0:s.hide_from_feed)&&void 0!==J&&J,onHideFromFeedChange:this.saveHideFromFeed,selectedSectionId:this.state.section_id,onSaveFreePodcastUrl:this.onSaveFreePodcastUrl,onPodcastUploadChanged:this.onPodcastUploadChanged,onPodcastPreviewUploadChanged:this.onPodcastPreviewUploadChanged,onVideoPodcastUploadChanged:this.onVideoPodcastUploadChanged,onRemoveVideoPodcast:this.removeVideoPodcast,onBylineChange:this.onBylineChange,setPostId:this.setPostId,freePodcastUrl:null!==(V=null===(d=this.state.doc)||void 0===d?void 0:d.free_podcast_url)&&void 0!==V?V:null,podcastPreviewUpload:null===(c=this.state.doc)||void 0===c?void 0:c.podcastPreviewUpload,legacyPodcastUrl:null===(u=this.state.doc)||void 0===u?void 0:u.podcast_url,askToRemoveLegacyPodcast:this.removeLegacyPodcast,onUploadStarted:()=>{this.setState({podcastUploading:!0})},onUploadCancelled:()=>{this.setState({podcastUploading:!1})},onPreviewUploadStarted:()=>{this.setState({podcastPreviewUploading:!0})},onPreviewUploadCancelled:()=>{this.setState({podcastPreviewUploading:!1})},mediaType:this.state.podcastMediaType,skipToRecordStep:this.state.skipToRecordStep,showNotesProps:$}),(0,Z.tZ)(lb,{open:"voiceover"===this.props.openDrawerId,pub:this.props.pub,postId:null===(p=this.state.post)||void 0===p?void 0:p.id,onClose:()=>{var e,t;null===(e=(t=this.props).setIsDrawerOpen)||void 0===e||e.call(t,{drawerId:null,isOpen:!1})},onVoiceoverUploadChanged:this.onVoiceoverUploadChanged,setPostId:this.setPostId,initialMediaUpload:null===(h=this.state.doc)||void 0===h?void 0:h.voiceoverUpload})]}constructor(e,t){var i,n,r,o,a,l,s,d,c=()=>super.onEdit;if(super(e,t),d=this,(0,M._)(this,"state",void 0),(0,M._)(this,"editorId",void 0),(0,M._)(this,"_onVisibilityChange",void 0),(0,M._)(this,"allowCommentsButton",void 0),(0,M._)(this,"allowPostShareButton",void 0),(0,M._)(this,"previewModalRef",void 0),(0,M._)(this,"prepublishModal",void 0),(0,M._)(this,"publishModal",void 0),(0,M._)(this,"confirmChangeAudienceModalRef",void 0),(0,M._)(this,"settingsModal",void 0),(0,M._)(this,"assignPrepublishModal",e=>{this.prepublishModal=e}),(0,M._)(this,"assignPublishModal",e=>{this.publishModal=e}),(0,M._)(this,"assignConfirmChangeAudienceModalRef",e=>{this.confirmChangeAudienceModalRef=e}),(0,M._)(this,"assignSettingsModal",e=>{this.settingsModal=e}),(0,M._)(this,"loadVerifyState",()=>N().get("/api/v1/publication/verify_status").then(e=>e.body&&this.setState({passVerify:e.body.passVerify,hasPendingImports:e.body.hasPendingImports}))),(0,M._)(this,"canSendToOnlyFounding",()=>{let{pub:e}=this.props;return!!(e.plans&&e.plans.find(e=>{var t;return(null===(t=e.metadata)||void 0===t?void 0:t.founding)==="yes"}))}),(0,M._)(this,"canOnlySendToEveryone",()=>{var e,t,i;let n=!!(null===(e=this.state.doc)||void 0===e?void 0:e.free_podcast_url),r=!!(null===(i=this.state.doc)||void 0===i?void 0:null===(t=i.videoUpload)||void 0===t?void 0:t.preview_duration);return n&&!r}),(0,M._)(this,"onNetworkChange",e=>{let t="offline"===e.type;this.setState({isOffline:t}),this.autoSaveEnabled="online"===e.type,t?l5():this.state.unsaved&&this.save()}),(0,M._)(this,"onVisibilityChange",async()=>{if((0,Y.dr)()&&this.canCheckIfUpToDate()&&!this.state.checkingIfUpToDate){if(!this.state.post){console.warn("onVisibilityChange called without post");return}this.setState({checkingIfUpToDate:!0});try{let e=await N().get("/api/v1/drafts/".concat(this.state.post.id));this.canCheckIfUpToDate()&&new Date(this.state.post.draft_updated_at)<new Date(e.body.draft_updated_at)&&document.location.reload()}catch(e){console.error("Failed to check post status:",e)}this.setState({checkingIfUpToDate:!1})}}),(0,M._)(this,"handleMouseover",(e,t)=>{var i;let n=e.posAtDOM(t.target,void 0),r=e.state.doc.resolve(n),o=r.parent,a=document.getElementsByClassName("editor-scroll")[0];if((null===(i=o.type)||void 0===i?void 0:i.name)!=="heading"||o.attrs.level>4){this.setState({anchorLink:null});return}let l=e.coordsAtPos(r.pos),s=.5*(l.top+l.bottom)-(null==a?void 0:a.offsetTop)||0;this.setState({anchorLink:{text:o.textContent,top:s}})}),(0,M._)(this,"maybeGoBack",e=>{this.state.unpublishedChanges?this.setState({showUnpublishedChangesModal:!0}):this.goBack(e)}),(0,M._)(this,"goBack",function(e){let{localNavigation:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};d.props.back?(0,Y.uX)(d.props.back,{event:e,replace:!0,local_navigation:t}):(0,Y.uX)((0,j.QK7)(d.props.pub))}),(0,M._)(this,"setSection",e=>{-1===e?this.setState({section_chosen:!1}):this.setState({section_chosen:!0,section_id:e,scheduledRepublishes:void 0})}),(0,M._)(this,"setAndSaveSection",e=>{this.setSection(e),this.save({saveDocumentOptions:{forceSave:!0,commentLevel:this.state.commentLevel}})}),(0,M._)(this,"setCommentLevel",e=>{this.setState({commentLevel:e})}),(0,M._)(this,"setSocialTitle",e=>{this.setState({socialTitle:e})}),(0,M._)(this,"setSocialDescription",e=>{this.setState({socialDescription:e})}),(0,M._)(this,"setSocialImage",e=>{this.setState({socialImage:e})}),(0,M._)(this,"setSearchTitle",e=>{this.setState({searchTitle:e})}),(0,M._)(this,"setSearchDescription",e=>{this.setState({searchDescription:e})}),(0,M._)(this,"setScheduledAt",e=>{this.setState({scheduledAt:e,scheduledRepublishes:void 0})}),(0,M._)(this,"setScheduledRepublishes",e=>{this.setState({scheduledRepublishes:e})}),(0,M._)(this,"setUnlockAt",e=>{this.setState({unlockAt:e})}),(0,M._)(this,"setCommentSort",e=>{this.setState({commentSort:e})}),(0,M._)(this,"setDontSendEmail",e=>{this.setState({dontSendEmail:e})}),(0,M._)(this,"setShareAutomatically",e=>{this.setState({shareAutomatically:e})}),(0,M._)(this,"removeArchivePaywall",()=>{this.setState({audienceBeforeArchived:null,audienceToggle:"everyone",exemptFromArchivePaywall:!0})}),(0,M._)(this,"setShowGuestBios",e=>{this.setState({showGuestBios:e})}),(0,M._)(this,"setShowPublishModal",e=>{this.setState({showPublishModal:e})}),(0,M._)(this,"tkRemindersEnabled",()=>null===this.props.pub.language||"en"===this.props.pub.language),(0,M._)(this,"setShowTkWarningModal",e=>{this.setState({showTkWarningModal:e})}),(0,M._)(this,"dismissTkWarning",async()=>{this.setShowTkWarningModal(!1),await this.saveWith({hasDismissedTkWarning:!0}),this.onClickCTA()}),(0,M._)(this,"changeIsMetered",async e=>{let t=e?"metered":"none";await this.saveWith({meterType:t}),this.setState({meterType:t})}),(0,M._)(this,"acceptTkWarning",()=>{this.setShowTkWarningModal(!1);let e=this.getTkInlineDecorations()[0];if(!e)return;let{from:t,to:i}=e,n=()=>{this.tipTapEditor&&this.editorView&&(this.editorView.hasFocus()||(this.tipTapEditor.chain().focus().setTextSelection({from:t,to:i}).run(),window.setTimeout(n,50)))};n()}),(0,M._)(this,"getTkInlineDecorations",()=>{var e;if(!this.editorView)return[];let t=t5.getState(this.editorView.state);return(null!==(e=null==t?void 0:t.find())&&void 0!==e?e:[]).filter(e=>e.to>e.from)}),(0,M._)(this,"setShowUnpublishedChangesModal",e=>{this.setState({showUnpublishedChangesModal:e})}),(0,M._)(this,"setHideSharePostAndComment",e=>{this.setState({hideSharePostAndComment:e})}),(0,M._)(this,"setHasShownPrepublishModal",async e=>{await (0,Y.IW)(this,{hasShownPrepublishModal:e})}),(0,M._)(this,"saveSocialMetadata",e=>{let{socialTitle:t,socialDescription:i,socialImage:n}=e;this.saveWith({socialTitle:t,socialDescription:i,socialImage:n})}),(0,M._)(this,"saveSearchMetadata",e=>{let{searchTitle:t,searchDescription:i}=e;this.saveWith({searchTitle:t,searchDescription:i})}),(0,M._)(this,"savePodcastDescription",e=>{this.saveWith({podcastDescription:e})}),(0,M._)(this,"saveSlug",async e=>{let t=await this.saveWith({slug:e});return t&&this.setSlugDraft(null),{post:this.state.post,success:t}}),(0,M._)(this,"saveHideFromFeed",async e=>{this.saveWith({hideFromFeed:e})}),(0,M._)(this,"setSlugDraft",e=>{this.setState({slugDraft:e})}),(0,M._)(this,"resetSocialMetadata",()=>{var e,t,i,n,r,o;this.setState({socialTitle:null!==(n=null===(e=this.state.post)||void 0===e?void 0:e.social_title)&&void 0!==n?n:null,socialDescription:null!==(r=null===(t=this.state.post)||void 0===t?void 0:t.description)&&void 0!==r?r:null,socialImage:null!==(o=null===(i=this.state.post)||void 0===i?void 0:i.cover_image)&&void 0!==o?o:null})}),(0,M._)(this,"resetAudienceCommentAndSectionSettings",()=>{var e;if(!this.state.post){console.warn("missing post, cannot reset audience, comment, and section settings");return}this.setState({audienceToggle:this.state.post.audience,audienceBeforeArchived:this.state.post.audience_before_archived,exemptFromArchivePaywall:this.state.post.exempt_from_archive_paywall,commentLevel:this.state.post.write_comment_permissions,commentSort:this.state.post.default_comment_sort,section_chosen:this.state.post.section_chosen,section_id:this.state.post.draft_section_id,teaserPostEligibleToggle:null===(e=this.state.post)||void 0===e?void 0:e.teaser_post_eligible})}),(0,M._)(this,"_innerSetAudience",e=>{if(!e)return;let{commentLevel:t,shouldSendEmail:i}=this.state,n=(0,er.isPaidPub)(this.props.pub);(0,er.isValidCommentLevel)(t,e,this.getPostType(),n)||(t=(0,er.defaultCommentLevelForPub)(e,this.getPostType(),this.props.pub,n)),"only_free"===this.state.audienceToggle&&"only_free"!==e?(t=(0,er.defaultCommentLevelForPub)(e,this.getPostType(),this.props.pub,n),i=(0,er.defaultSendEmailForPub)(this.props.pub,this.getPostType(),e)):"only_free"!==this.state.audienceToggle&&"only_free"===e&&(i=!0),this.setState({audienceToggle:e,commentLevel:t,shouldSendEmail:i})}),(0,M._)(this,"confirmChangeAudience",e=>{this.setState({pendingAudience:e},()=>{if(!this.confirmChangeAudienceModalRef){console.warn("could not confirm changing audience to [".concat(e,"], modal ref not found"));return}this.confirmChangeAudienceModalRef.open()})}),(0,M._)(this,"continueSettingAudience",async()=>{var e;let{pendingAudience:t}=this.state;this.removePaywall(),await this.removeVideoPreview(),this.removePodcastPreview({skipConfirm:!0}),this._innerSetAudience(t),null===(e=this.confirmChangeAudienceModalRef)||void 0===e||e.close()}),(0,M._)(this,"cancelSettingAudience",()=>{this.setState({pendingAudience:void 0},()=>{var e;null===(e=this.confirmChangeAudienceModalRef)||void 0===e||e.close()})}),(0,M._)(this,"setPodcastMetadata",e=>{this.setState(e)}),(0,M._)(this,"setSyndicateInfo",e=>{let{shouldSyndicate:t,syndicateToSectionId:i,shouldSyndicateToOtherFeed:n}=e;this.setState({syndicateToggle:t,syndicateToSectionId:i,shouldSyndicateToOtherFeed:n}),this.saveWith({shouldSyndicateToOtherFeed:n,syndicateToSectionId:i,syndicateVoiceover:t})}),(0,M._)(this,"setAudience",e=>{if(this.state.audienceToggle&&(0,ty.isPaidAudience)(this.state.audienceToggle)&&!(0,ty.isPaidAudience)(e)&&(this.hasPaywall()||this.hasPodcastPreview())){this.confirmChangeAudience(e);return}this._innerSetAudience(e)}),(0,M._)(this,"setSendFreePreview",e=>{this.setState({sendFreePreviewToggle:e})}),(0,M._)(this,"setTeaserPostEligible",e=>{this.setState({teaserPostEligibleToggle:e})}),(0,M._)(this,"resetSecretLink",()=>{let{iString:e}=this.getI18NProps();return(0,Y.Se)(this,"resettingSecretLink",async t=>{if(window.confirm(e("Are you sure you'd like to reset the draft link? People using the old link will no longer have access")))try{if(!t.post){console.warn("missing post, cannot reset secret link");return}let e=await N().post("/api/v1/drafts/".concat(t.post.id,"/reset-uuid"));await (0,Y.nn)(this,async t=>{t.post&&(t.post.uuid=e.body.uuid,this.setState({post:t.post}))})}catch(t){alert((0,Y.zx)(t,e("Failed to reset secret link")))}})}),(0,M._)(this,"onBylineChange",()=>{if(!this.state.doc)return;let e=(0,f._)({},this.state.doc);this.setState({doc:e},async()=>{this.onEdit({force:!0})})}),(0,M._)(this,"deletePost",async()=>{let{iString:e}=this.getI18NProps();if(window.confirm(e("Are you sure?"))){if(this.state.post)try{await N().delete("/api/v1/drafts/".concat(this.state.post.id))}catch(t){console.error("Error deleting: ",t),alert((0,Y.zx)(t,e("There was a network issue. Try again in a bit")));return}else console.warn("Is draft, no need to delete");await (0,Y.IW)(this,{unsaved:!1,unpublishedChanges:!1}),this.goBack(null,{localNavigation:!1})}}),(0,M._)(this,"publishPost",async()=>{let{iString:e}=this.getI18NProps();this.setState({publishing:!0});let{lastScheduledAt:t}=this.state,{scheduledAt:i}=this.state,{scheduledRepublishes:n}=this.state;if(i&&i<new Date&&(i=null),this.shouldSendEmail()&&"adhoc_email"===this.getPostType()&&!confirm(e("Are you sure you want to send this email?"))){this.setState({publishing:!1});return}try{var r,o,a,l,s,d,c,u,p,h,m,g,v,b,y,_,Z,w,C,x,S,k;let e;if((0,U.NA)("conversion",(null===(o=window)||void 0===o?void 0:null===(r=o._analyticsConfig)||void 0===r?void 0:r.adwordsAccountId)&&window._analyticsConfig.adwordsEventSendTo?{send_to:"".concat(window._analyticsConfig.adwordsAccountId,"/").concat("GBq0CKrB6cMDEKuN5pYB")}:{}),await this.updateFiles(),this.editorView&&await this.uploadUnhostedImages(this.editorView),await this.updateDocumentState(),!await this.saveWith({audience:this.state.audienceToggle,syndicateVoiceover:!!this.state.syndicateToggle,syndicateToSectionId:null!==(s=this.state.syndicateToSectionId)&&void 0!==s?s:null,shouldSyndicateToOtherFeed:null!==(d=this.state.shouldSyndicateToOtherFeed)&&void 0!==d?d:null,audienceBeforeArchived:null!==(c=this.state.audienceBeforeArchived)&&void 0!==c?c:null,exemptFromArchivePaywall:this.state.exemptFromArchivePaywall,socialTitle:this.state.socialTitle,socialDescription:this.state.socialDescription,socialImage:this.state.socialImage,searchTitle:this.state.searchTitle,searchDescription:this.state.searchDescription,commentLevel:this.state.commentLevel,commentSort:this.state.commentSort,shouldSendEmail:this.shouldSendEmail(),shouldSendFreePreview:this.canSeeSendFreePreviewOption()?this.canSendFreePreview()&&this.state.sendFreePreviewToggle:null,teaserPostEligible:this.canSeeTeaserPostSettings()?this.state.teaserPostEligibleToggle:null,isExplicit:this.state.isExplicit,episodeNumber:this.state.episodeNumber,seasonNumber:this.state.seasonNumber,episodeType:this.state.episodeType,hideFromFeed:this.state.hideFromFeed,meterType:this.state.meterType})){this.setState({publishing:!1});return}if(!this.state.post){console.error("missing post, cannot publish");return}if(!t){let e=await N().get("/api/v1/drafts/".concat(this.state.post.id,"/prepublish"));if(((null===(p=e.body)||void 0===p?void 0:null===(u=p.suggestions)||void 0===u?void 0:u.length)||(null===(m=e.body)||void 0===m?void 0:null===(h=m.errors)||void 0===h?void 0:h.length))&&(this.setState({prepublishErrors:null===(g=e.body)||void 0===g?void 0:g.errors,prepublishSuggestions:null===(v=e.body)||void 0===v?void 0:v.suggestions}),!this.state.hasShownPrepublishModal||(null===(y=e.body)||void 0===y?void 0:null===(b=y.errors)||void 0===b?void 0:b.length))){(0,U.j)(U.FP.PREPUBLISH_PROMPT_DISPLAYED,{post_id:this.state.post.id,errors:null===(_=e.body)||void 0===_?void 0:_.errors,suggestions:null===(Z=e.body)||void 0===Z?void 0:Z.suggestions}),await this.setHasShownPrepublishModal(!0),this.openPrepublishModal();return}}if(t||i)t?(await N().delete("/api/v1/drafts/".concat(this.state.post.id,"/scheduled_release")),e=N().get("/api/v1/drafts/".concat(this.state.post.id))):e=N().post("/api/v1/drafts/".concat(this.state.post.id,"/scheduled_release")).send((0,f._)({trigger_at:i,post_audience:this.state.audienceToggle,share_automatically:this.shouldShareAutomatically()},this.shouldSendEmail()?{email_audience:this.state.audienceToggle}:{}));else{let t={send:this.shouldSendEmail(),share_automatically:this.shouldShareAutomatically()};e=N().post("/api/v1/drafts/".concat(this.state.post.id,"/publish")).send(t)}let B=Array.from(document.querySelectorAll('div[data-track-inputs="publish-form"] input[data-track-input]'));if(B.length){let e={};for(let t of B){let i=t.getAttribute("type");e[null!==(w=t.getAttribute("data-track-input"))&&void 0!==w?w:"null"]="radio"===i||"checkbox"===i?t.checked:t.value}(0,U.j)(U.FP.POST_PUBLISHED_SETTINGS,(0,f._)({post_id:this.state.post.id,scheduled_at:i},e))}let T=new Set,I=this.props.pub.has_recommendations?await N().get("/api/v1/recommendations/from/".concat(this.props.pub.id)):{body:null},P=(null==I?void 0:I.body)&&I.body.length?I.body.map(e=>e.recommended_publication_id):[];if(P.push(this.props.pub.id),null===(a=this.state.doc)||void 0===a?void 0:a.body)try{let e=JSON.parse(this.state.doc.body).content;if(e){for(let t of e)if("embeddedPublication"===t.type&&t.attrs.id&&!P.includes(t.attrs.id)?T.add(t.attrs.id):"embeddedPost"===t.type&&t.attrs.publication_id&&!P.includes(t.attrs.publication_id)&&T.add(t.attrs.publication_id),T.size>=5)break}}catch(e){console.error("Unable to find embedded posts and publication ids: ",e)}let E=Array.from(T);await (0,Y.IW)(this,{unpublishedChanges:!1});let X=await e;(null===(l=X.body)||void 0===l?void 0:l.audienceSizeLimited)>=5&&(0,U.NA)("conversion",(null===(x=window)||void 0===x?void 0:null===(C=x._analyticsConfig)||void 0===C?void 0:C.adwordsAccountId)&&window._analyticsConfig.adwordsEventSendTo?{send_to:"".concat(window._analyticsConfig.adwordsAccountId,"/").concat("JBo9CK3B6cMDEKuN5pYB")}:{});let{unlockAt:M}=this.state;if(M&&(await N().post("/api/v1/drafts/".concat(this.state.post.id,"/scheduled_release")).send({trigger_at:M,post_audience:"everyone",email_audience:"only_free"}),(0,U.j)(U.FP.STAGED_RELEASE_SCHEDULED,{post_id:this.state.post.id,trigger_at:M})),n){let e=this.state.post.id;await Promise.all(n.map(t=>!t.section_id||!t.date||-1===t.section_id||i&&t.date.getTime()<new Date().getTime()||i&&t.date.getTime()<i.getTime()?null:N().post("/api/v1/restack/republish/".concat(e)).send({scheduledAt:t.date,sectionId:t.section_id})))}if(t)null===(S=this.publishModal)||void 0===S||S.close(),this.setState({post:X.body,scheduledAt:(0,er.getScheduledAt)(X.body),lastScheduledAt:(0,er.getScheduledAt)(X.body),publishing:!1});else if(i){let e;0===E.length?(0,Y.uX)((0,j.fQy)(this.props.pub,X.body.id),{local_navigation:!1}):e=(0,j.QK7)(this.props.pub,{params:{justPublished:!0,embeddedPostPublications:E,scheduledFor:i,audience:this.state.audienceToggle}}),e&&(window.location.href=e)}else if("only_free"===X.body.audience||"adhoc_email"===this.getPostType())(0,Y.uX)((0,j.QK7)(this.props.pub));else if("page"===X.body.type)(0,Y.uX)((0,j.wI3)(this.props.pub,{section:"Pages"}),{local_navigation:!1});else if(X.body.slug){let e;0===E.length?(0,Y.uX)((0,j.fQy)(this.props.pub,X.body.id,{alreadyPublished:null===(k=this.state.post)||void 0===k?void 0:k.is_published}),{local_navigation:!1}):e=(0,j.uRy)(this.props.pub,X.body,{noBase:!0,urlParams:this.state.post.is_published?{}:{justPublished:!0,embeddedPostPublications:E,autoSharedOnTwitter:this.shouldShareAutomatically()}}),e&&(window.location.href=e)}else this.setState({publishing:!1})}catch(t){this.setState({publishing:!1}),console.error("Error publishing: ",t),alert((0,Y.zx)(t,e("There was a network issue. Try again in a bit")))}}),(0,M._)(this,"unpublishPost",async()=>{let{iString:e}=this.getI18NProps();if(!this.state.post){console.warn("missing post, cannot unpublish");return}if(window.confirm(e("Are you sure?")))try{await N().post("/api/v1/drafts/".concat(this.state.post.id,"/unpublish")).send({}),this.setState({post:(0,_._)((0,f._)({},this.state.post),{is_published:!1,postSchedules:[]})}),alert(e("Unpublished!"))}catch(t){console.error("Error publishing: ",t),alert((0,Y.zx)(t,e("There was a network issue. Try again in a bit")))}}),(0,M._)(this,"saveWith",async function(){let{audience:e,audienceBeforeArchived:t,exemptFromArchivePaywall:i,commentLevel:n,commentSort:r,episodeNumber:o,episodeType:a,hideFromFeed:l,isExplicit:s,podcastDescription:c,publishDate:u,seasonNumber:p,shouldSendEmail:h,shouldSendFreePreview:m,showGuestBios:g,slug:v,socialDescription:b,socialImage:y,socialTitle:f,searchTitle:_,searchDescription:Z,syndicateVoiceover:w,syndicateToSectionId:C,shouldSyndicateToOtherFeed:x,teaserPostEligible:S,hasDismissedTkWarning:k,meterType:B}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!d.state.doc||d.state.savingModal)return!1;d.setState({savingModal:!0,saving:!0,savingError:null});try{return await d.saveDocument(d.state.doc,{audience:e,syndicateVoiceover:w,syndicateToSectionId:C,shouldSyndicateToOtherFeed:x,audienceBeforeArchived:t,exemptFromArchivePaywall:i,slug:v,socialTitle:f,socialDescription:b,socialImage:y,searchTitle:_,searchDescription:Z,podcastDescription:c,postDate:u&&u.toJSON(),commentLevel:n,commentSort:r,shouldSendEmail:h,shouldSendFreePreview:m,showGuestBios:g,isExplicit:s,episodeNumber:o,seasonNumber:p,episodeType:a,hideFromFeed:l,teaserPostEligible:S,hasDismissedTkWarning:k,meterType:B}),d.setState({savingModal:!1,saving:!1}),!0}catch(e){return d.setState({savingError:e,savingModal:!1,saving:!1}),console.error("Error saving: ",e),alert((0,Y.zx)(e,"There was a network issue. Try again in a bit")),!1}}),(0,M._)(this,"onEdit",function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{force:!1};if(d.state.isFrozen)return;if(eS()(d.state.doc)){console.warn("missing doc, cannot edit");return}let t=d.debouncedUpdateDocumentState,i=d.state.doc.body;t().then(()=>{let{doc:e,post:t}=d.state;!t||eS()(e)||i===e.body||lz({post_id:null==t?void 0:t.id,draft_updated_at:null==t?void 0:t.draft_updated_at,draft_body:null==e?void 0:e.body,editor_id:d.editorId})}),c().call(d,e)}),(0,M._)(this,"onBylinesAndInvitesChanged",async(e,t)=>{await (0,Y.IW)(this,{doc:(0,_._)((0,f._)({},this.state.doc),{bylines:e,pending_invites:t})}),this.onBylineChange()}),(0,M._)(this,"onSaveFreePodcastUrl",async e=>{var t;let{freePodcastUrl:i}=e;if(!this.state.doc)return{error:null};let n=(0,_._)((0,f._)({},this.state.doc),{free_podcast_url:i});try{await this.saveDocument(n)}catch(e){return{error:(0,Y.zx)(e,"There was a network issue. Try again in a bit")}}let r=i&&!(null===(t=n.videoUpload)||void 0===t?void 0:t.preview_duration);return this.setState((0,f._)({doc:n},r?{pendingAudience:"everyone"}:null),async()=>{r&&await this.continueSettingAudience()}),{error:null}}),(0,M._)(this,"renderBelowSubtitle",()=>{var e,t,i,n,r;return"page"===this.getPostType()?null:(0,Z.tZ)(et.hs,{alignItems:"start",justifyContent:"space-between",children:(0,Z.tZ)(e2,{className:this.props.pub.bylines_enabled?"":"hidden",postId:null===(e=this.state.post)||void 0===e?void 0:e.id,postType:this.getPostType(),bylines:null!==(n=null===(t=this.state.doc)||void 0===t?void 0:t.bylines)&&void 0!==n?n:[],pendingInvites:null!==(r=null===(i=this.state.doc)||void 0===i?void 0:i.pending_invites)&&void 0!==r?r:[],isDisabled:!!this.state.isOffline,onChange:this.onBylinesAndInvitesChanged,setPostId:this.setPostId,scrollContainer:()=>document.getElementsByClassName("editor-scroll")[0]||document.body})})}),(0,M._)(this,"onClickCTA",async()=>{var e;if(this.tkRemindersEnabled()&&this.editorView&&!(null===(e=this.state.post)||void 0===e?void 0:e.has_dismissed_tk_warning)&&0!==this.getTkInlineDecorations().length){this.setShowTkWarningModal(!0);return}"adhoc_email"===this.getPostType()?await this.publishPost():this.openPublishModal()}),(0,M._)(this,"openVideoSettings",()=>{this.setState({isVideoSettingsModalOpen:!0})}),(0,M._)(this,"createConfirmChangeAudienceModal",()=>{let e=this.hasPaywall(),t=this.hasPodcastPreview(),i=this.hasVideoPaywall(),{iString:n}=this.getI18NProps();return(0,Z.tZ)(L.p,{noCloseButton:!0,ref:this.assignConfirmChangeAudienceModalRef,className:"force-light-theme",children:(0,Z.BX)("div",{className:"confirm-audience-modal",children:[(0,Z.tZ)("h4",{children:n("Heads up!")}),(0,Z.tZ)("p",{children:n("founding"===this.state.pendingAudience?"Making this post viewable to founding members only will cause the following:":"Making this post viewable to free subscribers only will cause the following:")}),(0,Z.BX)("ul",{children:[e&&(this.canSendToOnlyFounding()?(0,Z.BX)(ei.xv,{as:"li",translated:!0,children:[(0,Z.tZ)("strong",{children:"The paywall will be removed."})," This is because free users or only founding members will be able to view the post."]}):(0,Z.BX)(ei.xv,{as:"li",translated:!0,children:[(0,Z.tZ)("strong",{children:"The paywall will be removed."})," This is because free users will be able to view the post."]})),i&&(0,Z.BX)(ei.xv,{as:"li",translated:!0,children:[(0,Z.tZ)("strong",{children:"Free video will be removed."})," This is because free listeners will have access to the full video."]}),t&&!i&&(0,Z.BX)(ei.xv,{as:"li",translated:!0,children:[(0,Z.tZ)("strong",{children:"Free audio will be removed."})," This is because free listeners will have access to the full audio."]})]}),(0,Z.BX)("div",{className:"button-wrapper",children:[(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:this.cancelSettingAudience,children:n("Cancel")}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:this.continueSettingAudience,children:n((0,Y.K1)()?"Continue":"Confirm change")})]})]})})}),(0,M._)(this,"settingsModalRef",e=>{this.settingsModal=e}),(0,M._)(this,"publishModalRef",e=>{this.publishModal=e}),(0,M._)(this,"openPublishModal",()=>{var e;this.loadVerifyState(),null===(e=this.publishModal)||void 0===e||e.open()}),(0,M._)(this,"closePublishModal",()=>{var e;null===(e=this.publishModal)||void 0===e||e.close()}),(0,M._)(this,"openPreviewModal",()=>{this.setState({previewModalOpen:!0}),(0,U.j)(U.FP.PREVIEW_BUTTON_CLICKED)}),(0,M._)(this,"closePreviewModal",()=>{this.setState({previewModalOpen:!1})}),(0,M._)(this,"openPrepublishModal",()=>{var e;null===(e=this.prepublishModal)||void 0===e||e.open()}),(0,M._)(this,"closePrepublishModal",function(){var e;let{shouldAppearAgain:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t&&d.setHasShownPrepublishModal(!1),null===(e=d.prepublishModal)||void 0===e||e.close()}),(0,M._)(this,"openSettingsModal",()=>{var e;null===(e=this.settingsModal)||void 0===e||e.open()}),(0,M._)(this,"addPrepublishPaywall",async e=>{var t,i;if((0,U.j)(U.FP.PAYWALL_PROMPT_ACCEPTED,{post_id:null===(t=this.state.post)||void 0===t?void 0:t.id}),(0,Y.iO)("showPublishModal"),this.setState({showPublishModal:!1,publishing:!1}),e)try{await N().put("/api/v1/user-setting").send({type:"prepublish_paywall_prompt_hidden",value_bool:!0})}catch(e){}(null===(i=this.editorView)||void 0===i?void 0:i.state)&&(0,l$.Er)(this.editorView.state)&&(0,l$.LC)(this.setPostPaidForPaywall)(this.editorView.state,this.editorView.dispatch),this.closePrepublishModal({shouldAppearAgain:(0,oo.HD)({pub:this.props.pub})}),this.closePublishModal()}),(0,M._)(this,"addVoiceover",async()=>{var e,t;(0,Y.iO)("showPublishModal"),this.setState({showPublishModal:!1,publishing:!1}),null===(e=(t=this.props).setIsDrawerOpen)||void 0===e||e.call(t,{drawerId:"voiceover",isOpen:!0}),this.closePrepublishModal({shouldAppearAgain:(0,oo.HD)({pub:this.props.pub})}),this.closePublishModal()}),(0,M._)(this,"addPrepublishSubscribeCta",async e=>{var t,i;if((0,U.j)(U.FP.SUBSCRIBE_CTA_PROMPT_ACCEPTED,{post_id:null===(t=this.state.post)||void 0===t?void 0:t.id}),(0,Y.iO)("showPublishModal"),this.setState({showPublishModal:!1,publishing:!1}),e)try{await N().put("/api/v1/user-setting").send({type:"prepublish_subscribe_cta_prompt_hidden",value_bool:!0})}catch(e){}(null===(i=this.editorView)||void 0===i?void 0:i.state)&&(0,lQ.R_)(this.props.pub)(this.editorView.state,this.editorView.dispatch),this.closePrepublishModal(),this.closePublishModal()}),(0,M._)(this,"addPrepublishSendAsEmail",async e=>{var t;if((0,U.j)(U.FP.SEND_AS_EMAIL_PROMPT_ACCEPTED,{post_id:null===(t=this.state.post)||void 0===t?void 0:t.id}),(0,Y.iO)("showPublishModal"),this.setState({showPublishModal:!1,publishing:!1,dontSendEmail:!this.canSendEmail()}),e)try{await N().put("/api/v1/user-setting").send({type:"prepublish_send_as_email_prompt_hidden",value_bool:!0})}catch(e){}this.closePrepublishModal()}),(0,M._)(this,"rejectPrepublishChanges",async(e,t)=>{var i;let n="MISSING_SUBSCRIBE_CTA"===t?U.FP.SUBSCRIBE_CTA_PROMPT_REJECTED:"MISSING_PAYWALL"===t?U.FP.PAYWALL_PROMPT_REJECTED:U.FP.SEND_AS_EMAIL_PROMPT_REJECTED;if((0,U.j)(n,{post_id:null===(i=this.state.post)||void 0===i?void 0:i.id}),e)try{await N().put("/api/v1/user-setting").send({type:"MISSING_SUBSCRIBE_CTA"===t?"prepublish_subscribe_cta_prompt_hidden":"MISSING_PAYWALL"===t?"prepublish_paywall_prompt_hidden":"prepublish_send_as_email_prompt_hidden",value_bool:!0})}catch(e){}this.closePrepublishModal(),await this.publishPost()}),(0,M._)(this,"setHeadlineTest",e=>{this.setState({headlineTest:e})}),this.editorId=new Date().getTime(),this._onVisibilityChange=this.onVisibilityChange,this.allowCommentsButton=!0,this.allowPostShareButton=!0,this.previewModalRef=(0,w.createRef)(),this.state={loaded:!1,pendingUploads:0,audienceBeforeArchived:null!==(l=null===(n=this.props)||void 0===n?void 0:null===(i=n.post)||void 0===i?void 0:i.audience_before_archived)&&void 0!==l?l:null,dontSendEmail:!this.props.pub.default_post_publish_send_email,hasPendingImports:!1,hasShownPrepublishModal:!1,hideSharePostAndComment:!1,passVerify:null,prepublishErrors:[],prepublishSuggestions:[],scheduledAt:null,section_chosen:!1,section_id:null,sendFreePreviewToggle:!0,teaserPostEligibleToggle:!0,shareAutomatically:this.props.pub.twitter_share_on_publish_opt_in&&"write"===this.props.pub.twitter_permissions,slugDraft:null,unlockAt:null,showWriterReferralExplainer:this.props.showWriterReferralExplainer,podcastMediaType:"audio",previewModalOpen:!1,isVideoSettingsModalOpen:!1,headlineTest:void 0,meterType:null!==(s=null===(o=this.props)||void 0===o?void 0:null===(r=o.post)||void 0===r?void 0:r.meter_type)&&void 0!==s?s:"none"},(null===(a=this.props.pub.sections)||void 0===a?void 0:a.length)>0&&(this.state.section_id=this.props.sectionId?Number(this.props.sectionId):null,this.state.section_chosen=!1),"undefined"==typeof window)return;this.state.isOffline=!window.navigator.onLine}}(0,M._)(st,"contextType",tV.WH);let si=e=>(0,Z.tZ)(t1.DQ,{drawerIds:["podcast","videoEmbed","audioEmbed"],children:(0,Z.tZ)(t1.rf.Consumer,{children:t=>{let{openDrawerId:i,setInitialTab:n,setIsDrawerOpen:r}=t;return(0,Z.tZ)(st,(0,_._)((0,f._)({},e),{openDrawerId:i,setInitialDrawerTab:n,setIsDrawerOpen:r}))}})});var sn=i(59480),sr=i(80026),so=i(5515),sa=i(95325),sl=i(7617),ss=i(56629);let sd="undefined"!=typeof window;function sc(e,t){var i;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sd?localStorage:void 0,[r,o]=(0,A.eJ)(void 0!==n&&null!==(i=n.getItem(e))&&void 0!==i?i:t);return[r,t=>{o(i=>{let r="function"==typeof t?t(i):t;return n&&n.setItem(e,r),r})}]}var su=i(95901);let sp=(0,sr.zo)({bg:"primary",radius:"md",color:"primary",sizing:"border-box"},sr.sg),sh=(0,sr.zo)({bg:"primary",border:"detail",padding:20,gap:20,radius:"lg",shadow:"xl",maxWidth:400,sizing:"border-box",textAlign:"center"},sr.sg);var sm=i(62515);let sg={activeChecklistItem:"activeChecklistItem-z8f6jl"};function sv(){let{iString:e}=(0,Q.M1)(),[t,i]=sc("chatChecklistHidden","false","undefined"!=typeof sessionStorage?sessionStorage:void 0);return"true"===t?(0,Z.tZ)(sr.M5,{children:(0,Z.tZ)(sr.zx,{priority:"secondary-outline",onClick:()=>i("false"),children:e("Show tips")})}):(0,Z.tZ)(sb,{onClose:()=>i("true")})}function sb(e){let{onClose:t}=e;return(0,Z.BX)(s_,{children:[(0,Z.BX)(sr.M5,{position:"relative",height:56,sizing:"border-box",borderBottom:"detail",justifyContent:"space-between",paddingX:12,children:[(0,Z.tZ)(sr.xu,{width:32}),(0,Z.tZ)(sr.xv.B3,{weight:"semibold",translated:!0,children:"Getting started tips"}),(0,Z.tZ)(su.h,{priority:"tertiary",onClick:t})]}),(0,Z.tZ)(sr.sg,{padding:8,children:(0,Z.tZ)(sy,{})})]})}function sy(){let{iString:e}=(0,Q.M1)(),t=(0,re.aF)(),i=(0,eq.u0)(),n=(0,ss.So)();return(0,Z.BX)(sr.sg,{children:[(0,Z.tZ)(sf,{isComplete:!0,Icon:nA.Z,title:e("Create your chat")}),(0,Z.tZ)(sf,{Icon:so.Z,title:e("Get the Substack app"),subtitle:e("We recommend using the app to chat."),isComplete:!!(null==t?void 0:t.reader_installed_at),href:(0,j.tSX)(),newTab:!0,onClick:()=>(0,U.j)(U.FP.CHAT_CHECKLIST_GET_APP_CLICKED)}),(0,Z.tZ)(sf,{Icon:sa.Z,title:e("Tell your subscribers"),subtitle:e("Send an email inviting your subscribers to join."),isComplete:!!n.getSettingFor("chat_invite_email_sent_at"),onClick:()=>{(0,U.j)(U.FP.CHAT_CHECKLIST_USE_TEMPLATE_CLICKED),n.changeSetting({chat_invite_email_sent_at:new Date().toISOString()})}}),(0,Z.tZ)(sf,{Icon:sl.Z,title:e("Send the first message"),subtitle:e("Kick off the conversation with a quick hello!"),href:(0,sm.aD)(i.id,{urlParams:{action:"new-thread"}}),isComplete:!!i.last_chat_post_at,newTab:!0,onClick:()=>{(0,U.j)(U.FP.CHAT_START_CHAT_THREAD_CLICKED)}})]})}function sf(e){let{isComplete:t,Icon:i,title:n,subtitle:r,href:o,newTab:a,onClick:l}=e,[s,d]=(0,A.eJ)(t);return(0,Z.BX)(sr.X2,{as:"a",className:s?void 0:sg.activeChecklistItem,radius:"md",paddingX:12,paddingY:12,gap:12,alignItems:"center",href:s?void 0:o,target:a?"_blank":void 0,onClick:()=>{null==l||l(),setTimeout(()=>{d(!0)},100)},children:[(0,Z.tZ)(sr.M5,{bg:s?void 0:"secondary",width:32,height:32,radius:"sm",border:s?"detail":"transparent",sizing:"border-box",children:(0,Z.tZ)(i,{size:20,stroke:s?"var(--color-fg-tertiary)":"var(--color-fg-primary)"})}),(0,Z.BX)(sr.sg,{flex:"grow",minWidth:0,font:"text",children:[(0,Z.tZ)(sr.xv,{fontSize:13,lineHeight:16,weight:"semibold",color:s?"tertiary":"primary",children:n}),r&&(0,Z.tZ)(sr.xv,{fontSize:11,lineHeight:16,color:s?"tertiary":"secondary",children:r})]}),(0,Z.tZ)(sr.hU,{priority:"tertiary",disabled:s,children:s?(0,Z.tZ)(eE.Z,{}):(0,Z.tZ)(ez.Z,{})})]})}let s_=(0,sr.zo)({shadow:"xs"},sp);var sZ=i(40514),sw=i(24840),sC=i(10510),sx=i(63474),sS=i(31065),sk=i(43681);function sB(){let e=(0,eq.u0)(),{iString:t}=(0,Q.M1)(),i=(0,sk.wg)({variant:"menu",url:(0,sm.aD)(e.id)}),n={size:24,stroke:"var(--color-fg-primary)"};return(0,Z.BX)(sT,{children:[(0,Z.tZ)(sr.M5,{children:(0,Z.tZ)(sI,{pub:e,children:(0,Z.tZ)(sC.wk,{pub:e,size:80})})}),(0,Z.tZ)(sr.sg,{gap:4,textAlign:"center",children:(0,Z.BX)(sI,{pub:e,children:[(0,Z.BX)(sr.xv.B1,{weight:"semibold",children:[e.name," Chat"]}),(null==e?void 0:e.last_chat_post_at)&&(0,Z.BX)(sr.xv.B3,{color:"secondary",children:["Active ",function(e){if(!sN)return"recently";let t=Date.now()-new Date(e).getTime();for(let{unit:e,amount:i}of[{unit:"years",amount:31536e6},{unit:"months",amount:2592e6},{unit:"weeks",amount:6048e5},{unit:"days",amount:864e5},{unit:"hours",amount:36e5},{unit:"minute",amount:6e4},{unit:"second",amount:1e3}]){let n=Math.floor(t/i);if(n>0)return sN.format(-n,e)}return"just now"}(e.last_chat_post_at)]})]})}),(0,Z.BX)(sr.X2,{gap:20,justifyContent:"center",children:[(0,Z.tZ)(sS.X,{label:t("Thread"),icon:(0,Z.tZ)(sZ.Z,(0,f._)({},n)),href:(0,sm.aD)(e.id,{urlParams:{action:"new-thread"}})}),(0,Z.tZ)(sS.X,{label:t("Search"),icon:(0,Z.tZ)(sw.Z,(0,f._)({},n)),href:(0,sm.aD)(e.id,{urlParams:{action:"search"}})}),(0,Z.tZ)(tC.v2,{trigger:e=>{var{ref:i}=e,r=(0,ef._)(e,["ref"]);return(0,Z.tZ)(sS.X,(0,f._)({forwardRef:i,label:t("Share"),icon:(0,Z.tZ)(nE.Z,(0,f._)({},n))},r))},children:i}),(0,Z.tZ)(sS.X,{label:t("Settings"),icon:(0,Z.tZ)(eD.Z,(0,f._)({},n)),href:(0,en.wI3)(e,{addBase:!0,section:"chat-settings"})})]}),(0,Z.tZ)(sr.zx,{size:"lg",href:(0,sm.aD)(e.id,{noBase:!1}),newTab:!0,children:"View chat"})]})}let sT=(0,sr.zo)({padding:20,gap:16},sp);function sI(e){let{pub:t,children:i}=e;return(0,Z.tZ)(sx.A0,{href:(0,sm.aD)(t.id),target:"_blank",children:i})}let sN=void 0!==Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{style:"short"}):null;function sP(){return(0,Z.BX)(sr.sg,{gap:12,maxWidth:440,flex:"grow",children:[(0,Z.tZ)(sB,{}),(0,Z.tZ)(sv,{})]})}var sE=i(57989),sX=i(84923);function sM(){let{iString:e}=(0,Q.M1)(),t=sA();return(0,Z.BX)(sh,{children:[(0,Z.tZ)(sr.M5,{children:(0,Z.tZ)(iZ.e,{src:"/img/publish/empty-chat.png",maxWidth:120,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,Z.BX)(sr.sg,{gap:4,children:[(0,Z.tZ)(sr.xv.H4,{color:"primary",translated:!0,children:"Start your subscriber chat"}),(0,Z.tZ)(sr.xv.B4,{color:"secondary",translated:!0,children:"Create a space for you and your subscribers to hang out. Open it to everyone or keep it paid-only."})]}),(0,Z.tZ)(sr.zx,{onClick:t.open,children:e("Create chat")}),t.element]})}function sA(){let{onSuccess:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,sX.d)();return{element:(0,Z.tZ)(eK.u_,(0,_._)((0,f._)({},t),{width:400,children:(0,Z.tZ)(sD,{onClose:t.onClose,onSuccess:e})})),open:t.onOpen}}function sD(e){var t,i,n;let{onClose:r,onSuccess:o}=e,{iString:a}=(0,Q.M1)(),{pub:l,publication:s,setPublication:d}=ey(),c=!!(null===(t=l.plans)||void 0===t?void 0:t.length),[u,p]=(0,A.eJ)({paywall:c?"paid":"free_subscriber"});if(!l)throw Error("Trying to show ChatCreationDialog on non-pub surface.");let{refetch:h,isLoading:m}=(0,iS.ib)({method:"POST",pathname:"/api/v1/publication/".concat(l.id,"/publication_threads_settings"),json:{threads_v2_enabled:!0,create_thread_minimum_role:u.paywall,reader_thread_notifications_enabled:null===(n=null===(i=l.threads_v2_settings)||void 0===i?void 0:i.reader_thread_notifications_enabled)||void 0===n||n},auto:!1}),g=async e=>{e.preventDefault();let t=await h();t instanceof Error||(d({pub:(0,_._)((0,f._)({},l),{threads_v2_enabled:t.threads_v2_enabled,threads_v2_settings:(0,f._)({},l.threads_v2_settings,t)}),publication:s}),null==o||o(t),r())};return(0,Z.BX)(sr.sg,{color:"primary",children:[(0,Z.tZ)(sr.M5,{borderBottom:"detail",paddingY:12,children:(0,Z.tZ)(sr.xv.B3,{weight:"semibold",translated:!0,children:"Create your chat"})}),(0,Z.BX)(sr.sg,{gap:20,padding:20,children:[(0,Z.tZ)(sr.M5,{children:l&&(0,Z.tZ)(sC.wk,{pub:l})}),(0,Z.BX)(sr.sg,{as:"form",gap:20,onSubmit:g,children:[(0,Z.BX)(sr.sg,{as:"label",gap:8,children:[(0,Z.tZ)(sr.xv.B4,{weight:"semibold",translated:!0,children:"Who can start conversations?"}),(0,Z.tZ)(sE.G,{value:u.paywall,options:[{label:a("Everyone"),value:"free_subscriber"},...c?[{label:a("Paid subscribers"),value:"paid"},{label:a("Founding members"),value:"founding"}]:[]],onChange:e=>p(t=>(0,_._)((0,f._)({},t),{paywall:e}))})]}),(0,Z.BX)(sr.X2,{justifyContent:"end",gap:12,children:[(0,Z.tZ)(sr.zx,{priority:"secondary",onClick:e=>{e.preventDefault(),r()},disabled:m,children:a("Cancel")}),(0,Z.tZ)(sr.zx,{type:"submit",disabled:m,children:a("Create")})]})]})]})]})}function sR(e){let{}=e,t=(0,eq.Ij)();return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(sr.M5,{flex:"grow",padding:20,bg:"primary-hover",children:(null==t?void 0:t.threads_v2_enabled)?(0,Z.tZ)(sP,{}):(0,Z.tZ)(sM,{})})})}var sF=i(89734),sL=i.n(sF);function sz(){let e=(0,G._)(["Download ",""]);return sz=function(){return e},e}function sO(){let e=(0,G._)(["Generated ",""]);return sO=function(){return e},e}let sU=e=>{var t;let{doc:i,highlighted:n}=e,{iString:r,iTemplate:o,language:a}=(0,Q.M1)();return(0,Z.BX)("div",{className:k()("document-row",{highlighted:i.id===n}),children:[(0,Z.tZ)("div",{className:"description",children:i.description}),i.finished_at?(0,Z.BX)(w.Fragment,{children:[(0,Z.tZ)("a",{href:"/api/v1/document_export/".concat(i.id,"/file"),target:"_blank",native:!0,children:o(sz(),null!==(t=i.display_name)&&void 0!==t?t:"")}),(0,Z.tZ)("div",{className:"doc-info",children:o(sO(),(0,H.Z)(i.finished_at).locale(a).format("MMM D YYYY"))})]}):(0,Z.tZ)("div",{className:"doc-info",children:r("Your document is currently being generated...")})]})},sY=eb(e=>{let{id:t,path:i}=e,[n,r]=(0,A.eJ)(null),[o,a]=(0,A.eJ)(0),[l,s]=(0,A.eJ)(),{iString:d}=(0,Q.M1)();return(0,A.d4)(()=>{!l&&!(o>=15)&&N().get("/api/v1/document_export").then(e=>{let i=sL()(e.body,e=>+(e.id!==t));r(i),i.find(e=>!e.finished_at)&&setTimeout(()=>{a(o+1)},1e3)}).catch(e=>{alert((0,Y.zx)(e)),s(e)})},[t,o,l]),(0,Z.tZ)("section",{className:"page typography document-export-page",id:"settings",children:(0,Z.BX)("div",{className:"container",children:[(0,Z.tZ)("h3",{children:d("Document Downloads")}),(0,Z.tZ)("p",{children:d("This page shows documents which you've requested from Substack and any other documents that Substack has generated on your behalf.")}),(0,Z.tZ)("div",{className:"row-list",children:null==n?void 0:n.map(e=>(0,Z.tZ)(sU,{doc:e,highlighted:t}))}),null===n&&(0,Z.tZ)("div",{className:"header-info",children:d("Loading...")}),(null==n?void 0:n.length)===0&&(0,Z.tZ)("div",{className:"header-info",children:d("You don't have any document exports ready for download.")})]})})}),sH="3.231.35.217",sj="https://support.substack.com/hc/en-us/articles/360051222571-How-do-I-set-up-my-custom-domain-",sJ={google:{name:"Google",link:"https://support.google.com/domains/answer/3290350?hl=en"},godaddy:{name:"GoDaddy",link:"http://godaddy.com/help/add-a-cname-record-19236"},namecheap:{name:"Namecheap",link:"https://www.namecheap.com/support/knowledgebase/article.aspx/9646/2237/how-to-create-a-cname-record-for-your-domain/"},domain:{name:"Domain.com",link:"https://www.domain.com/help/article/dns-management-how-to-update-cname-aliases"},dreamhost:{name:"Dreamhost",link:"https://help.dreamhost.com/hc/en-us/articles/360035516812-Adding-custom-DNS-records"},bluehost:{name:"BlueHost",link:"https://my.bluehost.com/hosting/help/resource/714"},hover:{name:"Hover",link:"https://help.hover.com/hc/en-us/articles/217282457-Managing-DNS-records-#h_5eab4aa7-b044-4cc6-a3c0-5869f583edc8"},dynadot:{name:"Dynadot",link:"https://www.dynadot.com/community/help/question/create-CNAME"}},sV={CNAME:"CNAME",A:"A",target:"target.substack-custom-domains.com."},sq=e=>{let{nameserver:t}=e;if(!sJ[t])return null;let{name:i,link:n}=sJ[t];return(0,Z.BX)(ei.xv,{translated:!0,className:"text",children:["View the help documentation for adding a ",(0,Z.BX)("a",{href:n,children:["DNS record for ",I18N.p(i)]})]})},sW=e=>{let{domain:t,apexRedirect:i,hideCname:n,isValid:r}=e,{iString:o}=(0,Q.M1)();if(!t)return null;let a=(0,en.Y3R)(t),l=(0,en.UdV)(t);return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)("table",{className:"custom domain-records",children:[(0,Z.tZ)("thead",{children:(0,Z.BX)("tr",{children:[(0,Z.tZ)("th",{children:o("Record Type")}),(0,Z.tZ)("th",{children:o("Name/Host")}),(0,Z.tZ)("th",{children:o("Target/Value")})]})}),(0,Z.BX)("tbody",{children:[i&&(0,Z.BX)("tr",{children:[(0,Z.tZ)("td",{children:sV.A}),(0,Z.tZ)("td",{children:"@"}),(0,Z.tZ)("td",{children:sH})]}),!n&&(0,Z.BX)("tr",{children:[(0,Z.tZ)("td",{children:sV.CNAME}),(0,Z.tZ)("td",{children:l}),(0,Z.tZ)("td",{children:sV.target})]})]})]}),a&&r&&(0,Z.tZ)("div",{className:"container www-notice",children:(0,Z.BX)(ei.xv,{translated:!0,className:"text-mini wide",children:[(0,Z.tZ)("b",{children:"Note:"})," You are using a root domain without â€˜www.â€™ Some providers support using a â€˜CNAMEâ€™ for this, but it may also be called â€˜ALIASâ€™ or â€˜ANAMEâ€™."," ",(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us/articles/360051222691",children:"Learn more"}),"."]})})]})},sG=e=>{let{nameserver:t}=e,{iString:i}=(0,Q.M1)();if("cloudflare"!==t)return null;let n=(0,en.zF4)("/img/publish/cloudflare-proxy.gif",230);return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.H4,{translated:!0,paddingTop:16,children:"Cloudflare proxy status"}),(0,Z.tZ)(ei.xv,{translated:!0,className:"text",children:"When adding your DNS record, turn off the DNS proxy setting. You can do this by clicking the orange cloud icon in the Cloudflare dashboard:"}),(0,Z.tZ)("div",{className:"cloudflare-proxy-gif",children:(0,Z.tZ)("img",{src:n,alt:i("Cloudflare proxy")})})]})},sK=e=>{let{cnameStatus:t,apexStatus:i,hasCheckedStatus:n,hasApexDomain:r}=e,{iString:o}=(0,Q.M1)();if(!n)return null;let a=r?(null==t?void 0:t.status)==="ok"&&(null==i?void 0:i.status)==="ok":(null==t?void 0:t.status)==="ok";return(0,Z.tZ)("div",{className:"custom-domain-status-message",children:(0,Z.BX)(Z.HY,{children:[a&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.H2,{translated:!0,paddingTop:16,children:"Good news!"}),(0,Z.tZ)(ei.xv,{translated:!0,className:"text",paddingBottom:16,children:"Your DNS records look good from our end. Our system will do a few more checks and your new domain will become active soon."}),(0,Z.tZ)(ei.xv,{translated:!0,className:"text",paddingBottom:16,children:"You will get an email when your domain becomes active."})]}),n&&(null==t?void 0:t.status)!=="ok"&&(0,Z.tZ)(ei.xv.H4,{paddingTop:16,paddingBottom:6,children:o((null==t?void 0:t.status)==="unknown"?"Domain not ready":"There's an issue with your CNAME record")}),(null==t?void 0:t.status)==="no_cname"&&(0,Z.tZ)(ei.xv,{translated:!0,className:"text",paddingBottom:12,children:"It looks like there isn't a CNAME added to this domain. Use the above instructions for adding a CNAME for your custom domain."}),(null==t?void 0:t.status)==="wrong_target"&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv,{translated:!0,className:"text",paddingBottom:6,children:"The target/value of your DNS record is incorrect."}),(0,Z.BX)(ei.xv,{translated:!0,className:"text custom-domain-status-value",paddingBottom:6,children:["You have: ",(0,Z.tZ)("strong",{children:I18N.p(t.wrongValue||"")})]}),(0,Z.BX)(ei.xv,{translated:!0,className:"text custom-domain-status-value",paddingBottom:6,children:["It should be: ",(0,Z.tZ)("strong",{children:I18N.p(sV.target)})]})]}),(null==t?void 0:t.status)==="unknown"&&(0,Z.tZ)(ei.xv,{translated:!0,className:"text",children:"Your domain isn't ready yet. This can take up to 36 hours while the DNS records update."}),(null==t?void 0:t.status)==="error"&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.H4,{translated:!0,paddingTop:16,paddingBottom:6,children:"Unable to check domain"}),(0,Z.tZ)(ei.xv,{translated:!0,className:"text",children:"There was an error checking the status of your domain. Please try again later."})]})]})})},sQ=e=>{let{apexStatus:t,hasCheckedStatus:i,hide:n,isShowingCnameTroubleshooting:r}=e;if(!i||n)return null;let o=!r&&(null==t?void 0:t.status)==="ok";return(0,Z.BX)("div",{className:"custom-domain-status-message",children:[o&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.H2,{translated:!0,paddingTop:16,children:"Good news!"}),(0,Z.tZ)(ei.xv,{translated:!0,className:"text",paddingBottom:16,children:"Your DNS records look good from our end. Our system will do a few more checks to make sure the root domain redirects work correctly. This may take an hour or two but your redirects will start working after that."})]}),(0,Z.BX)(Z.HY,{children:[i&&(null==t?void 0:t.status)!=="ok"&&(0,Z.tZ)(ei.xv.H4,{translated:!0,className:"text",paddingTop:16,paddingBottom:8,children:"There's an issue with your A root domain record"}),(null==t?void 0:t.status)==="no_record"&&(0,Z.tZ)(ei.xv,{translated:!0,className:"text",children:"It looks like there isn't an A record added to this domain. Use the above instructions for adding an A record for your custom domain."}),(null==t?void 0:t.status)==="multiple_records"&&(0,Z.tZ)(ei.xv,{translated:!0,className:"text",children:"It looks like there are multiple A records added to this domain. Use the above instructions for adding the correct record for your custom domain."}),(null==t?void 0:t.status)==="aaaa_record"&&(0,Z.tZ)(ei.xv,{translated:!0,className:"text",children:"It looks like there are AAAA records added to this domain. In order for your root domain to work correctly, you need to remove all of these AAAA records."}),(null==t?void 0:t.status)==="wrong_value"&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv,{translated:!0,className:"text",paddingBottom:6,children:"The target/value of your DNS record is incorrect."}),(0,Z.BX)(ei.xv,{translated:!0,className:"text custom-domain-status-value",paddingBottom:6,children:["You have: ",(0,Z.tZ)("strong",{children:I18N.p(t.wrongValue||"")})]}),(0,Z.BX)(ei.xv,{translated:!0,className:"text custom-domain-status-value",paddingBottom:6,children:["It should be: ",(0,Z.tZ)("strong",{children:I18N.p(sH)})]})]}),(null==t?void 0:t.status)==="unknown"&&(0,Z.tZ)(ei.xv,{translated:!0,className:"text",children:"There was an unknown issue checking your DNS records. Please try again later."})]})]})},s$=eb(e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(""),o=async e=>{let t;try{t=(await N().post("/api/v1/domains/validation").send({domain:e})).body}catch(e){t=e.response.body}r(t.nameserver)};return(0,A.d4)(()=>{o(t.custom_domain)},[t.custom_domain]),(0,Z.tZ)("section",{className:"page typography custom-domain-page",id:"settings",children:(0,Z.tZ)("div",{className:"container",children:(0,Z.BX)("div",{className:"domain-config",children:[(0,Z.tZ)("h1",{children:i("Setup root domain redirects")}),(0,Z.BX)(tP.ZP,{analyticsName:"Custom Domain Config",className:"new-form domain-config",action:"/api/v1/domains/redirects",autoLock:!0,onSuccess:()=>(0,Y.uX)((0,j.b_Y)(),{local_navigation:!1}),onError:e=>{console.error(e),alert("Something went wrong")},children:[(0,Z.tZ)("input",{type:"hidden",name:"enabled",value:"true"}),(0,Z.tZ)("div",{className:"domain-entry",children:(0,Z.tZ)(ei.xv,{translated:!0,className:"text",children:"Would you like to automatically redirect from your root domain to your custom domain? This means when you go to your custom domain without the www, you will be redirected to your custom domain with the www."})}),(0,Z.BX)("div",{className:"domain-entry",children:[(0,Z.tZ)("h2",{children:i("Add the DNS record in your DNS provider")}),(0,Z.tZ)("p",{className:"text",children:i("Go to your DNS provider and the following DNS records by copying the exact settings listed below.")}),(0,Z.tZ)(sq,{nameserver:n})]}),(0,Z.tZ)("div",{className:"domain-entry",children:(0,Z.tZ)(sW,{domain:t.custom_domain,isValid:!0,apexRedirect:!0,hideCname:!0})}),(0,Z.BX)(ei.xv,{translated:!0,as:"p",className:"text",paddingBottom:16,children:["Learn more about custom domains ",(0,Z.tZ)("a",{href:sj,children:"in our help center"}),"."]}),(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",children:i("Setup root domain redirects")})]})]})})})}),s0=eb(e=>{var t;let{pub:i}=e,{iString:n}=(0,Q.M1)(),[r,o]=(0,A.eJ)(""),[a,l]=(0,A.eJ)(void 0),[s,d]=(0,A.eJ)(!1),[c,u]=(0,A.eJ)(!1),p=async()=>{try{let{body:{nameserver:e}}=await N().post("/api/v1/domains/validation").send({domain:i.custom_domain});o(e)}catch(i){var e,t;o(null===(t=i.response)||void 0===t?void 0:null===(e=t.body)||void 0===e?void 0:e.nameserver)}};(0,A.d4)(()=>{p()});let h=async()=>{u(!0);try{let e=await N().post("/api/v1/domains/redirects-status");d(!0),l(e.body)}catch(e){l({status:"error"})}finally{u(!1)}};return(0,Z.tZ)("section",{className:"page typography custom-domain-page",id:"settings",children:(0,Z.tZ)("div",{className:"container",children:(0,Z.BX)("div",{className:"domain-config",children:[(0,Z.tZ)("h1",{children:n("Root domain redirects status")}),(0,Z.tZ)("div",{className:"domain-entry",children:(0,Z.BX)(ei.xv,{translated:!0,className:"text",children:["The domain you have configured is: ",(0,Z.tZ)("strong",{children:I18N.p(null!==(t=i.custom_domain)&&void 0!==t?t:"")})]})}),(0,Z.BX)("div",{className:"domain-entry",children:[(0,Z.tZ)("h2",{children:n("Check your DNS records")}),(0,Z.tZ)("p",{className:"text",children:n("Go to your DNS provider and the following DNS records by copying the exact settings listed below.")}),(0,Z.tZ)(sq,{nameserver:r})]}),(0,Z.tZ)("div",{className:"domain-entry",children:(0,Z.tZ)(sW,{domain:i.custom_domain,isValid:!0,apexRedirect:!0,hideCname:!0})}),(0,Z.BX)(ei.xv,{translated:!0,as:"p",className:"text",paddingBottom:16,children:["Learn more about root domain redirects ",(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us/articles/360051222691-Can-I-use-my-root-domain-without-www-or-another-subdomain-on-Substack",children:"in our help center"}),"."]}),(0,Z.tZ)(sG,{nameserver:r}),(0,Z.tZ)(sQ,{hasCheckedStatus:s,apexStatus:a}),(null==a?void 0:a.status)!=="ok"&&(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",disabled:c,onClick:h,children:n("Check status")}),(null==a?void 0:a.status)==="ok"&&(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",onClick:()=>{(0,Y.uX)((0,j.wI3)(i,{section:"domain"}),{local_navigation:!1})},children:n("Done")})]})})})});var s1=i(55065);let s2=e=>{let{error:t}=e,{iString:i}=(0,Q.M1)();return 0===t?(0,Z.tZ)("p",{className:"custom-domain-form-sub-text invalid",children:i("This is not a valid domain name.")}):1===t?(0,Z.tZ)("p",{className:"custom-domain-form-sub-text invalid",children:i("This domain is not registered.")}):null},s4=eb(e=>{let{pub:t,domainSetupState:i}=e,{iString:n}=(0,Q.M1)();(0,A.d4)(()=>{i||(t.custom_domain?(0,Y.uX)((0,j.wI3)(t),{local_navigation:!1}):(0,Y.uX)((0,j.Ul)(t,{payment:!0}),{local_navigation:!1}))},[i,t.custom_domain,t]);let[r,o]=(0,A.eJ)(""),[a,l]=(0,A.eJ)(!1),[s,d]=(0,A.eJ)(!1),[c,u]=(0,A.eJ)(null),[p,h]=(0,A.eJ)(""),m=async e=>{if(""===e)l(!1),u(null),h("");else{var t;let i;try{let t=await N().post("/api/v1/domains/validation").send({domain:e});l(!0),i=t.body}catch(e){l(!1),i=e.response.body}h(i.nameserver),(null===(t=i.errors)||void 0===t?void 0:t.find(e=>"domain"===e.param))?u(0):u(null)}},g=(0,A.I4)(ip()(m,500),[r]);return(0,A.d4)(()=>(g(r),g.cancel),[r,g]),(0,Z.tZ)("section",{className:"page typography custom-domain-page",id:"settings",children:(0,Z.BX)("div",{className:"container",children:[(0,Z.tZ)("h1",{children:n("Set up your domain")}),(0,Z.BX)(tP.ZP,{analyticsName:"Custom Domain Config",className:"new-form domain-config",action:"/api/v1/domains",autoLock:!0,onSuccess:()=>(0,Y.uX)((0,j.gSe)(),{local_navigation:!1}),onError:e=>{console.error(e),alert("Something went wrong")},children:[(0,Z.BX)("div",{className:"domain-entry",children:[(0,Z.tZ)("p",{className:"text",children:(0,Z.tZ)("b",{children:n("What is your domain?")})}),(0,Z.tZ)("label",{htmlFor:"hostname",className:"text",children:n("The host name you want to use")}),(0,Z.BX)("div",{className:"custom-domain-input",children:[(0,Z.tZ)("input",{type:"text",className:"wide",name:"hostname",placeholder:"www.yourdomain.com",value:r,onInput:()=>{l(!1),o(event.target.value)}}),(0,Z.tZ)("div",{className:"custom-domain-form-icon-wrapper",children:!c&&a?(0,Z.tZ)(s1.Z,{className:"status-icon valid"}):c?(0,Z.tZ)(K.Z,{className:"status-icon invalid"}):null})]}),(0,Z.tZ)(s2,{error:c})]}),a&&!(0,en.Y3R)(r)&&(0,Z.BX)("div",{className:"domain-entry",children:[(0,Z.tZ)("p",{className:"text",children:(0,Z.tZ)("b",{children:n("Root domain redirects")})}),(0,Z.tZ)("p",{className:"text",children:(0,Z.BX)(ei.xv,{translated:!0,as:"p",className:"text",children:["Would you like to automatically redirect from your root domain to your custom domain? For example, if you go to ",I18N.p("https://".concat((0,en.GTk)(r))),", would you like to be redirected to"," ",I18N.p("https://".concat(r)),"?"]})}),(0,Z.tZ)(ic.p,{name:"apex_redirect",className:"custom-domain-apex",checked:s,onChange:()=>d(!s),info:n("Enable root domain redirects for your custom domain")})]}),(0,Z.BX)("div",{className:"domain-entry",children:[(0,Z.tZ)("p",{className:"text",children:(0,Z.tZ)("b",{children:n("Add the DNS record in your DNS provider")})}),(0,Z.tZ)("p",{className:"text",children:n("Go to your DNS provider and create the following DNS records by copying the exact settings listed below.")}),(0,Z.tZ)(sq,{nameserver:p})]}),(0,Z.tZ)("div",{className:"domain-entry",children:(0,Z.tZ)(sW,{domain:r,apexRedirect:s,isValid:a})}),(0,Z.BX)(ei.xv,{translated:!0,as:"p",className:"text",children:["Learn more about custom domains ",(0,Z.tZ)("a",{href:sj,children:"in our help center"}),"."]}),(0,Z.tZ)(sG,{nameserver:p}),(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",disabled:!a,children:n("Save and continue")}),(0,Z.tZ)("input",{type:"hidden",name:"apex_redirect",value:"".concat(s)})]})]})})}),s3=eb(e=>{let{domainSetupState:t,pub:i,stripe_publishable_key:n}=e,{iString:r}=(0,Q.M1)();return((0,A.d4)(()=>{(0,U.j)(U.FP.CUSTOM_DOMAIN_INQUIRY,{pub:i}),t&&(0,Y.uX)((0,j.Ul)(i),{local_navigation:!1})},[i]),t)?null:(0,Z.tZ)("section",{className:"page typography custom-domain-page",id:"settings",children:(0,Z.tZ)("div",{className:"container checkout",children:(0,Z.BX)(et.tu,{gap:8,paddingY:32,children:[(0,Z.tZ)(ei.xv.H3,{children:r("Add custom domain")}),(0,Z.tZ)(ei.xv.B3,{className:"text",children:r("This flow will allow you to move your Substack to a domain you already own. ")}),(0,Z.tZ)(ei.xv.B3,{children:r("Substack charges a one-time fee of USD $50 to complete this operation, but please note this does not cover the cost of registering your domain. You'll have to purchase a domain separately")}),(0,Z.BX)(ei.xv.B3,{translated:!0,children:[(0,Z.tZ)("b",{children:"Caution: "})," This will involve some advanced configuration of your domain name registrar. Please"," ",(0,Z.tZ)(lx.hh,{decoration:"underline",href:sj,target:"_blank",rel:"noopener",children:"review this guide"})," ","before you begin."]}),(0,Z.BX)(tP.ZP,{analyticsName:"Custom Domain Payment",action:"/api/v1/domains/payment",autoLock:!0,pub:i,stripe_publishable_key:n,onSuccess:()=>(0,Y.uX)((0,j.Ul)(i),{local_navigation:!1}),className:"form-Wop6nC",children:[(0,Z.tZ)(tP.GP,{}),(0,Z.tZ)("div",{id:"error-container"}),(0,Z.tZ)(et.tu,{paddingTop:20,children:(0,Z.tZ)(ee.zx,{type:"submit",children:r("Submit")})})]})]})})})}),s8=eb(e=>{let{pub:t,domainSetupState:i}=e;(0,A.d4)(()=>{t.custom_domain&&i||(0,Y.uX)((0,j.wI3)(t),{local_navigation:!1})},[i,t.custom_domain,t]);let{iString:n}=(0,Q.M1)(),r=t.custom_domain,o=t.apex_domain,a=(null==i?void 0:i.state)==="live",[l,s]=(0,A.eJ)(void 0),[d,c]=(0,A.eJ)(void 0),[u,p]=(0,A.eJ)(!1),[h,m]=(0,A.eJ)(!1),[g,v]=(0,A.eJ)(!1),[b,y]=(0,A.eJ)(""),f=async()=>{p(!0);try{var e,t,i;let n;let r=await N().post("/api/v1/domains/status");s(r.body),o&&(n=await N().post("/api/v1/domains/redirects-status"),c(n.body)),m(!0),v(o?(null==r?void 0:null===(e=r.body)||void 0===e?void 0:e.status)==="ok"&&(null==n?void 0:null===(t=n.body)||void 0===t?void 0:t.status)==="ok":(null==r?void 0:null===(i=r.body)||void 0===i?void 0:i.status)==="ok")}catch(e){s({status:"error"})}finally{p(!1)}},_=async()=>{try{let{body:{nameserver:e}}=await N().post("/api/v1/domains/validation").send({domain:r});y(e)}catch(i){var e,t;y(null===(t=i.response)||void 0===t?void 0:null===(e=t.body)||void 0===e?void 0:e.nameserver)}};return(0,A.d4)(()=>{_()},[]),(0,Z.tZ)("section",{className:"page typography custom-domain-page",id:"settings",children:(0,Z.tZ)("div",{className:"container",children:(0,Z.BX)("div",{className:"domain-config",children:[(0,Z.tZ)("h1",{children:n("Your domain")}),(0,Z.tZ)("div",{className:"domain-entry",children:(0,Z.BX)(ei.xv,{translated:!0,className:"text",children:["The domain you have configured is: ",(0,Z.tZ)("strong",{children:I18N.p(null!=r?r:"")})]})}),(0,Z.BX)("div",{className:"domain-entry",children:[(0,Z.tZ)("h2",{children:n("Check your DNS records")}),(0,Z.tZ)("p",{className:"text",children:n("Go to your DNS provider and the following DNS records by copying the exact settings listed below.")}),(0,Z.tZ)(sq,{nameserver:b})]}),(0,Z.tZ)("div",{className:"domain-entry",children:(0,Z.tZ)(sW,{domain:r,isValid:!0,apexRedirect:!!o})}),(null==l?void 0:l.status)!=="ok"&&(0,Z.BX)(ei.xv,{translated:!0,className:"text",paddingBottom:16,children:["Learn more about custom domains ",(0,Z.tZ)("a",{href:sj,children:"in our help center"}),"."]}),(0,Z.tZ)(sG,{nameserver:b}),(0,Z.tZ)(sK,{cnameStatus:l,apexStatus:d,hasCheckedStatus:h,hasApexDomain:!!o}),(0,Z.tZ)(sQ,{hide:!o,apexStatus:d,hasCheckedStatus:h,isShowingCnameTroubleshooting:!0}),!g&&!a&&(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",disabled:u,onClick:f,children:n("Check status")}),h&&g&&(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",onClick:()=>{(0,Y.uX)((0,j.wI3)(t,{section:"domain"}),{local_navigation:!1})},children:n("Done")})]})})})});var s6=i(17352),s5=i(96046);let s9=(0,sx.zo)({display:"flex",direction:"column",gap:16}),s7=e=>{let{title:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(ei.xv.H3,{weight:"heavy",children:i(t)})},de=e=>{let{onClick:t=()=>window.history.back(),href:i}=e;return(0,Z.tZ)(ee.hU,{priority:"secondary",onClick:t,href:i,children:(0,Z.tZ)(eF.Z,{size:20})})},dt=e=>{let{children:t,className:i}=e;return(0,Z.tZ)(et.sg,{className:k()(s5.Z.container,i),gap:16,paddingY:{desktop:32,mobile:16},paddingX:16,children:t})},di=e=>{let{title:t,cta:i}=e;return(0,Z.BX)(et.X2,{alignItems:"center",justifyContent:"space-between",paddingY:8,minHeight:40,wrap:"wrap",children:[(0,Z.tZ)(ei.xv.H2,{weight:"heavy",children:t}),i]})},dn=e=>{let{title:t,description:i,cta:n,leading:r}=e;return(0,Z.BX)(et.X2,{gap:16,alignItems:"center",paddingY:8,minHeight:40,children:[r,(0,Z.BX)(et.X2,{gap:16,alignItems:"start",justifyContent:"space-between",flex:"grow",children:[(0,Z.BX)(et.sg,{gap:4,flex:"grow",children:[(0,Z.tZ)(ei.xv.H3,{weight:"heavy",children:t}),i&&(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:i})]}),n]})]})},dr=e=>{let{children:t}=e;return(0,Z.tZ)(s6.Z,{padding:16,position:"relative",children:t})},da=e=>{let{children:t}=e;return(0,Z.tZ)(s6.Z,{direction:"row",padding:16,bg:"primary-hover",radius:"sm",justifyContent:"space-between",alignItems:"center",children:t})},dl=()=>(0,Z.tZ)(et.M5,{padding:72,children:(0,Z.tZ)(iI.$j,{})}),ds=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(et.M5,{padding:72,children:(0,Z.tZ)(tp._Y,{icon:(0,Z.tZ)(eL.Z,{}),title:e("No data yet"),text:e("Please wait a few minutes and try again")})})},dd=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(du,{children:(0,Z.tZ)(tp._Y,{icon:(0,Z.tZ)(eL.Z,{}),title:e("Something went wrong"),text:e("Please refresh the page or try again later")})})},dc=(0,sx.zo)({display:"flex",direction:{desktop:"row",mobile:"column"},gap:12,alignItems:{desktop:"center",mobile:"stretch"},justifyContent:{desktop:"space-between",mobile:void 0}}),du=(0,sx.zo)({display:"flex",direction:"column",minHeight:280}),dp=(0,sx.zo)({display:"flex",direction:"column",gap:32}),dh=(0,sx.zo)({display:"flex",direction:"row",gap:12,alignItems:"center",justifyContent:"space-between",wrap:"wrap"}),dm=(0,sx.zo)({display:"flex",wrap:"wrap",direction:"row",gap:12,alignItems:"center"}),dg=()=>(0,Z.BX)(et.sg,{height:64,position:"relative",width:4,alignItems:"center",children:[(0,Z.tZ)(dv,{}),(0,Z.tZ)(db,{})]}),dv=()=>(0,Z.tZ)(ts.xu,{display:"flex",flex:"grow",bg:"tertiary",className:"line-KGfNzt"}),db=()=>(0,Z.tZ)("svg",{width:6,height:6,viewBox:"0 0 6 6",preserveAspectRatio:"none",children:(0,Z.tZ)("polygon",{points:"3,6 0,0 6,0",fill:"var(--color-bg-tertiary)"})}),dy=e=>{let{onClick:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.BX)(et.sg,{gap:16,alignItems:"center",children:[(0,Z.tZ)(dg,{}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:t,className:"button-sYvcpp",children:i("Add email")})]})},df=e=>{var{size:t=20,color:i="var(--color-fg-primary)"}=e,n=(0,ef._)(e,["size","color"]);return(0,Z.BX)(eH.l,(0,_._)((0,f._)({},n),{name:"FilledCalendarIcon",svgParams:{viewBox:"0 0 20 20"},stroke:"none",width:t,height:t,fill:i,children:[(0,Z.tZ)("path",{d:"M3.83593 18.6271H16.1731C18.0607 18.6271 19 17.6879 19 15.8274V4.7998C19 2.93929 18.0607 2 16.1731 2H3.83593C1.94832 2 1 2.93025 1 4.7998V15.8274C1 17.6969 1.94832 18.6271 3.83593 18.6271ZM3.70045 17.1731C2.89664 17.1731 2.45409 16.7486 2.45409 15.9087V7.39187C2.45409 6.56096 2.89664 6.12744 3.70045 6.12744H16.2905C17.0943 6.12744 17.5459 6.56096 17.5459 7.39187V15.9087C17.5459 16.7486 17.0943 17.1731 16.2905 17.1731H3.70045ZM8.24335 9.36979H8.77621C9.09232 9.36979 9.19166 9.27947 9.19166 8.96337V8.43051C9.19166 8.1144 9.09232 8.01505 8.77621 8.01505H8.24335C7.92724 8.01505 7.81887 8.1144 7.81887 8.43051V8.96337C7.81887 9.27947 7.92724 9.36979 8.24335 9.36979ZM11.2418 9.36979H11.7747C12.0908 9.36979 12.1992 9.27947 12.1992 8.96337V8.43051C12.1992 8.1144 12.0908 8.01505 11.7747 8.01505H11.2418C10.9257 8.01505 10.8173 8.1144 10.8173 8.43051V8.96337C10.8173 9.27947 10.9257 9.36979 11.2418 9.36979ZM14.2403 9.36979H14.7732C15.0893 9.36979 15.1977 9.27947 15.1977 8.96337V8.43051C15.1977 8.1144 15.0893 8.01505 14.7732 8.01505H14.2403C13.9242 8.01505 13.8249 8.1144 13.8249 8.43051V8.96337C13.8249 9.27947 13.9242 9.36979 14.2403 9.36979ZM5.24485 12.3231H5.76869C6.09382 12.3231 6.19317 12.2328 6.19317 11.9167V11.3838C6.19317 11.0677 6.09382 10.9774 5.76869 10.9774H5.24485C4.91972 10.9774 4.82037 11.0677 4.82037 11.3838V11.9167C4.82037 12.2328 4.91972 12.3231 5.24485 12.3231ZM8.24335 12.3231H8.77621C9.09232 12.3231 9.19166 12.2328 9.19166 11.9167V11.3838C9.19166 11.0677 9.09232 10.9774 8.77621 10.9774H8.24335C7.92724 10.9774 7.81887 11.0677 7.81887 11.3838V11.9167C7.81887 12.2328 7.92724 12.3231 8.24335 12.3231ZM11.2418 12.3231H11.7747C12.0908 12.3231 12.1992 12.2328 12.1992 11.9167V11.3838C12.1992 11.0677 12.0908 10.9774 11.7747 10.9774H11.2418C10.9257 10.9774 10.8173 11.0677 10.8173 11.3838V11.9167C10.8173 12.2328 10.9257 12.3231 11.2418 12.3231ZM14.2403 12.3231H14.7732C15.0893 12.3231 15.1977 12.2328 15.1977 11.9167V11.3838C15.1977 11.0677 15.0893 10.9774 14.7732 10.9774H14.2403C13.9242 10.9774 13.8249 11.0677 13.8249 11.3838V11.9167C13.8249 12.2328 13.9242 12.3231 14.2403 12.3231ZM5.24485 15.2855H5.76869C6.09382 15.2855 6.19317 15.1861 6.19317 14.87V14.3372C6.19317 14.0211 6.09382 13.9307 5.76869 13.9307H5.24485C4.91972 13.9307 4.82037 14.0211 4.82037 14.3372V14.87C4.82037 15.1861 4.91972 15.2855 5.24485 15.2855ZM8.24335 15.2855H8.77621C9.09232 15.2855 9.19166 15.1861 9.19166 14.87V14.3372C9.19166 14.0211 9.09232 13.9307 8.77621 13.9307H8.24335C7.92724 13.9307 7.81887 14.0211 7.81887 14.3372V14.87C7.81887 15.1861 7.92724 15.2855 8.24335 15.2855ZM11.2418 15.2855H11.7747C12.0908 15.2855 12.1992 15.1861 12.1992 14.87V14.3372C12.1992 14.0211 12.0908 13.9307 11.7747 13.9307H11.2418C10.9257 13.9307 10.8173 14.0211 10.8173 14.3372V14.87C10.8173 15.1861 10.9257 15.2855 11.2418 15.2855Z"})," "]}))};var d_=i(43570);function dZ(){let e=(0,G._)(["Wait 1 hour"]);return dZ=function(){return e},e}function dw(){let e=(0,G._)(["Wait 3 hours"]);return dw=function(){return e},e}function dC(){let e=(0,G._)(["Wait 6 hours"]);return dC=function(){return e},e}function dx(){let e=(0,G._)(["Wait 12 hours"]);return dx=function(){return e},e}function dS(){let e=(0,G._)(["Wait 1 day"]);return dS=function(){return e},e}function dk(){let e=(0,G._)(["Wait 2 days"]);return dk=function(){return e},e}function dB(){let e=(0,G._)(["Wait 3 days"]);return dB=function(){return e},e}function dT(){let e=(0,G._)(["Wait 4 days"]);return dT=function(){return e},e}function dI(){let e=(0,G._)(["Wait 5 days"]);return dI=function(){return e},e}function dN(){let e=(0,G._)(["Wait 6 days"]);return dN=function(){return e},e}function dP(){let e=(0,G._)(["Wait 7 days"]);return dP=function(){return e},e}function dE(){let e=(0,G._)(["Wait 8 days"]);return dE=function(){return e},e}function dX(){let e=(0,G._)(["Wait 9 days"]);return dX=function(){return e},e}function dM(){let e=(0,G._)(["Wait 10 days"]);return dM=function(){return e},e}function dA(){let e=(0,G._)(["Wait 15 days"]);return dA=function(){return e},e}function dD(){let e=(0,G._)(["Wait 20 days"]);return dD=function(){return e},e}function dR(){let e=(0,G._)(["Wait 25 days"]);return dR=function(){return e},e}function dF(){let e=(0,G._)(["Wait 30 days"]);return dF=function(){return e},e}function dL(){let e=(0,G._)(["Immediately"]);return dL=function(){return e},e}let dz=e=>{let{trigger:t,onUpdateTrigger:i}=e;return(0,Z.BX)(dK,{children:[(0,Z.tZ)(dO,{}),(0,Z.tZ)(dU,{trigger:t,onUpdateTrigger:i})]})},dO=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(dQ,{children:(0,Z.tZ)(d_.Vp,{priority:"secondary",theme:"warn",fillIcon:!0,leading:(0,Z.tZ)(df,{size:13}),children:e("Delay")})})},dU=e=>{let{trigger:t,onUpdateTrigger:i}=e,{iString:n,language:r}=(0,Q.M1)();return(0,Z.tZ)(d$,{children:(0,Z.BX)(oY.i,{value:String(t.delay),onChange:e=>{let n=e.currentTarget.value;i(t.id,Number(n))},children:[(0,Z.tZ)(oY.d,{children:n("Select a time delay")}),dY(r,!t.from_email_id).map(e=>(0,Z.tZ)("option",{value:e.value,children:e.label}))]})})},dY=(e,t)=>{let{iTemplate:i}=I18N.i(e),n=[{label:i(dZ()),value:"1"},{label:i(dw()),value:"3"},{label:i(dC()),value:"6"},{label:i(dx()),value:"12"},{label:i(dS()),value:"24"},{label:i(dk()),value:"48"},{label:i(dB()),value:"72"},{label:i(dT()),value:"96"},{label:i(dI()),value:"120"},{label:i(dN()),value:"144"},{label:i(dP()),value:"168"},{label:i(dE()),value:"192"},{label:i(dX()),value:"216"},{label:i(dM()),value:"240"},{label:i(dA()),value:"375"},{label:i(dD()),value:"480"},{label:i(dR()),value:"600"},{label:i(dF()),value:"720"}];return t&&n.unshift({label:i(dL()),value:"0"}),n},dH=e=>{var{size:t=20,color:i="var(--color-fg-primary)"}=e,n=(0,ef._)(e,["size","color"]);return(0,Z.tZ)(eH.l,(0,_._)((0,f._)({},n),{name:"FilledSendIcon",svgParams:{viewBox:"0 0 20 20"},stroke:"none",width:t,height:t,fill:i,children:(0,Z.tZ)("path",{transform:"translate(-1, 1)",d:"M11.9523 20C12.6396 20 13.1264 19.4081 13.4797 18.4916L19.7326 2.15752C19.9045 1.71837 20 1.32697 20 1.00239C20 0.381856 19.6182 0 18.9976 0C18.6731 0 18.2816 0.095469 17.8425 0.267305L1.42244 6.55846C0.620525 6.86395 0 7.35083 0 8.04773C0 8.92605 0.668258 9.22196 1.58472 9.4988L6.73985 11.0645C7.35083 11.2554 7.6945 11.2362 8.10501 10.8544L18.5775 1.06921C18.7017 0.954651 18.8448 0.973743 18.9403 1.05966C19.0358 1.15513 19.0453 1.29832 18.9307 1.42244L9.18376 11.9331C8.81145 12.3246 8.78281 12.6492 8.96419 13.2887L10.4821 18.3293C10.7685 19.2935 11.0645 20 11.9523 20Z"})}))};var dj=i(15562);let dJ=e=>{let{email:t,onDelete:i}=e,[n,r]=(0,A.eJ)(!1);return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(dK,{className:"emailNode-EsvoTH",children:[(0,Z.tZ)(dV,{onDelete:()=>r(!0)}),(0,Z.tZ)(dq,{email:t})]}),(0,Z.tZ)(dW,{onDelete:i,isOpen:n,onClose:()=>r(!1)})]})},dV=e=>{let{onDelete:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.BX)(dQ,{children:[(0,Z.tZ)(d_.Vp,{priority:"secondary",theme:"accent",fillIcon:!0,leading:(0,Z.tZ)(dH,{size:12}),children:i("Send email")}),t&&(0,Z.tZ)(ee.hU,{size:"xs",priority:"tertiary",onClick:t,children:(0,Z.tZ)(iW.Z,{size:16})})]})},dq=e=>{let{email:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.BX)(d$,{children:[(0,Z.BX)(et.sg,{gap:4,alignItems:"start",children:[(0,Z.tZ)(d0,{children:t.subject}),(0,Z.tZ)(d1,{children:t.previewText?t.previewText:i("Click below to edit this email")})]}),(0,Z.tZ)(et.gq,{gap:8,children:(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-accent",flex:"grow",onClick:()=>{(0,Y.uX)((0,en.n1t)("/publish/settings/edit",{redirect:window.location.href,bodyField:"drip_campaign_body",title:t.subject,titleField:"drip_campaign_title",titlePlaceholder:i("Email subject..."),endpoint:"/api/v1/drip-campaigns/".concat(t.drip_campaign_id,"/email/").concat(t.id)}))},children:i("Edit")})})]})},dW=e=>{let{onDelete:t,isOpen:i,onClose:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(dj.W,{isOpen:i,title:r("Delete email"),description:r("Are you sure you want to permanently delete this email? This action cannot be undone."),primaryButton:(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:t,children:r("Delete")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:n,children:r("Cancel")}),onClose:n})},dG=e=>{let{node:t,onAdd:i,onDelete:n,onUpdateTrigger:r}=e,{email:o,trigger:a,nextNodes:l}=t,{popToast:s}=(0,iN.pm)(),{iString:d}=(0,Q.M1)();return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(dg,{}),(0,Z.tZ)(dz,{trigger:a,onUpdateTrigger:r}),(0,Z.tZ)(dg,{}),(0,Z.tZ)(dJ,{email:o,onDelete:()=>{n(a.id),s(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:d("Email deleted")})))}}),l[0]?(0,Z.tZ)(dG,{onDelete:n,onAdd:i,onUpdateTrigger:r,node:l[0]}):(0,Z.tZ)(dy,{onClick:()=>i(o.id)})]})},dK=e=>{let{children:t,className:i}=e;return(0,Z.tZ)(s6.Z,{bg:"primary",className:i,overflow:"hidden",gap:0,children:t})},dQ=(0,ts.zo)({display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,padding:8,borderBottom:"detail",bg:"primary"}),d$=(0,ts.zo)({display:"flex",direction:"column",padding:12,gap:8}),d0=e=>{let{children:t}=e;return(0,Z.tZ)(ei.xv.B3,{weight:"medium",children:t})},d1=e=>{let{children:t}=e;return(0,Z.tZ)(ei.xv.B4,{color:"secondary",fontStyle:"italic",clamp:2,children:t})},d2=e=>{var{size:t=20,color:i="var(--color-fg-primary)"}=e,n=(0,ef._)(e,["size","color"]);return(0,Z.tZ)(eH.l,(0,_._)((0,f._)({},n),{name:"FilledZapIcon",svgParams:{viewBox:"0 0 20 20"},stroke:"none",width:t,height:t,fill:i,children:(0,Z.tZ)("path",{d:"M3.8237 11.2329L11.563 1.07404L11.5643 1.07242C11.96 0.54593 12.5908 0.338619 13.1195 0.632591C13.6461 0.925431 13.8084 1.56911 13.584 2.19472L11.2796 8.77975H15.3867C16.0253 8.77975 16.5 9.27688 16.5 9.88858C16.5 10.2365 16.3645 10.5198 16.1756 10.7655L16.1748 10.7666L8.43522 20.9347C8.03735 21.4587 7.40521 21.6601 6.87907 21.3653C6.35454 21.0714 6.19127 20.4293 6.41589 19.8029L6.41674 19.8006L8.7204 13.2178H4.6132C3.97947 13.2178 3.5 12.7344 3.5 12.109C3.5 11.767 3.6381 11.4854 3.81852 11.2399L3.8237 11.2329Z"})}))},d4=e=>{let{conditionSubscriptionType:t}=e;return(0,Z.BX)(dK,{className:"triggerNode-VXThcH",children:[(0,Z.tZ)(d3,{}),(0,Z.tZ)(d8,{conditionSubscriptionType:t})]})},d3=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(dQ,{children:(0,Z.tZ)(d_.Vp,{priority:"secondary",theme:"select",fillIcon:!0,leading:(0,Z.tZ)(d2,{size:12}),children:e("Trigger")})})},d8=e=>{let{conditionSubscriptionType:t}=e,{iString:i}=(0,Q.M1)(),n={free:i("When a new free subscriber joins"),paid:i("When a new paid subscriber joins"),upgrade:i("When a subscriber upgrades from free to paid")};return(0,Z.tZ)(d$,{children:(0,Z.tZ)(d0,{children:n[t]})})},d6=e=>{let{action:t,children:i,className:n,title:r,subtitle:o,tag:a}=e;return(0,Z.BX)(et.tu,{className:n,gap:16,children:[(0,Z.BX)(et.gq,{gap:12,justifyContent:"space-between",alignItems:"center",wrap:"wrap",children:[(0,Z.BX)(et.tu,{gap:2,children:[(0,Z.BX)(et.X2,{gap:12,alignItems:"baseline",children:[(0,Z.tZ)(ei.xv.B1,{weight:"semibold",color:"primary",children:r}),a]}),o&&(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:o})]}),t]}),(0,Z.tZ)("div",{children:i})]})};function d5(){let e=(0,G._)([""," campaign"]);return d5=function(){return e},e}let d9=e=>{let{type:t}=e,{iString:i,iTemplate:n}=(0,Q.M1)(),{result:r,isLoading:o,refetch:a}=(0,iS.ib)({pathname:"/api/v1/drip-campaigns/".concat(t),auto:!0}),{result:l,isLoading:s,refetch:d}=(0,iS.ib)({pathname:"/api/v1/drip-campaigns/".concat(null==r?void 0:r.id),auto:!1,method:"PUT"}),{result:c,isLoading:u,refetch:p}=(0,iS.ib)({pathname:"/api/v1/drip-campaigns/".concat(null==r?void 0:r.id,"/trigger-and-email"),auto:!1,method:"POST"}),{result:h,isLoading:m,refetch:g}=(0,iS.ib)({pathname:"/api/v1/drip-campaigns/".concat(null==r?void 0:r.id,"/trigger"),auto:!1,method:"DELETE"}),{result:v,isLoading:b,refetch:y}=(0,iS.ib)({pathname:"/api/v1/drip-campaigns/".concat(null==r?void 0:r.id,"/trigger"),auto:!1,method:"PUT"}),f=o||u||m||b||s;(0,A.d4)(()=>{r&&a()},[c,h,v,l]);let _=(0,to.useMemo)(()=>{let e=null==r?void 0:r.emails,t=null==r?void 0:r.triggers;if(!e||!t)return null;let i=t.find(e=>!e.from_email_id&&!!e.to_email_id);if(!i)return null;let n=i=>{let r=e.find(e=>e.id===i.to_email_id);if(!r)return null;let o=[];return t.filter(e=>e.from_email_id===r.id).forEach(e=>{let t=n(e);t&&o.push(t)}),{email:r,trigger:i,nextNodes:o}},o=n(i);return o||null},[r]);if(!r)return null;let w=i("free"===r.condition_subscription_type?"Sends a series of emails to new free subscribers until they convert to paid.":"paid"===r.condition_subscription_type?"Sends a series of emails to new paid subscribers until they cancel.":"Sends a series of emails to subscribers who just upgraded until they cancel.");return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(dt,{children:(0,Z.tZ)(dp,{children:(0,Z.tZ)(d6,{title:n(d5(),r.title),subtitle:w,action:(0,Z.tZ)(i2.ZP,{leading:(0,Z.tZ)(ei.xv.B3,{children:i("Enabled")}),checked:r.enabled,onChange:e=>{d({json:{enabled:e}})}}),children:(0,Z.BX)(d7,{children:[(0,Z.tZ)(ce,{}),(0,Z.tZ)(d4,{conditionSubscriptionType:r.condition_subscription_type}),_?(0,Z.tZ)(dG,{onUpdateTrigger:(e,t)=>{!f&&y({json:{delay:t},pathname:"/api/v1/drip-campaigns/".concat(null==r?void 0:r.id,"/trigger/").concat(e)})},onAdd:e=>{!f&&p({json:{from_email_id:e}})},onDelete:e=>{!f&&g({pathname:"/api/v1/drip-campaigns/".concat(null==r?void 0:r.id,"/trigger/").concat(e)})},node:_}):(0,Z.tZ)(dy,{onClick:()=>{!f&&p()}})]})})})})})},d7=e=>{let{children:t}=e;return(0,Z.tZ)(s6.Z,{direction:"column",padding:32,gap:4,position:"relative",bg:"primary-hover",zIndex:1,alignItems:"center",children:t})},ce=()=>(0,Z.tZ)(ts.xu,{position:"absolute",inset:0,opacity:10,className:"backdrop-lqqjQ7"});var ct=i(83034);let ci=e=>{let{pub:t,open:i,setOpen:n}=e,r="medium_length_description",{iString:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(!1),{getSettingFor:s,changeSetting:d}=(0,ss.So)(),[c,u]=(0,A.eJ)(s(r)||""),p=()=>{n(!i)},h=async()=>{try{l(!0),await d({[r]:c}),n(!1),(0,O.ZP)(o("Publication introduction saved"))}catch(e){alert((0,Y.zx)(e)),l(!1)}};return(0,Z.BX)(eK.u_,{fullscreenMobile:!0,isOpen:i,onClose:p,width:550,children:[(0,Z.tZ)(eK.xB,{onClose:p,title:o("Write your publication introduction"),showClose:!0}),(0,Z.BX)(eK.fe,{children:[(0,Z.BX)(ei.xv.B3,{translated:!0,children:["Your publication introduction should be a three- to five-sentence description of ",I18N.p(t.name)," targeted towards a reader who hasn't heard of it. It should explain what you write about and why the reader should subscribe. For example:"]}),(0,Z.tZ)(ei.xv.B4,{padding:12,color:"secondary",translated:!0,children:"Tech News Now is your definitive guide to the intertwining worlds of tech and democracy. With deep insights and exclusive scoops, this newsletter reflects the pulse of Silicon Valley, providing you with critical analysis of big tech players like Facebook, Google, YouTube, Twitter, Snap, and TikTok. It's been featured by major publications, including Slate, NBC News, and The New York Times, and has found a loyal readership with its enlightening, engaging, and even humorous content. Lauded for its thoughtful, evenhanded reporting and excellent sense of humor, Tech News Now isn't just a newsletterâ€”it's a window into the world of tech that's shaping our future."}),(0,Z.tZ)(ei.xv.B3,{paddingBottom:8,translated:!0,children:"Your publication introduction:"}),(0,Z.tZ)("textarea",{maxLength:500,value:c,name:r,"aria-label":r,placeholder:o("Type here..."),onChange:e=>u(e.currentTarget.value),onInput:e=>u(e.currentTarget.value),className:k()("inputField-o54Jae")}),(0,Z.tZ)(ei.xv.B4,{color:"pub-secondary-text",align:"right",children:"".concat((null==c?void 0:c.length)||0,"/").concat(500)})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{loading:a,onClick:h,priority:"primary",children:o("Save")}),secondaryButton:(0,Z.tZ)(ee.zx,{loading:a,onClick:p,priority:"secondary",children:o("Cancel")})})]})};var cn=i(70011),cr=i(44471),co=i(55480);let ca=e=>{let{isOpen:t,setIsOpen:i,fullyDismiss:n,score:r}=e,{iString:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(!1),[s,d]=(0,A.eJ)(""),[c,u]=(0,A.eJ)("");(0,A.d4)(()=>{(0,U.j)(U.FP.BESTSELLER_SURVEY_MODAL_SEEN,{score:r})},[]);let p=()=>{(0,U.j)(U.FP.BESTSELLER_SURVEY_MODAL_CLOSED),i(!1)},h=async()=>{l(!0),d("");try{await N().put("/api/v1/publish-dashboard/bestseller-survey").send({recommend_score:r,improve_experience_text:c}),(0,U.j)(U.FP.BESTSELLER_SURVEY_MODAL_SUBMITTED),await n(),i(!1)}catch(e){console.error(e),d((0,Y.zx)(e))}finally{l(!1)}};return(0,Z.BX)(eK.u_,{width:500,isOpen:t,onClose:p,children:[(0,Z.tZ)(eK.xB,{showClose:!0,title:"Bestseller Survey",onClose:p}),(0,Z.BX)(et.tu,{paddingX:8,paddingBottom:4,children:[(0,Z.BX)(eK.fe,{children:[(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B3,{translated:!0,weight:"semibold",children:"How could Substack improve your experience?"}),(0,Z.tZ)(li.g,{defaultValue:o("Type here..."),value:c,onChange:e=>u(e.target.value),rows:3})]}),s?(0,Z.tZ)(ei.xv.B3,{color:"error",children:s}):null]}),(0,Z.tZ)(eK.mz,{showDivider:!1,direction:"row",primaryButton:(0,Z.tZ)(ee.zx,{disabled:a,onClick:async()=>await h(),priority:"primary",children:o("Submit")})})]})]})};var cl=i(93783),cs=i(78446);function cd(){let{iString:e}=(0,Q.M1)(),[t,i]=(0,A.eJ)(!1);return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(oH.Uo,{title:e("Getting started"),children:(0,Z.tZ)(ee.hU,{priority:"tertiary",size:"sm",onClick:()=>i(!t),children:t?(0,Z.tZ)(iv.Z,{size:20}):(0,Z.tZ)(ib.Z,{size:20})})}),t&&(0,Z.tZ)(et.tu,{pullX:12,children:(0,Z.tZ)(sy,{})})]})}function cc(e){let{pub:t,initialResult:i}=e;return(0,iS.ib)({pathname:"/api/v1/publication/".concat(t.id,"/publication_threads_settings"),method:"POST",auto:!1,initialResult:i})}let cu=()=>{let{iString:e}=(0,Q.M1)();return[{label:e("Paid subscribers"),value:"paid",isDefault:!0},{label:e("Founding members"),value:"founding"}]},cp=()=>{let{iString:e}=(0,Q.M1)();return[{label:e("Publication contributors only"),value:"contributor",isDefault:!0},{label:e("Founding members"),value:"founding"},{label:e("Paid subscribers"),value:"paid"},{label:e("Free subscribers"),value:"free_subscriber"}]},ch=()=>{let{iString:e}=(0,Q.M1)();return[{label:e("Publication contributors only"),value:"contributor",isDefault:!0},{label:e("Subscribers"),value:"free_subscriber"}]},cm=e=>{let{pubId:t}=e,i=(0,ss.So)(),{iString:n}=(0,Q.M1)(),r=(0,iN.pm)(),[o,a]=(0,A.eJ)(i.getSettingFor("paywall_chat")||"free");return{paywallChat:o,setPaywallChat:async e=>{try{await (0,ix.rd)("/api/v1/publication/".concat(t,"/chat_paywall"),{method:"POST",json:{subscriptionLevel:e}}),a(e)}catch(e){console.error(e),r.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:n("Failed to update chat paywall")})))}}}},cg=e=>{let{pub:t,paywallChat:i}=e,{iString:n}=(0,Q.M1)(),r=t.plans,o=null==r?void 0:r.some(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}),a=null==r?void 0:r.some(e=>{let{active:t}=e;return t}),l={everyone:{label:n("Everyone"),value:"free_subscriber",isDefault:!0},contributor:{label:n("Only publication contributors"),value:"contributor"},founding:{label:n("Founding members"),value:"founding"},paid:{label:n("Paid subscribers"),value:"paid"}};return a?o?"free"===i?[l.everyone,l.paid,l.founding,l.contributor]:"paid"===i?[(0,_._)((0,f._)({},l.paid),{isDefault:!0}),l.founding,l.contributor]:[(0,_._)((0,f._)({},l.founding),{isDefault:!0}),l.contributor]:"free"===i?[l.everyone,l.paid,l.contributor]:[(0,_._)((0,f._)({},l.paid),{isDefault:!0}),l.contributor]:[l.everyone,l.contributor]},cv=e=>{var t,i;let{pub:n,paywallChat:r,setPaywallChat:o}=e,{iString:a}=(0,Q.M1)(),l=null==n?void 0:null===(t=n.plans)||void 0===t?void 0:t.some(e=>{let{active:t}=e;return t}),s=null==n?void 0:null===(i=n.plans)||void 0===i?void 0:i.some(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}),d=cu(),c="free"!==r;return l||c?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{id:"enable-chat-paywall",children:[(0,Z.tZ)(oH.sY,{primaryText:a("Enable chat paywall"),secondaryText:a("Only allow paying subscribers to access your chat.")}),(0,Z.tZ)(i2.rs,{checked:c,onChange:()=>o("free"===r?"paid":"free")})]})}),c&&s&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{id:"enable-chat-paywall",children:[(0,Z.tZ)(oH.sY,{primaryText:a("Who can bypass the paywall?"),secondaryText:a("Controls which subscriber tiers can access your chat.")}),(0,Z.tZ)(sE.G,{options:d,value:r,onChange:o})]})})]}):null};function cb(e){var t,i,n,r;let{pub:o,chatSettings:a}=e,{iString:l}=(0,Q.M1)(),{result:s,refetch:d,error:c,setResult:u}=cc({pub:o,initialResult:a}),p=sA({onSuccess:e=>{u((0,f._)({},s,e))}}),h=(0,cs.N4)(),{setPaywallChat:m,paywallChat:g}=cm({pubId:o.id}),v=s?{threads_v2_enabled:null!==(t=s.threads_v2_enabled)&&void 0!==t?t:a.threads_v2_enabled,photo_replies_enabled:null!==(i=s.photo_replies_enabled)&&void 0!==i?i:a.photo_replies_enabled,create_thread_minimum_role:null!==(n=s.create_thread_minimum_role)&&void 0!==n?n:a.create_thread_minimum_role,reader_thread_notifications_enabled:null!==(r=s.reader_thread_notifications_enabled)&&void 0!==r?r:a.reader_thread_notifications_enabled}:a;c&&alert((0,Y.Qu)(c));let b=cg({pub:o,paywallChat:g}),y=b.find(e=>{let{value:t,isDefault:i}=e;return v.create_thread_minimum_role?v.create_thread_minimum_role===t:i}),w=(0,en.xC8)({pubId:o.id,params:{utm_source:J.b3.chatChecklist}}),C=async e=>{await m(e),await d({method:"GET"})};return(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{title:l("Chat"),id:"chat-settings",children:[(0,Z.BX)(cl.t5,{children:[(0,Z.BX)(oH.ZR,{id:"enable-chat",children:[(0,Z.tZ)(oH.sY,{primaryText:l("Enable subscriber chat"),secondaryText:(0,Z.tZ)(Z.HY,{children:(0,Z.tZ)(ei.xv.B4,{as:"span",color:"secondary",children:(null==s?void 0:s.threads_v2_enabled)?(0,Z.BX)(Z.HY,{children:[l("View your chat at "),(0,Z.BX)(ei.hh,{href:w,target:"_blank",rel:"noopener",color:"pub-accent",children:[o.subdomain,".substack.com/chat"]})]}):l("Create a space for you and your subscribers to hang out.")})})}),(0,Z.tZ)(i2.rs,{checked:null==s?void 0:s.threads_v2_enabled,onChange:async e=>{(e||await h.confirm())&&(s&&u((0,_._)((0,f._)({},s),{threads_v2_enabled:e})),e&&p.open(),d({json:{threads_v2_enabled:e}}))}})]}),(0,Z.tZ)(cs.sm,{modal:h,title:l("Disable your subscriber chat?"),body:l("Subscribers actively using your chat will immediately lose access."),confirmLabel:l("Disable"),cancelLabel:l("Cancel")})]}),(null==s?void 0:s.threads_v2_enabled)&&(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(et.sg,{gap:20,paddingLeft:{desktop:20,mobile:12},borderLeft:"detail",children:[(0,Z.tZ)(cv,{pub:o,paywallChat:g,setPaywallChat:C}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:l("Enable media attachments"),secondaryText:l("Allows readers to share photos and videos.")}),(0,Z.tZ)(i2.rs,{checked:v.photo_replies_enabled,onChange:()=>{let e=!v.photo_replies_enabled;u((0,_._)((0,f._)({},s),{photo_replies_enabled:e})),d({json:{photo_replies_enabled:e}})}})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:l("Who can start new threads?"),secondaryText:l("Controls which subscriber tiers can start new threads.")}),(0,Z.tZ)(sE.G,{options:b,value:null==y?void 0:y.value,onChange:e=>{let t;let i=v.create_thread_minimum_role;(0,U.j)(U.FP.CHAT_READER_PARTICIPATION_CHANGED,{create_thread_minimum_role:e,prev_create_thread_minimum_role:i,source:"settings"}),"contributor"===i&&"contributor"!==e&&(t=!0),u((0,_._)((0,f._)({},s),{create_thread_minimum_role:e,reader_thread_notifications_enabled:t})),d({json:{create_thread_minimum_role:e,reader_thread_notifications_enabled:t}})}})]})}),(null==y?void 0:y.value)!=="contributor"&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:l("Send notifications for...")}),(0,Z.tZ)(sE.G,{options:[{label:l("Only publication contributor threads"),value:"contributor"},{label:l("All new threads"),value:"all"}],value:v.reader_thread_notifications_enabled?"all":"contributor",onChange:e=>{u((0,_._)((0,f._)({},s),{reader_thread_notifications_enabled:"all"===e})),d({json:{reader_thread_notifications_enabled:"all"===e}})}})]})})]}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(cd,{})})]})]})})}let cy=e=>{var t;let{pub:i,fallbackUrl:n}=e;return null!==(t=null==i?void 0:i.podcast_art_url)&&void 0!==t?t:n||(0,j.AmV)()};var cf=((l={}).postStatsDismissKey="post-stats.dismissed",l.appUnifiedHomeCtaDismissKey="app-unified-home-cta.dismissed",l.feedCtaDismissKey="feed-dashboard-cta.dismissed",l.publicationNotesTabAnnouncement="pub-notes-tab-announcement.dismissed",l.createChatInviteDraft2CtaKey="create-chat-invite-draft-2.dismissed",l.createChatInviteDraftCtaKey="create-chat-invite-draft.dismissed",l.newDashboardAnnouncement="new-dashboard-announcement.dismissed",l.enablePaid="enable-paid.dismissed",l.chatEnableReaderParticipation="chat-enable-reader-participation.dismissed",l.readerReferral="reader-referral.dismissed",l.referralPostAnnouncement="referral-post-announcement.dismissed",l.pubIntroText="publication-intro-text.dismissed",l.pledgeTurnOnPaid="pledge-turn-on-paid.dismissed",l.bestsellerSurveyModal="bestseller-survey-modal-q3.dismissed",l.indianStripeAccount="indian-stripe-account.dismissed",l.directMessagingCta="direct-messaging-cta.dismissed",l.syncWithSpotifyCta="sync-with-spotify-cta.dismissed",l.uploadToYoutubeCta="upload-to-youtube-cta.dismissed",l.exposedPhoneNumber="exposed-phone-number.dismissed",l.mfaPrompt="mfa-prompt.dismissed",l.restacksBelowPosts="restacks-below-posts.dismissed",l),c_=i(33884);let cZ={dottedLine:"dottedLine-ZaS7g4",spotifyActionBox:"spotifyActionBox-ynfwEQ"},cw=e=>{let{children:t,dismissKey:i,dismissDurationInSeconds:n,beforeDismiss:r,className:o}=e,[a,l]=(0,$.Z)(i,n,r,5);return((0,A.d4)(()=>{a||(0,U.j)(U.FP.DASHBOARD_ACTION_BOX_SHOWN,{key:i})},[]),a)?null:(0,Z.tZ)(d6,{title:"Announcements",children:(0,Z.tZ)("div",{className:k()("dashboard-action-box setup banner",o),children:t})})},cC=e=>{let{children:t,display:i,source:n,className:r}=e;return((0,A.d4)(()=>{i&&(0,U.j)(U.FP.DASHBOARD_ACTION_BOX_SHOWN,{key:n})},[]),i)?(0,Z.BX)(et.tu,{gap:24,children:[(0,Z.tZ)(ei.xv.H4,{translated:!0,weight:"medium",children:"Announcements"}),(0,Z.tZ)("div",{className:k()("dashboard-action-box setup banner",r),children:t})]}):null};function cx(e){let{onClick:t}=e;return(0,Z.tZ)(ee.hU,{size:"md",priority:"tertiary","aria-label":"Close",style:{flexShrink:0},onClick:t,children:(0,Z.tZ)(K.Z,{size:20,"aria-hidden":!0})})}function cS(e){let{children:t,onClick:i}=e;return(0,Z.BX)(et.gq,{gap:16,alignItems:"center",justifyContent:"space-between",children:[(0,Z.tZ)(ck,{children:t}),(0,Z.tZ)(cx,{onClick:i})]})}function ck(e){let{children:t}=e;return(0,Z.tZ)(ei.xv.H3,{children:t})}let cB=cf.feedCtaDismissKey;function cT(){let{iString:e}=(0,Q.M1)(),{modal:t}=(0,ct.useAppModal)({utm_campaign:J.VX.web,utm_source:J.b3.substack,utm_content:J.fZ.dashboardActionBox}),i=(0,c_.E2)({urlParams:{utm_source:J.b3.substack,utm_content:J.fZ.dashboardActionBox}}),[,n]=(0,$.Z)(cB,null,()=>{},5);return(0,Z.BX)(cw,{dismissKey:cB,beforeDismiss:()=>{(0,U.j)(U.FP.FEED_DASHBOARD_CTA_DISMISSED)},children:[t,(0,Z.tZ)(cS,{onClick:n,children:(0,Z.BX)(et.tu,{alignItems:"start",justifyContent:"start",children:[(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"Introducing"}),(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"Notes"})]})}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.BX)(ei.xv.B4,{color:"secondary",children:[e("Notes are a new way to connect with readers and writers across Substack. You can share quick thoughts and links without sending them as emails. "),(0,Z.tZ)("a",{href:"https://on.substack.com/p/notes",target:"_blank",rel:"noopener",children:"Learn more"})]}),(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.tZ)(ee.zx,{priority:"primary",href:i,onClick:e=>{e.preventDefault(),(0,U.j)(U.FP.FEED_DASHBOARD_CTA_CLICKED),(0,U.j)(U.FP.DASHBOARD_ACTION_CTA_CLICKED,{key:cf.feedCtaDismissKey,type:"visit_notes"}),n(),(0,Y.uX)(i,{local_navigation:!1})},children:e("Get started")})})]})}let cI=cf.appUnifiedHomeCtaDismissKey;function cN(){let e={utm_campaign:J.VX.appMarketing,utm_source:J.b3.substack,utm_content:J.fZ.unifiedHomeDashboardActionBox},{iString:t}=(0,Q.M1)(),[i,n]=(0,$.Z)(cI,null,()=>{},5),r=(0,j.tSX)(e),o=(0,j.n1t)("https://on.substack.com/p/new-front-page",e);return(0,Z.BX)(cC,{display:!i,source:cI,children:[(0,Z.tZ)(cS,{onClick:n,children:(0,Z.tZ)(et.tu,{alignItems:"start",justifyContent:"start",children:(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"Introducing the Substack app"})})}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:["More than 25% of subscriptions originate from the app, which puts discovery front and center to supercharge your growth."," ",(0,Z.tZ)("a",{href:o,target:"_blank",rel:"noopener",children:"Learn more"}),"."]}),(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:e=>{e.preventDefault(),(0,U.j)(U.FP.DASHBOARD_ACTION_CTA_CLICKED,{key:cI,type:"app_announcement"}),(0,Y.uX)(r,{newTab:!0})},children:t("Get the app")})})]})}let cP=cf.indianStripeAccount;function cE(){let{iString:e}=(0,Q.M1)(),[t,i]=(0,$.Z)(cP,null,()=>{},5);return(0,Z.BX)(cC,{display:!t,source:cP,children:[(0,Z.tZ)(cS,{onClick:i,children:(0,Z.tZ)(et.tu,{alignItems:"start",justifyContent:"start",children:(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"New Stripe requirements for Indian publications"})})}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:["By January 31, 2024, writers with India-based Stripe accounts such as yours must comply with"," ",(0,Z.tZ)("a",{target:"_blank",rel:"noopener",href:"https://58.email.stripe.com/CL0/https:%2F%2Fsupport.stripe.com%2Fquestions%2Faccepting-international-payments-from-stripe-accounts-in-india/2/0100018d0cb818fd-d38f5c3e-b93e-42e0-888d-04a9bf4ced65-000000/EOP64j6jMGnifWyye74v6mQm4zoxcKM0fZczp0vNGZs=335",children:"new requirements"}),", including supplying Stripe with an"," ",(0,Z.tZ)("a",{target:"_blank",rel:"noopener",href:"https://58.email.stripe.com/CL0/https:%2F%2Fsupport.stripe.com%2Fquestions%2Faccepting-international-payments-from-stripe-accounts-in-india/1/0100018d0cb818fd-d38f5c3e-b93e-42e0-888d-04a9bf4ced65-000000/gITFp9d-7xpnJUK1TJsJCKBL7j_iUPN-lQV-oXUZYhk=335",children:"Importer-Exporter Code"}),", in order to continue accepting international credit card payments. Please review Stripe's documentation and check that your Stripe account complies with the requirements."]}),(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:i,children:e("Close")})})]})}let cX=cf.directMessagingCta;function cM(){let{iString:e}=(0,Q.M1)(),[t,i]=(0,$.Z)(cX,null,()=>{},5);return(0,A.d4)(()=>{(0,U.j)(U.FP.DIRECT_MESSAGE_ANNOUNCEMENT_SEEN)},[]),(0,Z.BX)(cC,{display:!t,source:cX,children:[(0,Z.tZ)(cS,{onClick:()=>{(0,U.j)(U.FP.DIRECT_MESSAGE_ANNOUNCEMENT_DISMISSED),i()},children:(0,Z.tZ)(et.tu,{alignItems:"start",justifyContent:"start",children:(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"New: Direct messaging"})})}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:["Now you can directly message (DM) other writers and readers on Substack by clicking the â€œMessageâ€ button on their profile. Control who can send you message requests in your"," ",(0,Z.tZ)("a",{target:"_blank",rel:"noopener",href:(0,j.v3t)({section:"privacy"}),children:"Settings"}),"."]}),(0,Z.BX)(et.gq,{gap:16,paddingTop:16,children:[(0,Z.tZ)(ee.zx,{href:(0,en.Cnj)(),priority:"primary",newTab:!0,onClick:()=>(0,U.j)(U.FP.DIRECT_MESSAGE_ANNOUNCEMENT_TRY_DMS_CLICKED),children:e("Try DMs")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"https://on.substack.com/p/direct-messaging-on-substack",newTab:!0,onClick:()=>(0,U.j)(U.FP.DIRECT_MESSAGE_ANNOUNCEMENT_LEARN_MORE_CLICKED),children:e("Learn more")})]})]})}function cA(e){var t,i,n;let{pub:r}=e,o=[];for(let e of(r.podcast_enabled&&o.push({settings:(0,co.jU)({pub:r}),spotifySettings:null!==(t=r.spotify_podcast_settings)&&void 0!==t?t:null,section:null}),r.sections))e.is_podcast&&o.push({settings:(0,co.d_)({pub:r,section:e}),spotifySettings:null!==(i=e.spotify_podcast_settings)&&void 0!==i?i:null,section:e});return null!==(n=o.find(e=>{let{spotifySettings:t}=e;return!t||t&&!t.currently_published_on_spotify}))&&void 0!==n?n:null}function cD(e){let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,$.Z)(cf.syncWithSpotifyCta,null,()=>{},5);(0,A.d4)(()=>{(0,U.j)(U.FP.SYNC_WITH_SPOTIFY_ANNOUNCEMENT_SEEN)},[]);let o=(0,ts.oB)({width:40,height:40,shadow:"lg",radius:"full"}),a=(0,ts.oB)({radius:"sm",shadow:"lg"}),l=()=>{(0,U.j)(U.FP.SYNC_WITH_SPOTIFY_ANNOUNCEMENT_DISMISSED),r()},s=cA({pub:t});if(!s)return null;let d=s.settings,c="".concat((0,en.HQ2)({pub:t,section:null}),"#distribute-podcast");return(0,Z.tZ)(cC,{display:!n,source:cf.syncWithSpotifyCta,className:cZ.spotifyActionBox,children:(0,Z.BX)(et.hs,{direction:{mobile:"column",desktop:"row"},gap:20,padding:16,children:[(null==d?void 0:d.artUrl)&&(0,Z.BX)(et.gq,{gap:8,bg:"secondary",justifyContent:"center",radius:"md",alignItems:"center",padding:20,children:[(0,Z.tZ)(iZ.e,{className:a,src:d.artUrl,imageProps:{height:40},useRetinaSizing:!0,imageIsFixedWidth:!0,maxWidth:40,loading:"eager"}),(0,Z.tZ)(ei.xv,{className:cZ.dottedLine,children:"â€¦"}),(0,Z.tZ)("div",{className:o,children:(0,Z.tZ)(cn.Z,{size:40})})]}),(0,Z.BX)(et.tu,{justifyContent:"center",children:[(0,Z.tZ)(ei.xv.H4,{fontWeight:"heavy",color:"primary",translated:!0,children:"Sync your podcast to Spotify"}),(0,Z.BX)(ei.xv.B3,{color:"secondary",weight:"regular",children:[i("Help listeners access and discover your free and paid episodes directly from Spotify.")," ",(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us/articles/24766453298324-How-can-I-distribute-my-paid-Substack-podcast-on-Spotify",children:i("Learn more")})]})]}),(0,Z.BX)(et.gq,{gap:8,paddingTop:16,alignItems:"center",children:[(0,Z.tZ)(ee.zx,{priority:"secondary",newTab:!0,onClick:()=>l(),children:i("Dismiss")}),(0,Z.tZ)(ee.zx,{priority:"primary",href:c,newTab:!0,onClick:()=>(0,U.j)(U.FP.SYNC_WITH_SPOTIFY_ANNOUNCEMENT_SYNC_BUTTON_CLICKED),children:i("Get started")})]})]})})}function cR(e){let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,$.Z)(cf.uploadToYoutubeCta),{connectAccount:o}=iD({source:"announcement"});(0,A.d4)(()=>{(0,U.j)(U.FP.UPLOAD_TO_YOUTUBE_ANNOUNCEMENT_SEEN)},[]);let a=()=>{(0,U.j)(U.FP.UPLOAD_TO_YOUTUBE_ANNOUNCEMENT_DISMISSED),r()},l=cy({pub:t,fallbackUrl:t.logo_url||"https://substack.com/img/substack.png"}),s=async()=>{(0,U.j)(U.FP.UPLOAD_TO_YOUTUBE_ANNOUNCEMENT_CONNECT_BUTTON_CLICKED),await o()};return(0,Z.tZ)(cC,{display:!n,source:cf.uploadToYoutubeCta,className:cZ.spotifyActionBox,children:(0,Z.BX)(et.hs,{direction:{mobile:"column",desktop:"row"},gap:20,padding:16,justifyContent:"space-between",children:[(0,Z.BX)(et.gq,{gap:20,alignItems:"center",children:[(0,Z.BX)(et.gq,{gap:8,bg:"secondary",justifyContent:"center",radius:"md",alignItems:"center",padding:20,children:[(0,Z.tZ)(iZ.e,{src:l,imageProps:{height:40},useRetinaSizing:!0,imageIsFixedWidth:!0,maxWidth:40,loading:"eager",style:{borderRadius:"4px",filter:"drop-shadow(0px 1px 3px rgba(0, 0, 0, 0.3))"}}),(0,Z.tZ)(ei.xv,{className:cZ.dottedLine,children:"â€¦"}),(0,Z.tZ)(et.tu,{justifyContent:"center",alignItems:"center",children:(0,Z.tZ)(iZ.e,{src:"/img/youtube_icon.png",alt:i("YouTube"),maxWidth:40,loading:"eager"})})]}),(0,Z.BX)(et.tu,{justifyContent:"center",children:[(0,Z.tZ)(ei.xv.H4,{fontWeight:"heavy",color:"primary",translated:!0,children:"Automatically upload videos to YouTube"}),(0,Z.BX)(ei.xv.B3,{color:"secondary",weight:"regular",children:[i("Upload once and distribute on both platforms.")," ",(0,Z.tZ)("a",{href:iX,target:"_blank",rel:"noopener",children:i("Learn more")})]})]})]}),(0,Z.BX)(et.gq,{gap:8,paddingTop:16,alignItems:"center",children:[(0,Z.tZ)(ee.zx,{priority:"secondary",newTab:!0,onClick:()=>a(),children:i("Dismiss")}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:s,style:{color:"var(--color-light-bg-primary)",backgroundColor:"#FC0D1B"},children:i("Connect YouTube")})]})]})})}let cF=cf.bestsellerSurveyModal;function cL(e){let{overrideSurveyAnnouncementDismissKey:t}=e,[i,n]=(0,A.eJ)(t),[r,o]=(0,A.eJ)(!1),[a,l]=(0,A.eJ)(0),{changeUserSetting:s}=(0,cr.Eh)(),[d,c]=(0,$.Z)(cF,null,()=>{},5),u=async()=>{await s("bestseller_survey_announcement_seen",!0),c(),n(!1)},p=async e=>{l(e),o(!0)};return(0,Z.BX)(cC,{display:i||!d,source:cF,className:"wide",children:[(0,Z.tZ)(cS,{onClick:u,children:(0,Z.tZ)(et.tu,{alignItems:"start",justifyContent:"start",children:(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"We'd like to hear from you"})})}),(0,Z.BX)(et.tu,{gap:32,children:[(0,Z.tZ)(et.tu,{gap:4,children:(0,Z.tZ)(ei.xv.B3,{translated:!0,color:"secondary",children:"Substack can only succeed if you succeed. It's critical we understand how you are feeling about Substack as a Bestseller and what you'd like to see more of from us."})}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B3,{translated:!0,weight:"semibold",children:"How likely are you to recommend Substack to a friend or colleague?"}),(0,Z.BX)(et.hs,{gap:{mobile:12,desktop:4},direction:{mobile:"column",desktop:"row"},children:[(0,Z.tZ)(et.gq,{gap:4,justifyContent:"space-between",children:[1,2,3,4,5].map(e=>(0,Z.tZ)(ee.zx,{priority:a===e?"primary":"secondary",onClick:()=>p(e),children:e}))}),(0,Z.tZ)(et.gq,{gap:4,justifyContent:"space-between",children:[6,7,8,9,10].map(e=>(0,Z.tZ)(ee.zx,{priority:a===e?"primary":"secondary",onClick:()=>p(e),children:e}))})]})]})]}),(0,Z.tZ)(ca,{isOpen:r,setIsOpen:o,fullyDismiss:u,score:a})]})}function cz(e){let{pub:t}=e,{iString:i}=(0,Q.M1)(),[,n]=(0,$.Z)(cf.publicationNotesTabAnnouncement,null,()=>{},5),{changeSetting:r}=(0,ss.So)(),o=async e=>{e.preventDefault(),(0,U.j)(U.FP.NOTES_TAB_ANNOUNCEMENT_CLICKED),(0,U.j)(U.FP.DASHBOARD_ACTION_CTA_CLICKED,{key:cf.publicationNotesTabAnnouncement,type:"turn_on_tab"}),await r({notes_feed_enabled:!0}),n(),(0,Y.uX)("/notes",{local_navigation:!1})};return(0,Z.BX)(cw,{dismissKey:cf.publicationNotesTabAnnouncement,beforeDismiss:()=>{(0,U.j)(U.FP.NOTES_TAB_ANNOUNCEMENT_DISMISSED)},children:[(0,Z.tZ)(cS,{onClick:n,children:i("Show your notes on your publication")}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.BX)(ei.xv.B4,{color:"secondary",children:[i('Now you can add a "Notes" tab to your publication page, so subscribers can see all your notes and restacks in one place.')," ",(0,Z.tZ)("a",{href:"https://on.substack.com/p/notes",target:"_blank",rel:"noopener",children:i("Learn more")})]}),(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.tZ)(ee.zx,{priority:"primary",href:(0,j.wI3)(t,{params:{search:"notes"}}),onClick:o,children:i("Turn on tab")})})]})}cT.dismissKey=cB,cz.dismissKey=cf.publicationNotesTabAnnouncement;let cO=cf.createChatInviteDraft2CtaKey;function cU(e){let{pub:t}=e,{iString:i}=(0,Q.M1)(),[,n]=(0,$.Z)(cO,null,()=>{},5);return(0,A.d4)(()=>{(0,U.j)(U.FP.CHAT_INVITE_DRAFT_POST_CTA_SHOWN)},[]),(0,Z.BX)(cw,{dismissKey:cO,beforeDismiss:()=>{(0,U.j)(U.FP.CHAT_INVITE_DRAFT_POST_CTA_DISMISSED)},children:[(0,Z.BX)(cS,{onClick:n,children:[(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"Next:"}),(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"Invite your readers to Chat"})]}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.tZ)("p",{className:"info",children:i("The next step is to announce your new subscriber chat and tell your readers how to join. Weâ€™ve created step-by-step instructions you can easily email out.")}),(0,Z.tZ)(et.tu,{children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,U.j)(U.FP.CHAT_INVITE_DRAFT_POST_CTA_CLICKED),(0,U.j)(U.FP.DASHBOARD_ACTION_CTA_CLICKED,{key:cf.createChatInviteDraft2CtaKey,type:"use_template"}),n(),(0,Y.uX)((0,j.qYj)(t,{type:"newsletter",template:"chat-intro-post-template_post"}),{local_navigation:!1})},children:i("Use template")})})]})}function cY(e){let{pub:t}=e,{iString:i}=(0,Q.M1)(),[,n]=(0,$.Z)(cf.enablePaid,null,()=>{},5),r=async e=>{e.preventDefault(),(0,U.j)(U.FP.DASHBOARD_ACTION_CTA_CLICKED,{key:cf.enablePaid,type:"enable_payments"}),n();let i=(0,j.n1t)("".concat((0,j.wI3)(t),"/setup_plans"),{redirect:"/"});(0,Y.uX)(i,{newTab:!0})};return(0,Z.BX)(cw,{dismissKey:cf.enablePaid,children:[(0,Z.tZ)(cS,{onClick:n,children:i("Finish setting up payments")}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Now that youâ€™ve connected Stripe, you're nearly ready to start earning money for your work. Just set your prices and enable payments to get started."}),(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:r,children:i("Enable payments")})})]})}function cH(e){var t,i,n,r,o,a,l;let{pub:s}=e,{iString:d}=(0,Q.M1)(),[,c]=(0,$.Z)(cf.chatEnableReaderParticipation,null,()=>{},5),u=cp(),p=ch(),h=(null===(t=s.plans)||void 0===t?void 0:t.some(e=>{let{active:t}=e;return t}))?u:p,[m,g]=(0,A.eJ)(null!==(a=null!==(o=null===(i=s.threads_v2_settings)||void 0===i?void 0:i.create_thread_minimum_role)&&void 0!==o?o:null===(n=h.find(e=>e.isDefault))||void 0===n?void 0:n.value)&&void 0!==a?a:"contributor"),[v,b]=(0,A.eJ)(null!==(l=null===(r=s.threads_v2_settings)||void 0===r?void 0:r.reader_thread_notifications_enabled)&&void 0!==l&&l),y=(0,A.sO)(null),f=e=>{y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{c()},e)};return(0,Z.BX)(cw,{dismissKey:cf.chatEnableReaderParticipation,children:[(0,Z.tZ)(cS,{onClick:c,children:(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"Let subscribers start chat threads"})}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Chat is a place for your readers to hang out and connect with each other. To empower readers to help steward the community around your publication, you can give subscribers the ability to start their own Chat threads."}),(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:d("Who can start threads?")}),(0,Z.tZ)(sE.G,{options:h,value:m,onChange:async e=>{let t;e!==m&&((0,U.j)(U.FP.DASHBOARD_ACTION_CTA_CLICKED,{key:cf.chatEnableReaderParticipation,type:"enable_chat_".concat(e,"_participation")}),(0,U.j)(U.FP.CHAT_READER_PARTICIPATION_CHANGED,{create_thread_minimum_role:e,prev_create_thread_minimum_role:m,source:"dashboard-action-box"}),"contributor"===m&&(t=!0),await cj(s.id,{create_thread_minimum_role:e,reader_thread_notifications_enabled:t}),g(e),b(null!=t?t:v),f(6e4))}})]})}),"contributor"!==m&&(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:d("Subscriber thread notifications"),secondaryText:d("If enabled, threads started by subscribers will also send push notifications.")}),(0,Z.tZ)(i2.rs,{checked:v,onChange:async()=>{let e=!v;b(e),await cj(s.id,{reader_thread_notifications_enabled:e}),e?c():f(3e4)}})]})})]})}async function cj(e,t){let{create_thread_minimum_role:i,reader_thread_notifications_enabled:n}=t;try{return await (0,ix.rd)("/api/v1/publication/".concat(e,"/publication_threads_settings"),{method:"POST",json:{create_thread_minimum_role:i,reader_thread_notifications_enabled:n}})}catch(e){return e}}cf.newDashboardAnnouncement;let cJ=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(!1),{changeSetting:o,getSettingFor:a}=(0,ss.So)(),l="show_subscriber_import_prompt";return(0,Z.BX)(cC,{display:!n&&!!a("show_subscriber_import_prompt"),source:l,children:[(0,Z.tZ)(cS,{onClick:()=>{o({[l]:!1}),(0,U.j)(U.FP.DASHBOARD_ACTION_CTA_DISMISSED,{key:l}),r(!0)},children:i("Import or add subscribers")}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Importing or manually adding emails that have opted-into getting your writing will allow your work to reach a wider audience."}),(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,U.j)(U.FP.DASHBOARD_ACTION_CTA_CLICKED,{key:l}),(0,Y.uX)("".concat((0,j.SVA)(t),"/publish/subscribers/add?utm_source=").concat(l),{newTab:!0})},children:i("Import emails")})})]})},cV=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(!1),o="dashboard_referral_cta_dismissed",[a,l]=(0,$.Z)(cf.readerReferral,null,()=>{},5),{changeSetting:s,getSettingFor:d}=(0,ss.So)(),c="dashboard_referral_cta",u="enabled"===t.payments_state,p=async()=>{await s({[o]:!0}),l()},h=async()=>{(0,U.j)(U.FP.DASHBOARD_ACTION_CTA_CLICKED,{key:o}),r(!0),u&&await N().put("/api/v1/reader_referrals").send({enabled:!0}),await s({[o]:!0}),l(),(0,Y.uX)("".concat((0,j.SVA)(t),"/publish/settings/reader_referrals?utm_source=").concat(c),{local_navigation:!1})},m=i(u?"Turn on subscriber referrals":"Set up subscriber referrals"),g=i(u?n?"Turning on subscriber referrals":"Turn on subscriber referrals":n?"Redirecting to subscriber referrals settings":"Set up subscriber referrals");return(0,Z.BX)(cC,{display:!a&&!d(o),source:c,children:[(0,Z.tZ)(cS,{onClick:p,children:m}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:["Grow your audience by rewarding subscribers for sharing your Substack. Writers like"," ",(0,Z.tZ)("a",{href:"https://blog.bytebytego.com/p/receive-a-pdf-with-the-best-of-the",target:"_blank",rel:"noopener",children:"Alex Xu"})," ","have added thousands of new subscribers through referrals."," ",(0,Z.tZ)("a",{href:"https://on.substack.com/p/subscriber-referrals",target:"_blank",rel:"noopener",children:"Learn more"}),"."]}),(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:h,children:g})})]})},cq=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,$.Z)(cf.pubIntroText,null,()=>{},5),[o,a]=(0,A.eJ)(!1),l="show_publication_intro_pub_setting";return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ci,{pub:t,open:o,setOpen:e=>{e||r(),a(e)}}),(0,Z.BX)(cC,{display:!n,source:l,children:[(0,Z.tZ)(cS,{onClick:()=>{(0,U.j)(U.FP.DASHBOARD_ACTION_CTA_DISMISSED,{key:l}),r()},children:i("Write a publication introduction")}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:["Writers now have the ability to write a longer description of their publications that will appear on Substack discovery surfaces such as"," ",(0,Z.tZ)("a",{href:"".concat((0,j.SVA)(),"/top/culture"),target:"_blank",rel:"noopener",children:"leaderboards"}),". Write a description for ",I18N.p(t.name)," to help readers understand what it's about."]}),(0,Z.tZ)(et.gq,{paddingTop:16,gap:16,children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,U.j)(U.FP.DASHBOARD_ACTION_CTA_CLICKED,{key:l}),a(!0)},children:i("Write introduction")})})]})]})},cW=cf.pledgeTurnOnPaid;function cG(e){let{estimatedArr:t,estimatedArrCurrency:i}=e,{iString:n}=(0,Q.M1)(),{changeSetting:r,getSettingFor:o}=(0,ss.So)(),[a,l]=(0,$.Z)(cW,null,()=>{},5),s=async e=>{e.preventDefault(),(0,U.j)(U.FP.DASHBOARD_ACTION_CTA_CLICKED,{key:cW}),l(),await r({turn_on_paid_pledge_box_dismissed:!0}),(0,Y.uX)("/api/v1/stripe/authorize",{local_navigation:!1})};return(0,Z.BX)(cC,{display:!a&&!o("turn_on_paid_pledge_box_dismissed"),source:cW,children:[(0,Z.tZ)(cS,{onClick:()=>{l(),r({turn_on_paid_pledge_box_dismissed:!0})},children:(0,Z.tZ)(et.tu,{alignItems:"start",justifyContent:"start",children:(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"Your readers want to pay for your writing"})})}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:["Your readers love your work! They've pledged to pay"," ",I18N.p((0,er.centsToPriceString)(t,i))," in annual revenue if you turn on payments. It takes less than five minutes to connect Stripe and start earning money for your writing."]}),(0,Z.tZ)(et.gq,{paddingTop:16,alignItems:"end",gap:12,children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:s,children:n("Connect Stripe")})})]})}let cK=cf.exposedPhoneNumber;function cQ(){let{iString:e}=(0,Q.M1)(),[t,i]=(0,$.Z)(cK,null,()=>{},3);return(0,Z.BX)(cC,{display:!t,source:cK,children:[(0,Z.tZ)(cS,{onClick:i,children:(0,Z.tZ)(et.tu,{alignItems:"start",justifyContent:"start",children:(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"Please review: phone number on invoices"})})}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"We noticed that you have a phone number visible on your paid subscriber invoices. To protect your privacy, we recommend hiding personal phone numbers in your Stripe settings by toggling this button off."}),(0,Z.tZ)("img",{src:(0,en.zF4)("/img/phone_warning.png"),alt:"Phone number warning",style:{width:400},onClick:()=>{window.open("https://dashboard.stripe.com/settings/update/public/support-details","_blank")}}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{window.open("https://dashboard.stripe.com/settings/update/public/support-details","_blank")},children:e("Click here to access your Stripe Settings")}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,style:{marginTop:8},children:(0,Z.tZ)("a",{style:{textDecoration:"none"},href:"https://support.substack.com/hc/en-us/articles/25339371443732-How-to-do-I-hide-my-phone-number-or-email-on-Stripe",children:"Learn how to hide your phone number"})})]})}let c$=()=>{let[e,t]=(0,$.Z)(cf.mfaPrompt,null,()=>{},5);return(0,Z.BX)(cC,{display:!e,source:cf.mfaPrompt,children:[(0,Z.tZ)(cS,{onClick:t,children:(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"Please Review: Two-Factor Authentication"})}),(0,Z.tZ)(tX.iz,{paddingY:16}),(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:["We noticed that you haven't enabled two-factor authentication for your account. To best protect your account from unauthorized login attempts, we recommend enabling two-factor authentication by following"," ",(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us/articles/4785929336980-What-is-Two-Factor-Authentication-How-do-I-use-it",target:"_blank",children:"these steps"}),"."]})]})};var c0=i(57391),c1=i(17181),c2=i(61166),c4=i(71753),c3=i(11043),c8=i(73229);let c6={indicator:"indicator-CiwudB",steps2:"steps2-tq72du",step:"step-uVxdex",steps3:"steps3-nn9tnF",steps4:"steps4-mTb1JK",steps5:"steps5-gCmWtR",steps6:"steps6-KrJqj4",steps7:"steps7-DFvrvb",steps8:"steps8-Rcekdj",small:"small-PJPrdI",medium:"medium-EWnBqT",large:"large-DJOAxr"},c5=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,i=[],n=0,r=e;for(;n<t;)r>=1?i.push(1):r>0?i.push(r):i.push(0),r--,n++;return i},c9=e=>{let{progress:t,color:i="#5cd27d"}=e,n="linear-gradient(90deg, ".concat("primary-theme"===i?"var(--background_pop)":i," ").concat(100*t,"%, #d9d9d9 ").concat(100*t,"%)");return(0,Z.tZ)("div",{style:t?{background:n}:{},className:c6.step})},c7=e=>{let{completedSteps:t,totalSteps:i=5,color:n,size:r="medium"}=e,o=Array.isArray(t)?t:c5(t,i);return(0,Z.tZ)(et.gq,{className:k()(c6.indicator,c6[r],c6["steps".concat(i)]),alignItems:"center",gap:8,children:o.map(e=>(0,Z.tZ)(c9,{progress:e,color:n}))})},ue=e=>{let{checklistState:t}=e,i=Object.values(t).filter(e=>null!==e);return(0,Z.tZ)(et.gq,{paddingTop:16,paddingBottom:12,children:(0,Z.tZ)(c7,{color:"primary-theme",completedSteps:i,totalSteps:Object.keys(t).length})})},ut={goingPaidIllustration:"goingPaidIllustration-PEMnRC",instructionListImage:"instructionListImage-xGRMy7",plainLink:"plainLink-gEHOwI",secondaryTextLink:"secondaryTextLink-W0fEUy",logoWrapper:"logoWrapper-X8SZwt",fileUpload:"fileUpload-bRi1B3",imageWrap:"imageWrap-kYwHS5",emailImportWrap:"emailImportWrap-xim6QH",topBorder:"topBorder-JofQVB",clickable:"clickable-QraFIU",emailInput:"emailInput-X1dmjw",emptySubscriber:"emptySubscriber-fd6xNU",limitedHeight:"limitedHeight-lUEvoW"},ui=e=>{var t,i;let{pub:n,onNext:r,onClose:o,onComplete:a,checklistState:l}=e,{iString:s}=(0,Q.M1)(),d=(0,iN.pm)(),[c,u]=(0,A.eJ)({}),[p,h]=(0,A.eJ)(!1),m=n.name,g=n.hero_text,v=n.logo_url,[b,y]=(0,A.eJ)(n.name),[w,C]=(0,A.eJ)(null!==(t=n.hero_text)&&void 0!==t?t:""),[x,S]=(0,A.eJ)(null!==(i=n.logo_url)&&void 0!==i?i:""),[k,B]=(0,A.eJ)(null),[T,I]=(0,A.eJ)(!1),P=(0,A.sO)(null),E=async e=>{if(e.preventDefault(),h(!0),c.name||c.description)try{let e={};c.name&&(e.name=b.trim()),c.description&&(e.hero_text=w.trim()),await N().put("/api/v1/publication").send(e)}catch(e){d.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:s("Failed to update publication details")}))),console.error((0,Y.zx)(e),e)}if(k)try{await N().post("/api/v1/publication/logo").attach("logo",k,k.name),a("upload_logo")}catch(e){d.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:s("Failed to save logo image")}))),console.error((0,Y.zx)(e),e)}u({}),h(!1),c.name?window.location.href="".concat(window.location.href.replace(window.location.search,""),"?checklist=paid"):r()},X=async()=>{var e,t;if(I(!0),!(null==P?void 0:null===(t=P.current)||void 0===t?void 0:null===(e=t.files)||void 0===e?void 0:e.length)){I(!1);return}let i=P.current.files[0];try{if(!i){console.warn("could not find file in LaunchBasics");return}let e=await (0,Y.Zk)(i);S(e),B(i),e!==v&&u(e=>(0,_._)((0,f._)({},e),{logo:!0}))}catch(e){d.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:s("Failed to upload logo image")}))),console.error(e)}I(!1)};return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:o,title:s("Set up the basics")}),(0,Z.BX)("form",{onSubmit:E,children:[(0,Z.BX)(eK.fe,{children:[(0,Z.tZ)(ue,{checklistState:l})," ",(0,Z.BX)(et.tu,{paddingTop:16,gap:24,children:[(0,Z.tZ)(c8.B,{label:s("Publication name"),children:(0,Z.tZ)(et.gq,{children:(0,Z.tZ)(tD.oi,{value:b,onChange:e=>{let t=e.currentTarget.value;t.trim()!==m&&u(e=>(0,_._)((0,f._)({},e),{name:!0})),y(t)}})})}),(0,Z.tZ)(c8.B,{label:s("Description"),children:(0,Z.tZ)(li.g,{onChange:e=>{let t=e.target.value;t.trim()!==g&&u(e=>(0,_._)((0,f._)({},e),{description:!0})),C(t)},children:w})}),(0,Z.tZ)(c8.B,{label:s("Logo"),alignment:"horizontal",detail:s("We recommend a square image that is at least 300px wide."),className:ut.logoWrapper,children:(0,Z.tZ)(et.tu,{className:ut.fileUpload,alignItems:"center",justifyContent:"center",gap:8,padding:4,children:T?(0,Z.tZ)(iI.$j,{}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("input",{type:"file",name:"logo",onChange:X,ref:P}),x&&(0,Z.tZ)(et.gq,{alignItems:"center",justifyContent:"center",className:ut.imageWrap,children:(0,Z.tZ)("img",{src:x})}),!x&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(c3.Z,{stroke:"#808080",height:24}),(0,Z.tZ)(ei.xv,{align:"center",size:14,color:"secondary",translated:!0,children:"Upload Image"})]})]})})})]})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.BX)(et.gq,{alignItems:"center",gap:8,children:[p&&(0,Z.tZ)(iI.$j,{}),(0,Z.tZ)(ee.zx,{type:"submit",disabled:p,priority:"primary",children:s("Save")})]})})]})]})},un=e=>{let{onClose:t,checklistState:i}=e,{iString:n}=(0,Q.M1)(),r=(e,t,i)=>(0,Z.BX)(et.gq,{gap:24,alignItems:"center",children:[(0,Z.tZ)("img",{src:(0,en.zF4)(i),className:ut.instructionListImage}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{lineHeight:20,children:e}),t&&(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:t})]})]});return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:t}),(0,Z.BX)(eK.fe,{children:[(0,Z.tZ)(ue,{checklistState:i}),(0,Z.BX)(et.tu,{paddingY:16,gap:32,paddingX:12,children:[(0,Z.tZ)(et.tu,{alignItems:"center",paddingBottom:16,paddingTop:24,children:(0,Z.tZ)(ei.xv.H3,{align:"center",translated:!0,children:"A good first post is a key part of a successful launch. Hereâ€™s what we recommend!"})}),(0,Z.BX)(et.tu,{gap:4,children:[r(n("1. Share your personal story."),n("Who you are, why youâ€™re making this Substack, why now."),"/img/home_page/writing.png"),(0,Z.tZ)(tX.iz,{}),r(n("2. Tell readers what to expect."),n("What will you post about, how often, details about paid subscription, etc."),"/img/home_page/blog.png"),(0,Z.tZ)(tX.iz,{}),r(n("3. Use subscribe buttons and calls to action."),n("Make it easy for your readers to support you!"),"/img/publish/post-image3.png")]})]})]}),(0,Z.tZ)(eK.mz,{direction:"column",primaryButton:(0,Z.tZ)(et.tu,{paddingBottom:12,children:(0,Z.tZ)(ee.zx,{type:"submit",priority:"primary",onClick:()=>{(0,Y.uX)("/publish/post?type=newsletter&firstPost=true")},children:n("Create your first post")})})})]})},ur=e=>{let{onClose:t,onNext:i,onComplete:n,onSkip:r,stripeCompleted:o,checklistState:a}=e,{iString:l}=(0,Q.M1)();return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:t}),(0,Z.BX)(eK.fe,{children:[(0,Z.tZ)(ue,{checklistState:a}),(0,Z.tZ)(et.tu,{paddingX:32,paddingTop:16,paddingBottom:32,gap:20,alignItems:"center",children:o?(0,Z.tZ)(ua,{}):(0,Z.tZ)(uo,{onConnect:()=>{n("connect_stripe",!0),i()}})})]}),(0,Z.tZ)(eK.mz,{primaryButton:o?(0,Z.tZ)(ee.zx,{type:"submit",priority:"primary",onClick:i,children:l("Next")}):(0,Z.tZ)(ee.zx,{type:"submit",priority:"secondary",onClick:()=>{o||r("connect_stripe"),i()},children:l("Skip")})})]})},uo=e=>{let{onConnect:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ul,{}),(0,Z.BX)(et.tu,{alignItems:"center",gap:4,children:[(0,Z.tZ)(ei.xv.H2,{translated:!0,children:"Going paid takes 5 minutes!"}),(0,Z.BX)(ei.xv.B4,{align:"center",color:"secondary",translated:!0,children:["Turning on paid subscriptions can help you find supporters for your writing. If you're not ready yet,"," ",(0,Z.tZ)("a",{className:ut.secondaryTextLink,href:"/publish/settings#connect",target:"_blank",rel:"noopener",children:"pledges"})," ","will let readers show their support."]})]}),(0,Z.tZ)("a",{className:ut.plainLink,href:"/api/v1/stripe/authorize",target:"_blank",rel:"noopener",children:(0,Z.tZ)(ee.zx,{type:"submit",priority:"primary",onClick:t,children:i("Connect to Stripe")})})]})},ua=()=>(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ul,{}),(0,Z.BX)(et.tu,{alignItems:"center",gap:4,children:[(0,Z.tZ)(ei.xv.H2,{translated:!0,children:"Youâ€™re all set!"}),(0,Z.tZ)(ei.xv.B3,{align:"center",color:"secondary",translated:!0,children:"Youâ€™ve turned on paid subscriptions and are ready to collect subscriptions from readers"})]})]}),ul=()=>(0,Z.tZ)("img",{src:(0,en.zF4)("/img/home_page/finance.png"),className:ut.goingPaidIllustration,alt:"podcaster-illustration"}),us=e=>{let{onClose:t,onNext:i,checklistState:n,pub:r,onComplete:o,user:a}=e,{iString:l}=(0,Q.M1)();return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:t,title:"Share your Substack"}),(0,Z.BX)(eK.fe,{children:[(0,Z.tZ)(ue,{checklistState:n}),(0,Z.BX)(et.tu,{paddingY:24,gap:40,children:[(0,Z.tZ)(z.Wi,{pub:r,profile:null,post:null,comment:null}),(0,Z.tZ)(et.tu,{children:(0,Z.tZ)(z.Gj,{pub:r,shareName:r.name,shareUrl:(()=>{let e={r:(null==a?void 0:a.id)?a.id.toString(36):null,utm_campaign:J.VX.pubShareChecklist};return(0,en.n1t)("".concat(r.base_url,"/"),e)})(),sharingSelfPub:!0,onChange:()=>{o("share_pub")}})})]})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(et.gq,{alignItems:"center",gap:8,children:(0,Z.tZ)(ee.zx,{type:"submit",onClick:i,priority:"primary",children:l("Next")})})})]})};var ud=i(20553),uc=i(57560),uu=i(52066),up=i(3624),uh=i(67358),um=i(46621),ug=i(32261),uv=i(18976),ub=i(88452),uy=i(45634),uf=i(55014),u_=i(82030),uZ=i(41445);function uw(){let e=(0,G._)(["No worries if you don't have a list yetâ€”Substack will help you build one."]);return uw=function(){return e},e}class uC extends ub.Z{render(e,t){let{}=e,{uploading:i,percentComplete:n}=t;return(0,Z.tZ)("span",{className:"file-upload-progress",children:i?"(".concat(Math.round(100*n),"% complete)"):""})}}class ux extends w.Component{importFile(){let{iString:e}=this.props;if(this.state.file){if(!this.checkbox||!this.checkbox.checked){alert(e("Please confirm that everybody on this list has opted in to get email from you"));return}this.setState({importing:!0}),this.importer&&this.importer.uploadFile(this.state.file)}}renderPreUploadFlow(){let{iString:e}=this.props;return[(0,Z.tZ)("div",{className:"tw-mb-6",children:(0,Z.tZ)(uf.G,{onFileSelected:this.onFileSelected,dropCTA:e("Drop .csv, .xlsx, or .ods file here"),pickCTA:(0,Z.tZ)(ee.zx,{className:uZ.Z.selectCSVBtn,priority:"primary",children:e("Select file")}),className:"white-bg"})})]}renderUploadFlow(e){var t,i;let{iString:n}=this.props;return[(0,Z.tZ)(uv.Z,{documentName:null!==(i=null===(t=this.state.file)||void 0===t?void 0:t.name)&&void 0!==i?i:""}),(0,Z.tZ)(uC,{ref:this.assignImporter,urls:["/api/v1/import.json?publication_id=".concat(this.props.pub.id)],onError:()=>this.setState({importing:!1}),onAbort:()=>this.setState({importing:!1}),onUpload:e}),(0,Z.tZ)("div",{className:"email-import-settings tw-mt-6 tw-mb-6",children:(0,Z.BX)("label",{className:"setting-group",children:[(0,Z.tZ)("p",{className:"import-setting required",children:n("These people have opted in to receiving emails")}),(0,Z.tZ)("input",{type:"checkbox",ref:this.assignCheckbox})]})}),(0,Z.BX)("p",{className:"side-by-side-buttons",children:[(0,Z.tZ)("a",{className:"button outline",href:"javascript:void(0)",onClick:()=>!this.state.importing&&this.setState({file:null}),children:n("Cancel")}),(0,Z.tZ)("a",{className:"button primary",href:"javascript:void(0)",onClick:()=>!this.state.importing&&this.importFile(),children:n("Import")})]})]}render(e){var t;let i,{onSuccess:n,importData:r,newVersion:o,iString:a,iTemplate:l}=e,s={MailchimpImporter:{name:"Mailchimp",url:u_.Z.MAILCHIMP},MailchimpArchiveImporter:{name:"Mailchimp",url:u_.Z.MAILCHIMP}}[null!==(t=null==r?void 0:r.importer_name)&&void 0!==t?t:"undefined"];i=s?(0,Z.BX)(ei.xv,{as:"p",translated:!0,children:[(0,Z.BX)("a",{href:s.url,target:"_blank",rel:"noopener nofollow",children:["Export your mailing list from ",I18N.p(s.name)]})," ","and import it here."]}):(0,Z.BX)(ei.xv,{as:"p",translated:!0,children:["Bring your list from"," ",(0,Z.tZ)("a",{href:u_.Z.PATREON,target:"_blank",rel:"noopener nofollow",children:"Patreon"}),","," ",(0,Z.tZ)("a",{href:u_.Z.GHOST,target:"_blank",rel:"noopener nofollow",children:"Ghost"}),","," ",(0,Z.tZ)("a",{href:u_.Z.MAILCHIMP,target:"_blank",rel:"noopener nofollow",children:"Mailchimp"}),","," ",(0,Z.tZ)("a",{href:u_.Z.TINYLETTER,target:"_blank",rel:"noopener nofollow",children:"TinyLetter"}),", and more."]});let d=o?(0,Z.BX)(ei.xv,{as:"p",translated:!0,children:["Bring your list from"," ",(0,Z.tZ)("a",{href:u_.Z.PATREON,target:"_blank",rel:"noopener nofollow",children:"Patreon"}),","," ",(0,Z.tZ)("a",{href:u_.Z.GHOST,target:"_blank",rel:"noopener nofollow",children:"Ghost"}),","," ",(0,Z.tZ)("a",{href:u_.Z.MAILCHIMP,target:"_blank",rel:"noopener nofollow",children:"Mailchimp"}),","," ",(0,Z.tZ)("a",{href:u_.Z.TINYLETTER,target:"_blank",rel:"noopener nofollow",children:"TinyLetter"}),", and more. No worries if you don't have a list yetâ€”Substack will help you build one."]}):l(uw());return(0,Z.tZ)(uy.H,{title:a("Import your mailing list"),subtitle:d,className:k()("import-list",{nopad:o&&!this.state.file}),bigTitle:o,children:[o?null:i,this.state.file?this.renderUploadFlow(n):this.renderPreUploadFlow()]})}constructor(...e){super(...e),(0,M._)(this,"checkbox",void 0),(0,M._)(this,"importer",void 0),(0,M._)(this,"assignCheckbox",e=>{this.checkbox=e}),(0,M._)(this,"assignImporter",e=>{this.importer=e}),(0,M._)(this,"onFileSelected",async e=>{this.setState({file:e})})}}let uS=(0,Q.fz)(ux);function uk(){let e=(0,G._)(["Check out ",""]);return uk=function(){return e},e}let uB=e=>{let{id:t,icon:i,title:n,expanded:r,handleExpanded:o,children:a}=e;return(0,Z.BX)(et.tu,{className:ut.topBorder,paddingBottom:16,children:[(0,Z.BX)(et.gq,{className:ut.clickable,paddingTop:16,alignItems:"center",justifyContent:"space-between",onClick:()=>o(t,!r),children:[(0,Z.BX)(et.gq,{gap:12,alignItems:"center",children:[i,(0,Z.tZ)(ei.xv.B4,{weight:"bold",children:n})]}),r?(0,Z.tZ)(iv.Z,{size:20}):(0,Z.tZ)(ib.Z,{size:20})]}),r&&(0,Z.tZ)(et.tu,{gap:12,paddingTop:24,children:a})]})},uT=e=>{let{expanded:t,handleExpanded:i}=e,{iString:n}=(0,Q.M1)(),[r,o]=(0,A.eJ)(""),[a,l]=(0,A.eJ)(!1),s=!!r.trim(),d=async()=>{l(!0);try{await N().post("/api/v1/subscriber/add").send({email:r,sendEmail:!1}),c()}catch(e){u(e)}finally{l(!1)}},c=()=>{(0,O.ZP)(n("Success! These emails will be added as free subscribers shortly")),o("")},u=e=>{(0,O.ZP)((0,Y.zx)(e))};return(0,Z.tZ)(uB,{id:1,icon:(0,Z.tZ)(ud.Z,{size:15}),title:n('"Add subscribers by email"'),expanded:t,handleExpanded:i,children:(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Add friends and family to your subscriber list. Don't worry, we won't notify them until you post."}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)("input",{className:ut.emailInput,type:"text",name:"email",placeholder:n("Type emails here (separated by commas)"),value:r,onInput:e=>o(e.target.value),onChange:e=>o(e.target.value)}),s&&(0,Z.tZ)(et.tu,{children:(0,Z.tZ)(ee.zx,{onClick:d,disabled:a,size:"sm",priority:"primary",children:n("Add Subscribers")})})]})]})})},uI=e=>{let{pub:t,emailListCompleted:i,handleListUploaded:n,expanded:r,handleExpanded:o}=e,{iString:a}=(0,Q.M1)();return(0,Z.tZ)(uB,{id:2,icon:(0,Z.tZ)(uc.Z,{size:15}),title:a("Import an email list"),expanded:r,handleExpanded:o,children:(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Bring your list from Patreon, Mailchimp, Ghost, TinyLetter, and more. Don't worry if you don't have a list yetâ€”Substack will help you build one"}),(0,Z.tZ)(et.tu,{className:k()(ut.emailImportWrap,ut.limitedHeight),border:"detail",alignItems:"center",justifyContent:"center",children:i?(0,Z.BX)(et.gq,{justifyContent:"center",alignItems:"center",gap:12,children:[(0,Z.tZ)(ei.xv,{color:"secondary",translated:!0,children:"Email list imported"}),(0,Z.tZ)(ud.Z,{stroke:"#808080"})]}):(0,Z.tZ)(uS,{pub:t,onSuccess:n})})]})})},uN=e=>{let{pub:t,expanded:i,handleExpanded:n}=e,{iString:r,iTemplate:o}=(0,Q.M1)(),a=(0,j.W1P)(t,{addBase:!0}),l=e=>{let{icon:t,label:i,onClick:n}=e;return(0,Z.BX)(et.tu,{className:ut.clickable,gap:8,onClick:n,justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(et.hs,{alignItems:"center",justifyContent:"center",bg:"secondary",radius:"lg",padding:12,children:t}),(0,Z.tZ)(ei.xv.B4,{align:"center",color:"secondary",children:i})]})};return(0,Z.tZ)(uB,{id:3,icon:(0,Z.tZ)(tI.Z,{size:15}),title:r("Share a link to your substack"),expanded:i,handleExpanded:n,children:(0,Z.BX)(et.gq,{gap:12,alignItems:"center",justifyContent:"space-between",paddingX:20,children:[(0,Z.tZ)(l,{icon:(0,Z.tZ)(tI.Z,{size:20,color:"grey"}),label:r("Copy link"),onClick:()=>{(0,Y.vQ)((0,j.rhs)(a))}}),(0,Z.tZ)(l,{icon:(0,Z.tZ)(uu.Z,{size:20,color:"grey"}),label:"Twitter",onClick:()=>{window.open("".concat("https://twitter.com","/share?").concat((0,j.Y$Q)({url:(0,j.rhs)(a,{utm_source:J.b3.twitter})})))}}),(0,Z.tZ)(l,{icon:(0,Z.tZ)(up.Z,{size:20,color:"grey"}),label:"Facebook",onClick:()=>{window.open("https://www.facebook.com/sharer/sharer.php?".concat((0,j.Y$Q)({u:(0,j.rhs)(a,{utm_source:J.b3.facebook})})))}}),(0,Z.tZ)(l,{icon:(0,Z.tZ)(uh.Z,{size:20,color:"grey"}),label:r("Email"),onClick:()=>{window.open("mailto:?".concat((0,j.Y$Q)({subject:o(uk(),t.name),body:(0,j.rhs)(a,{utm_source:J.b3.email})})))}})]})})},uP=e=>{let{onClose:t,pub:i,subscribers:n,onComplete:r,onNext:o,emailListCompleted:a=!1,checklistState:l}=e,{iString:s,iPlural:d}=(0,Q.M1)(),c={1:!1,2:!1,3:!1},[u,p]=(0,A.eJ)((0,_._)((0,f._)({},c),{1:!0})),h=(e,t)=>{if(!t){p((0,_._)((0,f._)({},u),{[e]:!1}));return}p((0,_._)((0,f._)({},c),{[e]:!0}))},m=1===l.tenSubscribers;return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:t,title:s("Get your first 10 subscribers")}),(0,Z.BX)("form",{onSubmit:e=>{e.preventDefault()},children:[(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{paddingY:20,gap:32,children:[(0,Z.BX)(et.tu,{padding:24,gap:12,radius:"md",bg:"secondary",alignItems:"center",children:[(0,Z.tZ)(um.Z,{size:20}),n.length<1?(0,Z.tZ)(ei.xv.B4,{align:"center",color:"secondary",translated:!0,children:"You don't have any subscribers yet! Get your first 10 subscribers by using some of the methods below"}):n.length<10?(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(ei.xv.H4,{align:"center",children:d("You have your first subscriber!","You have your first %1 subscribers!",n.length)}),(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",gap:4,children:[n.map(e=>{var t;return(0,Z.tZ)("a",{href:(0,j.NNq)(e.user,{utm_source:J.b3.email}),style:{lineHeight:0},children:(0,Z.tZ)(ug.fi,{photo_url:null===(t=e.user)||void 0===t?void 0:t.photo_url,size:32})})}),Array.from({length:10-n.length}).map(()=>(0,Z.tZ)(et.hs,{className:ut.emptySubscriber}))]})]}):(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.BX)(ei.xv.H4,{align:"center",translated:!0,children:["You've got ",I18N.p(11===n.length?"10+":n.length)," subscribers!"]}),(0,Z.tZ)(et.gq,{alignItems:"center",justifyContent:"space-between",gap:4,children:n.slice(0,10).map(e=>{var t;return(0,Z.tZ)("a",{href:(0,j.NNq)(e.user,{utm_source:J.b3.email}),style:{lineHeight:0},children:(0,Z.tZ)(ug.fi,{photo_url:null===(t=e.user)||void 0===t?void 0:t.photo_url,size:32})})})})]})]}),(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(uT,{expanded:!!u[1],handleExpanded:h}),(0,Z.tZ)(uI,{pub:i,emailListCompleted:a,handleListUploaded:()=>{r("email_list")},expanded:!!u[2],handleExpanded:h}),(0,Z.tZ)(uN,{pub:i,expanded:!!u[3],handleExpanded:h})]})]})}),(0,Z.tZ)(eK.mz,{primaryButton:m?(0,Z.tZ)(ee.zx,{type:"submit",priority:"primary",onClick:o,children:s("Next")}):(0,Z.tZ)(ee.zx,{type:"submit",priority:"secondary",onClick:o,children:s("Skip")})})]})]})};function uE(e,t,i){let n=Object.values(t).every(e=>1===e),r=i.indexOf(e||"")||0;switch(e){case null:if(1!==t.basics||n)return"basics";case"basics":if(1!==t.paid||n)return i[r+1];case"paid":if(1!==t.tenSubscribers||n)return i[r+1];case"tenSubscribers":return i[r+1];case"sharePub":if(1!==t.firstPost||n)return i[r+1];default:return null}}let uX=e=>{var t,i,n;let{isOpen:r,pub:o,user:a,subscribers:l,onClose:s,onComplete:d,onSkip:c,checklistItems:u,checklistState:p,selectedStage:h,stepsForUser:m}=e,[g,v]=(0,A.eJ)(h);(0,A.d4)(()=>{let e=h||uE(null,p,m);e?v(e):s()},[h]);let b=()=>{let e=uE(g,p,m);e?v(e):s()};return(0,Z.BX)(eK.u_,{isOpen:r,onClose:s,children:["basics"===g&&(0,Z.tZ)(ui,{pub:o,onClose:s,onNext:b,onComplete:d,checklistState:p}),"paid"===g&&(0,Z.tZ)(ur,{onClose:s,onComplete:d,onSkip:c,onNext:b,checklistState:p,stripeCompleted:!!(null==u?void 0:null===(t=u.connect_stripe)||void 0===t?void 0:t.completed_at),paidTurnedOn:!!(null==u?void 0:null===(i=u.turn_on_paid)||void 0===i?void 0:i.completed_at)}),"tenSubscribers"===g&&(0,Z.tZ)(uP,{pub:o,subscribers:l,onClose:s,onNext:b,onComplete:d,checklistState:p,emailListCompleted:!!(null==u?void 0:null===(n=u.email_list)||void 0===n?void 0:n.completed_at)}),"sharePub"===g&&(0,Z.tZ)(us,{pub:o,user:a,onClose:s,onNext:b,onComplete:d,onSkip:c,checklistState:p}),"firstPost"===g&&(0,Z.tZ)(un,{onClose:s,checklistState:p})]})},uM={checklist:"checklist-Op2y9t",launchItem:"launchItem-InFWyI",doneIcon:"doneIcon-mH6vVl",notDoneIcon:"notDoneIcon-TOi10T",rightArrowIcon:"rightArrowIcon-LKuE7N",embedded:"embedded-a3gcSY"},uA="/api/v1/publication_launch_checklist",uD=e=>{let{dismissChecklist:t,showDismiss:i}=e;return(0,Z.BX)(Z.HY,{children:[i&&(0,Z.tZ)(ee.hU,{priority:"tertiary","aria-label":"Close",className:"dashboard-action-box-close",onClick:t,style:{alignSelf:"flex-end"},children:(0,Z.tZ)(K.Z,{size:20,"aria-hidden":!0})}),(0,Z.BX)(et.tu,{padding:32,gap:4,children:[(0,Z.tZ)(ei.xv.B4,{align:"center",children:(0,Z.tZ)("img",{src:(0,j.zF4)("/img/dashboard/gear.png",85),height:50,width:85})}),(0,Z.tZ)(ei.xv.H3,{align:"center",translated:!0,children:"Welcome to your Substack dashboard!"}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",align:"center",translated:!0,children:"Congratulations on setting up your Substack! Let's get you set up for success"})]})]})},uR=e=>{let{pub:t,user:i,onChecklistCompleted:n,postCount:r,embedded:o,setShowingChecklist:a}=e,{iString:l}=(0,Q.M1)(),[s,d]=(0,A.eJ)(!1),[c,u]=(0,A.eJ)(!1),[p,h]=(0,A.eJ)(null),[m,g]=(0,A.eJ)(!1),[v,b]=(0,A.eJ)(null),[y,w]=(0,A.eJ)([]),[C,x]=(0,A.eJ)([]),[S,B]=(0,A.eJ)({createSubstack:1,basics:.5}),[T,I]=(0,A.eJ)(null),[P,E]=(0,A.eJ)(!1),X=(0,H.Z)(t.created_at),M=Object.values(S).reduce((e,t)=>e+("number"==typeof t?t:0),0),D=M>=6&&1===S.tenSubscribers,R=(0,Y.K1)(),F=!m&&s&&!P&&!D&&(!r||r<=3),L=r&&r>1||X<(0,H.Z)().subtract(7,"day"),z=(0,A.I4)(async()=>{let e=await N()(uA).send(),t=e.body.items,i=e.body.audience,n=e.body.subscribers,r=e.body.manuallyDismissed,o=e.body.steps;h(t),g(r),b(i),w(n||[]),t.checklist_complete&&E(!0),x(o)},[]);(0,A.d4)(()=>{let e=(0,iP.x)("checklist");e&&["basics","paid","tenSubscribers","firstPost"].includes(e)&&(I(e),u(!0)),z()},[]),(0,A.d4)(()=>{P&&n()},[P,n]),(0,A.d4)(()=>{p&&(B(e=>(0,f._)({},e,function(e,t){var i,n,r,o,a;let{numSubscribers:l}=t,s={basics:.5,paid:0,firstPost:0,sharePub:0,tenSubscribers:0};return(null===(i=e.upload_logo)||void 0===i?void 0:i.completed_at)&&(s.basics+=.5),(null===(n=e.connect_stripe)||void 0===n?void 0:n.completed_at)&&(s.paid=(s.paid||0)+1),(null===(r=e.first_post)||void 0===r?void 0:r.completed_at)&&(s.firstPost=1),(null===(o=e.share_pub)||void 0===o?void 0:o.completed_at)&&(s.sharePub=1),(null===(a=e.ten_subscribers)||void 0===a?void 0:a.completed_at)?s.tenSubscribers=1:l>0&&(1===l?s.tenSubscribers=.1:2===l?s.tenSubscribers=.2:3===l?s.tenSubscribers=.3:4===l?s.tenSubscribers=.4:5===l?s.tenSubscribers=.5:6===l?s.tenSubscribers=.6:7===l?s.tenSubscribers=.7:8===l?s.tenSubscribers=.8:9===l?s.tenSubscribers=.9:s.tenSubscribers=1),s}(p,{numSubscribers:y.length}))),d(!0))},[p,v,y.length]),(0,A.d4)(()=>{a&&s&&(a(F),F&&(0,U.j)(U.FP.LAUNCH_CHECKLIST_SEEN))},[F,s,a]);let O=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=new Date;t||await N().put(uA).send({[e]:{completed_at:i}}),h(t=>(0,_._)((0,f._)({},t),{[e]:(0,_._)((0,f._)({},t[e]),{completed_at:i})}))},j=async e=>{let t=new Date;await N().put(uA).send({[e]:{skipped_at:t}}),h(i=>(0,_._)((0,f._)({},i),{[e]:(0,_._)((0,f._)({},i[e]),{skipped_at:t})}))},J=e=>{I(e),u(!0)},V=async()=>{await N().put("/api/v1/publication_settings").send({new_publication_checklist_dismissed:!0}),g(!0),z()},q=e=>Object.keys(e).reduce((t,i)=>(C.includes(i)&&(t[i]=e[i]),t),{});return F?(0,Z.BX)(et.tu,{border:"detail",radius:"md",className:k()(uM.checklist,{[uM.embedded]:o}),flex:o?"grow":"auto",children:[o&&(0,Z.tZ)(uD,{dismissChecklist:V,showDismiss:L}),(0,Z.BX)(et.tu,{paddingX:o&&R?16:o?48:32,paddingY:o&&R?16:32,gap:16,borderTop:o?"detail":void 0,bg:o?"secondary":"primary",children:[!o&&(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.H2,{translated:!0,children:"Congratulations! Letâ€™s publish a great launch post"}),(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"Youâ€™ve created your Substack. Hereâ€™s what we recommend next:"})]}),(0,Z.BX)(et.tu,{gap:12*!!o,children:[!o&&(0,Z.tZ)(ue,{checklistState:q(S)}),(0,Z.tZ)(uF,{title:l("Create a Substack"),done:!0,embedded:o}),C.includes("basics")&&(0,Z.tZ)(uF,{title:l("Set up the basics"),done:1===S.basics,onClick:()=>J("basics"),embedded:o}),C.includes("paid")&&(0,Z.tZ)(uF,{title:l("Turn on paid"),done:1===S.paid,onClick:()=>J("paid"),embedded:o}),C.includes("tenSubscribers")&&(0,Z.tZ)(uF,{title:l("Get your first 10 subscribers"),done:1===S.tenSubscribers,onClick:()=>J("tenSubscribers"),embedded:o}),C.includes("sharePub")&&(0,Z.tZ)(uF,{title:l("Share your Substack"),done:1===S.sharePub,onClick:()=>J("sharePub"),embedded:o}),C.includes("firstPost")&&(0,Z.tZ)(uF,{title:l("Create your first post"),done:1===S.firstPost,onClick:()=>J("firstPost"),embedded:o})]}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{I(Object.keys(q(S)).find(e=>q(S)[e]<1)),u(!0)},children:l(o?"Complete Setup":"Continue Setup")})]}),(0,Z.tZ)(uX,{isOpen:c,pub:t,user:i,subscribers:y,onClose:()=>{I(null),u(!1)},onComplete:O,onSkip:j,checklistItems:p,checklistState:q(S),selectedStage:T,completedSteps:M,stepsForUser:C})]}):null},uF=e=>{let{done:t,title:i,onClick:n,embedded:r}=e;return(0,Z.BX)(et.gq,{gap:12,className:k()(uM.launchItem),paddingY:16,paddingX:r?16:4,alignItems:"center",onClick:()=>{(0,U.j)(U.FP.LAUNCH_CHECKLIST_ITEM_CLICKED,{title:i,done:t,embedded:r}),n&&n()},style:{backgroundColor:r?"white":"transparent"},radius:r?"md":void 0,borderBottom:r?void 0:"detail",children:[t?(0,Z.tZ)(c4.Z,{strokeWidth:2,height:20,className:uM.doneIcon}):(0,Z.tZ)(c1.Z,{size:20,className:uM.notDoneIcon}),(0,Z.tZ)(et.hs,{flex:"grow",children:(0,Z.tZ)(ei.xv.H4,{weight:"bold",color:t?"tertiary":"primary",children:i})}),(0,Z.tZ)(c2.Z,{height:16,className:uM.rightArrowIcon})]})},uL=e=>{var t;let{pub:i,user:n,postCount:r,showLaunchChecklist:o,embedded:a,hideLaunchChecklist:l,showChatReaderParticipationBox:s,showSubscriberReferralsBox:d,showPubIntroTextBox:c,showPledgeTurnOnPaidBox:u,estimatedArr:p,estimatedArrCurrency:h,shouldShowSurveyAnnouncement:m,overrideSurveyAnnouncementDismissKey:g,customNewPubExperience:v,showPhoneNumberExposedBanner:b,mfaActionBoxEnabled:y}=e,[f,_]=(0,A.eJ)(o),{getSettingFor:w,changeSetting:C}=(0,ss.So)(),{getExperimentVariant:x,exposeExperiment:S}=(0,c0.jc)(),k=(0,iS.ib)({pathname:"/api/v1/reader/feed/last-note",auto:!0}),{result:B}=(0,iS.ib)({pathname:"/api/v1/video/youtube/show-banner",auto:!0}),T=!(0,$.f)(cf.uploadToYoutubeCta)&&(null==B?void 0:B.showBanner),I=function(e){let{pub:t}=e;return!!cA({pub:t})}({pub:i})&&!(0,$.f)(cf.syncWithSpotifyCta),N=!(0,$.f)(cf.directMessagingCta),P=!n.reader_installed_at&&!(0,$.f)(cf.appUnifiedHomeCtaDismissKey),E=!k.result&&!(0,$.f)(cf.feedCtaDismissKey),X=k.result&&!(0,$.f)(cf.publicationNotesTabAnnouncement),M=i.threads_v2_enabled&&!((0,$.f)(cf.createChatInviteDraft2CtaKey)||(0,$.f)(cf.createChatInviteDraftCtaKey)),D=(null==i?void 0:i.stripe_user_id)&&(null==i?void 0:i.payments_state)==="disabled"&&!(0,$.f)(cf.enablePaid),R=m&&(g||!(0,$.f)(cf.bestsellerSurveyModal));if(o&&f&&!v)return(0,Z.tZ)(uR,{pub:i,user:n,onChecklistCompleted:l,postCount:r,embedded:a,setShowingChecklist:_});if(R)return(0,Z.tZ)(cL,{overrideSurveyAnnouncementDismissKey:g});let F=(null==i?void 0:i.stripe_country)==="IN"&&(0,H.Z)().isBefore((0,H.Z)("2024-02-01"))&&!(0,$.f)(cf.indianStripeAccount);if(T)return(0,Z.tZ)(cR,{pub:i});if(I)return(0,Z.tZ)(cD,{pub:i});if(!(0,$.f)(cf.exposedPhoneNumber,null,3)&&b)return(0,Z.tZ)(cQ,{});if(y&&(null!==(t=n.bestseller_tier)&&void 0!==t?t:0)>0&&!n.has_mfa_enabled)return(0,Z.tZ)(c$,{});if(N)return(0,Z.tZ)(cM,{});if(F)return(0,Z.tZ)(cE,{});if(P)return(0,Z.tZ)(cN,{});if(E)return(0,Z.tZ)(cT,{});if(X)return(0,Z.tZ)(cz,{pub:i});if(M)return(0,Z.tZ)(cU,{pub:i});if(D)return(0,Z.tZ)(cY,{pub:i});if(s)return(0,Z.tZ)(cH,{pub:i});let L="show_subscriber_import_prompt";if(w(L)){if(S(L),"treatment"===x(L))return(0,Z.tZ)(cJ,{pub:i});C({[L]:!1})}return!(0,$.f)(cf.readerReferral)&&d?(0,Z.tZ)(cV,{pub:i}):!(0,$.f)(cf.pubIntroText)&&c?(0,Z.tZ)(cq,{pub:i}):!(0,$.f)(cf.pledgeTurnOnPaid)&&u&&p&&h&&!w("turn_on_paid_pledge_box_dismissed")?(0,Z.tZ)(cG,{estimatedArr:p,estimatedArrCurrency:h}):null},uz=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(!1);(0,A.d4)(()=>{window.sessionStorage.getItem("seenGAMigrationModal")||(window.sessionStorage.setItem("seenGAMigrationModal","true"),N().put("/api/v1/publication_settings").send({seen_google_analytics_migration_modal:!0}).then(()=>r(!0)))},[]);let o=()=>{r(!1)};return(0,Z.tZ)(eK.u_,{width:500,isOpen:n,onClose:o,children:(0,Z.BX)(et.tu,{paddingX:8,paddingBottom:4,children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:o,title:i("Migrate from Google Analytics 3 to 4")}),(0,Z.tZ)(eK.fe,{children:(0,Z.tZ)(et.tu,{gap:12,children:(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:["Google Analytics 3 will stop serving events on July 1st. We've added support for Google Analytics 4. If you are using Google Analytics to track usage of your publication and would like to keep doing so, please create a GA4 property and add its Measurement ID to your publication settings."," ",(0,Z.tZ)("a",{target:"__blank",href:"https://support.substack.com/hc/en-us/articles/15955098199444",children:"Learn more"}),"."]})})}),(0,Z.tZ)(eK.mz,{showDivider:!1,direction:"row",primaryButton:(0,Z.tZ)(ee.zx,{onClick:()=>{(0,Y.uX)((0,en.wI3)(t,{section:"analytics-settings"}))},priority:"primary",children:i("Update settings")})})]})})};var uO=i(17043);let uU=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(!1),o=()=>r(!1);return(0,A.d4)(()=>{"true"!==window.sessionStorage.getItem("seenGiftsFromSubstackOptinModal")&&(window.sessionStorage.setItem("seenGiftsFromSubstackOptinModal","true"),N().put("/api/v1/publication_settings").send({gifts_from_substack_optin_seen:!0}).then(()=>{(0,U.j)(U.FP.GIFTS_FROM_SUBSTACK_OPTIN_MODAL_SEEN),r(!0)}))},[]),(0,Z.BX)(eK.u_,{isOpen:n,onClose:o,children:[(0,Z.BX)(et.tu,{children:[(0,Z.BX)(et.gq,{justifyContent:"end",padding:16,style:{backgroundColor:"#DFD9D9",borderTopLeftRadius:20,borderTopRightRadius:20},children:[(0,Z.tZ)(et.tu,{flex:"grow",paddingLeft:40,children:(0,Z.tZ)(et.gq,{justifyContent:"center",children:(0,Z.tZ)("img",{src:(0,uO.zF)("/img/publish/gifts_from_substack_launch_modal.png",320),width:320})})}),(0,Z.tZ)(ee.hU,{priority:"secondary",onClick:o,children:(0,Z.tZ)(K.Z,{size:20})})]}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.BX)(et.tu,{gap:2,children:[(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"Now live"}),(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"Substack is funding gift subscriptions for a limited time only."})]}),(0,Z.BX)(ei.xv.B3,{translated:!0,children:["From 10/31 to 11/4, Substack will offer your eligible subscribers a 1 month trial to be redeemed in the app â€“ ",(0,Z.tZ)(ei.xv.B3,{weight:"bold",children:"sent and paid for by Substack."}),(0,Z.tZ)("br",{}),"Engage and grow your list, on us."]})]})})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{href:"https://support.substack.com/hc/articles/31646054622740-What-are-Substack-funded-gifts",onClick:()=>(0,U.j)(U.FP.GIFTS_FROM_SUBSTACK_LEARN_MORE_CLICKED),children:i("Learn more")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",href:(0,j.wI3)(t,{params:{search:"gifts from substack"}}),onClick:()=>(0,U.j)(U.FP.GIFTS_FROM_SUBSTACK_CHANGE_SETTINGS_CLICKED),children:i("Change settings")})})]})};var uY=i(67749),uH=i(56415),uj=i(75472),uJ=i.n(uj),uV=i(56743),uq=i(40989);let uW=e=>(0,Z.BX)(eH.l,(0,_._)((0,f._)({},e),{name:"ChevronUpIcon",svgParams:{height:16,width:16},children:["return ",(0,Z.tZ)("path",{d:"M12 9L8 5L4 9",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"}),";"]})),uG=e=>{var{stroke:t="#757575",strokeWidth:i="1.5",height:n=24,width:r=24}=e,o=(0,ef._)(e,["stroke","strokeWidth","height","width"]);return(0,Z.BX)(eH.l,(0,_._)((0,f._)({},o),{name:"NoResultsIcon",svgParams:{height:n,width:r,viewBox:"0 0 24 24"},children:[(0,Z.tZ)("path",{d:"M15.9286 15.9286L23 23M18.2857 9.64286C18.2857 14.4162 14.4162 18.2857 9.64286 18.2857C4.86954 18.2857 1 14.4162 1 9.64286C1 4.86954 4.86954 1 9.64286 1C14.4162 1 18.2857 4.86954 18.2857 9.64286Z",stroke:t,"stroke-width":i,"stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M6.49937 6.5L12.5363 12.537",stroke:t,"stroke-width":i,"stroke-linecap":"round"}),(0,Z.tZ)("path",{d:"M12.5364 6.5L6.49947 12.537",stroke:t,"stroke-width":i,"stroke-linecap":"round"})]}))};function uK(e){var t;return e instanceof HTMLElement?e:null!==(t=null==e?void 0:e.current)&&void 0!==t?t:null}class uQ extends w.Component{toggle(){let e=!this.state.open;e?(this.removeScrollListeners(),this.open()):this.close(),this.setState({open:e})}updateCoords(){var e,t,i,n;let r=null===(t=uK(this.props.baseRef))||void 0===t?void 0:null===(e=t.getBoundingClientRect)||void 0===e?void 0:e.call(t);if(r){let e=0,t=uK(this.props.baseRef);for(;t=null==t?void 0:t.parentElement;)e+=t.scrollTop;this.setState({coords:{left:r.x+(this.props.rightAlign?r.width:0)+("undefined"!=typeof window?window.scrollX:0)+((null===(i=this.props.offset)||void 0===i?void 0:i.x)||0),top:r.y+e+((null===(n=this.props.offset)||void 0===n?void 0:n.y)||0),width:r.width,height:r.height}})}}componentDidMount(){"undefined"!=typeof window&&window.addEventListener("resize",this.onResize),this.updateCoords(),this.props.hoverToggle&&this.createMouseListeners()}createMouseListeners(){var e,t;null===(e=uK(this.props.baseRef))||void 0===e||e.addEventListener("mouseenter",this.open),null===(t=uK(this.props.baseRef))||void 0===t||t.addEventListener("mouseleave",this.close)}removeMouseListeners(){var e,t;null===(e=uK(this.props.baseRef))||void 0===e||e.removeEventListener("mouseenter",this.open),null===(t=uK(this.props.baseRef))||void 0===t||t.removeEventListener("mouseleave",this.close)}componentDidUnmount(){"undefined"!=typeof window&&window.removeEventListener("resize",this.onResize),this.removeScrollListeners(),this.removeMouseListeners()}onScroll(e){var t;let i=null==e?void 0:e.getBoundingClientRect(),n=null===(t=uK(this.props.baseRef))||void 0===t?void 0:t.getBoundingClientRect();if(!i||!n)return;let r=e=>{let{x:t,y:i}=e;return l<=t&&t<=s&&o<=i&&i<=a},{top:o,bottom:a,left:l,right:s}=i;r({x:n.left,y:n.top})||r({x:n.right,y:n.top})||r({x:n.left,y:n.bottom})||r({x:n.right,y:n.bottom})?(this.updateCoords(),this.props.hoverToggle?this.createMouseListeners():this.state.open&&this.props.onOpen&&this.props.onOpen()):(this.removeMouseListeners(),this.props.onClose&&this.props.onClose())}removeScrollListeners(){this.scrollListenersToRemove.forEach(e=>e())}createScrollListeners(){var e;this.scrollListenersToRemove=(null!==(e=this.props.scrollContainers)&&void 0!==e?e:[]).map(e=>{let t=uK(e),i=ip()(()=>this.onScroll(t),10);return null==t||t.addEventListener("scroll",i),()=>null==t?void 0:t.removeEventListener("scroll",i)})}componentShouldUpdate(e,t){return!eC()(this.props,e)||!eC()(this.state,t)}componentDidUpdate(e){if(!eC()(e.scrollContainers,this.props.scrollContainers)&&this.scrollListenersToRemove.length>0&&(this.removeScrollListeners(),this.createScrollListeners()),!eC()(e.baseRef,this.props.baseRef)){var t,i;null===(t=uK(this.props.baseRef))||void 0===t||t.removeEventListener("mouseenter",this.open),null===(i=uK(this.props.baseRef))||void 0===i||i.removeEventListener("mouseleave",this.close),this.props.hoverToggle&&this.createMouseListeners()}}render(e,t){let{children:i,rootElement:n,className:r}=e,{coords:o}=t;return"undefined"==typeof window||(0,Y.K1)()?null:(0,to.createPortal)((0,Z.tZ)("div",{style:(0,f._)({},o),className:k()("tooltip-portal",r),ref:this.portalRef,children:i}),n||document.body)}constructor(e,t){super(e,t),(0,M._)(this,"onResize",void 0),(0,M._)(this,"scrollListenersToRemove",void 0),(0,M._)(this,"portalRef",void 0),(0,M._)(this,"open",()=>{this.updateCoords(),this.createScrollListeners(),document.addEventListener("mouseup",this.onDocumentMouseUp),document.addEventListener("keydown",this.onDocumentKeyDown),this.props.onOpen&&this.props.onOpen()}),(0,M._)(this,"close",()=>{this.removeScrollListeners(),document.removeEventListener("mouseup",this.onDocumentMouseUp),document.removeEventListener("keydown",this.onDocumentKeyDown),this.props.onClose&&this.props.onClose()}),(0,M._)(this,"onDocumentMouseUp",e=>{var t,i;!(0,Y.rs)(e.target,null!==(t=this.portalRef.current)&&void 0!==t?t:void 0,null!==(i=uK(this.props.baseRef))&&void 0!==i?i:void 0)&&this.state.open&&(this.close(),this.setState({open:!1}))}),(0,M._)(this,"onDocumentKeyDown",e=>{"Escape"===e.key&&this.state.open&&(this.close(),this.setState({open:!1}))}),this.onResize=ip()(this.updateCoords.bind(this)),this.scrollListenersToRemove=[],this.state={coords:{},open:!1},this.portalRef=(0,w.createRef)()}}uQ.defaultProps={scrollContainers:[]};var u$=i(77199);let u0=e=>{let{title:t,text:i,icon:n,action:r}=e;return(0,Z.tZ)(tp.mb,{icon:n||(0,Z.tZ)(u$.Z,{}),title:t,text:i,action:r})},u1={minimalTable:"minimalTable-jQJ9Tx",minimalHeaderButton:"minimalHeaderButton-Jl0iPO"};function u2(){let e=(0,G._)(["","-"," of ",""]);return u2=function(){return e},e}function u4(){let e=(0,G._)(["Select all ",""]);return u4=function(){return e},e}let u3=function(e,t){let{language:i="en"}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{iString:n}=I18N.i(i),r=n("Not yet available");return"-"===e?"-":void 0!==e?t(e):r};var u8=((s={}).Asc="asc",s.Desc="desc",s);let u6=e=>{let{headerKey:t,name:i,sortable:n,align:r,hoverText:o,onSort:a,sort:l,isAllSelected:s,onSelectAll:d,noBackground:c}=e,u=(0,A.sO)(null),p=(0,A.sO)(),h=l&&"desc"===l.direction?(0,Z.tZ)(uq.Z,{}):(0,Z.tZ)(uW,{});return(0,Z.BX)("th",{className:k()({sortable:n,"align-right":"right"===r,"no-bg":c}),onClick:()=>{n&&(l&&l.by===t&&"asc"!==l.direction?a&&a({by:t,direction:"asc"}):a&&a({by:t,direction:"desc"}))},children:[d&&(0,Z.tZ)("input",{type:"checkbox",checked:s,onChange:d}),(0,Z.BX)("span",{children:[(0,Z.BX)("span",{className:"label",ref:p,children:[o&&(0,Z.tZ)(uQ,{baseRef:p,hoverToggle:!0,onOpen:()=>{var e;null===(e=u.current)||void 0===e||e.open()},onClose:()=>{var e;null===(e=u.current)||void 0===e||e.close()},children:(0,Z.tZ)(eY.Fx,{ref:u,noList:!0,className:"explanation",children:o})}),(0,Z.tZ)("span",{className:"label-text",children:i})]}),n&&(0,Z.tZ)("span",{className:k()("indicator",{visible:(null==l?void 0:l.by)===t,desc:(null==l?void 0:l.direction)==="desc",asc:(null==l?void 0:l.direction)==="asc"}),children:h})]})]})},u5=e=>{let{offset:t,loading:i,rows:n,hasMoreRows:r,onNextPage:o,onPrevPage:a,total:l}=e,{iTemplate:s}=(0,Q.M1)();return(0,Z.tZ)("div",{"data-testid":"pagination",className:"data-table-pagination",children:(0,Z.BX)("div",{className:k()("align-right",{silhouette:i}),children:[(0,Z.tZ)("span",{className:"data-table-pagination-text",children:(0,Z.tZ)("span",{className:"content",children:s(u2(),l>0?t+1:0,t+n.length,l)})}),(0,Z.BX)("div",{className:"data-table-pagination-buttons",children:[(0,Z.tZ)(ee.hU,{size:"sm",priority:"secondary-outline",disabled:i||0===t,onClick:a,children:(0,Z.tZ)(uV.Z,{size:16})}),(0,Z.tZ)(ee.hU,{size:"sm",priority:"secondary-outline",disabled:i||!r,onClick:o,children:(0,Z.tZ)(ez.Z,{size:16})})]})]})})},u9=e=>{let{cols:t,rows:i,appendMode:n,hideHeaders:r,isPannable:o,getRowIcon:a,sort:l,onSort:s,empty:d,offset:c=0,total:u=0,hasMoreRows:p,onPrevPage:h,onNextPage:m,placeholderRows:g,loading:v=!1,error:b,selectedValues:y,setSelectedValues:w,getRowKey:C,noBorder:x=!1,hidePagination:S=!1}=e,{iString:B,iTemplate:T}=(0,Q.M1)(),I=v&&(!i||0===i.length),N=!!y&&!!w&&!!C,P={selectedRowValues:[],dynamicTotal:0},E=N?y.selectedRowValues.length:0,X=!v&&N&&E===i.length,M=N?y.selectedRowValues.reduce((e,t)=>e.add(t),new Set):new Set,A=N?e=>{if(X&&!e){w(P);return}let t=[];i.forEach(e=>t.push(C(e))),w({selectedRowValues:t,dynamicTotal:e?u:0})}:null,D=N?()=>{w(P),h()}:h,R=N?()=>{if(n){w((0,_._)((0,f._)({},y),{dynamicTotal:0})),m();return}w(P),m()}:m,F=N?e=>{w(P),s(e)}:s;return d||(d=(0,Z.tZ)(u0,{title:B("No data"),icon:(0,Z.tZ)(uG,{})})),(0,Z.BX)(Z.HY,{children:[b?(0,Z.tZ)("div",{"data-testid":"error-row",className:"empty-row",children:(0,Z.tZ)(u0,{icon:(0,Z.tZ)(eN.Z,{}),title:B("Failed to load"),text:B("Please try reloading the page"),action:(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-outline",onClick:()=>location.reload(),children:B("Reload page")})})}):(null==i?void 0:i.length)!==0||I?(0,Z.tZ)("div",{className:k()("scrolling-table-container",{"with-pagination":!n,"no-border":x}),children:(0,Z.BX)("table",{className:k()("custom data-table",{"is-pannable":o,"narrow-rows":N}),children:[!r&&(0,Z.tZ)("thead",{children:(0,Z.tZ)("tr",{className:k()({"has-row-icon":!!a,"has-checkbox":N}),children:t.map((e,t)=>{let{key:i,name:n,sortable:r,align:o,hoverText:a}=e;return(0,Z.tZ)(u6,{headerKey:i,name:n,sortable:r,align:o,hoverText:a,onSort:F,sort:l,onSelectAll:N&&!v&&0===t&&(()=>A(!1)),isAllSelected:N&&X,noBackground:x})})})}),(0,Z.BX)("tbody",{children:[X&&p&&(0,Z.tZ)("tr",{className:"bulk-select-row",children:(0,Z.BX)("td",{colSpan:5,children:[y.dynamicTotal||E," rows selected.",(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-outline",onClick:()=>{A(!y.dynamicTotal)},children:y.dynamicTotal?B("Clear selection"):T(u4(),u)})]})}),I?g:null==i?void 0:i.map(e=>(0,Z.tZ)("tr",{className:k()({"has-row-icon":!!a,"has-checkbox":N}),children:t.map((t,i)=>{let{key:n,align:r,wrap:o=!0,valueFn:l,compact:s}=t,d=N?C(e):"";return(0,Z.tZ)("td",{className:k()({silhouette:v,"align-right":"right"===r,"compact-cell":s}),children:(0,Z.tZ)("span",{className:"outer",children:(0,Z.BX)("span",{className:k()("content",{"no-wrap":!o}),children:[0===i&&a?(0,Z.tZ)("span",{className:"row-icon",children:a(e)}):"",0===i&&N?(0,Z.tZ)("input",{type:"checkbox",checked:M.has(d),onChange:()=>{if(M.has(d)){w({selectedRowValues:y.selectedRowValues.filter(e=>e!=d),dynamicTotal:0});return}w({selectedRowValues:y.selectedRowValues.concat([d]),dynamicTotal:0})}}):"",l?l(e):e[n]]})})})})}))]})]})}):(0,Z.tZ)("div",{"data-testid":"empty-row",className:"empty-row",children:(0,Z.tZ)("div",{children:d})}),!b&&(null==i?void 0:i.length)?n?p?(0,Z.tZ)(ee.zx,{disabled:v,size:"sm",priority:"secondary",onClick:R,children:B(v?"Loading...":"Load more")}):null:S?(0,Z.tZ)("div",{className:"data-table-pagination"}):(0,Z.tZ)(u5,{loading:v,rows:i,hasMoreRows:p,total:u,offset:c,cols:t,onNextPage:R,onPrevPage:D}):null]})},u7=e=>{let{cols:t,rows:i,className:n,sort:r,setSort:o,appendMode:a,hasMoreRows:l,loading:s,onLoadMore:d}=e,{iString:c}=(0,Q.M1)();return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)("table",{className:k()(u1.minimalTable,n),children:[(0,Z.tZ)("thead",{children:(0,Z.tZ)("tr",{children:t.map(e=>(0,Z.tZ)("th",{children:e.sortable?(0,Z.tZ)(pe,{col:e,sort:r,setSort:o,loading:s}):(0,Z.tZ)(ei.xv.Meta,{color:"primary",children:e.name})}))})}),(0,Z.tZ)("tbody",{children:null==i?void 0:i.map(e=>(0,Z.tZ)("tr",{children:t.map(t=>(0,Z.tZ)("td",{children:(0,Z.tZ)(ei.xv.B4,{children:t.valueFn?t.valueFn(e):e[t.key]})}))}))})]}),a&&l&&(0,Z.tZ)(ts.xu,{paddingY:12,children:(0,Z.tZ)(ee.zx,{disabled:s,priority:"secondary",onClick:d,children:c(s?"Loading..":"Load more")})})]})},pe=e=>{let{col:t,sort:i,setSort:n,loading:r}=e,o=i.by===t.key,a="asc"===i.direction,l=o?r?(0,Z.tZ)(iI.$j,{}):a?(0,Z.tZ)(iv.Z,{}):(0,Z.tZ)(ib.Z,{}):null,s=(0,A.I4)(()=>{let e=o&&a?"desc":"asc";n({by:t.key,direction:e})},[t,n,o,a]);return(0,Z.tZ)(ee.zx,{className:u1.headerButton,priority:"tertiary",trailing:l,onClick:s,children:(0,Z.tZ)(ei.xv.Meta,{color:"primary",children:t.name})})},pt=e=>{var{appendMode:t=!1,rows:i,defaultSort:n,empty:r,pageSize:o=5,noBorder:a=!1}=e,l=(0,ef._)(e,["appendMode","rows","defaultSort","empty","pageSize","noBorder"]);let[s,d]=(0,A.eJ)(n),[c,u]=(0,A.eJ)(1),{iString:p}=(0,Q.M1)();return r||(r=(0,Z.tZ)(u0,{title:p("No data"),icon:(0,Z.tZ)(eL.Z,{})})),(0,Z.tZ)(u9,(0,_._)((0,f._)({},l),{rows:(s?uJ()(i,[s.by],[s.direction]):i).slice(t?0:(c-1)*o,c*o),appendMode:t,sort:s,onSort:d,empty:r,offset:(c-1)*o,total:i.length,hasMoreRows:c*o<i.length,onPrevPage:()=>u(Math.max(0,c-1)),onNextPage:()=>u(Math.min(Math.ceil(i.length/o),c+1)),noBorder:a}))},pi=e=>{let{url:t}=e,[i,n]=(0,A.eJ)(0);return(0,A.d4)(()=>{i&&n(0)},[t]),[i,n]},pn=e=>{let{url:t,deps:i,sort:n,offset:r}=e,[o,a]=(0,A.eJ)([t,i,n,r]);return(0,A.d4)(()=>{JSON.stringify([t,i,n,r])!==JSON.stringify(o)&&a([t,i,n,r])},[t,i,o,n,r]),o},pr=e=>{let{url:t,query:i,deps:n,searchQuery:r="",dataKey:o="rows",totalKey:a="total",pageSize:l,auto:s=!0,defaultSort:d,initialResult:c}=e,[u,p]=pi({url:t}),[h,m]=(0,A.eJ)(d?{by:d.by,direction:d.direction}:void 0),g=pn({url:t,deps:n,sort:h,offset:u}),v=(0,f._)({offset:u,limit:l},i,h&&{order_by:h.by,order_direction:h.direction});r&&(v.query=r);let b=(0,iS.ib)({pathname:t,query:v,initialResult:c||{[o]:[],[a]:0},deps:g,auto:s}),{result:y}=b,_=(0,ef._)(b,["result"]),Z=y?y[o]:[],w=y?y[a]:0,C=u+l<w;return(0,f._)({rows:Z,total:w,onNextPage:()=>p(Math.min(w,u+l)),onPrevPage:()=>p(Math.max(0,u-l)),onFirstPage:()=>p(0),onLastPage:()=>p(Math.max(0,Math.floor((w-1)/l)*l)),hasMoreRows:C,sort:h,setSort:m,offset:u,setOffset:p,pageSize:l},_)},po=e=>{let{defaultSort:t,url:i,pageSize:n=20,dataKey:r,query:o}=e,[a,l]=pi({url:i}),[s,d]=(0,A.eJ)(t?{by:t.by,direction:t.direction}:void 0);(0,A.d4)(()=>{l(0)},[s,l]);let{rows:c,total:u,loading:p,error:h}=(0,uH.Z)(i,(0,f._)({offset:a,limit:n,dataKey:r},o&&o,s&&{order_by:s.by,order_direction:s.direction})),m=Math.min(u,a+n),g=a+n<u;return{rows:c,offset:a,nextOffset:m,setOffset:l,hasMoreRows:g,loading:p,error:h,sort:s,setSort:d,total:u}},pa=e=>{var{url:t,dataKey:i="rows",totalKey:n="total",pageSize:r,cols:o,getRowIcon:a,defaultSort:l,selectedValues:s,setSelectedValues:d,getRowKey:c,deps:u,query:p,initialResult:h}=e,m=(0,ef._)(e,["url","dataKey","totalKey","pageSize","cols","getRowIcon","defaultSort","selectedValues","setSelectedValues","getRowKey","deps","query","initialResult"]);let{rows:g,sort:v,setSort:b,offset:y,total:w,onPrevPage:C,onNextPage:x,hasMoreRows:S,isLoading:k,error:B}=pr({defaultSort:l,url:t,deps:u,dataKey:i,totalKey:n,pageSize:r,query:p,initialResult:h});return(0,Z.tZ)(u9,(0,_._)((0,f._)({},m),{cols:o,rows:g,sort:v,onSort:b,offset:y,total:w,onPrevPage:C,onNextPage:x,hasMoreRows:S,getRowIcon:a,loading:k,error:!!B,setSelectedValues:d,selectedValues:s,getRowKey:c}))},pl=e=>{var{url:t,pageSize:i,cols:n,getRowIcon:r,defaultSort:o,selectedValues:a,setSelectedValues:l,getRowKey:s}=e,d=(0,ef._)(e,["url","pageSize","cols","getRowIcon","defaultSort","selectedValues","setSelectedValues","getRowKey"]);let{rows:c,sort:u,setOffset:p,total:h,nextOffset:m,hasMoreRows:g,loading:v,error:b,offset:y,setSort:w}=po({defaultSort:o,url:t,pageSize:i});return(0,Z.tZ)(u9,(0,_._)((0,f._)({},d),{cols:n,rows:c,sort:u,onSort:e=>{p(0),w(e)},offset:y,total:h,onNextPage:()=>p(m),hasMoreRows:g,getRowIcon:r,loading:v,error:b,setSelectedValues:l,selectedValues:a,getRowKey:s}))},ps=e=>{var{appendMode:t,pageSize:i,cols:n,getRowIcon:r,deps:o=[]}=e,a=(0,ef._)(e,["appendMode","pageSize","cols","getRowIcon","deps"]);let l=Array(i).fill(0).map(e=>(0,Z.tZ)("tr",{className:k()({"has-row-icon":!!r}),children:n.map((t,i)=>{let{align:n}=t;return(0,Z.tZ)("td",{className:k()("silhouette",{"align-right":"right"===n}),children:(0,Z.tZ)("span",{className:"outer",children:(0,Z.BX)("span",{className:"content",children:[0===i&&r?(0,Z.tZ)("span",{className:"row-icon",children:r(e)}):"",0===i?"".concat((0,er.randomString)()).concat((0,er.randomString)()).concat((0,er.randomString)().slice(0,4)):(0,er.randomString)()]})})})})}));return t?(0,Z.tZ)(pl,(0,f._)({cols:n,appendMode:t,placeholderRows:l,getRowIcon:r,pageSize:i},a)):(0,Z.tZ)(pa,(0,f._)({cols:n,appendMode:t,placeholderRows:l,getRowIcon:r,pageSize:i,deps:o},a))};var pd=i(93220),pc=i.n(pd),pu=i(85200),pp=i(33703),ph=i(45609),pm=i(53860),pg=i(88628),pv=i(78526),pb=i(29162),py=i(67747),pf=i(23260),p_=i(59407),pZ=i(17573),pw=i(17876);function pC(e){let{onClose:t,post_id:i}=e,[n,r]=(0,A.eJ)(null),[o,a]=(0,A.eJ)(null),{popToast:l}=(0,iN.pm)(),{iString:s}=(0,Q.M1)(),{result:d,isLoading:c}=(0,iS.ib)({pathname:"/api/v1/restack/republish-details/".concat(i),method:"GET",auto:!0}),{isLoading:u,refetch:p}=(0,iS.ib)({pathname:"/api/v1/restack/republish/".concat(i),method:(null==d?void 0:d.scheduledRepublish)?"PUT":"POST",auto:!1,json:{sectionId:n,scheduledAt:null!=o?o:void 0}}),{isLoading:h,refetch:m}=(0,iS.ib)({pathname:"/api/v1/drafts/".concat(i),method:"DELETE",auto:!1,json:{postId:i}}),g=(null==d?void 0:d.filteredSections)||[],v=(null==d?void 0:d.previouslyRestackedToSections)||[],b=g.concat(v);return(0,A.d4)(()=>{if(d){var e,t,i,n,o,l,s;a((null==d?void 0:null===(e=d.scheduledRepublish)||void 0===e?void 0:e.trigger_at)?new Date(null==d?void 0:null===(t=d.scheduledRepublish)||void 0===t?void 0:t.trigger_at):null),r(String(null!==(s=null!==(l=null==d?void 0:null===(i=d.republishingPost)||void 0===i?void 0:i.section_id)&&void 0!==l?l:null==d?void 0:null===(n=d.republishingPost)||void 0===n?void 0:n.draft_section_id)&&void 0!==s?s:null===(o=g[0])||void 0===o?void 0:o.id))}},[d]),(0,Z.tZ)(tU.w,{children:(0,Z.BX)(et.hs,{bg:"primary",direction:"column",gap:20,padding:20,children:[(0,Z.tZ)(ei.xv.H4,{translated:!0,children:"Republish post"}),(0,Z.BX)(et.hs,{direction:"column",gap:8,children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",children:"Republish post to:"}),g.length&&n&&(0,Z.BX)(oY.i,{value:n,onChange:e=>{r(e.target.value)},children:[(0,Z.tZ)(oY.d,{children:s("Select a newsletter")}),b.map(e=>{let t=!!v.find(t=>t.id===e.id);return(0,Z.tZ)("option",{disabled:t,value:String(e.id),children:e.name})})]}),!c&&0===Number(g.length)&&(0,Z.tZ)(ei.xv.B4,{color:"error",translated:!0,children:"There are no valid newsletters to republish to."})]}),(null==d?void 0:d.scheduledRepublish)&&(0,Z.BX)(et.hs,{direction:"column",gap:8,children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",children:"Scheduled to send:"}),(0,Z.tZ)(aT.Tz,{min:new Date,value:o||new Date,onChange:e=>{a(new Date(e.currentTarget.value))}})]}),(0,Z.BX)(ei.xv,{lineHeight:16,children:[(null==d?void 0:d.scheduledRepublish)?(0,Z.BX)(ei.xv.B4,{as:"span",translated:!0,children:[(0,Z.tZ)(ei.xv.B4,{as:"span",fontStyle:"italic",weight:"semibold",children:I18N.p(String(null==d?void 0:d.republishedPost.title))})," ","will be sent to the newsletter you selected at the scheduled time."]}):(0,Z.BX)(ei.xv.B4,{as:"span",translated:!0,children:[(0,Z.tZ)(ei.xv.B4,{as:"span",fontStyle:"italic",weight:"semibold",children:I18N.p(String(null==d?void 0:d.republishedPost.title))})," ","will be sent immediately to the newsletter you selected."]})," ",!!v.length&&(0,Z.BX)(ei.xv.B4,{as:"span",translated:!0,children:["Note that readers who also subscribe to the following newsletters will not receive this post a second time:"," ",(0,Z.tZ)(ei.xv.B4,{as:"span",weight:"semibold",children:I18N.p(v.map(e=>e.name).join(", "))})," "]})]}),(0,Z.BX)(et.gq,{gap:8,justifyContent:"end",children:[(0,Z.tZ)(ee.zx,{disabled:c||u||h,priority:"tertiary",onClick:()=>{t()},children:s("Cancel")}),(null==d?void 0:d.scheduledRepublish)&&(0,Z.tZ)(ee.zx,{disabled:c||u||h,priority:"secondary",onClick:async()=>{confirm(s("You are about to unschedule this republish. Are you sure you want to do this?"))&&(await m(),l(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{Icon:eE.Z,text:s("Republish was unscheduled")}))),t())},children:s("Unschedule")}),(0,Z.tZ)(ee.zx,{disabled:c||u||h,priority:"primary",onClick:async()=>{((null==d?void 0:d.scheduledRepublish)||confirm(s("You are about to republish this post the newsletter you selected. Are you sure you want to do this?")))&&(await p(),l(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{Icon:eE.Z,text:(null==d?void 0:d.scheduledRepublish)?s("Republish was saved."):s("Post was republished!")}))),t())},children:(null==d?void 0:d.scheduledRepublish)?s("Save"):s("Republish")})]})]})})}var px=i(93155);function pS(){let e=(0,G._)(["Pin on ",""]);return pS=function(){return e},e}function pk(){let e=(0,G._)(["Unpin from ",""]);return pk=function(){return e},e}let pB=()=>{let{iString:e,iTemplate:t}=(0,Q.M1)(),i=(0,re.aF)(),{openModal:n,closeModal:r}=(0,px.dd)();return{view:{icon:(0,Z.tZ)(iy.Z,{}),label:t=>{let{post:i}=t;return"adhoc_email"===i.type?e("View email"):e("View post")},onClick:e=>{let t,{post:i,pub:n}=e;if("restack"===i.type)t=(0,en.uRy)(n,i,{noBase:!0,edit:!1,uuid:!0});else if("adhoc_email"===i.type)t=(0,en.ANx)(n,i.id,{params:{back:window.location.pathname}});else{if(!i.slug)return;t=(0,en.MoQ)(n,i.slug,{noBase:!0})}(0,Y.uX)(t,{newTab:!0})}},share:{icon:(0,Z.tZ)(nE.Z,{}),label:e("Share"),onClick:async e=>{let t,{post:i,pub:n}=e;i.slug&&(t=(0,en.fQy)(n,i.id),(0,Y.uX)(t,{newTab:!0}))}},edit:{icon:(0,Z.tZ)(pp.Z,{}),label:e("Edit"),onClick:e=>{let{post:t,pub:i}=e;(0,B.route)((0,en.ANx)(i,t.id,{params:{back:window.location.pathname}}))}},copy:{icon:(0,Z.tZ)(tI.Z,{}),label:e("Copy link"),onClick:e=>{let{post:t,pub:n}=e,r=(0,en.uRy)(n,t,{urlParams:{r:(0,er.userReferralKey)(i)}});navigator.clipboard.writeText(r)}},duplicate:{icon:(0,Z.tZ)(ph.Z,{}),label:e("Duplicate"),onClick:async e=>{let{post:t,pub:i,popToast:n,onActionStart:r,onActionEnd:o}=e;try{null==r||r();let e=await N().post("/api/v1/posts/".concat(t.id,"/duplicate"));null==o||o(),(0,Y.uX)((0,en.ANx)(i,e.body.id,{params:{back:window.location.pathname}}),{local_navigation:!1})}catch(e){null==o||o(),console.error("Failed to copy"),null==n||n(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:(0,Y.zx)(e)},t)))}}},viewMedia:{icon:(0,Z.tZ)(pm.Z,{}),label:e("Share as image"),onClick:e=>{let{post:t,pub:i}=e;if(!t.slug)return;let n=(0,en.fQy)(i,t.id,{params:{openAssetModal:!0}});(0,Y.uX)(n)}},changeSection:{label:e("Move to section"),onClick:()=>void 0,icon:(0,Z.tZ)(pg.Z,{})},pinOnHomepage:{icon:(0,Z.tZ)(pv.Z,{}),label:e("Pin to homepage"),onClick:async t=>{let{post:i,pub:n,popToast:r,postsResource:o,onActionStart:a,onActionEnd:l}=t;try{if(null==a||a(),o){let e=o.rows.map(e=>e.id!==i.id||e.pins.includes(n.id)?e:(0,_._)((0,f._)({},e),{pins:[...e.pins,n.id]}));o.setResult({posts:e,total:o.total})}await N().post("/api/v1/publication/".concat(n.id,"/pin/").concat(i.id)),null==l||l(),null==r||r(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:e("Post pinned")},t)))}catch(t){null==l||l(),o&&o.setResult({posts:o.rows,total:o.total}),console.error(e("Failed to pin post:"),t),null==r||r(e=>(0,Z.tZ)(iN.FN,(0,f._)({text:(0,Y.zx)(t)},e)))}}},unpinFromHomepage:{icon:(0,Z.tZ)(pb.Z,{}),label:e("Unpin from homepage"),onClick:async t=>{let{post:i,pub:n,popToast:r,postsResource:o,onActionStart:a,onActionEnd:l}=t;try{if(null==a||a(),o){let e=o.rows.map(e=>e.id===i.id?(0,_._)((0,f._)({},e),{pins:e.pins.filter(e=>e!==n.id)}):e);o.setResult({posts:e,total:o.total})}await N().del("/api/v1/publication/".concat(n.id,"/pin/").concat(i.id)),null==l||l(),null==r||r(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:e("Post unpinned")},t)))}catch(t){null==l||l(),o&&o.setResult({posts:o.rows,total:o.total}),console.error(e("Failed to pin post:"),t),null==r||r(e=>(0,Z.tZ)(iN.FN,(0,f._)({text:(0,Y.zx)(t)},e)))}}},pinOnSection:{icon:(0,Z.tZ)(pv.Z,{}),label:e=>{let{post:i,pub:n}=e,r=n.sections.find(e=>e.id===i.section_id);return t(pS(),i.section_name||(null==r?void 0:r.name)||"")},onClick:async t=>{let{post:i,pub:n,popToast:r,postsResource:o,onActionStart:a,onActionEnd:l}=t;try{if(null==a||a(),o){let e=o.rows.map(e=>e.id!==i.id||e.is_section_pinned?e:(0,_._)((0,f._)({},e),{is_section_pinned:!0}));o.setResult({posts:e,total:o.total})}await N().post("/api/v1/publication/".concat(n.id,"/section/").concat(i.section_id,"/pin/").concat(i.id)),null==l||l(),null==r||r(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:e("Post pinned")},t)))}catch(t){null==l||l(),o&&(o.setResult({posts:o.rows,total:o.total}),console.error(e("Failed to pin post:"),t)),null==r||r(e=>(0,Z.tZ)(iN.FN,(0,f._)({text:(0,Y.zx)(t)},e)))}}},republish:{icon:(0,Z.tZ)(iq.Z,{}),label:"Republish",onClick:e=>{let{post:t}=e;n({children:(0,Z.tZ)(pC,{post_id:t.id,onClose:r}),width:540})}},unpinFromSection:{icon:(0,Z.tZ)(pb.Z,{}),label:e=>{let{post:i,pub:n}=e,r=n.sections.find(e=>e.id===i.section_id);return t(pk(),i.section_name||(null==r?void 0:r.name)||"")},onClick:async t=>{let{post:i,pub:n,popToast:r,postsResource:o,onActionStart:a,onActionEnd:l}=t;try{if(null==a||a(),o){let e=o.rows.map(e=>e.id===i.id&&e.is_section_pinned?(0,_._)((0,f._)({},e),{is_section_pinned:!1}):e);o.setResult({posts:e,total:o.total})}await N().del("/api/v1/publication/".concat(n.id,"/section/").concat(i.section_id,"/pin/").concat(i.id)),null==l||l(),null==r||r(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:e("Post unpinned")},t)))}catch(t){null==l||l(),o&&(o.setResult({posts:o.rows,total:o.total}),console.error(e("Failed to pin post:"),t)),null==r||r(e=>(0,Z.tZ)(iN.FN,(0,f._)({text:(0,Y.zx)(t)},e)))}}},includeInTop:{icon:(0,Z.tZ)(py.Z,{}),label:e("Show in top posts"),onClick:async t=>{let{post:i,pub:n,popToast:r,postsResource:o,onActionStart:a,onActionEnd:l}=t;try{if(null==a||a(),o){let e=o.rows.map(e=>e.id===i.id?(0,_._)((0,f._)({},e),{top_exclusions:e.top_exclusions.filter(e=>e!==n.id)}):e);o.setResult({posts:e,total:o.total})}await N().del("/api/v1/publication/".concat(n.id,"/exclusion/").concat(i.id)),null==l||l(),null==r||r(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:e("Showing in top posts")},t)))}catch(t){null==l||l(),o&&o.setResult({posts:o.rows,total:o.total}),console.error(e("Failed to include post:"),t),alert((0,Y.zx)(t))}}},excludeFromTop:{icon:(0,Z.tZ)(pf.Z,{}),label:e("Hide from top posts"),onClick:async t=>{let{post:i,pub:n,popToast:r,postsResource:o,onActionStart:a,onActionEnd:l}=t;try{if(null==a||a(),o){let e=o.rows.map(e=>e.id!==i.id||e.top_exclusions.includes(n.id)?e:(0,_._)((0,f._)({},e),{top_exclusions:[...e.top_exclusions,n.id]}));o.setResult({posts:e,total:o.total})}await N().post("/api/v1/publication/".concat(n.id,"/exclusion/").concat(i.id)),null==l||l(),null==r||r(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:e("Hidden from top posts")},t)))}catch(t){null==l||l(),o&&o.setResult({posts:o.rows,total:o.total}),console.error(e("Failed to hide post:"),t);return}}},delete:{icon:(0,Z.tZ)(iW.Z,{}),label:e("Delete"),onClick:async t=>{let{post:i,popToast:n,postsResource:r,countsResource:o,onActionStart:a,onActionEnd:l}=t;try{null==a||a();let t=setTimeout(()=>{null==n||n(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:e("Deleting post...")},t)))},1e3);await N().delete("/api/v1/drafts/".concat(i.id)).retry(2),clearTimeout(t),null==o||o.refetch(),null==r||r.refetch(),null==n||n(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:e("Post deleted")},t))),null==l||l()}catch(t){null==l||l(),console.error(e("Failed to delete post:"),t),null==n||n(e=>(0,Z.tZ)(iN.FN,(0,f._)({text:(0,Y.zx)(t)},e)))}},dialogId:"delete",destructive:!0},unschedule:{label:e("Unschedule"),onClick:()=>{},icon:(0,Z.tZ)(p_.Z,{})},unpublish:{label:e("Unpublish"),onClick:async t=>{let{post:i,popToast:n,postsResource:r,countsResource:o,onActionStart:a,onActionEnd:l}=t;try{null==a||a();let t=setTimeout(()=>{null==n||n(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:e("Unpublishing post...")},t)))},1e3);await N().post("/api/v1/drafts/".concat(i.id,"/unpublish")).send({}).retry(2),clearTimeout(t),null==o||o.refetch(),null==r||r.refetch(),null==l||l(),null==n||n(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:e("Post unpublished")},t)))}catch(t){null==l||l(),console.error(e("Failed to unpublish post:"),t),null==n||n(e=>(0,Z.tZ)(iN.FN,(0,f._)({text:(0,Y.zx)(t)},e)))}},icon:(0,Z.tZ)(pZ.Z,{}),dialogId:"unpublish",destructive:!0},clearCache:{label:e("Clear from cache"),icon:(0,Z.tZ)(pw.Z,{}),onClick:async t=>{let{post:i,popToast:n,onActionStart:r,onActionEnd:o}=t;try{null==r||r(),await N().put("/api/v1/posts/".concat(i.id,"/clear_cache")),null==o||o(),null==n||n(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:e("Cleared from cache")},t)))}catch(e){null==o||o(),console.error("Failed to clear post from cache"),null==n||n(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:(0,Y.zx)(e)},t)))}},destructive:!0},broadcast:{label:t=>{let{post:i}=t;switch(i.audience){case"everyone":return e("Send to everyone");case"only_free":return e("Send to free subscribers");case"only_paid":return e("Send to paid subscribers");case"founding":return e("Send to founding members")}},icon:(0,Z.tZ)(tN.Z,{}),onClick:async t=>{let i,{post:n,popToast:r,postsResource:o,onActionStart:a,onActionEnd:l}=t;switch(n.audience){case"everyone":i="Send this published post to everyone?";break;case"only_free":i="Send this published post to free subscribers";break;case"only_paid":i="Send this published post to paid subscribers";break;case"founding":i="Send this published post to founding members"}if(!confirm(i))return;let s="/api/v1/drafts/".concat(n.id,"/publish");try{null==a||a(),await N().post(s).send({send:!0,only_send:!0}),null==o||o.refetch(),null==l||l(),null==r||r(t=>(0,Z.tZ)(iN.FN,(0,f._)({text:e("Post sent")},t)))}catch(t){null==l||l(),console.error(e("Failed to send post:"),t),alert((0,Y.zx)(t))}}}}};function pT(){let e=(0,G._)(["Are you sure you want to permanently delete ","? This action cannot be undone."]);return pT=function(){return e},e}function pI(){let e=(0,G._)(["Are you sure you want to unpublish ","?"]);return pI=function(){return e},e}let pN={delete:e=>{let{open:t,onConfirm:i,onCancel:n,postTitle:r}=e,{iString:o,iTemplate:a}=(0,Q.M1)();return(0,Z.tZ)(dj.W,{isOpen:t,title:o("Delete post"),description:a(pT(),r?'"'.concat(r,'"'):"this post"),onClose:n,primaryButton:(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:i,children:o("Delete")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:n,children:o("Cancel")})})},unpublish:e=>{let{open:t,onConfirm:i,onCancel:n,postTitle:r}=e,{iString:o,iTemplate:a}=(0,Q.M1)();return(0,Z.tZ)(dj.W,{isOpen:t,title:o("Unpublish post"),description:a(pI(),r?'"'.concat(r,'"'):"this post"),onClose:n,primaryButton:(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:i,children:o("Unpublish")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:n,children:o("Cancel")})})}},pP=[{name:"share",features:["copy","share","viewMedia"],order:0},{name:"edit",features:["edit","view","duplicate"],order:1},{name:"publish",features:["republish","broadcast","pinOnHomepage","pinOnSection","unpinFromHomepage","unpinFromSection","excludeFromTop","includeInTop"],order:2},{name:"destructive",features:["clearCache","unpublish","delete"],order:3}],pE=e=>{let{view:t,type:i,user:n,post:r,isRepublishingEnabled:o}=e;switch(t){case"published":if("restack"===i)return nT()(["duplicate",(null==n?void 0:n.is_global_admin)&&"clearCache","publish","delete"]);if("adhoc_email"===i)return nT()(["edit","copy",!r.email_sent_at&&"broadcast","duplicate",(null==n?void 0:n.is_global_admin)&&"clearCache","delete"]);return nT()(["edit","copy","share","viewMedia",!r.email_sent_at&&"broadcast","pin",o&&"republish","exclusion","duplicate",(null==n?void 0:n.is_global_admin)&&"clearCache","publish","delete"]);case"drafts":return["edit","duplicate","delete"];case"scheduled":return nT()(["edit",!["restack","adhoc_email"].includes(i)&&"share","pin","exclusion","duplicate","delete"]);default:return[]}},pX=e=>{let{features:t,post:i,pub:n}=e;return new Set(t.map(e=>{if("pin"===e){let e=i.pins.includes(n.id),t=i.section_id,r=i.is_section_pinned,o=n.sections.find(e=>e.id===i.section_id),a=null==o?void 0:o.hide_posts_from_pub_listings;return nT()([e&&!a?"unpinFromHomepage":"pinOnHomepage",t&&r&&"unpinFromSection",t&&!r&&"pinOnSection"])}if("exclusion"===e){let e=i.top_exclusions.includes(n.id);return nT()([e?"includeInTop":"excludeFromTop"])}return"publish"===e?["unpublish"]:e}).flat())},pM=e=>{let{post:t,features:i,postsResource:n,countsResource:r,onActionStart:o,onActionEnd:a}=e,l=(0,eq.Ij)()||{},{popToast:s}=(0,iN.pm)(),d=pB(),c=pX({features:i,post:t,pub:l}),[u,p]=(0,A.eJ)(),h=!0;return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(tC.v2,{layerOptions:{placement:"bottom-end"},trigger:(0,Z.tZ)(ee.hU,{priority:"tertiary",size:"sm",children:(0,Z.tZ)(pu.Z,{size:20})}),maxHeight:"50vh",stopPropagation:!0,children:pP.map(e=>{let i=e.features.filter(e=>c.has(e));if(0===i.length)return null;let u=(0,Z.tZ)(tC.xw,{isFirst:h,children:i.map(i=>{let c=d[i];return(0,Z.tZ)(tC.sN,{leading:c.icon,priority:"destructive"===e.name?"destructive":void 0,onClick:()=>{c.dialogId?p(c.dialogId):c.onClick({post:t,pub:l,popToast:s,postsResource:n,countsResource:r,onActionStart:o,onActionEnd:a})},children:"function"==typeof c.label?c.label({post:t,pub:l}):c.label},i)})},e.name);return h=!1,u})}),pc()(pN).map(e=>{let[i,c]=e;return(0,Z.tZ)(c,{open:u===i,onConfirm:()=>{let e=Object.values(d).find(e=>e.dialogId===i);null==e||e.onClick({post:t,pub:l,popToast:s,postsResource:n,countsResource:r,onActionStart:o,onActionEnd:a}),p(void 0)},onCancel:()=>{p(void 0)},postTitle:t.title})})]})};var pA=i(1548),pD=i(21465);let pR=e=>{var{size:t=20,stroke:i="var(--color-fg-primary)",strokeWidth:n=1.5}=e,r=(0,ef._)(e,["size","stroke","strokeWidth"]);return(0,Z.tZ)(eH.l,(0,_._)((0,f._)({},r),{name:"NoteLikeIcon",svgParams:{viewBox:"0 0 20 20"},width:t,height:t,stroke:i,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round",children:(0,Z.tZ)("path",{d:"M5.00002 2.54822C8.00003 2.09722 9.58337 4.93428 10 5.87387C10.4167 4.93428 12 2.09722 15 2.54822C18 2.99923 18.75 5.66154 18.75 7.05826C18.75 9.28572 18.1249 10.9821 16.2499 13.244C14.3749 15.506 10 18.3333 10 18.3333C10 18.3333 5.62498 15.506 3.74999 13.244C1.875 10.9821 1.25 9.28572 1.25 7.05826C1.25 5.66154 2 2.99923 5.00002 2.54822Z"})}))};var pF=i(62686),pL=i(34713),pz=i(42970),pO=i(1055),pU=i(17540),pY=i(91400);let pH={playIcon:"playIcon-VuprUf"};function pj(){let e=(0,G._)(["Pinned on ",""]);return pj=function(){return e},e}let pJ=e=>"podcast"===e||"video"===e,pV=e=>{let{type:t,cover_image:i,title:n,is_section_pinned:r,section_id:o,section_name:a,pins:l,top_exclusions:s}=e;return(0,pY.XA)()?null:(0,Z.tZ)(pW,{top_exclusions:s,children:(0,Z.tZ)(pq,{pins:l,is_section_pinned:r,section_id:o,section_name:a,children:(0,Z.BX)(et.hs,{bg:"secondary",outline:"detail",radius:"sm",width:48,height:48,justifyContent:"center",alignItems:"center",flex:"auto",display:{desktop:"flex",mobile:"none"},position:"relative",overflow:"hidden",children:[pJ(t)&&i&&(0,Z.tZ)(et.M5,{position:"absolute",inset:0,children:(0,Z.tZ)(pO.Z,{className:pH.playIcon,height:18,fill:"var(--color-utility-white)"})}),i?(0,Z.tZ)(iZ.e,{src:i,alt:n||"",useRetinaSizing:!0,imageIsFixedWidth:!0,maxWidth:48,objectFit:"cover",imageProps:{height:48,aspect:"1:1",smartCrop:!0}}):pJ(t)?(0,Z.tZ)(pO.Z,{fill:"var(--color-fg-secondary)",height:16}):(0,Z.tZ)(pF.Z,{color:"var(--color-fg-secondary)",size:20})]})})})},pq=e=>{let{section_id:t,is_section_pinned:i,section_name:n,pins:r,children:o}=e,{iString:a,iTemplate:l}=(0,Q.M1)(),s=(0,eq.Ij)(),d=r.includes(null==s?void 0:s.id),c=null==s?void 0:s.sections.find(e=>e.id===t);return i||d?(0,Z.tZ)(tW.u,{text:d?a("Pinned on homepage"):i&&c?l(pj(),n||c.name):"",disabled:!d&&!i&&!c,children:(0,Z.tZ)(pU.Ct,{priority:"primary",theme:"accent",shape:"circle",placement:"bottom-right",content:(0,Z.tZ)(pz.Z,{size:12,fill:"white"}),children:o})}):(0,Z.tZ)(Z.HY,{children:o})},pW=e=>{let{top_exclusions:t,children:i}=e,{iString:n}=(0,Q.M1)(),r=(0,eq.Ij)();return t.includes(null==r?void 0:r.id)?(0,Z.tZ)(tW.u,{text:n("Excluded from Top"),children:(0,Z.tZ)(pU.Ct,{priority:"primary",theme:"default",shape:"circle",placement:"bottom-right",content:(0,Z.tZ)(pL.Z,{color:"white",size:12}),children:i})}):(0,Z.tZ)(Z.HY,{children:i})};var pG=i(28070),pK=i(76157);let pQ=(e,t)=>{let i;let{language:n}=(0,Q.M1)();return t?e.map(e=>{let r=(0,H.Z)(e[t]).locale(n).format("YYYY-MM");if(r!==i&&r!==(0,H.Z)().locale(n).format("YYYY-MM")){let o=(0,H.Z)(e[t]).locale(n).format("MMMM YYYY");return i=r,(0,_._)((0,f._)({},e),{monthYearHeader:o})}return e}):e},p$=e=>(0,H.Z)(e).add(10,"minutes").isAfterNow(),p0=(e,t)=>{switch(e){case"podcast":if(t)return(0,Z.tZ)(iK.Z,{size:14});return(0,Z.tZ)(iG.Z,{size:14});case"video":return(0,Z.tZ)(iK.Z,{size:14});case"thread":return(0,Z.tZ)(pG.Z,{size:14});case"adhoc_email":return(0,Z.tZ)(uh.Z,{size:14});case"restack":return(0,Z.tZ)(pK.Z,{height:14});default:return null}},p1=e=>["podcast","video","thread","adhoc_email","restack"].includes(e),p2={postRow:"postRow-wzEoUS",spotlight:"spotlight-RMA3JG",loading:"loading-FAeeGr"},p4=e=>{let{bylines:t,section_name:i,dateString:n}=e,r=t&&t.length>0;return i||r||n?(0,Z.BX)(ei.xv.B4,{color:"secondary",children:[n&&(0,Z.tZ)(ei.xv,{as:"span",children:n}),r&&(0,Z.BX)(Z.HY,{children:[n&&(0,Z.tZ)(p3,{}),(0,Z.tZ)(ei.xv,{as:"span",children:(0,Z.tZ)(pA.M,{array:t,limit:5,formatter:e=>e.name})})]}),i&&(0,Z.BX)(Z.HY,{children:[(r||n)&&(0,Z.tZ)(p3,{}),(0,Z.tZ)(ei.xv,{as:"span",children:i})]})]}):null},p3=()=>(0,Z.tZ)(ei.xv,{as:"span",children:" â€¢ "}),p8=e=>{let{audience:t,should_send_free_preview:i,isTheFreePress:n,isMetered:r,foundingTierLabel:o}=e,{iContext:a}=(0,Q.M1)();if("founding"===t)return o||a("postAudience","Founding");if(n){if("only_paid"===t)return a("postAudience",r?"Paid with metering":"Paid only");if("everyone"===t)return a("postAudience",r?"Free with metering":"Always free")}return"only_paid"===t?a("postAudience","Paid"):i?a("postAudience","Preview"):void 0},p6=e=>{let{should_send_free_preview:t,audience:i,reactions:n,comment_count:r,type:o,foundingTierLabel:a,showActivity:l=!0,meter_type:s,pub:d,titleExperiment:c}=e,u="adhoc_email"===o,p=p8({audience:i,should_send_free_preview:t,isTheFreePress:(0,oo.HD)({pub:d}),isMetered:"metered"===s,foundingTierLabel:a}),{iString:h}=(0,Q.M1)(),m=c&&!c.ended_at,g=u?(0,Z.tZ)(d_.Vp,{priority:"secondary",children:h("Email")}):(0,Z.tZ)(d_.Vp,{priority:"secondary",theme:"paid",children:p}),v=null==n?void 0:n["â¤"],b=u||p;return(0,Z.BX)(et.hs,{gap:12,alignItems:"center",paddingTop:b?6:2,children:[b&&(0,Z.tZ)(Z.HY,{children:g}),m&&(0,Z.tZ)(d_.Vp,{priority:"secondary",children:h("Test running...")}),l&&!eS()(v)&&(0,Z.BX)(ei.xv.B5,{display:"flex",alignItems:"center",gap:4,weight:"medium",color:"secondary",children:[(0,Z.tZ)(pR,{size:12,stroke:"var(--color-fg-secondary)",strokeWidth:2})," ",v]}),l&&!eS()(r)&&(0,Z.BX)(ei.xv.B5,{display:"flex",alignItems:"center",gap:4,weight:"medium",color:"secondary",children:[(0,Z.tZ)(pD.Z,{size:12,stroke:"var(--color-fg-secondary)",strokeWidth:2})," ",r]})]})},p5=e=>{let{post:t,title:i,sectionNames:n,meta:r,dateString:o}=e,{type:a,bylines:l,cover_image:s,is_section_pinned:d,is_published:c,section_id:u,section_name:p,draft_section_name:h,pins:m,top_exclusions:g,video_upload_id:v,draft_video_upload_id:b}=t,y=c?p:null!=h?h:void 0;return(null==n?void 0:n.length)>0&&(y=n.join(", ")),(0,Z.BX)(et.hs,{gap:20,alignItems:"start",minWidth:0,children:[(0,Z.tZ)(pV,{type:a,cover_image:s,title:i,is_section_pinned:d,section_id:u,section_name:p,pins:m,top_exclusions:g}),(0,Z.BX)(et.tu,{minWidth:0,children:[(0,Z.BX)(et.gq,{gap:6,alignItems:"center",children:[p0(a,null!=v?v:b),(0,Z.tZ)(ei.xv.B4,{weight:"semibold",ellipsis:!0,children:i})]}),(0,Z.tZ)(p4,{bylines:l,section_name:y,dateString:o}),r]})]})},p9=e=>{let{post:t,toplineStats:i,rightAction:n,features:r,postsResource:o,countsResource:a,onActionStart:l,onActionEnd:s}=e,d=(0,eq.Ij)()||{};return(0,Z.BX)(et.gq,{gap:32,alignItems:"center",flex:"auto",children:[i,(0,Z.BX)(et.gq,{gap:8,alignItems:"center",children:[n&&(0,Z.tZ)(tW.u,{text:"function"==typeof n.label?n.label({post:t,pub:d}):n.label,children:(0,Z.tZ)(ee.hU,{size:"sm",priority:"tertiary",onClick:e=>{e.preventDefault(),e.stopPropagation(),n.onClick({post:t,pub:d})},children:n.icon&&(0,w.cloneElement)(n.icon,{size:20})})}),(0,Z.tZ)(pM,{post:t,features:r,postsResource:o,countsResource:a,onActionStart:l,onActionEnd:s})]})]})},p7=e=>{let{post:t,title:i,meta:n,isSpotlighted:r,pub:o,onClick:a,dateString:l}=e,[s,d]=(0,A.eJ)(!1),c=[];return o.sections&&t.republishedPosts&&(c=t.republishedPosts.map(e=>{let{sectionId:t}=e,i=o.sections.find(e=>e.id===t);return(null==i?void 0:i.name)||""})),(0,Z.tZ)(sx.A0,{href:e.href,onClick:a,children:(0,Z.BX)(et.hs,{className:k()(p2.postRow,r&&p2.spotlight,s&&p2.loading),alignItems:"center",justifyContent:"space-between",paddingX:16,paddingY:20,gap:32,bg:"primary",position:"relative",hover:!0,children:[(0,Z.tZ)(p5,{post:t,title:i,sectionNames:c,meta:n,dateString:l}),"restack"!==t.type?(0,Z.tZ)(p9,(0,_._)((0,f._)({},e),{onActionStart:()=>d(!0),onActionEnd:()=>d(!1)})):null,s&&(0,Z.tZ)(he,{})]})})},he=()=>(0,Z.tZ)(iI.$j,{position:"absolute",inset:0,alignItems:"center",justifyContent:"center"});function ht(){let e=(0,G._)(["Updated ",""]);return ht=function(){return e},e}let hi=e=>{let{post:t,postsResource:i,countsResource:n}=e,r=(0,eq.Ij)(),o=(0,re.aF)(),{iTemplate:a}=(0,Q.M1)(),{id:l,post_date:s,should_send_free_preview:d,type:c,audience:u,draft_updated_at:p,draft_title:h}=t,m=r.founding_plan_enabled?r.founding_plan_name:null;return(0,Z.tZ)(p7,{post:t,title:"".concat(s?"[UNPUBLISHED] ":"").concat(h||"Untitled"),pub:r,dateString:a(ht(),(0,Y.Po)(p)),meta:(0,Z.tZ)(p6,{meter_type:t.meter_type,pub:r,should_send_free_preview:d,audience:u,type:c,foundingTierLabel:m}),href:(0,en.ANx)(r,l,{params:{back:"undefined"!=typeof window&&window.location.pathname+window.location.search}}),features:pE({view:"drafts",type:c,user:o,post:t}),postsResource:i,countsResource:n})};var hn=i(67523),hr=i.n(hn),ho=i(66604),ha=i.n(ho),hl=i(14176),hs=i.n(hl),hd=i(85841),hc=i(49526);function hu(e){let{className:t,containerClassName:i,separatorClassName:n,min:r,max:o,value:a,onChange:l,disabled:s}=e;return(0,Z.BX)("div",{className:k()("dateRangePicker-CU7ZB3",i),children:[(0,Z.tZ)(aT.Mt,{value:null==a?void 0:a.from,min:r,max:o,onChange:e=>{let t=e.currentTarget.value;t&&(null==a?void 0:a.from)&&(0,H.Z)(t).isAfter((0,H.Z)(null==a?void 0:a.to))?l({from:t,to:t}):l({from:t,to:null==a?void 0:a.to})},disabled:s,className:t}),(0,Z.tZ)("div",{className:k()(n)}),(0,Z.tZ)(aT.Mt,{value:null==a?void 0:a.to,min:r,max:o,onChange:e=>{let t=e.currentTarget.value;t&&(null==a?void 0:a.from)&&(0,H.Z)(t).isBefore((0,H.Z)(null==a?void 0:a.from))?l({from:t,to:t}):l({from:null==a?void 0:a.from,to:t})},disabled:s,className:t})]})}var hp=i(21685);let hh="elasticsearch",hm={filtersPopover:"filtersPopover-a3AF0N",filtersScrollableContent:"filtersScrollableContent-gMKDXn",filterAvatar:"filterAvatar-J0KPzC",dateRangeFilterContainer:"dateRangeFilterContainer-Qs9XBI",dateRangeFilterSeparator:"dateRangeFilterSeparator-x8HJNJ",dateRangeFilter:"dateRangeFilter-jE8wrk"},hg=e=>{let{pub:t,tags:i,experimentalFiltersEnabled:n,language:r}=e,{iString:o}=I18N.i(r),a=(0,f._)({audiences:nT()([{label:o("Everyone"),value:"everyone"},"enabled"===t.payments_state&&{label:o("Paid"),value:"only_paid"},"enabled"===t.payments_state&&{label:o("Free"),value:"only_free"},t.founding_plan_enabled&&{label:o("Founders"),value:"founding"}]),types:[{label:o("Text"),value:"newsletter"},{label:o("Media"),value:"podcast"},{label:o("Email"),value:"adhoc_email"},{label:o("Thread"),value:"thread"}],sections:t.sections.map(e=>{let{name:t,id:i}=e;return{label:t,value:i.toString()}})},n?{bylines:t.contributors.map(e=>{let{name:t,user_id:i,photo_url:n}=e;return{label:t,value:i.toString(),image:n}}),tags:i?i.map(e=>{let{name:t,id:i}=e;return{label:t,value:i}}):[]}:{});return hs()(a,im())},hv=(e,t)=>{let{iString:i}=I18N.i(t);return({audiences:i("Audience"),types:i("Post type"),sections:i("Section"),bylines:i("Author"),tags:i("Tag")})[e]},hb=(e,t)=>{var i,n;return(e?Object.keys(e).filter(t=>e[t].length>0).length:0)+((null==t?void 0:t.field)&&((null===(i=t.dateRange)||void 0===i?void 0:i.from)||(null===(n=t.dateRange)||void 0===n?void 0:n.to))?1:0)},hy=e=>{let{filters:t,setFilters:i,postDateRange:n,setPostDateRange:r,tags:o}=e,a=(0,pY.XA)(),l=hb(t,n),{iString:s}=(0,Q.M1)();return(0,Z.tZ)(hp.J,{content:e=>{let{closePopover:a}=e;return(0,Z.tZ)(hf,{filters:t,setFilters:i,tags:o,postDateRange:n,setPostDateRange:r,onClear:()=>{i(ha()(t,()=>[])),r((0,_._)((0,f._)({},n),{dateRange:{from:void 0,to:void 0}}))},onDone:a})},layerClassName:hm.filtersPopover,children:()=>a?(0,Z.tZ)(ee.hU,{priority:"secondary-outline",children:(0,Z.tZ)(hd.Z,{size:20})}):(0,Z.tZ)(ee.zx,{priority:"secondary-outline",leading:(0,Z.tZ)(hd.Z,{size:20}),trailing:l>0&&(0,Z.tZ)(d_.Vp,{priority:"primary",children:l}),children:s("Filter")})})},hf=e=>{let{filters:t,setFilters:i,tags:n,postDateRange:r,setPostDateRange:o,onClear:a,onDone:l}=e,s=(0,eq.Ij)(),{iString:d,language:c}=(0,Q.M1)(),u=hg({pub:s,tags:n,experimentalFiltersEnabled:String((0,eW.default)("post_management_search_engine"))===hh,language:c}),p=e=>{let{filterOptionsCategory:n,value:r}=e,o=t[n].includes(r)?{[n]:t[n].filter(e=>e!==r)}:{[n]:[...t[n],r]},a=(0,f._)({},t,o);i(a),(0,U.j)(U.FP.POSTS_PAGE_FILTERED,a)};return(0,Z.BX)(et.tu,{padding:8,gap:20,children:[(0,Z.tZ)(ts.xu,{className:hm.filtersScrollableContent,children:(0,Z.BX)(et.tu,{gap:20,children:[(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",children:d("Post Date")}),(0,Z.tZ)(et.gq,{gap:8,children:(0,Z.tZ)(hu,{containerClassName:hm.dateRangeFilterContainer,separatorClassName:hm.dateRangeFilterSeparator,className:hm.dateRangeFilter,value:r.dateRange,onChange:e=>{o({field:r.field,dateRange:e})}})})]}),pc()(u).map(e=>{let[i,n]=e;return(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",children:hv(i,c)}),(0,Z.tZ)(et.gq,{gap:8,wrap:"wrap",children:n.map(e=>{let{label:n,value:r,icon:o,image:a}=e,l=t[i].includes(r);return(0,Z.tZ)(ee.zx,{onClick:()=>p({filterOptionsCategory:i,value:r}),rounded:!0,size:"sm",priority:l?"primary-mono":"secondary",leading:o||a&&(0,Z.tZ)(eG.qE,{size:20,photoUrl:a}),children:n})})})]})})]})}),(0,Z.BX)(et.tu,{className:hm.filtersFooter,gap:20,children:[(0,Z.tZ)(tX.iz,{}),(0,Z.BX)(et.hs,{justifyContent:"end",paddingX:8,gap:8,children:[(0,Z.tZ)(ee.zx,{rounded:!0,priority:"secondary",onClick:a,children:d("Clear all")}),(0,Z.tZ)(ee.zx,{priority:"primary-mono",onClick:l,children:d("Done")})]})]})]})},h_=()=>{let[e,t]=(0,hc.t)({initialValue:[],key:"audiences",type:"string",isArray:!0}),[i,n]=(0,hc.t)({initialValue:[],key:"types",type:"string",isArray:!0}),[r,o]=(0,hc.t)({initialValue:[],key:"sections",type:"string",isArray:!0}),[a,l]=(0,hc.t)({initialValue:[],key:"bylines",type:"string",isArray:!0}),[s,d]=(0,hc.t)({initialValue:[],key:"tags",type:"string",isArray:!0}),c=(0,A.Ye)(()=>({audiences:e,types:i,sections:r,bylines:a,tags:s}),[e,i,r,a,s]);return[c,e=>{let i="function"==typeof e?e(c):e;t(i.audiences),n(i.types),o(i.sections),l(i.bylines),d(i.tags)}]},hZ=e=>hr()(e,(e,t)=>({audiences:"audiences",types:"types",sections:"section_ids",bylines:"byline_ids",tags:"tag_ids"})[t]),hw=e=>{let t={};return e.dateRange.from&&(t.date_range_from=e.dateRange.from.toString()),e.dateRange.to&&(t.date_range_to=e.dateRange.to.toString()),t},hC=e=>{let{pub:t,post:i,postsResource:n,type:r,title:o,meta_text:a,features:l,onClick:s}=e,{video_upload_id:d,draft_video_upload_id:c}=i,[u,p]=(0,A.eJ)(!1);return(0,Z.tZ)("a",{href:"restack"!==i.type?(0,en.uRy)(t,i,{edit:!0,noBase:!0}):"javascript:void(0)",onClick:s,className:"miniPostRowLink-LvLtK7",children:(0,Z.BX)(et.hs,{direction:"column",position:"relative",children:[(0,Z.BX)(et.gq,{opacity:u?50:100,gap:12,paddingX:16,paddingY:12,justifyContent:"space-between",alignItems:"center",className:"miniPostRow-aioqWt",children:[(0,Z.BX)(et.tu,{children:[(0,Z.BX)(et.gq,{gap:6,alignItems:"center",children:[p0(r,null!=d?d:c),(0,Z.tZ)(ei.xv.B4,{weight:"medium",ellipsis:!0,style:{maxWidth:p1(r)?"200px":"230px"},children:o})]}),(0,Z.tZ)(p4,{bylines:i.bylines,section_name:i.section_name}),(0,Z.tZ)(ei.xv.Meta,{children:a})]}),"restack"!==i.type?(0,Z.tZ)(pM,{post:i,features:l,postsResource:n,onActionStart:()=>p(!0),onActionEnd:()=>p(!1)}):null]}),u&&(0,Z.tZ)(et.hs,{position:"absolute",style:{width:"100%",height:"100%"},justifyContent:"center",alignItems:"center",children:(0,Z.tZ)(iI.$j,{})})]})})};function hx(){let e=(0,G._)(["Last updated ",""]);return hx=function(){return e},e}let hS=e=>{let{post:t,postsResource:i}=e,{iString:n,iTemplate:r}=(0,Q.M1)(),o=(0,eq.Ij)(),a=(0,re.aF)(),{type:l,draft_updated_at:s,draft_title:d}=t;return(0,Z.tZ)(hC,{pub:o,post:t,postsResource:i,type:l,title:d||n("Untitled"),meta_text:s?r(hx(),(0,H.Z)(s).format("MMM D")):null,features:pE({view:"drafts",type:l,user:a,post:t})})},hk=()=>{let{iString:e}=(0,Q.M1)();return{everyone:e("Everyone"),only_paid:e("Paid subscribers"),founding:e("Founding members")}},hB=e=>{let{isOpen:t,onClose:i,pub:n,post:r}=e,{iString:o}=(0,Q.M1)(),a=hk(),l=r&&"scheduled_at"in r?r.scheduled_at:null==r?void 0:r.trigger_at,[s,d]=(0,A.eJ)(""),[c,u]=(0,A.eJ)(!0),[p,h]=(0,A.eJ)(!0),[m,g]=(0,A.eJ)(new Date(Date.now()+864e5)),[v,b]=(0,A.eJ)(!1),[y,f]=(0,A.eJ)(!1);(0,A.d4)(()=>{r&&(d(r.audience),u(!!r.scheduled_email_audience),h(!!r.scheduled_post_audience),g(l||new Date))},[r,l]);let _=(c||p)&&r&&(s!==r.audience||!!r.scheduled_post_audience!==p||!!r.scheduled_email_audience!==c||!(0,H.Z)(m).isSame((0,H.Z)(l))),w=async()=>{if(window.confirm(o("Are you sure?"))){if(!r){console.error("post is missing");return}try{f(!0),await N().delete("/api/v1/drafts/".concat(r.id))}catch(e){f(!1),console.error(o("Error deleting:"),e),alert((0,Y.zx)(e,o("There was a network issue. Try again in a bit")));return}i(),f(!1)}},C=async()=>{if(!r){console.error("post is missing");return}try{b(!0),await N().patch("/api/v1/restack/post").send({audience:s,restacking_post_id:r.id,sendEmail:c,publishToWeb:p,scheduledAt:m})}catch(e){b(!1),console.error(o("Error updating:"),e),alert((0,Y.zx)(e,o("There was a network issue. Try again in a bit")));return}i(),b(!1)};return(0,Z.BX)(eK.u_,{isOpen:t,onClose:i,className:"modal-WXc9dJ",children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:i,title:o("Edit cross-post")}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:20,children:[(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B3,{translated:!0,children:"Send to"}),(0,Z.tZ)(oY.i,{value:s,onChange:e=>{d(e.target.value)},children:((null==n?void 0:n.payments_state)==="enabled"?(0,ty.getAudiencesForPublicListing)():["everyone"]).map(e=>(0,Z.tZ)("option",{value:e,children:a[e]}))})]}),(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.tZ)(ei.xv.B3,{translated:!0,children:"Delivery"}),(0,Z.tZ)(iw.j,{value:c,label:o("Send cross-post via email"),onChange:e=>u(e)}),(0,Z.tZ)(iw.j,{value:p,label:o("Publish cross-post to web"),onChange:e=>h(e)}),(0,Z.tZ)(iw.j,{value:!0,label:o("Scheduled time to publish cross-post"),onChange:()=>{},contentBelow:(0,Z.tZ)(et.tu,{paddingTop:8,children:(0,Z.tZ)(aT.Tz,{value:null!=m?m:new Date,max:new Date(Date.now()+79488e5),onChange:e=>{g(new Date(e.currentTarget.value))}})})})]})]})}),(0,Z.tZ)(eK.mz,{showDivider:!1,direction:"row",primaryButton:(0,Z.tZ)(ee.zx,{disabled:v||!_,onClick:C,priority:"primary",children:v?o("Updating"):o("Update")}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:w,priority:"secondary",disabled:y,children:y?o("Cancelling cross-post"):o("Cancel cross-post")})})]})};function hT(){let e=(0,G._)(["Scheduled for ",""]);return hT=function(){return e},e}let hI=e=>{let{post:t,postsResource:i}=e,{iTemplate:n,language:r}=(0,Q.M1)(),o=(0,eq.Ij)(),a=(0,re.aF)(),[l,s]=(0,A.eJ)(!1),{type:d,trigger_at:c,draft_title:u}=t;return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(hC,{pub:o,post:t,postsResource:i,type:d,title:u||"Untitled",meta_text:n(hT(),(0,H.Z)(c).locale(r).format("MMM D")),features:pE({view:"scheduled",type:d,user:a,post:t}),onClick:()=>{"restack"===t.type&&s(!0)}}),"restack"===t.type?(0,Z.tZ)(hB,{isOpen:l,post:t,onClose:async()=>{await i.refetch(),s(!1)},pub:o}):null]})};function hN(){let e=(0,G._)([""," Free â€¢ "," Paid"]);return hN=function(){return e},e}function hP(){let e=(0,G._)([""," Paid"]);return hP=function(){return e},e}function hE(){let e=(0,G._)([""," Free"]);return hE=function(){return e},e}let hX=e=>{let{label:t,value:i}=e;return(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"secondary",children:i}),(0,Z.tZ)(ei.xv.B5,{weight:"medium",color:"secondary",children:t})]})},hM=e=>{let{post:t,postsResource:i,countsResource:n}=e,r=(0,eq.Ij)(),{getConfigFor:o}=(0,io.xR)(),a=pB(),l=(0,re.aF)(),{iString:s,iTemplate:d}=(0,Q.M1)(),{id:c,title:u,stats:{sent:p,opened:h,signups:m,subscribes:g,views:v},email_sent_at:b,should_send_free_preview:y,audience:f,type:_,comment_count:w,reactions:C,post_date:x}=t,S=p$(b),k="enabled"===r.payments_state,B=r.founding_plan_enabled?r.founding_plan_name:null,T=m&&g?d(hN(),m,g):g?d(hP(),g):m&&k?d(hE(),m):s("No new subscribers");return(0,Z.tZ)(p7,{post:t,title:u||s("Untitled"),pub:r,dateString:t.post_date?(0,Y.Po)(x):"",meta:(0,Z.tZ)(p6,{meter_type:t.meter_type,pub:r,should_send_free_preview:y,audience:f,comment_count:w,reactions:C,type:_,foundingTierLabel:B,titleExperiment:t.headlineTest}),toplineStats:(0,Z.BX)(et.gq,{gap:40,display:{mobile:"none",desktop:"flex"},children:[l.is_admin&&(0,Z.tZ)(tW.u,{text:T,disabled:!k||!m&&!g,children:(0,Z.tZ)(hX,{label:s("Subs"),value:S?s("N/A"):(0,er.truncateNumber)(m+g,{minSignificantDigits:3})})}),(0,Z.tZ)(hX,{label:s("Views"),value:S?s("N/A"):(0,er.truncateNumber)(v,{minSignificantDigits:3})}),b?(0,Z.tZ)(hX,{label:s("Opened"),value:S?s("N/A"):"".concat((0,er.numberToString)(100*h/(p||1)),"%")}):(0,Z.tZ)(hX,{label:s("Opened"),value:s("N/A")})]}),href:(0,en.cwg)(void 0,c,{referrer:location.pathname+location.search}),rightAction:a.view,features:pE({view:"published",type:_,user:l,post:t,isRepublishingEnabled:(0,oo.HD)({pub:r})&&!!o("republishing_enabled")}),postsResource:i,countsResource:n})};function hA(){let e=(0,G._)(["Scheduled for ",""]);return hA=function(){return e},e}let hD=e=>{let{post:t,postsResource:i,countsResource:n}=e,r=(0,eq.Ij)(),o=(0,re.aF)(),{iString:a,iTemplate:l}=(0,Q.M1)(),[s,d]=(0,A.eJ)(!1),{openModal:c,closeModal:u}=(0,px.dd)(),{id:p,should_send_free_preview:h,type:m,audience:g,trigger_at:v,draft_title:b}=t,y=r.founding_plan_enabled?r.founding_plan_name:null;return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(p7,{post:t,title:b||a("Untitled"),dateString:l(hA(),(0,Y.Po)(v)),pub:r,meta:(0,Z.tZ)(p6,{meter_type:t.meter_type,pub:r,should_send_free_preview:h,audience:g,type:m,foundingTierLabel:y}),href:"restack"!==t.type?(0,en.ANx)(r,p,{params:{back:"undefined"!=typeof window&&window.location.pathname+window.location.search}}):"javascript:void(0)",onClick:()=>{"restack"===t.type&&(0,oo.HD)({pub:r})?c({children:(0,Z.tZ)(pC,{post_id:t.id,onClose:async()=>{await Promise.all([i.refetch(),null==n?void 0:n.refetch()]),u()}}),width:540}):"restack"===t.type&&d(!0)},features:pE({view:"scheduled",type:m,user:o,post:t}),postsResource:i,countsResource:n}),"restack"===t.type?(0,Z.tZ)(hB,{isOpen:s,post:t,onClose:async()=>{await Promise.all([i.refetch(),null==n?void 0:n.refetch()]),d(!1)},pub:r}):null]})};var hR=i(56687);let hF=e=>{switch(e){case"drafts":return"drafts";case"scheduled":return"scheduled posts";default:return"posts"}},hL=()=>(0,Z.tZ)(hH,{children:(0,Z.tZ)(iI.$j,{})}),hz=e=>{let{view:t,pub:i,hasActiveFilters:n,searchQuery:r}=e;return n?(0,Z.tZ)(hU,{view:t,searchQuery:r}):(0,Z.tZ)(hY,{view:t,pub:i})},hO=e=>{let t,{itemLabel:i}=e,{iString:n}=(0,Q.M1)();switch(i){case"post":t=n("We were unable to load this post.");break;case"posts":t=n("We were unable to load your posts.")}return(0,Z.tZ)(hH,{children:(0,Z.tZ)(tp._Y,{title:t,icon:(0,Z.tZ)(eN.Z,{}),text:n("Please try reloading the page"),action:(0,Z.tZ)(ee.zx,{size:"sm",onClick:()=>{location.reload()},priority:"secondary-outline",children:n("Reload")})})})},hU=e=>{let t,{view:i,searchQuery:n}=e,{iString:r}=(0,Q.M1)();switch(hF(i)){case"drafts":t=r(n?'No drafts found for "'.concat(n,'"'):"No drafts found");break;case"scheduled posts":t=r(n?'No scheduled posts found for "'.concat(n,'"'):"No scheduled posts found");break;default:t=r(n?'No posts found for "'.concat(n,'"'):"No posts found")}return(0,Z.tZ)(hH,{children:(0,Z.tZ)(tp._Y,{title:t,icon:(0,Z.tZ)(sw.Z,{}),text:r("Try a different search or filter")})})},hY=e=>{let t,{view:i,pub:n}=e,{iString:r}=(0,Q.M1)();switch(hF(i)){case"drafts":t=r("No drafts yet");break;case"scheduled posts":t=r("No scheduled posts yet");break;default:t=r("No posts yet")}return(0,Z.tZ)(hH,{children:(0,Z.tZ)(tp._Y,{title:t,text:r("Get started by creating a new post"),icon:(0,Z.tZ)(hR.Z,{}),action:(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-outline",href:(0,j.qYj)(n),children:r("New post")})})})},hH=(0,ts.zo)({display:"flex",alignItems:"center",justifyContent:"center",paddingY:64}),hj={published:[{label:"Newest first",by:"post_date",direction:"desc"},{label:"Oldest first",by:"post_date",direction:"asc"},{label:"Last edited",by:"draft_updated_at",direction:"desc"},{label:"Most relevant",by:"relevance",direction:"desc"}],drafts:[{label:"Last edited",by:"draft_updated_at",direction:"desc"},{label:"Newest first",by:"draft_created_at",direction:"desc"},{label:"Oldest first",by:"draft_created_at",direction:"asc"},{label:"Most relevant",by:"relevance",direction:"desc"}],scheduled:[{label:"Scheduled time",by:"trigger_at",direction:"asc"},{label:"Last edited",by:"draft_updated_at",direction:"desc"},{label:"Newest first",by:"draft_created_at",direction:"desc"},{label:"Oldest first",by:"draft_created_at",direction:"asc"},{label:"Most relevant",by:"relevance",direction:"desc"}]},hJ=e=>({order_by:e.by,order_direction:e.direction}),hV=e=>{let{view:t}=e,[i,n]=(0,A.eJ)(hj[t][0]);return(0,A.d4)(()=>{n(hj[t][0])},[n,t]),[i,n]},hq=e=>{var t;let{searchQuery:i,sort:n,setSort:r,view:o}=e,a=(0,eW.default)("post_management_search_engine")===hh,l=hj[o].filter(e=>a||"relevance"!==e.by).filter(e=>i||"relevance"!==e.by),{iString:s}=(0,Q.M1)();return(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",trailing:(0,Z.tZ)(tw.Z,{}),children:s((null===(t=l.find(e=>e.by===n.by&&e.direction===n.direction))||void 0===t?void 0:t.label)||l[0].label)}),title:s("Sort"),layerOptions:{placement:"bottom-end"},children:l.map((e,t)=>{let{label:o,by:a,direction:l}=e,d=a===n.by&&l===n.direction;return(0,Z.tZ)(tC.sN,{disabled:!i&&"relevance"===a,trailing:d?(0,Z.tZ)(eE.Z,{size:20}):void 0,onClick:()=>{r({label:o,by:a,direction:l}),(0,U.j)(U.FP.POSTS_PAGE_SORTED,{sort:"".concat(a,"_").concat(l)})},children:s(o)},t)})})},hW=e=>{let{view:t,postsResource:i,countsResource:n,isMini:r,calendarizedDateKey:o,hasActiveFilters:a,maxRows:l,isLoading:s,searchQuery:d,pub:c}=e,{rows:u,error:p}=i,h=pQ(u.slice(0,l),o),m=!p&&(null==u?void 0:u.length)===0,g={published:hM,drafts:r?hS:hi,scheduled:r?hI:hD}[t];return s?(0,Z.tZ)(hL,{}):p?(0,Z.tZ)(hO,{itemLabel:"posts"}):m?(0,Z.tZ)(hz,{view:t,hasActiveFilters:a,searchQuery:d,pub:c}):o?(0,Z.tZ)(Z.HY,{children:h.map((e,t)=>{let{monthYearHeader:r}=e;return(0,Z.BX)(Z.HY,{children:[t>0&&(0,Z.tZ)(tX.iz,{}),r&&(0,Z.tZ)(hG,{date:r}),(0,Z.tZ)(g,{post:e,postsResource:i,countsResource:n})]})})}):(0,Z.tZ)(Z.HY,{children:u.slice(0,l).map(e=>(0,Z.tZ)(g,{post:e,postsResource:i,countsResource:n}))})},hG=e=>{let{date:t}=e;return(0,Z.tZ)(Z.HY,{children:(0,Z.tZ)(et.sg,{paddingX:16,paddingY:8,bg:"primary",children:(0,Z.tZ)(ei.xv.Meta,{children:t})})})},hK=e=>{let{view:t,sort:i,filters:n,postDateRange:r,searchQuery:o,countsResource:a,pub:l}=e,s=pr({url:"/api/v1/post_management/".concat(t),query:(0,f._)({},hJ(i),hZ(n),hw(r)),searchQuery:null!=o?o:void 0,deps:[i,n,r,o],dataKey:"posts",pageSize:25,auto:!!hj[t].find(e=>e.by===i.by)}),{rows:d,offset:c,total:u,onPrevPage:p,onNextPage:h,onFirstPage:m,onLastPage:g,hasMoreRows:v,isLoading:b,error:y}=s,_=!y&&(null==d?void 0:d.length)===0,w=Math.floor(c/25)+1,C=Math.ceil(u/25);return(0,Z.BX)(h$,{children:[(0,Z.tZ)(hW,{postsResource:s,countsResource:a,view:t,hasActiveFilters:hb(n,r)+ +!!o>0,calendarizedDateKey:i.by,isLoading:b,searchQuery:o,pub:l}),!b&&!_&&!y&&(0,Z.tZ)(hQ,{currentPage:w,totalPages:C,onPrevPage:p,onNextPage:h,onFirstPage:m,onLastPage:g,hasMoreRows:v})]})},hQ=e=>{let{currentPage:t,totalPages:i,onPrevPage:n,onNextPage:r,onFirstPage:o,onLastPage:a,hasMoreRows:l}=e;return(0,Z.tZ)(et.hs,{justifyContent:"center",padding:16,borderTop:"detail",children:(0,Z.BX)(nK.tl,{children:[(0,Z.BX)(et.hs,{gap:4,children:[(0,Z.tZ)(nK.Gt,{onClick:o,disabled:1===t}),(0,Z.tZ)(nK.FS,{onClick:n,disabled:1===t})]}),(0,Z.tZ)(nK.bp,{currentPage:t,totalPages:i}),(0,Z.BX)(et.hs,{gap:4,children:[(0,Z.tZ)(nK.$W,{onClick:r,disabled:!l}),(0,Z.tZ)(nK.kt,{onClick:a,disabled:!l})]})]})})},h$=(0,ts.zo)({border:"detail",radius:"sm",shadow:"xs",overflow:"hidden"}),h0={resourceWrapper:"resourceWrapper-idWWzZ",resourceImageWrapper:"resourceImageWrapper-FISLKf",resourceImage:"resourceImage-s1cBrn",postTableImageWrapper:"postTableImageWrapper-KCaHCM",postTableImage:"postTableImage-g0olA9",borderedTable:"borderedTable-IsRfG8",latestPostSection:"latestPostSection-JTl_mb",playOverlay:"playOverlay-SgUcEt",draftsAndScheduledPosts:"draftsAndScheduledPosts-CXVuzA",latestPostYouTubeStatus:"latestPostYouTubeStatus-OE22CZ"},h1=e=>{var t,i;let{draftsResource:n,scheduledResource:r,pub:o}=e;return!n.hasLoadedOnce&&n.isLoading||!r.hasLoadedOnce&&r.isLoading?(0,Z.tZ)(iI.$j,{}):(0,Z.BX)(et.tu,{gap:40,flex:"grow",className:h0.draftsAndScheduledPosts,justifyContent:"start",children:[(0,Z.tZ)(h2,{draftsResource:n,maxRows:(null===(t=r.rows)||void 0===t?void 0:t.length)?3:5,pub:o}),!!(null==r?void 0:null===(i=r.rows)||void 0===i?void 0:i.length)&&(0,Z.tZ)(h4,{scheduledResource:r,pub:o})]})},h2=e=>{let{draftsResource:t,maxRows:i,pub:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(d6,{title:r("Drafts"),action:(0,Z.tZ)("a",{href:"/publish/posts/drafts",style:{textDecoration:"none"},children:(0,Z.BX)(et.gq,{alignItems:"center",gap:4,children:[(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"secondary",children:r("View all")}),(0,Z.tZ)(uY.Z,{size:16,strokeWidth:2,stroke:"var(--color-fg-secondary)"})]})}),children:(0,Z.tZ)(h$,{children:(0,Z.tZ)(hW,{view:"drafts",isLoading:t.isLoading&&!t.hasLoadedOnce,isMini:!0,postsResource:t,maxRows:i,pub:n})})})},h4=e=>{let{scheduledResource:t,pub:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(d6,{title:n("Scheduled"),action:(0,Z.tZ)("a",{href:"/publish/posts/scheduled",style:{textDecoration:"none"},children:(0,Z.BX)(et.gq,{alignItems:"center",gap:4,children:[(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"secondary",children:n("View all")}),(0,Z.tZ)(uY.Z,{size:16,strokeWidth:2,stroke:"var(--color-fg-secondary)"})]})}),children:(0,Z.tZ)(h$,{children:(0,Z.tZ)(hW,{postsResource:t,isLoading:t.isLoading&&!t.hasLoadedOnce,view:"scheduled",isMini:!0,pub:i})})})};var h3=i(70843),h8=i(16354);let h6=e=>{let{children:t,content:i,baseRef:n,portalClass:r="",className:o="",style:a}=e,l=(0,A.sO)(null),s=(0,A.sO)(null);return i?(0,Z.BX)("div",{ref:l,className:o,style:a,children:[t,(0,Z.tZ)(uQ,{baseRef:n||l,hoverToggle:!0,onOpen:()=>{var e;return null===(e=s.current)||void 0===e?void 0:e.open()},onClose:()=>{var e;return null===(e=s.current)||void 0===e?void 0:e.close()},className:r,children:(0,Z.tZ)(eY.Fx,{ref:s,noList:!0,className:"explanation",children:i})})]}):(0,Z.tZ)(Z.HY,{children:t})};var h5=i(58319);let h9=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(null),[o,a]=(0,A.eJ)(null),[l,s]=(0,A.eJ)(!1);(0,A.d4)(()=>{!async function(){let e=await (0,ix.rd)("/api/v1/grow/suggestion",{method:"GET"});e&&e.suggestion&&(r(e.suggestion),a(e.suggestionKey))}()},[]);let d=(0,Z.tZ)(iI.$j,{});n&&(d=(0,Z.BX)(et.gq,{gap:32,children:[(0,Z.tZ)("img",{src:(0,en.zF4)("/img/dashboard/gear.png"),height:60,width:100,style:{margin:"auto"}}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.H4,{children:i(n.header)}),(0,Z.tZ)(ei.xv.B4,{children:i(n.body)}),(0,Z.tZ)("a",{href:"share"!==o?n.url:void 0,style:{textDecoration:"none",cursor:"pointer"},onClick:()=>{(0,U.j)(U.FP.GROW_TAB_CTA_CLICKED,{cta:n.cta,key:o}),"share"===o&&s(!0)},children:(0,Z.BX)(et.gq,{gap:4,children:[(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:i(n.cta)}),(0,Z.tZ)(uY.Z,{size:20,strokeWidth:2,stroke:"var(--color-fg-secondary)"})]})})]})]}));let c=(0,Z.BX)(et.gq,{gap:4,children:[i("Grow your audience"),(0,Z.tZ)(h6,{content:i("This module analyzes your Substack's performance and provides a rotating list of suggestions on how to improve the growth of your Substack."),children:(0,Z.tZ)(h3.Z,{size:20,style:{margin:"auto"}})})]});return(0,Z.BX)(h5.Z,{onVisible:()=>{n&&(0,U.j)(U.FP.GROW_TAB_SUGGESTION_SHOWN,{key:o})},children:[n?(0,Z.tZ)(d6,{title:c,children:(0,Z.tZ)(et.tu,{border:"detail",radius:"md",paddingX:32,paddingY:20,alignItems:"baseline",children:d})}):null,(0,Z.tZ)(h8.iL,{pub:t,isOpen:l,setOpen:s,item:{type:"pub_shareable_image"}})]})},h7=e=>{let{selectedSectionId:t}=e,i=(0,A.Ye)(()=>[t],[t]),n=pr({url:"/api/v1/post_management/drafts",query:{order_by:"draft_updated_at",order_direction:"desc",offset:0,section_ids:t?[t]:void 0},deps:i,dataKey:"posts",pageSize:5,auto:!0});return{draftsResource:n,publishedResource:pr({url:"/api/v1/post_management/published",query:{order_by:"post_date",order_direction:"desc",offset:0,section_ids:t?[t]:void 0},deps:i,dataKey:"posts",pageSize:3,auto:!0}),scheduledResource:pr({url:"/api/v1/post_management/scheduled",query:{order_by:"trigger_at",order_direction:"asc",offset:0,section_ids:t?[t]:void 0},deps:i,dataKey:"posts",pageSize:1,auto:!0})}};var me=i(33112);let mt=e=>(0,er.truncateNumber)(null!=e?e:0,{minSignificantDigits:3}),mi=e=>{let{post:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)("a",{href:(0,en.cwg)(void 0,t.id,{referrer:location.pathname}),style:{textDecoration:"none"},children:(0,Z.BX)(et.gq,{alignItems:"center",gap:4,children:[(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"secondary",children:i("View post stats")}),(0,Z.tZ)(uY.Z,{size:16,strokeWidth:2,stroke:"var(--color-fg-secondary)"})]})})},mn=e=>{var t;let{pub:i,postsResource:n}=e,{iString:r}=(0,Q.M1)(),o=(0,re.aF)()||{},a=null==n?void 0:null===(t=n.rows)||void 0===t?void 0:t[0],l=(null==a?void 0:a.stats)&&(a.stats.signups>0||a.stats.subscribes>0);return(0,Z.tZ)(d6,{className:h0.latestPostSection,title:r("Latest post"),action:a?(0,Z.tZ)(mi,{post:a}):void 0,children:a?(0,Z.BX)(et.tu,{border:"detail",radius:"md",padding:20,gap:20,paddingBottom:24,children:[(0,Z.tZ)(p7,{post:a,title:a.title||r("Untitled"),pub:i,dateString:a.post_date?(0,Y.Po)(a.post_date):"",meta:(0,Z.tZ)(p6,{meter_type:a.meter_type,pub:i,should_send_free_preview:a.should_send_free_preview,audience:a.audience,type:a.type,titleExperiment:a.headlineTest}),href:(0,en.cwg)(void 0,a.id,{referrer:location.pathname}),onClick:()=>{(0,U.j)(U.FP.LATEST_POST_CLICKED,{postId:a.id})},features:pE({view:"published",type:a.type,user:o,post:a}),isSpotlighted:!0,postsResource:n}),a.video_upload_id&&(0,Z.tZ)(iz,{mediaUploadId:a.video_upload_id,className:h0.latestPostYouTubeStatus,postId:a.id,source:"dashboard"}),(0,Z.BX)(et.tu,{gap:20,children:[(0,Z.tZ)(mr,{title:r("Views"),text:mt(a.stats.views),divider:!0}),(0,Z.tZ)(mr,{title:r("Opened"),text:a.stats.sent?"".concat((0,er.numberToString)(100*a.stats.opened/a.stats.sent),"%"):"-",divider:!0}),(null==o?void 0:o.is_admin)&&(0,Z.tZ)(mr,{title:r("New subs"),text:l?void 0:"-",divider:!0,children:l?(0,Z.BX)(et.gq,{justifyContent:"end",alignItems:"center",gap:6,children:[a.stats.subscribes>0&&(0,Z.tZ)(mo,{title:r("Subscribers"),label:r("new paid subscription"),paid:!0,val:a.stats.subscribes,faces:a.stats.subscriber_faces}),a.stats.subscribes>0&&a.stats.signups>0&&(0,Z.tZ)(Z.HY,{children:" \xb7 "}),a.stats.signups>0&&(0,Z.tZ)(mo,{title:r("Free signups"),label:r("new free subscription"),val:a.stats.signups,faces:a.stats.signups_faces}),(0,Z.tZ)(rf.Z,{className:h0.arrowUpIcon,size:15,color:"#27AE60"})]}):void 0}),(0,Z.tZ)(mr,{title:r("Likes"),text:mt(a.reactions["â¤"]),divider:!0}),(0,Z.tZ)(mr,{title:r("Comments"),text:"none"===a.write_comment_permissions?"-":mt(a.comment_count),link:(0,j.tk4)(i,a)})]}),["restack","adhoc_email"].includes(a.type)?null:(0,Z.tZ)(et.hs,{direction:{mobile:"column",desktop:"row"},justifyContent:"space-between",gap:16,children:(0,Z.tZ)(ee.zx,{priority:"primary",newTab:!0,href:(0,en.fQy)(i,a.id),leading:(0,Z.tZ)(nE.Z,{size:20}),flex:"grow",children:r("Share post")})})]}):(0,Z.tZ)(et.hs,{padding:32,alignItems:"center",justifyContent:"center",style:{height:"100%"},children:(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"You haven't published anything"})})})},mr=e=>{let{title:t,link:i,text:n,divider:r,children:o}=e;return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("a",{href:i,style:{textDecoration:"none"},children:(0,Z.BX)(et.gq,{justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",size:14,children:t}),n&&(0,Z.tZ)(ei.xv.B4,{size:14,children:n}),o]})}),r&&(0,Z.tZ)(tX.iz,{})]})},mo=e=>{let{title:t,paid:i,val:n,faces:r}=e,{iString:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(!1);return n?(0,Z.BX)(et.gq,{gap:4,alignItems:"center",onClick:()=>l(!0),style:{cursor:(null==r?void 0:r.length)?"pointer":void 0},children:[(0,Z.BX)(ei.xv.B4,{size:14,children:[(0,er.truncateNumber)(null!=n?n:0,{minSignificantDigits:3})," ",o(i?"paid":"free")]}),(null==r?void 0:r.length)&&r.length>0?(0,Z.tZ)(me.F,{isOpen:a,onClose:()=>{l(!1)},modalLabel:t,faces:r,totalCount:n,utmSource:"home-dashboard"}):null]}):null};var ma=i(76641);function ml(e){var{title:t,href:i,value:n,format:r,currency:o,currencyIsCents:a,tooltip:l,menu:s,description:d,renderDelta:c,flex:u="grow",children:p}=e,h=(0,ef._)(e,["title","href","value","format","currency","currencyIsCents","tooltip","menu","description","renderDelta","flex","children"]);let m=(0,pY.XA)();return(0,Z.BX)(s6.Z,(0,_._)((0,f._)({href:i,flex:u},h),{children:[(0,Z.BX)(s6.Z.Header,{children:[(0,Z.tZ)(s6.Z.Title,{children:t}),l&&(0,Z.tZ)(s6.Z.Tooltip,{title:t,text:l,disabled:m}),s&&s]}),(0,Z.tZ)(s6.Z.Body,{children:(0,Z.tZ)(ms,{value:n,format:r,currency:o,currencyIsCents:a,renderDelta:c})}),(0,Z.BX)(et.sg,{children:[(0,Z.tZ)(s6.Z.Footer,{children:d&&(0,Z.tZ)(s6.Z.Description,{children:d})}),p&&(0,Z.tZ)(s6.Z.Footer,{children:p})]})]}))}let ms=e=>{let{value:t,format:i="number",currency:n="usd",currencyIsCents:r,renderDelta:o}=e,a=(0,ma.L)(t,i,n,r),l=a===ma.N;return(0,Z.BX)(et.X2,{justifyContent:"space-between",alignItems:"center",gap:12,wrap:"wrap",children:[(0,Z.tZ)(s6.Z.Value,{children:(0,Z.tZ)(ei.Zx,{color:l?"tertiary":"primary",children:a})}),o&&o({value:t,format:i,currency:n})]})},md=e=>{let{pub:t,stats:i,loading:n,error:r}=e;return(0,Z.tZ)(et.sg,{children:n?(0,Z.tZ)(iI.$j,{bg:"primary",padding:64,border:"detail",radius:"md",alignItems:"center",justifyContent:"center"}):r||!i?(0,Z.BX)(et.tu,{gap:8,bg:"secondary",padding:64,border:"detail",radius:"md",alignItems:"center",justifyContent:"center",children:[(0,Z.tZ)(eN.Z,{size:24,color:"var(--color-fg-secondary)"}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:r})]}):(0,Z.tZ)(mc,{pub:t,stats:i})})},mc=e=>{let{pub:t,stats:i}=e,{iString:n}=(0,Q.M1)(),r=(null==t?void 0:t.created_at)&&(0,H.Z)(t.created_at).isBefore((0,H.Z)().subtract(60,"days")),o=n("versus prior 30 days"),a=n("over last 30 days");return(0,Z.BX)(ts.xu,{gap:12,className:"statsGrid-t8qIIG",children:["enabled"===t.payments_state&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ml,{title:n("Paid subscribers"),value:null==i?void 0:i.subscribers,format:"number",href:"/publish/subscribers",tooltip:n("The total number of paying subscribers."),renderDelta:r?e=>{let{format:t}=e;return(0,Z.tZ)(d_.Wm,{value:null==i?void 0:i.subscribersLast30Days,format:t,suffix:a})}:void 0}),(0,Z.tZ)(ml,{title:n("Gross annualized revenue"),value:null==i?void 0:i.arr,format:"dollar",href:"/publish/subscribers",tooltip:n("How much money you make per year based on annualizing current subscriptions."),renderDelta:r?e=>{let{format:t}=e;return(0,Z.tZ)(d_.Wm,{value:null==i?void 0:i.arrDelta,format:t,suffix:a})}:void 0})]}),(0,Z.tZ)(ml,{title:n("All subscribers"),value:null==i?void 0:i.totalEmail,format:"number",href:"/publish/subscribers",tooltip:n("The total number of free and paying subscribers on your list."),renderDelta:r?e=>{let{format:t}=e;return(0,Z.tZ)(d_.Wm,{value:null==i?void 0:i.totalEmailLast30Days,format:t,suffix:a})}:void 0}),(0,Z.tZ)(ml,{title:n("Subscribers from app"),value:null==i?void 0:i.appSubscribers,format:"number",href:"/publish/stats/network",tooltip:n("People who subscribed directly via Substack surfaces such as the mobile app, Notes, or the leaderboards."),renderDelta:r?e=>{let{format:t}=e;return(0,Z.tZ)(d_.Wm,{value:null==i?void 0:i.appSubscribersLast30Days,format:t,suffix:a})}:void 0}),(0,Z.tZ)(ml,{title:n("30 day views"),value:null==i?void 0:i.views,format:"number",href:"/publish/stats/traffic",tooltip:n("The total number of post views in the last 30 days."),renderDelta:r?e=>{let{format:t}=e;return(0,Z.tZ)(d_.Wm,{value:null==i?void 0:i.viewsDelta,format:t,suffix:o})}:void 0}),(0,Z.tZ)(ml,{title:n("30 day open rate"),value:(null==i?void 0:i.openRate)/100,format:"percent",href:"/publish/stats/emails",tooltip:n("The average open rate of posts in the last 30 days."),renderDelta:r?e=>{let{format:t}=e;return(0,Z.tZ)(d_.Wm,{value:(null==i?void 0:i.openRateDiff)/100,format:t,suffix:o})}:void 0}),"disabled"===t.payments_state&&i.numPledges>0&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ml,{title:n("Number of pledges"),value:null==i?void 0:i.numPledges,format:"number",href:"/publish/stats/pledges",tooltip:n("The number of readers who have pledged to support your work if you choose to enable payments.")}),(0,Z.tZ)(ml,{title:n("Pledged annualized revenue"),value:null==i?void 0:i.pledgesAmount,format:"currency",currencyIsCents:!0,currency:i.pledgeCurrency,href:"/publish/stats/pledges",tooltip:n("What your annual revenue would start as if you enabled payments today.")})]})]})},mu=e=>{let{title:t,subtitle:i}=e;return(0,Z.BX)(et.tu,{gap:8,style:{width:"100%"},children:[(0,Z.tZ)(ei.xv.H1,{align:"center",children:t}),(0,Z.tZ)(ei.xv.B3,{align:"center",children:i})]})},mp=e=>{let{paymentPledgeSummary:t}=e,{iString:i}=(0,Q.M1)(),n=t.totalPledges,r=t.currency,o=(0,er.centsToPriceString)(t.totalPledgeAmount,r);return(0,Z.BX)(et.gq,{paddingY:48,children:[(0,Z.tZ)(mu,{title:String(n),subtitle:i("Pledges")}),(0,Z.tZ)(mu,{title:o,subtitle:i("Annualized revenue from pledges")})]})},mh=e=>{let{}=e,{iString:t}=(0,Q.M1)();return(0,Z.BX)(et.hs,{paddingY:32,paddingX:32,border:"detail",radius:"md",gap:24,direction:{desktop:"row",mobile:"column"},children:[(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.H4,{translated:!0,children:"Your subscribers want to support your work"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Pledges allow your subscribers to pledge to become a paid subscriber and show you they believe your work is valuable as it is today. If you turn on payments, pledges turn into recurring paid subscriptions."})]}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,Y.uX)("/publish/settings#connect")},children:t("Accept Payments")})]})},mm=e=>{let{user:t,pledge:i,themeVariables:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(!1),l=(0,eq.Ij)();return(0,Z.BX)(et.tu,{style:{width:"100%"},children:[(0,Z.BX)(et.tu,{as:"a",paddingY:16,paddingX:16,border:"detail",radius:"md",href:(0,j.pN7)(l,t.email),children:[(0,Z.BX)(et.gq,{paddingTop:16,paddingBottom:12,justifyContent:"space-between",children:[(0,Z.tZ)(ug.fi,{photo_url:t.photo_url||(0,j.I4e)(t.id),email:t.email,size:40}),i.can_share_note?(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:e=>{e.stopPropagation(),e.preventDefault(),a(!0)},children:r("Share")}):null]}),(0,Z.BX)(et.tu,{gap:4,paddingBottom:20,children:[(0,Z.tZ)(ei.xv.H4,{children:t.name||t.email}),i.note?(0,Z.BX)(ei.xv.B4,{style:{fontStyle:"italic"},children:['"',i.note,'"']}):t.bio?(0,Z.tZ)(ei.xv.B4,{children:t.bio}):null]}),(0,Z.tZ)("hr",{style:{margin:0}}),(0,Z.BX)(et.gq,{justifyContent:"space-between",paddingTop:20,children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",translated:!0,children:"Pledge"}),(0,Z.BX)(ei.xv.B4,{children:[(0,er.centsToPriceString)(i.payment_amount,i.payment_currency)," / ",i.plan_interval]})]})]}),l&&i.can_share_note?(0,Z.tZ)(h8.iL,{pub:l,item:{type:"pledged_subscription",pub:l,target_user:t,recent_senders:[t],target_pledge_note:i},isOpen:o,setOpen:a,themeVariables:n}):null]})},mg=e=>{let{themeVariables:t}=e,i=(0,A.sO)(),[n,r]=(0,A.eJ)(20),{iString:o}=(0,Q.M1)(),{result:a,isLoading:l}=(0,iS.ib)({pathname:"/api/v1/publication/stats/payment_pledges",auto:!0,query:{limit:n},deps:[n]}),s=(0,A.I4)(e=>{var t;if(l)return;i.current&&i.current.disconnect();let n=(null==a?void 0:null===(t=a.summary)||void 0===t?void 0:t.hasMore)||!1;i.current=new IntersectionObserver(e=>{e[0].isIntersecting&&n&&r(e=>e+20)}),e&&i.current.observe(e)},[l,a]);if(l&&!(null==a?void 0:a.pledgeAndUserData))return(0,Z.tZ)("p",{className:"main-loader",children:o("Loading...")});let d=(null==a?void 0:a.pledgeAndUserData)||[],c=d.filter((e,t)=>t%2==0),u=d.filter((e,t)=>t%2==1);return(0,Z.BX)(et.hs,{direction:{desktop:"row",mobile:"column"},gap:12,paddingTop:12,children:[(0,Z.tZ)(et.tu,{style:{flexBasis:"50%"},gap:12,children:c.map(e=>{let{user:i,pledge:n}=e;return(0,Z.tZ)(mm,{user:i,pledge:n,themeVariables:t})})}),(null==u?void 0:u.length)>0&&(0,Z.tZ)(et.tu,{style:{flexBasis:"50%"},gap:12,children:u.map((e,i)=>{let{user:n,pledge:r}=e;return i===Math.floor(u.length-u.length/5-1)?(0,Z.tZ)("div",{ref:s,children:(0,Z.tZ)(mm,{user:n,pledge:r,themeVariables:t})}):(0,Z.tZ)(mm,{user:n,pledge:r,themeVariables:t})})})]})},mv=e=>{let{themeVariables:t}=e,i=(0,ss.So)(),{iString:n}=(0,Q.M1)();(0,A.d4)(()=>{(0,U.j)(U.FP.STATS_PAGE_VIEWED,{type:"pledges"})},[]);let{result:r,isLoading:o}=(0,iS.ib)({pathname:"/api/v1/publication/stats/payment_pledges/summary",auto:!0,query:{},deps:[]});return o?(0,Z.tZ)("p",{className:"main-loader",children:"Loading..."}):i.getSettingFor("payment_pledges_enabled")?r&&0!==r.totalPledges?(0,Z.BX)(et.tu,{style:{maxWidth:"728px",marginLeft:"auto",marginRight:"auto"},children:[(0,Z.tZ)(mp,{paymentPledgeSummary:r}),(0,Z.tZ)(mh,{}),(0,Z.tZ)(mg,{themeVariables:t})]}):(0,Z.tZ)(et.tu,{paddingY:32,gap:24,alignItems:"center",children:(0,Z.BX)(et.tu,{gap:8,style:{maxWidth:"728px"},children:[(0,Z.tZ)(ei.xv.H3,{align:"center",translated:!0,children:"You don't have any pledges yet"}),(0,Z.tZ)(ei.xv.B4,{align:"center",color:"secondary",translated:!0,children:"But don't worry. Pledges take a while to roll up. You can make this faster by asking your existing readers to pledge their support for you in one of your posts."})]})}):(0,Z.BX)(et.tu,{paddingY:32,gap:24,alignItems:"center",children:[(0,Z.BX)(et.tu,{gap:8,style:{maxWidth:"728px"},children:[(0,Z.tZ)(ei.xv.H3,{align:"center",translated:!0,children:"Enable pledges to start collecting support from your readers"}),(0,Z.tZ)(ei.xv.B4,{align:"center",color:"secondary",translated:!0,children:"Pledges allow your subscribers to pledge to become a paid subscriber and show you they believe your work is valuable as it is today. If you turn on payments, pledges turn into recurring paid subscriptions."})]}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:async()=>{await N().put("/api/v1/publication_settings").send({payment_pledges_enabled:!0}),window.location.reload()},children:n("Enable Pledges")})]})};var mb=i(47976),my=i(63018);let mf={grid:"grid-yhlZcy"},m_=e=>{var t;let{user:i,note:n,can_share_note:r,type:o,themeVariables:a}=e,{data:l}=(0,my._I)((0,en.gKm)({userId:i.id,userName:i.name||"",noBase:!0}),{auto:!!i.name,deps:[i.id]}),s=l||null,d=(0,eq.Ij)(),{iString:c}=(0,Q.M1)(),[u,p]=(0,A.eJ)(!1),h=null!==(t=null==s?void 0:s.can_dm)&&void 0!==t&&t,m=(0,j.pN7)(d,i.email);return(0,Z.BX)(s6.Z,{padding:16,gap:12,radius:"md",children:[i&&(0,Z.tZ)(sx.A0,{href:m,children:(0,Z.tZ)(eG.qE,{user:i,size:40})}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.BX)(et.hs,{flex:"grow",gap:8,alignItems:"center",children:[(0,Z.tZ)(ts.xu,{as:"a",href:m,children:(0,Z.tZ)(ei.xv.B3,{decoration:"hover-underline",weight:"semibold",children:i.name||i.email})}),(0,Z.tZ)(mZ,{type:o})]}),(0,Z.BX)(ei.xv.B4,{children:['"',n,'"']})]}),(r||h)&&(0,Z.BX)(et.gq,{gap:8,children:[s&&h&&(0,Z.tZ)(et.tu,{flex:"grow",children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:async()=>{try{let e=await (0,ix.rd)("/api/v1/messages/dm/start",{method:"POST",json:{user_ids:[i.id],source:"subscriber-note"}});(0,Y.uX)("".concat((0,j.SVA)(),"/chat/").concat(e.thread.id),{local_navigation:!1})}catch(e){console.error("Failed to start DM",e)}},children:c("Reply")})}),r&&(0,Z.tZ)(et.tu,{flex:"grow",children:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:()=>p(!0),children:c("Share")})})]}),d&&r?(0,Z.tZ)(h8.iL,{pub:d,item:{type:"subscribed"===o?"paid_subscription":"pledged_subscription",pub:d,target_user:i,recent_senders:[i],target_subscription_note:{note:n},target_pledge_note:{note:n}},isOpen:u,setOpen:p,themeVariables:a}):null]})},mZ=e=>{let{type:t}=e,{iString:i}=(0,Q.M1)(),n=i("pledge"===t?"Pledged":"Paid");return(0,Z.tZ)(d_.Vp,{theme:"accent",children:n})},mw=e=>{var t;let{themeVariables:i}=e,n=(0,A.sO)(),[r,o]=(0,A.eJ)(20),{iString:a}=(0,Q.M1)(),{result:l,isLoading:s}=(0,iS.ib)({pathname:"/api/v1/publication/stats/subscriber_notes",auto:!0,query:{limit:r},deps:[r]}),d=(0,A.I4)(e=>{var t;if(s)return;n.current&&n.current.disconnect();let i=(null==l?void 0:null===(t=l.summary)||void 0===t?void 0:t.hasMore)||!1;n.current=new IntersectionObserver(e=>{e[0].isIntersecting&&i&&o(e=>e+20)}),e&&n.current.observe(e)},[s,l]),c=(null==l?void 0:l.noteAndUserData)||[],u=c.length-1;return(0,Z.tZ)(d6,{title:a("Paid subscriber notes"),subtitle:a("Notes left by paid subscribers after signing up for your Substack."),children:!s||(null==l?void 0:l.noteAndUserData)?(null==l?void 0:null===(t=l.noteAndUserData)||void 0===t?void 0:t.length)?(0,Z.tZ)(et.hs,{className:mf.grid,gap:12,children:c.map((e,t)=>{let{user:n,note:r,can_share_note:o,type:a}=e,l=t===u;return(0,Z.tZ)("div",{ref:l?d:null,children:(0,Z.tZ)(m_,{user:n,note:r,can_share_note:o,type:a,themeVariables:i})},t)})}):(0,Z.tZ)(tp.mb,{icon:(0,Z.tZ)(mb.Z,{}),title:a("No paid notes yet"),text:a("Notes from paid subscribers will appear here.")}):(0,Z.tZ)(dl,{})})},mC=e=>{let{themeVariables:t}=e;return(0,A.d4)(()=>{(0,U.j)(U.FP.STATS_PAGE_VIEWED,{type:"subscriber-notes"})},[]),(0,Z.tZ)(dp,{children:(0,Z.tZ)(mw,{themeVariables:t})})},mx=e=>{var t,i;let{pub:n,themeVariables:r}=e,{iString:o}=(0,Q.M1)(),a=(0,ss.So)(),{result:l,isLoading:s}=(0,iS.ib)({pathname:"disabled"===n.payments_state?"/api/v1/publication/stats/payment_pledges":"/api/v1/publication/stats/subscriber_notes",auto:!0,query:{limit:2}});return!s&&l&&("disabled"===n.payments_state?a.getSettingFor("payment_pledges_enabled")&&(!("pledgeAndUserData"in l)||(null==l?void 0:null===(t=l.pledgeAndUserData)||void 0===t?void 0:t.length)):!("noteAndUserData"in l)||(null==l?void 0:null===(i=l.noteAndUserData)||void 0===i?void 0:i.length))?(0,Z.tZ)(d6,{title:o("disabled"===n.payments_state?"Recent pledges":"Recent paid subscriber notes"),action:(0,Z.tZ)("a",{href:"disabled"===n.payments_state?(0,en.VQu)(n):(0,en.MiE)(n),style:{textDecoration:"none"},children:(0,Z.BX)(et.gq,{alignItems:"center",gap:4,children:[(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"secondary",children:o("View all")}),(0,Z.tZ)(uY.Z,{size:16,strokeWidth:2,stroke:"var(--color-fg-secondary)"})]})}),children:(0,Z.tZ)(et.tu,{radius:"md",gap:24,children:(0,Z.BX)(et.hs,{direction:{desktop:"row",mobile:"column"},gap:12,children:["noteAndUserData"in l&&l.noteAndUserData.map(e=>{let{note:t,user:i,can_share_note:n,type:o}=e;return(0,Z.tZ)(m_,{user:i,note:t,can_share_note:n,type:o,themeVariables:r})}),"pledgeAndUserData"in l&&l.pledgeAndUserData.map(e=>{let{pledge:t,user:i}=e;return(0,Z.tZ)(mm,{user:i,pledge:t,themeVariables:r})})]})})}):null},mS=e=>{let{postsResource:t,countsResource:i,pub:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(d6,{title:r("Recent posts"),action:(0,Z.tZ)("a",{href:"/publish/posts",style:{textDecoration:"none"},children:(0,Z.BX)(et.gq,{alignItems:"center",gap:4,children:[(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"secondary",translated:!0,children:"View all"}),(0,Z.tZ)(uY.Z,{size:16,strokeWidth:2,stroke:"var(--color-fg-secondary)"})]})}),children:(0,Z.tZ)(h$,{children:(0,Z.tZ)(hW,{pub:n,view:"published",postsResource:t,countsResource:i,isLoading:t.isLoading&&!t.hasLoadedOnce})})})},mk=e=>{let{resourceTier:t}=e,{iString:i}=(0,Q.M1)(),n=[];return 1===t?n=[{title:i("When should I turn on paid subscriptions?"),description:i("An easy guide to earning money for your work"),link:"https://on.substack.com/p/turn-on-paid",imgUrl:"/img/dashboard/resources/coins.png"},{title:i("How do I publish my first post?"),description:i("Post types, formatting tips, settings, and more"),link:"https://on.substack.com/p/first-post",imgUrl:"/img/dashboard/resources/first_post.png"},{title:i("How can I customize my Substack?"),description:i("Themes and options to add a personal touch"),link:"https://on.substack.com/p/customize",imgUrl:"/img/dashboard/resources/customize.png"},{title:i("How do I find my first subscribers?"),description:i("Simple strategies to build an audience from scratch"),link:"https://on.substack.com/p/first-subscribers",imgUrl:"/img/dashboard/resources/megaphone.png"}]:2===t?n=[{title:i("What post types can I publish on Substack?"),description:i("How to publish text, podcasts, video, and threads"),link:"https://on.substack.com/p/types-of-posts-on-substack",imgUrl:"/img/dashboard/resources/post_types.png"},{title:i("How can I grow my free list?"),description:i("Tips for social media, cross-promotion, and more"),link:"https://on.substack.com/p/grow-4",imgUrl:"/img/dashboard/resources/megaphone.png"},{title:i("When should I turn on paid subscriptions?"),description:i("An easy guide to earning money for your work."),link:"https://on.substack.com/p/turn-on-paid",imgUrl:"/img/dashboard/resources/coins.png"},{title:i("How can I collaborate with other writers?"),description:i("How to leverage the Substack community to grow"),link:"https://on.substack.com/p/collaboration",imgUrl:"/img/dashboard/resources/paper_cups.png"}]:3===t?n=[{title:i("How can I convert more paid subscribers?"),description:i("A comprehensive guide to growing your earnings"),link:"https://on.substack.com/p/free-vs-paid",imgUrl:"/img/dashboard/resources/coins.png"},{title:i("How can I collaborate with other writers?"),description:i("How to leverage the Substack community to grow"),link:"https://on.substack.com/p/collaboration",imgUrl:"/img/dashboard/resources/paper_cups.png"},{title:i("How do I understand my Substack metrics?"),description:i("A simple tour of your post and publication stats"),link:"https://support.substack.com/hc/en-us/articles/5320347155860-A-guide-to-Substack-metrics",imgUrl:"/img/dashboard/resources/calculator.png"},{title:i("How are others succeeding on Substack?"),description:i("Learn from our archive of writer success stories"),link:"https://on.substack.com/t/writer-stories",imgUrl:"/img/dashboard/resources/book.png"}]:4===t&&(n=[{title:i("Access priority support"),description:i("Get answers to your technical and strategic question"),link:"https://bestsellers.substack.com/p/support",imgUrl:"/img/dashboard/resources/heart.png"},{title:i("Attend Business School"),description:i("Premium knowledge about how to grow and make money on Substack"),link:"https://bestsellers.substack.com/p/business-school",imgUrl:"/img/dashboard/resources/books.png"},{title:i("Test new features in Product Lab"),description:i("Share feedback and see what's new in the Substack product"),link:"https://bestsellers.substack.com/p/about-the-product-lab",imgUrl:"/img/dashboard/resources/hand.png"},{title:i("How are others succeeding on Substack?"),description:i("Learn from our archive of writer success stories"),link:"https://on.substack.com/t/writer-stories",imgUrl:"/img/dashboard/resources/book.png"}]),(0,Z.tZ)(d6,{title:i("Resources"),children:(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(et.gq,{flex:"grow",justifyContent:"space-between",wrap:"wrap",gap:16,children:n.map(e=>(0,Z.tZ)(mB,{title:e.title,description:e.description,link:e.link,imgUrl:e.imgUrl}))}),(0,Z.BX)(et.hs,{direction:{desktop:"row",mobile:"column"},gap:{mobile:16,desktop:32},children:[(0,Z.tZ)("a",{href:"https://substack.com/resources",target:"_blank",style:{textDecoration:"none"},rel:"noopener",children:(0,Z.BX)(et.gq,{alignItems:"center",gap:4,children:[(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"secondary",translated:!0,children:"Visit our resource center"}),(0,Z.tZ)(uY.Z,{size:16,strokeWidth:2,stroke:"var(--color-fg-secondary)"})]})}),(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us",target:"_blank",style:{textDecoration:"none"},rel:"noopener",children:(0,Z.BX)(et.gq,{alignItems:"center",gap:4,children:[(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"secondary",translated:!0,children:"Frequently asked questions"}),(0,Z.tZ)(uY.Z,{size:16,strokeWidth:2,stroke:"var(--color-fg-secondary)"})]})})]})]})})},mB=e=>{let{title:t,description:i,link:n,imgUrl:r}=e;return(0,Z.tZ)(et.gq,{border:"detail",radius:"md",overflowX:"hidden",className:h0.resourceWrapper,children:(0,Z.tZ)("a",{href:n,style:{textDecoration:"none"},target:"_blank",rel:"noopener",children:(0,Z.BX)(et.gq,{alignItems:"center",children:[(0,Z.tZ)(et.tu,{className:h0.resourceImageWrapper,children:(0,Z.tZ)("img",{className:h0.resourceImage,width:150,src:(0,j.zF4)(r,400)})}),(0,Z.BX)(et.tu,{paddingY:8,paddingX:16,children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",clamp:2,children:t}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",clamp:2,children:i})]})]})})})};var mT=i(94654),mI=i.n(mT);let mN={sectionImage:"sectionImage-cus6zB",imagePlaceholder:"imagePlaceholder-JR9mYR"},mP=e=>{var t;let{pub:i,sectionId:n,size:r=40}=e,o=n?null===(t=i.sections.find(e=>e.id===n))||void 0===t?void 0:t.logo_url:i.logo_url;return o?(0,Z.tZ)("img",{className:mN.sectionImage,style:{width:r,height:r},src:(0,en.zF4)(o,2*r)}):(0,Z.tZ)("div",{className:mN.imagePlaceholder,style:{width:r,height:r}})},mE=e=>{var t,i;let{pub:n,transformPublicationLabel:r,selectedSectionId:o,onChangeSection:a}=e,{iString:l}=(0,Q.M1)(),s=(0,A.sO)(null),[d,c]=(0,A.eJ)(800),u=[{label:r?r({pub:n}):n.name,value:"all-posts"},...n.sections.map(e=>({value:e.id.toString(),label:e.name}))],p=o?o.toString():"all-posts";return(0,A.d4)(()=>{let e=()=>{s.current&&c(s.current.getBoundingClientRect().width)};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}},[]),(0,Z.tZ)("div",{ref:s,children:(0,Z.tZ)(tC.v2,{trigger:(0,Z.BX)(n_.J,{alignItems:"center",border:"detail",display:"flex",hoverBackground:"light",justifyContent:"space-between",paddingY:12,paddingX:16,radius:"sm",children:[(0,Z.BX)(et.gq,{alignItems:"center",gap:16,children:[(0,Z.tZ)(mP,{pub:n,sectionId:o}),(0,Z.tZ)(ei.xv.B2,{weight:"semibold",children:null!==(i=null===(t=u.find(e=>e.value===p))||void 0===t?void 0:t.label)&&void 0!==i?i:l("Select")})]}),(0,Z.tZ)(tw.Z,{color:"var(--color-fg-secondary)"})]}),children:mI()(u,(e,t)=>nT()([(0,Z.tZ)(tC.sN,{onClick:()=>{a({sectionId:"all-posts"===e.value?null:parseInt(e.value)})},children:(0,Z.BX)(et.gq,{gap:16,alignItems:"center",justifyContent:"space-between",style:{width:d-32},children:[(0,Z.BX)(et.gq,{gap:16,alignItems:"center",children:[(0,Z.tZ)(mP,{pub:n,sectionId:"all-posts"===e.value?null:parseInt(e.value)}),(0,Z.tZ)(ei.xv.B2,{weight:"semibold",children:e.label})]}),(0,Z.tZ)(et.gq,{alignItems:"center",paddingRight:8,children:e.value===p&&(0,Z.tZ)(eE.Z,{size:20})})]})}),t!==u.length-1&&(0,Z.tZ)(tX.iz,{})]))})})},mX="modal-yUkdaE",mM="promoImageWrap-gG6qfl",mA="closeButton-dQmWSJ",mD="icon-cn7TS_",mR=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(!1),o=()=>r(!1);return(0,A.d4)(()=>{"true"!==window.sessionStorage.getItem("seenLiveStreamDesktopAnnouncementModal")&&(window.sessionStorage.setItem("seenLiveStreamDesktopAnnouncementModal","true"),N().put("/api/v1/publication_user_settings/user").send({publication_id:t.id,type:"live_stream_announcement_seen",value:!0}).then(()=>{(0,U.j)(U.FP.LIVE_STREAM_DESKTOP_ANNOUNCEMENT_SEEN),r(!0)}))},[]),(0,Z.BX)(eK.u_,{className:k()(mX,"liveStreamAnnouncementModal-UbcJPc"),isOpen:n,onClose:o,children:[(0,Z.BX)(et.tu,{children:[(0,Z.BX)("div",{children:[(0,Z.tZ)("img",{src:(0,uO.zF)("/img/publish/live_stream_announcement_desktop_modal.png",1e3),className:"liveStreamAnnouncementImage-AyU_NQ"}),(0,Z.tZ)(ee.hU,{onClick:o,size:"sm",priority:"secondary",className:mA,rounded:!0,children:(0,Z.tZ)(K.Z,{size:20})})]}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.BX)(et.tu,{gap:2,children:[(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"NOW AVAILABLE"}),(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"Watch live videos on desktop"})]}),(0,Z.tZ)(ei.xv.B3,{translated:!0,color:"secondary",children:"Subscribers can now watch your live videos directly from your publication site on their computers. Filming a live video is still only possible from the app."})]})})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{onClick:o,priority:"primary",size:"md",children:i("Got it")})})]})},mF=e=>{let{setting:t,modalSeenSetting:i,modalSeenStorageKey:n,seenEvent:r,disabledEvent:o,disabledText:a,metaText:l,headerText:s,bodyText:d,learnMoreHref:c}=e,{iString:u}=(0,Q.M1)(),[p,h]=(0,A.eJ)(!1),[m,g]=(0,A.eJ)(!1),v=(0,iN.pm)();(0,A.d4)(()=>{!async function(){(0,U.j)(r),"true"!==window.sessionStorage.getItem(n)&&(window.sessionStorage.setItem(n,"true"),await N().put("/api/v1/publication_settings").send({[i]:!0,[t]:!0}).then(()=>h(!0)))}()},[]);let b=()=>{h(!1)};return(0,Z.BX)(eK.u_,{className:mX,isOpen:p,onClose:b,children:[(0,Z.BX)(et.tu,{children:[(0,Z.BX)("div",{className:k()(mM,"localCurrencyImageWrap-EKm8LR"),children:[(0,Z.tZ)("img",{src:(0,uO.zF)("/img/publish/local_currency_launch_modal.png",1e3)}),(0,Z.tZ)(ee.hU,{onClick:b,size:"sm",priority:"secondary",children:(0,Z.tZ)(K.Z,{size:20})})]}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.BX)(et.tu,{gap:2,children:[(0,Z.tZ)(ei.xv.Meta,{children:l}),(0,Z.tZ)(ei.xv.H2,{color:"primary",children:s})]}),(0,Z.BX)(ei.xv.B3,{color:"primary",children:[d," ",(0,Z.tZ)("a",{target:"_blank",href:c,rel:"noopener",style:{whiteSpace:"nowrap"},children:u("Learn more")}),"."]})]})})]}),(0,Z.tZ)(eK.mz,{showDivider:!1,direction:"row",primaryButton:(0,Z.tZ)(ee.zx,{onClick:b,priority:"primary",children:u("Got it!")}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:async()=>{g(!0),await N().put("/api/v1/publication_settings").send({[t]:!1}),v.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{Icon:eE.Z,text:a}))),(0,U.j)(o),b()},priority:"secondary",disabled:m,children:u("Turn off")})})]})},mL=()=>{let{iString:e}=(0,Q.M1)(),t=(0,Z.BX)(ei.xv.B3,{as:"span",translated:!0,children:["Your prices will now automatically display in local currencies to accommodate international subscribers. When prices are displayed in local currencies,"," ",(0,Z.tZ)(ei.xv.B3,{as:"span",color:"primary",weight:"bold",children:"publications earn up to 10% more revenue"}),"."]});return(0,Z.tZ)(mF,{setting:"use_local_currency",modalSeenSetting:"local_currency_modal_seen",modalSeenStorageKey:"seenLocalCurrencyOptinModal",seenEvent:U.FP.LOCAL_CURRENCY_MODAL_SEEN,disabledEvent:U.FP.LOCAL_CURRENCY_MODAL_TURN_OFF_CLICKED,disabledText:e("You've disabled localized payments"),metaText:e("Now Live"),headerText:e("Localized pricing"),bodyText:t,learnMoreHref:"https://support.substack.com/hc/en-us/articles/16523703337108"})},mz=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(!1);(0,A.d4)(()=>{window.sessionStorage.getItem("seenPaywallUnlockReminderModal")||((0,U.j)(U.FP.PAYWALL_UNLOCK_REMINDER_MODAL_SEEN),window.sessionStorage.setItem("seenPaywallUnlockReminderModal","true"),N().put("/api/v1/publication_settings").send({paywall_unlock_reminder_modal_seen:!0}).then(()=>r(!0)))},[]);let o=()=>{r(!1)};return(0,Z.tZ)(eK.u_,{width:500,isOpen:n,onClose:o,children:(0,Z.BX)(et.tu,{paddingX:8,paddingBottom:4,children:[(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.H2,{translated:!0,children:"Out of beta: Teaser posts"}),(0,Z.tZ)(ee.hU,{onClick:o,children:(0,Z.tZ)(K.Z,{size:20})})]}),(0,Z.BX)(ei.xv.B4,{translated:!0,children:["New in Substack Boost: increase reader engagement with a teaser post. Grant your free subscribers the ability to unlock one paywalled post in the Substack app to see what they're missing."," ",(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us/articles/24345969253524",target:"_blank",rel:"noreferrer",children:"Learn more"})]})]})}),(0,Z.tZ)(eK.mz,{showDivider:!1,direction:"row",primaryButton:(0,Z.tZ)(ee.zx,{onClick:o,priority:"primary",children:i("Sounds good")}),secondaryButton:(0,Z.tZ)(ee.zx,{href:(0,en.wI3)(t,{params:{search:"Substack Boost"}}),priority:"secondary",children:i("Manage boost")})})]})})};var mO=i(62592),mU=i(64455),mY=i(32503),mH=i(87698);let mj=e=>{var{size:t=32,stroke:i="var(--color-fg-primary)",strokeWidth:n=2}=e,r=(0,ef._)(e,["size","stroke","strokeWidth"]);return(0,Z.tZ)(eH.l,(0,_._)((0,f._)({},r),{name:"LucideTabNotes",svgParams:{viewBox:"0 0 32 32"},width:t,height:t,stroke:i,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round",children:(0,Z.tZ)("path",{d:"M23.7656 8.18525L9.00674 4.20446C7.92349 3.91421 6.81004 4.55705 6.51978 5.6403L2.52563 20.5467C2.23537 21.6299 2.87821 22.7433 3.96144 23.0336L8.31304 24.2188M12.9762 13.3831H22.0733M13.4349 18.5815H18.6332M8.31304 10.2158V25.648C8.31304 26.7695 9.22215 27.6786 10.3436 27.6786L25.7761 27.6788C26.8976 27.6788 27.8067 26.7697 27.8067 25.6482V10.2158C27.8067 9.09438 26.8976 8.18525 25.7761 8.18525H10.3436C9.22217 8.18525 8.31304 9.09438 8.31304 10.2158Z","stroke-linecap":"round","stroke-linejoin":"round"})}))};var mJ=i(27893);let mV=e=>{let{origin:t="dashboard",text:i}=e,{iString:n}=(0,Q.M1)(),r=(0,re.aF)(),[o,a]=(0,A.eJ)(!1);if(!(0,Y.WC)()&&!(null==r?void 0:r.is_global_admin))return null;let l=async()=>{a(!0);try{(0,U.j)(U.FP.PUBLISHER_DASHBOARD_POST_BUTTON_CLICKED,{origin:t,type:"live_event"});let e=await N().post("/api/v1/live_stream").send({restricted_participation:!1});window.location.href="".concat(window.location.origin,"/live_event/").concat(e.body.id,"/host")}catch(e){alert("error"),console.error(e)}a(!1)};return(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(mJ.Z,{}),onClick:l,disabled:o,children:null!=i?i:n("New live video (internal)")})};var mq=i(10724),mW=i(1852),mG=i.n(mW),mK=i(65523),mQ=i(92039);let m$="everyone",m0="only_free";var m1=i(68686);let m2={copyInput:"copyInput-eaC7az",titleInput:"titleInput-t1seQa",descriptionInput:"descriptionInput-uQxBCJ",copy:"copy-Vamh7f"};function m4(){let e=(0,G._)(["Set up "," live"]);return m4=function(){return e},e}function m3(){let e=(0,G._)([""," is scheduled"]);return m3=function(){return e},e}function m8(){let e=(0,G._)([""," is now live"]);return m8=function(){return e},e}let m6=e=>{var t;let{pub:i,user:n,isOpen:r,setIsOpen:o}=e,{iString:a,iTemplate:l}=(0,Q.M1)(),s=(0,oo.HD)({pub:i}),d=(0,ss.So)(),[c,u]=(0,A.eJ)(d.getSettingFor("has_used_rtmp_streaming")?"setup":"app-upsell"),[p,h]=(0,A.eJ)(null),[m,g]=(0,A.eJ)(!0),[v,b]=(0,A.eJ)(!0),[y,w]=(0,A.eJ)(m$),[C,x]=(0,A.eJ)(n),[S,B]=(0,A.eJ)(),[T,I]=(0,A.eJ)(!1),[P,E]=(0,A.eJ)(""),[X,M]=(0,A.eJ)(""),[D,R]=(0,A.eJ)(!1),[F,L]=(0,A.eJ)((0,H.Z)().add(2,"hours").toDate()),{popToast:z}=(0,iN.pm)(),[O,U]=(0,A.eJ)(!1),j=(0,sk.wg)({url:(null==S?void 0:S.id)?(0,en.bHR)({liveStreamId:S.id}):null,variant:"menu"});(0,A.d4)(()=>{T&&S&&(g(S.send_email),w(S.audience),L(new Date(S.scheduled_at||"")),E(S.title||""),M(S.description||""),R(!0))},[T,S]);let V=(0,mW.useMediaQuery)({query:"(min-width: 916px)"}),q=(0,my._I)("/api/v1/publication_user",{auto:!0}),W=(0,my._I)("/api/v1/live_streams?status=scheduled&is_rtmp=true",{auto:!0,deps:[c]});(0,A.d4)(()=>{var e,t;(null===(e=W.data)||void 0===e?void 0:e.liveStreams)&&(null===(t=W.data)||void 0===t?void 0:t.liveStreams.length)>0&&"setup"===c&&!r&&u("list")},[W.data]);let G=(0,mQ.rG)();(0,A.d4)(()=>{if(G&&(null==S?void 0:S.id))return null==G?void 0:G.listen({["live-stream:".concat(S.id)]:e=>{var t,i,n;let{data:r}=e;(null==r?void 0:null===(t=r.message)||void 0===t?void 0:t.type)==="live-stream:started"||(null==r?void 0:null===(i=r.message)||void 0===i?void 0:i.type)==="live-stream:viewer-count-updated"&&r.message.current_viewer_count>1?u("live"):(null==r?void 0:null===(n=r.message)||void 0===n?void 0:n.type)==="live-stream:attempted-to-restart"&&h(a("We detected that you tried streaming to Substack with an old stream key. Make sure to update your stream key by copying the one above."))}})},[G,null==S?void 0:S.id]);let K=()=>{o(!1),setTimeout(()=>{var e,t;u("app-upsell"===c?"app-upsell":(null===(e=W.data)||void 0===e?void 0:e.liveStreams)&&(null===(t=W.data)||void 0===t?void 0:t.liveStreams.length)>0?"list":"setup"),I(!1)},500)},$="enabled"!==i.payments_state?[{value:m$,label:a("Everyone"),track:"send_to_everyone"},{value:m0,label:a("Subscribers only")}]:[{value:m$,label:a("Everyone"),track:"send_to_everyone"},{value:m0,label:a("Subscribers only"),track:"send_to_free_only"},{value:"only_paid",label:a("Paid subscribers only"),track:"send_to_paid_only"}],er=q.data?q.data.filter(e=>["admin","contributor"].includes(e.role)).map(e=>e.user):[n];return(0,Z.tZ)(eK.u_,{isOpen:r,onClose:"stream"===c?()=>{}:K,width:V&&"app-upsell"===c?916:void 0,children:(0,Z.tZ)(tU.w,{children:"app-upsell"===c?(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(et.hs,{padding:20,gap:32,children:[V?(0,Z.tZ)("img",{src:"".concat((0,en.ZJn)(),"/img/live/scheduling-hero.jpg"),style:{width:"381px",height:"454px"}}):null,(0,Z.BX)(et.tu,{gap:16,justifyContent:"center",paddingX:32*!!V,children:[(0,Z.BX)(et.tu,{gap:8,justifyContent:"center",children:[(0,Z.tZ)(ei.xv.H1,{fontWeight:"heavy",translated:!0,textAlign:"center",children:"Get the Substack app to start a live video"}),(0,Z.tZ)(ei.xv.B2,{fontSize:17,lineHeight:24,translated:!0,textAlign:"center",children:"Download now on iOS or Android"})]}),(0,Z.tZ)(ts.xu,{paddingX:32*!!(0,Y.K1)(),children:(0,Z.tZ)(ct.AppInstallContent,{utm_source:J.b3.postPublish,hideEmailPrompt:!0,size:171,padding:0})}),(0,Z.tZ)(ei.xv.Meta,{textAlign:"center",color:"secondary",cursor:"pointer",decoration:"underline",onClick:()=>u("setup"),children:a("OR STREAM WITH STREAM KEY")})]})]})}):"list"===c?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{icon:(0,Z.tZ)(mK.AM,{icon:(0,Z.tZ)(mY.Z,{})}),title:a("Go live with stream key"),description:a("Start a scheduled stream or create a new one"),showClose:!0,onClose:K}),(0,Z.tZ)(eK.fe,{children:(0,Z.tZ)(et.tu,{gap:20,children:null===(t=W.data)||void 0===t?void 0:t.liveStreams.map(e=>(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",children:e.liveStream.title}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:(0,H.Z)(e.liveStream.scheduled_at||"").calendar(null,{sameDay:"[Today at] h:mm A",nextDay:"[Tomorrow at] h:mm A",nextWeek:"MMM D [at] h:mm A",lastDay:"[Yesterday at] h:mm A",lastWeek:"MMM D [at] h:mm A",sameElse:"MMM D [at] h:mm A"})})]}),(0,Z.BX)(et.gq,{gap:8,children:[(0,Z.tZ)(ee.zx,{priority:"secondary",size:"sm",onClick:()=>{B(e.liveStream),u("stream")},children:a("View stream key")}),(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{priority:"secondary-outline",size:"sm",children:(0,Z.tZ)(pu.Z,{})}),children:[(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(tI.Z,{}),onClick:()=>{e.liveStream.id&&((0,Y.vQ)((0,en.bHR)({liveStreamId:e.liveStream.id,utm_source:J.b3.postPublish})),z(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:a("Copied")}))))},children:a("Copy link")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(mq.Z,{}),onClick:()=>{B(e.liveStream),I(!0),u("setup")},children:a("Edit")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(iW.Z,{}),priority:"destructive",onClick:async()=>{try{U(!0),await N().put("/api/v1/live_stream/".concat(e.liveStream.id,"/cancel")),await W.mutate(),z(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:a("Stream cancelled")})))}catch(e){z(t=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},t),{text:(0,Y.zx)(e)})))}finally{U(!1)}},disabled:O,children:O?(0,Z.BX)(et.gq,{gap:8,alignItems:"center",children:[(0,Z.tZ)(iI.$j,{size:14}),(0,Z.tZ)(ei.xv.B4,{children:a("Cancelling...")})]}):a("Cancel")})]})]})]},e.liveStream.id))})}),(0,Z.tZ)(eK.mz,{direction:"column",primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{u("setup")},children:a("Create a new stream")})})]}):"setup"===c?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{icon:(0,Z.tZ)(mK.AM,{icon:(0,Z.tZ)(mY.Z,{})}),title:T?a("Edit stream"):a("Go live with stream key"),description:T?void 0:(0,Z.BX)(ei.xv,{children:[a("Generate a stream key to go live on Substack with broadcasting software. You can also go live directly from the Substack app. "),(0,Z.tZ)(ei.hh,{href:"https://support.substack.com/hc/en-us/articles/32070353475860-Live-video-on-Substack-via-RTMP",target:"_blank",rel:"noreferrer",decoration:"underline",children:a("Learn more")})]}),showClose:!1,onClose:K}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:20,children:[(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",translated:!0,children:"Title"}),(0,Z.tZ)(tD.oi,{className:m2.titleInput,type:"text",maxLength:128,value:P,placeholder:a("Enter a title..."),onChange:e=>E(e.currentTarget.value)})]}),s&&(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",translated:!0,children:"Description"}),(0,Z.tZ)(tD.oi,{className:m2.descriptionInput,type:"text",value:X,placeholder:a("Enter a description..."),onChange:e=>M(e.currentTarget.value)})]}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.BX)(et.hs,{justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",translated:!0,children:"Schedule for a future date"}),T?null:(0,Z.tZ)(i2.ZP,{checked:D,onChange:e=>{R(e)},size:"sm"})]}),D&&(0,Z.tZ)(et.tu,{children:(0,Z.tZ)(aT.Tz,{value:F,min:(0,H.Z)().add(2,"hours").toDate(),max:(0,H.Z)().add(92,"days").toDate(),onChange:e=>{L(new Date(e.currentTarget.value))}})})]}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",translated:!0,children:"This video is for..."}),(0,Z.tZ)(ok.g,{name:"audience",options:$,value:y,onChange:e=>{w(e)}})]}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",translated:!0,children:"The person going live is..."}),(0,Z.tZ)(oY.i,{name:"live_stream_user",value:C.id,onChange:e=>{let t=e.target.value,i=er.find(e=>e.id===Number(t));i&&x(i)},children:er.map(e=>{var t,i;return(0,Z.tZ)("option",{value:e.id,children:null!==(i=null!==(t=e.name)&&void 0!==t?t:e.handle&&"@".concat(e.handle))&&void 0!==i?i:e.email})})})]}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",translated:!0,children:"Delivery"}),D&&!T&&(0,Z.BX)(et.hs,{as:"label",gap:8,children:[(0,Z.tZ)(iB.X,{onChange:e=>{b(e)},checked:v,size:"sm"}),(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"Notify my subscribers via email to add this live video to their calendars"})]}),(0,Z.BX)(et.hs,{as:"label",gap:8,children:[(0,Z.tZ)(iB.X,{onChange:e=>{g(e)},checked:m,size:"sm"}),(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"Notify my subscribers via email when my live video starts"})]})]})]})}),(0,Z.tZ)(eK.mz,{direction:"row",alignButtons:"stretch",primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:async()=>{try{var e;let t=T?await N().put("/api/v1/live_stream/".concat(null==S?void 0:S.id,"/schedule")).send({audience:y,description:X,eventName:P,emailSubscribers:m,userId:C.id,scheduledAt:D?F.toISOString():void 0}):await N().post("/api/v1/live_stream/rtmp").send({audience:y,description:X,name:P,send_email:m,user_id:C.id,scheduled_at:D?F.toISOString():void 0,send_email_add_to_calendar:D?v:void 0});(null===(e=t.body)||void 0===e?void 0:e.stream)&&B(t.body.stream),u(D?"scheduled":"stream")}catch(e){alert((0,Y.zx)(e))}},children:T?a("Update stream"):D?a("Schedule stream"):a("Generate stream key")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>K(),children:a("Cancel")})})]}):"stream"===c?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{icon:(0,Z.tZ)(mK.AM,{icon:(0,Z.tZ)(mY.Z,{})}),title:l(m4(),(null==S?void 0:S.title)?'"'.concat(I18N.p(null==S?void 0:S.title),'"'):""),description:(0,Z.BX)(ei.xv,{children:[a("Copy the server URL and stream key into your broadcasting software to go live. "),(0,Z.tZ)(ei.hh,{href:"https://support.substack.com/hc/en-us/articles/32070353475860-Live-video-on-Substack-via-RTMP",target:"_blank",rel:"noreferrer",decoration:"underline",children:a("Learn more")})]}),showClose:!1,onClose:K}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",translated:!0,children:"Server URL"}),(0,Z.BX)(ts.xu,{position:"relative",className:m2.inputContainer,children:[(0,Z.tZ)("input",{className:k()(m2.copyInput,m1.Z.input),type:"text",disabled:!0,maxLength:128,value:"rtmp://global-live.mux.com:5222/app"}),(0,Z.tZ)(ei.xv.B4,{display:"flex",alignItems:"center",paddingX:16,className:m2.copy,borderLeft:"detail",position:"absolute",cursor:"pointer",onClick:()=>{(0,Y.vQ)("rtmp://global-live.mux.com:5222/app"),z(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:a("Copied")})))},children:a("Copy")})]})]}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",translated:!0,children:"Stream key"}),(0,Z.BX)(ts.xu,{position:"relative",className:m2.inputContainer,children:[(0,Z.tZ)("input",{className:k()(m2.copyInput,m1.Z.input),type:"text",disabled:!0,maxLength:128,value:null==S?void 0:S.mux_stream_key}),(0,Z.tZ)(ei.xv.B4,{display:"flex",alignItems:"center",paddingX:16,className:m2.copy,borderLeft:"detail",position:"absolute",cursor:"pointer",onClick:()=>{(0,Y.vQ)(null==S?void 0:S.mux_stream_key),z(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:a("Copied")})))},children:a("Copy")})]})]}),(0,Z.BX)(et.gq,{alignItems:"center",gap:8,children:[(0,Z.tZ)(ei.xv.B3,{translated:!0,children:"Stream is pending until broadcasting software connects"}),(0,Z.tZ)(iI.$j,{})]}),p&&(0,Z.tZ)(ei.xv.B3,{color:"error",children:p})]})}),(0,Z.tZ)(eK.mz,{direction:"column",primaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>K(),children:a("Cancel")})})]}):"scheduled"===c?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{icon:(0,Z.tZ)(mK.AM,{icon:(0,Z.tZ)(mY.Z,{})}),title:l(m3(),(null==S?void 0:S.title)?'"'.concat(I18N.p(null==S?void 0:S.title),'"'):"Your stream"),description:(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(ei.xv,{translated:!0,children:["Next, share you live video everywhere to let people know itâ€™s happening. Review"," ",(0,Z.tZ)(ei.hh,{href:"https://support.substack.com/hc/en-us/articles/32070353475860-Live-video-on-Substack-via-RTMP",target:"_blank",rel:"noreferrer",decoration:"underline",children:"this support article"})," ","if you have any questions about streaming with a stream key."]})}),showClose:!1,onClose:K}),(0,Z.tZ)(eK.fe,{children:(0,Z.tZ)(et.tu,{gap:16,children:(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",translated:!0,children:"Link to stream"}),(0,Z.tZ)(ls.H,{disabled:!0,value:s?(0,en.thY)({pub:i}):(null==S?void 0:S.id)&&(0,en.bHR)({liveStreamId:S.id}),placement:"end",priority:"secondary-outline",button:(0,Z.tZ)(ee.zx,{onClick:()=>{s?((0,Y.vQ)((0,en.thY)({pub:i,utm_source:J.b3.postPublish})),z(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:a("Copied")})))):(null==S?void 0:S.id)?((0,Y.vQ)((0,en.bHR)({liveStreamId:S.id,utm_source:J.b3.postPublish})),z(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:a("Copied")})))):z(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:a("Something went wrong")})))},children:a("Copy")})})]})})}),(0,Z.tZ)(eK.mz,{direction:"column",primaryButton:(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(ee.zx,{priority:"primary",children:a("Share now")}),children:j}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>K(),children:a("Close")})})]}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{icon:(0,Z.tZ)(mK.AM,{icon:(0,Z.tZ)(mY.Z,{})}),title:l(m8(),(null==S?void 0:S.title)?'"'.concat(I18N.p(null==S?void 0:S.title),'"'):"Your stream"),showClose:!1,onClose:K}),(0,Z.tZ)(eK.fe,{children:(0,Z.tZ)(et.tu,{gap:16,children:(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",translated:!0,children:"Link to stream"}),(0,Z.BX)(ts.xu,{position:"relative",className:m2.inputContainer,children:[(0,Z.tZ)("input",{className:k()(m2.copyInput,m1.Z.input),type:"text",disabled:!0,maxLength:128,value:s?(0,en.thY)({pub:i}):(null==S?void 0:S.id)&&(0,en.bHR)({liveStreamId:S.id})}),(0,Z.tZ)(ei.xv.B4,{display:"flex",alignItems:"center",paddingX:16,className:m2.copy,borderLeft:"detail",position:"absolute",cursor:"pointer",onClick:()=>{s?(0,Y.vQ)((0,en.thY)({pub:i,utm_source:J.b3.postPublish})):(null==S?void 0:S.id)?((0,Y.vQ)((0,en.bHR)({liveStreamId:S.id,utm_source:J.b3.postPublish})),z(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:a("Copied")})))):z(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:a("Something went wrong")})))},children:a("Copy")})]})]})})}),(0,Z.tZ)(eK.mz,{direction:"column",primaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>K(),children:a("Close")})})]})})})};var m5=i(36515);let m9=e=>{var t,i;let{pub:n,user:r,referrer:o,origin:a,isEligibleForLiveStreamCreation:l}=e,{iString:s}=(0,Q.M1)(),d=(0,co.aF)({podcasts:(0,co.EP)(n),isSection:!(null==n?void 0:n.podcast_enabled)}),c=(0,rU.i3)(),[u,p]=(0,A.eJ)(!1);return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.zx,{priority:"primary",trailing:(0,Z.tZ)(tw.Z,{color:"var(--color-button-fg)"}),children:s("New post")}),title:"New post",children:[(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(hR.Z,{"data-testid":"publish-page-new-post"}),href:(0,j.qYj)(n,{type:"newsletter",back:o}),onClick:()=>{(0,U.j)(U.FP.PUBLISHER_DASHBOARD_POST_BUTTON_CLICKED,{origin:a,type:"post"})},children:s("Text post")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(mO.Z,{}),href:(0,j.qYj)(n,{type:"podcast",back:o,section:null!==(t=null==d?void 0:d.sectionId)&&void 0!==t?t:"pub",mediaType:"video"}),onClick:()=>{(0,U.j)(U.FP.PUBLISHER_DASHBOARD_POST_BUTTON_CLICKED,{origin:a,type:"video"})},children:s("Video post")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(mU.Z,{}),href:(0,j.qYj)(n,{type:"podcast",back:o,section:null!==(i=null==d?void 0:d.sectionId)&&void 0!==i?i:"pub",mediaType:"audio"}),onClick:()=>{(0,U.j)(U.FP.PUBLISHER_DASHBOARD_POST_BUTTON_CLICKED,{origin:a,type:"audio"})},children:s("Audio post")}),(0,Z.BX)(tC.xw,{children:[(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(mj,{strokeWidth:2.5}),onClick:()=>{(0,U.j)(U.FP.PUBLISHER_DASHBOARD_POST_BUTTON_CLICKED,{origin:a,type:"note"}),c.open({})},children:s("New note")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(mH.Z,{strokeWidth:2.5}),href:n.threads_v2_enabled?(0,sm.aD)(n.id):(0,m5.r)(n),children:s("New chat thread")}),r&&l?(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(mY.Z,{}),onClick:()=>{p(!0)},children:s("New live video")}):null]}),((null==r?void 0:r.is_global_admin)||(0,Y.WC)())&&(0,Z.tZ)(tC.xw,{children:(0,Z.tZ)(mV,{origin:a})})]}),r?(0,Z.tZ)(m6,{isOpen:u,setIsOpen:p,pub:n,user:r}):null]})};var m7=i(894),ge=i(76204);let gt=e=>{let{variant:t,pub:i}=e,[n,r]=(0,A.eJ)(!1),[o,a]=(0,A.eJ)(!1),{iString:l}=(0,Q.M1)(),s=(0,en.n1t)("/publish/settings/edit",{title:l(i.draft_plans?"Welcome email to paid subscribers":"Welcome email"),bodyField:"welcome_email_content",titleField:"welcome_email_subject",titlePlaceholder:l("Email subject..."),redirect:"undefined"!=typeof document?document.location.href:""});(0,A.d4)(()=>{window.sessionStorage.getItem("seenReaderSurveysModal")||(window.sessionStorage.setItem("seenReaderSurveysModal","true"),(0,U.j)(U.FP.READER_SURVEY_ONBOARDING_MODAL_SEEN,{variant:t}),N().put("/api/v1/publication_settings").send({surveys_onboarding_modal_seen:!0}).then(()=>r(!0)))},[]);let d=async()=>{a(!0),r(!1)};return(0,Z.tZ)(eK.u_,{width:500,isOpen:n,onClose:d,className:"modal-SIbt7K",children:(0,Z.BX)(et.tu,{children:[(0,Z.BX)("div",{className:"promoImageWrap-lQzlEr",children:[(0,Z.tZ)("img",{src:(0,en.zF4)("/img/publish/surveys_launch_modal.png",1e3)}),(0,Z.tZ)(ee.hU,{onClick:d,className:"closeButton-cjiYzm",priority:"secondary",size:"sm",children:(0,Z.tZ)(eJ.Z,{})})]}),(0,Z.BX)(et.tu,{paddingX:8,paddingBottom:4,children:[(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"Introducing"}),(0,Z.tZ)(ei.xv.H2,{translated:!0,children:"Reader Surveys"})]}),(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.tZ)(m7.Z,{size:18}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",translated:!0,children:"Ask your readers questions right on Substack"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Easily create and embed surveys directly into the editor"})]})]}),(0,Z.BX)(et.gq,{gap:16,paddingBottom:16,children:[(0,Z.tZ)(ge.Z,{size:22}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.B4,{weight:"bold",translated:!0,children:"Easily track subscriber responses"}),(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"Monitor responses in your Substack dashboard and get direct insight from your subscribers"})]})]}),(0,Z.BX)(et.tu,{textAlign:"center",gap:6,paddingY:20,borderTop:"detail",borderBottom:"detail",alignItems:"center",paddingX:20,children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",children:l("welcome_content"===t?"Add a survey to your welcome email!":"Weâ€™ve added a survey in your welcome email.")}),(0,Z.tZ)(ei.xv.B5,{color:"secondary",children:l("Get information about your subscribers including how they found out about you, their age, what they read and more.")})]})]})}),(0,Z.tZ)(eK.mz,{direction:"column",primaryButton:(0,Z.tZ)(ee.zx,{disabled:o,onClick:async()=>{a(!0),await (0,U.j)(U.FP.READER_SURVEY_ONBOARDING_MODAL_SUBMITTED,{cta:"primary",variant:t}),"welcome_content"===t&&(window.location.href=s),r(!1)},priority:"primary",children:l("welcome_content"===t?"Edit welcome email":"Got it")}),secondaryButton:(0,Z.tZ)(ee.zx,{disabled:o,onClick:async()=>{a(!0),await (0,U.j)(U.FP.READER_SURVEY_ONBOARDING_MODAL_SUBMITTED,{cta:"secondary",variant:t}),window.location.href="/publish/stats/reader-surveys"},priority:"secondary",children:l("Visit survey dashboard")})})]})]})})};var gi=i(88873),gn=i(96220);let gr=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(!1),[o,a]=(0,A.eJ)(!1);(0,A.d4)(()=>{"true"!==window.sessionStorage.getItem("seenSubscriberReferralsOptinModal")&&(window.sessionStorage.setItem("seenSubscriberReferralsOptinModal","true"),(0,U.j)(U.FP.SUBSCRIBER_REFERRALS_SETUP_MODAL_SHOWN,{payments_enabled:"enabled"===t.payments_state}),N().put("/api/v1/publication_settings").send({subscriber_referrals_setup_modal_seen:!0}).then(()=>r(!0)))},[]);let l=async()=>{a(!0),(0,U.j)(U.FP.SUBSCRIBER_REFERRALS_SETUP_MODAL_SUBMITTED),"enabled"===t.payments_state&&await N().put("/api/v1/reader_referrals").send({enabled:!0}),window.location.href="/publish/settings/reader_referrals"},s=()=>{r(!1)},d=i("enabled"===t.payments_state?"Turn on":"Set up rewards");return(0,Z.BX)(eK.u_,{className:mX,isOpen:n,onClose:s,children:[(0,Z.BX)(et.tu,{children:[(0,Z.BX)("div",{className:mM,children:[(0,Z.tZ)("img",{src:(0,en.zF4)("/img/publish/referrals_launch_modal.png")}),(0,Z.tZ)(ee.hU,{onClick:s,className:mA,priority:"secondary",children:(0,Z.tZ)(eJ.Z,{})})]}),(0,Z.BX)(et.tu,{gap:20,children:[(0,Z.BX)(et.tu,{gap:12,paddingTop:24,paddingX:24,children:[(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"Introducing"}),(0,Z.tZ)(ei.xv.H2,{color:"primary",translated:!0,children:"Subscriber referrals"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"A simple new way to grow your audience. Reward subscribers for spreading the word about your Substack."})]}),(0,Z.tZ)(tX.iz,{}),(0,Z.BX)(et.tu,{gap:24,paddingBottom:24,paddingX:24,children:[(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.tZ)(m7.Z,{size:36}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{color:"primary",weight:"semibold",translated:!0,children:"Grow your audience"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Existing subscribers are the best marketers for your work. Empower them to share it."})]})]}),(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.tZ)(gi.Z,{size:36}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{color:"primary",weight:"semibold",translated:!0,children:"Easy to manage"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Set it and forget it. Rewards are sent out automatically when subscribers hit milestones."})]})]}),(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.tZ)(gn.Z,{size:36}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{color:"primary",weight:"semibold",translated:!0,children:"Customizable rewards"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Youâ€™re in control. Choose the rewards and tiers that will motivate your subscribers."})]})]})]})]})]}),(0,Z.tZ)(eK.mz,{showDivider:!1,direction:"row",primaryButton:(0,Z.tZ)(ee.zx,{disabled:o,onClick:l,priority:"primary",children:d}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:()=>{(0,U.j)(U.FP.SUBSCRIBER_REFERRALS_SETUP_MODAL_NOT_NOW),s()},priority:"secondary",disabled:o,children:i("Not now")})})]})};function go(){let e=(0,G._)([""," (all posts)"]);return go=function(){return e},e}let ga=eb(e=>{var t;let{pub:i,user:n,themeVariables:r,showSubscriberReferralsSetupOptIn:o,showChatReaderParticipationBox:a=!1,showSubscriberReferralsBox:l=!1,showPubIntroTextBox:s=!1,showGAMigrationModal:d,surveysOnboardingModalVariant:c,showLocalCurrencyModal:u,showPaywallUnlockReminderModal:p,showPledgeTurnOnPaidBox:h,estimatedArr:m,estimatedArrCurrency:g,shouldShowSurveyAnnouncement:v,overrideSurveyAnnouncementDismissKey:b,customNewPubExperience:y,showPhoneNumberExposedBanner:w,mfaActionBoxEnabled:C,showGiftsFromSubstackOptIn:x,showLiveStreamDesktopAnnouncement:S,isEligibleForLiveStreamCreation:k}=e,{iString:B,iTemplate:T}=(0,Q.M1)(),[I,P]=(0,A.eJ)(null),{draftsResource:E,publishedResource:X,scheduledResource:M}=h7({selectedSectionId:I}),D=X.refetch;X.refetch=()=>(E.refetch(),D());let R=(0,iS.ib)({pathname:"/api/v1/post_management/counts",auto:!0}),[F,L]=(0,A.eJ)(!0),[z,O]=(0,A.eJ)(!0),[H,J]=(0,A.eJ)(""),[V,q]=(0,A.eJ)(null),W=(0,iN.pm)(),G="undefined"!=typeof window?window.location.pathname:"",K=!!(null==n?void 0:n.is_admin),$="streaks-optin"===new URL(document.location.toString()).searchParams.get("action"),ei=1;return V&&(V.totalEmail>=1e3||V.subscribers>=50)?ei=3:V&&V.totalEmail>=100&&(ei=2),V&&V.isBestseller&&(ei=4),(0,A.d4)(()=>{(0,U.j)(U.FP.PUBLISHER_DASHBOARD_SEEN),(0,Y.iO)("showBestsellerSurvey")},[]),(0,A.d4)(()=>{let e=async()=>{let e=await N().get("/api/v1/publish-dashboard/summary");eC()(e.body,V)||q(e.body)};try{L(!0),e().finally(()=>L(!1))}catch(e){J((0,Y.zx)(e))}let t=setInterval(()=>{try{if(F)return;e(),E.refetch(),X.refetch(),M.refetch()}catch(e){J((0,Y.zx)(e))}},3e5);return()=>clearInterval(t)},[]),(0,A.d4)(()=>{$&&W.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{Icon:eE.Z,text:B("You're in! You'll get your first reminder later this week.")})))},[]),(0,Z.tZ)(tU.w,{children:(0,Z.BX)(dt,{children:[x?(0,Z.tZ)(uU,{pub:i}):S?(0,Z.tZ)(mR,{pub:i}):o?(0,Z.tZ)(gr,{pub:i}):d?(0,Z.tZ)(uz,{pub:i}):u?(0,Z.tZ)(mL,{}):c?(0,Z.tZ)(gt,{variant:c,pub:i}):p?(0,Z.tZ)(mz,{pub:i}):null,(0,Z.tZ)(di,{title:B("Home"),cta:(0,Z.BX)(et.gq,{gap:12,children:[(0,Z.tZ)(ee.zx,{priority:"secondary",newTab:!0,href:"".concat((0,j.TJI)(i)),onClick:()=>{(0,U.j)(U.FP.PUBLISHER_DASHBOARD_VISIT_SITE_CLICKED)},children:"profile"===i.homepage_type?B("View profile"):B("View site")}),(0,Z.tZ)(m9,{user:n,pub:i,referrer:G,origin:"dashboard",isEligibleForLiveStreamCreation:k})]})}),(0,Z.tZ)(uL,{pub:i,user:n,postCount:(null===(t=R.result)||void 0===t?void 0:t.published)||0,showLaunchChecklist:z,embedded:!0,hideLaunchChecklist:()=>O(!1),showChatReaderParticipationBox:a,showSubscriberReferralsBox:l,showPubIntroTextBox:s,showPledgeTurnOnPaidBox:h,estimatedArr:m,estimatedArrCurrency:g,shouldShowSurveyAnnouncement:v,overrideSurveyAnnouncementDismissKey:!!b,customNewPubExperience:y,showPhoneNumberExposedBanner:w,mfaActionBoxEnabled:C}),i.sections.length>0&&(0,Z.tZ)(eW.SiteConfigGate,{configKey:"publisher_dashboard_section_selector",children:(0,Z.tZ)(mE,{pub:i,transformPublicationLabel:e=>{let{pub:t}=e;return T(go(),t.name)},selectedSectionId:I,onChangeSection:e=>{let{sectionId:t}=e;P(t)}})}),(0,Z.BX)(et.sg,{gap:32,children:[K&&!I&&(0,Z.tZ)(md,{pub:i,stats:V,loading:F,error:H}),(X.hasLoadedOnce||!X.isLoading)&&(0,Z.BX)(et.hs,{direction:{desktop:"row",mobile:"column"},gap:{mobile:40,desktop:32},children:[(0,Z.tZ)(mn,{pub:i,postsResource:X}),(0,Z.tZ)(h1,{draftsResource:E,scheduledResource:M,pub:i})]}),(0,Z.tZ)(mS,{postsResource:X,countsResource:R,pub:i}),(0,Z.tZ)(h9,{pub:i}),(0,Z.tZ)(mx,{pub:i,themeVariables:r}),!F&&(0,Z.tZ)(mk,{resourceTier:ei})]})]})})}),gl=e=>(0,Z.BX)(eH.l,(0,_._)((0,f._)({stroke:"#666666"},e),{name:"LeftArrowIcon",svgParams:{height:20,width:20},children:[(0,Z.tZ)("path",{d:"M9.99996 4.16675L4.16663 10.0001L9.99996 15.8334","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M15.8333 10L4.16663 10","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})]})),gs=()=>null,gd=e=>{var t,i,{variant:n="default",isSearchable:r=!1,className:o}=e,a=(0,ef._)(e,["variant","isSearchable","className"]);let{pub:l}=ey();return(0,Z.tZ)(rG.ZP,(0,_._)((0,f._)({},a),{isDisabled:a.isDisabled,className:k()("themed-select",o),components:(0,f._)({IndicatorSeparator:gs},a.components),theme:(0,Y._I)({primary:(null===(t=l.theme)||void 0===t?void 0:t.background_pop_color)||l.theme_var_background_pop||"#1a1a1a",neutral0:"light"===n?"white":null===(i=l.theme)||void 0===i?void 0:i.web_bg_color}),isSearchable:r,styles:(0,f._)({container:e=>(0,_._)((0,f._)({},e),{flex:1}),dropdownIndicator:e=>(0,_._)((0,f._)({},e),{color:"#1a1a1a"})},a.showOnlyIndicator&&{valueContainer:e=>(0,_._)((0,f._)({},e),{width:0,padding:0})},a.styles)}))},gc=e=>{let{title:t,subtitle:i,linked:n,controls:r}=e;return(0,Z.BX)("div",{"data-testid":"data-header",className:"data-header",children:[(0,Z.BX)("div",{className:k()("data-header-masthead",{"has-controls":r,"is-empty":!t&&!i}),children:[t&&(0,Z.tZ)("h3",{children:t}),i&&(n?(0,Z.BX)("h5",{className:"data-header-subtitle-elem",children:[i," ",(0,Z.tZ)("a",{href:n.link,children:n.message})]}):(0,Z.tZ)("h5",{className:"data-header-subtitle-elem",children:i}))]}),r&&(0,Z.tZ)("div",{className:"data-header-controls",children:r})]})};var gu=i(49949);class gp extends w.Component{componentDidMount(){this.props.setEmpty()}render(){return(0,Z.BX)("div",{className:"no-blurbs",children:[(0,Z.tZ)("h3",{children:this.context.iString("You don't have any blurbs yet")}),(0,Z.tZ)("p",{children:this.context.iString("No one wrote a blurb about your publication yet. One way to get good blurbs is to write good blurbs for other Substack publications.")}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,Y.uX)("/publish/recommendations")},children:this.context.iString("Recommend")})]})}}(0,M._)(gp,"contextType",Q.wj);class gh extends w.Component{componentDidMount(){let e=this.props.matches.add_from;if(e)try{N().put("/api/v1/recommendations/blurb/active").send({recommending_publication_id:e,active:!0}).then(()=>{this.setState({[e]:!0})})}catch(e){alert((0,Y.zx)(e))}}render(e,t){let{}=e,{empty:i}=t,n=[{key:"publication_id",name:this.context.iString("Source"),sortable:!1,valueFn:e=>(0,Z.BX)("div",{className:"side-by-side-content",children:[(0,Z.tZ)(sC.wk,{className:"icon",pub:e.source_pub,size:24,logoUrl:e.source_pub.logo_url}),(0,Z.tZ)("a",{href:(0,j.SVA)(e.source_pub),children:e.source_pub.name})]}),compact:!0},{key:"blurb",name:this.context.iString("Blurb"),sortable:!1,valueFn:e=>(0,Z.tZ)("p",{children:e.blurb}),compact:!0},{key:"blurb",name:"",sortable:!1,valueFn:e=>(0,Z.tZ)(ee.zx,{priority:this._getRowState(e)?"secondary":"primary",onClick:async()=>{let t=this._getRowState(e);try{await N().put("/api/v1/recommendations/blurb/active").send({recommending_publication_id:e.publication_id,active:!t}),this.setState({[e.publication_id]:!t})}catch(e){alert((0,Y.zx)(e))}},children:this._getRowState(e)?this.context.iString("Remove Blurb"):this.context.iString("Add Blurb")}),compact:!0}];return(0,Z.tZ)("div",{id:"edit-blurbs-page",onDragOver:this.onDragOver,children:(0,Z.BX)("div",{className:"container",children:[(0,Z.tZ)("a",{className:"back-button",href:"/publish/settings/",children:(0,Z.tZ)(gl,{size:40})}),!i&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(et.tu,{paddingTop:24,paddingBottom:16,children:(0,Z.tZ)(ei.xv.H1,{translated:!0,children:"Welcome page blurbs"})}),(0,Z.BX)(ei.xv.B3,{color:"secondary",translated:!0,children:["Add up to 3 blurbs written by other Substack writers to your welcome page."," ",(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us/articles/7889090558996",children:"Learn more."})]})]}),(0,Z.BX)(gu.Z,{children:[(0,Z.tZ)(gc,{title:i?"":this.context.iString("Blurbs written about your Substack")}),(0,Z.tZ)(ps,{url:"/api/v1/recommendations/stats/to?only_with_blurbs=true",pageSize:10,appendMode:!1,cols:n,empty:(0,Z.tZ)(gp,{setEmpty:this._setEmpty})})]})]})})}constructor(){super(),(0,M._)(this,"_getRowState",e=>void 0===this.state[e.publication_id]?e.blurb_active:this.state[e.publication_id]),(0,M._)(this,"_setEmpty",()=>{this.setState({empty:!0})}),this.state={empty:!1}}}(0,M._)(gh,"contextType",Q.wj);var gm=i(45578),gg=i.n(gm);let gv=e=>(0,Z.BX)(eH.l,(0,_._)((0,f._)({},e),{name:"DoubleHamburgerIcon",svgParams:{height:15,width:9,stroke:"none"},children:[(0,Z.tZ)("rect",{width:"3",height:"3",rx:"1.5",fill:"#666666"}),(0,Z.tZ)("rect",{x:"6",width:"3",height:"3",rx:"1.5",fill:"#666666"}),(0,Z.tZ)("rect",{y:"6",width:"3",height:"3",rx:"1.5",fill:"#666666"}),(0,Z.tZ)("rect",{x:"6",y:"6",width:"3",height:"3",rx:"1.5",fill:"#666666"}),(0,Z.tZ)("rect",{y:"12",width:"3",height:"3",rx:"1.5",fill:"#666666"}),(0,Z.tZ)("rect",{x:"6",y:"12",width:"3",height:"3",rx:"1.5",fill:"#666666"})]}));var gb=i(90406);function gy(){let e=(0,G._)(["Create: ",""]);return gy=function(){return e},e}function gf(){let e=(0,G._)(["Create: ",""]);return gf=function(){return e},e}class g_ extends w.Component{componentDidMount(){this.trPlaceholder=document.createElement("tr"),this.trPlaceholder.className="placeholder";for(let e=0;e<5;e++)this.trPlaceholder.appendChild(document.createElement("td")).appendChild(document.createTextNode("\xa0"));this.fetchLinks()}componentWillUnmount(){var e;null===(e=this.trPlaceholder)||void 0===e||e.remove()}openAddLinkModal(){var e,t,i,n;null===(t=this.addLinkForm)||void 0===t||null===(e=t.current)||void 0===e||e.clear(),null===(n=this.addLinkModal)||void 0===n||null===(i=n.current)||void 0===i||i.open()}render(e,t){let{pub:i}=e,{homepageLinks:n,loading:r,newGroup:o,inputGroup:a,loadingId:l}=t;return i&&(0,Z.BX)("div",{id:"homepage-links-page",onDragOver:this.onDragOver,children:[(0,Z.BX)("div",{className:"container",children:[(0,Z.tZ)("h2",{className:"settings-section-header",children:this.context.iString("Homepage links")}),(0,Z.BX)(ei.xv.B4,{translated:!0,children:["These links show up on ",(0,Z.BX)("a",{href:"/",children:[I18N.p(i.name),"'s homepage"]}),". Each link is displayed under its group, for example ",(0,Z.tZ)("b",{children:"blogroll"})," or ",(0,Z.tZ)("b",{children:"community"}),". A group's links will follow the order in the table. Reorder links by clicking and dragging."]}),(0,Z.BX)("table",{id:"homepage-link-table",onMouseMove:()=>{this.draggedRow&&(""===this.draggedRow.className||"loading"===this.draggedRow.className)&&(this.draggedRow.parentNode.className="")},children:[(0,Z.BX)("tr",{className:"header-row",children:[(0,Z.tZ)("td",{className:"title",children:this.context.iString("Title")}),(0,Z.tZ)("td",{className:"subtitle",children:this.context.iString("Subtitle")}),(0,Z.tZ)("td",{className:"group",children:this.context.iString("Group")}),(0,Z.tZ)("td",{className:"url",children:this.context.iString("URL")}),(0,Z.tZ)("td",{className:"del"})]}),r&&!l?(0,Z.tZ)(gw,{homepageLinks:n}):n.length?n.map((e,t)=>(0,Z.BX)("tr",{"data-index":t,"data-rank":e.rank,onDragStart:this.onDragStart,onDragEnd:this.createOnDragEnd(e,t),draggable:!0,className:k()(l===e.id&&"loading"),children:[(0,Z.BX)("td",{className:"title",children:[(0,Z.tZ)(gv,{}),(0,Z.tZ)("p",{children:e.title})]}),(0,Z.tZ)("td",{className:"subtitle",children:(0,Z.tZ)("p",{children:e.subtitle})}),(0,Z.tZ)("td",{className:"group",children:(0,Z.tZ)("p",{children:e.group})}),(0,Z.tZ)("td",{className:"url",children:(0,Z.tZ)("a",{href:e.url,rel:"noopener",target:"_blank",children:e.url.replace(/^https?:\/\//,"")})}),(0,Z.tZ)("td",{className:"del",children:(0,Z.tZ)(eJ.Z,{onClick:()=>this.deleteLink(e.id),width:10,height:10})})]},e.id)):(0,Z.tZ)("tr",{className:"no-links",children:(0,Z.tZ)("td",{colSpan:5,children:this.context.iString("No links yet")})})]}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>this.openAddLinkModal(),loading:r,children:this.context.iString("Add Link")})]}),(0,Z.tZ)(L.p,{ref:this.addLinkModal,children:(0,Z.tZ)(tP.ZP,{ref:this.addLinkForm,action:"/api/v1/homepage_links",autoLock:!0,onSuccess:()=>{var e,t;null===(t=this.addLinkModal)||void 0===t||null===(e=t.current)||void 0===e||e.close(),this.fetchLinks()},children:(0,Z.BX)("div",{className:"add-new",children:[(0,Z.tZ)("h3",{children:this.context.iString("Add Link")}),(0,Z.BX)("div",{children:[(0,Z.tZ)("p",{children:(0,Z.BX)("label",{children:[this.context.iString("Title"),(0,Z.tZ)("input",{required:!0,name:"title",type:"text"})]})}),(0,Z.tZ)("p",{children:(0,Z.BX)("label",{children:[this.context.iString("Subtitle (optional)"),(0,Z.tZ)("input",{name:"subtitle",type:"text"})]})}),(0,Z.BX)("p",{className:"group-link",children:[(0,Z.BX)("label",{onClick:e=>{e.stopPropagation()},children:[this.context.iString("Group"),(0,Z.tZ)(og.ZP,{options:gg()(n.map(e=>({label:e.group,value:e.group})),"value"),className:"group-select",classNamePrefix:"group-select",isClearable:!0,components:{DropdownIndicator:null},theme:(0,Y._I)({primary:i.theme_var_background_pop||gb.Hu}),placeholder:"",styles:{input:e=>(0,f._)({},e)},noOptionsMessage:()=>o?this.context.iTemplate(gy(),o):this.context.iString("Type to create"),formatCreateLabel:e=>this.context.iTemplate(gf(),e),value:o&&{label:o},onChange:e=>this.setState({newGroup:(null==e?void 0:e.value)||""}),inputId:"group-select-input",inputValue:a,onInputChange:(e,t)=>{a&&"menu-close"===t.action&&this.setState({newGroup:a}),this.setState({inputGroup:e})}}),(0,Z.tZ)("input",{requried:!0,type:"hidden",name:"group",value:o||""})]}),(0,Z.BX)("label",{children:[this.context.iString("Link"),(0,Z.tZ)("input",{required:!0,name:"url",type:"url"})]})]})]}),(0,Z.BX)("div",{children:[(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",children:this.context.iString("Add Link")}),(0,Z.tZ)("div",{id:"error-container"})]})]})})})]})}constructor(e,t){super(e,t),(0,M._)(this,"addLinkModal",void 0),(0,M._)(this,"addLinkForm",void 0),(0,M._)(this,"draggedRow",void 0),(0,M._)(this,"trPlaceholder",void 0),(0,M._)(this,"fetchLinks",e=>(this.setState({loading:!0}),N().get("/api/v1/homepage_links").then(t=>{this.setState({homepageLinks:t.body.sort((e,t)=>e.rank-t.rank),loading:!1},e)}).catch(t=>{alert((0,Y.zx)(t),this.context.iString("There was a network issue. Try again in a bit")),this.setState({loading:!1},e)}))),(0,M._)(this,"rankLink",async(e,t)=>{this.setState({loading:!0,loadingId:e});try{await N().put("/api/v1/homepage_links/".concat(e,"/rank")).send({rank:t})}catch(e){alert((0,Y.zx)(e),this.context.iString("There was a network issue while sorting your link. Try again in a bit")),this.setState({loading:!1,loadingId:null});return}await this.fetchLinks(()=>this.setState({loadingId:null}))}),(0,M._)(this,"deleteLink",async e=>{this.setState({loadingId:e});try{await N().del("/api/v1/homepage_links/".concat(e))}catch(e){alert((0,Y.zx)(e),this.context.iString("There was a network issue while deleting your link. Try again in a bit")),this.setState({loading:!1,loadingId:null});return}await this.fetchLinks(()=>this.setState({loadingId:null}))}),(0,M._)(this,"onDragOver",e=>{if(this.state.loading)return;let t=e.target;for(;t&&"TR"!==t.tagName&&t!==document.body;)t=t.parentNode;if(this.draggedRow){if(this.draggedRow.style.display="none",t===this.draggedRow&&this.draggedRow.parentNode&&this.trPlaceholder){this.draggedRow.parentNode.insertBefore(this.trPlaceholder,this.draggedRow);return}if((null==t?void 0:t.className)==="placeholder"){e.preventDefault();return}if(!(null==t?void 0:t.dataset.rank)&&this.draggedRow.parentNode){let e=this.draggedRow.parentNode.querySelectorAll("tr:not(.header-row):not(.dragged):not(.placeholder)");if(Number(this.draggedRow.dataset.index)===e.length&&this.trPlaceholder){let t=e[e.length-1];if(!t)return;this.draggedRow.parentNode.insertBefore(this.trPlaceholder,t),this.draggedRow.parentNode.insertBefore(t,this.trPlaceholder)}else if(this.trPlaceholder){var i;let t=e[null!==(i=this.draggedRow.dataset.index)&&void 0!==i?i:"undefined"];if(!t)return;this.draggedRow.parentNode.insertBefore(this.trPlaceholder,t)}return}e.preventDefault(),gZ(t,this.trPlaceholder)&&t&&t.parentNode&&this.trPlaceholder?t.parentNode.insertBefore(this.trPlaceholder,t):t&&t.parentNode&&this.trPlaceholder&&(t.parentNode.insertBefore(this.trPlaceholder,t),t.parentNode.insertBefore(t,this.trPlaceholder))}}),(0,M._)(this,"onDragStart",e=>{if(!this.state.loading)this.draggedRow=e.currentTarget,this.draggedRow&&(this.draggedRow.className="dragged",this.draggedRow.parentNode.className="dragging",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.draggedRow))}),(0,M._)(this,"createOnDragEnd",(e,t)=>i=>{var n,r,o,a;if(!this.draggedRow)return;let l=this.draggedRow.parentNode,{left:s,right:d,top:c,bottom:u}=l.getBoundingClientRect();if(s<=i.clientX&&i.clientX<=d&&c<=i.clientY&&i.clientY<=u){let i=l.querySelectorAll("tr:not(.header-row):not(.dragged)"),a=[].indexOf.call(i,this.trPlaceholder),s=null!==(r=null===(n=this.state.homepageLinks[a])||void 0===n?void 0:n.rank)&&void 0!==r?r:0;if(e.rank!==s){let i=this.state.homepageLinks.splice(t,1)[0];this.state.homepageLinks.splice(a,0,i),this.setState({homepageLinks:[...this.state.homepageLinks]}),this.rankLink(e.id,(null!==(o=e.rank)&&void 0!==o?o:0<s)?s+1:s)}}this.trPlaceholder&&(null===(a=this.draggedRow.parentNode)||void 0===a||a.removeChild(this.trPlaceholder)),this.draggedRow.style.display="",this.draggedRow.className=""}),this.state={homepageLinks:[],loading:!0,newGroup:"",inputGroup:"",loadingId:null},this.addLinkModal=(0,w.createRef)(),this.addLinkForm=(0,w.createRef)()}}(0,M._)(g_,"contextType",Q.wj);let gZ=function(e,t){let i=e.getBoundingClientRect(),n=t.getBoundingClientRect();return i.top+i.height/2<n.top+n.height/2},gw=e=>{let{homepageLinks:t}=e;return(0,Z.tZ)(w.Fragment,{children:((null==t?void 0:t.length)?t:[void 0,void 0,void 0,void 0,void 0]).map(()=>(0,Z.tZ)("tr",{className:"loading",children:[void 0,void 0,void 0,void 0,void 0].map(()=>(0,Z.tZ)("td",{children:(0,Z.tZ)("p",{children:"\xa0"})}))}))})},gC=e=>{var t;let{pub:i,tellApple:n,previousHost:r,sectionId:o}=e,{iString:a}=(0,Q.M1)(),[l,s]=(0,A.eJ)(!1),[d,c]=(0,A.eJ)(void 0),[u,p]=(0,A.eJ)(n||r),[h,m]=(0,A.eJ)(!1),[g,v]=(0,A.eJ)(!1),[b,y]=(0,A.eJ)(r);i=(0,_._)((0,f._)({},i),{section:o&&i.sections&&0!==i.sections.length?i.sections.find(e=>e.id===Number(o)):null});let w=o?!!(null===(t=i.section)||void 0===t?void 0:t.is_podcast):i.podcast_enabled;o&&!i.section&&console.error("pub [".concat(i.id,"] is on the podcast import page looking for section [").concat(o,"], but we could not find the section on the pub"));let[C,x]=(0,A.eJ)(w);return(0,Z.tZ)("section",{className:"page typography import-podcast",id:"settings",children:(0,Z.BX)("div",{className:"container",children:[(0,Z.tZ)("h1",{children:a("Import a Podcast")}),b?(0,Z.BX)("div",{className:"settings-element",children:[r?(0,Z.tZ)("h3",{children:a("Tell your previous podcast host to use the new link")}):(0,Z.tZ)("h3",{children:a("Step 4. Tell your previous podcast host to use the new link")}),(0,Z.tZ)("p",{children:a("Some of your old listeners will still have the old link so you'll need to redirect them appropriately. After a month or so you can feel free to cancel your old podcast host.")}),(0,Z.BX)(ei.xv,{as:"p",translated:!0,children:["Your podcast feed link is:"," ",(0,Z.tZ)("input",{type:"text",readOnly:!0,onFocus:e=>{(0,Y.QM)(e.target),setTimeout(()=>(0,Y.UG)(e.target),0)},onMouseUp:e=>e.preventDefault(),value:(0,j.fw6)({pub:i})})]}),(0,Z.BX)("ul",{children:[(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://support.libsyn.com/kb/changing-your-feed-url-in-itunes/",rel:"noopener",children:"Libsyn"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"http://support.megaphone.fm/megaphone-faqs/how-do-i-setup-a-301-redirect-from-megaphone-to-a-new-hosting-provider",rel:"noopener",children:"Megaphone"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://help.anchor.fm/hc/en-us/articles/360002580071-Delete-your-account-or-podcast",rel:"noopener",children:"Anchor"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://help.podbean.com/support/solutions/articles/25000013419-setting-a-301-feed-redirect",rel:"noopener",children:"PodBean"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://help.simplecast.com/billing-and-account-settings/can-i-move-my-rss-feed-away-from-simplecast",rel:"noopener",children:"Simplecast"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://help.soundcloud.com/hc/en-us/articles/115003563448-Adding-a-subscriber-redirect-to-your-RSS-feed",rel:"noopener",children:"SoundCloud"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://blog.spreaker.com/rss-feed-redirect/",rel:"noopener",children:"Spreaker"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://support.squarespace.com/hc/en-us/articles/115002267147-Transferring-a-podcast#toc-moving-a-podcast-away-from-squarespace",rel:"noopener",children:"Squarespace"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://www.buzzsprout.com/help/9-transfer-away-from-buzzsprout",rel:"noopener",children:"Buzzsprout"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://help.omnystudio.com/migrating-from-another-service/moving-away-from-omny-studio",rel:"noopener",children:"Omny Studio"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://audioboom.zendesk.com/hc/en-us/articles/360005967833-301-Redirects-Migrating-your-listeners-to-Audioboom-com",rel:"noopener",children:"AudioBoom"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://help.rss.com/en/support/solutions/articles/44002290890-how-to-redirect-your-podcast-from-captivate-fm-",rel:"noopener",children:"Captivate.fm"})})]}),(0,Z.tZ)("p",{children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>r?window.history.back():window.location.assign((0,j.nxG)(i)),children:a(r?"Done":"I've updated my previous podcast host")})})]}):u?(0,Z.BX)("div",{className:"settings-element",children:[n?(0,Z.tZ)("h3",{children:a("Submit your new feed link to podcast directories")}):(0,Z.tZ)("h3",{children:a("Step 3. Submit your new feed link to podcast directories")}),(0,Z.BX)(ei.xv,{as:"p",translated:!0,children:["Your podcast feed link is:"," ",(0,Z.tZ)("input",{type:"text",readOnly:!0,onFocus:e=>{(0,Y.QM)(e.target),setTimeout(()=>(0,Y.UG)(e.target),0)},onMouseUp:e=>e.preventDefault(),value:(0,j.fw6)({pub:i})})]}),(0,Z.tZ)(ei.xv,{as:"p",translated:!0,children:"There are a few main directories you probably want to submit your podcast RSS feed to:"}),(0,Z.BX)("ul",{children:[(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://podcastsconnect.apple.com",rel:"noopener",children:"Apple Podcasts"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://podcasters.spotify.com/",rel:"noopener",children:"Spotify"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://partners.stitcher.com/join",rel:"noopener",children:"Stitcher"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://help.tunein.com/contact/add-podcast-S19TR3Sdf",rel:"noopener",children:"TuneIn"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://pocketcasts.com/submit",rel:"noopener",children:"Pocket Casts"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{target:"_blank",href:"https://podcasters.amazon.com/podcasts",rel:"noopener",children:"Amazon Music"})})]}),(0,Z.tZ)(ei.xv,{as:"p",translated:!0,children:"Once youâ€™ve been approved by Apple, people will be able to find your podcast in pretty much any podcast app"}),(0,Z.tZ)("p",{children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>n?window.history.back():y(!0),children:a(n?"Done":"I've submitted the new link to Apple")})})]}):d?(0,Z.BX)("div",{className:"settings-element",children:[(0,Z.tZ)(ei.xv,{as:"h3",translated:!0,children:"Step 2. Import your podcast's content to Substack"}),(0,Z.tZ)(ei.xv,{as:"p",translated:!0,children:"Scan through and make sure everything looks good, then press the button and we'll clone all your old content onto your Substack. (None of your old content will be deleted.)"}),(0,Z.BX)("div",{className:"podcast-preview",children:[(0,Z.tZ)("img",{src:d.podcast_art_url,className:"podcast-art-preview"}),(0,Z.tZ)("strong",{children:a("Episodes:")}),(0,Z.tZ)("ul",{children:d.episodes.map(e=>(0,Z.tZ)("li",{children:e.title}))})]}),(0,Z.BX)(tP.ZP,{className:"import-podcast-form",performSubmit:()=>N().post("/api/v1/import/podcast").send((0,_._)((0,f._)({},d),{audience:h?"only_paid":"everyone",section_id:o,episodes_only:C,ignore_existing:g})),onSuccess:()=>p(!0),onError:e=>{var t;(0,U.j)(U.FP.PODCAST_IMPORT_ERROR,{url:d.podcast_feed_url,errors:JSON.stringify(null!==(t=(0,Y.Pu)(e))&&void 0!==t?t:{})})},autoLock:!0,children:[(0,er.pubHasPaymentsEnabled)(i)&&(0,Z.BX)(et.gq,{justifyContent:"start",alignItems:"start",gap:8,paddingBottom:12,children:[(0,Z.tZ)(i2.rs,{checked:h,onChange:e=>m(e)}),(0,Z.tZ)(ei.xv.B3,{children:a("Set posts to paid-only")})]}),w&&(0,Z.BX)(et.gq,{justifyContent:"start",alignItems:"start",gap:8,paddingBottom:12,children:[(0,Z.tZ)(i2.rs,{checked:g,onChange:e=>v(e)}),(0,Z.tZ)(ei.xv.B3,{children:a("Ignore existing episodes")})]}),w&&(0,Z.BX)(et.gq,{justifyContent:"start",alignItems:"start",gap:8,children:[(0,Z.tZ)(i2.rs,{checked:C,onChange:e=>x(e)}),(0,Z.tZ)(ei.xv.B3,{translated:!0,children:"Only import episodes (leaving things like title untouched)"})]}),(0,Z.tZ)("div",{id:"error-container"}),(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",children:a("Import all episodes")})]})]}):(0,Z.BX)("div",{children:[(0,Z.tZ)(ei.xv,{as:"p",translated:!0,children:"We've made it as easy as possible to migrate your podcast from your previous host to Substack. There are just a couple of steps, and it takes less than 5 minutes."}),(0,Z.BX)("div",{className:"settings-element",children:[(0,Z.tZ)("h3",{children:a("Step 1. Paste in your current RSS feed URL")}),(0,Z.BX)(ei.xv,{as:"p",translated:!0,children:["You can find this in your"," ",(0,Z.tZ)("a",{href:"https://podcastsconnect.apple.com/my-podcasts",target:"_blank",rel:"noopener",children:"Apple Podcasts dashboard"}),'. Just login, click on your podcast, and copy the URL from the first line. (Not the smaller "Mirror URL" below.)']}),(0,Z.BX)(tP.ZP,{className:"import-podcast-form",action:"/api/v1/import/podcast/scrape",autoLock:!0,onSuccess:e=>c(e.body),onError:(e,t)=>{var i;(0,U.j)(U.FP.PODCAST_IMPORT_SCRAPE_ERROR,{url:t.podcast_feed_url,errors:JSON.stringify(null!==(i=(0,Y.Pu)(e))&&void 0!==i?i:{})})},onChangeLoadingState:e=>s(e),children:[(0,Z.BX)("div",{className:"input-wrapper ".concat(l?"loading":""),children:[(0,Z.tZ)("div",{id:"error-container"}),(0,Z.tZ)("input",{type:"text",name:"podcast_feed_url",placeholder:a("Paste your podcast RSS feed URL here..."),"aria-label":"podcast feed URL"})]}),(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",children:a("Submit")})]})]})]})]})})};var gx=i(79774),gS=i(23709),gk=i(16293),gB=i(65207),gT=i(80858),gI=i(83868),gN=i.n(gI);let gP={meetingsTable:"meetingsTable-n1d9Hd",actionsButton:"actionsButton-YDsh5f",reasonTextArea:"reasonTextArea-cNLjGx",switcher:"switcher-RtSiVy",tab:"tab-cRrIK4",selected:"selected-yLOK3l",refunded:"refunded-Gy3G1I",subscriberSearchInput:"subscriberSearchInput-wGyCOF",resultsBox:"resultsBox-EZXOp2",resultRow:"resultRow-riVik5",searchResultWarning:"searchResultWarning-nE4yQZ",subscriberRow:"subscriberRow-gEs7pf",actionBox:"actionBox-ZZ6_XY"},gE=e=>{let{pub:t,meetingFilter:i}=e,[n,r]=(0,A.eJ)(null),[o,a]=(0,A.eJ)(null),l=(0,iN.pm)(),[s,d]=(0,A.eJ)(!1),[c,u]=(0,A.eJ)(""),[p,h]=(0,A.eJ)(!1),[m,g]=(0,A.eJ)(null),[v,b]=(0,A.eJ)(!1),[y,_]=(0,A.eJ)(null),w=ip()((0,A.I4)(async e=>{try{let t=await N().get("/api/v1/subscriber/".concat(e));g(eI()(t.body,["user_id","name","membership_state","email"]))}catch(e){(null==e?void 0:e.status)===404?g(null):l.popToast(e=>(0,Z.tZ)(iN.FN,(0,f._)({text:"An error occurred, please refresh the page",Icon:K.Z},e)))}finally{b(!1)}},[u,g]),300),C=(0,A.I4)(e=>{if(u(e),!gN()(e)){g(null);return}b(!0),w(e)},[u,g,w,b]);(0,A.d4)(()=>{["upcoming","pending","cancelled_at","past"].includes(i)||(0,Y.uX)((0,j.n1t)("/publish/meetings/upcoming"))},[i]);let x=(0,A.I4)(()=>{r(null),a(null)},[r,a]),S=(0,A.I4)((e,t)=>{r(t),a(e)},[]),B=(0,A.I4)(async e=>{let{meeting:t,reason:i,refund:n}=e;d(!0),await N().delete("/api/v1/meetings/admin/cancel/".concat(t.id)).send({reason:i,refund:n}),d(!1),l.popToast(e=>(0,Z.tZ)(iN.FN,(0,f._)({text:"Cancelled",Icon:K.Z},e))),_(null),x(),window.location.reload()},[n,x]),T=(0,A.I4)(async e=>{let{meeting:t,reason:i}=e;d(!0),await N().post("/api/v1/meetings/admin/reschedule/".concat(t.id)).send({reason:i}),d(!1),l.popToast(e=>(0,Z.tZ)(iN.FN,(0,f._)({text:"Rescheduled",Icon:gx.Z},e))),x(),window.location.reload()},[n,x]),I=(0,A.I4)(async e=>{let{meeting:t}=e;d(!0),await N().post("/api/v1/meetings/admin/refund/".concat(t.id)),d(!1),l.popToast(e=>(0,Z.tZ)(iN.FN,(0,f._)({text:"Refunded",Icon:gS.Z},e))),x(),window.location.reload()},[n,x]),P=(0,A.I4)(async e=>{d(!0),await N().post("/api/v1/meetings/admin/grant").send({user_id:e}),d(!1),l.popToast(e=>(0,Z.tZ)(iN.FN,(0,f._)({text:"Granted",Icon:gk.Z},e))),_(null)},[d]),E=(e,t)=>(0,Z.tZ)("div",{className:k()(gP.tab,i===e&&gP.selected),onClick:()=>(0,Y.uX)("/publish/meetings/".concat(e),{local_navigation:!0}),children:t});return(0,Z.BX)("div",{className:"page container",children:[n&&"cancel"===o&&(0,Z.tZ)(gA,{onClose:x,meeting:n,cancelMeeting:B,loading:s}),n&&"view"===o&&(0,Z.tZ)(gF,{onClose:x,meeting:n}),n&&"reschedule"===o&&(0,Z.tZ)(gD,{onClose:x,meeting:n,rescheduleMeeting:T,loading:s}),n&&"refund"===o&&(0,Z.tZ)(gR,{onClose:x,meeting:n,refundMeeting:I,loading:s}),y&&(0,Z.tZ)(gL,{onClose:()=>_(null),subscriber:y,loading:s,grantMeeting:P}),(0,Z.BX)(et.gq,{paddingBottom:12,justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(ei.xv.H1,{children:"Meetings"}),(0,Z.BX)(et.gq,{gap:8,className:gP.actionBox,children:[(0,Z.tZ)(tD.oi,{value:c,onChange:e=>C(e.currentTarget.value),placeholder:"Grant a meeting...",className:gP.subscriberSearchInput,onBlur:()=>window.setTimeout(()=>h(!1),300),onFocus:()=>h(!0)}),p&&!v&&(0,Z.tZ)(et.tu,{className:gP.resultsBox,children:m?(0,Z.BX)(et.tu,{className:k()(gP.resultRow,gP.subscriberRow),onClick:()=>{_(eI()(m,["email","membership_state","user_id","name"])),h(!1)},children:[(0,Z.tZ)(ei.xv.B4,{children:"Grant meeting to"}),(0,Z.tZ)(ei.xv.B3,{children:m.email})]}):gN()(c)?(0,Z.tZ)(et.gq,{className:k()(gP.resultRow,gP.searchResultWarning),children:(0,Z.tZ)(ei.xv.B4,{children:(0,Z.tZ)("i",{children:"No subscriber found."})})}):(0,Z.tZ)(et.gq,{className:k()(gP.resultRow,gP.searchResultWarning),children:(0,Z.tZ)(ei.xv.B4,{children:(0,Z.tZ)("i",{children:"Enter a subscriber's email address..."})})})}),(0,Z.tZ)(ee.zx,{href:(0,j.wI3)(t,{section:"meetings"}),priority:"secondary",leading:(0,Z.tZ)(eD.Z,{size:18}),children:"Settings"})]})]}),(0,Z.BX)(et.gq,{className:gP.switcher,justifyContent:"start",gap:12,children:[E("upcoming","Upcoming"),E("past","Past"),E("cancelled_at","Cancelled"),E("pending","Pending")]}),"upcoming"===i&&(0,Z.tZ)("div",{className:gP.meetingsTable,children:(0,Z.tZ)(gu.Z,{children:(0,Z.tZ)(gX,{filter:"upcoming",onAction:S})})}),"past"===i&&(0,Z.tZ)("div",{className:gP.meetingsTable,children:(0,Z.tZ)(gu.Z,{children:(0,Z.tZ)(gX,{filter:"past",onAction:S})})}),"cancelled_at"===i&&(0,Z.tZ)("div",{className:gP.meetingsTable,children:(0,Z.tZ)(gu.Z,{children:(0,Z.tZ)(gX,{filter:"cancelled_at",onAction:S})})}),"pending"===i&&(0,Z.tZ)("div",{className:gP.meetingsTable,children:(0,Z.tZ)(gu.Z,{children:(0,Z.tZ)(gX,{filter:"pending",onAction:S})})})]})},gX=e=>{let{filter:t,onAction:i}=e,n=[{key:"purchaser_name",name:"Name",sortable:!1,valueFn:e=>(0,Z.tZ)("a",{className:"bold",href:"mailto:".concat(e.purchaser_email),rel:"noopener",children:(0,Z.BX)(et.gq,{gap:4,alignItems:"center",children:[(0,Z.tZ)("span",{children:(0,er.truncateText)(e.purchaser_name,60)}),(0,Z.tZ)(gB.Z,{height:16})]})})},..."pending"!==t?[{key:"event_time",name:"Time",sortable:!0,valueFn:e=>{let t=(0,H.Z)(e.event_time);return(0,Z.BX)("span",{children:[t.format("dddd (M/D)")," at ",t.format("h:mm A")]})}}]:[],{key:"amount_paid",name:"Amount Paid",sortable:!0,valueFn:e=>(0,Z.tZ)("span",{className:k()(e.refunded_at&&gP.refunded),children:null!=e.amount_paid&&(0,er.centsToPriceString)(e.amount_paid,e.currency)})},{key:"topic",name:"Topic",sortable:!1,valueFn:e=>e.topic},{key:"cancelled_at",name:"",sortable:!1,valueFn:e=>(0,Z.tZ)(gM,{filter:t,row:e,onAction:i})}],r="upcoming"===t?{by:"event_time",direction:u8.Asc}:"past"===t?{by:"event_time",direction:u8.Desc}:"pending"===t?{by:"created_at",direction:u8.Desc}:{by:"cancelled_at",direction:u8.Desc};return(0,Z.tZ)(ps,{url:"/api/v1/meetings/admin/booked?filter=".concat(t),appendMode:!1,cols:n,defaultSort:r,pageSize:10,dataKey:"meetings",empty:(0,Z.tZ)(u0,{icon:(0,Z.tZ)(gT.Z,{}),title:"No meetings found",text:"Your ".concat("cancelled_at"===t?"cancelled":t," meetings will be shown here.")})})},gM=e=>{let{row:t,onAction:i,filter:n}=e,r=["upcoming"].includes(n)&&!t.cancelled_at,o=["upcoming"].includes(n),a=["past","pending","cancelled_at"].includes(n)&&!t.refunded_at&&t.amount_paid;return(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{priority:"secondary-outline",className:gP.actionsButton,children:(0,Z.tZ)(pu.Z,{size:20})}),children:[t.attachment&&(0,Z.tZ)(tC.sN,{onClick:()=>(0,Y.uX)(t.attachment,{newTab:!0}),children:"Download attachment"}),r&&(0,Z.tZ)(tC.sN,{onClick:()=>i("cancel",t),children:"Cancel meeting"}),o&&(0,Z.tZ)(tC.sN,{onClick:()=>i("reschedule",t),children:"Ask to reschedule"}),a&&(0,Z.tZ)(tC.sN,{onClick:()=>i("refund",t),children:"Refund meeting"}),(0,Z.tZ)(tC.sN,{onClick:()=>i("view",t),children:"View meeting details"}),(0,Z.tZ)(tC.sN,{onClick:()=>{(0,Y.uX)((0,j.n1t)("/publish/subscribers/legacy",{email:t.purchaser_email}),{newTab:!0})},children:"View subscriber in dashboard"})]})},gA=e=>{let{onClose:t,meeting:i,loading:n,cancelMeeting:r}=e,[o,a]=(0,A.eJ)(!0),[l,s]=(0,A.eJ)(""),d=(0,H.Z)(i.event_time),c="".concat(d.format("MMMM D, YYYY")," at ").concat(d.format("h:mm A"));return(0,Z.BX)(eK.u_,{isOpen:!0,onClose:t,children:[(0,Z.tZ)(eK.xB,{onClose:t,title:"Cancel meeting",showClose:!0}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.BX)(ei.xv.B3,{children:["This will cancel your meeting with ",i.purchaser_name,". They will receive an email informing them that their meeting has been cancelled."]}),(0,Z.BX)(ei.xv.B3,{children:["This meeting is scheduled for ",c,"."]}),(0,Z.BX)(et.gq,{justifyContent:"start",gap:12,children:[(0,Z.tZ)(i2.rs,{checked:o,onChange:e=>a(e)}),(0,Z.tZ)(ei.xv.B3,{children:"Issue refund?"})]}),(0,Z.tZ)(et.gq,{justifyContent:"center",children:(0,Z.tZ)(li.g,{maxLength:9999,value:l,onChange:e=>s(e.target.value),className:gP.reasonTextArea,rows:5,placeholder:"(optional) Let them know why you are cancelling"})})]})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",disabled:n,onClick:()=>{r({meeting:i,refund:o,reason:l||void 0})},children:o?"Cancel Meeting and Issue Refund":"Cancel Meeting Without Refund"})})]})},gD=e=>{let{onClose:t,meeting:i,loading:n,rescheduleMeeting:r}=e,[o,a]=(0,A.eJ)("");return(0,Z.BX)(eK.u_,{isOpen:!0,onClose:t,children:[(0,Z.tZ)(eK.xB,{onClose:t,title:"Reschedule meeting",showClose:!0}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.BX)(ei.xv.B3,{children:["This will cancel your current meeting with ",i.purchaser_name,". They will receive an email informing them that their meeting has been rescheduled with a link to select a new time. Make sure your availability on Calendly is up-to-date before sending this email."]}),(0,Z.tZ)(et.gq,{justifyContent:"center",children:(0,Z.tZ)(li.g,{maxLength:9999,value:o,onChange:e=>a(e.target.value),rows:5,placeholder:"(optional) Let them know why you need to reschedule",className:gP.reasonTextArea})})]})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",disabled:n,onClick:()=>{r({meeting:i,reason:o||void 0})},children:"Reschedule Meeting"})})]})},gR=e=>{let{onClose:t,meeting:i,loading:n,refundMeeting:r}=e;return(0,Z.BX)(eK.u_,{isOpen:!0,onClose:t,children:[(0,Z.tZ)(eK.xB,{onClose:t,title:"Refund meeting",showClose:!0}),(0,Z.tZ)(eK.fe,{children:(0,Z.tZ)(et.tu,{gap:12,children:(0,Z.BX)(ei.xv.B3,{children:["This will issue a refund to ",i.purchaser_name," for"," ",(0,er.centsToPriceString)(i.amount_paid,i.currency),".",!i.event_time&&(0,Z.BX)(Z.HY,{children:[i.purchaser_name," will no longer be able to schedule this meeting, and will need to book a new meeting."]})]})})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",disabled:n,onClick:()=>r({meeting:i}),children:"Refund Meeting"})})]})},gF=e=>{let{onClose:t,meeting:i}=e,n=i.event_time&&(0,H.Z)(i.event_time),r=n?"".concat(n.format("MMMM D, YYYY")," at ").concat(n.format("h:mm A")):"(no meeting time selected)",o=(0,H.Z)(i.created_at),a="".concat(o.format("MMMM D, YYYY")," at ").concat(o.format("h:mm A"));return(0,Z.BX)(eK.u_,{isOpen:!0,onClose:t,children:[(0,Z.tZ)(eK.xB,{onClose:t,title:"Meeting details",showClose:!0}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{children:[n&&(0,Z.BX)(ei.xv.B3,{paddingBottom:16,children:["This meeting is scheduled for ",r,", and was booked at ",a,"."]}),i.refunded_at&&(0,Z.BX)(ei.xv.B3,{children:["This meeting was refunded on ",(0,H.Z)(i.refunded_at).format("MMMM D, YYYY"),"."]}),i.cancelled_at&&(0,Z.BX)(ei.xv.B3,{children:["This meeting was cancelled on ",(0,H.Z)(i.refunded_at).format("MMMM D, YYYY"),"."]}),(0,Z.BX)(ei.xv.B3,{children:[i.purchaser_name," paid ",(0,er.centsToPriceString)(i.amount_paid,i.currency)," for this meeting, and provided the following summary of what they would like to discuss:"]}),(0,Z.tZ)(ei.xv.B4,{align:"center",paddingBottom:12,children:i.topic})]})})]})},gL=e=>{let{onClose:t,subscriber:i,grantMeeting:n,loading:r}=e;return(0,Z.BX)(eK.u_,{isOpen:!0,onClose:t,children:[(0,Z.tZ)(eK.xB,{onClose:t,title:"Grant a meeting",showClose:!0}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(ei.xv.B3,{children:["This will grant a meeting to ",i.email,", who is a"," ","subscribed"===i.membership_state?"paid":"free"," subscriber to your publication. They will receive an email letting them select a time for your call."]})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",disabled:r,onClick:()=>n(i.user_id),children:"Grant Meeting"})})]})};var gz=i(73525),gO=i(92002),gU=i(73580),gY=i(5302),gH=i(30301),gj=i(23648);let gJ=(0,to.forwardRef)((e,t)=>{var{className:i}=e,n=(0,ef._)(e,["className"]);return(0,Z.tZ)(ts.xu,{position:"relative",overflow:"auto",className:i,children:(0,Z.tZ)("table",(0,_._)((0,f._)({ref:t},n),{className:k()(gH.Z.table,"pencraft",i)}))})});gJ.displayName="Table";let gV=(0,to.forwardRef)((e,t)=>{var i=(0,gO._)({},(0,gU._)(e));return(0,Z.tZ)("thead",(0,f._)({ref:t,className:k()(gH.Z.thead,g1(i))},i))});gV.displayName="TableHeader";let gq=(0,to.forwardRef)((e,t)=>{var i=(0,gO._)({},(0,gU._)(e));return(0,Z.tZ)("tbody",(0,_._)((0,f._)({},i),{ref:t,className:gH.Z.tbody}))});gq.displayName="TableBody";let gW=(0,to.forwardRef)((e,t)=>{var i=(0,gO._)({},(0,gU._)(e));return(0,Z.tZ)("tfoot",(0,_._)((0,f._)({ref:t},i),{className:gH.Z.tfoot}))});gW.displayName="TableFooter";let gG=(0,to.forwardRef)((e,t)=>{var{borderBottom:i="detail"}=e,n=(0,ef._)(e,["borderBottom"]);return(0,Z.tZ)("tr",(0,f._)({ref:t,className:k()(gH.Z.tr,g1((0,f._)({borderBottom:i},n)))},n))});gG.displayName="TableRow";let gK=(0,to.forwardRef)((e,t)=>{var i=(0,gO._)({},(0,gU._)(e));return(0,Z.tZ)("th",(0,f._)({ref:t,className:k()(gH.Z.th,g0(i))},i))});gK.displayName="TableHeaderCell";let gQ=(0,to.forwardRef)((e,t)=>{var i=(0,gO._)({},(0,gU._)(e));return(0,Z.tZ)("td",(0,f._)({ref:t,className:k()(gH.Z.td,g0(i))},i))});gQ.displayName="TableCell",(0,to.forwardRef)((e,t)=>{var i=(0,gO._)({},(0,gU._)(e));return(0,Z.tZ)("caption",(0,_._)((0,f._)({ref:t},i),{className:gH.Z.caption}))}).displayName="TableCaption";let g$=(0,ts.zo)({display:"flex",direction:"column",border:"detail",radius:"sm",overflow:"hidden"});function g0(e){return k()(e.align&&gj.Z["align-".concat(e.align)],e.weight&&gj.Z["weight-".concat(e.weight)],e.color&&gj.Z["color-".concat(e.color)],e.ellipsis&&gj.Z.ellipsis,e.maxWidth&&(0,ts.oB)({maxWidth:e.maxWidth}),e.justifyContent&&(0,ts.oB)({display:"flex",justifyContent:e.justifyContent}))}function g1(e){return k()(e.borderBottom&&gH.Z["border-bottom-".concat(e.borderBottom)],e.borderLeft&&gH.Z["border-left-".concat(e.borderLeft)],e.bg&&gY.Z["bg-".concat(e.bg)],e.cursor&&gY.Z["cursor-".concat(e.cursor)])}var g2=i(9497),g4=i(45428),g3=i(66440);let g8=()=>{let{iString:e}=(0,Q.M1)();return[["1d",e("For 1 day")],["30d",e("For 30 days")],["90d",e("For 90 days")],["1y",e("For 1 year")],["1000y",e("Forever")]]};var g6=((d={}).VISIBLE="visible",d.DELETE_THIS_COMMENT="delete_this_comment",d.DELETE_ALL_COMMENTS="delete_all_comments",d);let g5=()=>{let{iString:e}=(0,Q.M1)();return[["visible",e("Do not delete comments")],["delete_this_comment",e("Delete this comment")],["delete_all_comments",e("Also delete all comments")]]};function g9(){let e=(0,G._)(["Are you sure you want to ban the emails in this file from ","?"]);return g9=function(){return e},e}function g7(){let e=(0,G._)(["Are you sure you want to ban "," from ","?"]);return g7=function(){return e},e}function ve(){let e=(0,G._)(["Ban emails in ",""]);return ve=function(){return e},e}let vt=e=>{let{emailFileInput:t,setFileValue:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:e=>{e.preventDefault(),t.current&&(t.current.value=""),i("")},leading:(0,Z.tZ)(g3.Z,{size:20}),children:n("Remove file")})},vi=e=>{let{emailFileInput:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:e=>{e.preventDefault(),t.current&&t.current.click()},leading:(0,Z.tZ)(uc.Z,{size:20}),children:i("Upload CSV")})},vn=()=>{var e;let{iString:t}=(0,Q.M1)(),i=g8(),n=null===(e=i[1])||void 0===e?void 0:e[0];return(0,Z.BX)(oY.i,{name:"expiry",flex:"grow",value:n,children:[(0,Z.tZ)(oY.d,{children:t("Select a duration")}),i.map(e=>{let[t,i]=e;return(0,Z.tZ)("option",{value:t,children:i})})]})},vr=e=>{var t;let{typeOptions:i,typeSelection:n,setTypeSelection:r}=e,{iString:o}=(0,Q.M1)(),a=2===n.length?"both":(null===(t=n[0])||void 0===t?void 0:t.value)||"";return(0,Z.BX)(oY.i,{value:a,onChange:e=>{switch(e.target.value){case"comment":r(i[0]?[i[0]]:[]);break;case"subscribe":r(i[1]?[i[1]]:[]);break;case"both":r(i[0]&&i[1]?[i[0],i[1]]:[])}},flex:"grow",children:[(0,Z.tZ)(oY.d,{children:o("Select ban type")}),(0,Z.tZ)("option",{value:"comment",children:o("Ban from commenting")}),(0,Z.tZ)("option",{value:"subscribe",children:o("Ban from subscribing")}),(0,Z.tZ)("option",{value:"both",children:o("Ban from both")})]})},vo=()=>{let{iString:e,iTemplate:t}=(0,Q.M1)(),i=[{value:"comment",label:e("Commenting")},{value:"subscribe",label:e("Subscribing")}],[n,r]=(0,A.eJ)(!1),[o,a]=(0,A.eJ)(""),[l,s]=(0,A.eJ)(""),[d,c]=(0,A.eJ)([i[0]]),u=(0,A.sO)(null),p=(0,A.sO)(null),h=async n=>{var r,a;let l=o?null===(a=p.current)||void 0===a?void 0:null===(r=a.files)||void 0===r?void 0:r[0]:"";if(void 0===l){console.warn("attempted to submit missing file, cannot submit");return}let s=n.email.split(/[,\s\n\r]/g).map(e=>e.trim()).filter(Boolean).length,d=n.types.map(e=>{var t;return null===(t=i.find(t=>{let{value:i}=t;return i===e}))||void 0===t?void 0:t.label.toLowerCase()}).join(e(" and ")),c=l?t(g9(),d):t(g7(),1===s?"this email":"these ".concat(s," emails"),d);if(n.types.includes("subscribe")&&(c+=e(" If any of these emails belong to people who have already subscribed, they will be removed from your list, and any existing paid subscribers will be issued pro rata refunds.")),!confirm(c))return null;let u=new FormData;u.set("email",n.email),u.set("expiry",n.expiry),u.set("types",JSON.stringify(n.types)),u.set("email_file",l);try{return N().post("/api/v1/subscriber/bans").send(u)}catch(e){alert((0,Y.zx)(e))}};return(0,Z.tZ)(et.sg,{gap:20,radius:"md",border:"detail",shadow:"xs",className:"container-_Zoisi",children:(0,Z.BX)(tP.ZP,{className:"unstyled",noInlineErrors:!0,performSubmit:h,prepareData:e=>(0,_._)((0,f._)({},e),{types:d.map(e=>{let{value:t}=e;return t})}),onSuccess:()=>{"undefined"!=typeof document&&(document.location.href="/publish/bans")},enctype:"multipart/form-data",children:[(0,Z.BX)(et.sg,{gap:8,padding:20,children:[(0,Z.BX)(et.X2,{flex:"grow",gap:8,children:[(0,Z.tZ)(tD.oi,{ref:u,flex:"grow",type:"text",name:"email",leading:o?(0,Z.tZ)(g4.Z,{size:20}):void 0,value:o||l,placeholder:e("Enter email addresses (comma separated)"),disabled:!!o,onChange:e=>{let t=e.target,i=t.value.trim();s(t.value),r(!!i)},autoComplete:"off"}),o?(0,Z.tZ)(vt,{emailFileInput:p,setFileValue:a}):(0,Z.tZ)(vi,{emailFileInput:p}),(0,Z.tZ)("input",{ref:p,type:"file",name:"email_file",onChange:e=>{a(e.target.value.replace(/^.*[\\\/]/,""))},accept:"text/csv",hidden:!0})]}),(0,Z.BX)(et.X2,{flex:"grow",gap:8,children:[(0,Z.tZ)(vr,{typeOptions:i,typeSelection:d,setTypeSelection:c}),(0,Z.tZ)(vn,{})]})]}),(0,Z.tZ)(et.sg,{padding:20,paddingTop:0,children:(0,Z.tZ)(ee.zx,{type:"submit",priority:"destructive",disabled:!o&&!n,children:o?t(ve(),(0,er.truncateText)(o,20)):e("Ban emails")})})]})})};function va(){let e=(0,G._)(["Are you sure you want to end this ban and allow "," to ","?"]);return va=function(){return e},e}function vl(){let e=(0,G._)(["Are you sure you want to remove all comments from ","?"]);return vl=function(){return e},e}function vs(){let e=(0,G._)(["Removed "," comments from ",""]);return vs=function(){return e},e}let vd=e=>{let{activeBans:t,inactiveBans:i,publication:n,type:r}=e;return(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(vc,{type:r}),(0,Z.BX)(gq,{children:[t.length>0&&t.map(e=>(0,Z.tZ)(vh,{ban:e,publication:n,type:r},e)),i.length>0&&i.map(e=>(0,Z.tZ)(vh,{ban:e,publication:n,type:r},e)),0===t.length&&0===i.length&&(0,Z.tZ)(vu,{})]})]})})},vc=e=>{let{type:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.BX)(gG,{bg:"secondary",children:[(0,Z.tZ)(gK,{children:i("User")}),(0,Z.tZ)(gK,{children:i("Start")}),(0,Z.tZ)(gK,{children:i("End")}),(0,Z.tZ)(gK,{children:i("Status")}),"comment"===t&&(0,Z.tZ)(gK,{children:i("Link")}),(0,Z.tZ)(gK,{})]})},vu=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(gG,{children:(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.xv,{color:"secondary",children:e("No bans")})})})},vp=e=>{let{publication:t,bans:i,type:n}=e,r=i.filter(e=>e.type===n),o=new Map,a=[];for(let e of(r.forEach(e=>{let t=e.user_id||e.user_email;if(!t){a.push(e);return}o.has(t)?e.user_id&&o.set(t,e):o.set(t,e)}),o.values()))a.push(e);let l=a.sort((e,t)=>(0,H.Z)(t.start).valueOf()-(0,H.Z)(e.start).valueOf()),[s,d]=eB()(l,e=>(0,H.Z)(e.expiry).isAfterNow());return(0,Z.tZ)(et.sg,{gap:20,children:(0,Z.tZ)(vd,{activeBans:s,inactiveBans:d,publication:t,type:n})})},vh=e=>{let{publication:t,ban:i,type:n}=e,{iString:r,iTemplate:o}=(0,Q.M1)(),a=(0,iN.pm)(),[l,s]=(0,A.eJ)(!1),{user_email:d,name:c,user_id:u}=i,p=c||d||r("this user"),h=d||u,m=async()=>{if(confirm(o(va(),p,n))){s(!0);try{await N().post("/api/v1/subscriber/".concat(h,"/unban")).send({type:n}),document.location.reload()}catch(e){console.error("Failed to unban:",e),a.popToast(t=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},t),{text:(0,Y.zx)(e,r("Failed to unban user"))}))),s(!1)}s(!1)}},g=async()=>{if(confirm(o(vl(),p))){s(!0);try{let{total:e}=(await N().post("/api/v1/moderation/remove_user_comments/".concat(h)).send()).body,t=e?o(vs(),e,p):r("No comments found");a.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:t})))}catch(e){console.error("Failed to remove comments:",e),a.popToast(t=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},t),{text:(0,Y.zx)(e,r("Failed to remove comments"))})))}s(!1)}};return(0,Z.BX)(gG,{borderBottom:"detail",children:[(0,Z.tZ)(vm,{ban:i,publication:t}),(0,Z.tZ)(vg,{ban:i}),(0,Z.tZ)(vv,{ban:i}),(0,Z.tZ)(vb,{ban:i}),(0,Z.tZ)(vf,{ban:i,publication:t}),(0,Z.tZ)(vy,{ban:i,updating:l,endBan:m,removeComments:g})]})},vm=e=>{let{ban:t,publication:i}=e,{iString:n}=(0,Q.M1)(),{user_email:r,photo_url:o,name:a,subscription_id:l}=t,s=a||r,d=l&&r;return(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:(0,Z.tZ)(et.X2,{gap:12,children:d?(0,Z.tZ)(sx.A0,{href:(0,j.pN7)(i,r),children:(0,Z.BX)(et.X2,{gap:8,alignItems:"center",minWidth:0,children:[(0,Z.tZ)(eG.qE,{photoUrl:null!=o?o:void 0,size:24}),(0,Z.tZ)(ei.xv,{ellipsis:!0,decoration:"hover-underline",children:s})]})}):(0,Z.BX)(et.X2,{gap:8,alignItems:"center",minWidth:0,children:[(0,Z.tZ)(eG.qE,{photoUrl:null!=o?o:void 0,size:24}),(0,Z.tZ)(ei.xv,{ellipsis:!0,children:null!=s?s:n("Anonymous")})]})})})},vg=e=>{let{ban:t}=e,{language:i}=(0,Q.M1)(),n=null==t.start?"":(0,H.Z)(t.start).locale(i).standardDatetimeWithYear(),r=Math.abs((0,H.Z)(t.start).diff((0,H.Z)(),"days")),o=Math.abs((0,H.Z)(t.start).diff((0,H.Z)(),"hours")),a=Math.abs((0,H.Z)(t.start).diff((0,H.Z)(),"minutes"));return(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:(0,Z.tZ)(tW.u,{text:n,children:(0,Z.tZ)(ei.xv,{cursor:"pointer",children:r>0?"".concat(r,"d ago"):o>0?"".concat(o,"h ago"):a>0?"".concat(a,"m ago"):"Just now"})})})},vv=e=>{let{ban:t}=e,{language:i}=(0,Q.M1)(),n=null==t.expiry?"":(0,H.Z)(t.expiry).locale(i).standardDatetimeWithYear(),r=Math.abs((0,H.Z)(t.expiry).diff((0,H.Z)(),"days")),o=Math.abs((0,H.Z)(t.expiry).diff((0,H.Z)(),"hours")),a=Math.abs((0,H.Z)(t.expiry).diff((0,H.Z)(),"minutes"));return(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:(0,Z.tZ)(tW.u,{text:n,children:(0,Z.tZ)(ei.xv,{cursor:"pointer",children:r>0?"".concat(r,"d"):o>0?"".concat(o,"h"):a>0?"".concat(a,"m"):n})})})},vb=e=>{let{ban:t}=e,{iString:i}=(0,Q.M1)(),n=(0,H.Z)(t.expiry).isBeforeNow();return(0,Z.tZ)(gQ,{children:(0,Z.tZ)(d_.Vp,{theme:n?"default":"error",priority:"secondary",children:i(n?"Expired":"Banned")})})},vy=e=>{let{ban:t,updating:i,endBan:n,removeComments:r}=e,{iString:o}=(0,Q.M1)(),a=(0,H.Z)(t.expiry).isBeforeNow(),l=a?w.Fragment:tC.xw;return(0,Z.tZ)(gQ,{justifyContent:"end",children:i?(0,Z.tZ)(iI.$j,{}):(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{priority:"tertiary",size:"sm",children:(0,Z.tZ)(pu.Z,{size:20})}),children:[!a&&(0,Z.tZ)(tC.sN,{onClick:n,leading:(0,Z.tZ)(gz.Z,{}),children:o("End ban")}),(0,Z.tZ)(l,{children:(0,Z.tZ)(tC.sN,{onClick:r,priority:"destructive",leading:(0,Z.tZ)(iW.Z,{}),children:o("Delete all comments")})})]})})},vf=e=>{let{ban:t,publication:i}=e,{iString:n}=(0,Q.M1)(),{comment_id:r,slug:o,type:a}=t,l=r&&o?(0,j.MoQ)(i,o,{commentId:r}):null;return"comment"!==a?null:(0,Z.tZ)(gQ,{children:l?(0,Z.tZ)(ei.hh,{href:l,target:"_blank",rel:"noopener noreferrer",decoration:"hover-underline",children:n("Comment")}):(0,Z.tZ)(ei.xv,{color:"secondary",fontStyle:"italic",children:n("n/a")})})},v_=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(null),[o,a]=(0,A.eJ)("comment"),[l,s]=(0,A.eJ)(!1),[d,c]=(0,A.eJ)(null),u=[{value:"comment",label:i("Banned from commenting")},{value:"subscribe",label:i("Banned from subscribing")}];return(0,A.d4)(()=>{(async()=>{if(!n&&!l){try{s(!0);let e=await N().get("/api/v1/publication/bans").send();r(e.body.bans)}catch(e){console.error("Failed to load bans",d),c(!0)}s(!1)}})()},[n,l]),(0,Z.BX)(et.sg,{className:"container-rUoLtw",paddingY:32,paddingX:16,gap:36,children:[(0,Z.tZ)(de,{}),(0,Z.BX)(s9,{children:[(0,Z.tZ)(s7,{title:i("Create new ban")}),(0,Z.tZ)(vo,{})]}),(0,Z.BX)(s9,{children:[(0,Z.tZ)(s7,{title:i("Manage existing bans")}),(0,Z.tZ)(g2._,{tabs:u,value:o,onChange:a}),n?(0,Z.tZ)(vp,{publication:t,bans:n,type:o}):d?(0,Z.tZ)(et.sg,{padding:32,children:(0,Z.tZ)(tp._Y,{title:i("There was an error loading the bans data"),text:i("Please try again"),icon:(0,Z.tZ)(eL.Z,{size:24})})}):(0,Z.tZ)(iI.$j,{padding:32,alignItems:"center",justifyContent:"center"})]})]})};var vZ=i(27484),vw=i.n(vZ);function vC(){let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{children:[(0,Z.tZ)(gK,{children:e("Name")}),(0,Z.tZ)(gK,{children:e("Created By")}),(0,Z.tZ)(gK,{children:e("Created At")}),(0,Z.tZ)(gK,{children:e("Active Version")})]})})}function vx(e){var t,i;let{policy:n,selectedPolicyId:r,setSelectedPolicyId:o,onToggleVersion:a}=e,{iString:l}=(0,Q.M1)(),s=n.versions.find(e=>"active"===e.status),d=[{label:l("None"),value:"NONE"},...n.versions.map(e=>({label:"v".concat(e.version," (").concat(vw()(e.created_at).standardDatetimeWithYear(),")"),value:e.version.toString()}))];return(0,Z.BX)(gG,{onClick:()=>o(n.id),cursor:"pointer","data-state":n.id===r?"selected":"unselected",children:[(0,Z.tZ)(gQ,{children:n.name}),(0,Z.tZ)(gQ,{children:n.created_by}),(0,Z.tZ)(gQ,{children:vw()(n.created_at).standardDatetimeWithYear()}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(iT.m,{options:d,value:null!==(i=null==s?void 0:null===(t=s.version)||void 0===t?void 0:t.toString())&&void 0!==i?i:"NONE",onChange:e=>a(n.id,"NONE"===e?null:parseInt(e))})})]})}function vS(e){let{policies:t,selectedPolicyId:i,setSelectedPolicyId:n,onToggleVersion:r}=e;return(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(vC,{}),(0,Z.tZ)(gq,{children:t.map(e=>(0,Z.tZ)(vx,{policy:e,selectedPolicyId:i,setSelectedPolicyId:n,onToggleVersion:r},e.id))})]})})}var vk=i(95570);let vB=["1.0"];function vT(e){if(e.startsWith("---")){let[t,i,...n]=e.split("\n"),r=vk.ZP.load(null!=i?i:"");if(!vB.includes(null==r?void 0:r.substack_policy_version))throw Error("Invalid policy version");let o=vk.ZP.load(n.join("\n")),{isValid:a,errors:l}=vX(o);if(!a)throw Error("Invalid policy: ".concat(l.map(e=>e.message).join(", ")));return{policy:o,frontmatter:r}}return{policy:{role_prompt:e,labels:[]},frontmatter:{substack_policy_version:"0.0"}}}function vI(e){let{policy:t,frontmatter:i}=e;return"---\n".concat(vk.ZP.dump(i),"\n---\n").concat(vk.ZP.dump(t))}function vN(e){let t=[];return e.trim()||t.push({field:"role_prompt",message:"Role prompt is required"}),{isValid:0===t.length,errors:t}}function vP(e){let t=[];return e.name.trim()||t.push({field:"name",message:"Label name is required"}),e.description.trim()||t.push({field:"description",message:"Label description is required"}),{isValid:0===t.length,errors:t}}function vE(e){let t=[];return e.category.trim()||t.push({field:"category",message:"Reason is required"}),e.severity||t.push({field:"severity",message:"Severity is required"}),{isValid:0===t.length,errors:t}}function vX(e){let t=[],i=vN(e.role_prompt);return t.push(...i.errors),e.labels.forEach((e,i)=>{vP(e).errors.forEach(e=>{t.push({field:"labels[".concat(i,"].").concat(e.field),message:e.message})}),e.examples.forEach((e,n)=>{vE(e).errors.forEach(e=>{t.push({field:"labels[".concat(i,"].examples[").concat(n,"].").concat(e.field),message:e.message})})})}),{isValid:0===t.length,errors:t}}let vM={role_prompt:"You are the comment moderator for a Substack publication. Your role is to protect discussion quality by identifying and labeling problematic comments according to the guidelines below. Consider the context carefully when applying labels.",labels:[{name:"Personal Attacks",description:"Comments that insult, condescend, or express personal disdain for the author of the post or another commenter, including derogatory language, ad hominem remarks, mockery, or identity-based attacks.",examples:[{body:"You clearly have no idea what you are talking about, and your education must be lacking.",severity:"high",category:"Ad hominem attack"},{body:"Only an idiot would believe what you are saying.",severity:"high",category:"Direct insult"},{body:"I disagree with your point because the data shows otherwise.",severity:"none",category:"Respectful disagreement"},{body:"This writing is boring.",severity:"none",category:"Critique of content not person"}]},{name:"Harassment",description:"Comments that involve targeting specific individuals, sharing/threatening to share private information, stalking, or creating a hostile environment through unwelcome sexual remarks or persistent targeting.",examples:[{body:"I have seen you comment on every post, and I will make sure everyone knows where you live.",severity:"high",category:"Doxxing threat"},{body:"You better watch your back because I am coming for you.",severity:"high",category:"Threatening behavior"},{body:"The senator is corrupt and should be investigated.",severity:"none",category:"Criticism of public figure"},{body:"This article's argument is weak and lacks evidence.",severity:"none",category:"Content critique"}]},{name:"Violent Threats",description:"Comments containing explicit or implicit threats of violence, graphic descriptions of violence, or language that creates a hostile environment through threats of physical harm.",examples:[{body:"If you do not stop, I will come over there and make you stop.",severity:"high",category:"Explicit threat"},{body:"People like you deserve to be taught a lesson, and it will not be pretty.",severity:"high",category:"Implicit threat"},{body:"Your ideas are destroying society, and people like you are a problem.",severity:"none",category:"Strong disagreement without threat"},{body:"This argument is going to blow up in your face.",severity:"none",category:"Metaphorical language"}]},{name:"Spam",description:"Comments that contain spam, self-promotion, repetitive messages, or promotional content that does not contribute to the discussion, including undisclosed affiliate links or commercial promotions.",examples:[{body:"Check out my website for more info! www.spamwebsite.com",severity:"high",category:"Spam link"},{body:"Buy my book on this topic at www.buybook.com",severity:"high",category:"Self-promotion"},{body:"Here is an article that supports your point: www.supportingarticle.com",severity:"none",category:"Relevant link sharing"}]},{name:"Offensive Language",description:"Comments containing strong inflammatory language, curse words, or slurs that are not quoted from the text or another user for discussion purposes.",examples:[{body:"You are a fucking idiot for thinking that.",severity:"high",category:"Strong curse words"},{body:"Only a complete cunt would say something like that.",severity:"high",category:"Use of slurs"},{body:"This is bullshit, and you are an asshole.",severity:"low",category:"Multiple curse words"},{body:'The article mentioned the phrase "fuck you," which I think was out of line.',severity:"none",category:"Quoting for discussion"},{body:"This policy sucks, but I understand why it is necessary.",severity:"none",category:"Mild language"}]}]};vI({policy:vM,frontmatter:{substack_policy_version:"1.0"}});var vA=i(1683),vD=i(68388),vR=i(28175),vF=i.n(vR),vL=i(59176),vz=i(60836);!function(){try{(0,vL.mM)("comment-collapse-state",[])}catch(e){return console.error("Failed to load comment collapse state:",e),[]}}();var vO=i(17048),vU=((c={})[c.Ready=0]="Ready",c[c.Approving=1]="Approving",c[c.Approved=2]="Approved",c[c.Removing=3]="Removing",c[c.Removed=4]="Removed",c[c.Undoing=5]="Undoing",c[c.Failed=6]="Failed",c[c.Banning=7]="Banning",c);let vY={1:oB.ql.moderator_approved,3:oB.ql.moderator_removed,5:oB.ql.published},vH={[oB.ql.moderator_approved]:2,[oB.ql.moderator_removed]:4,[oB.ql.published]:0},vj={1:"moderator_approved",3:"moderator_removed",5:"review_required"},vJ={1:"published",3:"flagged",5:"published"},vV={published:2,flagged:4},vq=e=>{let{reportedComment:t}=e,{iString:i}=(0,Q.M1)(),n="https://support.substack.com/hc/en-us/requests/new?ticket_form_id=14793522353556&tf_14811460381460=i_own_a_publication_&tf_14818271924756=i_m_appealing_a_comment_spam_removal_on_my_publication&tf_14879015038100=".concat(encodeURIComponent(t.body).split(" ").join("%20"));return(0,Z.tZ)(ee.zx,{priority:"secondary",newTab:!0,href:n,children:(0,Z.tZ)("span",{children:i("Appeal spam removal")})})},vW=e=>{let{handleApproveContent:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"secondary-outline",leading:(0,Z.tZ)(c4.Z,{}),onClick:t,children:i("Approve")})},vG=e=>{let{url:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"secondary",newTab:!0,href:t,children:i("See thread")})},vK=e=>{let{handleRemoveContent:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:t,leading:(0,Z.tZ)(eJ.Z,{}),children:i("Remove")})},vQ=e=>{let{handleOpenBan:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:t,leading:(0,Z.tZ)(vO.Z,{}),children:i("Ban")})};function v$(e){let{decision:t,pubId:i,onSave:n,policy:r,commentId:o,readonly:a=!1}=e,[l,s]=(0,A.eJ)(null),[d,c]=(0,A.eJ)(!1),{labels:u}=v2(t),{iString:p}=(0,Q.M1)();return(0,Z.BX)(et.X2,{gap:8,alignItems:"center",paddingBottom:12,wrap:"wrap",children:[u.map(e=>{let{name:i,severity:n,reason:r,corrected:o,isBot:l}=e,d="".concat(p("Severity"),": ").concat(n.toUpperCase()," - ").concat(p("Reason"),": ").concat(r);return a||(d="".concat(d,"\n\n").concat(p("Click to edit"))),(0,Z.tZ)(tW.u,{text:d,children:(0,Z.tZ)(d_.Vp,{theme:"none"===n?"success":"low"===n?"warn":"error",onClick:()=>{t&&!a&&s({label:{name:i,severity:n,reason:r},decisionId:t.id})},style:{cursor:"pointer"},children:(0,Z.tZ)(ei.xv.B5,{ellipsis:!0,children:o?(0,Z.BX)("s",{children:[i," ",l?"\uD83E\uDD16":""]}):"".concat(i," ").concat(l?"\uD83E\uDD16":"")})})},"".concat(i,"-").concat(o))}),!a&&(0,Z.tZ)(ee.zx,{priority:"quaternary",onClick:()=>c(!0),title:p("Add Label"),children:(0,Z.tZ)(ei.xv.B5,{translated:!0,children:"Add Label"})}),t&&l&&(0,Z.tZ)(v0,{isOpen:!!l,onClose:()=>s(null),labelName:l.label.name,decision:t,pubId:i,onSave:n}),d&&r&&(0,Z.tZ)(v1,{isOpen:d,onClose:()=>c(!1),decision:t,commentId:o,pubId:i,onSave:n,policy:r})]})}function v0(e){let{isOpen:t,onClose:i,labelName:n,decision:r,pubId:o,onSave:a}=e,[l,s]=(0,A.eJ)("high"),[d,c]=(0,A.eJ)(""),{iString:u}=(0,Q.M1)(),{labels:p}=v2(r),h=p.find(e=>{let{name:t,corrected:i}=e;return t===n&&!i});(0,A.d4)(()=>{h&&(s(h.severity),c(h.reason))},[h]);let m=[{label:u("None"),value:"none"},{label:u("Low"),value:"low"},{label:u("High"),value:"high"}],g=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(o,"/decisions/").concat(r.id,"/correct"),method:"PUT"}),v=(0,A.Ye)(()=>l!==(null==h?void 0:h.severity)||d!==(null==h?void 0:h.reason),[l,d,h]),b=async()=>{if(!v){i();return}try{var e;let t={name:null==h?void 0:h.name,severity:l,reason:d},n=[...(null!==(e=r.corrected_labels)&&void 0!==e?e:[]).filter(e=>{let{name:t}=e;return t!==(null==h?void 0:h.name)}),t];await g.refetch({json:{corrected_labels:n}}),a(),i()}catch(e){console.error("Failed to save correction:",e)}};return h?(0,Z.BX)(eK.u_,{isOpen:t,onClose:i,children:[(0,Z.tZ)(mK.xB,{title:u("Edit Label"),description:h.name,showClose:!0,onClose:i}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.sg,{gap:16,children:[(0,Z.tZ)(iT.m,{label:u("Severity"),options:m,value:l,onChange:e=>s(e)}),(0,Z.tZ)(ln,{label:u("Reason"),value:d,onChange:e=>c(e)})]})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:b,loading:g.isLoading,disabled:!v,children:u("Save")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"tertiary",onClick:i,children:u("Cancel")})})]}):null}function v1(e){let{isOpen:t,onClose:i,decision:n,commentId:r,pubId:o,onSave:a,policy:l}=e,[s,d]=(0,A.eJ)(""),[c,u]=(0,A.eJ)("high"),[p,h]=(0,A.eJ)(""),{iString:m}=(0,Q.M1)(),{labels:g}=v2(n),v=(0,A.Ye)(()=>g.map(e=>{let{name:t}=e;return t}),[g]),b=(0,A.Ye)(()=>{let e=l.versions.find(e=>"active"===e.status);return e&&e.policy?(vT(e.policy).policy.labels||[]).filter(e=>!v.includes(e.name)).map(e=>({label:e.name,value:e.name})):[]},[l,v]);(0,A.d4)(()=>{let e=b[0];e&&d(e.value)},[b]);let y=[{label:m("None"),value:"none"},{label:m("Low"),value:"low"},{label:m("High"),value:"high"}],f=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(o,"/decisions/").concat(null==n?void 0:n.id,"/correct"),method:"PUT"}),_=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(o,"/decisions"),method:"POST"}),w=async()=>{if(!s){i();return}try{let d=[...(null==n?void 0:n.corrected_labels)||[],{name:s,severity:c,reason:p}];if(n)await f.refetch({json:{corrected_labels:d}});else{var e,t;await _.refetch({json:{publication_id:o,policy_id:l.id,policy_version:null!==(t=null===(e=l.versions.find(e=>"active"===e.status))||void 0===e?void 0:e.version)&&void 0!==t?t:0,comment_id:r,corrected_labels:d}})}a(),i()}catch(e){console.error("Failed to add label:",e)}},C=s&&""!==p.trim();return(0,Z.BX)(eK.u_,{isOpen:t,onClose:i,children:[(0,Z.tZ)(mK.xB,{title:m("Add Label"),showClose:!0,onClose:i}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.sg,{gap:16,children:[(0,Z.tZ)(iT.m,{label:m("Label"),options:b,value:s,onChange:e=>d(e),disabled:0===b.length}),0===b.length&&(0,Z.tZ)(ei.xv.B4,{color:"error",children:m("No available labels to add. All policy labels are already applied.")}),(0,Z.tZ)(iT.m,{label:m("Severity"),options:y,value:c,onChange:e=>u(e)}),(0,Z.tZ)(ln,{label:m("Reason"),value:p,onChange:e=>h(e)})]})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:w,loading:f.isLoading,disabled:!C||0===b.length,children:m("Add")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"tertiary",onClick:i,children:m("Cancel")})})]})}function v2(e){return{labels:(0,A.Ye)(()=>v4(e),[e])}}let v4=e=>{var t;if(!e)return[];let i=[];for(let t of e.labels)i.push((0,_._)((0,f._)({},t),{corrected:!1,isBot:!0}));for(let n of null!==(t=e.corrected_labels)&&void 0!==t?t:[]){for(let e of i)e.name===n.name&&(e.corrected=!0);i.push((0,_._)((0,f._)({},n),{corrected:!1,isBot:!1}))}return i};var v3=i(5149);let v8=(e,t)=>{var i,n;return t&&"membership_state"in t&&(null==t?void 0:t.membership_state)&&t.email?(0,Z.tZ)("a",{target:"_blank",href:(0,j.pN7)(e,t.email),rel:"noopener",children:null!==(i=t.name)&&void 0!==i?i:t.email}):null!==(n=null==t?void 0:t.name)&&void 0!==n?n:"User"},v6=e=>{let{pub:t,user:i,fallback:n}=e;return(0,Z.tZ)(Z.HY,{children:v8(t,i)||n||null})},v5=e=>{let{pub:t,reports:i,isOpen:n,close:r}=e,{iString:o,iPlural:a}=(0,Q.M1)();return(0,Z.BX)(eK.u_,{isOpen:n,className:"report-reasons-modal",onClose:r,children:[(0,Z.tZ)(eK.xB,{showClose:!1,title:a("Report reason","Report reasons",i.length)}),(0,Z.tZ)(eK.fe,{children:(0,Z.tZ)(et.tu,{gap:24,children:i.map(e=>{var i;let n;switch(null===(i=e.reportingUser)||void 0===i?void 0:i.membership_state){case"free_signup":n=(0,Z.BX)(Z.HY,{children:[o("Subscriber")," ",(0,Z.tZ)(v6,{pub:t,user:e.reportingUser})," ",o("provided the following reason for their report:")]});break;case"subscribed":n=(0,Z.BX)(Z.HY,{children:[o("Paid subscriber")," ",(0,Z.tZ)(v6,{pub:t,user:e.reportingUser})," ",o("provided the following reason for their report:")]});break;case"unsubscribed":n=(0,Z.BX)(Z.HY,{children:[o("Former subscriber")," ",(0,Z.tZ)(v6,{pub:t,user:e.reportingUser})," ",o("provided the following reason for their report:")]});break;default:n=(0,Z.BX)(Z.HY,{children:[o("Non-subscribed user")," ",e.reportingUser&&(0,Z.tZ)(v6,{pub:t,user:e.reportingUser})," ",o("provided the following reason for their report:")]})}return(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.tZ)(ei.xv.B3,{children:n}),(0,Z.BX)(ei.xv.B3,{color:"secondary",fontStyle:"italic",border:"detail",radius:"sm",padding:12,children:['"',e.reason,'"']})]},e.reporting_user_id)})})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{onClick:r,children:o("Done")})})]})},v9=(e,t)=>{let{iString:i}=(0,Q.M1)();return t&&t.id!==e.id?t.name:i("You")},v7=e=>{let{children:t,hidden:i}=e;return(0,Z.tZ)(ts.xu,{border:"detail",radius:"sm",className:k()({"hidden-a3riRD":i}),children:t})},be=e=>{let{children:t}=e;return(0,Z.tZ)(et.tu,{gap:8,paddingBottom:24,className:"contentDetailsWrapper-Xn_uFU",children:t})},bt=(0,w.createContext)(()=>void 0);function bi(e){let{children:t,pub:i}=e,[n,r]=(0,A.eJ)(null);return(0,Z.BX)(bt.Provider,{value:r,children:[t,(0,Z.tZ)(v5,{pub:i,reports:n?n.reports:[],isOpen:!!n,close:()=>r(null)})]})}function bn(){return(0,Z.tZ)(ee.hU,{priority:"secondary",onClick:()=>window.history.back(),children:(0,Z.tZ)(eF.Z,{size:20})})}function br(e){let{flagged:t}=e;return t?(0,Z.tZ)(v3.Z,{style:{stroke:"var(--color-accent-fg-red)"},size:16}):(0,Z.tZ)(s1.Z,{style:{stroke:"var(--color-accent-fg-green)"},size:16})}let bo={header:"header-vPy2jq",seeReasonLink:"seeReasonLink-J3nwM0",userLink:"userLink-HFdFvj"},ba=e=>{var t,i;let{pub:n,user:r,comment:o,linkToThread:a=!1}=e,{iString:l,language:s}=(0,Q.M1)();return(0,Z.BX)(et.gq,{gap:12,overflow:"auto",children:[r&&(0,Z.tZ)(ug.fi,{pub:n,photo_url:r.photo_url,email:null!==(t=r.email)&&void 0!==t?t:void 0,banned:r.banned,size:32}),(0,Z.BX)(be,{children:[(0,Z.BX)(et.gq,{alignItems:"center",children:[r?(0,Z.BX)(ei.xv.B4,{weight:"semibold",className:bo.userLink,children:[v8(n,r)," ",r.banned?l("(Banned)"):null]}):(0,Z.tZ)(ei.xv.B4,{children:l("(Deleted user)")}),(0,Z.tZ)(ei.xv.B4,{weight:"semibold",paddingLeft:12,color:"secondary",children:(0,H.Z)(o.date).standardDateOrTime()}),o.edited_at&&(0,Z.BX)(et.gq,{gap:4,paddingX:4,children:[(0,Z.tZ)(ei.xv.B4,{fontStyle:"italic",color:"secondary",children:"\xb7"}),(0,Z.BX)(ei.xv.B4,{fontStyle:"italic",color:"secondary",children:[l("edited")," ",(0,H.Z)(o.edited_at).locale(s).standardDateOrTime()]})]}),a&&"post"in o&&(0,Z.tZ)(vG,{url:(0,j.Wnz)(n,null!==(i=o.post)&&void 0!==i?i:null,o,{})})]}),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"p";return(e||"").split("\n").filter(e=>e.trim()).map(e=>(0,Z.tZ)(t,{children:(0,Z.tZ)(vF(),{options:{validate:{url:e=>!!e&&!e.startsWith("/")},attributes:{rel:"nofollow ugc noopener"}},children:e})}))}(o.body,ei.xv.B3)]})]})},bl=e=>{let{pub:t,reportedComment:i,headerDetails:n,actions:r,moderationPolicyDecision:o,moderationPolicy:a,onUpdateDecisionTags:l}=e,{iString:s}=(0,Q.M1)(),d=(0,A.qp)(bt),c=i.reports.length>0,{getConfigFor:u}=(0,io.xR)(),p=!!u("pub_auto_moderation_enabled");return(0,Z.BX)(v7,{hidden:i.hidden,children:[(0,Z.BX)(et.gq,{paddingX:16,paddingY:4,alignItems:"center",justifyContent:"space-between",className:bo.header,children:[n,c&&(0,Z.tZ)(ee.zx,{priority:"tertiary",className:bo.seeReasonLink,onClick:()=>d({reports:i.reports}),children:s("See report reasons")})]}),(0,Z.BX)(ts.xu,{overflow:"auto",padding:16,children:[p&&(0,Z.tZ)(v$,{decision:o,pubId:t.id,commentId:i.id,policy:a,onSave:l}),(0,Z.tZ)(ba,{pub:t,user:i.user,comment:i}),r]})]})};function bs(e){let{decisions:t,pubId:i,label:n,policy:r,onSave:o,pub:a,onAddExample:l}=e,{iString:s}=(0,Q.M1)(),d=(0,A.Ye)(()=>new Set(n.examples.map(e=>e.decision_id).filter(Boolean)),[n]),c=(0,A.Ye)(()=>t.filter(e=>{var t;return!d.has(e.id)&&(e.labels.some(e=>e.name===n.name)||(null===(t=e.corrected_labels)||void 0===t?void 0:t.some(e=>e.name===n.name)))}),[t,n,d]),[u,p]=(0,A.eJ)({pageIndex:0,pageSize:5}),[h,m]=(0,A.eJ)([{id:"corrected_labels",desc:!1},{id:"created_at",desc:!0}]),g=(0,vA.b7)({data:c,columns:[{header:"Date",accessorKey:"created_at"},{header:"Has Corrections",accessorKey:"corrected_labels",cell:e=>{var t;let{row:i}=e;return(null===(t=i.original.corrected_labels)||void 0===t?void 0:t.length)?"Yes":"No"}}],getCoreRowModel:(0,vD.sC)(),getSortedRowModel:(0,vD.tj)(),getPaginationRowModel:(0,vD.G_)(),onPaginationChange:p,state:{sorting:h,pagination:u}}),v=g.getRowModel().rows,b=(0,A.Ye)(()=>v.map(e=>e.original.comment_id.toString()).join(","),[v]),y=(0,iS.ib)({pathname:"/api/v1/moderation/publications/".concat(i,"/comments/details"),query:{comment_ids:b},deps:[b],auto:!!b}),w=(0,A.Ye)(()=>{var e,t;return new Map(null!==(t=null===(e=y.result)||void 0===e?void 0:e.comments.map(e=>[e.id.toString(),e]))&&void 0!==t?t:[])},[y.result]),C=(0,A.I4)((e,t)=>{var i;let r=v4(e).find(e=>e.name===n.name&&!e.corrected);if(!r)return;let o={body:null!==(i=t.body)&&void 0!==i?i:"",severity:r.severity,category:r.reason,decision_id:e.id};l((0,_._)((0,f._)({},n),{examples:[...n.examples,o]}))},[n,l]);return 0===v.length?(0,Z.tZ)(ei.xv.B4,{color:"secondary",textAlign:"center",paddingY:16,children:s("No recent decisions found with this label.")}):(0,Z.BX)(et.sg,{gap:16,children:[g.getRowModel().rows.map(e=>{let t=e.original,n=w.get(t.comment_id.toString());return n?(0,Z.BX)(et.sg,{gap:8,border:"detail",radius:"sm",children:[(0,Z.BX)(et.X2,{padding:8,gap:8,justifyContent:"space-between",alignItems:"center",bg:"secondary",borderBottom:"detail",children:[n.post&&(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",children:(0,Z.tZ)("a",{title:s("View thread"),href:(0,j.uRy)(a,n.post),children:n.post.title})}),(0,Z.tZ)(et.X2,{gap:8,alignItems:"center",children:(0,Z.tZ)(ee.zx,{priority:"tertiary",onClick:()=>C(t,n),children:s("Add Example")})})]}),(0,Z.BX)(et.sg,{paddingX:8,children:[(0,Z.tZ)(v$,{decision:t,pubId:i,onSave:o,policy:r,commentId:t.comment_id}),(0,Z.tZ)(ba,{pub:a,user:n.user,comment:n})]})]},t.id):null}),(0,Z.tZ)(et.X2,{gap:12,alignItems:"center",children:(0,Z.BX)(nK.tl,{children:[(0,Z.BX)(et.X2,{gap:4,children:[(0,Z.tZ)(nK.Gt,{onClick:()=>g.setPageIndex(0),disabled:!g.getCanPreviousPage()}),(0,Z.tZ)(nK.FS,{onClick:()=>g.previousPage(),disabled:!g.getCanPreviousPage()})]}),(0,Z.tZ)(nK.bp,{currentPage:g.getState().pagination.pageIndex+1,totalPages:g.getPageCount()}),(0,Z.BX)(et.X2,{gap:4,children:[(0,Z.tZ)(nK.$W,{onClick:()=>g.nextPage(),disabled:!g.getCanNextPage()}),(0,Z.tZ)(nK.kt,{onClick:()=>g.lastPage(),disabled:!g.getCanNextPage()})]})]})})]})}function bd(e){let{onSave:t,onCancel:i,disabled:n=!1}=e,{iString:r}=(0,Q.M1)();return(0,Z.BX)(et.X2,{justifyContent:"end",gap:8,children:[(0,Z.tZ)(ee.zx,{priority:"tertiary",onClick:i,children:r("Cancel")}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:t,disabled:n,children:r("Confirm")})]})}function bc(e){let{label:t,onUpdate:i,onCancel:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(t.name),[l,s]=(0,A.eJ)(t.description),d=(0,A.sO)(null),c=(0,A.Ye)(()=>vP((0,_._)((0,f._)({},t),{name:o,description:l})),[t,o,l]),u=(0,A.Ye)(()=>o!==t.name||l!==t.description,[o,l,t]);(0,A.d4)(()=>{a(t.name),s(t.description)},[t]),(0,A.d4)(()=>{setTimeout(()=>{d.current&&d.current.focus()},0)},[]);let p=e=>{var t;return null===(t=c.errors.find(t=>t.field===e))||void 0===t?void 0:t.message};return(0,Z.BX)(et.sg,{gap:8,padding:8,children:[(0,Z.tZ)(ij.n,{label:r("Name"),value:o,onChange:e=>a(e),width:480,inputRef:d}),p("name")&&(0,Z.tZ)(ei.xv.B4,{color:"error",children:p("name")}),(0,Z.tZ)(ln,{label:r("Description"),value:l,onChange:e=>s(e)}),p("description")&&(0,Z.tZ)(ei.xv.B4,{color:"error",children:p("description")}),(0,Z.tZ)(bd,{onSave:()=>i((0,_._)((0,f._)({},t),{name:o,description:l})),onCancel:n,disabled:!c.isValid||!u})]})}function bu(e){let{examples:t,setEditingExample:i,onDelete:n}=e,{iString:r}=(0,Q.M1)();return 0===t.length?(0,Z.tZ)(ei.xv.B4,{color:"secondary",paddingY:16,textAlign:"center",children:r("No examples yet. Add one using the button above.")}):(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{children:[(0,Z.tZ)(gK,{children:r("Severity")}),(0,Z.tZ)(gK,{children:r("Reason")}),(0,Z.tZ)(gK,{children:r("Example Comment")}),(0,Z.tZ)(gK,{})]})}),(0,Z.tZ)(gq,{children:t.map((e,t)=>(0,Z.BX)(gG,{children:[(0,Z.tZ)(gQ,{children:(0,Z.tZ)(d_.Vp,{priority:"secondary",theme:"high"===e.severity?"error":"low"===e.severity?"warn":"success",children:e.severity})}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.xv.B4,{fontWeight:"light",children:e.category})}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.xv.B4,{fontWeight:"light",children:e.body||r("(No example text)")})}),(0,Z.tZ)(gQ,{children:(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{title:"edit",priority:"tertiary",children:(0,Z.tZ)(pu.Z,{size:20})}),children:[(0,Z.tZ)(tC.sN,{onClick:()=>i(e),children:r("Edit")}),(0,Z.tZ)(tC.xw,{children:(0,Z.tZ)(tC.sN,{priority:"destructive",onClick:()=>n(e),children:r("Delete")})})]})})]},"example-".concat(t)))})]})})}function bp(e){let{title:t,actionButton:i}=e;return(0,Z.BX)(et.X2,{borderBottom:"detail",gap:8,padding:8,justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(ei.xv.B3,{fontWeight:"bold",translated:"string"!=typeof t,children:I18N.p(t)}),i]})}function bh(e){let{label:t,labelId:i,onUpdate:n,editingExample:r,setEditingExample:o}=e,{iString:a}=(0,Q.M1)(),l=(0,A.I4)((e,r)=>{let o=t.examples.map((t,i)=>i===r?e:t);n((0,_._)((0,f._)({},t),{examples:o}),i)},[t,n,i]),s=-1===t.examples.findIndex(e=>e===r);return(0,Z.BX)(et.sg,{gap:16,children:[null!==r&&(0,Z.BX)(et.sg,{gap:8,paddingY:8,border:"detail",radius:"sm",padding:16,style:{marginBottom:"16px"},children:[(0,Z.tZ)(bp,{title:a(s?"Add Example":"Edit Example"),actionButton:null}),(0,Z.tZ)(bm,{example:r,onSave:e=>{let a=t.examples.findIndex(e=>e===r);s?n((0,_._)((0,f._)({},t),{examples:[...t.examples,e]}),i):l(e,a),o(null)},onCancel:()=>o(null)})]}),null===r&&(0,Z.tZ)(bu,{examples:t.examples,setEditingExample:o,onDelete:e=>{n((0,_._)((0,f._)({},t),{examples:t.examples.filter(t=>t!==e)}),i)}})]})}function bm(e){let{example:t,onSave:i,onCancel:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(t.severity),[l,s]=(0,A.eJ)(t.category),[d,c]=(0,A.eJ)(t.body),u=(0,A.sO)(null),p=(0,A.Ye)(()=>vE({severity:o,category:l,body:d}),[o,l,d]),h=(0,A.Ye)(()=>o!==t.severity||l!==t.category||d!==t.body,[o,l,d,t]);(0,A.d4)(()=>{a(t.severity),s(t.category),c(t.body)},[t]),(0,A.d4)(()=>{u.current&&u.current.focus()},[]);let m=e=>{var t;return null===(t=p.errors.find(t=>t.field===e))||void 0===t?void 0:t.message};return(0,Z.BX)(et.sg,{gap:8,padding:8,children:[(0,Z.BX)(et.X2,{gap:8,children:[(0,Z.BX)(et.sg,{width:100,children:[(0,Z.tZ)(iT.m,{label:r("Severity"),value:o,options:[{label:r("None"),value:"none"},{label:r("Low"),value:"low"},{label:r("High"),value:"high"}],onChange:e=>a(e)}),m("severity")&&(0,Z.tZ)(ei.xv.B4,{color:"error",children:m("severity")})]}),(0,Z.BX)(et.sg,{flex:"grow",children:[(0,Z.tZ)(ij.n,{label:r("Reason"),value:l,onChange:e=>s(e),inputRef:u}),m("category")&&(0,Z.tZ)(ei.xv.B4,{color:"error",children:m("category")})]})]}),(0,Z.tZ)(ln,{label:r("Example Comment"),value:d,onChange:e=>c(e)}),(0,Z.tZ)(bd,{onSave:()=>i({body:d,severity:o,category:l}),onCancel:n,disabled:!p.isValid||!h})]})}function bg(e){let{labels:t,expandedLabelId:i,setExpandedLabelId:n,setEditingLabel:r,setPendingLabel:o,onDeleteLabel:a}=e,{iString:l}=(0,Q.M1)(),s=e=>{n(i===e?null:e),o(null)};return(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{children:[(0,Z.tZ)(gK,{children:l("Name")}),(0,Z.tZ)(gK,{children:l("Description")}),(0,Z.tZ)(gK,{}),(0,Z.tZ)(gK,{})]})}),(0,Z.BX)(gq,{children:[t.map((e,t)=>(0,Z.BX)(gG,{onClick:()=>s(t),cursor:"pointer","data-state":i===t?"selected":"unselected",children:[(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.xv.B3,{fontWeight:"bold",padding:4,children:e.name})}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.xv.B4,{fontWeight:"light",children:e.description})}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ee.zx,{priority:"quaternary",onClick:e=>{e.stopPropagation(),s(t)},color:"secondary",fontSize:12,children:l("".concat(e.examples.length," examples"))})}),(0,Z.tZ)(gQ,{children:(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{title:"edit",priority:"tertiary",children:(0,Z.tZ)(pu.Z,{size:20})}),children:[(0,Z.tZ)(tC.sN,{onClick:t=>{t.stopPropagation(),r(e),o(null)},children:l("Edit")}),(0,Z.tZ)(tC.xw,{children:(0,Z.tZ)(tC.sN,{priority:"destructive",onClick:t=>{t.stopPropagation(),a(e)},children:l("Delete")})})]})})]},"label-".concat(t))),0===t.length&&(0,Z.tZ)(gG,{children:(0,Z.tZ)(gQ,{colSpan:4,children:(0,Z.tZ)(ei.xv.B4,{color:"secondary",textAlign:"center",paddingY:16,children:l("No labels yet. Add one to get started.")})})})]})]})})}var bv=i(64300);function bb(e){let{rolePrompt:t,onUpdate:i,error:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(!1),[l,s]=(0,A.eJ)(t),[d,c]=(0,A.eJ)(void 0),u=(0,A.sO)(null),p=(0,A.Ye)(()=>l!==t,[l,t]);(0,A.d4)(()=>{o&&(s(t),c(void 0),setTimeout(()=>{u.current&&u.current.focus()},0))},[o,t]);let h=e=>{var t;s(e);let i=vN(e);c(i.errors.length>0?null===(t=i.errors[0])||void 0===t?void 0:t.message:void 0)},m=!d;return(0,Z.BX)(et.sg,{gap:8,paddingY:8,radius:"sm",children:[(0,Z.tZ)(bp,{title:r("Role Prompt"),actionButton:o?null:(0,Z.tZ)(ee.hU,{title:"edit",priority:"tertiary",onClick:()=>a(!0),children:(0,Z.tZ)(nX.Z,{size:16})})}),o?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(bv.g,{value:l,onChange:e=>{e&&e.target&&h(e.target.value)},ref:u}),d&&(0,Z.tZ)(ei.xv.B4,{color:"error",paddingX:8,children:d}),(0,Z.BX)(et.X2,{justifyContent:"end",alignItems:"center",gap:8,children:[(0,Z.tZ)(ee.zx,{priority:"tertiary",onClick:()=>a(!1),children:r("Cancel")}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{i(l),a(!1)},disabled:!m||!p,children:r("Confirm")})]})]}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.B4,{paddingX:8,fontWeight:"light",children:t}),n&&(0,Z.tZ)(ei.xv.B4,{color:"error",paddingX:8,children:n})]})]})}function by(e){let{selectedPolicy:t,selectedVersion:i,onUpdatePolicy:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(i.policy),[l,s]=(0,A.eJ)(!1),[d,c]=(0,A.eJ)(""),[u,p]=(0,A.eJ)(!1),h=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(t.publication_id,"/policies/").concat(t.id,"/versions"),method:"POST",json:{policy:o,commit_message:d}});(0,A.d4)(()=>{a(i.policy)},[i]);let m=(0,A.I4)(async()=>{let e=await h.refetch();!(e instanceof Error)&&(await n({selectedVersion:e}),p(!1),c(""))},[h,n]);return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(ei.xv.B3,{fontWeight:"semibold",children:[t.name," ","v".concat(i.version)]}),(0,Z.tZ)(et.sg,{gap:16,children:u?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(li.g,{value:o,onChange:e=>a(e.target.value),rows:15,autoFocus:!0}),(0,Z.tZ)(li.g,{placeholder:r("Enter a commit message..."),value:d,onChange:e=>c(e.target.value)}),(0,Z.BX)(et.X2,{gap:16,justifyContent:"end",children:[(0,Z.tZ)(ee.zx,{priority:"primary",disabled:!d||h.isLoading,onClick:m,children:r("Save as new version")}),(0,Z.tZ)(ee.zx,{priority:"secondary",disabled:h.isLoading,onClick:async()=>{p(!1),c("")},children:r("Cancel")})]})]}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(et.sg,{gap:16,padding:16,border:"detail",shadow:"md",radius:"sm",children:(0,Z.tZ)(ei.xv.B4,{height:l?void 0:100,overflow:"hidden",style:{whiteSpace:"pre-wrap"},children:o})}),(0,Z.BX)(et.X2,{gap:16,justifyContent:"end",children:[l?(0,Z.tZ)(ee.zx,{priority:"quaternary",onClick:()=>s(!1),children:r("Collapse")}):(0,Z.tZ)(ee.zx,{priority:"quaternary",onClick:()=>s(!0),children:r("Expand")}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:async()=>{p(!0)},children:r("Edit")}),"active"!==i.status&&(0,Z.tZ)(ee.zx,{priority:"secondary-accent",onClick:async()=>{await n({selectedVersion:i,activate:!0})},children:r("Activate")})]})]})})]})}function bf(){let e=(0,G._)(["Recent Decisions - ",""]);return bf=function(){return e},e}function b_(e){var t,i,n;let{selectedPolicy:r,selectedVersion:o,onUpdatePolicy:a,pub:l}=e,{iString:s,iTemplate:d}=(0,Q.M1)(),{policy:c,frontmatter:u}=(0,A.Ye)(()=>vT(o.policy),[o]),p=(0,A.Ye)(()=>{let e="".concat(r.name," v").concat(o.version),t=o.commit_message?" - ".concat(o.commit_message):"";return"".concat(e).concat(t)},[r.name,o.version,o.commit_message]),[h,m]=(0,A.eJ)(c),[g,v]=(0,A.eJ)(u),[b,y]=(0,A.eJ)(null),[w,C]=(0,A.eJ)(null),[x,S]=(0,A.eJ)(null),[k,B]=(0,A.eJ)(null),T=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(r.publication_id,"/decisions"),query:{limit:100},initialResult:{decisions:[]},deps:[r.publication_id],auto:!!r.publication_id}),I=(0,A.Ye)(()=>vX(h),[h]);(0,A.d4)(()=>{m(c),v(u)},[c,u]);let N=(0,A.I4)(e=>{m(e)},[]),P=(0,A.I4)((e,t)=>{N((0,_._)((0,f._)({},h),{labels:h.labels.map((i,n)=>n===t?e:i)}))},[h,N]),E=(0,A.I4)(()=>{m(vM),v({substack_policy_version:"1.0"})},[m,v]),X=(0,A.I4)(()=>{C({name:"",description:"",examples:[]}),S(null)},[C,S]),M=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(r.publication_id,"/policies/").concat(r.id,"/versions"),method:"POST"}),D=(0,A.Ye)(()=>vI({policy:h,frontmatter:g}),[g,h]),R=(0,A.Ye)(()=>D!==o.policy,[D,o.policy]),F=(0,A.I4)(async()=>{if(!I.isValid||!R)return;let e=await M.refetch({json:{policy:D,commit_message:"Update: ".concat((0,H.Z)().format("YYYY-MM-DD HH:mm:ss"))}});!(e instanceof Error)&&a({selectedVersion:e})},[R,D,a,M,I.isValid]);if("0.0"===g.substack_policy_version)return(0,Z.BX)(et.sg,{gap:8,children:[(0,Z.tZ)(et.X2,{justifyContent:"end",children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:E,children:s("Convert to Structured Prompt")})}),(0,Z.tZ)(by,{selectedPolicy:r,selectedVersion:o,onUpdatePolicy:a})]});let L=null!==x?h.labels[x]:null;return(0,Z.BX)(et.sg,{gap:16,children:[(0,Z.tZ)(et.X2,{paddingBottom:8,children:(0,Z.tZ)(ei.xv.H3,{fontWeight:"bold",children:p})}),(0,Z.tZ)(bb,{rolePrompt:h.role_prompt,onUpdate:e=>N((0,_._)((0,f._)({},h),{role_prompt:e})),error:null===(t=I.errors.find(e=>"role_prompt"===e.field))||void 0===t?void 0:t.message}),(0,Z.tZ)(bZ,{hasChanges:R,onSave:F,onActivate:()=>a({selectedVersion:o,activate:!0}),validation:I,selectedVersion:o,editingLabel:b,pendingLabel:w,editingExample:k}),(0,Z.BX)(et.sg,{gap:8,paddingY:8,children:[(0,Z.tZ)(bp,{title:s("Labels"),actionButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:X,disabled:h.labels.length>=10||null!==w||null!==b,children:s("Add Label")})}),null===w&&null===b&&(0,Z.tZ)(bg,{labels:h.labels,expandedLabelId:x,setExpandedLabelId:e=>{S(e)},setEditingLabel:y,setPendingLabel:C,onDeleteLabel:e=>{N((0,_._)((0,f._)({},h),{labels:h.labels.filter(t=>t!==e)})),y(null),C(null)}})]}),null!==b&&(0,Z.BX)(et.sg,{gap:8,paddingY:8,border:"detail",radius:"sm",padding:16,children:[(0,Z.tZ)(bp,{title:s("Edit Label"),actionButton:null}),(0,Z.tZ)(bc,{label:b,onUpdate:e=>{let t=h.labels.findIndex(e=>e===b);-1!==t&&P(e,t),y(null)},onCancel:()=>y(null)})]}),null!==w&&(0,Z.BX)(et.sg,{gap:8,paddingY:8,border:"detail",radius:"sm",padding:16,children:[(0,Z.tZ)(bp,{title:s("Add Label"),actionButton:null}),(0,Z.tZ)(bc,{label:w,onUpdate:e=>{N((0,_._)((0,f._)({},h),{labels:[...h.labels,e]})),C(null)},onCancel:()=>C(null)})]}),null!==x&&L&&!b&&!w&&(0,Z.BX)(et.sg,{gap:8,children:[(0,Z.tZ)(bp,{title:"".concat(L.name," Examples"),actionButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{B({body:"",severity:"high",category:""})},disabled:L.examples.length>=10||null!==k,children:s("Add Example")})}),(0,Z.tZ)(bh,{label:L,labelId:x,onUpdate:P,editingExample:k,setEditingExample:B}),(0,Z.BX)(et.sg,{gap:8,paddingTop:16,children:[(0,Z.tZ)(bp,{title:d(bf(),L.name),actionButton:null}),(0,Z.tZ)(bs,{decisions:null!==(n=null===(i=T.result)||void 0===i?void 0:i.decisions)&&void 0!==n?n:[],pubId:r.publication_id,label:L,policy:r,onSave:()=>T.refetch(),onAddExample:e=>{P(e,x)},pub:l})]}),(0,Z.tZ)(bZ,{hasChanges:R,onSave:F,onActivate:()=>a({selectedVersion:o,activate:!0}),validation:I,selectedVersion:o,pendingLabel:w,editingLabel:b,editingExample:k})]})]})}function bZ(e){let{hasChanges:t,onSave:i,onActivate:n,validation:r,selectedVersion:o,editingLabel:a,pendingLabel:l,editingExample:s}=e,{iString:d}=(0,Q.M1)();return(0,Z.BX)(et.X2,{gap:16,alignItems:"center",children:[t&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(oU.b,{title:d("You have unsaved changes"),theme:"warn",priority:"secondary",Icon:eN.Z,showClose:!1}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:i,disabled:!r.isValid||!t||null!==a||null!==l||null!==s,children:d("Save")})]}),!t&&"active"!==o.status&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(oU.b,{title:d("This is not the active version"),theme:"warn",priority:"secondary",Icon:eR.Z,showClose:!1}),(0,Z.tZ)(ee.zx,{priority:"secondary-accent",onClick:n,children:d("Activate")})]})]})}var bw=i(53095);function bC(){let e=(0,G._)(["Run Test against v",""]);return bC=function(){return e},e}function bx(){let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{children:[(0,Z.tZ)(gK,{children:e("Name")}),(0,Z.tZ)(gK,{children:e("Examples")}),(0,Z.tZ)(gK,{children:e("Created By")}),(0,Z.tZ)(gK,{children:e("Created At")}),(0,Z.tZ)(gK,{})]})})}function bS(e){var t;let{eval_:i,evalsRequest:n,selectedPolicy:r,selectedVersion:o}=e,{iString:a,iTemplate:l}=(0,Q.M1)(),s=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(i.publication_id,"/policies/").concat(i.policy_id,"/evals/").concat(i.id),method:"DELETE"}),d=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(i.publication_id,"/policies/").concat(i.policy_id,"/evals/").concat(i.id,"/runs"),method:"POST",json:{policy_version:null==o?void 0:o.version}});return(0,Z.BX)(gG,{children:[(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ee.zx,{priority:"tertiary",onClick:()=>(0,Y.uX)("/publish/moderation/policies/".concat(null==r?void 0:r.id,"/evals/").concat(i.id)),children:i.name})}),(0,Z.tZ)(gQ,{children:i.examples.length}),(0,Z.tZ)(gQ,{children:i.created_by}),(0,Z.tZ)(gQ,{children:(0,H.Z)(i.created_at).standardDatetimeWithYear()}),(0,Z.tZ)(gQ,{children:(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{priority:"tertiary",size:"sm",children:(0,Z.tZ)(pu.Z,{size:20})}),children:[(0,Z.tZ)(tC.sN,{href:"/publish/moderation/policies/".concat(null==r?void 0:r.id,"/evals/").concat(i.id),children:a("View Details")}),(0,Z.tZ)(tC.sN,{onClick:async()=>{await d.refetch(),(0,Y.uX)("/publish/moderation/policies/".concat(null==r?void 0:r.id,"/evals/").concat(i.id))},disabled:!r,children:l(bC(),null!==(t=null==o?void 0:o.version)&&void 0!==t?t:"0")}),(0,Z.tZ)(tC.xw,{children:(0,Z.tZ)(tC.sN,{priority:"destructive",onClick:async()=>{await s.refetch(),await n.refetch()},children:a("Delete")})})]})})]})}function bk(e){var t,i;let{pub:n,selectedPolicy:r,selectedVersion:o}=e,{iString:a}=(0,Q.M1)(),l=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(n.id,"/policies/").concat(null==r?void 0:r.id,"/evals"),method:"POST"}),s=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(n.id,"/policies/").concat(null==r?void 0:r.id,"/evals"),auto:!!r}),d=async()=>{if(!r){window.alert(a("Please select a policy first"));return}try{let e=await l.refetch({json:{name:"Test ".concat(c.length+1)}});if(e instanceof Error){window.alert(a("Failed to create test"));return}(0,Y.uX)("/publish/moderation/policies/".concat(null==r?void 0:r.id,"/evals/").concat(e.id))}catch(e){window.alert(a("Failed to create test"))}},c=null!==(i=null===(t=s.result)||void 0===t?void 0:t.evals)&&void 0!==i?i:[];return 0===c.length?(0,Z.BX)(et.sg,{gap:8,alignItems:"center",padding:32,children:[(0,Z.tZ)(bw.Z,{size:24}),(0,Z.tZ)(ei.xv.H4,{children:a("No tests yet")}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:a("Create a test to evaluate policies against example comments")}),(0,Z.tZ)(et.X2,{justifyContent:"end",children:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:d,leading:(0,Z.tZ)(bw.Z,{size:20}),disabled:!r,children:a("Create Test")})})]}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(bx,{}),(0,Z.tZ)(gq,{children:c.map(e=>(0,Z.tZ)(bS,{eval_:e,evalsRequest:s,selectedPolicy:r,selectedVersion:o},e.id))})]})}),(0,Z.tZ)(et.X2,{justifyContent:"end",children:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:d,leading:(0,Z.tZ)(bw.Z,{size:20}),disabled:!r,children:a("Create Test")})})]})}function bB(){let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{children:[(0,Z.tZ)(gK,{children:e("Version")}),(0,Z.tZ)(gK,{children:e("Commit Message")}),(0,Z.tZ)(gK,{children:e("Created By")}),(0,Z.tZ)(gK,{children:e("Created At")}),(0,Z.tZ)(gK,{children:e("Status")}),(0,Z.tZ)(gK,{})]})})}function bT(e){let{policy:t,version:i,isSelected:n,refetchPolicies:r,onSelect:o}=e,{iString:a}=(0,Q.M1)(),l="active"===i.status,s=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(t.publication_id,"/policies/").concat(t.id,"/versions/").concat(i.version),method:"PUT",json:{status:l?"inactive":"active"}}),d=async()=>{let e=l?a("Deactivate this version?"):a("Activate this version?");window.confirm(e)&&(await s.refetch(),await r())};return(0,Z.BX)(gG,{onClick:o,cursor:"pointer","data-state":n?"selected":"unselected",children:[(0,Z.tZ)(gQ,{children:i.version}),(0,Z.tZ)(gQ,{children:i.commit_message}),(0,Z.tZ)(gQ,{children:i.created_by}),(0,Z.tZ)(gQ,{children:(0,H.Z)(i.created_at).standardDatetimeWithYear()}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(tW.u,{text:l?a("Click to deactivate this version"):a("Click to activate this version"),children:(0,Z.tZ)(ee.hU,{onClick:d,priority:"tertiary",children:l?(0,Z.tZ)(i$.Z,{}):(0,Z.tZ)(iQ.Z,{})})})}),(0,Z.tZ)(gQ,{})]})}function bI(e){let{policy:t,versions:i,selectedVersionId:n,setSelectedVersionId:r,refetchPolicies:o}=e;return(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(bB,{}),(0,Z.tZ)(gq,{children:i.map(e=>(0,Z.tZ)(bT,{policy:t,version:e,isSelected:e.id===n,onSelect:()=>r(e.id),refetchPolicies:o},e.id))})]})})}function bN(e){var t,i,n;let{pub:r}=e,{iString:o}=(0,Q.M1)(),a=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(r.id,"/policies"),auto:!0}),[l,s]=(0,A.eJ)(null),[d,c]=(0,A.eJ)(null),u=(0,A.Ye)(()=>{var e,t;return null!==(t=null===(e=a.result)||void 0===e?void 0:e.policies)&&void 0!==t?t:[]},[a.result]),p=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(r.id,"/policies"),method:"POST"}),h=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(r.id,"/policies/").concat(l,"/versions/").concat(d),method:"PUT"}),m=null!==(i=null===(t=a.result)||void 0===t?void 0:t.policies.find(e=>e.id===l))&&void 0!==i?i:null,g=(0,A.Ye)(()=>{var e;return null!==(e=null==m?void 0:m.versions)&&void 0!==e?e:[]},[m]),v=null!==(n=null==g?void 0:g.find(e=>e.id===d))&&void 0!==n?n:null,b=(0,A.I4)(async e=>{var t,i;let n=null!==(t=u.find(t=>t.id===e))&&void 0!==t?t:null;if(!n){s(null),c(null);return}s(e);try{let e=n.versions.find(e=>"active"===e.status)||n.versions[0];c(null!==(i=null==e?void 0:e.id)&&void 0!==i?i:null)}catch(e){s(null),c(null)}},[u]);(0,A.d4)(()=>{let e=u[0];e&&!l&&b(e.id)},[u,l,b]);let y=async()=>{await p.refetch(),await a.refetch()},f=async e=>{let{selectedVersion:t,activate:i}=e;i&&await h.refetch({pathname:"/api/v1/moderation/".concat(r.id,"/policies/").concat(l,"/versions/").concat(t.version),method:"PUT",json:{status:"active"}}),await a.refetch(),c(t.id)},_=g.find(e=>"active"===e.status),w=async(e,t)=>{var i;_&&null===t?await h.refetch({pathname:"/api/v1/moderation/".concat(r.id,"/policies/").concat(e,"/versions/").concat(_.version),method:"PUT",json:{status:"inactive"}}):t&&await h.refetch({pathname:"/api/v1/moderation/".concat(r.id,"/policies/").concat(e,"/versions/").concat(t),method:"PUT",json:{status:"active"}}),await a.refetch();let n=null===(i=g.find(e=>e.version===t))||void 0===i?void 0:i.id;n&&c(n)};return(0,Z.tZ)("div",{className:"container",children:(0,Z.BX)(et.sg,{paddingY:32,paddingX:16,gap:36,children:[(0,Z.tZ)(bn,{}),(0,Z.tZ)(ei.xv.H2,{children:o("Moderation Policies")}),u.length>0?(0,Z.BX)(Z.HY,{children:[!_&&(0,Z.tZ)(oU.b,{title:o("Automated comment moderation is disabled"),description:o("Activate a policy version below to start automating comment moderation."),theme:"substack",priority:"secondary",Icon:eN.Z,showClose:!1}),(0,Z.tZ)(vS,{policies:u,selectedPolicyId:l,setSelectedPolicyId:b,onToggleVersion:w})]}):(0,Z.tZ)(et.X2,{justifyContent:"center",children:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:y,children:o("Create a new moderation policy")})}),m&&(0,Z.BX)(Z.HY,{children:[v&&(0,Z.tZ)(b_,{selectedPolicy:m,selectedVersion:v,onUpdatePolicy:f,pub:r}),(0,Z.tZ)(ei.xv.H3,{children:o("Tests")}),(0,Z.tZ)(bk,{pub:r,selectedPolicy:m,selectedVersion:v}),g&&g.length>0&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.H3,{children:o("Version History")}),a.isLoading?(0,Z.tZ)(iI.$j,{}):(0,Z.tZ)(bI,{policy:m,versions:g,selectedVersionId:d,setSelectedVersionId:c,refetchPolicies:async()=>{await a.refetch()}})]})]})]})})}let bP=e=>{let{icon:t,text:i,loading:n,error:r}=e,{iString:o}=(0,Q.M1)();return(0,Z.BX)("div",{className:k()("empty-item",{loading:n}),children:[!r&&t,r?(0,Z.tZ)("span",{className:"error",children:r}):n?o("Loading..."):i]})},bE=e=>(0,Z.tZ)(eH.l,(0,_._)((0,f._)({},e),{name:"CommentIconRounded",svgParams:{height:19,width:19},version:3,children:(0,Z.tZ)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",strokeWidth:0,d:"M0.5 8.33117C0.5 4.00613 4.00613 0.5 8.33117 0.5H10.6688C14.9939 0.5 18.5 4.00613 18.5 8.33117C18.5 10.0221 18.0114 11.6205 16.9359 12.982C15.865 14.3378 14.2544 15.406 12.0948 16.1209L12.0783 16.1262L4.48087 18.4638C4.23271 18.5402 3.96303 18.4942 3.75417 18.3399C3.54532 18.1857 3.42208 17.9415 3.42208 17.6818V14.5319C2.71035 13.8391 2.0315 12.9268 1.50977 11.9389C0.92332 10.8285 0.5 9.55539 0.5 8.33117ZM8.33117 2.13636C4.90987 2.13636 2.13636 4.90987 2.13636 8.33117C2.13636 9.20153 2.44612 10.2079 2.95672 11.1747C3.46475 12.1366 4.13652 12.9925 4.78168 13.5619C4.95764 13.7172 5.05844 13.9406 5.05844 14.1753V16.574L11.5887 14.5647C13.5155 13.9256 14.8245 13.0151 15.6518 11.9677C16.4756 10.9248 16.8636 9.69376 16.8636 8.33117C16.8636 4.90987 14.0901 2.13636 10.6688 2.13636H8.33117Z"})}));var bX=i(93974),bM=i(3880);let bA=e=>{var t,i,n,r;let{pub:o,user:a,chatEntity:l}=e,{iString:s}=(0,Q.M1)();return(0,Z.BX)(et.gq,{gap:12,overflow:"auto",children:[a&&(0,Z.tZ)(ug.fi,{pub:o,photo_url:a.photo_url,email:null!==(i=a.email)&&void 0!==i?i:void 0,size:32}),(0,Z.BX)(be,{children:[(0,Z.tZ)(et.gq,{alignItems:"center",children:a?(0,Z.tZ)(ei.xv.B4,{weight:"semibold",className:bo.userLink,children:v8(o,a)}):(0,Z.tZ)(ei.xv.B4,{children:s("(Deleted user)")})}),"media_assets"in l&&l.media_assets&&(0,Z.tZ)(bM.E,{assets:null==l?void 0:l.media_assets.map(e=>e.url)}),"media_uploads"in l&&l.media_uploads&&(0,Z.tZ)(bM.E,{assets:null==l?void 0:l.media_uploads.map(e=>e.url)}),"link_url"in l&&l.link_url&&(0,Z.tZ)(bX.xk,{linkUrl:l.link_url,linkMetadata:"link_metadata"in l&&null!==(n=l.link_metadata)&&void 0!==n?n:void 0,postId:l.id}),"quote_id"in l&&l.quote_id&&l.quoteReply&&(0,Z.tZ)(bX.p6,{direction:"incoming",author:null!==(r=null===(t=l.quoteReply.user)||void 0===t?void 0:t.name)&&void 0!==r?r:"Substack User",body:l.quoteReply.raw_body}),(0,Z.tZ)(ei.xv.B3,{children:l.body})]})]})},bD=e=>{let{pub:t,chatEntity:i,headerDetails:n,actions:r}=e,{iString:o}=(0,Q.M1)(),a=i.reports.length>0,l=(0,A.qp)(bt);return(0,Z.BX)(v7,{hidden:i.hidden,children:[(0,Z.BX)(et.gq,{paddingX:16,paddingY:4,alignItems:"center",justifyContent:"space-between",className:bo.header,children:[n,a&&(0,Z.tZ)(ee.zx,{priority:"tertiary",className:bo.seeReasonLink,onClick:()=>l({reports:i.reports}),children:o("See report reasons")})]}),(0,Z.BX)(ts.xu,{overflow:"auto",padding:16,children:[(0,Z.tZ)(bA,{pub:t,user:i.user,chatEntity:i}),r]})]})};function bR(){let e=(0,G._)([""," approved this comment"]);return bR=function(){return e},e}function bF(){let e=(0,G._)(["Someone approved this comment"]);return bF=function(){return e},e}function bL(){let e=(0,G._)([""," approved this message"]);return bL=function(){return e},e}function bz(){let e=(0,G._)(["Someone approved this message"]);return bz=function(){return e},e}let bO=e=>{let{pub:t,user:i,reportedContent:n,moderationPolicyDecision:r,moderationPolicy:o,onUpdateDecisionTags:a}=e,{language:l,iTemplate:s}=(0,Q.M1)(),d=v9(i,"status_updated_by"in n?n.status_updated_by:null);return"post_comment"===n.entity_type?(0,Z.tZ)(bl,{pub:t,reportedComment:n,headerDetails:(0,Z.BX)(et.gq,{gap:4,children:[(0,Z.tZ)(ei.xv.B3,{as:"span",children:d?s(bR(),d):s(bF())}),(0,Z.tZ)(ei.xv.B3,{as:"span",children:n.status_updated_at&&I18N.p((0,H.Z)(n.status_updated_at).locale(l).standardDateOrTime({long:!0}))})]}),moderationPolicyDecision:r,moderationPolicy:o,onUpdateDecisionTags:a}):(0,Z.tZ)(bD,{pub:t,chatEntity:n,user:n.user,headerDetails:(0,Z.tZ)(ei.xv.B3,{children:d?s(bL(),d):s(bz())})})};function bU(){let e=(0,G._)([""," removed this comment"]);return bU=function(){return e},e}function bY(){let e=(0,G._)(["Someone removed this comment"]);return bY=function(){return e},e}function bH(){let e=(0,G._)([""," removed this message"]);return bH=function(){return e},e}function bj(){let e=(0,G._)(["Someone removed this message"]);return bj=function(){return e},e}let bJ=e=>{let{pub:t,user:i,reportedContent:n,moderationPolicyDecision:r,moderationPolicy:o,onUpdateDecisionTags:a}=e,{language:l,iTemplate:s}=(0,Q.M1)(),d=v9(i,"status_updated_by"in n?n.status_updated_by:null);return"post_comment"===n.entity_type?(0,Z.tZ)(bl,{pub:t,reportedComment:n,headerDetails:(0,Z.BX)(et.gq,{gap:4,children:[(0,Z.tZ)(ei.xv.B3,{as:"span",children:d?s(bU(),d):s(bY())}),(0,Z.tZ)(ei.xv.B3,{as:"span",children:n.status_updated_at&&I18N.p((0,H.Z)(n.status_updated_at).locale(l).standardDateOrTime({long:!0}))})]}),moderationPolicyDecision:r,moderationPolicy:o,onUpdateDecisionTags:a}):(0,Z.tZ)(bD,{pub:t,chatEntity:n,user:n.user,headerDetails:(0,Z.tZ)(ei.xv.B3,{children:d?s(bH(),d):s(bj())})})};function bV(){let e=(0,G._)(["Ban or suspend ",""]);return bV=function(){return e},e}function bq(){let e=(0,G._)(["Prevent this person from commenting on your publication in the future."]);return bq=function(){return e},e}function bW(){let e=(0,G._)(["Ban ",""]);return bW=function(){return e},e}function bG(){let e=(0,G._)(["Previously banned "," time(s), last on ",""]);return bG=function(){return e},e}function bK(){let e=(0,G._)([""," is permanently banned."]);return bK=function(){return e},e}function bQ(){let e=(0,G._)([""," is banned until ","."]);return bQ=function(){return e},e}function b$(){let e=(0,G._)(["Leave a reply"]);return b$=function(){return e},e}let b0=e=>{var t,i;let{comment:n,sub:r,bans:o,bansHistory:a,loading:l,error:s,selectedExpiry:d,setSelectedExpiry:c,selectedCommentVisibility:u,setSelectedCommentVisibility:p,expiryText:h,onClose:m,submitBan:g}=e,{iString:v,iTemplate:b}=(0,Q.M1)(),y=g8(),f=g5();return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:m,title:b(bV(),null!==(t=null==n?void 0:n.name)&&void 0!==t?t:"user"),showDivider:!0,alignItems:"center",icon:(0,Z.tZ)(eG.qE,{photoUrl:null!==(i=null==n?void 0:n.photo_url)&&void 0!==i?i:void 0,size:56}),description:(0,Z.BX)(et.sg,{alignItems:"center",gap:8,children:[(null==r?void 0:r.is_subscribed)&&(0,Z.tZ)(d_.Vp,{priority:"secondary",children:v("Paid subscriber")}),(0,Z.tZ)(ei.xv,{children:b(bq())})]})}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.sg,{gap:20,children:[(0,Z.tZ)(b2,{bans:o,bansHistory:a}),s&&(0,Z.tZ)(tM.y,{children:v("An error occurred. Please try again.")}),l&&(0,Z.tZ)(iI.$j,{padding:32,alignItems:"center",justifyContent:"center"}),!l&&(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(b1,{children:[(0,Z.tZ)(ei.xv.B3,{weight:"semibold",children:v("Ban duration")}),(0,Z.BX)(oY.i,{name:"expiry",value:d,onChange:e=>{c(e.target.value)},children:[(0,Z.tZ)(oY.d,{children:v("Select a duration")}),y.map(e=>{let[t,i]=e;return(0,Z.tZ)("option",{value:t,children:null==i?void 0:i.replace(/^For /,"")})})]})]}),(0,Z.BX)(b1,{children:[(0,Z.tZ)(ei.xv.B3,{weight:"semibold",children:v("Delete comments")}),(0,Z.BX)(oY.i,{name:"comment_visibility",value:u,onChange:e=>{p(e.target.value)},children:[(0,Z.tZ)(oY.d,{children:v("Select whether to delete comments")}),f.map(e=>{let[t,i]=e;return(0,Z.tZ)("option",{value:t,children:i})})]})]})]})]})}),(0,Z.tZ)(eK.mz,{direction:"column",showDivider:!0,primaryButton:(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:()=>g(d,u),children:b(bW(),h)})})]})},b1=(0,ts.zo)({display:"flex",justifyContent:"space-between",alignItems:"center"}),b2=e=>{let{bans:t,bansHistory:i}=e,{iTemplate:n}=(0,Q.M1)();if(!t[0])return null;let r=i.length?i.length:t.filter(e=>e.user_id).length;return(0,Z.tZ)(oU.b,{title:n(bG(),r,(0,H.Z)(t[0].start).standardDatetimeWithYear()),theme:"default",priority:"secondary",Icon:eN.Z,showClose:!1})},b4=e=>{var t,i;let{comment:n,bans:r,onClose:o,onReply:a}=e,{iString:l,iTemplate:s}=(0,Q.M1)(),d=r.find(e=>e.user_id),c=d&&(0,H.Z)(d.expiry).isAfter((0,H.Z)().add(100,"years"))?s(bK(),null!==(t=null==n?void 0:n.name)&&void 0!==t?t:"This user"):s(bQ(),null!==(i=null==n?void 0:n.name)&&void 0!==i?i:"This user",(0,H.Z)(null==d?void 0:d.expiry).standardDatetimeWithYear());return d?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:c,alignItems:"center",icon:(0,Z.tZ)(mK.AM,{icon:(0,Z.tZ)(vO.Z,{})}),showClose:!0,onClose:o,description:l("We recommend leaving a reply to tell them why they are banned, and to let other readers know what kinds of comments are not acceptable.")}),(0,Z.tZ)(eK.ex,{}),(0,Z.tZ)(eK.mz,{direction:"column",primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary-mono",onClick:a,children:s(b$())})})]}):null},b3=(e,t)=>{let[i,n]=(0,A.eJ)(null),[r,o]=(0,A.eJ)(!1),[a,l]=(0,A.eJ)([]),[s,d]=(0,A.eJ)([]),[c,u]=(0,A.eJ)(null),p=e=>{e.forEach(t=>{-1==e.findIndex(e=>e.id===t.id)&&e.push(t)}),l(e)},h=async(i,n)=>{o(!0);try{if(!e)throw Error("comment undefined, cannot submitBan");let r=await N().post("/api/v1/comment_ban/".concat(e.id)).send({user_id:e.user_id,expiry:i,commentVisibility:n});n!==g6.VISIBLE&&document.location.reload();let l=r.body;p(l.bans),o(!1),t&&t(e,a)}catch(e){console.error("Failed to submit ban",e),u(!0)}o(!1)};return(0,A.d4)(()=>{(async()=>{if(e){o(!0),l([]),d([]),u(null),n(null);try{var t;let[i,r]=await Promise.all([N().get("/api/v1/user/".concat(e.user_id,"/bans")),N().get("/api/v1/moderation/publications/".concat(e.publication_id,"/users/").concat(e.user_id,"/bans")).query({type:"comment",limit:20})]),o=i.body;l(o.bans),n(o.sub),d(null!==(t=r.body.data)&&void 0!==t?t:[])}catch(e){console.error("Failed to get bans:",e),u(!0)}o(!1)}})()},[e]),{sub:i,loading:r,bans:a,bansHistory:s,error:c,submitBan:h,setLoading:o,setError:u}},b8=e=>{var t,i,n,r;let{comment:o,onReply:a,onBan:l,onClose:s}=e,{sub:d,loading:c,bans:u,bansHistory:p,error:h,submitBan:m}=b3(o,l),g=g8(),v=null===(t=g[1])||void 0===t?void 0:t[0],[b,y]=(0,A.eJ)(v),[f,_]=(0,A.eJ)(g6.VISIBLE),w=!!o||c,C=null!==(r=null===(n=g.find(e=>{let[t]=e;return t===b}))||void 0===n?void 0:null===(i=n[1])||void 0===i?void 0:i.toLowerCase())&&void 0!==r?r:"",x=u.filter(e=>(0,H.Z)(e.expiry).isAfter((0,H.Z)()));return(0,Z.BX)(eK.u_,{isOpen:w,onClose:s,children:[0===x.length&&(0,Z.tZ)(b0,{comment:o,sub:d,bans:u,bansHistory:p,loading:c,error:h,selectedExpiry:b,setSelectedExpiry:y,selectedCommentVisibility:f,setSelectedCommentVisibility:_,expiryText:C,onClose:s,submitBan:m}),x.length>0&&(0,Z.tZ)(b4,{comment:o,bans:u,onClose:s,onReply:()=>{a&&o&&(a(o.id),s())}})]})},b6=e=>{var t,i,n;let r,{pub:o,reportedComment:a,sendStatusUpdate:l,moderationPolicyDecision:s,moderationPolicy:d,onUpdateDecisionTags:c}=e,{iString:u,iPlural:p}=(0,Q.M1)(),{reports:h}=a,m=h[0],[g,v]=(0,A.eJ)(!1),[b,y]=(0,A.eJ)(!1),w=async e=>{try{return{status:vH[(await N().patch("/api/v1/comment/".concat(a.id,"/status")).send({status:vY[e]})).body.status]}}catch(e){return{status:vU.Failed,error:(0,Y.zx)(e)}}};g&&(r=(0,_._)((0,f._)({},a),{photo_url:null===(i=a.user)||void 0===i?void 0:i.photo_url,name:null===(n=a.user)||void 0===n?void 0:n.name}));let C=(0,j.Wnz)(o,a.post,a,{});return(0,Z.tZ)(bl,{pub:o,reportedComment:a,headerDetails:(0,Z.tZ)(Z.HY,{children:(0,Z.tZ)(ei.xv.B3,{weight:"semibold",children:(0,Z.BX)(Z.HY,{children:[u("Comment reported by")," ",v8(o,null==m?void 0:m.reportingUser)||(null==m?void 0:null===(t=m.reportingUser)||void 0===t?void 0:t.email),h.length>1?p(" and %1 other"," and %1 others",h.length-1):""]})})}),actions:(0,Z.BX)(et.hs,{gap:8,justifyContent:"end",children:[(0,Z.tZ)(vW,{handleApproveContent:()=>l({contentId:a.id,action:vU.Approving,hide:!0,toastText:u("Approved comment"),updateStatus:w})}),(0,Z.tZ)(vK,{handleRemoveContent:()=>l({contentId:a.id,action:vU.Removing,hide:!0,toastText:u("Removed comment"),updateStatus:w})}),(0,Z.tZ)(vQ,{handleOpenBan:()=>v(!0)}),a.post&&(0,Z.tZ)(vG,{url:C}),(0,Z.tZ)(b8,{comment:r,onClose:()=>{b&&l({contentId:a.id,action:vU.Banning,hide:!0,toastText:u("Banned user"),updateStatus:async()=>({status:vU.Removed})}),v(!1)},onBan:()=>y(!0),onReply:()=>(0,Y.uX)(C,{newTab:!0})})]}),moderationPolicyDecision:s,moderationPolicy:d,onUpdateDecisionTags:c})},b5=e=>{var t;let{pub:i,reportedChat:n,sendStatusUpdate:r}=e,{iString:o,iPlural:a}=(0,Q.M1)(),{reports:l}=n,s=l[0],d=async e=>{let t={status:vJ[e],pubModerationStatus:vj[e],entityId:n.id,entityType:n.entity_type};try{return{status:vV[(await N().put("/api/v1/community/chat/pub_moderation").send(t)).body.entity.status]}}catch(e){return{status:vU.Failed,error:(0,Y.zx)(e)}}},c="community_comment"===n.entity_type?(0,en.xC8)({pubId:i.id,postId:n.post_id,params:{targetReplyId:n.id}}):(0,en.xC8)({pubId:i.id,postId:n.id});return(0,Z.tZ)(bD,{pub:i,user:n.user,chatEntity:n,headerDetails:(0,Z.tZ)(Z.HY,{children:(0,Z.tZ)(ei.xv.B3,{weight:"semibold",children:(0,Z.BX)(Z.HY,{children:[o("Message reported by")," ",v8(i,null==s?void 0:s.reportingUser)||(null==s?void 0:null===(t=s.reportingUser)||void 0===t?void 0:t.email),l.length>1?a(" and %1 other"," and %1 others",l.length-1):""]})})}),actions:(0,Z.BX)(et.hs,{gap:8,justifyContent:"end",children:[(0,Z.tZ)(vW,{handleApproveContent:()=>r({contentId:n.id,action:vU.Approving,hide:!0,toastText:o("Approved chat message"),updateStatus:d})}),(0,Z.tZ)(vK,{handleRemoveContent:()=>r({contentId:n.id,action:vU.Removing,hide:!0,toastText:o("Removed chat message"),updateStatus:d})}),(0,Z.tZ)(vG,{url:c})]})})},b9=e=>{let{pub:t,reportedContent:i,sendStatusUpdate:n,moderationPolicyDecision:r,moderationPolicy:o,onUpdateDecisionTags:a}=e;return"post_comment"===i.entity_type?(0,Z.tZ)(b6,{pub:t,reportedComment:i,sendStatusUpdate:n,moderationPolicyDecision:r,moderationPolicy:o,onUpdateDecisionTags:a}):(0,Z.tZ)(b5,{pub:t,reportedChat:i,sendStatusUpdate:n})},b7=e=>{let{pub:t,reportedContent:i,moderationPolicyDecision:n,moderationPolicy:r,onUpdateDecisionTags:o}=e,{language:a}=(0,Q.M1)(),l=(0,Z.BX)(ei.xv.B3,{translated:!0,children:["Marked as spam"," ",I18N.p((0,H.Z)(i.status_updated_at).locale(a).standardDateOrTime({long:!0}))]});return(0,Z.tZ)(bl,{pub:t,reportedComment:i,headerDetails:l,actions:(0,Z.tZ)(et.hs,{gap:8,justifyContent:"end",children:(0,Z.tZ)(vq,{reportedComment:i})}),moderationPolicyDecision:n,moderationPolicy:r,onUpdateDecisionTags:o})},ye=e=>{var t,i,n,r;let{pub:o,user:a}=e,{iString:l}=(0,Q.M1)(),{popToast:s}=(0,iN.pm)(),[d,c]=(0,A.eJ)(!0),[u,p]=(0,A.eJ)(!0),[h,m]=(0,A.eJ)(!1),{getConfigFor:g}=(0,io.xR)(),v=!!g("pub_auto_moderation_enabled"),b=e=>{c(e),p(!0)},y={0:{ContentItem:b9,url:"/api/v1/moderation/reports?includeAutomatedReports=".concat(d),emptyText:l("No reader-reported comments or chat messages."),title:l("Reported"),getDescriptiveText:()=>(0,Z.BX)(et.tu,{paddingBottom:24,gap:16,children:[(0,Z.BX)(ei.xv.B3,{color:"secondary",translated:!0,children:["These comments and chat messages were reported by readers who felt they might be inappropriate.",(0,Z.tZ)("br",{}),"This content will remain visible until you choose to remove it."]}),v&&(0,Z.BX)(et.gq,{gap:16,flex:"grow",justifyContent:"end",alignItems:"center",children:[(0,Z.tZ)(ei.xv.B3,{color:"primary",weight:"semibold",translated:!0,children:"Include automated reports"}),(0,Z.tZ)(i2.ZP,{checked:d,onChange:b}),(0,Z.tZ)(ee.zx,{priority:h?"primary":"secondary",onClick:()=>(0,Y.uX)("/publish/moderation/policy"),children:l("Manage policy")})]})]})},1:{ContentItem:bO,url:"/api/v1/moderation/log?status=".concat(oB.ql.moderator_approved),emptyText:l("You haven't approved any comments or chat messages."),title:l("Approved"),getDescriptiveText:()=>(0,Z.BX)(ei.xv.B3,{paddingBottom:24,color:"secondary",translated:!0,children:["These reader-reported comments and chat messages were explicitly approved by you or another publication admin.",(0,Z.tZ)("br",{}),"Approved content will remain on your publication."]})},2:{ContentItem:bJ,url:"/api/v1/moderation/log?status=".concat(oB.ql.moderator_removed),emptyText:l("You haven't removed any comments or chat messages."),title:l("Removed"),getDescriptiveText:()=>(0,Z.BX)(ei.xv.B3,{paddingBottom:24,color:"secondary",translated:!0,children:["These comments and chat messages were removed by you or another publication admin.",(0,Z.tZ)("br",{}),"Removed content will not be visible to other users."]})},3:{ContentItem:b7,url:"/api/v1/moderation/log?status=".concat(oB.ql.flagged),emptyText:l("No comments have been marked as spam."),title:l("Marked as spam"),getDescriptiveText:()=>(0,Z.BX)(ei.xv.B3,{paddingBottom:24,color:"secondary",translated:!0,children:["These comments were removed by Substack for violating our"," ",(0,Z.tZ)("a",{href:"https://substack.com/content",target:"_blank",rel:"noopener",children:"spam policy."}),(0,Z.tZ)("br",{}),"Spam content will not be visible to other users."]})}};(0,A.d4)(()=>{o.moderation_enabled&&o.community_enabled||(0,Y.uX)((0,j.wI3)(o),{local_navigation:!1})},[o]);let[w,C]=(0,A.eJ)(0),[x,S]=(0,A.eJ)([]),[k,B]=(0,A.eJ)(void 0),T=(0,A.Ye)(()=>x.filter(e=>!e.hidden).length,[x]),{ContentItem:I,url:P,emptyText:E,getDescriptiveText:X}=y[w],M=null!==(n=null===(t=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(o.id,"/policies"),auto:v}).result)||void 0===t?void 0:t.policies)&&void 0!==n?n:[],D=(0,A.Ye)(()=>x.map(e=>e.id.toString()).join(","),[x]),R=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(o.id,"/decisions/comments"),query:{comment_ids:D},deps:[D],auto:v&&D.length>0}),F=null!==(r=null===(i=R.result)||void 0===i?void 0:i.decisions)&&void 0!==r?r:[],L=e=>{e!==w&&(p(!0),S([]),C(e))};(0,A.d4)(()=>{(async()=>{if(u)try{let e=await N().get(P);S(e.body.content)}catch(e){B((0,Y.zx)(e))}finally{p(!1)}})()},[u,w,P]);let z=e=>{S(x.filter(t=>t.id!==e))},O=(e,t)=>{S(x.map(i=>i.id===e?(0,_._)((0,f._)({},i),{status:t}):i))},U=(e,t)=>{S(x.map(i=>i.id===e?(0,_._)((0,f._)({},i),{hidden:t}):i))},H=async(e,t)=>{await J({contentId:e,action:vU.Undoing,updateStatus:t}),s(()=>(0,Z.tZ)(iN.FN,{text:l("Successful undo")})),U(e,!1)},J=async e=>{let{contentId:t,action:i,hide:n=!1,toastText:r=null,updateStatus:o}=e;n&&U(t,!0);let{status:a,error:l}=await o(i);a===vU.Failed&&l&&(s(()=>(0,Z.tZ)(iN.FN,{text:l})),U(t,!1)),[vU.Removed,vU.Approved].includes(a)?z(t):O(t,a),r&&s(()=>(0,Z.tZ)(iN.FN,{text:r,onAccept:()=>H(t,o),cta:"Undo"}))},V=()=>{R.refetch(),m(!0)};return(0,Z.tZ)(bi,{pub:o,children:(0,Z.BX)("div",{className:"container",children:[(0,Z.BX)(et.tu,{gap:24,paddingTop:32,children:[(0,Z.tZ)(ee.hU,{priority:"tertiary",onClick:()=>window.history.back(),children:(0,Z.tZ)(eF.Z,{size:20})}),(0,Z.tZ)(ei.xv.H2,{children:l("Moderate reported content")}),(0,Z.tZ)(r7.m,{children:Object.keys(y).map(e=>{let t=y[e];return(0,Z.tZ)(r7.E,{title:t.title,isActive:w.toString()===e,onClick:()=>L(e)})})})]}),X(),0===T?(0,Z.tZ)(bP,{loading:u,icon:(0,Z.tZ)(bE,{}),text:E,error:k}):(0,Z.tZ)(et.tu,{gap:24,children:x.map(e=>{var t,i;let n=null!==(t=F.find(t=>t.comment_id===e.id))&&void 0!==t?t:null,r=null!==(i=M.find(e=>e.id===(null==n?void 0:n.policy_id)))&&void 0!==i?i:null;return(0,Z.tZ)(I,{pub:o,user:a,reportedContent:e,sendStatusUpdate:J,moderationPolicyDecision:n,moderationPolicy:r,onUpdateDecisionTags:V},e.id)})})]})})},yt=e=>{var{stroke:t}=e,i=(0,ef._)(e,["stroke"]);return(0,Z.BX)(eH.l,(0,_._)((0,f._)({},i),{name:"UserCrossIcon",svgParams:{viewBox:"0 0 24 24",height:24,width:24,fill:"none"},children:[(0,Z.tZ)("path",{d:"M16 21V19C16 17.9391 15.5786 16.9217 14.8284 16.1716C14.0783 15.4214 13.0609 15 12 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21",stroke:t,"stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M8.5 11C10.7091 11 12.5 9.20914 12.5 7C12.5 4.79086 10.7091 3 8.5 3C6.29086 3 4.5 4.79086 4.5 7C4.5 9.20914 6.29086 11 8.5 11Z",stroke:t,"stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M18 8L23 13",stroke:t,"stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M23 8L18 13",stroke:t,"stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})]}))},yi=e=>{let{pub:t,commenter:i,onApproveUser:n,onBanUser:r}=e,{iString:o,iPlural:a}=(0,Q.M1)(),{user:l,comments:s,banned_by_other_pubs_count:d}=i;return(0,Z.BX)(et.tu,{className:"moderated-comment",children:[(0,Z.BX)(et.gq,{className:"header",justifyContent:"space-between",alignItems:"center",children:[(0,Z.BX)(et.gq,{gap:8,alignItems:"center",children:[a("Comment from","Comments from",s.length)," ",v8(t,l),d?(0,Z.tZ)(tW.u,{text:a("User has been banned by %1 other publication","User has been banned by %1 other publications",d),disabled:!d,children:(0,Z.tZ)(et.gq,{alignItems:"center",children:(0,Z.tZ)(eL.Z,{height:20})})}):null]}),(0,Z.BX)(et.gq,{gap:12,alignItems:"center",children:[(0,Z.tZ)(ee.zx,{priority:"primary",size:"sm",trailing:(0,Z.tZ)(c4.Z,{height:14}),onClick:n,children:o("Approve")}),(0,Z.tZ)(ee.zx,{priority:"secondary",size:"sm",trailing:(0,Z.tZ)(yt,{height:14}),onClick:r,children:o("Deny")})]})]}),(0,Z.tZ)(et.tu,{className:"body",children:s.map(e=>(0,Z.tZ)(ba,{pub:t,user:l,comment:e,linkToThread:!0}))})]})},yn=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),n=(0,ss.So)().getSettingFor("new_commenter_approval"),[r,o]=(0,A.eJ)({}),[a,l]=(0,A.eJ)([]),[s,d]=(0,A.eJ)(!0),[c,u]=(0,A.eJ)(void 0);(0,A.d4)(()=>{let e=async()=>{try{let e=(await N().get("/api/v1/moderation/users_pending_approval")).body,t=Object.keys(e),i=(0,iP.x)("user");i&&t.sort(e=>e===i?-1:0),o(e),l(t),d(!1)}catch(e){u(i("Failed to load commenters pending approval. See console for details")),console.error(e)}};n?e():(0,B.route)("/publish/settings")},[]);let p=async e=>{try{await N().post("/api/v1/moderation/users_pending_approval/".concat(e,"/approve")),location.reload()}catch(e){u(i("Failed to approve user.  See console for details.")),console.error(e)}},h=async e=>{if(confirm(i("Are you sure you want to permanently ban this user from commenting?")))try{await N().post("/api/v1/moderation/users_pending_approval/".concat(e,"/deny")),location.reload()}catch(e){u(i("Failed to remove comments and ban user.  See console for details.")),console.error(e)}};return(0,Z.tZ)("div",{className:"moderate-comments-page",children:(0,Z.BX)("div",{className:"container",children:[(0,Z.tZ)("a",{className:"back-icon",href:"javascript:history.back()",children:(0,Z.tZ)(gl,{})}),(0,Z.tZ)("h1",{children:i("Approve new commenters")}),(0,Z.tZ)(ei.xv.B3,{paddingBottom:24,color:"secondary",translated:!0,children:'Comments from users pending approval will not be visible to other readers. They will only be visible to the comment authors and publication admins. Admins will see these comments marked with "Awaiting New Commenter Approval" until the commenter is approved.'}),(0,Z.tZ)(ei.xv.B3,{paddingBottom:24,color:"secondary",translated:!0,children:"Once a commenter is approved, their comments will be made visible to everyone. Users who are denied will have their comments removed and will be permanently banned from commenting on your publication's posts."}),(0,Z.tZ)(et.tu,{gap:8,children:0===a.length?(0,Z.tZ)(bP,{loading:s,icon:(0,Z.tZ)(bE,{}),text:i("No new commenters are pending approval."),error:c}):a.map(e=>(0,Z.tZ)(yi,{pub:t,commenter:r[e],onApproveUser:()=>p(e),onBanUser:()=>h(e)},e))})]})})};function yr(e){var t;let i=0,n=0,r=0,o=null!==(t=e.results)&&void 0!==t?t:[],a=o.length;for(let e of o)e.example&&(e.actual_result.flagged&&!e.example.expected_result.flagged?i++:!e.actual_result.flagged&&e.example.expected_result.flagged?n++:r++);let l=a>0?r/a*100:0;return{falsePositives:i,falseNegatives:n,matches:r,total:a,accuracy:"".concat(l.toFixed(1),"%")}}var yo=i(69891);function ya(e){var t,i;let{run:n,pub:r}=e,{iString:o}=(0,Q.M1)(),a=(0,A.Ye)(()=>n.results.map(e=>{var t;return null===(t=e.example)||void 0===t?void 0:t.comment_id}).filter(Boolean).sort(),[n.results]).join(","),l=(0,iS.ib)({pathname:"/api/v1/moderation/publications/".concat(r.id,"/comments/details"),query:{comment_ids:a},deps:[a],auto:a.length>0}),s=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(r.id,"/decisions/comments"),query:{comment_ids:a},deps:[a],auto:a.length>0}),d=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(r.id,"/decisions/runs/").concat(n.id),deps:[n.id],auto:!!n.id}),c=(0,A.Ye)(()=>{var e,t;return new Map(null!==(t=null===(e=l.result)||void 0===e?void 0:e.comments.map(e=>[e.id.toString(),e]))&&void 0!==t?t:[])},[l.result]),u=(0,A.Ye)(()=>{var e,t;return new Map(null!==(t=null===(e=s.result)||void 0===e?void 0:e.decisions.map(e=>[e.comment_id,e]))&&void 0!==t?t:[])},[s.result]),p=(0,A.Ye)(()=>{var e,t;return new Map(null!==(t=null===(e=d.result)||void 0===e?void 0:e.decisions.map(e=>[e.comment_id,e]))&&void 0!==t?t:[])},[d.result]),h=()=>{d.refetch()},m=(0,A.Ye)(()=>{let e=n.results.filter(e=>!e.actual_result.flagged),t=n.results.filter(e=>e.actual_result.flagged),i=n.results.filter(e=>{var t;return e.actual_result.flagged&&!(null===(t=e.example)||void 0===t?void 0:t.expected_result.flagged)}),r=n.results.filter(e=>{var t;return!e.actual_result.flagged&&(null===(t=e.example)||void 0===t?void 0:t.expected_result.flagged)});return[{label:"Accepted (".concat(e.length,")"),value:"accepted",rows:e},{label:"Flagged (".concat(t.length,")"),value:"flagged",rows:t},{label:"False Positives (".concat(i.length,")"),value:"false_positives",rows:i},{label:"False Negatives (".concat(r.length,")"),value:"false_negatives",rows:r},{label:"All (".concat(n.results.length,")"),value:"all",rows:n.results}]},[n.results]),[g,v]=(0,A.eJ)("accepted"),b=null!==(i=null===(t=m.find(e=>e.value===g))||void 0===t?void 0:t.rows)&&void 0!==i?i:[];return(0,Z.BX)(et.sg,{gap:16,children:[(0,Z.tZ)(yo.n,{tabs:m,value:g,onChange:v}),b.map(e=>{var t,i,n,a;let l=c.get(null!==(n=null===(t=e.example)||void 0===t?void 0:t.comment_id.toString())&&void 0!==n?n:"");if(!l)return null;let s=p.get(l.id),d=u.get(l.id);return(0,Z.BX)(et.sg,{gap:8,border:"detail",radius:"sm",children:[(0,Z.BX)(et.X2,{padding:8,gap:8,justifyContent:"space-between",alignItems:"center",bg:"secondary",borderBottom:"detail",children:[l.post&&(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",children:(0,Z.tZ)("a",{title:o("View thread"),href:(0,j.uRy)(r,l.post),children:l.post.title})}),(0,Z.BX)(et.X2,{gap:8,alignItems:"center",children:[(0,Z.tZ)(tA.__,{children:o("Expected:")}),(0,Z.tZ)(br,{flagged:null!==(a=null===(i=e.example)||void 0===i?void 0:i.expected_result.flagged)&&void 0!==a&&a}),(0,Z.tZ)(tA.__,{children:o("Actual:")}),(0,Z.tZ)(br,{flagged:e.actual_result.flagged}),!s&&e.actual_result.labels.map(t=>(0,Z.tZ)(tW.u,{text:e.actual_result.flagged?e.actual_result.reason:o("Approved"),children:(0,Z.tZ)(d_.Vp,{theme:"error",priority:"primary",children:t})},t))]})]}),(0,Z.BX)(et.sg,{paddingX:8,gap:12,children:[d&&(0,Z.BX)(et.X2,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{minWidth:80,children:o("Expected:")}),(0,Z.tZ)(v$,{decision:d,pubId:r.id,onSave:h,commentId:l.id,readonly:!0,policy:null})]}),s&&(0,Z.BX)(et.X2,{gap:8,paddingBottom:8,borderBottom:"detail",children:[(0,Z.tZ)(ei.xv.B4,{minWidth:80,children:o("Actual:")}),(0,Z.tZ)(v$,{decision:s,pubId:r.id,onSave:h,commentId:l.id,readonly:!!d,policy:null})]}),(0,Z.tZ)(ba,{pub:r,user:l.user,comment:l})]})]},l.id)})]})}function yl(e){let{run:t,metrics:i}=e;return(0,Z.BX)(et.sg,{gap:8,children:[(0,Z.BX)(et.X2,{gap:8,alignItems:"center",children:[(0,Z.tZ)(ei.xv.B3,{as:"span",weight:"bold",translated:!0,children:"Policy:"}),(0,Z.tZ)(ei.xv.B3,{children:t.policy_name})]}),(0,Z.BX)(et.X2,{gap:8,alignItems:"center",children:[(0,Z.tZ)(ei.xv.B3,{as:"span",weight:"bold",translated:!0,children:"Run Date:"}),(0,Z.tZ)(ei.xv.B3,{children:vw()(t.created_at).standardDatetimeWithYear()})]}),(0,Z.BX)(et.X2,{gap:8,alignItems:"center",children:[(0,Z.tZ)(ei.xv.B3,{as:"span",weight:"bold",translated:!0,children:"Accuracy:"}),(0,Z.BX)(ei.xv.B3,{children:[i.accuracy," (",i.matches," / ",i.total,")"]})]})]})}function ys(e){let{pub:t,evalId:i,runId:n,policyId:r}=e,{iString:o}=(0,Q.M1)(),a=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(t.id,"/policies/").concat(r,"/evals/").concat(i,"/runs/").concat(n),auto:!0}),l=a.result;if(!l)return(0,Z.BX)("div",{children:[a.isLoading&&(0,Z.tZ)(iI.$j,{}),a.error&&(0,Z.tZ)(ei.xv.B3,{color:"error",children:a.error.message})]});if(l instanceof Error)return(0,Z.tZ)(ei.xv.B3,{color:"error",children:l.message});let s=yr(l);return(0,Z.tZ)("div",{className:"container",children:(0,Z.BX)(et.sg,{paddingY:32,paddingX:16,gap:36,children:[(0,Z.tZ)(ee.hU,{priority:"secondary",onClick:()=>window.history.back(),children:(0,Z.tZ)(eF.Z,{size:20})}),(0,Z.tZ)(yl,{run:l,metrics:s}),(0,Z.tZ)(ei.xv.H2,{children:o("Evaluation Run Results")}),(0,Z.tZ)(ya,{run:l,pub:t})]})})}function yd(){let e=(0,G._)(["Add Test Case (",")"]);return yd=function(){return e},e}function yc(e){var t,i;let{pub:n,evalId:r,policyId:o,onExampleAdded:a,onFinish:l,policy:s}=e,{iString:d,iTemplate:c}=(0,Q.M1)(),[u,p]=(0,A.eJ)("published"),[h,m]=(0,A.eJ)(1),g=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(n.id,"/policies/").concat(o,"/evals/").concat(r,"/examples/candidates"),query:{status:u,offset:(h-1)*10,limit:10},auto:!0,deps:[u,h]}),v=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(n.id,"/policies/").concat(o,"/evals/").concat(r,"/examples"),method:"POST"}),b=(0,A.Ye)(()=>{var e,t;return null!==(t=null===(e=g.result)||void 0===e?void 0:e.comments)&&void 0!==t?t:[]},[g.result]),y=(0,A.Ye)(()=>b.map(e=>e.id).sort(),[b]).join(","),f=(0,iS.ib)({pathname:"/api/v1/moderation/publications/".concat(n.id,"/comments/details"),query:{comment_ids:y},deps:[y],auto:y.length>0}),_=(0,A.Ye)(()=>{var e,t;return new Map(null!==(t=null===(e=f.result)||void 0===e?void 0:e.comments.map(e=>[e.id.toString(),e]))&&void 0!==t?t:[])},[f.result]),w=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(n.id,"/decisions/comments"),query:{comment_ids:y},deps:[y],auto:y.length>0}),C=(0,A.Ye)(()=>{var e,t;return new Map(null!==(t=null===(e=w.result)||void 0===e?void 0:e.decisions.map(e=>[e.comment_id,e]))&&void 0!==t?t:[])},[w.result]),x=async(e,t)=>{let i=C.get(e.id);await v.refetch({json:{examples:[{comment_id:e.id,comment_body:e.body,expected_result:{flagged:t,labels:[],reason:"",moderation_decision_id:null==i?void 0:i.id}}]}}),await g.refetch(),a()};return(0,Z.BX)(et.sg,{gap:16,children:[(0,Z.tZ)(ei.xv.H4,{children:d("Add Recent Comments")}),(0,Z.BX)(et.X2,{gap:16,alignItems:"end",justifyContent:"space-between",children:[(0,Z.tZ)(yu,{value:u,onChange:e=>{p(e),m(1)}}),(0,Z.tZ)(ee.zx,{priority:"tertiary",onClick:()=>l(),children:d("Done")})]}),b.map(e=>{let t=_.get(e.id.toString());if(!t)return null;let i=C.get(t.id),r=v4(null!=i?i:null).some(e=>!e.corrected&&"high"===e.severity);return(0,Z.BX)(et.sg,{gap:8,border:"detail",radius:"sm",children:[(0,Z.BX)(et.X2,{padding:8,gap:8,justifyContent:"space-between",alignItems:"center",bg:"secondary",borderBottom:"detail",children:[t.post&&(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",children:(0,Z.tZ)("a",{title:d("View thread"),href:(0,j.uRy)(n,t.post),children:t.post.title})}),(0,Z.tZ)(et.X2,{gap:8,alignItems:"center",children:(0,Z.tZ)(tW.u,{text:c(yd(),r?"should flag":"should allow"),children:(0,Z.tZ)(ee.zx,{priority:"tertiary",leading:(0,Z.tZ)(br,{flagged:r}),onClick:()=>x(e,r),children:d("Add Test Case")})})})]}),(0,Z.BX)(et.sg,{paddingX:8,paddingTop:8,children:[(0,Z.tZ)(v$,{decision:null!=i?i:null,pubId:n.id,onSave:()=>w.refetch(),policy:s,commentId:t.id}),(0,Z.tZ)(ba,{pub:n,user:t.user,comment:t})]})]},t.id)}),(0,Z.tZ)(et.X2,{justifyContent:"center",children:(0,Z.BX)(nK.tl,{children:[(0,Z.BX)(et.X2,{gap:4,children:[(0,Z.tZ)(nK.Gt,{onClick:()=>m(1),disabled:1===h}),(0,Z.tZ)(nK.FS,{onClick:()=>m(h-1),disabled:1===h})]}),(0,Z.tZ)(et.X2,{gap:4,children:(0,Z.tZ)(nK.$W,{onClick:()=>m(h+1),disabled:(null!==(i=null===(t=g.result)||void 0===t?void 0:t.comments.length)&&void 0!==i?i:0)<10})})]})})]})}let yu=e=>{let{value:t,onChange:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{translated:!0,children:"Comment Status"}),(0,Z.BX)(oY.i,{value:t,onChange:e=>i(e.currentTarget.value),children:[(0,Z.tZ)("option",{value:"published",children:n("Published")}),(0,Z.tZ)("option",{value:"moderator_removed",children:n("Removed")}),(0,Z.tZ)("option",{value:"moderator_approved",children:n("Approved")})]})]})};var yp=i(18693);function yh(e){var t;let{eval_:i,pub:n,evalId:r,policyId:o,policy:a,refetchEval:l,onAddExamples:s}=e,{iString:d}=(0,Q.M1)(),[c,u]=(0,to.useState)(""),[p,h]=(0,to.useState)(""),[m,g]=(0,to.useState)({pageIndex:0,pageSize:10}),v=(0,A.Ye)(()=>{if(p)return[{id:"flagged",value:"flag"===p}]},[p]),b=(0,vA.b7)({data:null!==(t=null==i?void 0:i.examples)&&void 0!==t?t:[],columns:[{accessorKey:"comment_body"},{id:"flagged",accessorKey:"expected_result.flagged"}],getCoreRowModel:(0,vD.sC)(),getPaginationRowModel:(0,vD.G_)(),getFilteredRowModel:(0,vD.vL)(),onPaginationChange:g,onGlobalFilterChange:u,globalFilterFn:"includesString",autoResetPageIndex:!1,state:{globalFilter:c,pagination:m,columnFilters:v}}),y=b.getRowModel().rows,f=(0,A.Ye)(()=>y.map(e=>e.original.comment_id).sort(),[y]).join(",");(0,to.useEffect)(()=>{m.pageIndex*m.pageSize>=i.examples.length&&b.setPageIndex(m.pageIndex-1)},[m,i.examples,b]);let _=(0,iS.ib)({pathname:"/api/v1/moderation/publications/".concat(n.id,"/comments/details"),query:{comment_ids:f},deps:[f],auto:f.length>0}),w=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(n.id,"/decisions/comments"),query:{comment_ids:f},deps:[f],auto:f.length>0}),C=(0,A.Ye)(()=>{var e,t;return new Map(null!==(t=null===(e=w.result)||void 0===e?void 0:e.decisions.map(e=>[e.comment_id,e]))&&void 0!==t?t:[])},[w.result]),x=(0,A.Ye)(()=>{var e,t;return new Map(null!==(t=null===(e=_.result)||void 0===e?void 0:e.comments.map(e=>[e.id,e]))&&void 0!==t?t:[])},[_.result]);if(!i)return null;let S=async e=>{let t=await w.refetch();if(t instanceof Error)return;let a=new Map(t.decisions.map(e=>[e.comment_id,e])).get(e),s=v4(null!=a?a:null).filter(e=>!e.corrected),d=s.some(e=>"high"===e.severity),c=i.examples.find(t=>t.comment_id===e);if(c&&c.expected_result.flagged!==d){let e=await N().put("/api/v1/moderation/".concat(n.id,"/policies/").concat(o,"/evals/").concat(r,"/examples/").concat(c.id)).send({expected_result:{flagged:d,labels:s.map(e=>e.name),reason:s.map(e=>e.reason).join(", ")}});if(200!==e.status){console.error(e.body);return}await l()}};return(0,Z.BX)(et.sg,{gap:16,children:[(0,Z.BX)(et.X2,{justifyContent:"space-between",alignItems:"end",children:[(0,Z.BX)(et.X2,{gap:8,children:[(0,Z.tZ)(yg,{globalFilter:c,setGlobalFilter:u}),(0,Z.tZ)(yv,{statusFilter:p,setStatusFilter:h})]}),(0,Z.tZ)(ee.zx,{priority:"tertiary",onClick:()=>s(),children:d("Add Test Cases")})]}),y.map(e=>{let t=e.original,i=x.get(t.comment_id);if(!i)return null;let s=C.get(i.id);return(0,Z.BX)(et.sg,{gap:8,border:"detail",radius:"sm",children:[(0,Z.BX)(et.X2,{padding:8,gap:8,justifyContent:"space-between",alignItems:"center",bg:"secondary",borderBottom:"detail",children:[i.post&&(0,Z.tZ)(ei.xv.B4,{fontWeight:"semibold",children:(0,Z.tZ)("a",{title:d("View thread"),href:(0,j.uRy)(n,i.post),children:i.post.title})}),(0,Z.tZ)(ym,{pub:n,evalId:r,policyId:o,example:t,onUpdate:()=>l()})]}),(0,Z.BX)(et.sg,{paddingX:8,children:[s&&(0,Z.tZ)(v$,{decision:s,pubId:n.id,onSave:()=>S(i.id),policy:a,commentId:i.id}),(0,Z.tZ)(ba,{pub:n,user:i.user,comment:i})]})]},i.id)}),b.getPageCount()>1&&(0,Z.tZ)(et.X2,{justifyContent:"center",children:(0,Z.BX)(nK.tl,{children:[(0,Z.BX)(et.X2,{gap:4,children:[(0,Z.tZ)(nK.Gt,{onClick:()=>b.firstPage(),disabled:!b.getCanPreviousPage()}),(0,Z.tZ)(nK.FS,{onClick:()=>b.previousPage(),disabled:!b.getCanPreviousPage()})]}),(0,Z.tZ)(nK.bp,{currentPage:m.pageIndex+1,totalPages:b.getPageCount()}),(0,Z.BX)(et.X2,{gap:4,children:[(0,Z.tZ)(nK.$W,{onClick:()=>b.nextPage(),disabled:!b.getCanNextPage()}),(0,Z.tZ)(nK.kt,{onClick:()=>b.lastPage(),disabled:!b.getCanNextPage()})]})]})})]})}function ym(e){let{pub:t,evalId:i,policyId:n,example:r,onUpdate:o}=e,{iString:a}=(0,Q.M1)(),l=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(t.id,"/policies/").concat(n,"/evals/").concat(i,"/examples"),method:"DELETE"}),s=async()=>{await l.refetch({json:{example_ids:[r.id]}}),o()};return(0,Z.BX)(et.X2,{gap:8,alignItems:"center",children:[(0,Z.tZ)(tW.u,{text:a(r.expected_result.flagged?"Should Flag":"Should Allow"),children:(0,Z.tZ)(ee.hU,{priority:"tertiary",size:"sm",children:r.expected_result.flagged?(0,Z.tZ)(v3.Z,{size:16,style:{stroke:"var(--color-accent-fg-red)"}}):(0,Z.tZ)(yp.Z,{size:16,style:{stroke:"var(--color-accent-fg-green)"}})})}),(0,Z.tZ)(tW.u,{text:a("Remove example"),children:(0,Z.tZ)(ee.hU,{priority:"tertiary",size:"sm",onClick:s,children:(0,Z.tZ)(iW.Z,{size:16})})})]})}let yg=e=>{let{globalFilter:t,setGlobalFilter:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{translated:!0,children:"Search"}),(0,Z.tZ)(tD.oi,{leading:(0,Z.tZ)(sw.Z,{size:16}),placeholder:n("Search"),value:t,onChange:e=>{i(e.currentTarget.value)}})]})},yv=e=>{let{statusFilter:t,setStatusFilter:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{translated:!0,children:"Comment Status"}),(0,Z.BX)(oY.i,{value:t,onChange:e=>{i(e.currentTarget.value)},children:[(0,Z.tZ)("option",{value:"",children:n("All")}),(0,Z.tZ)("option",{value:"allow",children:n("Allow")}),(0,Z.tZ)("option",{value:"flag",children:n("Flag")})]})]})};var yb=i(3039);let yy=null;function yf(e){var t,i,n,r,o,a;let{pub:l,policyId:s,evalId:d}=e,{iString:c}=(0,Q.M1)(),[u,p]=(0,A.eJ)(1),[h,m]=(0,A.eJ)(),g=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(l.id,"/policies/").concat(s,"/versions"),auto:!0}),v=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(l.id,"/policies/").concat(s,"/evals/").concat(d,"/runs"),auto:!0}),b=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(l.id,"/policies/").concat(s,"/evals/").concat(d,"/runs"),method:"POST",auto:!1}),y=(0,A.Ye)(()=>{var e,t;return null!==(t=null===(e=g.result)||void 0===e?void 0:e.versions)&&void 0!==t?t:[]},[null===(t=g.result)||void 0===t?void 0:t.versions]),f=(0,A.Ye)(()=>{var e,t;return null!==(t=null===(e=v.result)||void 0===e?void 0:e.runs)&&void 0!==t?t:[]},[null===(i=v.result)||void 0===i?void 0:i.runs]);(0,A.d4)(()=>{let e=y[0];e&&!h&&m(e.id)},[y,h]);let _=(0,A.Ye)(()=>{var e;if(!(null===(e=v.result)||void 0===e?void 0:e.runs))return[];let t=(u-1)*10;return v.result.runs.slice(t,t+10)},[null===(n=v.result)||void 0===n?void 0:n.runs,u]),w=Math.ceil((null!==(a=null===(o=v.result)||void 0===o?void 0:null===(r=o.runs)||void 0===r?void 0:r.length)&&void 0!==a?a:0)/10),C=f[0],x=(0,A.I4)(()=>{v.refetch()},[v]);(0,A.d4)(()=>{C&&"running"===C.status&&(yy&&clearTimeout(yy),yy=setTimeout(()=>{x()},1e3))},[x,C]);let S=(0,A.Ye)(()=>y.find(e=>e.id===h),[y,h]),k=(0,A.I4)(async()=>{S&&(await b.refetch({json:{policy_version:null==S?void 0:S.version}}),x())},[S,b,x]);return(0,Z.BX)(et.sg,{gap:4,children:[(0,Z.tZ)(ei.xv.H3,{children:c("Recent Test Runs")}),(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{children:[(0,Z.tZ)(gK,{children:c("Status")}),(0,Z.tZ)(gK,{children:c("Policy Version")}),(0,Z.tZ)(gK,{children:c("Matches")}),(0,Z.tZ)(gK,{children:c("Accuracy")}),(0,Z.tZ)(gK,{children:c("False Positives")}),(0,Z.tZ)(gK,{children:c("False Negatives")}),(0,Z.tZ)(gK,{children:c("Run Date")})]})}),(0,Z.tZ)(gq,{children:_.map(e=>{var t;let i=yr(e);return(0,Z.BX)(gG,{onClick:()=>(0,Y.uX)("/publish/moderation/policies/".concat(s,"/evals/").concat(d,"/runs/").concat(e.id)),cursor:"pointer",children:[(0,Z.tZ)(gQ,{children:(0,Z.tZ)(tW.u,{text:e.status,children:null!==(t=function(e){switch(e){case"completed":return(0,Z.tZ)(s1.Z,{style:{stroke:"var(--color-accent-fg-green)"},size:16});case"failed":return(0,Z.tZ)(pw.Z,{style:{stroke:"var(--color-accent-fg-red)"},size:16});case"running":return(0,Z.tZ)(yb.Z,{style:{stroke:"var(--color-accent-fg-blue)"},size:16});default:return null}}(e.status))&&void 0!==t?t:"-"})}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.xv.B4,{children:e.policy_name})}),(0,Z.tZ)(gQ,{children:(0,Z.BX)(ei.xv.B4,{children:[i.matches," / ",i.total]})}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.xv.B4,{children:i.accuracy})}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.xv.B4,{children:i.falsePositives})}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.xv.B4,{children:i.falseNegatives})}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.xv.B4,{children:(0,H.Z)(e.created_at).standardDatetimeWithYear()})})]},e.id)})})]})}),(0,Z.tZ)(et.X2,{justifyContent:"center",children:(0,Z.BX)(nK.tl,{children:[(0,Z.BX)(et.X2,{gap:4,children:[(0,Z.tZ)(nK.Gt,{onClick:()=>p(1),disabled:1===u}),(0,Z.tZ)(nK.FS,{onClick:()=>p(u-1),disabled:1===u})]}),(0,Z.BX)(et.X2,{gap:4,children:[(0,Z.tZ)(nK.$W,{onClick:()=>p(u+1),disabled:u>=w}),(0,Z.tZ)(nK.kt,{onClick:()=>p(w),disabled:u>=w})]})]})}),(0,Z.BX)(et.X2,{gap:16,alignItems:"center",justifyContent:"end",children:[(0,Z.tZ)(ei.xv.B3,{fontWeight:"semibold",children:c("Run a new test:")}),(0,Z.tZ)(iT.m,{value:null!=h?h:"",onChange:e=>m(e),options:y.map(e=>({value:e.id,label:"v".concat(e.version," (").concat((0,H.Z)(e.created_at).standardDatetimeWithYear(),")")}))}),(0,Z.tZ)(ee.zx,{onClick:k,disabled:!h||b.isLoading,loading:b.isLoading,children:c("Start")})]})]})}function y_(){let e=(0,G._)(["Created by "," on ",""]);return y_=function(){return e},e}function yZ(){let e=(0,G._)(["Testing policy: ",""]);return yZ=function(){return e},e}function yw(e){let{pub:t,evalId:i,policyId:n}=e,{iTemplate:r,iString:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(!1),[s,d]=(0,A.eJ)(""),[c,u]=(0,A.eJ)(!1),p=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(t.id,"/policies/").concat(n,"/evals/").concat(i),auto:!0}),h=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(t.id,"/policies/").concat(n,"/evals/").concat(i),method:"PUT",auto:!1}),{refetch:m}=p,g=p.result,v=(0,iS.ib)({pathname:"/api/v1/moderation/".concat(t.id,"/policies/").concat(n),auto:!0}),b=v.result,y=(0,A.I4)(()=>{g&&(d(g.name),l(!0))},[g]),f=(0,A.I4)(async()=>{s.trim()&&(await h.refetch({json:{name:s.trim()}}),await m(),l(!1))},[s,h,m]),_=(0,A.I4)(()=>{l(!1)},[]);return((0,A.d4)(()=>{g&&!g.examples.length&&u(!0)},[g]),g&&b)?(0,Z.tZ)("div",{className:"container",children:(0,Z.BX)(et.sg,{paddingY:32,paddingX:16,gap:36,children:[(0,Z.tZ)(bn,{}),(0,Z.BX)(et.sg,{gap:8,children:[a?(0,Z.BX)(et.X2,{gap:16,alignItems:"end",children:[(0,Z.tZ)(ij.n,{value:s,onChange:e=>d(e),placeHolder:o("Enter test name"),label:o("Test name"),width:180}),(0,Z.tZ)(ee.zx,{onClick:f,disabled:!s.trim()||h.isLoading,loading:h.isLoading,priority:"primary",children:o("Save")}),(0,Z.tZ)(ee.zx,{onClick:_,priority:"secondary",children:o("Cancel")})]}):(0,Z.BX)(et.X2,{gap:16,alignItems:"center",children:[(0,Z.tZ)(ei.xv.H2,{children:g.name}),(0,Z.tZ)(ee.hU,{onClick:y,title:o("Edit name"),priority:"quaternary",children:(0,Z.tZ)(nX.Z,{size:16})})]}),(0,Z.tZ)(ei.xv.B2,{color:"secondary",children:r(y_(),null==g?void 0:g.created_by,(0,H.Z)(null==g?void 0:g.created_at).standardDatetimeWithYear())}),v.result&&(0,Z.tZ)(ei.xv.B2,{color:"secondary",children:r(yZ(),v.result.name)})]}),(0,Z.tZ)(yf,{pub:t,policyId:null!=n?n:"",evalId:i}),(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"Test Cases"}),c?(0,Z.tZ)(yc,{pub:t,evalId:i,policyId:null!=n?n:"",onExampleAdded:m,onFinish:()=>u(!1),policy:b}):(0,Z.tZ)(yh,{pub:t,eval_:g,evalId:i,policyId:null!=n?n:"",policy:b,onAddExamples:()=>u(!0),refetchEval:async()=>{await m()}})]})}):null}class yC extends w.Component{async componentDidMount(){(0,Y.ut)(this.load_coupons_if_window_visible),await this.load_coupons()}componentWillUnmount(){(0,Y.kE)(this.load_coupons_if_window_visible)}async load_coupons(){if(!this.state.loading){this.setState({loading:!0});try{let e=await N().get("/api/v1/coupon");this.setState({coupons:e.body.filter(e=>e.valid&&e.id!==this.props.pub.default_group_coupon)})}catch(e){this.state.coupons||alert((0,Y.zx)(e))}this.setState({loading:!1})}}render(e,t){let{}=e,{loading:i}=t;return(0,Z.BX)("div",{className:"special-offers-page container",children:[this.renderTopBar(),i?(0,Z.tZ)(iI.$j,{className:"loader-centered",labeled:!0}):this.renderCouponsTable()]})}constructor(e,t){super(e,t),(0,M._)(this,"renderTopBar",()=>(0,Z.tZ)("div",{children:(0,Z.BX)(et.gq,{className:"special-offers-topbar",justifyContent:"space-between",children:[(0,Z.BX)(ee.zx,{priority:"secondary",onClick:()=>history.back(),children:["â† ",this.context.iString("Back")]}),(0,Z.BX)(et.gq,{gap:8,children:[(0,Z.tZ)(ee.zx,{priority:"secondary-outline",href:"/publish/groups",leading:(0,Z.tZ)(um.Z,{}),children:this.context.iString("Manage group subscription offers")}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>(0,B.route)("/publish/offers/new"),leading:(0,Z.tZ)(eV.Z,{}),children:this.context.iString("New special offer")})]})]})})),(0,M._)(this,"renderCouponsTable",()=>{let{coupons:e}=this.state,t=null==e?void 0:e.filter(e=>1!==e.max_redemptions);return t&&t.length>0?(0,Z.BX)("table",{className:"coupon-list",children:[(0,Z.BX)("tr",{className:"header-row",children:[(0,Z.tZ)("th",{className:"primary coupon-name",children:this.context.iString("Offer Name")}),(0,Z.tZ)("th",{className:"coupon-terms",children:this.context.iString("Terms")}),(0,Z.tZ)("th",{className:"coupon-redemptions",children:this.context.iString("Redemptions")}),(0,Z.tZ)("th",{className:"coupon-expiry",children:this.context.iString("Expires")})]}),t?t.map(e=>(0,Z.BX)("a",{className:"tr",href:"/publish/offers/".concat(e.code||e.id),children:[(0,Z.BX)("td",{className:k()("primary",{bold:e.is_default||e.is_group_default}),children:[e.name,e.is_default||e.is_group_default?this.context.iString(" (on for everybody)"):""]}),(0,Z.tZ)("td",{className:e.is_default||e.is_group_default?"bold":"",children:(0,Y.ig)(e,void 0,{language:this.context.language})}),(0,Z.BX)("td",{className:e.is_default||e.is_group_default?"bold":"",children:[(0,er.numberToString)(e.times_redeemed),e.max_redemptions>0&&"/".concat((0,er.numberToString)(e.max_redemptions))]}),(0,Z.tZ)("td",{className:e.is_default||e.is_group_default?"bold":"",children:e.redeem_by?(0,H.Z)(e.redeem_by).standardDate():"-"})]})):(0,Z.tZ)("tr",{children:(0,Z.tZ)("td",{children:this.context.iString("Loadingâ€¦")})})]}):(0,Z.BX)(ei.xv,{translated:!0,as:"p",className:"empty-coupon-list",children:["No offers yet. Why not ",(0,Z.tZ)("a",{href:"/publish/offers/new",children:" create one"}),"?"]})}),this.load_coupons_if_window_visible=()=>(0,Y.dr)()&&this.load_coupons()}}(0,M._)(yC,"contextType",Q.wj);class yx extends w.Component{getNormalizedDate(e){var t,i;return this.props.dateOnly?(t=e,i=this.props.dateOnlyEOD,new Date(t.getFullYear(),t.getMonth(),t.getDate(),23*!!i,59*!!i,59*!!i)):e}getDefaultDate(){return this.getNormalizedDate(this.props.date)}getFirstDate(){return this.getNormalizedDate(this.props.firstDate)}getLastDate(){return this.getNormalizedDate(this.props.lastDate)}getDate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{month:t,day:i,year:n,hour:r,minute:o}=Object.assign({},this.state,e);void 0===t&&(t=this.getDefaultDate().getMonth()),void 0===i&&(i=this.getDefaultDate().getDate()),void 0===n&&(n=this.getDefaultDate().getFullYear()),void 0===r&&(r=this.getDefaultDate().getHours()),void 0===o&&(o=this.getDefaultDate().getMinutes()),i*=1,r*=1,o*=1;let a=new Date(n*=1,(t*=1)+1,0).getDate();i>a&&(i=a);let l=this.getNormalizedDate(new Date(n,t,i,r,o));return l<this.getFirstDate()?this.getFirstDate():l>this.getLastDate()?this.getLastDate():l}getDateParts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.getDate(e);return{month:t.getMonth(),day:t.getDate(),year:t.getFullYear(),hour:t.getHours(),minute:t.getMinutes(),daysInMonth:new Date(t.getFullYear(),t.getMonth()+1,0).getDate()}}isChanged(){let e=this.getDate();return this.props.date.getFullYear()!==e.getFullYear()||this.props.date.getMonth()!==e.getMonth()||this.props.date.getDate()!==e.getDate()||!this.props.dateOnly&&(this.props.date.getHours()!==e.getHours()||this.props.date.getMinutes()!==e.getMinutes())}async save(){await (0,Y.Se)(this,"saving",async()=>{var e,t;await (null===(e=(t=this.props).onSave)||void 0===e?void 0:e.call(t,this.getDate()))})}render(e,t){let{className:i,disabled:n,dateOnly:r,cancelable:o,dateTimeSeparator:a=", ",onSave:l,iString:s}=e,{saving:d}=t,{month:c,day:u,year:p,hour:h,minute:m,daysInMonth:g}=this.getDateParts();return(0,Z.BX)("span",{"data-testid":"date-editor",className:k()("date-editor",i),children:[(0,Z.tZ)("select",{name:"month",onInput:this.onChange.bind(this),disabled:n,children:[s("Jan"),s("Feb"),s("Mar"),s("Apr"),s("May"),s("Jun"),s("Jul"),s("Aug"),s("Sep"),s("Oct"),s("Nov"),s("Dec")].map((e,t)=>(0,Z.tZ)("option",{value:t,selected:t===c,children:e})).filter((e,t)=>!(this.getFirstDate().getFullYear()===p&&this.getFirstDate().getMonth()>t)&&!(this.getLastDate().getFullYear()===p&&this.getLastDate().getMonth()<t))}),(0,Z.tZ)("select",{name:"day",onInput:this.onChange.bind(this),disabled:n,children:Array.from({length:g},(e,t)=>(0,Z.tZ)("option",{value:t+1,selected:t+1===u,children:t+1})).filter((e,t)=>!(this.getFirstDate().getFullYear()===p&&this.getFirstDate().getMonth()===c&&this.getFirstDate().getDate()>t+1)&&!(this.getLastDate().getFullYear()===p&&this.getLastDate().getMonth()===c&&this.getLastDate().getDate()<t+1))}),(0,Z.tZ)("select",{name:"year",onInput:this.onChange.bind(this),disabled:n,children:Array.from({length:this.getLastDate().getFullYear()-this.getFirstDate().getFullYear()+1},(e,t)=>(0,Z.tZ)("option",{value:this.getFirstDate().getFullYear()+t,selected:this.getFirstDate().getFullYear()+t===p,children:this.getFirstDate().getFullYear()+t}))}),!r&&[a,(0,Z.tZ)("select",{name:"hour",onInput:this.onChange.bind(this),disabled:n,children:Array.from({length:24},(e,t)=>t).filter(e=>!(this.getFirstDate().getFullYear()===p&&this.getFirstDate().getMonth()===c&&this.getFirstDate().getDate()===u&&this.getFirstDate().getHours()>e)&&!(this.getLastDate().getFullYear()===p&&this.getLastDate().getMonth()===c&&this.getLastDate().getDate()===u&&this.getLastDate().getHours()<e)).map(e=>(0,Z.BX)("option",{value:e,selected:e===h,children:[e%12||12," ",e<12?"am":"pm"]}))}),":",(0,Z.tZ)("select",{name:"minute",onInput:this.onChange.bind(this),disabled:n,children:Array.from({length:60},(e,t)=>t).filter(e=>!(this.getFirstDate().getFullYear()===p&&this.getFirstDate().getMonth()===c&&this.getFirstDate().getDate()===u&&this.getFirstDate().getHours()===h&&this.getFirstDate().getMinutes()>e)&&!(this.getLastDate().getFullYear()===p&&this.getLastDate().getMonth()===c&&this.getLastDate().getDate()===u&&this.getLastDate().getHours()===h&&this.getLastDate().getMinutes()<e)).map(e=>(0,Z.tZ)("option",{value:e,selected:e===m,children:e>=10?e:"0".concat(e)}))}),!n&&this.isChanged()&&!!l&&[(0,Z.tZ)("br",{}),(0,Z.tZ)(ee.zx,{disabled:d,priority:"primary",onClick:this.save.bind(this),children:s("Save")}),o&&(0,Z.tZ)(ee.zx,{disabled:d,priority:"secondary",onClick:()=>this.setState({month:void 0,day:void 0,year:void 0,hour:void 0,minute:void 0}),children:s("Cancel")})]]]})}constructor(...e){super(...e),(0,M._)(this,"onChange",e=>{let t=e.target.name,i=e.target.value,n=this.getDateParts({[t]:i});(0,Y.nn)(this,async e=>{let t=eI()(n,["year","month","day","hour","minute"].filter(t=>n[t]!==e[t]));await (0,Y.IW)(this,t),this.props.onChange&&this.props.onChange(this.getDate())})})}}let yS=(0,Q.fz)(yx);function yk(){let e=(0,G._)(["for "," months"]);return yk=function(){return e},e}let yB={percent_off:20,duration:"forever",duration_in_months:12,redeem_by:(0,H.Z)().add(7,"day").toDate(),yearly_only:!1,founding_only:!1,edu_only:!1,group_only:!1,max_redemptions:1,id:"",name:"",valid:!0},yT=e=>{let{pub:t,offer_id:i,popup:n}=e,{iString:r,iTemplate:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(yB),[s,d]=(0,A.eJ)(!1),[c,u]=(0,A.eJ)(!1),p=(0,A.sO)(null),{id:h,name:m,description:g,percent_off:v,duration:b,duration_in_months:y,code:_,show_code:w,trial_period_days:C,redeem_by:x,show_redeem_by:S,is_default:k,is_group_default:T,yearly_only:I,founding_only:P,edu_only:E,allowed_suffixes:X,allowed_suffixes_checked:M,group_only:D,extra_seats:R}=a,F=(0,nC.HL)(a),L=(0,A.I4)((e,t)=>{let i=(0,f._)({},a,e);"EXTRA_SEATS"!==(0,nC.HL)(a)||(e.yearly_only&&i.founding_only&&(i.founding_only=!1),e.founding_only&&i.yearly_only&&(i.yearly_only=!1),e.extra_seats||(i.extra_seats=1)),l(i),t&&setTimeout(t,0)},[a]);return(0,A.d4)(()=>{i&&!s&&!c&&(async()=>{d(!0);try{var e;let t=(await N().get("/api/v1/coupon/".concat(i))).body;if(!t.valid)throw Error(r("Coupon no longer valid"));let n=Object.assign(t,{percent_off:((e=t.percent_off)&&(e.endsWith(".00")&&(e=e.split(".")[0]),e="".concat(e,"%")),e),show_code:!!t.code,show_redeem_by:!!t.redeem_by,allowed_suffixes_checked:!!t.allowed_suffixes},...Object.keys(yB).filter(e=>!t[e]).map(e=>({[e]:yB[e]})));l(n),u(!0)}catch(e){alert((0,Y.zx)(e))}d(!1)})()},[c,r,s,i]),(0,Z.BX)("div",{className:"edit-special-offer-page container",children:[(0,Z.tZ)("p",{className:"special-offers-topbar",children:(0,Z.BX)(ee.zx,{onClick:()=>n?window.close():history.back(),children:["â† ",r("Back")]})}),(0,Z.BX)(tP.ZP,{className:"special-offer-box",method:h||i?"put":"post",action:"/api/v1/coupon".concat(h||i?"/".concat(h||i):""),onSuccess:e=>{n?(window.postMessage&&window.postMessage({coupon:e.body},window.origin),window.close()):(0,B.route)("/publish/offers/".concat(e.body.id),!0)},autoLock:!0,loading:s,children:[(0,Z.tZ)("div",{className:"special-offer-box-bar",children:(0,Z.tZ)("h2",{children:i?r("Edit special offer"):r("Create a special offer")})}),(0,Z.BX)("div",{children:[(0,Z.BX)("p",{className:"special-offer-inputs",children:[r("Name"),(0,Z.tZ)("br",{}),(0,Z.tZ)("input",{name:"name",type:"text",placeholder:i?"":r("E.g. Christmas Specialâ€¦"),value:null!=m?m:void 0,onInput:e=>L({name:e.target.value})})]}),(0,Z.BX)("p",{className:"special-offer-inputs",children:[r("Description"),(0,Z.tZ)("br",{}),(0,Z.tZ)(tJ.Z,{name:"description",fill:!0,placeholder:r("What will readers see on this offer page?"),value:g,maxLength:100,onChange:e=>L({description:e.target.value})})]}),(0,Z.BX)("p",{className:"special-offer-inputs",children:[r("Terms"),(0,Z.tZ)("br",{}),(0,Z.BX)("label",{children:[(0,Z.tZ)("input",{type:"radio",name:"coupon_type",checked:"PERCENT_OFF"===F,onClick:()=>L({trial_period_days:0,extra_seats:0})}),r("Percent Discount")]}),(0,Z.BX)("label",{children:[(0,Z.tZ)("input",{type:"radio",name:"coupon_type",checked:"FREE_TRIAL"===F,onClick:()=>L({trial_period_days:7,extra_seats:0})}),r("Free Trial")]}),(0,Z.tZ)(eW.SiteConfigGate,{configKey:"extra_seats_coupon_type",value:!0,children:(0,Z.BX)("label",{children:[(0,Z.tZ)("input",{type:"radio",name:"coupon_type",checked:"EXTRA_SEATS"===F,onClick:()=>L({trial_period_days:0,extra_seats:1,yearly_only:!0,founding_only:!1})}),r("Extra seats")]})}),(0,Z.tZ)("br",{}),"PERCENT_OFF"===F&&(0,Z.BX)("label",{children:[r("Get"),(0,Z.tZ)("input",{name:"percent_off",className:"inline",type:"text",value:null!=v?v:"",onInput:e=>L({percent_off:e.target.value})}),r("off"),(0,Z.BX)("select",{name:"duration",className:"inline",value:null!=b?b:void 0,onInput:e=>L({duration:e.target.value}),children:[(0,Z.tZ)("option",{value:"forever",children:r("forever")}),(0,Z.tZ)("option",{value:"repeating",children:o(yk(),(0,er.numberToString)(null!=y?y:""))})]}),(0,Z.tZ)("input",{name:"duration_in_months",type:"hidden",value:"repeating"===b&&null!=y?y:void 0}),(0,Z.tZ)("input",{name:"trial_period_days",type:"hidden",value:""})]}),"FREE_TRIAL"===F&&(0,Z.BX)("label",{children:[r("Free for"),(0,Z.BX)("select",{name:"trial_period_days",className:"inline",value:null!=C?C:void 0,onInput:e=>{L({trial_period_days:e.target.value})},children:[C&&![1,2,7,14,30,60,90,180].includes(+C)&&(0,Z.BX)("option",{value:C,children:[C," days"]}),(0,Z.tZ)("option",{value:"1",children:r("24 hours")}),(0,Z.tZ)("option",{value:"2",children:r("48 hours")}),(0,Z.tZ)("option",{value:"7",children:r("7 days")}),(0,Z.tZ)("option",{value:"14",children:r("14 days")}),(0,Z.tZ)("option",{value:"30",children:r("30 days")}),(0,Z.tZ)("option",{value:"60",children:r("60 days")}),(0,Z.tZ)("option",{value:"90",children:r("90 days")}),(0,Z.tZ)("option",{value:"180",children:r("180 days")})]}),(0,Z.tZ)("input",{name:"percent_off",type:"hidden",value:""}),(0,Z.tZ)("input",{name:"duration",type:"hidden",value:""}),(0,Z.tZ)("input",{name:"duration_in_months",type:"hidden",value:""})]}),"EXTRA_SEATS"===F&&(0,Z.BX)("label",{children:[r("Get"),(0,Z.tZ)("input",{name:"extra_seats",className:"inline",type:"number",min:"1",max:"10",value:null!=R?R:void 0,onInput:e=>L({extra_seats:Number(e.target.value)})}),r("additional seats")]})]}),(0,Z.BX)("p",{className:"special-offer-inputs",children:[r("More options"),(0,Z.tZ)("br",{}),"EXTRA_SEATS"===F?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("input",{name:"is_default",type:"hidden",value:!1}),(0,Z.tZ)("input",{name:"is_group_default",type:"hidden",value:!1}),(0,Z.tZ)("input",{name:"edu_only",type:"hidden",value:!1})]}):(0,Z.BX)(Z.HY,{children:[(0,Z.BX)("label",{children:[(0,Z.tZ)("input",{name:"show_redeem_by",type:"checkbox",checked:S,onInput:e=>L({show_redeem_by:e.target.checked})}),r("Set when customers must redeem this offer by"),S&&[(0,Z.tZ)("br",{}),(0,Z.tZ)(yS,{className:"inline",date:eS()(x)?new Date:new Date(x),firstDate:(0,H.Z)().add(1,"day").min(...[x].filter(e=>e)).toDate(),lastDate:(0,H.Z)().add(1,"year").max(x).toDate(),dateOnly:!0,dateOnlyEOD:!0,onChange:e=>L({redeem_by:e})})],(0,Z.tZ)("input",{name:"redeem_by",type:"hidden",value:S&&!eS()(x)?new Date(x).toISOString():void 0})]}),(0,Z.tZ)("br",{}),(0,Z.BX)("label",{children:[(0,Z.tZ)("input",{name:"show_code",type:"checkbox",checked:w,onInput:e=>{L({show_code:e.target.checked},()=>{if(e.target.checked&&p.current){var t,i;p.current.focus(),null===(t=(i=p.current).select)||void 0===t||t.call(i)}})}}),r("Set a special short link"),w?[(0,Z.tZ)("br",{}),(0,Z.BX)("span",{className:"input-prefix",onClick:e=>{var t,i,n;e.preventDefault(),null===(t=p.current)||void 0===t||t.focus(),null===(n=p.current)||void 0===n||null===(i=n.select)||void 0===i||i.call(n)},children:[t.base_url,"/",(0,Z.tZ)("input",{ref:p,name:"code",className:"inline",type:"text",value:null!=_?_:void 0,onInput:e=>L({code:e.target.value})})]})]:(0,Z.tZ)("input",{name:"code",type:"hidden",value:void 0})]}),(0,Z.tZ)("br",{}),(0,Z.BX)("label",{children:[(0,Z.tZ)("input",{name:D?"is_group_default":"is_default",type:"checkbox",checked:D?T:k,onInput:e=>L({is_default:e.target.checked,is_group_default:e.target.checked})}),(0,Z.tZ)("input",{name:D?"is_default":"is_group_default",type:"hidden",value:!1}),r("Give this offer to anyone who subscribes (no link required)")]}),(0,Z.tZ)("br",{}),(0,Z.BX)("label",{children:[(0,Z.tZ)("input",{name:"edu_only",type:"checkbox",checked:E,onInput:e=>{let t=e.target.checked;return L({edu_only:t,is_default:k&&!t,is_group_default:T&&!t})}}),r("Limit this offer to emails from educational institutions")]}),(0,Z.tZ)("br",{})]}),(0,Z.BX)("label",{children:[(0,Z.tZ)("input",{name:"yearly_only",type:"checkbox",checked:I,onInput:e=>L({yearly_only:e.target.checked})}),r("Limit this offer to annual plans")]}),(0,Z.tZ)("br",{}),"EXTRA_SEATS"===F&&(0,Z.BX)(Z.HY,{children:[(0,Z.BX)("label",{children:[(0,Z.tZ)("input",{name:"founding_only",type:"checkbox",checked:P,onInput:e=>L({founding_only:e.target.checked})}),r("Limit this offer to founding plans")]}),(0,Z.tZ)("br",{})]}),"EXTRA_SEATS"===F?(0,Z.tZ)("input",{name:"group_only",type:"hidden",value:!1}):(0,Z.BX)(Z.HY,{children:[(0,Z.BX)("label",{children:[(0,Z.tZ)("input",{name:"group_only",type:"checkbox",checked:D,onInput:e=>L({group_only:e.target.checked})}),r("Limit this offer to group subscriptions")]}),(0,Z.tZ)("br",{}),(0,Z.BX)("label",{children:[(0,Z.tZ)("input",{name:"allowed_suffixes_checked",type:"checkbox",checked:M,onInput:e=>{let t=e.target.checked;return L({allowed_suffixes_checked:t,is_default:k&&!t,is_group_default:T&&!t})}}),r("Limit this offer to emails ending with"),":"]}),M&&(0,Z.tZ)("input",{name:"allowed_suffixes",type:"text",value:null!=X?X:void 0,onInput:e=>L({allowed_suffixes:e.target.value})})]})]}),(0,Z.tZ)("div",{id:"error-container"})]}),(0,Z.BX)("div",{className:"special-offer-box-bar",children:[(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",children:i?r("Update offer"):r("Create offer")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>n?window.close():history.back(),children:r("Cancel")})]})]})]})};function yI(){let e=(0,G._)(["Must be redeemed by ",""]);return yI=function(){return e},e}function yN(){let e=(0,G._)(["Only applies to emails ending ",""]);return yN=function(){return e},e}class yP extends w.Component{async componentDidMount(){(0,Y.ut)(this.load_coupon_if_window_visible),await this.load_coupon()}componentWillUnmount(){(0,Y.kE)(this.load_coupon_if_window_visible)}async load_coupon(){if(!this.state.loading){this.setState({loading:!0});try{let e=await N().get("/api/v1/coupon/".concat(this.props.offer_id)).query({redemptions:!0});if(!e.body.valid)throw Error("Coupon no longer valid");this.setState(Object.assign({has_more_redemptions:!0},e.body))}catch(e){this.state.id||alert((0,Y.zx)(e))}this.setState({loading:!1})}}async load_more_redemptions(e){if(this.state.has_more_redemptions&&!this.state.loading_redemptions){this.setState({loading_redemptions:!0});try{var t,i;let e=await N().get("/api/v1/coupon/".concat(this.state.id,"/redemptions")).query({limit:20,offset:(null!==(t=this.state.redemptions)&&void 0!==t?t:[]).length});this.setState({redemptions:(null!==(i=this.state.redemptions)&&void 0!==i?i:[]).concat(e.body),has_more_redemptions:e.body.length>=20})}catch(t){e&&alert((0,Y.zx)(t))}this.setState({loading_redemptions:!1})}}async unset_as_default(){if(!this.state.unsetting_default){this.setState({unsetting_default:!0});try{let e=await N().put("/api/v1/coupon/".concat(this.state.id)).send(Object.assign({},this.state,{is_default:!1,is_group_default:!1}));this.setState(e.body)}catch(e){alert((0,Y.zx)(e))}this.setState({unsetting_default:!1})}}async delete_coupon(){if(!this.state.deleting&&confirm(this.context.iString("Are you sure you want to delete this offer? Anyone who has already redeemed it will be unaffected"))){this.setState({deleting:!0});try{await N().delete("/api/v1/coupon/".concat(this.state.id)),(0,B.route)("/publish/offers",!0)}catch(e){alert((0,Y.zx)(e))}this.setState({deleting:!1})}}render(e,t){let{pub:i,offer_id:n}=e,{deleting:r,unsetting_default:o,id:a,name:l,description:s,code:d,redeem_by:c,edu_only:u,monthly_only:p,yearly_only:h,group_only:m,allowed_suffixes:g,times_redeemed:v,max_redemptions:b,trial_period_days:y,percent_off:f,duration:_,duration_in_months:w,is_default:C,is_group_default:x,redemptions:S,has_more_redemptions:k,loading_redemptions:T,extra_seats:I}=t,N="".concat(i.base_url,"/").concat(d||n),P=!eS()(I)&&I>0;return a?(0,Z.BX)("div",{className:"special-offer-page container",children:[(0,Z.tZ)("p",{className:"special-offers-topbar",children:(0,Z.BX)(ee.zx,{priority:"secondary",onClick:()=>history.back(),children:["â† ",this.context.iString("Back")]})}),(0,Z.BX)("div",{className:"special-offer-box",children:[(0,Z.BX)("div",{className:"special-offer-box-bar",children:[(0,Z.tZ)(ee.zx,{priority:"secondary-outline",disabled:r,onClick:()=>this.delete_coupon(),children:r?this.context.iString("Deletingâ€¦"):this.context.iString("Delete")}),(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:()=>(0,B.route)("/publish/offers/".concat(a||n,"/edit")),children:this.context.iString("Edit")}),(0,Z.tZ)("h2",{children:l||"\xa0"})]}),(C||x)&&(0,Z.BX)("div",{className:"special-offer-box-bar",children:[(0,Z.tZ)(ee.zx,{priority:"secondary-outline",disabled:o,onClick:()=>this.unset_as_default(),children:o?this.context.iString("Disablingâ€¦"):this.context.iString("Disable")}),(0,Z.tZ)("h2",{className:"notice",children:this.context.iString("This offer is available to all new subscribers (no special link required)")})]}),P?(0,Z.tZ)("div",{children:(0,Z.tZ)(et.hs,{paddingY:16,children:'Add this special offer to a welcome email or ad-hoc email by inserting "Special offer" in the "Buttons" dropdown'})}):(0,Z.BX)("div",{className:"coupon-code-link",children:[(0,Z.tZ)("a",{href:N,target:"_blank",native:!0,children:N}),(0,Z.tZ)("br",{}),(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:()=>{(0,Y.vQ)(N),this.setState({copied:!0})},children:this.context.iString("Copy link")}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>(0,Y.uX)((0,j.qYj)(i,{coupon:JSON.stringify({id:a,trial_period_days:y,percent_off:f,duration:_,duration_in_months:w})}),{newTab:!0}),children:this.context.iString("Send by email")})]}),(0,Z.BX)("div",{children:[s&&(0,Z.BX)("p",{children:[(0,Z.tZ)("b",{children:this.context.iString("Description")}),(0,Z.tZ)("br",{}),s]}),(0,Z.BX)("p",{children:[(0,Z.tZ)("b",{children:this.context.iString("Terms")}),(0,Z.tZ)("br",{}),l?(0,Y.ig)({trial_period_days:y,percent_off:f,duration:_,duration_in_months:w,extra_seats:I,max_redemptions:this.state.max_redemptions,name:this.state.name,id:this.state.id,valid:this.state.valid},void 0,{language:this.context.language}):"\xa0",c&&[(0,Z.tZ)("br",{}),this.context.iTemplate(yI(),(0,H.Z)(c).standardDate())],h&&[(0,Z.tZ)("br",{}),this.context.iString("Only applies to yearly subscriptions")],p&&[(0,Z.tZ)("br",{}),this.context.iString("Only applies to monthly subscriptions")],m&&[(0,Z.tZ)("br",{}),this.context.iString("Only applies to group subscriptions")],u&&[(0,Z.tZ)("br",{}),this.context.iString("Only applies to academic email accounts")],g&&[(0,Z.tZ)("br",{}),this.context.iTemplate(yN(),g)]]})]}),(0,Z.BX)("div",{children:[(0,Z.tZ)("p",{children:(0,Z.BX)("b",{children:[this.context.iString("Redemptions")," (",(0,er.numberToString)(v||0),b?"/".concat((0,er.numberToString)(b)):"",")"]})}),S&&S.length>0&&(0,Z.BX)("table",{children:[(0,Z.BX)("tr",{className:"header-row",children:[(0,Z.tZ)("th",{className:"primary",children:this.context.iString("User")}),(0,Z.tZ)("th",{className:"",children:this.context.iString("Date redeemed")})]}),S.map(e=>(0,Z.BX)("a",{className:"tr",href:(0,j.pN7)(i,e.email),children:[(0,Z.tZ)("td",{className:"primary",children:e.email}),(0,Z.tZ)("td",{children:(0,H.Z)(e.created_at).standardDatetime()})]})),k&&(0,Z.BX)("tr",{className:"loading-row",children:[(0,Z.tZ)("td",{children:(0,Z.tZ)(h5.Z,{threshold:256,onVisible:()=>this.load_more_redemptions(),children:(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:()=>this.load_more_redemptions(!0),children:T?this.context.iString("Loadingâ€¦"):this.context.iString("Load moreâ€¦")})})}),(0,Z.tZ)("td",{})]})]})]})]})]}):null}constructor(e,t){super(e,t),(0,M._)(this,"load_coupon_if_window_visible",void 0),this.load_coupon_if_window_visible=()=>(0,Y.dr)()&&this.load_coupon()}}(0,M._)(yP,"contextType",Q.wj);var yE=i(58748),yX=i.n(yE),yM=i(74818),yA=i(52384);let yD=e=>{let{pub:t}=e,i=(0,yA.Q)({pathname:"/api/v1/publication/".concat(t.id,"/pin"),auto:!0,deps:[t]}),n=(0,A.I4)(()=>i.refetch(),[i]);return i.isLoading?(0,Z.tZ)(et.tu,{paddingBottom:20,children:(0,Z.tZ)(iI.$j,{})}):0!==i.result.length?(0,Z.tZ)(yF,{pub:t,scheduledPinnedPosts:{id:"current",publication_id:t.id,created_at:new Date,state:"executed",post_ids:i.result.map(e=>e.post_id),posts:i.result.map(e=>e.post)},onChanged:n}):void 0},yR=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(!1),o=(0,yA.Q)({pathname:"/api/v1/publication/".concat(t.id,"/scheduled-pins"),query:{state:"scheduled"},auto:!0,deps:[t]}),a=o.result||[],l=(0,A.I4)(()=>o.refetch(),[o]);return(0,Z.BX)(Z.HY,{children:[a.map(e=>(0,Z.tZ)(yF,{pub:t,scheduledPinnedPosts:e,onChanged:l})),(0,Z.tZ)(ee.zx,{priority:"primary",size:"sm",onClick:()=>r(!0),children:i("New schedule")}),(0,Z.tZ)(yL,{pub:t,isOpen:n,onClose:()=>r(!1),onSave:l})]})},yF=e=>{let{pub:t,scheduledPinnedPosts:i,onChanged:n}=e,{iString:r,language:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(!1);return(0,Z.BX)(et.tu,{className:"scheduled-pinned-posts",paddingBottom:20,style:{maxWidth:480},children:[(0,Z.BX)(ei.xv.H3,{className:"primary",children:[i.scheduled_at?(0,H.Z)(i.scheduled_at).locale(o).format("YYYY MMM D, hh:mm:ss"):r("Current pins")," ","(",(0,Z.tZ)(ee.zx,{priority:"tertiary",size:"sm",onClick:()=>l(!0),children:r("edit")}),")"]}),i.posts.map(e=>(0,Z.tZ)("a",{href:(0,j.uRy)(t,e),target:"_blank",rel:"noopener",style:{textDecoration:"none"},children:(0,Z.tZ)(ei.xv.B4,{color:"pub-secondary-text",ellipsis:!0,children:yz(e,o)})})),(0,Z.tZ)(yL,{pub:t,scheduledPinnedPosts:i,isCurrent:!i.scheduled_at,isOpen:a,onClose:()=>l(!1),onSave:n})]})},yL=e=>{let{pub:t,scheduledPinnedPosts:i,isCurrent:n,isOpen:r,onSave:o,onClose:a}=e,{iString:l,language:s}=(0,Q.M1)(),[d,c]=(0,A.eJ)(new Date((null==i?void 0:i.scheduled_at)||Date.now())),[u,p]=(0,A.eJ)((null==i?void 0:i.posts)||[]),h=(0,A.I4)(e=>{p(u.filter(t=>t.id!==e.id))},[u]),m=(0,A.I4)(e=>{p(u.filter(t=>t.id!==e.id).concat([e])),v("")},[u]),[g,v]=(0,A.eJ)(""),b=(0,yA.Q)({pathname:"/api/v1/archive",query:{sort:"new",limit:8,search:g},auto:!1,deps:[g]}),y=(0,yA.Q)({pathname:"/api/v1/drafts",query:{filter:"scheduled",offset:0,limit:49},auto:!0,deps:[]}),f=(0,iS.Kt)(()=>b.refetch(),100,[b]),_=(0,A.I4)(e=>{v(e.target.value||""),e.target.value&&f()},[v,f]),w=function(e,t,i,n){let r=[];if(n){if(i)for(let e of i)(function(e,t){let i=yX()(t).map(e=>RegExp(e,"i"));if(i.length>0){for(let t of[e.title,e.draft_title,e.subtitle,e.draft_subtitle])if(t&&i.every(e=>e.test(t)))return!0}return!1})(e,n)&&r.push(e);t&&r.push(...t)}let o=nN()(e,"id");return r.filter(e=>!o[e.id])}(u,b.result,y.result,g),[C,x]=(0,A.eJ)(null),[S,k]=(0,A.eJ)(null),B=(0,A.I4)(e=>{let t=Number(e.target.getAttribute("data-post-id"));t&&(e.dataTransfer.effectAllowed="move",x(t))},[x]),T=(0,A.I4)(e=>{if(e.preventDefault(),C){let t=(0,Y.yY)(e.target,e=>{var t;return"hasAttribute"in e&&(null===(t=e.hasAttribute)||void 0===t?void 0:t.call(e,"data-post-id"))}),i=Number(t&&"getAttribute"in t&&(null==t?void 0:t.getAttribute("data-post-id")));i&&k(i)}},[C,k]),I=(0,A.I4)(e=>{if(e.preventDefault(),C&&S&&C!==S){let e=u.findIndex(e=>e.id===C),t=u.findIndex(e=>e.id===S),[i]=u.splice(e,1);u.splice(t,0,i),p(u)}x(null),k(null)},[C,S,u]),[P,E]=(0,A.eJ)(!1),X=(0,A.I4)(async()=>{E(!0);try{let e={post_ids:u.map(e=>e.id),scheduled_at:d.toISOString()},r=n?N().post("/api/v1/publication/".concat(t.id,"/pin")):i?N().put("/api/v1/publication/".concat(t.id,"/scheduled-pins/").concat(i.id)):N().post("/api/v1/publication/".concat(t.id,"/scheduled-pins"));await r.send(e),o(),a()}catch(e){console.error(e),alert((0,Y.zx)(e))}E(!1)},[t,i,n,d,u,E,o,a]),M=(0,A.I4)(async()=>{if(E(!0),confirm(l("Are you sure you want to delete this schedule?")))try{await N().delete("/api/v1/publication/".concat(t.id,"/scheduled-pins/").concat(i.id)),o(),a()}catch(e){alert((0,Y.zx)(e))}E(!1)},[t,i,E,o,a]);return(0,Z.BX)(eK.u_,{isOpen:r,onClose:a,children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:a,title:l("Schedule pinned posts")}),(0,Z.BX)(eK.fe,{children:[!n&&(0,Z.BX)(et.tu,{children:[(0,Z.BX)(ei.xv.H4,{paddingTop:20,paddingBottom:4,children:[l("Time")," (",(0,H.Z)().locale(s).format("z"),")"]}),(0,Z.tZ)(aT.Tz,{value:d,onChange:e=>c(new Date(e.currentTarget.value))})]}),u.length>0&&(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ei.xv.H4,{paddingTop:20,paddingBottom:4,translated:!0,children:"Posts"}),u.map(e=>(0,Z.BX)(et.gq,{justifyContent:"space-between",style:{cursor:"pointer"},"data-post-id":e.id,draggable:!0,onDragStart:B,onDragOver:T,onDragEnd:I,onDrop:I,children:[(0,Z.tZ)(ei.xv,{ellipsis:!0,children:yz(e,s)}),(0,Z.tZ)(ee.zx,{priority:"tertiary",size:"sm",onClick:()=>h(e),children:(0,Z.tZ)(yM.Z,{})})]}))]}),(0,Z.BX)("div",{children:[(0,Z.tZ)(ei.xv.H4,{paddingTop:20,paddingBottom:4,translated:!0,children:"Add a post"}),(0,Z.tZ)(tD.oi,{placeholder:"Search for postsâ€¦",value:g,onChange:_}),b.isLoading?(0,Z.tZ)(ei.xv,{color:"pub-secondary-text",paddingTop:4,translated:!0,children:"Loadingâ€¦"}):w.length>0?(0,Z.tZ)(et.tu,{gap:4,paddingTop:4,children:w.map(e=>(0,Z.BX)(et.gq,{justifyContent:"space-between",onClick:()=>m(e),style:{cursor:"pointer"},children:[(0,Z.tZ)(ei.xv,{children:yz(e,s)}),(0,Z.tZ)(eV.Z,{})]}))}):g?(0,Z.tZ)(ei.xv,{color:"pub-secondary-text",paddingTop:4,translated:!0,children:"No results"}):null]})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:X,disabled:P,children:l("Save")}),secondaryButton:i&&!n&&(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:M,disabled:P,children:l("Delete")})})]})};function yz(e,t){let{iString:i}=I18N.i(t);return(0,er.truncateText)(e.title||e.draft_title||i("Untitled"),40)}let yO=e=>{let{pub:t}=e;return(0,Z.tZ)("div",{className:"page typography",children:(0,Z.BX)("div",{className:"container",children:[(0,Z.tZ)(et.tu,{paddingTop:24,paddingBottom:16,children:(0,Z.tZ)(ei.xv.H1,{translated:!0,children:"Pinned Posts"})}),(0,Z.tZ)(yD,{pub:t}),(0,Z.tZ)(yR,{pub:t})]})})};var yU=i(79546),yY=i.n(yU),yH=i(69047),yj=i(28373),yJ=i(99318);let yV=[{key:"country",valueFn:e=>(0,Z.tZ)("span",{className:"bold",children:(0,er.truncateText)(e.name,30)})},{key:"percent_of_total_downloads",align:"right",wrap:!1,valueFn:e=>(0,er.decimalToPercent)(e.percent_of_total_downloads,{rounded:!0,display:!0})}],yq=e=>{let{sectionId:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(d6,{title:i("Top countries"),subtitle:i("Where your audience is coming from"),children:(0,Z.tZ)(ps,{url:"/api/v1/publication/stats/podcast/countries".concat(t?"?section_id=".concat(t):""),cols:yV,pageSize:5,getRowIcon:e=>{let{code:t}=e;return(0,Z.tZ)("span",{className:"flag",children:"[unknown]"===t?null:(0,Z.tZ)(yJ.Z,{svg:!0,countryCode:t})})},hideHeaders:!0,empty:(0,Z.tZ)(u0,{icon:(0,Z.tZ)(yj.Z,{}),title:i("No country data"),text:i("Country stats will appear here once you create your first episode.")})})})};var yW=i(53328),yG=i(29009),yK=i(46888),yQ=i(14195),y$=i(3023),y0=i(75358),y1=i(80589),y2=i(90722),y4=i(86108);let y3={accent:"var(--color-accent-primary)",detail:"var(--color-utility-detail)",axis:"var(--color-bg-tertiary)",cursor:"var(--color-utility-detail)",total:"var(--color-fg-primary)"},y8=["var(--color-accent-fg-red)","var(--color-accent-fg-orange)","var(--color-accent-fg-yellow)","var(--color-accent-fg-green)","var(--color-accent-fg-cyan)","var(--color-accent-fg-blue)","var(--color-accent-fg-purple)"],y6={Paid:"var(--color-accent-fg-green)",Comps:"var(--color-accent-fg-purple)",Gifts:"var(--color-accent-fg-red)","Free trials":"var(--color-accent-fg-cyan)","Lifetime members":"var(--color-accent-fg-yellow)"},y5={paid:"rgb(var(--color-primitive-green-600-rgb))",upgrade:"var(--color-accent-fg-green)",trial:"rgb(var(--color-primitive-green-400-rgb))",expired:"rgba(var(--color-primitive-red-500-rgb), 0.50)"},y9=(e,t)=>t&&e&&t[e]||y3.accent,y7={CHART_HEIGHT:400,CHART_MARGIN:{top:0,right:0,left:0,bottom:0},TICK_SIZE:4,Y_AXIS_PADDING:{top:12},Y_AXIS_TICK_MARGIN:12,Y_AXIS_MIN_TICK_GAP:24,X_AXIS_TICK_MARGIN:20,X_AXIS_MIN_TICK_GAP:24,X_AXIS_PADDING:{left:8,right:8}};var fe=i(13481);function ft(e){let{fill:t,height:i,points:n}=e;if(!n||0===n.length||!n[0])return null;let{x:r,y:o}=n[0];return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(fe.A,{x:r-14,y:o,fill:t,width:28,height:i,type:"linear",opacity:.025}),(0,Z.tZ)(fe.A,{x:r-1,y:o,fill:t,width:1,height:i,type:"linear",opacity:.5})]})}let fi=()=>(0,Z.BX)("linearGradient",{id:"gradient",x1:"1",y1:"0",x2:"0",y2:"1",children:[(0,Z.tZ)("stop",{offset:"0%",stopColor:y3.accent,stopOpacity:.5}),(0,Z.tZ)("stop",{offset:"100%",stopColor:y3.accent,stopOpacity:.25})]}),fn=e=>{let{color:t,index:i}=e;return(0,Z.BX)("linearGradient",{id:void 0!==i?"gradient-".concat(i):"gradient",x1:"1",y1:"0",x2:"0",y2:"1",children:[(0,Z.tZ)("stop",{offset:"0%",stopColor:t,stopOpacity:.5}),(0,Z.tZ)("stop",{offset:"100%",stopColor:t,stopOpacity:.25})]})},fr=e=>{let{color:t,index:i}=e;return(0,Z.BX)("pattern",{id:i?"gradient-".concat(i):"gradient",patternUnits:"userSpaceOnUse",width:"100%",height:"100%",children:[(0,Z.BX)("linearGradient",{id:"bar-gradient",x1:"0",y1:"1",x2:"0",y2:"0",children:[(0,Z.tZ)("stop",{offset:"0%",stopColor:t,stopOpacity:.75}),(0,Z.tZ)("stop",{offset:"100%",stopColor:t})]}),(0,Z.tZ)("rect",{width:"100%",height:"100%",fill:"url(#bar-gradient)"})]})},fo={text:"text-VdU3b3"},fa=e=>{let{x:t=0,y:i=0,payload:n,isDate:r=!0}=e;if(!n)return null;let o=r?fs(n.value):n.value;return(0,Z.tZ)("g",{transform:"translate(".concat(t,",").concat(i,")"),children:(0,Z.tZ)("text",{className:fo.text,textAnchor:"middle",children:o})})},fl=e=>{let{x:t=0,y:i=0,payload:n,format:r="number"}=e;if(!n)return null;let o=(0,ma.L)(Number(n.value),r);return o===ma.N&&(o="0"),(0,Z.tZ)("g",{transform:"translate(".concat(t,",").concat(i,")"),children:(0,Z.tZ)("text",{className:fo.text,y:4,textAnchor:"end",children:o})})},fs=e=>{try{let t=new Date("string"==typeof e?e:Number(e));if(isNaN(t.getTime()))return String(e);let i=new Date,n=new Date;if(n.setFullYear(i.getFullYear()-1),t>n)return fc.format(t);return fd.format(t)}catch(t){return String(e)}},fd=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric"}),fc=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"}),fu=e=>{let t=e,i=e;switch(e){case"number":t="number-truncated",i="number";break;case"dollar":t="dollar-truncated",i="dollar";break;case"currency":t="currency-truncated",i="currency"}return{axisFormat:t,tooltipFormat:i}};function fp(e){return(0,A.Ye)(()=>{if(!e[0]||!e[1])return{datasetLabels:[],transformedData:[]};let t=e[0].slice(1),i=e.slice(1).map(e=>{let i={};return i.name="string"==typeof e[0]?fh.format(new Date(e[0].split("T")[0]||e[0]))||e[0]:e[0].toString(),e.slice(1).forEach((e,n)=>{var r;let o=t[n];void 0!==o&&(i[o]=null==(r=e)?null:"string"==typeof r?Number(r.replace(/[\$%,]/g,"")):r)}),i});return{datasetLabels:t,transformedData:i}},[e])}let fh=new Intl.DateTimeFormat(void 0,{month:"short",day:"2-digit",year:"numeric"}),fm=e=>{let{label:t}=e;return(0,Z.tZ)(ff,{children:(0,Z.tZ)(ei.xv.B4,{weight:"semibold",color:"primary",children:t})})},fg=e=>{let{total:t,label:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(ff,{children:(0,Z.BX)(fZ,{children:[(0,Z.tZ)(ei.xv.B4,{color:"primary",weight:"semibold",children:i||n("Total")}),(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"primary",children:(0,ma.L)(t,"number")})]})})]})},fv=e=>{var t,i;let{payload:n}=e,r=(null===(i=n[0])||void 0===i?void 0:null===(t=i.payload)||void 0===t?void 0:t.tooltip)||"";return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(ff,{children:(0,Z.tZ)(fZ,{children:(0,Z.tZ)(ei.xv.B4,{color:"secondary",maxWidth:320,children:r})})})]})},fb=e=>{let{color:t}=e;return t?(0,Z.tZ)(ts.xu,{width:12,height:12,radius:"xs",style:{backgroundColor:t},bg:"secondary",flex:"auto"}):null},fy=(0,sx.zo)({display:"flex",direction:"column",radius:"sm",shadow:"md",border:"detail",bg:"primary",userSelect:"none",minWidth:160,maxWidth:280}),ff=(0,sx.zo)({display:"flex",direction:"column",gap:4,padding:8}),f_=(0,sx.zo)({display:"flex",alignItems:"center",justifyContent:"space-between",flex:"grow",gap:8}),fZ=(0,sx.zo)({display:"flex",alignItems:"center",justifyContent:"space-between",flex:"grow",gap:20});var fw=i(20160);let fC=e=>{let{active:t,payload:i,label:n,format:r="number",suffix:o}=e;return t&&i&&0!==i.length?(0,Z.tZ)(fw.W,{children:(0,Z.BX)(fy,{children:[(0,Z.tZ)(fm,{label:n}),(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(ff,{children:(0,Z.tZ)(fx,{payload:i,format:r,suffix:o})})]})}):null},fx=e=>{var t;let{payload:i,format:n,suffix:r}=e;if(!i||0===i.length)return null;let o=(0,ma.L)((null===(t=i[0])||void 0===t?void 0:t.value)!==void 0?i[0].value:0,n,"currency"===n?"USD":void 0);return(0,Z.tZ)(f_,{children:(0,Z.BX)(ei.xv.B4,{weight:"medium",color:"primary",children:[o," ",r]})})},fS=e=>{let{data:t,loading:i,showLegend:n,format:r="number",height:o=y7.CHART_HEIGHT}=e,{axisFormat:a,tooltipFormat:l}=fu(r),{datasetLabels:s,transformedData:d}=fp(t);return 0===d.length?null:i?(0,Z.tZ)(et.M5,{height:o,children:(0,Z.tZ)(iI.$j,{})}):(0,Z.tZ)(yG.h,{height:o,children:(0,Z.BX)(yK.T,{data:d,margin:y7.CHART_MARGIN,children:[(0,Z.tZ)(yQ.q,{stroke:"var(--color-utility-detail)",opacity:.5}),(0,Z.tZ)(y$.K,{dataKey:"name",tick:e=>(0,Z.tZ)(fa,(0,f._)({},e)),axisLine:{stroke:y3.axis},tickLine:{stroke:y3.axis},minTickGap:y7.X_AXIS_MIN_TICK_GAP,tickMargin:y7.X_AXIS_TICK_MARGIN,tickSize:y7.TICK_SIZE}),(0,Z.tZ)(y0.B,{domain:e=>{let[t,i]=e;return function(e,t){let i=t-e;return[Math.max(e-.1*i,0),t+.05*i]}(t,i)},allowDataOverflow:!0,tick:(0,Z.tZ)(fl,{format:a}),axisLine:{stroke:y3.axis},tickLine:{stroke:y3.axis},minTickGap:y7.Y_AXIS_MIN_TICK_GAP,tickMargin:y7.Y_AXIS_TICK_MARGIN,tickSize:y7.TICK_SIZE,scale:"linear"}),(0,Z.tZ)(y1.u,{isAnimationActive:!1,cursor:(0,Z.tZ)(ft,{fill:y3.line}),content:e=>(0,Z.tZ)(fC,{active:e.active,payload:e.payload,label:e.label,format:l})}),(0,Z.tZ)("defs",{children:(0,Z.tZ)(fi,{})}),n&&(0,Z.tZ)(y2.D,{}),s.map((e,t)=>(0,Z.tZ)(y4.u,{dataKey:e,stroke:y3.accent,strokeWidth:2,dot:!1,type:"monotone",activeDot:{r:4},isAnimationActive:!1,fill:"url(#gradient)"},"line-".concat(t)))]})})};var fk=i(85564),fB=i.n(fk),fT=i(82492),fI=i.n(fT),fN=i(55376);yW.kL.register(yW.qi,yW.jn,yW.ZL,yW.od,yW.vn,yW.jI,yW.ST,yW.tt,yW.uw,yW.f$,yW.WV,yW.l7,yW.FB,yW.RM,yW.WY,yW.Gu,yW.De,yW.Dx,yW.u,yW.DK);let fP=fN.kL;class fE extends w.Component{componentDidMount(){"undefined"!=typeof window&&(this._layoutChart=this.layoutChart.bind(this),window.addEventListener("resize",this._layoutChart))}componentWillUnmount(){"undefined"!=typeof window&&this._layoutChart&&window.removeEventListener("resize",this._layoutChart)}layoutChart(){this.chart&&this.chart.chart_instance&&this.chart.chart_instance.resize()}render(e){let t,{className:i,data:n,initialSelection:r,colors:o,noLegend:a,stacked:l,datasetFiller:s,xAxisLabel:d,suggestedYMin:c,suggestedYMax:u,options:p,tooltipLabelPostfix:h,watermarkText:m,watermarkPosition:g,dataLoaded:v}=e;if(!n[0]||!n[1])return console.error("empty data passed to Chart, cannot render",n),null;o=o||n[0].slice(1).map(()=>gb.h1);let b="string"==typeof n[1][1]&&"$"===n[1][1][0],y="string"==typeof n[1][1]&&"%"===n[1][1][n[1][1].length-1],w=Math.max(...fB()(n.slice(1).map(e=>l?e.slice(1).reduce((e,t)=>Number(e)+fX(t),0):e.slice(1).map(fX)))),C=fI()({animation:!1,maintainAspectRatio:!1,elements:{line:{fill:"-1"}},plugins:{tooltip:{mode:"index",intersect:!1,position:"nearest",boxPadding:5,multiKeyBackground:void 0,callbacks:{labelColor:e=>{var t,i;return(0,_._)((0,f._)({},(null===(t=e.dataset)||void 0===t?void 0:t.borderColor)?{backgroundColor:null===(i=e.dataset)||void 0===i?void 0:i.borderColor}:null),{borderWidth:1,borderColor:"white"})},label:e=>{var t,i;let r=e.dataIndex||0,o=e.datasetIndex||0,l=fX(null===(t=n[r+1])||void 0===t?void 0:t[o+1]);if(null===l)return;let s="";if(!a||e.chart.data.datasets.length>1){let t=(null===(i=e.chart.data.datasets[o])||void 0===i?void 0:i.label)||"";t&&(s+="".concat(t,": "))}return b?s+="$".concat((0,er.numberToString)(l)):y?s+="".concat((0,er.numberToString)(l),"%"):s+=(0,er.numberToString)(l),h&&(s+=" ".concat(h)),s}}},legend:{display:!a,labels:{boxWidth:12},onClick(e,t){var i,o,a,l,s;if(!n[0])return;let d=n[0].slice(1).length;if(d<2)return;let c=null===(o=this.chart.legend)||void 0===o?void 0:null===(i=o.legendItems)||void 0===i?void 0:i.indexOf(t),u=null!==(s=null===(l=this.chart.legend)||void 0===l?void 0:null===(a=l.legendItems)||void 0===a?void 0:a.map((e,t)=>this.chart.getDatasetMeta(t)))&&void 0!==s?s:[];(!(r&&r.length!==d&&!this.chart.hadClick||u.reduce((e,t)=>e||t.hidden,!1))||t.hidden)&&(this.chart.hadClick=!0,u[null!=c?c:"undefined"].hidden=!t.hidden,this.chart.update())},onHover:e=>{e.target.style.cursor="pointer"}}},scales:{x:{grid:{color:gb.E5},ticks:(0,f._)({maxTicksLimit:9,color:gb.Aw},d&&{callback:d},m&&{minRotation:50,maxRotation:50})},y:{grid:{color:gb.E5},suggestedMin:void 0!==c?c:w>3?void 0:0,suggestedMax:void 0!==u?u:w>3?void 0:3,ticks:{maxTicksLimit:6,color:gb.Aw,callback:e=>b?"$".concat((0,er.truncateNumber)(e,{minSignificantDigits:e>1e6?3:2})):y?"".concat((0,er.numberToString)(e),"%"):(0,er.numberToString)(e)}}}},p);return v&&(t={id:"custom_canvas_background_text",afterDatasetDraw:e=>{let t=e.canvas.getContext("2d");t.fillStyle="#777",t.textAlign="end",t.textBaseline="alphabetic",t.letterSpacing="0.02em",t.font='normal 500 11px system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, sans-serif',"top"===g?t.fillText(m,e.chartArea.right-16,e.chartArea.top+24):t.fillText(m,e.chartArea.right-16,e.chartArea.bottom-16)}}),(0,Z.tZ)("div",{className:"line-chart ".concat(i||""),children:(0,Z.tZ)(fP,{ref:this.assignChart,redraw:v,type:"line",data:{labels:n.slice(1).map(e=>"string"!=typeof e[0]?e[0].toString():(0,H.Z)(e[0].split("T")[0]).format("MMM DD, YYYY")||e[0]),datasets:n[0].slice(1).map((e,t)=>{var i;return{label:"".concat(e),data:l?n.slice(1).map(e=>null===e[t+1]?null:e.slice(1,t+2).reduce((e,t)=>Number(e)+fX(t),0)):n.slice(1).map(e=>fX(e[t+1])),pointBackgroundColor:null==o?void 0:o[t],backgroundColor:l?"".concat((0,er.normalizeHex)(null!==(i=null==o?void 0:o[t])&&void 0!==i?i:""),"77"):"transparent",borderColor:null==o?void 0:o[t],borderWidth:2,fill:s?s(t):0===t?"origin":void 0,pointRadius:0,hidden:r&&!r.includes(t),lineTension:.1}})},options:C,plugins:v?[t]:[]})})}constructor(...e){super(...e),(0,M._)(this,"chart",void 0),(0,M._)(this,"assignChart",e=>{this.chart=e}),(0,M._)(this,"_layoutChart",void 0)}}function fX(e){return"string"==typeof e?Number(e.replace(/[\$%,]/g,"")):e}let fM=function(e,t){let{loadingDelay:i=150}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},[n,r]=(0,A.eJ)({}),[o,a]=(0,A.eJ)(),[l,s]=(0,A.eJ)(!0),[d,c]=(0,A.eJ)(!1),u=(0,j.rhs)(e,t);return(0,A.d4)(()=>{let e=async()=>{let e=setTimeout(()=>{s(!0)},i);c(!1);try{let t=await N().get(u);return a(t.body),r((0,_._)((0,f._)({},n),{[u]:t.body})),clearTimeout(e)}catch(t){return console.error(t),c(!0),clearTimeout(e)}finally{s(!1)}};n[u]?a(n[u]):e()},[u]),{data:o,loading:l,error:d}},fA=e=>{let{hasAvailableData:t,loading:i,empty:n,error:r,children:o}=e,{iString:a}=(0,Q.M1)();return n||(n=(0,Z.tZ)(u0,{title:a("No data"),icon:(0,Z.tZ)(uG,{})})),(0,Z.tZ)("div",{className:"data-chart",children:(0,Z.BX)("div",{className:"data-chart-content",children:[i&&(0,Z.tZ)(et.M5,{padding:72,children:(0,Z.tZ)(iI.$j,{})}),r?(0,Z.tZ)(u0,{icon:(0,Z.tZ)(eN.Z,{}),title:a("Failed to load"),text:a("Please try reloading the page"),action:(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-outline",onClick:()=>location.reload(),children:a("Reload page")})}):t?o:!i&&n]})})};function fD(){let e=(0,G._)(["Trend from "," to ",""]);return fD=function(){return e},e}let fR=e=>{let{pub:t,sectionId:i}=e,{iString:n,iTemplate:r,language:o}=(0,Q.M1)(),{getConfigFor:a}=(0,io.xR)(),l=!!a("enable_recharts"),s=[{label:n("Daily"),value:"daily"},{label:n("Cumulative"),value:"cumulative"}],d=[{label:n("30 days"),value:(0,H.Z)().subtract(30,"day").locale(o||"en").toISOString()},{label:n("90 days"),value:(0,H.Z)().subtract(90,"day").locale(o||"en").toISOString()},{label:n("All time"),value:t.created_at}],[c,u]=(0,A.eJ)(s[0]),[p,h]=(0,A.eJ)(d[1]),{data:m,loading:g,error:v}=fM("/api/v1/publication/stats/podcast/downloads",{from:p.value,section_id:i}),b=m&&m[c.value];return(0,Z.tZ)(d6,{title:n("Downloads"),subtitle:r(fD(),(0,H.Z)(p.value).locale(o||"en").format("MMM D, YYYY"),(0,H.Z)().locale(o||"en").format("MMM D, YYYY")),action:(0,Z.BX)("div",{style:{display:"flex",gap:"8px"},children:[(0,Z.tZ)(fF,{timeSeriesModes:s,timeSeriesMode:c,setTimeSeriesMode:u}),(0,Z.tZ)(fL,{ranges:d,range:p,setRange:h})]}),children:(0,Z.tZ)(dr,{children:(0,Z.tZ)(fA,{hasAvailableData:(null==b?void 0:b.length)>1,loading:g,empty:(0,Z.tZ)(u0,{icon:(0,Z.tZ)(u$.Z,{}),title:n("No download data"),text:n("No data available within your selected time window")}),error:v,children:l?(0,Z.tZ)(fS,{data:b,loading:g,format:"number"}):(0,Z.tZ)(fE,{data:b,noLegend:!0,tooltipLabelPostfix:n("downloads"),options:{scales:{x:{ticks:{autoSkip:!1,callback:(e,t)=>{if(!(t%(b&&Math.floor(b.length/10))))return e}}}},plugins:{tooltip:{callbacks:{title:e=>{var t,i;let n=e[0],r=null===(t=n.chart)||void 0===t?void 0:t.data;return(0,H.Z)((null==r?void 0:null===(i=r.labels)||void 0===i?void 0:i[n.dataIndex])||new Date,"MMM D, YYYY").locale(o||"en").format("ddd MMM D, YYYY")}}}}}})})})})},fF=e=>{let{timeSeriesModes:t,timeSeriesMode:i,setTimeSeriesMode:n}=e;return(0,Z.tZ)(oY.i,{value:(null==i?void 0:i.value)||"",onChange:e=>{let i=e.currentTarget.value,r=t.find(e=>e.value===i);r&&n(r)},children:t.map(e=>(0,Z.tZ)("option",{value:e.value,children:e.label},e.value))})},fL=e=>{let{ranges:t,range:i,setRange:n}=e,r=t.findIndex(e=>e.label===i.label);return(0,Z.tZ)(oY.i,{value:r.toString(),onChange:e=>{let i=parseInt(e.currentTarget.value);!isNaN(i)&&t[i]&&n(t[i])},children:t.map((e,t)=>(0,Z.tZ)("option",{value:t.toString(),children:e.label},t))})};var fz=i(59253);let fO=e=>{let{pub:t,sectionId:i}=e,{iString:n}=(0,Q.M1)(),r=[{key:"title",name:n("Title"),sortable:!0,valueFn:e=>(0,Z.tZ)("a",{className:"title-link bold",href:(0,j.MoQ)(t,e.post_id),target:"_blank",rel:"noopener",children:(0,er.truncateText)(e.title,40)})},{key:"post_date",name:n("Published"),sortable:!0,valueFn:e=>(0,H.Z)(e.post_date).format("MM/DD/YYYY")},{key:"downloads_day30",name:n("First 30 Days"),sortable:!0,valueFn:e=>u3(e.downloads_day30,e=>(0,er.numberToString)(e))},{key:"downloads",name:n("Total"),sortable:!0,valueFn:e=>u3(e.downloads,e=>(0,er.numberToString)(e))},{key:"podcast_preview_downloads_day30",name:n("Preview First 30 Days"),sortable:!0,valueFn:e=>u3(e.podcast_preview_downloads_day30,e=>(0,er.numberToString)(e))},{key:"podcast_preview_downloads",name:n("Preview Total"),sortable:!0,valueFn:e=>u3(e.podcast_preview_downloads,e=>(0,er.numberToString)(e))},{key:"subscriptions_within_1_day",name:n("Paid subscriptions in 1st day"),sortable:!0,valueFn:e=>u3(e.subscriptions_within_1_day,e=>(0,er.numberToString)(e))},{key:"shares",name:n("Shares"),sortable:!0,valueFn:e=>u3(e.shares,e=>(0,er.numberToString)(e))}];return(0,Z.tZ)(d6,{title:n("Episodes"),subtitle:n("Downloads per episode since being published"),children:(0,Z.tZ)(ps,{url:"/api/v1/publication/stats/podcast".concat(i?"?section_id=".concat(i):""),pageSize:5,appendMode:!1,cols:r,getRowIcon:()=>(0,Z.tZ)(yb.Z,{size:20,color:"var(--color-fg-primary)"}),defaultSort:{by:"post_date",direction:u8.Desc},empty:(0,Z.tZ)(u0,{icon:(0,Z.tZ)(fz.Z,{}),title:n("No episodes"),text:n("Download stats will appear here once you create your first episode.")})})})},fU=e=>{let{perRow:t,perRowMobile:i,children:n}=e;return(0,Z.tZ)("div",{className:k()("grid",{"grid-1":1===t,"grid-2":2===t,"grid-3":3===t,"grid-4":4===t,"mobile-grid-2":2===i}),children:n})};var fY=((u=fY||{}).Everyone="everyone",u.Free="free",u.Paid="paid",u);let fH=e=>{let{sectionId:t}=e,{iString:i}=(0,Q.M1)(),n=[{label:i("All episodes"),value:null},{label:i("Everyone"),value:"everyone"},{label:i("Only free"),value:"free"},{label:i("Only paid"),value:"paid"}],[r,o]=(0,A.eJ)(n[0]),{data:a,loading:l,error:s}=fM("/api/v1/publication/stats/podcast/overview",{section_id:t}),d=(null==r?void 0:r.value)?"".concat(r.value,"_"):"";return(0,Z.tZ)(d6,{title:i("Overview"),subtitle:i("Average downloads 7/30/90 days after publishing an episode"),action:(0,Z.tZ)(fj,{data:a,postAudiences:n,postAudience:r,setPostAudience:o}),children:(0,Z.tZ)(fA,{hasAvailableData:!!a,loading:l,error:s,children:(0,Z.BX)(fU,{perRow:4,perRowMobile:2,children:[(0,Z.tZ)(ml,{title:i("Total downloads"),format:"number-truncated",value:null==a?void 0:a["".concat(d,"downloads")],testID:"total-downloads"}),(0,Z.tZ)(ml,{title:i("First 7 days"),format:"number-truncated",value:null==a?void 0:a["".concat(d,"avg_downloads_day7")],testID:"first-7-days"}),(0,Z.tZ)(ml,{title:i("First 30 days"),format:"number-truncated",value:null==a?void 0:a["".concat(d,"avg_downloads_day30")],testID:"first-30-days"}),(0,Z.tZ)(ml,{title:i("First 90 days"),format:"number-truncated",value:null==a?void 0:a["".concat(d,"avg_downloads_day90")],testID:"first-90-days"})]})})})},fj=e=>{let{data:t,postAudiences:i,postAudience:n,setPostAudience:r}=e;return Object.values(fY).filter(e=>(null==t?void 0:t["".concat(e,"_downloads")])>0).length>1?(0,Z.tZ)(oY.i,{value:(null==n?void 0:n.value)||"",onChange:e=>{let t=e.currentTarget.value;""===t?r(i[0]):"everyone"===t?r(i[1]):"free"===t?r(i[2]):"paid"===t&&r(i[3])},children:i.map(e=>(0,Z.tZ)("option",{value:e.value||"",children:e.label},e.value||"all"))}):null};var fJ=i(75274);let fV=e=>{let{sectionId:t}=e,i=[{key:"player_name",wrap:!0,valueFn:e=>(0,Z.tZ)("span",{className:"bold",children:(0,er.truncateText)(e.player_name,20)})},{key:"percent_of_total_downloads",align:"right",wrap:!1,valueFn:e=>(0,er.decimalToPercent)(e.percent_of_total_downloads,{rounded:!0,display:!0})}],{iString:n}=(0,Q.M1)();return(0,Z.tZ)(d6,{title:n("Top players"),subtitle:n("How your audience is listening"),children:(0,Z.tZ)(ps,{url:"/api/v1/publication/stats/podcast/players".concat(t?"?section_id=".concat(t):""),cols:i,pageSize:5,getRowIcon:e=>{let t=(0,fJ.T)({spotifySettings:null}).find(t=>{let{name:i}=t;return i===e.player_name});return(0,Z.tZ)("img",{className:"podcast-app-icon",src:(0,en.zF4)((null==t?void 0:t.icon)||"/img/podcast-app-icons/generic.svg?v=1",48)})},hideHeaders:!0,empty:(0,Z.tZ)(u0,{icon:(0,Z.tZ)(yb.Z,{}),title:n("No player data"),text:n("Player stats will appear here once you create your first episode.")})})})},fq=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(sh,{children:[(0,Z.tZ)(sx.M5,{children:(0,Z.tZ)(iZ.e,{src:"/img/publish/empty-podcast.png",maxWidth:120,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,Z.BX)(et.sg,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{color:"primary",translated:!0,children:"Start your podcast"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Publish audio notes, read alouds, or full episodes to your Substack and every podcasting app."})]}),(0,Z.tZ)(ee.zx,{priority:"primary",href:(0,j.UA6)(window.location.pathname),children:e("Create podcast")})]})})},fW="default_podcast_slug",fG=e=>{let{pub:t,podcast:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"secondary",href:i.sectionId?(0,j.ZVf)(t,{addBase:void 0,type:"podcast",id:i.sectionId}):(0,j.aFk)(),children:n("Settings")})},fK=e=>{let{pub:t,podcast:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"primary",href:(0,j.qYj)(t,{type:"podcast",section:i.sectionId?i.sectionId:"pub"}),children:n("New episode")})},fQ=e=>{let{podcasts:t,currentPodcast:i,handleChange:n}=e;return(0,Z.tZ)(oY.i,{value:i.slug,onChange:n,children:t.map(e=>{let{slug:t,podcastTitle:i}=e;return(0,Z.tZ)("option",{value:t,children:i},t)})})},f$=e=>{let{pub:t,slug:i,isSection:n=!1}=e,{iString:r}=(0,Q.M1)(),o=(0,co.EP)(t),a=yY().get(fW),l=(0,co.aF)({podcasts:o,urlSlug:i,isSection:n,defaultPodcastSlug:a});if((0,A.d4)(()=>{history.replaceState({},document.title,(0,j.jHQ)(t,{addBase:!1,params:void 0,isSection:!!l&&!!l.sectionId,slug:null==l?void 0:l.slug}))},[t,null==l?void 0:l.sectionId,null==l?void 0:l.slug]),!l)return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(et.M5,{flex:"grow",bg:"primary-hover",padding:20,children:(0,Z.tZ)(fq,{})})});if(l){var s,d,c,u,p;return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)("section",{className:"podcasting page typography",children:(0,Z.BX)(dt,{children:[(0,Z.tZ)(di,{title:r("Podcast"),cta:l?(0,Z.BX)(et.X2,{gap:8,children:[(0,Z.tZ)(fG,{pub:t,podcast:l}),(0,Z.tZ)(fK,{pub:t,podcast:l})]}):null}),o.length>1&&(0,Z.tZ)(fQ,{podcasts:o,currentPodcast:l,handleChange:e=>{let i=e.target.value,n=o.find(e=>{let{slug:t}=e;return t===i});n&&"undefined"!=typeof window&&(yY().set(fW,n.slug),window.location.replace((0,j.jHQ)(t,{addBase:!1,params:void 0,isSection:!!n.sectionId,slug:n.slug})))}}),(0,Z.BX)(et.sg,{gap:32,children:[(0,Z.tZ)(fH,{sectionId:null!==(s=l.sectionId)&&void 0!==s?s:void 0}),(0,Z.tZ)(fR,{pub:t,sectionId:null!==(d=l.sectionId)&&void 0!==d?d:void 0}),(0,Z.tZ)(fO,{pub:t,sectionId:null!==(c=l.sectionId)&&void 0!==c?c:void 0}),(0,Z.BX)("div",{className:"podcasting-row",children:[(0,Z.tZ)(yq,{sectionId:null!==(u=l.sectionId)&&void 0!==u?u:void 0}),(0,Z.tZ)(fV,{sectionId:null!==(p=l.sectionId)&&void 0!==p?p:void 0})]}),(0,Z.tZ)(yH.ZP,{})]})]})})})}return null};var f0=((p={}).Create="Create",p.Import="Import",p),f1=((h={}).Decide="Decide",h.Detail="Detail",h.Import="Import",h.Success="Success",h.PickNewsletter="PickNewsletter",h);let f2=()=>{let{iString:e}=(0,Q.M1)();return{PickNewsletter:e("Choose an audience list for your podcast"),Decide:e("Letâ€™s set up your podcast"),Detail:e("Add a few details"),Success:e("Your podcast is set up!")}},f4=()=>{let{iString:e}=(0,Q.M1)();return{PickNewsletter:e("You can add your podcast to an existing mailing list, or create a new one"),Decide:e("Are you starting a new podcast or importing an existing one?"),Detail:e("Donâ€™t worry, you can always edit this information later on."),Success:e("Next, create your first episode to get your podcast out into the world.")}},f3=e=>(0,Z.tZ)(eH.l,(0,_._)((0,f._)({},e),{name:"PodcastImportIcon",svgParams:{viewBox:"0 0 24 24",height:24,width:24,fill:"none"},children:(0,Z.BX)("g",{children:[(0,Z.tZ)("path",{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M7 10L12 15L17 10","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M12 15V3","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]})})),f8=e=>(0,Z.tZ)(eH.l,(0,_._)((0,f._)({},e),{name:"PodcastPlusCircleIcon",svgParams:{viewBox:"0 0 24 24",height:24,width:24,fill:"none"},children:(0,Z.BX)("g",{children:[(0,Z.tZ)("path",{d:"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M12 8V16","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M8 12H16","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]})})),f6=e=>{let{step:t}=e,i=f2(),n=f4();return(0,Z.BX)("div",{className:"masthead",children:[(0,Z.tZ)("h1",{children:i[t]}),(0,Z.tZ)("h2",{children:n[t]})]})},f5=e=>{let{onSubmit:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(f0.Create);return(0,Z.BX)("div",{className:"decide",children:[(0,Z.tZ)(f6,{step:f1.Decide}),(0,Z.BX)("div",{className:"options",children:[(0,Z.BX)("div",{onClick:()=>r(f0.Create),className:k()("option",{selected:n===f0.Create}),children:[(0,Z.tZ)(f8,{stroke:n===f0.Create?"#000":"#999"}),(0,Z.tZ)("span",{children:i("Start a new podcast")})]}),(0,Z.BX)("div",{onClick:()=>{r(f0.Import)},className:k()("option",{selected:n===f0.Import}),children:[(0,Z.tZ)(f3,{stroke:n===f0.Import?"#000":"#999"}),(0,Z.tZ)("span",{children:i("Import an existing podcast")})]})]}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{t(n)},children:i("Next")})]})};var f9=i(57557),f7=i.n(f9);let _e=e=>{var{isNew:t}=e,i=(0,ef._)(e,["isNew"]);t?(0,U.j)(U.FP.PODCAST_SETUP_INITIATED,i):(0,U.j)(U.FP.PODCAST_EDITING_INITIATED,i)},_t=e=>{var{isNew:t}=e,i=(0,ef._)(e,["isNew"]);t?(0,U.j)(U.FP.PODCAST_SETUP_COMPLETE,i):(0,U.j)(U.FP.PODCAST_EDITING_COMPLETE,i)},_i=e=>{let{isNew:t,isPodcast:i=!0}=e;t?(0,U.j)(i?U.FP.PODCAST_SETUP_ERROR:U.FP.SECTION_SETUP_ERROR):(0,U.j)(i?U.FP.PODCAST_EDITING_ERROR:U.FP.SECTION_EDITING_ERROR)},_n=e=>{(0,U.j)(U.FP.PODCAST_EDITING_INITIATED,e)},_r=e=>{(0,U.j)(U.FP.PODCAST_EDITING_COMPLETE,e)};var _o=i(1725),_a=i(8131);let _l=e=>(0,Z.BX)(eH.l,(0,_._)((0,f._)({},e),{name:"UploadCloudIcon",svgParams:{height:24,width:24,fill:"none",stroke:"#1C110B",strokeWidth:1.5},children:[(0,Z.tZ)("path",{d:"M16 16L12 12L8 16","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M12 12V21","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M20.3904 18.39C21.3658 17.8583 22.1363 17.0169 22.5803 15.9986C23.0244 14.9804 23.1167 13.8432 22.8427 12.7667C22.5686 11.6901 21.9439 10.7355 21.0671 10.0534C20.1903 9.37137 19.1113 9.00072 18.0004 8.99998H16.7404C16.4378 7.82923 15.8736 6.74232 15.0904 5.82098C14.3072 4.89964 13.3253 4.16783 12.2185 3.68059C11.1118 3.19335 9.909 2.96334 8.70057 3.00787C7.49213 3.05239 6.30952 3.37028 5.24163 3.93765C4.17374 4.50501 3.24836 5.30709 2.53507 6.28357C1.82178 7.26004 1.33914 8.38552 1.12343 9.57538C0.907718 10.7652 0.964554 11.9885 1.28966 13.1532C1.61477 14.318 2.19969 15.3938 3.00045 16.3","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M16 16L12 12L8 16","stroke-linecap":"round","stroke-linejoin":"round"})]})),_s=e=>{let{artUrl:t,disabled:i,enableImageGeneration:n,error:r,label:o,loading:a,removable:l=!0,requirements:s,onChange:d,onClear:c}=e,{iString:u}=(0,Q.M1)(),p=(0,A.sO)(null),[h,m]=(0,A.eJ)(!1),g=async()=>{c()},v=async()=>{var e,t;if(!(null==p?void 0:null===(t=p.current)||void 0===t?void 0:null===(e=t.files)||void 0===e?void 0:e.length))return;let i=p.current.files[0],n=URL.createObjectURL(i);d(i,n)};return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)("label",{className:"art-container",children:[(0,Z.BX)("div",{className:"art-details",children:[(0,Z.tZ)("h3",{children:o}),(0,Z.tZ)("input",{type:"file",disabled:i,onChange:v,ref:p}),(0,Z.BX)("div",{className:"info",children:[(0,Z.tZ)("p",{children:s}),(0,Z.tZ)("a",{children:u("Change")}),t&&l&&!i&&(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:g,children:u("Remove")})]}),r&&(0,Z.tZ)("div",{"aria-label":"podcast-art-error",className:"error-box",children:r&&(0,Z.tZ)("p",{className:"art-error",children:r})})]}),t?(0,Z.BX)("div",{className:k()("upload-slot inline-art",{loading:a}),children:[(0,Z.tZ)("img",{src:(0,j.zF4)(t,324),alt:"podcast-cover"}),(0,Z.tZ)("span",{children:a&&u("Uploading...")})]}):(0,Z.BX)("div",{className:"upload-slot placeholder",children:[(0,Z.tZ)(_l,{height:48,stroke:"#666666"}),u(a?"Uploading...":"Upload image")]})]}),n&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.B4,{color:"secondary",decoration:"underline",onClick:e=>{e.preventDefault(),m(!0)},translated:!0,children:"Generate an image"}),(0,Z.tZ)(_a.Z,{open:h,insertionPointSelector:"#publish-main",onAfterClose:()=>{m(!1)},onUrlSelected:null,onImageSelected:async e=>{let t=new File([e],"uploaded",{type:e.type,lastModified:new Date().getTime()}),i=new DataTransfer;i.items.add(t),p.current.files=i.files,v()}})]})]})},_d=e=>(0,Z.BX)(eH.l,(0,_._)((0,f._)({},e),{name:"CopyIcon",svgParams:{height:15,width:15},children:[(0,Z.tZ)("rect",{x:"4",y:"1",width:"10.2862",height:"10.2862",rx:"1"}),(0,Z.tZ)("rect",{x:"1",y:"4",width:"10.2862",height:"10.2862",rx:"1"})]})),_c=e=>(0,Z.tZ)("input",(0,_._)((0,f._)({},e),{readOnly:!0,type:"text",onFocus:e=>e.currentTarget.select()}));var _u=i(48403),_p=i.n(_u);let _h=e=>{let{type:t,categoryValue:i,subcategoryValue:n,setCategoryValue:r,setSubcategoryValue:o,disabled:a,inputId:l}=e;return(0,Z.tZ)(gd,{placeholder:"".concat(_p()(t)," category"),options:fB()(Object.keys(er.PODCAST_CATEGORIES).map(e=>[{value:JSON.stringify({category:e,subcategory:""}),label:e},...er.PODCAST_CATEGORIES[e].map(t=>({value:JSON.stringify({category:e,subcategory:t}),label:"".concat(e," - ").concat(t)}))])),defaultValue:i?{value:JSON.stringify({category:i,subcategory:n}),label:"".concat(i," ").concat(n?"- ".concat(n):"")}:void 0,onChange:e=>{let{category:t,subcategory:i}=JSON.parse(null==e?void 0:e.value);r(t),o(i)},styles:{option:e=>(0,_._)((0,f._)({},e),{fontSize:"14px"})},isSearchable:!0,isDisabled:a,variant:"light",inputId:l})};function _m(){return(0,Z.BX)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 133 133",fill:"none",children:[(0,Z.tZ)("circle",{id:"Ellipse 98",cx:"66.5",cy:"66.5",r:"66.5",fill:"url(#paint0_linear_431_32168)"}),(0,Z.tZ)("path",{d:"M77.9913 79.9958C77.8146 78.4056 77.2845 77.2571 76.2244 76.197C74.2366 74.1209 70.747 72.7515 66.639 72.7515C62.531 72.7515 59.0414 74.0767 57.0537 76.197C56.0377 77.3013 55.4635 78.4056 55.2868 79.9958C54.9334 83.0878 55.1543 85.7381 55.5077 90.0228C55.861 94.0867 56.5236 99.5198 57.3629 104.997C57.9813 108.928 58.4672 111.049 58.9089 112.551C59.6598 115.024 62.3543 117.145 66.639 117.145C70.9237 117.145 73.6624 114.98 74.3692 112.551C74.8109 111.049 75.2968 108.928 75.9152 104.997C76.7544 99.4757 77.417 94.0867 77.7704 90.0228C78.168 85.7381 78.3446 83.0878 77.9913 79.9958Z",fill:"white"}),(0,Z.tZ)("path",{d:"M77.5053 57.468C77.5053 63.4754 72.6464 68.3343 66.639 68.3343C60.6316 68.3343 55.7726 63.4754 55.7726 57.468C55.7726 51.4605 60.6316 46.6016 66.639 46.6016C72.6464 46.6016 77.5053 51.5047 77.5053 57.468Z",fill:"white"}),(0,Z.tZ)("path",{d:"M66.5065 14.6652C41.1517 14.7535 20.3908 35.3377 20.0375 60.6925C19.7724 81.2326 32.8915 98.8131 51.223 105.262C51.6647 105.439 52.1064 105.041 52.0622 104.6C51.8414 103.009 51.5763 101.419 51.3997 99.829C51.3113 99.2548 50.9579 98.8131 50.472 98.548C35.9836 92.2314 25.8682 77.6988 26.0449 60.8692C26.2657 38.7831 44.2879 20.8051 66.3298 20.6284C88.9018 20.4517 107.322 38.739 107.322 61.2668C107.322 77.9196 97.2503 92.2314 82.8944 98.548C82.3643 98.7689 82.0109 99.2548 81.9668 99.829C81.7459 101.419 81.525 103.009 81.3042 104.6C81.2158 105.086 81.7017 105.439 82.1435 105.262C100.298 98.9014 113.329 81.5859 113.329 61.2668C113.241 35.5586 92.2589 14.621 66.5065 14.6652Z",fill:"white"}),(0,Z.tZ)("path",{d:"M65.4464 30.1254C48.926 30.7438 35.6744 44.393 35.4535 60.9134C35.321 71.7797 40.7542 81.4092 49.1027 87.1074C49.5003 87.3725 50.0745 87.0633 50.0745 86.5774C49.942 84.678 49.942 82.9994 50.0303 81.2326C50.0745 80.6583 49.8537 80.1283 49.4119 79.7307C44.3321 74.9601 41.2401 68.1576 41.4168 60.6483C41.7702 47.3967 52.4156 36.6187 65.6673 36.0886C80.0674 35.5144 91.9055 47.0875 91.9055 61.3109C91.9055 68.5552 88.8135 75.0926 83.9104 79.7307C83.5128 80.1283 83.292 80.6583 83.292 81.2326C83.3803 82.9553 83.3361 84.6338 83.2478 86.5332C83.2036 87.0191 83.7778 87.3725 84.2196 87.0633C92.4356 81.4534 97.8687 71.9564 97.8687 61.2668C97.9129 43.6863 83.2036 29.4187 65.4464 30.1254Z",fill:"white"}),(0,Z.tZ)("defs",{children:(0,Z.BX)("linearGradient",{id:"paint0_linear_431_32168",x1:"19.9587",y1:"40.508",x2:"19.62",y2:"-1.87502e-06",gradientUnits:"userSpaceOnUse",children:[(0,Z.tZ)("stop",{"stop-color":"#822CBE"}),(0,Z.tZ)("stop",{offset:"1","stop-color":"#D772FB"})]})})]})}function _g(){return(0,Z.tZ)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 133 133",fill:"none",children:(0,Z.tZ)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M66.7326 132.516C30.0139 132.516 0.474365 102.977 0.474365 66.2582C0.474365 29.5396 30.0139 0 66.7326 0C103.451 0 132.991 29.5396 132.991 66.2582C132.991 102.977 103.451 132.516 66.7326 132.516ZM66.7326 106.29L71.7019 101.32L66.7326 82.2711L61.7632 101.32L66.7326 106.29ZM60.3834 106.013L57.8987 115.4L63.6963 109.603L60.3834 106.013ZM73.0817 106.013L69.7688 109.326L75.5664 115.124L73.0817 106.013ZM77.7761 123.129L66.7326 112.087L55.689 123.129C59.2785 123.683 62.868 124.234 66.7326 124.234C70.5971 124.234 74.1866 123.957 77.7761 123.129ZM66.7326 8.28227C34.7083 8.28227 8.75664 34.2339 8.75664 66.2582C8.75664 91.6566 25.0446 113.191 47.6833 120.921L60.1067 74.8171C57.3454 72.884 55.689 69.5711 55.689 65.9816C55.689 59.909 60.6583 54.9396 66.7326 54.9396C72.8068 54.9396 77.7761 59.909 77.7761 65.9816C77.7761 69.5711 76.1197 72.6074 73.3584 74.8171L85.7818 120.921C108.421 113.191 124.708 91.6566 124.708 66.2582C124.708 34.2339 98.7568 8.28227 66.7326 8.28227ZM104.554 94.9695C103.175 96.626 100.69 97.1792 98.7568 95.7977C96.8254 94.4179 96.5487 91.9332 97.9286 90.2768C97.9286 90.2768 105.383 80.3381 105.383 66.2582C105.383 52.1783 97.9286 42.2396 97.9286 42.2396C96.5487 40.5831 96.8254 38.0985 98.7568 36.7186C100.69 35.3372 103.175 35.8904 104.554 37.5469C105.108 38.0985 113.665 49.417 113.665 66.2582C113.665 83.0994 105.108 94.4179 104.554 94.9695ZM84.4019 84.2026C82.7455 82.5461 83.0205 79.5098 84.6769 77.8534C84.6769 77.8534 88.8181 73.4356 88.8181 66.2582C88.8181 59.0808 84.6769 54.9396 84.6769 54.663C83.0205 53.0065 83.0205 50.2452 84.4019 48.3138C86.0584 46.3807 88.5431 46.3807 90.1995 48.0372C90.4745 48.3138 97.1003 55.2146 97.1003 66.2582C97.1003 77.3018 90.4745 84.2026 90.1995 84.4792C88.5431 86.1356 86.0584 85.859 84.4019 84.2026ZM49.0631 84.2026C47.4067 85.859 44.922 86.1356 43.2656 84.4792C42.9906 83.9276 36.3648 77.3018 36.3648 66.2582C36.3648 55.2146 42.9906 48.5888 43.2656 48.0372C44.922 46.3807 47.6833 46.3807 49.0631 48.3138C50.7196 49.9703 50.4446 53.0065 48.7882 54.663C48.7882 54.9396 44.647 59.0808 44.647 66.2582C44.647 73.4356 48.7882 77.8534 48.7882 77.8534C50.4446 79.5098 50.7196 82.2711 49.0631 84.2026ZM34.7083 95.7977C32.7752 97.1792 30.2906 96.626 28.9107 94.9695C28.3575 94.4179 19.8002 83.0994 19.8002 66.2582C19.8002 49.417 28.3575 38.0985 28.9107 37.5469C30.2906 35.8904 32.7752 35.3372 34.7083 36.7186C36.6397 38.0985 36.9164 40.5831 35.5365 42.2396C35.5365 42.2396 28.0825 52.1783 28.0825 66.2582C28.0825 80.3381 35.5365 90.2768 35.5365 90.2768C36.9164 91.9332 36.3648 94.4179 34.7083 95.7977Z",fill:"#FC7E0F"})})}function _v(){return(0,Z.tZ)("svg",{viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Z.BX)("g",{id:"Frame 5314",children:[(0,Z.tZ)("g",{id:"Group",children:(0,Z.tZ)("path",{id:"Vector",d:"M40 19.9991C40 31.0452 31.0466 40 20 40C8.95338 40 0 31.0452 0 19.9991C0 8.95483 8.95338 0 20 0C31.0466 0 40 8.95483 40 19.9991Z",fill:"#E86357"})}),(0,Z.tZ)("path",{id:"Vector_2",d:"M20.1853 29.6304C14.9691 29.6304 10.7414 25.4011 10.7414 20.1851C10.7414 14.9691 14.9691 10.7416 20.1853 10.7416C25.4016 10.7416 29.6292 14.9691 29.6292 20.1851H26.1954C26.1954 16.8656 23.5049 14.1752 20.1853 14.1752C16.8657 14.1752 14.1752 16.8656 14.1752 20.1851C14.1752 23.5045 16.8657 26.1949 20.1853 26.1949V29.6304ZM4.44482 20.1851C4.44482 11.4924 11.4922 4.44531 20.1853 4.44531C28.8785 4.44531 35.9258 11.4924 35.9258 20.1851H31.9902C31.9902 13.666 26.7066 8.38072 20.1853 8.38072C13.6659 8.38072 8.38042 13.666 8.38042 20.1851C8.38042 26.706 13.6659 31.9913 20.1853 31.9913V35.9267C11.4922 35.9267 4.44482 28.8778 4.44482 20.1851Z",fill:"white"})]})})}var _b=i(88812),_y=i(5281);async function _f(e){var t;let{section:i}=e;return(await N().post("/api/v1/spotify/sync-with-spotify").send({sectionId:null!==(t=null==i?void 0:i.id)&&void 0!==t?t:null})).body.settings}async function __(e){var t;let{section:i}=e;return(await N().post("/api/v1/spotify/unsync-with-spotify").send({sectionId:null!==(t=null==i?void 0:i.id)&&void 0!==t?t:null})).body.settings}async function _Z(e){var t;let{section:i}=e;return(await N().post("/api/v1/spotify/get-settings").send({sectionId:null!==(t=null==i?void 0:i.id)&&void 0!==t?t:null})).body.settings}async function _w(e){var t;let{section:i,title:n}=e;return(await N().post("/api/v1/spotify/set-title").send({sectionId:null!==(t=null==i?void 0:i.id)&&void 0!==t?t:null,title:n})).body.settings}let _C={container:"container-vRg9jv",currentNameInput:"currentNameInput-jwj2WO",inputContainer:"inputContainer-eTH7fJ",headerCloseButton:"headerCloseButton-bXPQOh",modalButtonRow:"modalButtonRow-iijGhL",modalCopyButton:"modalCopyButton-sbYwoE",modalButtonInRow:"modalButtonInRow-neBUWW",spotifyButton:"spotifyButton-MoDYz4",copyButton:"copyButton-Xy47lc",errorModalHeader:"errorModalHeader-dyZK4T",spotifyModalHeaderContainer:"spotifyModalHeaderContainer-r7RV0x",tinyLogo:"tinyLogo-fzImlQ"};function _x(e){var t,i,n,r;let{pub:o,section:a,spotifySettings:l,syndicateInfo:s}=e,{iString:d}=(0,Q.M1)(),c=(0,iN.pm)(),[u,p]=(0,A.eJ)(null!==(t=null!=l?l:a?a.spotify_podcast_settings:o.spotify_podcast_settings)&&void 0!==t?t:null),[h,m]=(0,A.eJ)(!1),[g,v]=(0,A.eJ)(null),[b,y]=(0,A.eJ)(!1),[w,C]=(0,A.eJ)(!1),x=a?(0,co.d_)({pub:o,section:a}):(0,co.jU)({pub:o});(0,A.d4)(()=>{(async()=>{if(!g&&!u&&!h){m(!0);try{let e=await _Z({section:a});p(e)}catch(e){console.error(e),v((0,Y.zx)(e)),c.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:d("Something went wrong")})))}m(!1)}})()},[g,u,h,a,d,c]);let[S,k]=(0,A.eJ)(null!==(i=a?a.showLinks:o.show_links)&&void 0!==i?i:null);return(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(sr.tu,{className:_C.container,padding:24,gap:16,children:[(0,Z.BX)(sr.tu,{gap:8,children:[(0,Z.tZ)(sr.xv.B2,{weight:"semibold",color:"primary",translated:!0,children:"Sync your podcast to Spotify"}),(0,Z.BX)(sr.xv.B3,{weight:"regular",color:"secondary",translated:!0,children:["Distribute your free and paid episodes to Spotify (",(0,Z.tZ)(sr.hh,{color:"secondary",decoration:"underline",href:"https://support.substack.com/hc/en-us/articles/24766453298324-How-can-I-distribute-my-paid-Substack-podcast-on-Spotify",onClick:()=>(0,U.j)(U.FP.SYNC_WITH_SPOTIFY_LEARN_MORE_CLICKED),children:"Learn more"}),"):",(0,Z.BX)("ul",{children:[(0,Z.tZ)("li",{children:'If your podcast is already on Spotify, click "Manual setup" to add your paid episodes while keeping your existing followers and listing.'}),(0,Z.tZ)("li",{children:'If youâ€™re starting fresh or want to create a separate paid feed (e.g. your free feed includes dynamic ads or essential free previews), click "Sync to Spotify."'})]})]})]}),h||!u?(0,Z.tZ)(sr.tu,{alignItems:"center",children:(0,Z.tZ)(iI.$j,{})}):u.currently_published_on_spotify?(0,Z.tZ)(_E,{section:a,podcastSettings:x,spotifySettings:u,setSpotifySettings:p}):(0,Z.tZ)(_P,{pub:o,canSyndicateInfo:s,setShowingModal:e=>{let{showing:t,startAtManualSetup:i}=e;C(i),y(t)}}),u&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(tX.iz,{paddingY:8}),(0,Z.tZ)(_X,{section:a,podcastSettings:x,spotifySettings:u,freeShowLink:null!==(n=null==S?void 0:S.find(e=>"spotify"===e.platform))&&void 0!==n?n:null,paidShowLink:null!==(r=null==S?void 0:S.find(e=>"spotify_for_paid_users"===e.platform))&&void 0!==r?r:null,onUpdatedShowLinks:e=>{let{showLinks:t}=e;k(t)},refreshSpotifySettings:()=>{p(null)}})]}),(0,Z.tZ)(tX.iz,{paddingY:8}),(0,Z.BX)(sr.xv.B4,{color:"secondary",weight:"semibold",translated:!0,children:["Need help? Learn more about"," ",(0,Z.tZ)(sr.hh,{color:"secondary",decoration:"underline",href:"https://support.substack.com/hc/en-us/articles/24766453298324-How-can-I-distribute-my-paid-Substack-podcast-on-Spotify",children:"syncing to Spotify"})," ","or"," ",(0,Z.tZ)(sr.hh,{color:"secondary",decoration:"underline",href:"https://substack.com/support",children:"contact"})," ","our support team"]}),u&&(0,Z.tZ)(_T,{isOpen:b,startAtManualSetup:w,spotifySettings:u,onClose:()=>{y(!1),C(!1),(0,U.j)(U.FP.SYNC_WITH_SPOTIFY_MODAL_CLOSED)},section:a,onSuccess:e=>{let{settings:t}=e;p(t)}})]})})}function _S(e){var t;let{isOpen:i,onClose:n,section:r,onSuccess:o,spotifySettings:a,podcastSettings:l}=e,{iString:s}=(0,Q.M1)(),[d,c]=(0,A.eJ)(""),u=(0,A.sO)(null),p=(0,iN.pm)();return(0,A.d4)(()=>{var e;null===(e=u.current)||void 0===e||e.focus()},[]),(0,Z.BX)(eK.u_,{isOpen:i,onClose:()=>{n()},width:362,children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:n}),(0,Z.BX)(sr.tu,{gap:20,padding:20,alignItems:"center",children:[(0,Z.BX)(sr.tu,{gap:4,alignItems:"center",justifyContent:"center",children:[(0,Z.tZ)(sr.xv.H4,{weight:"heavy",color:"primary",translated:!0,children:"Edit podcast name"}),(0,Z.tZ)(sr.xv.B3,{weight:"regular",color:"secondary",textAlign:"center",translated:!0,children:"This will change the name of the podcast on your Spotify URL."})]}),(0,Z.BX)(sr.tu,{className:_C.inputContainer,children:[(0,Z.tZ)(sr.xv.B4,{paddingBottom:8,color:"primary",weight:"semibold",translated:!0,children:"Current name"}),(0,Z.tZ)(tD.oi,{disabled:!0,className:_C.currentNameInput,value:null!==(t=a.spotify_podcast_title||l.title)&&void 0!==t?t:""}),(0,Z.tZ)(sr.xv.B4,{paddingBottom:8,color:"primary",weight:"semibold",translated:!0,children:"New name"}),(0,Z.tZ)(tD.oi,{ref:u,value:d,onChange:e=>{c(e.currentTarget.value)}})]}),(0,Z.BX)(sr.gq,{gap:12,justifyContent:"center",className:_C.modalButtonRow,children:[(0,Z.tZ)(sr.zx,{className:_C.modalButtonInRow,priority:"secondary",onClick:async()=>{n(),c("")},children:s("Cancel")}),(0,Z.tZ)(sr.zx,{className:_C.modalButtonInRow,priority:"primary",disabled:!d,onClick:async()=>{try{let e=await _w({section:r,title:d});o({settings:e}),p.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:s("Podcast name updated")}))),n(),c("")}catch(e){console.error(e),p.popToast(t=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},t),{text:(0,Y.zx)(e)})))}},children:s("Save")})]})]})]})}function _k(e){var t,i;let{isOpen:n,onClose:r,section:o,onSuccess:a,spotifySettings:l,podcastSettings:s}=e,{iString:d}=(0,Q.M1)(),c=(0,A.sO)(null),[u,p]=(0,A.eJ)(!1),h=(0,iN.pm)();return(0,A.d4)(()=>{var e;null===(e=c.current)||void 0===e||e.focus()},[]),(0,Z.BX)(eK.u_,{isOpen:n,onClose:()=>{r()},width:362,children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:r}),(0,Z.BX)(sr.tu,{gap:20,paddingX:20,paddingBottom:20,alignItems:"center",children:[(0,Z.BX)(sr.tu,{gap:4,alignItems:"center",justifyContent:"center",children:[(0,Z.tZ)(sr.xv.H4,{weight:"heavy",color:"primary",translated:!0,children:"Disconnect from Spotify?"}),(0,Z.BX)(sr.xv.B3,{weight:"regular",color:"secondary",textAlign:"center",translated:!0,children:[(0,Z.tZ)(sr.hh,{decoration:"underline",href:l.spotify_show_url,children:I18N.p(null!==(i=null!==(t=l.spotify_podcast_title)&&void 0!==t?t:s.title)&&void 0!==i?i:"Your podcast")})," ","will be removed from Spotify and your podcast will no longer be synced."]})]}),(0,Z.BX)(sr.gq,{gap:12,justifyContent:"center",className:_C.modalButtonRow,children:[(0,Z.tZ)(sr.zx,{className:_C.modalButtonInRow,priority:"secondary",onClick:async()=>{r()},children:d("Cancel")}),(0,Z.tZ)(sr.zx,{className:_C.modalButtonInRow,priority:"destructive",disabled:u,onClick:async()=>{(0,U.j)(U.FP.SYNC_WITH_SPOTIFY_UNPUBLISH_CLICKED);try{p(!0);let e=await __({section:o});a({settings:e}),h.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:d("Disconnected!")}))),r()}catch(e){console.error(e),h.popToast(t=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},t),{text:(0,Y.zx)(e)})))}p(!1)},children:d("Disconnect")})]})]})]})}function _B(e){let{icon:t,onClose:i}=e;return(0,Z.BX)("div",{children:[t,(0,Z.tZ)(sr.hU,{priority:"secondary",size:"sm",onClick:i,className:_C.headerCloseButton,children:(0,Z.tZ)(K.Z,{size:20})})]})}function _T(e){let{isOpen:t,onClose:i,section:n,onSuccess:r,startAtManualSetup:o,spotifySettings:a}=e,{iString:l}=(0,Q.M1)(),[s,d]=(0,A.eJ)(o?"manual-setup":"start"),[c,u]=(0,A.eJ)(null),p=(0,iN.pm)();return(0,A.d4)(()=>{d(o?"manual-setup":"start")},[o]),(0,A.d4)(()=>{t||setTimeout(()=>{d("start"),u(null)},300)},[t]),(0,Z.BX)(eK.u_,{isOpen:t,onClose:()=>{i()},width:362,children:["start"===s&&(0,Z.BX)(sr.tu,{gap:20,padding:20,alignItems:"center",children:[(0,Z.tZ)(_B,{icon:(0,Z.tZ)(_N,{}),onClose:i}),(0,Z.BX)(sr.tu,{gap:4,alignItems:"center",children:[(0,Z.tZ)(sr.xv.H4,{color:"primary",weight:"heavy",translated:!0,children:"Sync with Spotify"}),(0,Z.tZ)(sr.xv.B3,{color:"secondary",weight:"regular",textAlign:"center",translated:!0,children:"Let subscribers listen to all your current and future audio posts on Spotify."})]}),(0,Z.BX)(sr.gq,{gap:16,children:[(0,Z.tZ)(eM.Z,{size:24}),(0,Z.tZ)(sr.xv.B3,{color:"primary",weight:"regular",flex:"grow",translated:!0,children:"Paid episodes will be locked on Spotify with a link to become a paid subscriber for access"})]}),(0,Z.BX)(sr.gq,{gap:16,children:[(0,Z.tZ)(_b.Z,{size:24}),(0,Z.tZ)(sr.xv.B3,{flex:"grow",color:"primary",weight:"regular",translated:!0,children:"Spotify does not yet support free previews or founding tier episodes."})]}),(0,Z.BX)(sr.gq,{gap:12,justifyContent:"center",className:_C.modalButtonRow,children:[(0,Z.tZ)(sr.zx,{priority:"secondary",className:_C.modalButtonInRow,onClick:async()=>{d("manual-setup"),(0,U.j)(U.FP.SYNC_WITH_SPOTIFY_MANUAL_SETUP_CLICKED)},children:l("Manual setup")}),(0,Z.tZ)(sr.zx,{className:_C.modalButtonInRow,onClick:async()=>{d("publishing"),(0,U.j)(U.FP.SYNC_WITH_SPOTIFY_SYNC_WITH_SPOTIFY_CLICKED);try{let e=await _f({section:n});r({settings:e}),d("podcast-published")}catch(e){console.error(e),u((0,Y.zx)(e)),d("error")}},children:l("Sync with Spotify")})]}),(0,Z.BX)(sr.xv.B5,{color:"secondary",textAlign:"center",weight:"regular",translated:!0,children:['By clicking "Sync with Spotify" you are submitting your podcast and audio posts to Spotify. You are agreeing to Spotifyâ€™s ',(0,Z.tZ)(sr.hh,{href:"https://www.spotify.com/us/legal/end-user-agreement/",children:"Terms"})," and"," ",(0,Z.tZ)(sr.hh,{href:"https://support.spotify.com/us/article/platform-rules/",children:"Rules."})]})]}),"manual-setup"===s&&(0,Z.BX)(sr.tu,{gap:20,padding:20,alignItems:"center",children:[(0,Z.tZ)(_B,{icon:(0,Z.tZ)(_N,{}),onClose:i}),(0,Z.tZ)(sr.tu,{gap:4,alignItems:"center",children:(0,Z.tZ)(sr.xv.H4,{weight:"heavy",color:"primary",translated:!0,children:"Manual setup"})}),(0,Z.BX)(sr.gq,{gap:16,children:[(0,Z.tZ)(ph.Z,{size:24}),(0,Z.tZ)(sr.xv.B3,{color:"primary",weight:"regular",flex:"grow",translated:!0,children:"Copy your new Spotify URL, then go to Spotify and replace the current URL with your new one. This will fully paywall any free preview episodes."})]}),(0,Z.BX)(sr.gq,{gap:16,children:[(0,Z.tZ)(tI.Z,{size:24}),(0,Z.tZ)(sr.xv.B3,{flex:"grow",color:"primary",weight:"regular",translated:!0,children:"Paste your Spotify show link into the forms below to show the link on your podcast page."})]}),(0,Z.BX)(sr.gq,{gap:16,children:[(0,Z.tZ)(eR.Z,{size:24}),(0,Z.BX)(sr.xv.B3,{color:"primary",weight:"regular",flex:"grow",translated:!0,children:["If your Spotify For Podcasters account displays an Anchor URL as your current RSS feed, contact"," ",(0,Z.tZ)(sr.hh,{href:"mailto:support@substackinc.com",children:"support@substackinc.com"})," before syncing."]})]}),(0,Z.tZ)(sr.zx,{leading:(0,Z.tZ)(ph.Z,{size:20}),className:_C.modalCopyButton,priority:"secondary",onClick:()=>{(0,Y.vQ)(a.feed_url_for_spotify),(0,U.j)(U.FP.SYNC_WITH_SPOTIFY_COPY_URL_CLICKED),i(),p.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:l("Copied link to clipboard")})))},children:l("Copy URL")}),(0,Z.tZ)(sr.xv.B5,{textAlign:"center",color:"accent-red",weight:"regular",translated:!0,children:'It can sometimes take up to an hour for Spotify to update. If you save the links and donâ€™t see this status change to "Synced," try entering the link again in an hour.'})]}),"publishing"===s&&(0,Z.BX)(sr.tu,{gap:20,padding:20,alignItems:"center",children:[(0,Z.tZ)(_B,{icon:(0,Z.tZ)(_N,{}),onClose:i}),(0,Z.BX)(sr.tu,{gap:4,alignItems:"center",children:[(0,Z.tZ)(sr.xv.H4,{weight:"heavy",color:"primary",translated:!0,children:"Syncing..."}),(0,Z.tZ)(sr.xv.B3,{weight:"regular",color:"secondary",translated:!0,children:"This should only take a moment"})]})]}),"error"===s&&(0,Z.BX)(sr.tu,{gap:20,padding:20,alignItems:"center",children:[(0,Z.tZ)(_B,{icon:(0,Z.tZ)(_I,{}),onClose:i}),(0,Z.BX)(sr.tu,{gap:4,alignItems:"center",children:[(0,Z.tZ)(sr.xv.H4,{weight:"heavy",color:"primary",translated:!0,children:"Something went wrong"}),(0,Z.tZ)(sr.xv.B3,{weight:"regular",color:"secondary",children:c})]})]}),"podcast-published"===s&&(0,Z.BX)(sr.tu,{gap:20,padding:20,alignItems:"center",children:[(0,Z.tZ)(_B,{icon:(0,Z.tZ)(_N,{}),onClose:i}),(0,Z.BX)(sr.tu,{gap:4,alignItems:"center",children:[(0,Z.tZ)(sr.xv.H4,{weight:"bold",color:"primary",translated:!0,children:"Podcast published"}),(0,Z.tZ)(sr.xv.B3,{color:"secondary",textAlign:"center",translated:!0,children:"Your podcast is published! It will take about an hour before it is visible. You can find the link below."})]}),(0,Z.BX)(sr.gq,{gap:12,justifyContent:"center",className:_C.modalButtonRow,children:[(0,Z.tZ)(sr.zx,{priority:"secondary",className:_C.modalButtonInRow,onClick:i,children:l("Done")}),(0,Z.tZ)(sr.zx,{className:_C.modalButtonInRow,newTab:!0,href:a.spotify_show_url,children:l("View on Spotify")})]})]})]})}function _I(){return(0,Z.tZ)(sr.tu,{width:56,height:56,alignItems:"center",justifyContent:"center",className:_C.errorModalHeader,children:(0,Z.tZ)(eR.Z,{})})}function _N(){return(0,Z.tZ)(sr.tu,{width:56,height:56,alignItems:"center",justifyContent:"center",className:_C.spotifyModalHeaderContainer,children:(0,Z.tZ)(cn.Z,{})})}function _P(e){let{pub:t,setShowingModal:i,canSyndicateInfo:n}=e,{iString:r}=(0,Q.M1)();return n.canSyndicateSpotifyFeed?(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(sr.gq,{gap:12,children:[(0,Z.tZ)(sr.zx,{className:_C.spotifyButton,onClick:()=>{i({showing:!0,startAtManualSetup:!1}),(0,U.j)(U.FP.SYNC_WITH_SPOTIFY_SYNC_TO_SPOTIFY_CLICKED)},leading:(0,Z.tZ)(cn.Z,{size:20}),children:r("Sync to Spotify")}),(0,Z.tZ)(sr.zx,{className:_C.copyButton,priority:"secondary-outline",leading:(0,Z.tZ)(ph.Z,{size:20}),onClick:()=>{i({showing:!0,startAtManualSetup:!0}),(0,U.j)(U.FP.SYNC_WITH_SPOTIFY_MANUAL_SETUP_CLICKED)},children:r("Manual setup")})]})}):t.invite_only?(0,Z.BX)(sr.tu,{gap:16,children:[(0,Z.tZ)(sr.xv.B3,{weight:"regular",color:"secondary",translated:!0,children:"Youâ€™ll need to turn off Private Mode for Spotify to accept your feed."}),(0,Z.tZ)(sr.xu,{children:(0,Z.tZ)(sr.zx,{newTab:!0,priority:"secondary-outline",leading:(0,Z.tZ)(iy.Z,{size:20}),href:(0,j.wI3)(t,{params:{search:"private mode"}}),children:r("Turn off Private Mode")})})]}):(0,Z.BX)(sr.tu,{gap:16,children:[(0,Z.tZ)(sr.xv.B3,{weight:"regular",color:"secondary",translated:!0,children:"Youâ€™ll need to publish an episode for Spotify to accept your feed."}),(0,Z.tZ)(sr.xu,{children:(0,Z.tZ)(sr.zx,{newTab:!0,priority:"secondary-outline",leading:(0,Z.tZ)(iy.Z,{size:20}),href:(0,j.qYj)(t,{type:"podcast"}),children:r("Create your first episode")})})]})}function _E(e){let{podcastSettings:t,spotifySettings:i,section:n,setSpotifySettings:r}=e,{iString:o}=(0,Q.M1)(),a=(0,iN.pm)(),[l,s]=(0,A.eJ)(!1),[d,c]=(0,A.eJ)(!1);return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(sr.gq,{gap:16,bg:"primary",radius:"md",padding:8,shadow:"sm",children:[(0,Z.BX)(sr.gq,{gap:8,alignItems:"center",justifyContent:"start",flex:"grow",children:[t.artUrl&&(0,Z.tZ)("img",{src:(0,en.zF4)(t.artUrl,64),height:32,width:32,className:_C.tinyLogo}),(0,Z.BX)(sr.tu,{children:[(0,Z.tZ)(sr.xv.B3,{weight:"semibold",color:"primary",children:i.spotify_podcast_title||t.title}),(0,Z.tZ)(sr.xv.B5,{weight:"regular",color:"secondary",translated:!0,children:"Spotify Open Access"})]})]}),(0,Z.BX)(sr.gq,{gap:16,alignItems:"center",children:[(0,Z.tZ)(sr.xv.B3,{weight:"semibold",color:"secondary",translated:!0,children:"Synced"}),(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(sr.hU,{bg:"primary",children:(0,Z.tZ)(_y.Z,{})}),children:[(0,Z.tZ)(tC.sN,{priority:"secondary",leading:(0,Z.tZ)(nX.Z,{}),onClick:()=>{s(!0)},children:o("Edit podcast name")}),(0,Z.tZ)(tC.sN,{priority:"secondary",leading:(0,Z.tZ)(iy.Z,{}),target:"_blank",href:i.spotify_show_url,children:o("View podcast on Spotify")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(ph.Z,{}),className:_C.modalCopyButton,priority:"secondary",onClick:()=>{(0,Y.vQ)(i.feed_url_for_spotify),a.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:o("Copied link to clipboard")})))},children:o("Copy URL")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(_b.Z,{}),className:_C.modalCopyButton,priority:"destructive",onClick:()=>{c(!0)},children:o("Disconnect from Spotify")})]})]})]}),(0,Z.tZ)(_S,{isOpen:l,spotifySettings:i,onClose:()=>s(!1),section:n,onSuccess:e=>{let{settings:t}=e;r(t)},podcastSettings:t}),(0,Z.tZ)(_k,{isOpen:d,onClose:()=>c(!1),section:n,onSuccess:e=>{let{settings:t}=e;r(t)},spotifySettings:i,podcastSettings:t})]})}function _X(e){var t,i,n;let{freeShowLink:r,paidShowLink:o,section:a,spotifySettings:l,refreshSpotifySettings:s,onUpdatedShowLinks:d}=e,c=(0,iN.pm)(),{iString:u}=(0,Q.M1)(),[p,h]=(0,A.eJ)(!1),[m,g]=(0,A.eJ)(null!==(t=null==r?void 0:r.url)&&void 0!==t?t:null),[v,b]=(0,A.eJ)(null!==(n=null!==(i=null==o?void 0:o.url)&&void 0!==i?i:l.spotify_show_url)&&void 0!==n?n:null),[y,w]=(0,A.eJ)(!1);(0,A.d4)(()=>{if(!o&&(null===v||""===v)&&l.spotify_show_url){var e;b(null!==(e=l.spotify_show_url)&&void 0!==e?e:null)}},[l,o,v]);let C=async e=>{let{freeShowLinkUrl:t,paidShowLinkUrl:i}=e;w(!0);try{var n,r;let e=(await N().put("/api/v1/publication/show_links").send({spotify_url:t,spotify_for_paid_users_url:i,sectionId:null!==(r=null==a?void 0:a.id)&&void 0!==r?r:null})).body,o=u("Saved!"),l=!1;(null===(n=e.spotifyLinkResult)||void 0===n?void 0:n.result)==="created-soa-link"?(o=u("Saved! Your feed is now linked to Spotify."),l=!0):o=u("Saved!"),c.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:o}))),e.showLinks&&d({showLinks:e.showLinks}),h(!1),l&&s()}catch(t){let e=(0,Y.zx)(t);c.popToast(t=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},t),{text:e})))}w(!1)};return(0,Z.BX)(sr.tu,{gap:16,children:[(0,Z.BX)(sr.tu,{gap:4,children:[(0,Z.tZ)(sr.xv.B2,{weight:"semibold",color:"primary",translated:!0,children:"Add Spotify links to your Substack pages"}),(0,Z.tZ)(sr.xv.B3,{weight:"regular",color:"secondary",translated:!0,children:"Choose which links to show free and paid subscribers on your Substack podcast and episode pages. Note: They can be the same URL."})]}),(0,Z.tZ)(_M,{value:v,onShowLinkChanged:e=>{h(!0),b(e)},label:u("Spotify link for paid subscribers"),placeholder:u("Add private Spotify URL"),paddingY:8}),(0,Z.tZ)(tX.iz,{paddingY:8}),(0,Z.tZ)(_M,{value:m,onShowLinkChanged:e=>{h(!0),g(e)},label:u("Spotify link for free subscribers"),placeholder:u("Add public Spotify URL"),paddingY:0}),p&&(0,Z.BX)(sr.gq,{gap:8,children:[(0,Z.tZ)(sr.zx,{priority:"primary",disabled:y,onClick:()=>{C({freeShowLinkUrl:m,paidShowLinkUrl:v})},children:u("Save")}),(0,Z.tZ)(sr.zx,{priority:"secondary-outline",disabled:y,onClick:()=>{var e,t;g(null!==(e=null==r?void 0:r.url)&&void 0!==e?e:null),b(null!==(t=null==o?void 0:o.url)&&void 0!==t?t:null),h(!1)},children:u("Cancel")})]})]})}function _M(e){let{onShowLinkChanged:t,value:i,label:n,placeholder:r,paddingY:o}=e;return(0,Z.BX)(sr.tu,{gap:8,paddingY:o,children:[(0,Z.tZ)(sr.xv.B3,{weight:"semibold",color:"primary",children:n}),(0,Z.tZ)(tD.oi,{placeholder:r,value:null!=i?i:void 0,onChange:e=>{t(e.currentTarget.value)}})]})}function _A(){return(0,Z.BX)("svg",{viewBox:"0 0 159 110",xmlns:"http://www.w3.org/2000/svg",children:[(0,Z.tZ)("path",{d:"m154 17.5c-1.82-6.73-7.07-12-13.8-13.8-9.04-3.49-96.6-5.2-122 0.1-6.73 1.82-12 7.07-13.8 13.8-4.08 17.9-4.39 56.6 0.1 74.9 1.82 6.73 7.07 12 13.8 13.8 17.9 4.12 103 4.7 122 0 6.73-1.82 12-7.07 13.8-13.8 4.35-19.5 4.66-55.8-0.1-75z",fill:"#f00"}),(0,Z.tZ)("path",{d:"m105 55-40.8-23.4v46.8z",fill:"#fff"})]})}var _D=i(77203);function _R(e){var t;let{pub:i,section:n}=e,{iString:r}=(0,Q.M1)(),o=(0,iN.pm)(),[a,l]=(0,A.eJ)(null),[s,d]=(0,A.eJ)(null!==(t=n?n.spotify_podcast_settings:i.spotify_podcast_settings)&&void 0!==t?t:null),[c,u]=(0,A.eJ)(!1),[p,h]=(0,A.eJ)(null),[m,g]=(0,A.eJ)(null),v=n?(0,co.d_)({pub:i,section:n}):(0,co.jU)({pub:i});return(0,A.d4)(()=>{(async()=>{if(!p&&!a&&!c){u(!0);try{var e;let[t,r]=await Promise.all([(0,co.XH)({sectionId:null!==(e=null==n?void 0:n.id)&&void 0!==e?e:null}),_Z({section:n})]);l(t),d(r);let o=(0,rp.a9)({pub:i,section:n,spotifySettings:r});g(o)}catch(e){console.error(e),h((0,Y.zx)(e)),o.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:r("Something went wrong")})))}u(!1)}})()},[p,a,c,n,r,o,i]),(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(sr.tu,{paddingTop:16,children:[(0,Z.BX)(sr.tu,{paddingBottom:8,gap:4,children:[(0,Z.tZ)(sr.xv.B3,{id:"distribute-podcast",weight:"semibold",color:"primary",translated:!0,children:"Distribute your podcast"}),(0,Z.tZ)(sr.xv.B3,{weight:"regular",color:"secondary",translated:!0,children:"Add your podcast RSS feed to external players so your subscribers can listen on their player of choice"}),!c&&a&&!a.canSyndicatePublicFeed&&(0,Z.tZ)(_D.U,{type:"warn",icon:eR.Z,title:i.invite_only?(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(sr.xv,{translated:!0,children:["Your RSS URL wonâ€™t be accepted until you turn off Private Mode."," ",(0,Z.tZ)(sr.hh,{decoration:"underline",href:(0,j.wI3)(i,{params:{search:"private mode"}}),children:"Turn off Private Mode"})]})}):(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(sr.xv,{translated:!0,children:["Your RSS URL wonâ€™t be accepted until you publish an episode."," ",(0,Z.tZ)(sr.hh,{decoration:"underline",href:(0,j.qYj)(i,{type:"podcast"}),children:"Create your first episode"})," ","announcing your podcast or publish your first episode before submitting your feed to players."]})})})]}),c&&(0,Z.tZ)(sr.tu,{alignItems:"center",children:(0,Z.tZ)(iI.$j,{})}),!c&&a&&s&&m&&(0,Z.BX)(sr.tu,{border:"detail",radius:"md",children:[(0,Z.tZ)(_z,{name:"Spotify",startExpanded:!0,logo:(0,Z.tZ)(_O,{icon:(0,Z.tZ)(cn.Z,{})}),isDone:s.currently_published_on_spotify,children:(0,Z.tZ)(_x,{pub:i,section:n,spotifySettings:s,syndicateInfo:a,spotifyShowLinkUrl:m.spotify_url})}),v.podcastRssUrl&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(_z,{name:"Apple Podcasts",startExpanded:!1,logo:(0,Z.tZ)(_O,{icon:(0,Z.tZ)(_m,{})}),isDone:!!m.apple_podcasts_url,children:(0,Z.tZ)(_L,{section:n,substackFeedUrl:v.podcastRssUrl,externalUrl:m.apple_podcasts_url,showLinkFieldName:"apple_podcasts_url",learnMoreUrl:"https://podcasters.apple.com/support/897-submit-a-show",step1Title:r("Step 1: Copy your RSS feed URL"),step1Text:r("Click the button below to copy your RSS feed URL. Apple will require this URL to list your podcast."),step2Title:r("Step 2: Submit your podcast to Apple"),step2Text:r("Click the button below to visit Apple Podcast connect and complete their sign up flow."),step2ButtonText:r("Visit Apple Podcasts Connect"),step2Url:"https://podcastsconnect.apple.com/",step3Title:r("Step 3: Enter your Apple Podcasts URL"),step3Text:r("Paste your new Apple Podcasts URL into the field below and weâ€™ll link to it from Substack.")})}),(0,Z.tZ)(_z,{name:"YouTube Music",startExpanded:!1,logo:(0,Z.tZ)(_O,{icon:(0,Z.tZ)("img",{src:"/img/shows_app_icons/youtube_music.svg?v=1"})}),isDone:!!m.youtube_music_url,children:(0,Z.tZ)(_L,{section:n,substackFeedUrl:v.podcastRssUrl,externalUrl:m.youtube_music_url,showLinkFieldName:"youtube_music_url",step3Title:r("Enter your YouTube Music URL"),step3Text:r("Paste your new YouTube Music URL into the field below and weâ€™ll link to it from Substack.")})}),(0,Z.tZ)(_z,{name:"Youtube Podcasts",startExpanded:!1,logo:(0,Z.tZ)(_O,{icon:(0,Z.tZ)(_A,{})}),isDone:!!m.youtube_url,children:(0,Z.tZ)(_L,{section:n,substackFeedUrl:v.podcastRssUrl,showLinkFieldName:"youtube_url",learnMoreUrl:"https://support.google.com/youtube/answer/13973017?sjid=80768060489504491-NC",externalUrl:m.youtube_url,step1Title:r("Step 1: Copy your RSS feed URL"),step1Text:r("Click the button below to copy your RSS feed URL. Youtube will require this URL to list your podcast."),step2Title:r("Step 2: Submit your podcast to YouTube Studio"),step2Text:r("Click the button below to visit YouTube Studio connect and complete their sign up flow."),step2ButtonText:r("Visit YouTube Studio"),step2Url:"http://studio.youtube.com/",step3Title:r("Step 3: Enter your Youtube Podcasts URL"),step3Text:r("Paste your new YouTube URL into the field below and weâ€™ll link to it from Substack.")})}),(0,Z.tZ)(_z,{name:"Pocket Casts",startExpanded:!1,logo:(0,Z.tZ)(_O,{icon:(0,Z.tZ)(_v,{})}),isDone:!!m.pocket_casts_url,children:(0,Z.tZ)(_L,{section:n,substackFeedUrl:v.podcastRssUrl,externalUrl:m.pocket_casts_url,showLinkFieldName:"pocket_casts_url",learnMoreUrl:"https://pocketcasts.com/submit/",step1Title:r("Step 1: Copy your RSS feed URL"),step1Text:r("Click the button below to copy your RSS feed URL. Pocket Casts will require this URL to list your podcast."),step2Title:r("Step 2: Submit your podcast to Pocket Casts"),step2Text:r("Click the button below to visit Pocket Casts and select the Public option, since this feed is for your listeners."),step2ButtonText:r("Visit Pocket Casts"),step2Url:"https://pocketcasts.com/submit/",step3Title:r("Step 3: Enter your Pocket Casts URL"),step3Text:r("Paste your new Pocket Casts URL into the field below and weâ€™ll link to it from Substack.")})}),(0,Z.tZ)(_z,{name:"Overcast",startExpanded:!1,logo:(0,Z.tZ)(_O,{icon:(0,Z.tZ)(_g,{})}),isDone:!!m.overcast_url,children:(0,Z.tZ)(_L,{section:n,substackFeedUrl:v.podcastRssUrl,externalUrl:m.overcast_url,learnMoreUrl:"https://overcast.fm/podcasterinfo",showLinkFieldName:"overcast_url",step1Title:r("Step 1: Copy your RSS feed URL"),step1Text:r("Click the button below to copy your RSS feed URL."),step2Title:r("Step 2: Submit your podcast to Overcast"),step2Text:r("Overcast will usually find your podcast automatically via the listing on Apple Podcasts. If it is not appearing on Overcast within 1-2 days, click the button below to follow their instructions."),step2ButtonText:r("Visit Overcast"),step2Url:"https://overcast.fm/add",step3Title:r("Step 3: Enter your Overcast URL"),step3Text:r("Paste your new Overcast URL into the field below and weâ€™ll link to it from Substack.")})})]})]})]})})}function _F(e){let{feedUrl:t}=e,{iString:i}=(0,Q.M1)(),n=(0,iN.pm)();return(0,Z.tZ)(sr.zx,{priority:"secondary-outline",leading:(0,Z.tZ)(ph.Z,{size:20}),onClick:()=>{(0,Y.vQ)(t),n.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:i("Copied link to clipboard")})))},children:i("Copy URL")})}function _L(e){let{substackFeedUrl:t,externalUrl:i,section:n,showLinkFieldName:r,learnMoreUrl:o,step1Title:a,step1Text:l,step2Title:s,step2Text:d,step2Url:c,step2ButtonText:u,step3Title:p,step3Text:h}=e,{iString:m}=(0,Q.M1)(),[g,v]=(0,A.eJ)(null!=i?i:""),b=(0,A.sO)(null),y=(0,iN.pm)();return(0,Z.BX)(sr.tu,{bg:"secondary",radius:"md",padding:24,gap:32,children:[a&&(0,Z.BX)(sr.tu,{gap:12,children:[(0,Z.BX)(sr.tu,{gap:2,children:[(0,Z.tZ)(sr.xv.B3,{weight:"semibold",color:"primary",children:a}),(0,Z.tZ)(sr.xv.B3,{weight:"regular",color:"secondary",children:l})]}),(0,Z.tZ)(sr.xu,{children:(0,Z.tZ)(_F,{feedUrl:t})})]}),s&&(0,Z.BX)(sr.tu,{gap:12,children:[(0,Z.BX)(sr.tu,{gap:2,children:[(0,Z.tZ)(sr.xv.B3,{weight:"semibold",color:"primary",children:s}),(0,Z.BX)(sr.xv.B3,{weight:"regular",color:"secondary",children:[d,o&&(0,Z.BX)(Z.HY,{children:[" ",(0,Z.tZ)(sr.hh,{decoration:"underline",href:o,translated:!0,children:"Learn more"})]})]})]}),(0,Z.tZ)(sr.xu,{children:(0,Z.tZ)(sr.zx,{newTab:!0,priority:"secondary-outline",leading:(0,Z.tZ)(iy.Z,{size:20}),href:c,children:u})})]}),(0,Z.BX)(sr.tu,{gap:12,children:[p&&(0,Z.BX)(sr.tu,{gap:2,children:[(0,Z.tZ)(sr.xv.B3,{weight:"semibold",color:"primary",children:p}),(0,Z.tZ)(sr.xv.B3,{weight:"regular",color:"secondary",children:h})]}),(0,Z.BX)(sr.gq,{gap:12,children:[(0,Z.tZ)(tD.oi,{ref:b,value:g,onChange:e=>{v(e.currentTarget.value)},flex:"grow"}),(0,Z.tZ)(sr.zx,{priority:"secondary-outline",onClick:async()=>{try{await N().put("/api/v1/publication/show_links").send({[r]:g,sectionId:n?null==n?void 0:n.id:null}),y.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:m("Your link has been updated!")})))}catch(t){let e=(0,Y.zx)(t);y.popToast(t=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},t),{text:e})))}},children:m("Save")})]})]})]})}function _z(e){let{logo:t,name:i,children:n,isDone:r,startExpanded:o}=e,[a,l]=(0,A.eJ)(o);return(0,Z.BX)(sr.tu,{paddingX:24,paddingY:16,children:[(0,Z.BX)(sr.gq,{alignItems:"center",gap:24,onClick:()=>l(!a),children:[t,(0,Z.tZ)(sr.xv.B2,{weight:"semibold",color:"primary",flex:"grow",children:i}),r?(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(sr.gq,{alignItems:"center",gap:8,children:[(0,Z.tZ)(eE.Z,{size:24}),(0,Z.tZ)(sr.xv.B3,{color:"secondary",weight:"semibold",translated:!0,children:"Done"})]})}):(0,Z.tZ)(tw.Z,{color:"var(--color-fg-secondary)"})]}),(0,Z.tZ)(ik.H,{expanded:a,children:(0,Z.tZ)(sr.xu,{paddingTop:16,children:n})})]})}function _O(e){let{icon:t}=e;return(0,Z.tZ)(sr.tu,{width:40,height:40,alignItems:"center",justifyContent:"center",children:t})}let _U=e=>{let{error:t}=e;return t?(0,Z.tZ)("div",{"aria-label":"podcast-form-error",className:k()("error","error-iDoVoW"),children:t}):null},_Y={none:"none-Swrvgv",rssFeedInput:"rssFeedInput-z3MCM6",copyButton:"copyButton-LB38ZG",podcastUrlContainer:"podcastUrlContainer-A5X5VS"},_H="innerFancyForm-hF9MP9",_j="unsetBackgroundColor-D4M8Yo",_J="formWrapper-zRb6oe",_V=_o.Z.getAllNames().sort().map(e=>({value:"English"===e?"":_o.Z.getCode(e),label:e})),_q=e=>{var t,i,n,r,o,a,l,s,d;return{podcast_description:null!==(t=e.description)&&void 0!==t?t:"",itunes_explicit:e.isExplicit?"true":"false",itunes_podcast_primary_category:null!==(i=e.primaryCategory)&&void 0!==i?i:"",itunes_podcast_primary_subcategory:null!==(n=e.primarySubcategory)&&void 0!==n?n:"",itunes_podcast_secondary_category:null!==(r=e.secondaryCategory)&&void 0!==r?r:"",itunes_podcast_secondary_subcategory:null!==(o=e.secondarySubcategory)&&void 0!==o?o:"",podcast_language:null!==(a=e.language)&&void 0!==a?a:"",podcast_art_url:null!==(l=e.artUrl)&&void 0!==l?l:"",podcast_title:null!==(s=e.title)&&void 0!==s?s:"",podcast_byline:null!==(d=e.byline)&&void 0!==d?d:"",is_podcast:"true"}},_W=e=>{var t,i,n,r;let{podcastHasBeenPersisted:o,isSection:a,podcastSettings:l,onUploadedArtFileChanged:s,loading:d,artError:c,titleError:u,descriptionError:p,primaryCategoryError:h,pub:m,secondaryCategoryError:g,section:v,showNavigationTabOption:b}=e,{iString:y}=(0,Q.M1)(),[w,C]=(0,A.eJ)(l.primaryCategory),[x,S]=(0,A.eJ)(l.primarySubcategory),[B,T]=(0,A.eJ)(l.secondaryCategory),[I,N]=(0,A.eJ)(l.secondarySubcategory),[P,E]=(0,A.eJ)(l.isExplicit),[X,M]=(0,A.eJ)(l.artUrl),[D,R]=(0,A.eJ)(null!==(t=l.showPodcastTab)&&void 0!==t?t:null),[F,L]=(0,A.eJ)(l.language),z=(0,en.zF4)("/img/podcast/generic.png",1400),O=(0,iN.pm)();return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)("label",{children:[y("Podcast title"),(0,Z.BX)("div",{className:"error-box",children:[(0,Z.tZ)("input",{className:_j,type:"text",name:"podcast_title",defaultValue:null!==(i=l.title)&&void 0!==i?i:void 0,placeholder:y("Type a podcast title")}),(0,Z.tZ)(_U,{error:u})]}),(0,Z.tZ)("div",{className:"info",children:y("Pick a clear, descriptive title that will be easy to search for on Substack and other podcast platforms.")})]}),(0,Z.BX)("label",{children:[y("Podcast description"),(0,Z.BX)("div",{className:"error-box",children:[(0,Z.tZ)("textarea",{className:_j,rows:4,name:"podcast_description",defaultValue:null!==(n=l.description)&&void 0!==n?n:void 0,placeholder:y("Type a podcast description")}),(0,Z.tZ)(_U,{error:p})]}),(0,Z.tZ)("div",{className:"info",children:y("Write one or more sentences to tell listeners what your podcast is all about.")})]}),(0,Z.BX)("label",{children:[y("Podcast byline"),(0,Z.tZ)("div",{className:"error-box",children:(0,Z.tZ)("input",{type:"text",name:"podcast_byline",className:_j,defaultValue:null!==(r=l.byline)&&void 0!==r?r:void 0,placeholder:y("Type a podcast author")})}),(0,Z.tZ)("div",{className:"info",children:y("This line will appear directly beneath your title in most listening apps.")})]}),o&&(0,Z.BX)(sr.tu,{gap:6,className:_Y.podcastUrlContainer,children:[(0,Z.BX)(sr.tu,{gap:2,children:[(0,Z.tZ)(sr.xv.B3,{color:"primary",weight:"semibold",children:l.isRedirected?y("RSS feed redirected to"):y("Your public RSS feed")}),(0,Z.tZ)(sr.xv.B3,{color:"secondary",weight:"regular",translated:!0,children:"Anyone can use this URL to subscribe to your podcast in their favorite app. Note: This RSS feed does not include paid episodes. Paid subscribers need to sign in to access a subscribers-only feed."})]}),(0,Z.BX)("div",{className:k()("inline-form",_Y.rssFeedInput),children:[(0,Z.tZ)(_c,{"data-testid":"podcast-rss-url",value:l.podcastRssUrl}),(0,Z.tZ)(sr.zx,{className:_Y.copyButton,priority:"secondary",leading:(0,Z.tZ)(_d,{}),onClick:()=>{(0,Y.vQ)(l.podcastRssUrl),O.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:y("Copied to clipboard!")})))},children:y("Copy")})]})]}),o&&(0,Z.tZ)(_R,{pub:m,section:v}),(0,Z.BX)("label",{className:"category",htmlFor:"podcast_primary_category",children:[y("Podcast categories"),(0,Z.tZ)(_h,{inputId:"podcast_primary_category",type:"primary",categoryValue:w,subcategoryValue:x,setCategoryValue:C,setSubcategoryValue:S,disabled:!!d}),(0,Z.BX)("div",{className:"error-box",children:[(0,Z.tZ)(_U,{error:h}),(0,Z.tZ)("input",{type:"hidden","aria-label":"itunes_podcast_primary_category",name:"itunes_podcast_primary_category",value:null!=w?w:void 0}),(0,Z.tZ)("input",{type:"hidden","aria-label":"itunes_podcast_primary_subcategory",name:"itunes_podcast_primary_subcategory",value:null!=x?x:void 0})]})]}),(0,Z.BX)("label",{className:"condensed",htmlFor:"podcast_secondary_category",children:[(0,Z.tZ)("div",{className:_Y.none,children:y("Secondary category")}),(0,Z.tZ)(_h,{type:"secondary",inputId:"podcast_secondary_category",categoryValue:B,subcategoryValue:I,setCategoryValue:T,setSubcategoryValue:N,disabled:d}),(0,Z.BX)("div",{className:"error-box",children:[(0,Z.tZ)(_U,{error:g}),(0,Z.tZ)("input",{type:"hidden","aria-label":"itunes_podcast_secondary_category",name:"itunes_podcast_secondary_category",value:null!=B?B:void 0}),(0,Z.tZ)("input",{type:"hidden","aria-label":"itunes_podcast_secondary_subcategory",name:"itunes_podcast_secondary_subcategory",value:null!=I?I:void 0})]}),(0,Z.tZ)("div",{className:"info",children:y("Platforms like Apple Podcasts will use these categories to sort and recommend your show.")})]}),(0,Z.tZ)(ic.p,{name:"itunes_explicit",label:y("Explicit content?"),info:y("Let listeners know if they should expect explicit or adult content."),checked:null!=P&&P,onChange:E,disabled:d}),b&&(0,Z.tZ)(ic.p,{name:"show_pub_podcast_tab",label:y("Podcast tab"),info:y("Add a Podcast tab to your publication site to display your podcast name, description, and a list of all episodes."),checked:null!=D&&D,onChange:R,disabled:d}),(0,Z.BX)("label",{htmlFor:"podcast_language",children:[y("Podcast language"),(0,Z.tZ)(gd,{options:_V,inputId:"podcast_language",onChange:e=>{let{value:t}=e;L(t)},defaultValue:_V.find(e=>{let{value:t}=e;return t===(F||"")}),styles:{option:e=>(0,_._)((0,f._)({},e),{fontSize:"14px"})},isSearchable:!0,isDisabled:d,variant:"light"}),(0,Z.tZ)("input",{type:"hidden","aria-label":"podcast_language",name:"podcast_language",value:F})]}),(0,Z.tZ)("label",{children:(0,Z.tZ)(_s,{artUrl:null!=X?X:void 0,disabled:d,error:null!=c?c:void 0,label:y("Podcast artwork"),loading:d,removable:X!==z,requirements:y("Upload a square image at least 1400px wide to represent your podcast."),onChange:(e,t)=>{s(e),M(t)},onClear:()=>{s(null),M(z)}})}),(0,Z.tZ)("input",{type:"hidden",name:a?"is_podcast":"podcast_enabled",value:"true"})]})},_G=e=>{let{podcastHasBeenPersisted:t,pub:i,publication:n,section:r,onSuccess:o,podcastSettings:a,performSubmit:l,hideNewsletterSelector:s=!1,onCancel:d,showNavigationTabOption:c=!1}=e,{iString:u}=(0,Q.M1)(),p=(0,A.sO)(null),[h,m]=(0,A.eJ)(!1),[g,v]=(0,A.eJ)(!1),[b,y]=(0,A.eJ)(null),[w,C]=(0,A.eJ)(null),[x,S]=(0,A.eJ)(null),[k,B]=(0,A.eJ)(null),[T,I]=(0,A.eJ)(null),[P,E]=(0,A.eJ)(null),X=(null==r?void 0:r.id)||null,M=null!==X,D=a||(M?(0,co.aL)({pub:i,section:r}):(0,co.fP)({pub:i,publication:n}));return(0,A.d4)(()=>{m(!0)},[]),(0,A.d4)(()=>{_e({isNew:!t,description:null==D?void 0:D.description,language:null==D?void 0:D.language,itunes_podcast_primary_category:null==D?void 0:D.primaryCategory,itunes_podcast_primary_subcategory:null==D?void 0:D.primarySubcategory,itunes_podcast_secondary_category:null==D?void 0:D.secondaryCategory,itunes_podcast_secondary_subcategory:null==D?void 0:D.secondarySubcategory,itunes_explicit:null==D?void 0:D.isExplicit,podcast_art_url:null==D?void 0:D.artUrl,podcast_title:null==D?void 0:D.title,podcast_byline:null==D?void 0:D.byline,show_pub_podcast_tab:null==D?void 0:D.showPodcastTab})},[]),(0,Z.BX)(tP.ZP,{className:_J,ref:p,loading:g,performSubmit:l,action:X?"/api/v1/publication/sections/".concat(X):"/api/v1/publication",method:M?"patch":"put",prepareData:async e=>{v(!0);let t=_K(e);try{S(null),B(null),I(null),E(null);let e=!1;if(t.name||t.podcast_title||(S(u("Please enter a title")),e=!0),t.description||t.podcast_description||(B(u("Please enter a description")),e=!0),t.itunes_podcast_primary_category||(I(u("Please select a primary category")),e=!0),t.itunes_podcast_secondary_category||(E(u("Please select a secondary category")),e=!0),e)throw"validation error";if(b){C(null);let e=await N().post("/api/v1/podcast_art").field("for_section",M).attach("podcast_art",b);return(0,_._)((0,f._)({},t),{podcast_art_url:e.body.podcast_art_url})}if(null==D?void 0:D.artUrl)return(0,_._)((0,f._)({},t),{podcast_art_url:D.artUrl});throw"empty"}catch(e){if(console.error(e),"validation error"===e)throw e;throw C("empty"===e?u("Please upload an image"):(0,Y.zx)(e)),e}finally{v(!1)}},autoLock:!0,onSuccess:(e,i)=>{let n={isNew:!t,language:i.language,itunes_podcast_primary_category:i.itunes_podcast_primary_category,itunes_podcast_primary_subcategory:i.itunes_podcast_primary_subcategory,itunes_podcast_secondary_category:i.itunes_podcast_secondary_category,itunes_podcast_secondary_subcategory:i.itunes_podcast_secondary_subcategory,itunes_explicit:i.itunes_explicit,podcast_art_url:i.podcast_art_url};M?_t((0,_._)((0,f._)({},n),{name:i.name,description:i.description})):_t((0,_._)((0,f._)({},n),{podcast_title:i.podcast_title,podcast_description:i.podcast_description,podcast_byline:i.podcast_byline})),o&&o(e)},onError:()=>{_i({isNew:!t})},children:[!s&&(0,Z.BX)("label",{children:[u("Audience list"),(0,Z.tZ)("div",{className:"error-box",children:(0,Z.tZ)("input",{type:"text",defaultValue:r?r.name:i.name,readOnly:!0})})]}),(0,Z.tZ)(_W,{podcastHasBeenPersisted:t,isSection:M,podcastSettings:D,loading:g,onUploadedArtFileChanged:e=>{y(e)},artError:w,titleError:x,descriptionError:k,primaryCategoryError:T,pub:i,secondaryCategoryError:P,section:r,showNavigationTabOption:c}),(0,Z.BX)(et.hs,{justifyContent:"end",paddingTop:24,children:[(0,Z.tZ)("div",{id:"error-container"}),(0,Z.BX)(et.hs,{gap:8,children:[d&&(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:d,children:u("Cancel")}),(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",children:t?u("Save podcast settings"):u("Create podcast")})]})]})]},h?"mounted":"unmounted")},_K=e=>{let t=f7()(e,rp.wg.map(e=>e.fieldName));for(let i of rp.wg)e[i.fieldName]&&(t[i.fieldName]=e[i.fieldName]);return t},_Q=e=>{let t,{pub:i,publication:n,initialSectionId:r,onSuccess:o}=e,[a,l]=(0,A.eJ)(!1);if(r){if(!(t=i.sections.find(e=>e.id===r)))return(0,Z.tZ)(ei.xv.B3,{translated:!0,children:"Section not found"});if(t.is_podcast)return(0,Z.BX)(ei.xv.B3,{translated:!0,children:["This newsletter already has a podcast. Visit"," ",(0,Z.tZ)("a",{href:(0,en.F6J)({pub:i,section:t,addBase:!0}),children:"the settings page"})," to edit the podcast."]})}else if(i.podcast_enabled)return(0,Z.BX)(ei.xv.B3,{translated:!0,children:["This newsletter already has a podcast. Visit"," ",(0,Z.tZ)("a",{href:(0,en.by7)({pub:i,addBase:!0}),children:"the settings page"})," to edit the podcast."]});return a?(0,Z.tZ)(Zm,{pub:i,publication:n,referrer:window.location.href,step:f1.Success,hideCornerIcon:!0}):(0,Z.tZ)("div",{className:"page typography",children:(0,Z.tZ)(_G,{podcastHasBeenPersisted:!1,pub:i,publication:n,section:null!=t?t:null,podcastSettings:null,onSuccess:()=>{l(!0),null==o||o()},showNavigationTabOption:!t})})},_$=eb(e=>{let{publication:t,pub:i}=ey(),{onSubmit:n,sectionId:r}=e;return(0,Z.BX)("div",{className:"detail",children:[(0,Z.tZ)(f6,{step:f1.Detail}),(0,Z.tZ)(_Q,{pub:i,publication:t,initialSectionId:r,onSuccess:()=>{null==n||n()}})]})});var _0=i(74134);let _1=e=>{let{isOpen:t,pub:i,publication:n,onComplete:r,onClose:o,section:a,podcastSettings:l}=e;return(0,Z.tZ)(eK.u_,{isOpen:t,onClose:o,children:(0,Z.tZ)("div",{className:"new-section-page",children:(0,Z.tZ)(et.hs,{padding:16,children:(0,Z.tZ)(_G,{pub:i,podcastSettings:l,section:null!=a?a:null,publication:n,podcastHasBeenPersisted:!1,performSubmit:e=>{r({title:e.podcast_title,description:e.podcast_description,language:e.podcast_language,isExplicit:"true"===e.itunes_explicit,byline:e.podcast_byline,artUrl:e.podcast_art_url,primaryCategory:e.itunes_podcast_primary_category,primarySubcategory:e.itunes_podcast_primary_subcategory,secondaryCategory:e.itunes_podcast_secondary_category,secondarySubcategory:e.itunes_podcast_secondary_subcategory,podcastRssUrl:null,paidEpisodeArtUrl:null,isRedirected:null,showPodcastTab:null})},hideNewsletterSelector:!0,onCancel:o})})})})},_2=e=>{let{pub:t,publication:i,section:n,onSuccess:r,sectionHasBeenPersisted:o}=e,{iString:a}=(0,Q.M1)(),[l,s]=(0,A.eJ)(!1);return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:a("Start a podcast"),secondaryText:a(o?"Set up a podcast to get started publishing audio to your subscribers.":"Set up a podcast to get started publishing audio to your subscribers. If you want to import a podcast, finish setting up your newsletter then add your podcast after.")}),n?(0,Z.tZ)(ee.zx,{priority:"secondary",href:(0,en.Iww)({section:n}),children:a("New podcast")}):(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>s(!0),children:a("New podcast")}),n&&o?(0,Z.tZ)(ee.zx,{priority:"secondary",href:(0,en.o4O)({section:n}),children:a("Import podcast")}):null]}),(0,Z.tZ)(_1,{isOpen:l,onClose:()=>s(!1),pub:t,publication:i,section:n,podcastSettings:(0,co.aL)({pub:t,section:n}),onComplete:e=>{null==r||r(e),s(!1)}})]})},_4=e=>{let{title:t,children:i}=e,n=(0,pY.XA)();return(0,Z.BX)(tp.tu,{gap:n?8:20,radius:"md",children:[(0,Z.tZ)(tp.gq,{alignItems:"center",gap:8,children:n?(0,Z.tZ)(ei.xv.Meta,{children:t}):(0,Z.tZ)(ei.xv.H3,{children:t})}),(0,Z.tZ)(tp.tu,{border:"detail",paddingX:n?16:20,paddingY:16,radius:"md",children:i})]})};function _3(){let e=(0,G._)(["Deleting the section "," will:"]);return _3=function(){return e},e}function _8(){let e=(0,G._)(["- Delete the associated podcast ",""]);return _8=function(){return e},e}let _6=e=>{let{section:t,language:i}=e,{iTemplate:n,iString:r}=I18N.i(i),o=r("WARNING! This is an irreversible action.");if(o+="\n\n",o+=n(_3(),t.name),o+="\n",o+=r("- Remove all free subscribers only opted into this section"),o+="\n",t.is_podcast){var a,l;o+=n(_8(),null!==(l=null==t?void 0:null===(a=t.podcastSettings)||void 0===a?void 0:a.podcast_title)&&void 0!==l?l:""),o+="\n"}return o+=r("- Move all posts in this section to your publication homepage"),o+="\n\n",o+=r("Are you sure you want to delete this section?")},_5=async e=>{let{pub:t,section:i,language:n}=e,{iString:r}=I18N.i(n);i&&confirm(_6({section:i,language:n}))&&((0,U.j)(U.FP.SECTION_DELETION_INITIATED,{publication_id:t.id,section_id:i.id}),await N().del("/api/v1/publication/sections/".concat(i.id)),alert(r("Your section is being deleted")),window.location.assign((0,j.wI3)(t,{section:"section-settings"})))},_9=e=>{let{pub:t,section:i}=e,{iString:n,language:r}=(0,Q.M1)();return(0,Z.tZ)("div",{children:(0,Z.tZ)(_4,{title:n("Danger zone"),children:(0,Z.tZ)(et.tu,{gap:32,children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Delete section"),secondaryText:n("Delete your section and move all posts to your top-level publication")}),(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:()=>{_5({pub:t,section:i,language:r})},children:n("Delete")})]})})})})};function _7(){let e=(0,G._)(["If checked, anyone who subscribes to your publication, ",", will be automatically subscribed to this newsletter as well. If unchecked, they will have to subscribe to this newsletter separately."]);return _7=function(){return e},e}function Ze(){let e=(0,G._)(["If checked, all your current subscribers will automatically be subscribed to this newsletter."]);return Ze=function(){return e},e}let Zt=e=>{var t,i,n;let{hideImageGeneration:r,section:o,pub:a,publication:l,onSuccess:s,onCancel:d,hidePodcastSettings:c=!1}=e,{iString:u}=(0,Q.M1)(),p=!!o,[h,m]=(0,A.eJ)(!1),g=(0,A.sO)(null),[v,b]=(0,A.eJ)(null!==(t=null==o?void 0:o.logo_url)&&void 0!==t?t:null),[y,_]=(0,A.eJ)(void 0),[w,C]=(0,A.eJ)(void 0),[x,S]=(0,A.eJ)(null!==(i=null==o?void 0:o.cover_photo_url)&&void 0!==i?i:null),[B,T]=(0,A.eJ)(void 0),[I,P]=(0,A.eJ)(void 0),[E,X]=(0,A.eJ)(null),[M,D]=(0,A.eJ)(null),[R,F]=(0,A.eJ)(null),[L,z]=(0,A.eJ)(!p||null!==(n=null==o?void 0:o.is_default_on)&&void 0!==n&&n),[O,U]=(0,A.eJ)(!0),H=p&&(null==o?void 0:o.is_podcast)?(0,co.d_)({pub:a,section:o}):null,[j,J]=(0,A.eJ)(H),[V,q]=(0,A.eJ)(!1);return(0,Z.tZ)(Z.HY,{children:(0,Z.tZ)(tP.ZP,{ref:g,className:k()("section",_J),loading:h,method:p?"patch":"post",action:"/api/v1/publication/sections/".concat(p?null==o?void 0:o.id:""),autoLock:!0,prepareData:async e=>{var t=(0,gO._)({},(0,gU._)(e));m(!0),D(null),F(null),t.name&&""!==t.name||D(u("Please enter a title")),t.description&&""!==t.description||F(u("Please enter a description"));let i=V&&j?_q(j):{},n=(0,f._)({},t,i);if(y){C(void 0);try{let e=await N().post("/api/v1/publication/upload_logo").attach("logo",y);n.logo_url=e.body.url}catch(e){C((0,Y.zx)(e))}}else n.logo_url=v;if(B){P(void 0);try{let e=await N().post("/api/v1/publication/upload_logo").attach("logo",B);n.cover_photo_url=e.body.url}catch(e){P((0,Y.zx)(e))}}else n.cover_photo_url=x;return V&&(null==j?void 0:j.artUrl)&&(n.podcast_art_url=j.artUrl),m(!1),n},onSuccess:e=>{s&&s(e)},onError:e=>{let t=!1;e.response.body.error?e.response.body.error.match(/name already exists/i)?(D(u("A section with this name already exists")),t=!0):X(e.response.body.error):e.response.body.errors&&e.response.body.errors.forEach(e=>{t=!0,"name"===e.param?D(e.msg):"description"===e.param&&F(e.msg)}),t&&X(u("There was a problem creating the section. Please correct the errors and try again.")),_i({isNew:!p,isPodcast:!1})},children:(0,Z.BX)(tp.tu,{gap:24,children:[(0,Z.tZ)(Zi,{artError:w,artUrl:v,coverPhotoError:I,coverPhotoUrl:x,descriptionError:R,hideImageGeneration:r,loading:h,pub:a,section:null!=o?o:void 0,sectionHasBeenPersisted:p,setArtFile:_,setArtUrl:b,setCoverPhotoFile:T,setCoverPhotoUrl:S,titleError:M}),!c&&(0,Z.tZ)(Zr,{section:null!=o?o:void 0,sectionHasBeenPersisted:p,pub:a,publication:l,podcastSettings:null!=j?j:void 0,onPodcastSettingsAdded:e=>{p||q(!0),J(e)}}),(0,Z.tZ)(Zo,{isDefaultOn:L,setIsDefaultOn:z,pub:a,section:null!=o?o:void 0,sectionHasBeenPersisted:p,shouldPortExistingSignups:O,setShouldPortExistingSignups:U}),E&&(0,Z.tZ)(ei.xv.B5,{color:"error",children:E}),(0,Z.BX)(et.hs,{gap:8,justifyContent:"end",children:[d&&(0,Z.tZ)(ee.zx,{onClick:d,priority:"secondary",children:u("Cancel")}),(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",children:p?u("Save section"):u("Create section")})]}),p&&(0,Z.tZ)(_9,{pub:a,section:o})]})})})},Zi=e=>{var t,i,n;let{artError:r,artUrl:o,coverPhotoError:a,coverPhotoUrl:l,descriptionError:s,hideImageGeneration:d,loading:c,pub:u,section:p,sectionHasBeenPersisted:h,setArtFile:m,setArtUrl:g,setCoverPhotoFile:v,setCoverPhotoUrl:b,titleError:y}=e,{iString:f}=(0,Q.M1)(),[_,w]=(0,A.eJ)(null!==(t=null==p?void 0:p.hide_posts_from_pub_listings)&&void 0!==t&&t),[C,x]=(0,A.eJ)(null!==(i=null==p?void 0:p.hide_intro_title)&&void 0!==i&&i),[S,k]=(0,A.eJ)(null!==(n=null==p?void 0:p.hide_intro_subtitle)&&void 0!==n&&n);return(0,Z.BX)(_4,{title:f("Section"),children:[(0,Z.BX)("label",{children:[f("Title"),(0,Z.BX)("div",{className:"error-box",children:[(0,Z.tZ)("input",{className:_j,type:"text",name:"name",placeholder:f("Type your newsletter nameâ€¦"),defaultValue:null==p?void 0:p.name}),(0,Z.tZ)(_U,{error:y})]})]}),(0,Z.BX)("label",{children:[f("Description"),(0,Z.BX)("div",{className:"error-box",children:[(0,Z.tZ)("textarea",{className:_j,name:"description",placeholder:f("E.g. â€œThe hottest gossip about armadillosâ€"),defaultValue:null==p?void 0:p.description}),(0,Z.tZ)(_U,{error:s})]})]}),(0,Z.BX)("label",{children:[f("Email sender name"),(0,Z.BX)("div",{className:"error-box",children:[(0,Z.tZ)("input",{className:_j,type:"text",name:"email_from_name",placeholder:f("Optional - by default this is your publication name"),defaultValue:null==p?void 0:p.email_from_name}),(0,Z.tZ)("div",{className:"info",children:f("Recipients of your emails will see this as the sender")})]})]}),h&&(0,Z.BX)("label",{children:[f("Web URL"),(0,Z.BX)("div",{className:"slug-input-container",children:[(0,Z.BX)("span",{className:"slug-preamble",children:[(0,en.SVA)(u),"/s/"]}),(0,Z.tZ)("input",{type:"text",name:"slug",defaultValue:null==p?void 0:p.slug})]})]}),(0,Z.tZ)(ic.p,{name:"hide_posts_from_pub_listings",label:f("Hide posts from homepage"),info:f("If checked, posts from this section will not appear on your publication homepage or publication archive. Posts will still appear in the section's page."),checked:_,onChange:w}),(0,Z.tZ)(_s,{artUrl:null!=o?o:void 0,enableImageGeneration:!d,error:r,label:f("Section logo (optional)"),loading:c,requirements:f("Should be a square image at least 256\xd7256 and have a transparent background"),onChange:(e,t)=>{m(e),g(t)},onClear:()=>{m(void 0),g(null)}}),p&&(0,Z.tZ)(eW.SiteConfigGate,{configKey:"section_specific_welcome_pages",children:(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(_s,{artUrl:null!=l?l:void 0,error:a,label:f("Cover photo (optional)"),loading:c,requirements:f("This optional image will show up on your welcome page for this section. If you include one, it should be at least 600x600px."),onChange:(e,t)=>{v(e),b(t)},onClear:()=>{v(void 0),b(null)}}),(0,Z.tZ)(ik.H,{expanded:!!l,children:(0,Z.BX)(ts.xu,{paddingTop:32,children:[(0,Z.tZ)(ic.p,{name:"hide_intro_title",label:f("Hide the section name on the section welcome page"),checked:C,onChange:x}),(0,Z.tZ)(ic.p,{name:"hide_intro_subtitle",label:f("Hide the section description on the section welcome page"),checked:S,onChange:k})]})})]})}),p&&(0,Z.tZ)(eW.SiteConfigGate,{configKey:"section_specific_preambles",children:(0,Z.BX)("label",{children:[f("Email header settings"),(0,Z.tZ)(ts.xu,{paddingTop:8,children:(0,Z.tZ)(ee.zx,{priority:"secondary",href:(0,en.jeD)(u,{section:p}),children:f("Update banner and headers")})})]})})]})},Zn=e=>{var t,i;let{section:n,pub:r,publication:o,podcastSettings:a,onUnsavedPodcastSettingsEdited:l}=e,{iString:s}=(0,Q.M1)(),d=!!n,[c,u]=(0,A.eJ)(!1);return(0,Z.BX)(tp.tu,{alignItems:"stretch",children:[(0,Z.tZ)(_0.i,{children:(0,Z.tZ)(_0.a,{imgSrc:a.artUrl,href:n&&(0,en.Ucy)(r,{section:n,addBase:!0}),title:null!==(t=a.title)&&void 0!==t?t:"",subtitle:null!==(i=a.description)&&void 0!==i?i:"",action:d?(0,Z.tZ)(ee.zx,{priority:"secondary",href:(0,en.F6J)({pub:r,section:n,addBase:!0,referrer:document.location.pathname}),children:s("Edit")}):(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>u(!0),children:s("Edit")})})}),d?null:(0,Z.tZ)(_1,{isOpen:c,pub:r,publication:o,section:n,podcastSettings:a,onComplete:e=>{l(e),u(!1)},onClose:()=>u(!1)})]})},Zr=e=>{let{section:t,sectionHasBeenPersisted:i,pub:n,publication:r,podcastSettings:o,onPodcastSettingsAdded:a}=e,{iString:l}=(0,Q.M1)();return(0,Z.tZ)(_4,{title:l("Podcast"),children:o?(0,Z.tZ)(Zn,{section:t,pub:n,publication:r,podcastSettings:o,onUnsavedPodcastSettingsEdited:a}):(0,Z.tZ)(_2,{section:t,sectionHasBeenPersisted:i,pub:n,publication:r,onSuccess:null!=a?a:void 0})})},Zo=e=>{let{isDefaultOn:t,setIsDefaultOn:i,pub:n,section:r,sectionHasBeenPersisted:o,shouldPortExistingSignups:a,setShouldPortExistingSignups:l}=e,{iString:s,iTemplate:d}=(0,Q.M1)(),c=async e=>{let{sectionId:t}=e;if(!t){console.error(s("sectionId not found, cannot add subscribers"));return}try{await N().post("/api/v1/publication/sections/".concat(t,"/enable-emails-for-users")),alert(s("Emails are being turned on for this section--it should complete in a few minutes"))}catch(e){alert((0,Y.zx)(e,s("There was a network issue. Try again in a bit")))}};return(0,Z.tZ)(_4,{title:"Subscriber settings",children:(0,Z.BX)(tp.tu,{gap:32,children:[(0,Z.tZ)(ic.p,{name:"is_default_on",label:s("Add new subscribers by default"),info:d(_7(),n.name),checked:t,onChange:i}),!o&&(0,Z.tZ)("div",{children:(0,Z.tZ)(ic.p,{name:"port_existing_signups",label:s("Copy your email list"),info:d(Ze()),checked:a,onChange:l})}),o&&(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:s("Add all existing subscribers"),secondaryText:s("This will add all of your existing subscribers to this section's mailing list, unless they have explicitly opted out of emails to this section.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:async()=>{await c({sectionId:null==r?void 0:r.id})},children:s("Add subscribers")})]})]})})},Za=e=>{let{pub:t,publication:i,onSuccess:n,hidePodcastSettings:r}=e,{iString:o}=(0,Q.M1)(),a=(0,pY.XA)()?ei.xv.H3:ei.xv.H1;return(0,Z.BX)("div",{className:"page typography",children:[(0,Z.BX)(et.tu,{paddingX:{desktop:32,mobile:20},paddingY:16,children:[(0,Z.tZ)(a,{paddingBottom:8,children:o("New section")}),(0,Z.BX)(ei.xv.B4,{translated:!0,children:["This section will live within your Substack ",(0,Z.tZ)("b",{children:I18N.p(t.name)}),"."]})]}),(0,Z.tZ)(Zt,{pub:t,publication:i,section:null,onSuccess:e=>{n?n(e.body.section):(0,Y.uX)((0,j.wI3)(t,{section:"section-settings"}),{local_navigation:!1})},onCancel:()=>{(0,Y.uX)((0,j.wI3)(t,{section:"section-settings"}),{local_navigation:!1})},hidePodcastSettings:null!=r&&r})]})},Zl=e=>{let{pub:t,publication:i,isOpen:n,onClose:r,onSuccess:o}=e;return(0,Z.tZ)(eK.u_,{disableCloseOnBackdropClick:!0,isOpen:n,width:600,onClose:r,children:(0,Z.tZ)(et.hs,{padding:16,children:(0,Z.tZ)(Zt,{hideImageGeneration:!0,pub:t,publication:i,section:null,onSuccess:e=>{o?o(e.body.section):(0,Y.uX)((0,j.wI3)(t,{section:"section-settings"}),{local_navigation:!1})},onCancel:()=>{(0,Y.uX)((0,j.wI3)(t,{section:"section-settings"}),{local_navigation:!1})},hidePodcastSettings:!0})})})},Zs={logo:"logo-TD7AdX",newsletterPill:"newsletterPill-Id9Gr2",newsletterPillSelected:"newsletterPillSelected-wDla1_",newsletterPillDisabled:"newsletterPillDisabled-YecA3s"},Zd=e=>{var t,i,n,r;let{iString:o}=(0,Q.M1)(),a=[];for(let l of(a.push({name:null!==(t=e.name)&&void 0!==t?t:o("Publication newsletter"),sectionId:null,alreadyHasPodcast:null!==(i=e.podcast_enabled)&&void 0!==i&&i,logoUrl:e.logo_url}),null!==(n=e.sections)&&void 0!==n?n:[]))a.push({name:l.name,sectionId:l.id,alreadyHasPodcast:null!==(r=l.is_podcast)&&void 0!==r&&r,logoUrl:l.logo_url});return a},Zc=e=>{let{pub:t,publication:i,initialSectionId:n,onSubmit:r}=e,{iString:o}=(0,Q.M1)(),a=Zd(t),{setPublication:l}=ey(),[s,d]=(0,A.eJ)(n),[c,u]=(0,A.eJ)(!1);return a.push({alreadyHasPodcast:!1,name:o("Create new section"),sectionId:-1}),(0,Z.BX)(tU.w,{children:[(0,Z.BX)(et.tu,{alignItems:"center",children:[(0,Z.tZ)(f6,{step:f1.PickNewsletter}),(0,Z.tZ)(et.gq,{alignItems:"center",gap:16,wrap:"wrap",justifyContent:"center",paddingBottom:32,children:a.map(e=>{let{name:t,sectionId:i,alreadyHasPodcast:n,logoUrl:r}=e;return(0,Z.tZ)(tW.u,{as:"div",disabled:!n,text:o("This newsletter already has a podcast"),children:(0,Z.BX)(et.hs,{border:"detail",radius:"md",gap:16,padding:16,alignItems:"center",sizing:"border-box",onClick:()=>{n||d(i)},className:k()(Zs.newsletterPill,{[Zs.newsletterPillSelected]:i===s,[Zs.newsletterPillDisabled]:n}),children:[-1===i?(0,Z.tZ)(ta.Z,{size:20}):r&&(0,Z.tZ)("img",{className:Zs.logo,src:(0,en.zF4)(r,80),alt:"".concat(t," logo")}),(0,Z.tZ)(ei.xv,{size:14,weight:"semibold",lineHeight:36,children:t})]})})})}),(0,Z.tZ)(ee.zx,{priority:"primary",disabled:void 0===s,onClick:()=>{-1===s?u(!0):void 0!==s&&r(s)},children:o("Continue")})]}),(0,Z.tZ)(Zl,{pub:t,publication:i,isOpen:c,onClose:()=>u(!1),onSuccess:e=>{var n;u(!1),l({pub:(0,_._)((0,f._)({},t),{sections:[...null!==(n=t.sections)&&void 0!==n?n:[],e]}),publication:i}),r(e.id)}})]})},Zu=e=>(0,Z.tZ)(eH.l,(0,_._)((0,f._)({},e),{name:"ThinCircleCheckmarkIcon",svgParams:{viewBox:"0 0 72 72",height:72,width:72,fill:"none"},children:(0,Z.BX)("g",{children:[(0,Z.tZ)("path",{d:"M19 37.5L29.5 48L52.5 25","stroke-width":"2","stroke-linecap":"round"}),(0,Z.tZ)("rect",{x:"1",y:"1",width:"70",height:"70",rx:"35","stroke-width":"2"})]})})),Zp=e=>{let{onSubmit:t,onSkip:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)("div",{className:"success",children:[(0,Z.tZ)(Zu,{className:"check-M_ydxB"}),(0,Z.tZ)(f6,{step:f1.Success}),(0,Z.BX)("div",{className:"button-container",children:[(0,Z.tZ)(ee.zx,{priority:"primary",onClick:t,children:n("New episode")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:i,children:n("I'll do this later")})]})]})},Zh={[f0.Create]:[f1.PickNewsletter,f1.Decide,f1.Detail,f1.Success],[f0.Import]:[f1.PickNewsletter,f1.Decide,f1.Import]},Zm=e=>{let{pub:t,publication:i,referrer:n,step:r,hideCornerIcon:o,initialSectionId:a}=e,l=a?Number(a):null,[s,d]=(0,A.eJ)(f0.Create),[c,u]=(0,A.eJ)(null!=r?r:f1.PickNewsletter),[p,h]=(0,A.eJ)(l),m=Zh[s||f0.Create],g=m.indexOf(c),v=0===g,b=c===f1.Success;return(0,Z.tZ)("div",{className:k()("podcast-onboarding typography wizard full-screen",{page:c===f1.Detail}),children:(0,Z.BX)("div",{className:"container",children:[!o&&(0,Z.tZ)("span",{className:k()("corner-icon",{back:!v&&!b}),onClick:()=>{v||b?window.location.href=n:u(m[g-1])},children:v||b?(0,Z.tZ)(eJ.Z,{}):(0,Z.tZ)(gl,{})}),c===f1.PickNewsletter&&(0,Z.tZ)(Zc,{pub:t,publication:i,initialSectionId:l,onSubmit:e=>{u(f1.Decide),h(e)}}),c===f1.Decide&&(0,Z.tZ)(f5,{onSubmit:e=>{d(e);let t=Zh[e],i=t.indexOf(c);u(t[i+1])}}),c===f1.Detail&&(0,Z.tZ)(_$,{sectionId:p,onSubmit:()=>{u(f1.Success)}}),c===f1.Import&&(0,Y.uX)("/publish/import/podcast/".concat(null!=p?p:"")),c===f1.Success&&(0,Z.tZ)(Zp,{onSubmit:e=>{(0,Y.uX)((0,j.qYj)(t,{type:"podcast",section:p}),{event:e,local_navigation:!1})},onSkip:e=>{let i="/publish"===n?(0,j.jHQ)(t):decodeURIComponent(n);(0,Y.uX)(i,{event:e,local_navigation:!1})}})]})})};var Zg=i(40225);let Zv=()=>{let[e,t]=(0,hc.t)({initialValue:void 0,key:"from",type:"string",isArray:!1}),[i,n]=(0,hc.t)({initialValue:void 0,key:"to",type:"string",isArray:!1});return[(0,A.Ye)(()=>({dateRange:{from:e,to:i},field:"post_date"}),[e,i]),(0,A.I4)(r=>{let o="function"==typeof r?r({dateRange:{from:e,to:i},field:"post_date"}):r;t(o.dateRange.from),n(o.dateRange.to)},[e,t,n,i])]},Zb=e=>{let{activeTab:t,counts:i}=e,{iString:n}=(0,Q.M1)(),r=[{value:"published",label:n("Published "),trailingIcon:i.published?(0,Z.tZ)(Zy,{count:i.published,isActive:"published"===t}):void 0},{value:"drafts",label:n("Drafts "),trailingIcon:i.drafts?(0,Z.tZ)(Zy,{count:i.drafts,isActive:"drafts"===t}):void 0},{value:"scheduled",label:n("Scheduled "),trailingIcon:i.scheduled?(0,Z.tZ)(Zy,{count:i.scheduled,isActive:"scheduled"===t}):void 0}];return(0,Z.tZ)(et.X2,{children:(0,Z.tZ)(tx.Z,{tabs:r,value:t,onChange:e=>{(0,B.route)("/publish/posts/".concat(e).concat(location.search))}})})},Zy=e=>{let{count:t,isActive:i}=e;return(0,Z.tZ)(ts.xu,{paddingLeft:2,children:(0,Z.tZ)(d_.Vp,{priority:"secondary-outline",radius:"full",opacity:i?100:80,children:t})})},Zf=["published","drafts","scheduled"],Z_=e=>{var t;let{view:i,isEligibleForLiveStreamCreation:n}=e,{iString:r}=(0,Q.M1)(),o=i&&Zf.includes(i)?i:"published",a=(0,eq.Ij)(),l=(0,re.aF)(),[s,d]=hV({view:o}),[c,u]=h_(),[p,h]=Zv(),[m,g]=(0,hc.t)({initialValue:"",key:"search",type:"string",isArray:!1}),v=(0,A.Ye)(()=>ip()(g,500),[g]);(0,A.d4)(()=>{m?(d({label:"Most relevant",by:"relevance",direction:"desc"}),(0,U.j)(U.FP.WRITER_DASHBOARD_POSTS_SEARCHED,{query:m})):d(hj[o][0])},[m]);let b=(0,iS.ib)({pathname:"/api/v1/post_management/counts",query:(0,_._)((0,f._)({},hZ(c),hw(p)),{query:m}),auto:!0,deps:[c,p,m]}),{result:y}=b,{result:w}=(0,iS.ib)({pathname:"/api/v1/publication/post-tag",auto:!0});return(0,Z.tZ)(tU.w,{children:(0,Z.BX)(dt,{children:[(0,Z.tZ)(di,{title:r("Posts"),cta:(0,Z.tZ)(m9,{user:l,pub:a,referrer:"undefined"!=typeof location?null===(t=location)||void 0===t?void 0:t.pathname:"dashboard",origin:"post_management",isEligibleForLiveStreamCreation:n})}),(0,Z.tZ)(Zb,{activeTab:o,counts:{published:null==y?void 0:y.published,drafts:null==y?void 0:y.drafts,scheduled:null==y?void 0:y.scheduled}}),(0,Z.BX)(dh,{children:[(0,Z.tZ)(eW.SiteConfigGate,{configKey:"post_management_search_engine",value:hh,children:(0,Z.tZ)(et.X2,{flex:"grow",children:(0,Z.tZ)(Zg.M,{defaultValue:m,onChange:v,flex:"grow"})})}),(0,Z.tZ)(hy,{filters:c,setFilters:u,postDateRange:p,setPostDateRange:h,tags:w}),(0,Z.tZ)(hq,{searchQuery:m,sort:s,setSort:d,view:o})]}),(0,Z.tZ)(hK,{view:o,sort:s,filters:c,postDateRange:p,searchQuery:m,countsResource:b,pub:a}),(0,Z.tZ)(yH.ZP,{})]})})};var ZZ=i(74655);let Zw=(e,t)=>e&&t?e/t:0,ZC=e=>e?(0,er.formatPercentForDisplay)(Math.round(100*e)):"-",Zx=e=>!e||Number.isNaN(e)?0:Math.round(100*e);var ZS=i(27925),Zk=i(24230);let ZB={barChartContainer:"barChartContainer-DsqJtR",barChart:"barChart-DQB69W"},ZT=e=>{if(e&&(null==e?void 0:e.datasets)&&e.datasets.every(e=>!!e.data)){let t=null==e?void 0:e.datasets.map(e=>e.data.length?e.data.reduce((e,t)=>e>t?e:t):0);return t?Math.max(...t):0}return 0},ZI=e=>{let{className:t,data:i,colors:n,stacked:r,datasetFiller:o,xAxisLabel:a,initialSelection:l,suggestedYMin:s,suggestedYMax:d,options:c,tooltipLabelPostfix:u,tooltipLabels:p,includeLineLabel:h,legendPosition:m,legendAlignment:g,labelOptions:v,legendOptions:b,plugins:y,dataType:_="number"}=e,w=(0,A.sO)(null);(0,A.d4)(()=>("undefined"!=typeof window&&window.addEventListener("resize",C),()=>{"undefined"!=typeof window&&window.removeEventListener("resize",C)}),[]);let C=(0,A.I4)(()=>{w.current&&w.current.resize()},[]),x=(0,A.Ye)(()=>i&&i.datasets?fI()({animation:!1,maintainAspectRatio:!1,plugins:{tooltip:{mode:"index",intersect:!1,position:"nearest",boxPadding:5,multiKeyBackground:void 0,callbacks:{labelColor:e=>{var t,i,n,r,o;return{borderWidth:1,borderColor:null!==(o=null!==(r=null===(t=e.dataset)||void 0===t?void 0:t.borderColor)&&void 0!==r?r:null===(i=e.dataset)||void 0===i?void 0:i.backgroundColor)&&void 0!==o?o:"white",backgroundColor:null===(n=e.dataset)||void 0===n?void 0:n.backgroundColor}},label:e=>{let t="",n=0;if(r){if(null===(n=e.formattedValue))return}else{var o,a,l,s,d;let r=e.dataIndex||0,c=e.datasetIndex||0;if(null===(n="string"==typeof(d=null==i?void 0:null===(l=i.datasets)||void 0===l?void 0:null===(a=l[c])||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o[r])?Number(d.replace(/[\\$%,]/g,"")):d))return;if((null==b?void 0:b.display)||e.chart.data.datasets.length>1){let i=(null===(s=e.chart.data.datasets[c])||void 0===s?void 0:s.label)||"";i&&h&&(t+="".concat(i,": "))}}return"currency"===_?t+="$".concat((0,er.numberToString)(n)):"percentage"===_?t+="".concat((0,er.numberToString)(n),"%"):"-"!==(0,er.numberToString)(n).charAt(0)?t+=(0,er.numberToString)(n):t+=(0,er.numberToString)(n).slice(1),p&&(t+=" ".concat(p[e.datasetIndex])),u&&(1===Number(n)?t+=" ".concat(u.slice(0,-1)):t+=" ".concat(u)),t}}},legend:(0,f._)({position:m||"top",align:g||"center",labels:(0,f._)({boxWidth:12},v),onClick(e,t){var n,r,o,a,s,d,c;let u=i.datasets.length;if(u<2)return;let p=null===(o=w.current)||void 0===o?void 0:null===(r=o.legend)||void 0===r?void 0:null===(n=r.legendItems)||void 0===n?void 0:n.indexOf(t),h=null===(d=w.current)||void 0===d?void 0:null===(s=d.legend)||void 0===s?void 0:null===(a=s.legendItems)||void 0===a?void 0:a.map((e,t)=>{var i;return null===(i=w.current)||void 0===i?void 0:i.getDatasetMeta(t)});p&&(null==h?void 0:h[p])&&(!(l&&l.length!==u||(null==h?void 0:h.reduce((e,t)=>e||(null==t?void 0:t.hidden)||!1,!1)))||t.hidden)&&(null==h?void 0:h[p])&&(null===(c=w.current)||void 0===c||c.update())}},b)},scales:{x:{stacked:r,grid:{color:gb.E5},ticks:(0,f._)({maxTicksLimit:9,color:gb.Aw},a&&{callback:a})},y:{stacked:r,grid:{color:gb.E5},suggestedMin:void 0!==s?s:ZT(i)>3?void 0:0,suggestedMax:void 0!==d?d:ZT(i)>3?void 0:3,ticks:{maxTicksLimit:6,color:gb.Aw,callback:e=>"currency"===_?"$".concat((0,er.truncateNumber)(e,{minSignificantDigits:2})):"percentage"===_?"".concat((0,er.numberToString)(e),"%"):(0,er.numberToString)(e)}}}},c):{},[i,_,h,l,v,g,b,m,c,r,d,s,u,p,a]);return(0,Z.tZ)("div",{className:k()(ZB.barChartContainer,t),children:(0,A.Ye)(()=>{var e;return i&&i.datasets.length?(0,Z.tZ)(fP,{className:ZB.barChart,ref:w,type:"bar",plugins:y,data:{labels:null===(e=i.labels)||void 0===e?void 0:e.map(e=>{if("string"!=typeof e)return e.toString();let t=(0,H.Z)(e).format("MMM DD, YYYY");return"Invalid Date"!==t?t:e}),datasets:i.datasets.map((e,t)=>(0,f._)({pointBackgroundColor:null==n?void 0:n[t],backgroundColor:null==n?void 0:n[t],borderColor:null==n?void 0:n[t],borderWidth:0,fill:o?o(t):0===t?"origin":void 0,pointRadius:0,hidden:l&&!l.includes(t),lineTension:.1,maxBarThickness:125},e))},options:x}):null},[i,x,n,o,l,y])})};var ZN=i(32700);let ZP={labelPoint:"labelPoint-T6tDBR",chartContainer:"chartContainer-CuVgq6",helpIcon:"helpIcon-RDM0Ks",containerWithMessage:"containerWithMessage-HKTg8G"},ZE=e=>{var t,i;let{children:n,chartGuideMessage:r,className:o}=e,[a,l]=(0,A.eJ)(null);return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ZX,{items:a,chartGuideMessage:r}),(0,Z.tZ)("div",{className:k()(ZP.chartContainer,{[ZP.containerWithMessage]:!!r},o),children:(0,w.cloneElement)(n,{plugins:[...null!==(i=n.props.plugins)&&void 0!==i?i:[],ZM],options:(0,_._)((0,f._)({},n.props.options),{plugins:(0,_._)((0,f._)({},null===(t=n.props.options)||void 0===t?void 0:t.plugins),{customLegendPlugin:{setItems:l}})})})})]})},ZX=e=>{let{items:t,chartGuideMessage:i}=e;return(0,Z.BX)(et.hs,{direction:{mobile:"column",desktop:"row"},paddingTop:8,paddingX:16,justifyContent:"space-between",children:[(0,Z.tZ)(et.gq,{gap:16,children:null==t?void 0:t.map(e=>(0,Z.BX)(et.gq,{alignItems:"center",children:[(0,Z.tZ)("div",{className:ZP.labelPoint,style:{backgroundColor:e.fillStyle}}),(0,Z.tZ)(ei.xv.B4,{paddingLeft:8,paddingRight:4,children:e.text}),e.helpText?(0,Z.tZ)(ZN.z,{content:(0,Z.BX)(et.tu,{padding:8,gap:8,children:[(0,Z.tZ)(et.gq,{paddingBottom:8,borderBottom:"detail",justifyContent:"space-between",children:(0,Z.tZ)(ei.xv.B4,{color:"primary",weight:"semibold",children:e.text})}),(0,Z.tZ)(ei.xv.B4,{children:e.helpText})]}),children:(0,Z.tZ)(et.tu,{alignItems:"center",className:ZP.iconContainer,children:(0,Z.tZ)(eR.Z,{className:ZP.helpIcon,size:12})})}):null]}))}),i&&(0,Z.tZ)(et.gq,{color:"secondary",gap:4,alignItems:"center",children:(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"secondary",children:i})})]})},ZM={id:"customLegendPlugin",afterInit(e,t,i){let n=e.options.plugins.legend.labels.generateLabels(e);i.setItems(n)}},ZA={barChartContainer:"barChartContainer-BR45hx",legendContainer:"legendContainer-TS6wMO",emptyData:"emptyData-f5IzHg",noDataOverlay:"noDataOverlay-CRMvxN"},ZD=e=>{var t,i;let{labels:n,data:r,pub:o,className:a,dataType:l="number"}=e,{iString:s}=(0,Q.M1)(),d=(0,A.Ye)(()=>{var e,t,i,n,a,l;return(null==r?void 0:r.length)===1?[{barThickness:100,backgroundColor:[null!==(n=null===(e=o.theme)||void 0===e?void 0:e.background_pop_color)&&void 0!==n?n:o.theme_var_background_pop,"#DDDDDD"],data:r[0]}]:[{barThickness:100,backgroundColor:null!==(a=null===(t=o.theme)||void 0===t?void 0:t.background_pop_color)&&void 0!==a?a:o.theme_var_background_pop,borderColor:null!==(l=null===(i=o.theme)||void 0===i?void 0:i.background_pop_color)&&void 0!==l?l:o.theme_var_background_pop,label:s("This post"),data:r[0]},{barThickness:100,backgroundColor:"#DDDDDD",borderColor:"#DDDDDD",label:s("Your typical post"),data:r[1]}]},[r,null===(t=o.theme)||void 0===t?void 0:t.background_pop_color,o.theme_var_background_pop]),c=r&&!!r[0]&&(null===(i=r[0])||void 0===i?void 0:i.length)>=1;return(0,Z.BX)("div",{className:ZA.barChartContainer,children:[!c&&(0,Z.BX)(et.tu,{justifyContent:"center",alignItems:"center",className:ZA.noDataOverlay,gap:8,children:[(0,Z.tZ)(Zk.Z,{}),(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"bold",children:"No data available"}),(0,Z.tZ)(ei.xv.B4,{translated:!0,color:"secondary",children:"It can take up to 1 hour for data to appear. Please check back later."})]}),(0,Z.tZ)(ZE,{className:ZA.legendContainer,children:(0,Z.tZ)(ZI,{className:k()(a,{[ZA.emptyData]:!c}),plugins:[ZS.Z],data:{labels:n,datasets:d},options:{animation:!1,layout:{padding:{left:16,right:16,top:24}},plugins:{legend:{display:!1,labels:{generateLabels:()=>{var e,t,i,n;return[{text:s("This post"),datasetIndex:0,fillStyle:null!==(i=null===(e=o.theme)||void 0===e?void 0:e.background_pop_color)&&void 0!==i?i:o.theme_var_background_pop,strokeStyle:null!==(n=null===(t=o.theme)||void 0===t?void 0:t.background_pop_color)&&void 0!==n?n:o.theme_var_background_pop},{text:s("Your typical post"),datasetIndex:0,fillStyle:"#DDDDDD",strokeStyle:"#DDDDDD",helpText:s("The average value for your past 25 posts that are at least 1 week old. Posts are compared to other posts of the same type and audience, so free podcasts are compared to free podcasts and paid newsletters are compared to paid newsletters.")}]}}},tooltip:{enabled:!1},datalabels:{anchor:"end",offset:5,align:"end",font:{family:"'Jetbrains Mono', monospace",weight:"bold",size:12},formatter:e=>"currency"===l?"$".concat((0,er.centsToDollarString)(100*e)):"percentage"===l?(0,er.formatPercentForDisplay)(e):Number.isNaN(e)?"":"number"==typeof e?e.toLocaleString():e}},maintainAspectRatio:!1,scales:{x:{display:(null==r?void 0:r.length)!==1,grid:{display:!1}}}}})})]})},ZR=e=>{let t=e.loading;return(0,Z.BX)(et.tu,{border:"detail",padding:16,radius:"md",flex:"grow",minWidth:0,children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",children:"Links clicked"}),(0,Z.tZ)(tX.iz,{paddingY:16}),t?(0,Z.tZ)(et.gq,{paddingY:32,justifyContent:"center",children:(0,Z.tZ)(iI.$j,{})}):(0,Z.tZ)(Zz,(0,f._)({},e))]})},ZF=e=>{let{clicks:t,opens:i}=e,n=100*t/Math.max(t,i);return"".concat((0,er.numberToString)(n,{precision:n>=1?0:1}),"%")},ZL=e=>{let{clicks:t,opens:i,description:n}=e;return(0,Z.BX)(et.gq,{gap:64,justifyContent:"space-between",alignItems:"center",children:[(0,Z.BX)(et.gq,{flex:"auto",children:[(0,Z.tZ)(ei.xv.B4,{weight:"bold",children:(0,er.numberToString)(t)}),(0,Z.BX)(ei.xv.B4,{paddingLeft:4,children:["(",ZF({clicks:t,opens:i}),")"]})]}),(0,Z.tZ)(ei.xv.B4,{ellipsis:!0,children:n})]})},Zz=e=>{var t;let{postId:i,loading:n,links:r,hasMoreLinks:o,clicked:a,opened:l,includeOpeners:s=!0,includeLikeButton:d=!0}=e,[c,u]=(0,A.eJ)(r||[]),[p,h]=(0,A.eJ)(o||!1),[m,g]=(0,A.eJ)(n),{iString:v}=(0,Q.M1)(),b=async()=>{try{g(!0);let e=await N().get("/api/v1/drafts/".concat(i,"/links")).query({offset:null==c?void 0:c.length});u(null==c?void 0:c.concat(e.body.links)),h(e.body.has_more_links)}catch(e){console.error(e),alert((0,Y.zx)(e,v("There was a network issue. Try again in a bit")))}finally{g(!1)}};return c.length&&((null!=a?a:0)>0||(null!=l?l:0)>0)?(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(et.tu,{gap:16,paddingBottom:16,children:[s&&(0,Z.tZ)(ZL,{clicks:a,opens:Math.max(null!=a?a:0,l||0),description:v("of openers clicked a link")}),null==c?void 0:null===(t=c.filter(e=>!!d||"Like button"!==e[0]))||void 0===t?void 0:t.map(e=>(0,Z.tZ)(ZL,{clicks:e[1],opens:Math.max(null!=a?a:0,l||0),description:["other urls","Like button"].includes(e[0])?v(e[0]):(0,Z.tZ)("a",{href:e[0],target:"_blank",rel:"noopener",children:e[0]})}))]}),p&&(0,Z.tZ)(ee.zx,{priority:"secondary",size:"sm",onClick:b,children:m?v("Loadingâ€¦"):v("More")})]}):(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"No link clicks yet"})},ZO={statCardsContainer:"statCardsContainer-Bn6bf0","stats-cards-2":"stats-cards-2-_1D1H4",statsCards2:"stats-cards-2-_1D1H4","stats-cards-3":"stats-cards-3-KSJGpg",statsCards3:"stats-cards-3-KSJGpg",statCard:"statCard-KRZOlv",statCardHeader:"statCardHeader-VaJ_vl",dataContainer:"dataContainer-wxr0Jw",emptyCardPlaceholder:"emptyCardPlaceholder-Su4kui",emptyCardIcon:"emptyCardIcon-Fc9GH9",helpIcon:"helpIcon-BZ0jCK"},ZU=e=>{var{title:t,children:i,isLoading:n,heroStat:r,format:o="number"}=e,a=(0,ef._)(e,["title","children","isLoading","heroStat","format"]);return(0,Z.BX)(s6.Z,(0,_._)((0,f._)({className:ZO.statCard,gap:8},a),{children:[null!=r?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(s6.Z.Header,{children:(0,Z.tZ)(s6.Z.Title,{children:t})}),(0,Z.tZ)(s6.Z.Body,{children:(0,Z.tZ)(ms,{value:r,format:o})})]}):(0,Z.tZ)(s6.Z.Header,{children:(0,Z.tZ)(s6.Z.Title,{children:t})}),(0,Z.tZ)(tX.iz,{paddingY:12,flex:"auto"}),(0,Z.tZ)(s6.Z.Body,{paddingBottom:20,children:n?(0,Z.tZ)(et.M5,{flex:"grow",children:(0,Z.tZ)(iI.$j,{})}):(0,Z.tZ)(ts.xu,{className:ZO.dataContainer,children:i})})]}))},ZY=e=>{let{children:t,columns:i}=e,n=i||((0,w.toChildArray)(t).length%2!=0?3:2);return(0,Z.tZ)(ts.xu,{className:k()(ZO.statCardsContainer,ZO["stats-cards-".concat(n)]),gap:16,children:t})},ZH=e=>{let{Icon:t,message:i,helpMessage:n}=e;return(0,Z.BX)(et.tu,{gap:8,className:ZO.emptyCardPlaceholder,justifyContent:"center",alignItems:"center",children:[(0,Z.tZ)(t,{className:ZO.emptyCardIcon}),(0,Z.BX)(et.gq,{alignItems:"center",children:[(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:i}),n&&(0,Z.tZ)(tW.u,{text:n,children:(0,Z.tZ)(eR.Z,{height:12,className:ZO.helpIcon})})]})]})},Zj={userLink:"userLink-gj7Otp",helpIcon:"helpIcon-O2qn6N"},ZJ=e=>{let{users:t,pub:i,total:n,userMismatchHelpMessage:r}=e,{iPlural:o}=(0,Q.M1)();return(0,Z.BX)(et.tu,{children:[null==t?void 0:t.map(e=>{var t;return e&&(0,Z.tZ)("a",{target:"_blank",href:(0,j.pN7)(i,e.email),rel:"noopener",className:Zj.userLink,children:(0,Z.BX)(et.gq,{alignItems:"center",gap:8,paddingY:12,paddingLeft:4,radius:"sm",children:[e.photo_url?(0,Z.tZ)(ug.fi,{pub:i,size:24,photo_url:e.photo_url,email:e.email}):(0,Z.tZ)(eG.qE,{size:24}),(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"primary",children:null!==(t=e.name)&&void 0!==t?t:e.email})]})})}),(null==t?void 0:t.length)&&n&&(null==t?void 0:t.length)<n&&(0,Z.BX)(et.gq,{alignItems:"center",gap:8,paddingLeft:4,children:[(0,Z.tZ)(eG.qE,{size:24}),(0,Z.BX)(et.gq,{alignItems:"center",children:[(0,Z.BX)(ei.xv.B4,{color:"secondary",children:["+",o("%1 other reader","%1 other readers",n-(null==t?void 0:t.length))]}),r&&(0,Z.tZ)(tW.u,{text:r,children:(0,Z.tZ)(eR.Z,{height:12,className:Zj.helpIcon})})]})]})]})},ZV=e=>{let{postId:t,stats:i,isLoading:n,pub:r,post:o}=e,[a,l]=(0,A.eJ)(!1),[s,d]=(0,ov.Z)();return(0,A.d4)(()=>{(null==d?void 0:d.isIntersecting)&&l(!0)},[null==d?void 0:d.isIntersecting]),(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(ei.xv.H3,{ref:s,translated:!0,children:"Engagement"}),a&&(0,Z.tZ)(Zq,{isLoading:n,stats:i,postId:t,pub:r,post:o})]})},Zq=e=>{var t,i,n,r,o,a,l,s,d,c,u;let{isLoading:p,stats:h,postId:m,pub:g,post:v}=e,{iString:b}=(0,Q.M1)(),y=(0,iS.ib)({pathname:"/api/v1/post_management/detail/".concat(m,"/engagement"),auto:!0});return(0,Z.BX)(ZY,{children:[(0,Z.tZ)(ZU,{heroStat:null==h?void 0:h.clicked,title:b("Openers who clicked a link"),isLoading:p,children:(null==h?void 0:null===(t=h.links)||void 0===t?void 0:t.length)?(0,Z.tZ)(Zz,{hasMoreLinks:null==h?void 0:h.has_more_links,loading:p,postId:m,links:null==h?void 0:h.links,clicked:null==h?void 0:h.clicked,opened:null==h?void 0:h.opened,includeOpeners:!1,includeLikeButton:!1}):(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"No links clicked"})}),(0,Z.tZ)(ZU,{isLoading:y.isLoading,title:b("Likes"),heroStat:null==y?void 0:null===(n=y.result)||void 0===n?void 0:null===(i=n.likes)||void 0===i?void 0:i.count,children:(0,Z.tZ)(ZJ,{users:null==y?void 0:null===(o=y.result)||void 0===o?void 0:null===(r=o.likes)||void 0===r?void 0:r.users,total:null==y?void 0:null===(l=y.result)||void 0===l?void 0:null===(a=l.likes)||void 0===a?void 0:a.count,pub:g})}),(0,Z.tZ)(ZU,{isLoading:y.isLoading,title:b("Comments"),heroStat:null==y?void 0:null===(d=y.result)||void 0===d?void 0:null===(s=d.commentSummary)||void 0===s?void 0:s.total,children:(0,Z.tZ)(ZW,{comments:null==y?void 0:null===(u=y.result)||void 0===u?void 0:null===(c=u.commentSummary)||void 0===c?void 0:c.comments,pub:g,post:v})})]})},ZW=e=>{let{comments:t,pub:i,post:n}=e,r=null==t?void 0:t.slice(0,4),{language:o,iString:a}=(0,Q.M1)();return(0,Z.BX)(et.tu,{gap:8,children:[null==r?void 0:r.map((e,t)=>(0,Z.BX)(et.tu,{borderBottom:t!==r.length-1?"detail":void 0,gap:8,paddingBottom:16,paddingTop:16*(0!==t),children:[(0,Z.BX)(et.gq,{gap:8,children:[(0,Z.tZ)(ug.fi,{pub:i,size:24,photo_url:e.photo_url,email:e.email}),(0,Z.tZ)(ei.xv.B4,{weight:"bold",clamp:1,children:e.name}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:"â€¢"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:(0,Z.tZ)(ei.hh,{href:(0,j.tk4)(i,n,e),color:"secondary",children:(0,H.Z)(e.date).isSame((0,H.Z)(),"year")?(0,H.Z)(e.date).locale(o).format("MMMM DD"):(0,H.Z)(e.date).locale(o).format("MMMM DD, YYYY")})})]}),(0,Z.tZ)(ei.xv.B4,{clamp:1,color:"secondary",children:e.body})]})),(0,Z.tZ)(ee.zx,{href:(0,j.tk4)(i,n),children:a("See all")})]})};var ZG=i(97742);let ZK=e=>{let{pub:t,className:i}=e,n=(0,j.SVA)(t).replace(/^https?:\/\//,"").replace(".localhost:5000","").toUpperCase();return(0,Z.BX)(et.X2,{gap:8,className:k()("watermark-oezZvv",i),position:"absolute",alignItems:"center",children:[(0,Z.tZ)(ZG.Z,{height:10,className:"icon-S8MbZ8"}),(0,Z.tZ)(ei.xv.Meta,{weight:"semibold",className:"text-t9ae9j",children:n})]})},ZQ={dataTab:"dataTab-EZ2cTS",active:"active-fIcQ5k",first:"first-mzPNFS",highlight:"highlight-MC3LcX",watermark:"watermark-nlRcB7"},Z$=e=>{let{stat:t,name:i,isActive:n,onClick:r,description:o,format:a="number",index:l}=e;return(0,Z.BX)(et.X2,{flex:"grow",position:"relative",children:[(0,Z.tZ)(ml,{title:i,value:t,format:a,tooltip:o,onClick:r,className:k()(ZQ.dataTab,n&&ZQ.active,0===l&&ZQ.first),shadow:"none",cursor:"pointer"}),n&&(0,Z.tZ)(Z0,{})]})},Z0=()=>(0,Z.tZ)(ts.xu,{className:ZQ.highlight}),Z1=e=>{let{tabs:t,activeTab:i,children:n,resource:r,updateActiveTab:o,pub:a}=e;return(0,Z.BX)(s6.Z,{overflow:"hidden",outline:"none",border:"detail",radius:"sm",shadow:"none",position:"relative",children:[(0,Z.tZ)(et.X2,{children:t.map((e,t)=>{let n=null;return r&&(n=e.valueFn?e.valueFn(r):e.key?r[e.key]:null),(0,Z.tZ)(Z$,{isActive:i.id===e.id,name:e.name,stat:n,onClick:()=>o(e.id),description:e.description,format:e.format,index:t})})}),n?(0,Z.tZ)(ts.xu,{height:y7.CHART_HEIGHT,position:"relative",children:n}):(0,Z.tZ)(et.M5,{height:y7.CHART_HEIGHT,children:(0,Z.tZ)(iI.$j,{})}),(0,Z.tZ)(ZK,{pub:a,className:ZQ.watermark})]})},Z2=e=>{let{tabs:t}=e,[i,n]=(0,A.eJ)(t[0]);return[i,e=>{let i=t.find(t=>t.id===e);i&&n(i)}]},Z4=e=>{let{postsResource:t}=e,[i,n]=(0,A.eJ)(null),[r,o]=(0,A.eJ)(null);return(0,A.d4)(()=>{var e,a,l;!i&&!r&&t&&(null===(e=t.rows)||void 0===e?void 0:e[0])&&(o(null===(a=t.rows)||void 0===a?void 0:a[0]),n(null===(l=t.rows)||void 0===l?void 0:l[0].stats))},[t,i,r]),[i,r]},Z3=e=>{var t;let{stats:i,pub:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(ZD,{pub:n,labels:[r("This post"),r("Your typical post")],data:[[Zx(i.engagement_rate),Zx(null===(t=i.comps)||void 0===t?void 0:t.avg_engagement_rate)]],dataType:"percentage"})},Z8=e=>e.open_rate?Zx(e.open_rate):Zw(e.opened,e.delivered),Z6=e=>{var t;let{stats:i,pub:n}=e,r=Z8(i),o=Zx(null===(t=i.comps)||void 0===t?void 0:t.avg_open_rate),{iString:a}=(0,Q.M1)();return(0,Z.tZ)(ZD,{pub:n,labels:[a("This post"),a("Your typical post")],data:[[r,o]],dataType:"percentage"})},Z5=e=>{var t;let{stats:i,pub:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(ZD,{pub:n,labels:[r("This post"),r("Your typical post")],data:[[Zx(null==i?void 0:i.click_through_rate),Zx(null==i?void 0:null===(t=i.comps)||void 0===t?void 0:t.avg_click_through_rate)]],dataType:"percentage"})},Z9=e=>{var t;let{stats:i,pub:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(ZD,{pub:n,labels:[r("This post"),r("Your typical post")],data:[[null==i?void 0:i.video_minutes_watched,Math.round(null==i?void 0:null===(t=i.comps)||void 0===t?void 0:t.avg_video_minutes_watched)]]})},Z7=e=>{var t,i;let{id:n,postsResource:r,pub:o}=e,{iString:a}=(0,Q.M1)(),l=[{id:"engagement_rate",name:a("Engagement rate"),valueFn:e=>{var t;return null!==(t=e.engagement_rate)&&void 0!==t?t:0},format:"percent",Component:Z3,description:a("The percentage of subscribers who engaged with this post after opening an email or mobile app notification for the post. Engagements include: liking a post, clicking a link, sharing or restacking a post, commenting on a post, and reading a post to the bottom. Subscribers who engage multiple times (e.g. like and comment) are only counted once. Users who engage with your post but are not subscribed are not included in the engagement rate.")},{id:"open_rate",name:a("Open rate"),valueFn:e=>Z8(e)/100,format:"percent",Component:Z6,description:a("The percentage of subscribers who opened this post after receiving an email or mobile app notification about it. If one person opens your post five times, that counts as one open.")},{id:"ctr",name:a("Click-through rate"),valueFn:e=>{var t;return null!==(t=e.click_through_rate)&&void 0!==t?t:0},format:"percent",Component:Z5,description:a("The percentage of subscribers who clicked a link in this post after opening an email or mobile app notification for the post. Users who click links but are not subscribed are not included in the engagement click-through rate.")}];(null===(t=r.rows)||void 0===t?void 0:t[0])&&"video"===r.rows[0].type&&l.unshift({id:"video_minutes_watched",name:"Video minutes watched",key:"video_minutes_watched",Component:Z9});let[s,d]=Z2({tabs:l}),[c]=Z4({postsResource:r});return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(Z1,{pub:o,activeTab:s,tabs:l,resource:c,updateActiveTab:d,children:c?(0,Z.tZ)(s.Component,{pub:o,stats:c}):null}),(0,Z.tZ)(ZV,{post:null===(i=r.rows)||void 0===i?void 0:i[0],pub:o,postId:n,stats:c,isLoading:r.isLoading})]})};var we=i(6240);function wt(){let e=(0,G._)(["Started "," â€¢ Ends ",""]);return wt=function(){return e},e}let wi=e=>{let{test:t,cta:i}=e,{iString:n,iTemplate:r}=(0,Q.M1)(),{testEndsAt:o,percentComplete:a}=wb(t);return(0,Z.tZ)(wr,{leading:(0,Z.tZ)(wo,{}),title:n("Test is running..."),subtitle:r(wt(),vw()(t.starts_at).fromNow(),vw()(o).local().fromNow()),cta:i,percent:a})},wn=e=>{var t,i;let{test:n}=e,{iString:r}=(0,Q.M1)(),o=null===(i=n.options)||void 0===i?void 0:null===(t=i.find(e=>e.is_winner))||void 0===t?void 0:t.headline;return(0,Z.tZ)(wr,{leading:(0,Z.tZ)(yp.Z,{width:20,height:20,color:"var(--color-semantic-success-fg-primary)"}),title:r(n.ended_early?"Test ended early":"Test complete"),subtitle:"".concat(r(n.ended_early?"Selected title":"Winning title"),': "').concat(o,'"'),theme:"success"})},wr=e=>{let{leading:t,title:i,subtitle:n,cta:r,percent:o,theme:a="default"}=e,l="success"===a?"success":"primary";return(0,Z.BX)("success"===a?wl:wa,{children:[t,(0,Z.BX)(et.tu,{gap:12,flex:"grow",children:[(0,Z.BX)(et.gq,{gap:12,flex:"grow",children:[(0,Z.BX)(ws,{children:[(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:l,children:i}),(0,Z.tZ)(ei.xv.B4,{color:l,opacity:80,children:n})]}),r]}),o&&(0,Z.tZ)(iI.uk,{percent:o,theme:"default"})]})]})},wo=()=>(0,Z.tZ)(iI.$j,{padding:0,size:20}),wa=(0,ts.zo)({display:"flex",direction:"row",gap:12,paddingX:16,paddingY:12,alignItems:"center",border:"detail",bg:"secondary",shadow:"xs",radius:"sm"}),wl=(0,ts.zo)({display:"flex",direction:"row",gap:12,paddingX:16,paddingY:12,alignItems:"center",border:"detail",bg:"accent-green",radius:"sm"}),ws=(0,ts.zo)({display:"flex",direction:"column",flex:"grow"}),wd=e=>{let{id:t,postsResource:i}=e,{iString:n}=(0,Q.M1)(),r=(0,io.xR)(),o=i.rows.find(e=>"".concat(e.id)==="".concat(t));return r.getConfigFor("headline_testing_enabled")?(0,Z.tZ)(wc,{post:o}):(0,Z.tZ)(tp.mb,{icon:(0,Z.tZ)(we.Z,{}),title:n("This feature is not available"),text:n("This publication cannot run title tests")})},wc=e=>{let{post:t}=e,[i,n]=(0,A.eJ)(null),[r,o]=(0,A.eJ)(null),[a,l]=(0,A.eJ)(!1),[s,d]=(0,A.eJ)(!1),{testEnded:c}=wb(i),{iString:u}=(0,Q.M1)(),p=(0,iN.pm)(),h=null==t?void 0:t.id,m=(0,A.I4)(async()=>{if(null==t?void 0:t.id)try{let e=await fetch("/api/v1/headline-tests/".concat(t.id));if(!e.ok)throw Error("Failed to fetch test stats");let i=await e.json();n(i.test)}catch(e){console.error(e)}finally{l(!0)}},[null==t?void 0:t.id]);if((0,A.d4)(()=>{m()},[null==t?void 0:t.id,m]),a&&!i)return(0,Z.tZ)(tp.mb,{icon:(0,Z.tZ)(we.Z,{}),title:u("No tests found"),text:u("This post did not run any title tests")});if(!i||!i.options)return null;let g=async e=>{try{await fetch("/api/v1/headline-tests/".concat(e,"/end_early"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({headline_test_option_override_id:r||void 0})}),setTimeout(async()=>{await m()},5e3),p.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:u("Test ended successfully"),Icon:eE.Z})))}catch(e){p.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:u("Failed to end test")})))}};return(0,Z.BX)(et.tu,{gap:20,children:[c?(0,Z.tZ)(wn,{test:i}):(0,Z.tZ)(wi,{test:i,cta:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",size:"sm",onClick:()=>d(!0),children:u("End test early")})}),(0,Z.tZ)(wu,{test:i}),(0,Z.tZ)(wp,{options:i.options,testEnded:c}),i&&(0,Z.tZ)(wv,{isOpen:s,setOpen:d,postId:h,handleEndTestEarly:g,selectedOverrideId:r,setSelectedOverrideId:o,shownTest:i})]})},wu=e=>{var t;let{test:i}=e,{iString:n}=(0,Q.M1)(),r=null===(t=i.options)||void 0===t?void 0:t.reduce((e,t)=>e+Number(t.emails_sent),0);return(0,Z.BX)(dc,{children:[(0,Z.tZ)(ml,{value:i.planned_duration_ms,format:"duration",title:n("Test duration"),tooltip:n("How long this test will run before selecting a winner")}),(0,Z.tZ)(ml,{value:i.test_cohort_percent/100,format:"percent",title:n("Test size"),tooltip:n("The percent of total post recipients who received test emails")}),(0,Z.tZ)(ml,{value:r,format:"number",title:n("Emails sent"),tooltip:n("The total number of test emails sent so far")})]})},wp=e=>{let{options:t,testEnded:i}=e;return(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(wh,{}),(0,Z.tZ)(gq,{children:t.map(e=>(0,Z.tZ)(wm,{variant:e,testEnded:i},e.id))})]})})},wh=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{borderLeft:"detail",children:[(0,Z.tZ)(gK,{children:e("Title")}),(0,Z.tZ)(gK,{children:e("Status")}),(0,Z.tZ)(gK,{children:e("Sent")}),(0,Z.tZ)(gK,{children:e("Opened")}),(0,Z.tZ)(gK,{children:e("Open rate")})]})})},wm=e=>{let{variant:t,testEnded:i}=e;return(0,Z.BX)(gG,{borderLeft:"detail",children:[(0,Z.BX)(gQ,{ellipsis:!0,maxWidth:220,children:[(0,Z.tZ)(ei.xv,{weight:"medium",ellipsis:!0,children:t.headline}),t.subtitle&&(0,Z.tZ)(ei.xv.B4,{color:"secondary",ellipsis:!0,children:t.subtitle})]}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(wg,{variant:t,testEnded:i})}),(0,Z.tZ)(gQ,{children:t.emails_sent}),(0,Z.tZ)(gQ,{children:t.emails_opened}),(0,Z.BX)(gQ,{children:[(t.emails_opened/t.emails_sent*100||0).toFixed(1),"%"]})]},t.id)},wg=e=>{let{variant:t,testEnded:i}=e,{iString:n}=(0,Q.M1)(),r=t.is_winner;return i?r?(0,Z.tZ)(d_.Vp,{theme:"success",children:n("Winner")}):(0,Z.tZ)(d_.Vp,{children:n("Loser")}):(0,Z.tZ)(d_.Vp,{priority:"secondary",children:n("Running...")})},wv=e=>{var t;let{isOpen:i,setOpen:n,postId:r,handleEndTestEarly:o,selectedOverrideId:a,setSelectedOverrideId:l,shownTest:s}=e,{iString:d}=(0,Q.M1)(),c=async()=>{r&&(o(r),n(!1))};return(0,Z.BX)(eK.u_,{isOpen:i,onClose:()=>n(!1),children:[(0,Z.tZ)(eK.xB,{title:d("End test"),description:d("Choose a final title to send to remaining recipients"),onClose:()=>n(!1),showClose:!0,showDivider:!0}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(oY.i,{value:a||"",onChange:e=>l(Number(e.currentTarget.value)||null),children:[(0,Z.tZ)(oY.d,{children:d("Select a final title")}),null==s?void 0:null===(t=s.options)||void 0===t?void 0:t.map(e=>(0,Z.tZ)("option",{value:e.id,children:e.headline},e.id))]})}),(0,Z.tZ)(eK.mz,{showDivider:!0,primaryButton:(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:c,children:d("End test and send now")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:()=>n(!1),children:d("Cancel")})})]})},wb=e=>{if(!e)return{testEndsAt:null,percentComplete:null,testEnded:!1};let t=!!e.ended_at,i=vw()(e.starts_at).add(e.planned_duration_ms,"ms"),n=Math.min(1,Math.max(0,(Date.now()-vw()(e.starts_at).valueOf())/(vw()(i).valueOf()-vw()(e.starts_at).valueOf())));return{testEndsAt:i,percentComplete:n,testEnded:t}},wy=e=>{var t;let{labels:i,data:n,pub:r,statName:o,isCurrency:a=!1,dataType:l}=e,{iString:s,iPlural:d}=(0,Q.M1)(),c="estimated revenue"===o?s("estimated revenue"):s("currency"),u=(0,A.Ye)(()=>{var e,t;return[{borderColor:null!==(t=null===(e=r.theme)||void 0===e?void 0:e.background_pop_color)&&void 0!==t?t:r.theme_var_background_pop,pointStyle:"line",data:n[0],label:s("This post")},{borderColor:"#DDDDDD",pointStyle:"line",data:n[1],label:s("Your typical post")}]},[n,null===(t=r.theme)||void 0===t?void 0:t.background_pop_color,r.theme_var_background_pop]),p=(0,A.Ye)(()=>i.map(e=>{if((0,H.Z)(e).isValid()){let t=(0,H.Z)(e).isSame((0,H.Z)(),"year");return(0,H.Z)(e).utc().format(t?"MMM D":"MMM D, YYYY")}return e.toString()}),[i]);return(0,A.Ye)(()=>{var e;return eS()(null==n?void 0:n[0])||eS()(null==n?void 0:null===(e=n[0])||void 0===e?void 0:e.length)||!(n[0].length<3)?(0,Z.tZ)(ZE,{chartGuideMessage:s("First 7 days"),children:(0,Z.tZ)(fP,{type:"line",data:{labels:p,datasets:u},plugins:[{id:"legendPadding",beforeInit(e){if(!e.legend)return;let t=e.legend.fit;e.legend.fit=function(){t.bind(e.legend)(),this.height+=16}}}],options:{animation:!1,layout:{padding:{left:16,right:16}},plugins:{legend:{display:!1,labels:{generateLabels:()=>u.map((e,t)=>({text:e.label,datasetIndex:t,fillStyle:e.borderColor,strokeStyle:e.borderColor,helpText:1===t?s("The average value for your past 25 posts that are at least 1 week old. Posts are compared to other posts of the same type and audience, so free podcasts are compared to free podcasts and paid newsletters are compared to paid newsletters."):""}))}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.7)",titleColor:"#C0C0C0",usePointStyle:!0,yAlign:"bottom",callbacks:{label:e=>a?"$".concat((0,er.centsToDollarString)(100*e.parsed.y)," ").concat(c):"subscriber"===o?d("%1 subscriber","%1 subscribers",e.parsed.y):d("%1 view","%1 views",e.parsed.y),labelPointStyle:()=>({pointStyle:"circle",rotation:0}),labelColor(e){var t,i;return{borderColor:null===(t=u[e.datasetIndex])||void 0===t?void 0:t.borderColor,backgroundColor:null===(i=u[e.datasetIndex])||void 0===i?void 0:i.borderColor}},title:e=>1===e[0].datasetIndex?d("Average value %1 day after publish","Average value %1 days after publish",e[0].dataIndex):e[0].label}}},maintainAspectRatio:!1,scales:{y:{grid:{display:!1}},x:{grid:{borderDash:[5,5]}}}}})}):(0,Z.tZ)(ZD,{dataType:l,pub:r,labels:i.map(e=>(0,H.Z)(e).utc().format("MMM D, YYYY")),data:n})},[n,u,a,i,r,o,l,p])};var wf=i(60994),w_=i(49770),wZ=i(97064);function ww(){let e=(0,G._)([""," paid subscribers"]);return ww=function(){return e},e}function wC(){let e=(0,G._)([""," free subscribers"]);return wC=function(){return e},e}function wx(){let e=(0,G._)([""," paid unsubscribes"]);return wx=function(){return e},e}let wS=e=>{let{postId:t,stats:i,isLoading:n,pub:r}=e,[o,a]=(0,A.eJ)(!1),[l,s]=(0,ov.Z)();return(0,A.d4)(()=>{(null==s?void 0:s.isIntersecting)&&a(!0)},[null==s?void 0:s.isIntersecting]),(0,Z.tZ)(et.tu,{gap:8,ref:l,children:o?(0,Z.tZ)(wk,{pub:r,postId:t,stats:i,isLoading:n}):(0,Z.tZ)(et.gq,{justifyContent:"center",alignItems:"center",children:(0,Z.tZ)(iI.$j,{})})})},wk=e=>{var t,i,n,r,o,a,l,s,d,c,u,p,h,m,g,v,b,y,f,_,w,C,x,S,k,B,T,I,N,P,E,X,M,D,R,F,L,z,O,U,Y,H,j,J,V,q,W;let{postId:G,stats:K,isLoading:$,pub:ee}=e,et=(0,iS.ib)({pathname:"/api/v1/post_management/detail/".concat(G,"/growth"),auto:!0}),ei=(0,A.Ye)(()=>"enabled"===ee.payments_state,[ee.payments_state]),{iString:en,iTemplate:er}=(0,Q.M1)();return(0,Z.BX)(ZY,{children:[ei?(0,Z.tZ)(ZU,{heroStat:K&&"estimated_value"in K&&(null==K?void 0:K.estimated_value)&&!et.isLoading?null==K?void 0:K.estimated_value:0,format:"dollar",isLoading:$||et.isLoading,title:en("Estimated revenue increase"),children:(0,Z.tZ)(wB,{subscribes:null===(t=et.result)||void 0===t?void 0:t.subscribes})}):null,ei?(0,Z.tZ)(ZU,{heroStat:null==et?void 0:null===(n=et.result)||void 0===n?void 0:null===(i=n.subscribes)||void 0===i?void 0:i.totals.subscribes,isLoading:$||et.isLoading,title:en("Paid subscribers"),children:(null==et?void 0:null===(o=et.result)||void 0===o?void 0:null===(r=o.subscribes)||void 0===r?void 0:r.users.length)?(0,Z.tZ)(ZJ,{total:null==et?void 0:null===(l=et.result)||void 0===l?void 0:null===(a=l.subscribes)||void 0===a?void 0:a.totals.subscribes,users:null==et?void 0:null===(d=et.result)||void 0===d?void 0:null===(s=d.subscribes)||void 0===s?void 0:s.users,pub:ee,userMismatchHelpMessage:en("User information can take up to 30 minutes to update")}):(0,Z.tZ)(ZH,{message:(null==et?void 0:null===(p=et.result)||void 0===p?void 0:null===(u=p.subscribes)||void 0===u?void 0:null===(c=u.totals)||void 0===c?void 0:c.subscribes)?er(ww(),null==et?void 0:null===(g=et.result)||void 0===g?void 0:null===(m=g.subscribes)||void 0===m?void 0:null===(h=m.totals)||void 0===h?void 0:h.subscribes):en("No paid subscribers"),Icon:wf.Z,helpMessage:(null==et?void 0:null===(y=et.result)||void 0===y?void 0:null===(b=y.subscribes)||void 0===b?void 0:null===(v=b.totals)||void 0===v?void 0:v.subscribes)?en("User information can take up to 30 minutes to update"):""})}):null,(0,Z.tZ)(ZU,{heroStat:null==et?void 0:null===(_=et.result)||void 0===_?void 0:null===(f=_.signups)||void 0===f?void 0:f.total,isLoading:$||et.isLoading,title:en("Free subscribers"),children:(null==et?void 0:null===(x=et.result)||void 0===x?void 0:null===(C=x.signups)||void 0===C?void 0:null===(w=C.users)||void 0===w?void 0:w.length)?(0,Z.tZ)(ZJ,{total:null==et?void 0:null===(k=et.result)||void 0===k?void 0:null===(S=k.signups)||void 0===S?void 0:S.total,users:null==et?void 0:null===(T=et.result)||void 0===T?void 0:null===(B=T.signups)||void 0===B?void 0:B.users,pub:ee,userMismatchHelpMessage:en("User information can take up to 30 minutes to update")}):(0,Z.tZ)(ZH,{Icon:w_.Z,message:(null==et?void 0:null===(N=et.result)||void 0===N?void 0:null===(I=N.signups)||void 0===I?void 0:I.total)?er(wC(),null==et?void 0:null===(E=et.result)||void 0===E?void 0:null===(P=E.signups)||void 0===P?void 0:P.total):en("No free subscribers"),helpMessage:(null==et?void 0:null===(M=et.result)||void 0===M?void 0:null===(X=M.signups)||void 0===X?void 0:X.total)?en("User information can take up to 30 minutes to update"):""})}),ei?(0,Z.tZ)(ZU,{heroStat:null==et?void 0:null===(R=et.result)||void 0===R?void 0:null===(D=R.unsubscribes)||void 0===D?void 0:D.total,isLoading:$||et.isLoading,title:en("Paid unsubscribes"),children:(null==et?void 0:null===(z=et.result)||void 0===z?void 0:null===(L=z.unsubscribes)||void 0===L?void 0:null===(F=L.users)||void 0===F?void 0:F.length)?(0,Z.tZ)(ZJ,{users:null==et?void 0:null===(U=et.result)||void 0===U?void 0:null===(O=U.unsubscribes)||void 0===O?void 0:O.users,pub:ee,total:null==et?void 0:null===(Y=et.result)||void 0===Y?void 0:Y.unsubscribes.total,userMismatchHelpMessage:en("User information can take up to 30 minutes to update")}):(0,Z.tZ)(ZH,{Icon:wZ.Z,message:(null==et?void 0:null===(j=et.result)||void 0===j?void 0:null===(H=j.unsubscribes)||void 0===H?void 0:H.total)?er(wx(),null==et?void 0:null===(V=et.result)||void 0===V?void 0:null===(J=V.unsubscribes)||void 0===J?void 0:J.total):en("No paid unsubscribes"),helpMessage:(null==et?void 0:null===(W=et.result)||void 0===W?void 0:null===(q=W.unsubscribes)||void 0===q?void 0:q.total)?en("User information can take up to 30 minutes to update"):""})}):null]})},wB=e=>{let{subscribes:t}=e;return(0,Z.BX)(et.tu,{paddingTop:8,children:[(0,Z.BX)(et.gq,{borderBottom:"detail-dashed",paddingBottom:16,justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"bold",children:"Annual subscribers"}),(0,Z.tZ)(ei.xv.B4,{children:null==t?void 0:t.totals.annual_subscribes})]}),(0,Z.BX)(et.gq,{borderBottom:"detail-dashed",paddingY:16,justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"bold",children:"Monthly subscribers"}),(0,Z.tZ)(ei.xv.B4,{children:null==t?void 0:t.totals.monthly_subscribes})]}),(0,Z.BX)(et.gq,{borderBottom:"detail-dashed",paddingY:16,justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"bold",children:"Founding subscribers"}),(0,Z.tZ)(ei.xv.B4,{children:null==t?void 0:t.totals.founding_subscribes})]}),(0,Z.BX)(et.gq,{paddingTop:16,justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"bold",children:"Free trials"}),(0,Z.tZ)(ei.xv.B4,{children:null==t?void 0:t.totals.free_trials})]})]})},wT=e=>!!e&&!!e.post_date&&(0,H.Z)(e.post_date).isAfter((0,H.Z)().subtract(2,"day")),wI=e=>!!e&&!!e.post_date&&(0,H.Z)(e.post_date).isBefore((0,H.Z)().subtract(2,"year")),wN=e=>{let{firstWeekDailyStats:t,statName:i,overrideValue:n}=e,r=t.length<7;return t.map((e,o)=>r&&o===t.length-1&&null!=n?n:e[i])},wP=e=>{var t,i,n;let{post:r,stats:o,pub:a}=e,{iString:l}=(0,Q.M1)();return wI(r)?(0,Z.tZ)(ZD,{pub:a,data:[["estimated_value"in o?null==o?void 0:o.estimated_value:0,Math.round(null!==(n=null==o?void 0:null===(t=o.comps)||void 0===t?void 0:t.avg_estimated_value)&&void 0!==n?n:0)]],labels:[l("This post"),l("Your average post")],dataType:"currency"}):(0,Z.tZ)(wy,{labels:null==o?void 0:null===(i=o.firstWeekDailyStats)||void 0===i?void 0:i.map(e=>e.dt),data:[wN({firstWeekDailyStats:null==o?void 0:o.firstWeekDailyStats,statName:"cumulative_estimated_value",overrideValue:"estimated_value"in o?null==o?void 0:o.estimated_value:void 0}),null==o?void 0:o.firstWeekDailyStats.map(e=>{var t,i;return null!==(i=null===(t=e.comps)||void 0===t?void 0:t.avg_cumulative_estimated_value)&&void 0!==i?i:0})],pub:a,statName:"estimated revenue",isCurrency:!0,dataType:"currency"})},wE=e=>{var t,i,n;let{stats:r,pub:o,post:a}=e,{iString:l}=(0,Q.M1)();return wI(a)?(0,Z.tZ)(ZD,{pub:o,data:[[null==r?void 0:r.subscribes,Math.round(null!==(n=null==r?void 0:null===(t=r.comps)||void 0===t?void 0:t.avg_subscribes)&&void 0!==n?n:0)]],labels:[l("This post"),l("Your average post")]}):(0,Z.tZ)(wy,{labels:null==r?void 0:null===(i=r.firstWeekDailyStats)||void 0===i?void 0:i.map(e=>e.dt),data:[wN({firstWeekDailyStats:null==r?void 0:r.firstWeekDailyStats,statName:"cumulative_subscribes",overrideValue:null==r?void 0:r.subscribes}),null==r?void 0:r.firstWeekDailyStats.map(e=>{var t,i;return null!==(i=null===(t=e.comps)||void 0===t?void 0:t.avg_cumulative_subscribes)&&void 0!==i?i:0})],pub:o,statName:"subscriber"})},wX=e=>{var t,i,n;let{stats:r,pub:o,post:a}=e,{iString:l}=(0,Q.M1)();return wI(a)?(0,Z.tZ)(ZD,{pub:o,data:[[null==r?void 0:r.signups,Math.round(null!==(n=null==r?void 0:null===(t=r.comps)||void 0===t?void 0:t.avg_signups)&&void 0!==n?n:0)]],labels:[l("This post"),l("Your average post")]}):(0,Z.tZ)(wy,{labels:null==r?void 0:null===(i=r.firstWeekDailyStats)||void 0===i?void 0:i.map(e=>e.dt),data:[wN({firstWeekDailyStats:null==r?void 0:r.firstWeekDailyStats,statName:"cumulative_signups",overrideValue:null==r?void 0:r.signups}),null==r?void 0:r.firstWeekDailyStats.map(e=>{var t,i;return null!==(i=null===(t=e.comps)||void 0===t?void 0:t.avg_cumulative_signups)&&void 0!==i?i:0})],pub:o,statName:"subscriber"})},wM=e=>{let{id:t,postsResource:i,pub:n}=e,{iString:r}=(0,Q.M1)(),o=[{id:"free_subscribers",key:"signups",name:r("Free subscribers"),Component:wX,description:r("The number of readers who became free subscribers after reading this post.")}],a=[{id:"estimated_revenue",valueFn:e=>"estimated_value"in e?e.estimated_value:0,name:r("Estimated revenue increase"),format:"currency",Component:wP,description:r("The estimated increase in Gross Annualized Revenue from new paid subscriptions driven by this post. Coupons, subscription changes, and payment failures after retries are not factored into this estimation.")},{id:"paid_subscribers",key:"subscribes",name:r("Paid subscribers"),Component:wE,description:r("The number of readers who became paid subscribers after reading this post. Readers may have been free subscribers or could be new subscribers.")}],l="enabled"===n.payments_state?a.concat(o):o,[s,d]=Z2({tabs:l}),[c,u]=Z4({postsResource:i});return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(Z1,{pub:n,activeTab:s,tabs:l,resource:c,updateActiveTab:d,children:c&&(0,Z.tZ)(s.Component,{pub:n,stats:c,post:u})}),(0,Z.tZ)(wS,{isLoading:null==i?void 0:i.isLoading,postId:t,stats:c,pub:n})]})},wA=e=>{let{activeTab:t,postId:i,post:n}=e,r=(0,re.aF)(),{iString:o}=(0,Q.M1)(),a=(0,io.xR)(),l=null==n?void 0:n.headlineTest,s=(null==n?void 0:n.headlineTest)&&!n.headlineTest.ended_at,d=[{value:"overview",label:o("Overview"),getUrl:e=>"/publish/posts/detail/".concat(e)},{value:"reach",label:o("Reach"),getUrl:e=>"/publish/posts/detail/".concat(e,"/reach")},{value:"engagement",label:o("Engagement"),getUrl:e=>"/publish/posts/detail/".concat(e,"/engagement")},{value:"growth",label:o("Growth"),getUrl:e=>"/publish/posts/detail/".concat(e,"/growth")},{value:"tests",label:o("Tests"),getUrl:e=>"/publish/posts/detail/".concat(e,"/tests"),trailingIcon:s&&"tests"!==t?(0,Z.tZ)(iI.$j,{size:14,padding:0}):null}].filter(e=>(null==r?void 0:r.is_admin)||"growth"!==e.value);return a.getConfigFor("headline_testing_enabled")&&l||(d=d.filter(e=>"tests"!==e.value)),(0,Z.tZ)(sr.X2,{children:(0,Z.tZ)(tx.Z,{tabs:d,value:t,onChange:e=>{let t=d.find(t=>t.value===e);t&&(0,B.route)(t.getUrl(i))}})})};var wD=i(73303),wR=i.n(wD);let wF=e=>{let{categories:t}=e;return(0,Z.tZ)(et.sg,{gap:20,children:t.map((e,i)=>(0,Z.BX)(w.Fragment,{children:[(0,Z.tZ)(wL,{title:e.title,rate:e.rate}),i!==t.length-1&&(0,Z.tZ)(tX.iz,{})]},e.title))})},wL=e=>{let{title:t,rate:i}=e;return(0,Z.BX)(et.X2,{alignItems:"center",gap:12,className:"gridRow-VB6XXj",children:[(0,Z.tZ)(tA.__,{ellipsis:!0,children:t}),(0,Z.tZ)(iI.uk,{percent:i,theme:"accent",height:6}),(0,Z.tZ)(tA.__,{minWidth:32,textAlign:"right",children:(0,Y.rG)(i)})]})},wz=e=>{let{postId:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(!1),[o,a]=(0,ov.Z)();return(0,A.d4)(()=>{(null==a?void 0:a.isIntersecting)&&r(!0)},[null==a?void 0:a.isIntersecting]),(0,Z.BX)(et.tu,{paddingBottom:16,gap:16,children:[(0,Z.tZ)(et.hs,{direction:{mobile:"column",desktop:"row"},justifyContent:{mobile:"start",desktop:"space-between"},alignItems:{desktop:"center",mobile:"start"},gap:8,children:(0,Z.tZ)(ei.xv.H3,{ref:o,children:i("Traffic")})}),n&&(0,Z.tZ)(wO,{postId:t})]})},wO=e=>{var t,i,n;let{postId:r}=e,o=(0,iS.ib)({pathname:"/api/v1/post_management/detail/".concat(r,"/traffic"),auto:!0}),{iString:a}=(0,Q.M1)();return(0,Z.BX)(ZY,{columns:2,children:[(0,Z.tZ)(ZU,{title:a("How readers found your post"),isLoading:o.isLoading,children:(0,Z.tZ)(wH,{categories:null===(t=o.result)||void 0===t?void 0:t.categories})}),(0,Z.tZ)(ZU,{title:a("Traffic sources"),isLoading:o.isLoading,children:(0,Z.tZ)(wU,{referrers:null===(i=o.result)||void 0===i?void 0:i.referrers})}),(0,Z.tZ)(ZU,{title:a("How readers visited your post"),isLoading:o.isLoading,children:(0,Z.tZ)(wY,{devices:null===(n=o.result)||void 0===n?void 0:n.devices})})]})},wU=e=>{let{referrers:t}=e,{iString:i}=(0,Q.M1)();if(!t)return null;let n=t.filter(e=>e.percent_of_total_views<=.01),r={views:wR()(n,"views"),subscribes:wR()(n,"subscribes"),signups:wR()(n,"signups")};return(0,Z.BX)("table",{className:k()("referrersTable-dWSHHk","post-stats-table"),children:[(0,Z.tZ)("thead",{children:(0,Z.BX)("tr",{children:[(0,Z.tZ)("th",{children:(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"Source"})}),(0,Z.tZ)("th",{children:(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"Views"})}),(0,Z.tZ)("th",{children:(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"Paid subs"})}),(0,Z.tZ)("th",{children:(0,Z.tZ)(ei.xv.Meta,{translated:!0,children:"Free subs"})})]})}),(0,Z.tZ)("tbody",{children:t.filter(e=>e.percent_of_total_views>.01).map(e=>(0,Z.BX)("tr",{children:[(0,Z.tZ)("td",{children:(0,Z.tZ)(ei.xv.B4,{children:i(e.source)})}),(0,Z.tZ)("td",{children:(0,Z.tZ)(ei.xv.B4,{children:ZC(e.percent_of_total_views)})}),(0,Z.tZ)("td",{children:(0,Z.tZ)(ei.xv.B4,{children:e.subscribes.toLocaleString()})}),(0,Z.tZ)("td",{children:(0,Z.tZ)(ei.xv.B4,{children:e.signups.toLocaleString()})})]})).concat(r.views>0?[(0,Z.BX)("tr",{children:[(0,Z.tZ)("td",{children:(0,Z.tZ)(ei.xv.B4,{children:i("other")})}),(0,Z.tZ)("td",{children:(0,Z.tZ)(ei.xv.B4,{children:"< 1%"})}),(0,Z.tZ)("td",{children:(0,Z.tZ)(ei.xv.B4,{children:r.subscribes.toLocaleString()})}),(0,Z.tZ)("td",{children:(0,Z.tZ)(ei.xv.B4,{children:r.signups.toLocaleString()})})]})]:[])})]})},wY=e=>{var t;let{devices:i}=e;return i?(0,Z.tZ)(wF,{categories:null!==(t=null==i?void 0:i.map(e=>({title:e.device_type,rate:e.percent_of_total_views})))&&void 0!==t?t:[]}):null},wH=e=>{let{categories:t}=e;return t?(0,Z.tZ)(wF,{categories:t.map(e=>({title:e.category_type,rate:e.percent_of_total_views}))}):null},wj=e=>{let{postId:t}=e,[i,n]=(0,A.eJ)(!1),[r,o]=(0,ov.Z)();return(0,A.d4)(()=>{(null==o?void 0:o.isIntersecting)&&n(!0)},[null==o?void 0:o.isIntersecting]),(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(et.hs,{direction:{desktop:"row",mobile:"column"},paddingY:24,justifyContent:{desktop:"space-between",mobile:"start"},alignItems:"center",children:(0,Z.tZ)(ei.xv.H3,{ref:r,translated:!0,children:"Recipients"})}),i&&(0,Z.tZ)(wJ,{postId:t})]})},wJ=e=>{let{postId:t}=e,{iString:i}=(0,Q.M1)(),{rows:n,hasMoreRows:r,loading:o,setOffset:a,nextOffset:l,sort:s,setSort:d}=po({url:"/api/v1/post_management/detail/".concat(t,"/recipients"),defaultSort:{by:"opens",direction:u8.Desc}}),c=[{key:"email",name:i("Subscriber"),sortable:!0,valueFn:e=>{let{email:t}=e;return t&&t.endsWith("deletion-request.substack.com")?i("[deleted user]"):t}},{key:"status",name:i("Status"),valueFn:e=>{let{expiry:t}=e;return t&&(0,H.Z)(t).isAfterNow()?i("Paid"):i("Free")}},{key:"opens",name:i("Opens"),sortable:!0},{key:"clicks",name:i("Clicks"),sortable:!0},{key:"agents",name:i("Devices"),sortable:!0}];return 0===n.length&&o?(0,Z.tZ)(et.gq,{alignItems:"center",justifyContent:"center",children:(0,Z.tZ)(iI.$j,{})}):(0,Z.tZ)(u7,{cols:c,rows:n,hasMoreRows:r,appendMode:!0,className:"post-stats-table",sort:s,setSort:d,loading:o,onLoadMore:()=>a(l)})},wV=e=>{var t,i;let{stats:n,pub:r}=e,{iString:o}=(0,Q.M1)();return(0,Z.tZ)(ZD,{pub:r,labels:[o("This post"),o("Your typical post")],data:[[null==n?void 0:n.sent,Math.round(null!==(i=null===(t=n.comps)||void 0===t?void 0:t.avg_sent)&&void 0!==i?i:0)]]})},wq=e=>{var t,i;let{stats:n,pub:r}=e,{iString:o}=(0,Q.M1)(),a=Math.round(100*Zw(null==n?void 0:n.delivered,null==n?void 0:n.sent)),l=Math.round(100*Zw(null==n?void 0:null===(t=n.comps)||void 0===t?void 0:t.avg_delivered,null==n?void 0:null===(i=n.comps)||void 0===i?void 0:i.avg_sent));return(0,Z.tZ)(ZD,{pub:r,labels:[o("This post"),o("Your typical post")],data:[[a,l]],dataType:"percentage"})},wW=e=>{var t,i,n;let{stats:r,pub:o,post:a}=e,{iString:l}=(0,Q.M1)();return wI(a)?(0,Z.tZ)(ZD,{pub:o,data:[[null==r?void 0:r.views,Math.round(null!==(n=null==r?void 0:null===(t=r.comps)||void 0===t?void 0:t.avg_views)&&void 0!==n?n:0)]],labels:[l("This post"),l("Your average post")]}):(0,Z.tZ)(wy,{pub:o,labels:null==r?void 0:null===(i=r.firstWeekDailyStats)||void 0===i?void 0:i.map(e=>e.dt),data:[wN({firstWeekDailyStats:null==r?void 0:r.firstWeekDailyStats,statName:"cumulative_views",overrideValue:null==r?void 0:r.views}),(null==r?void 0:r.firstWeekDailyStats)?null==r?void 0:r.firstWeekDailyStats.map(e=>{var t,i;return null!==(i=null===(t=e.comps)||void 0===t?void 0:t.avg_cumulative_views)&&void 0!==i?i:0}):[]],statName:"view"})},wG=e=>{var t,i,n,r,o,a,l,s;let{stats:d,pub:c,post:u}=e,p=[],h=[],m=[],{iString:g}=(0,Q.M1)();return"downloads_day90"in d?((null==u?void 0:u.post_date)&&(0,H.Z)(u.post_date).isBefore((0,H.Z)().subtract(7,"day"))&&(p.push(null==d?void 0:d.downloads_day7),h.push(Math.round(null!==(r=null==d?void 0:null===(n=d.comps)||void 0===n?void 0:n.avg_downloads_day7)&&void 0!==r?r:0)),m.push(g("After 7 days"))),(null==u?void 0:u.post_date)&&(0,H.Z)(u.post_date).isBefore((0,H.Z)().subtract(30,"day"))&&(p.push(null==d?void 0:d.downloads_day30),h.push(Math.round(null!==(a=null==d?void 0:null===(o=d.comps)||void 0===o?void 0:o.avg_downloads_day30)&&void 0!==a?a:0)),m.push(g("After 30 days"))),(null==u?void 0:u.post_date)&&(0,H.Z)(u.post_date).isBefore((0,H.Z)().subtract(90,"day"))&&(p.push(null==d?void 0:d.downloads_day90),h.push(Math.round(null!==(s=null==d?void 0:null===(l=d.comps)||void 0===l?void 0:l.avg_downloads_day90)&&void 0!==s?s:0)),m.push(g("After 90 days")))):(p.push(null==d?void 0:d.downloads),h.push(Math.round(null!==(i=null==d?void 0:null===(t=d.comps)||void 0===t?void 0:t.avg_downloads_day7)&&void 0!==i?i:0)),m.push(g("Today"))),(0,Z.tZ)(ZD,{pub:c,labels:m,data:[p,h]})},wK=e=>{var t,i,n,r;let{stats:o,pub:a,post:l}=e,s=[],d=[],c=[],{iString:u}=(0,Q.M1)();return"podcast_preview_downloads"in o?(s.push(null==o?void 0:o.podcast_preview_downloads),d.push(Math.round(null!==(i=null==o?void 0:null===(t=o.comps)||void 0===t?void 0:t.avg_podcast_preview_downloads)&&void 0!==i?i:0)),c.push(u("In total")),(null==l?void 0:l.post_date)&&(0,H.Z)(l.post_date).isBefore((0,H.Z)().subtract(30,"day"))&&(s.push(null==o?void 0:o.podcast_preview_downloads_day30),d.push(Math.round(null!==(r=null==o?void 0:null===(n=o.comps)||void 0===n?void 0:n.avg_podcast_preview_downloads_day30)&&void 0!==r?r:0)),c.push(u("After 30 days"))),(0,Z.tZ)(ZD,{pub:a,data:[s,d],labels:c})):(0,Z.tZ)(Z.HY,{})},wQ=e=>{var t,i;let{stats:n,pub:r}=e,{iString:o}=(0,Q.M1)();return(0,Z.tZ)(ZD,{pub:r,labels:[o("This post"),o("Your typical post")],data:[[null==n?void 0:n.video_views,Math.round(null!==(i=null==n?void 0:null===(t=n.comps)||void 0===t?void 0:t.avg_video_views)&&void 0!==i?i:0)]]})},w$=e=>{let{id:t,postsResource:i,pub:n}=e,{iString:r}=(0,Q.M1)(),o=(0,re.aF)(),a=[{id:"recipients",name:r("Recipients"),key:"sent",Component:wV,description:r("The number of subscribers who were sent an email or mobile app notification for this post. Subscribers who receive both an email and a mobile app notification are only counted once.")},{id:"delivery_rate",name:r("Delivery rate"),valueFn:e=>Zw(e.delivered,e.sent),format:"percent",Component:wq,description:r("The percentage of subscribers whose email or mobile app notification for this post was successfully delivered. Subscribers who receive both an email and a mobile app notification are only counted once.")},{id:"views",name:r("Views"),key:"views",Component:wW,description:r("The total number of times this post has been viewed across web, email, and the Substack App. If one person views this post five times, that counts as five views.")}],[l,s]=Z4({postsResource:i});s&&"podcast"===s.type&&(["everyone","only_free","only_paid_no_preview","founding_no_preview"].includes(s.audience)||wT(s)||a.unshift({id:"preview_downloads",name:r("Preview downloads"),valueFn:e=>"podcast_preview_downloads"in e?e.podcast_preview_downloads:0,Component:wK}),a.unshift({id:"downloads",name:r("Downloads"),key:"downloads",Component:wG})),s&&"video"===s.type&&a.unshift({id:"video_views",name:r("Video views"),key:"video_views",Component:wQ});let[d,c]=Z2({tabs:a});return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(Z1,{pub:n,activeTab:d,tabs:a,resource:l,updateActiveTab:c,children:l&&(0,Z.tZ)(d.Component,{pub:n,stats:l,post:s})}),(0,Z.tZ)(wz,{postId:t}),(null==o?void 0:o.is_admin)&&(0,Z.tZ)(wj,{postId:t})]})},w0=e=>{let t=e.loading;return(0,Z.BX)(et.tu,{border:"detail",padding:16,radius:"md",flex:"grow",minWidth:0,children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",children:"Traffic sources"}),(0,Z.tZ)(ts.xu,{children:(0,Z.tZ)(tX.iz,{paddingY:16})}),t?(0,Z.tZ)(et.gq,{paddingY:32,justifyContent:"center",children:(0,Z.tZ)(iI.$j,{})}):(0,Z.tZ)(w1,(0,f._)({},e))]})},w1=e=>{let{postId:t,has_more:i,loading:n,sources:r}=e,[o,a]=(0,A.eJ)(r||[]),[l,s]=(0,A.eJ)(i||!1),[d,c]=(0,A.eJ)(n),{iString:u}=(0,Q.M1)(),p=async()=>{try{c(!0);let e=await N().get("/api/v1/drafts/".concat(t,"/referrers")).query({offset:o.length});a([...o,...e.body.sources]),s(e.body.has_more)}catch(e){console.error("error fetching referrers",e),alert((0,Y.zx)(e,u("There was a network issue. Try again in a bit")))}finally{c(!1)}},h=(e=>{let t=[],i=!1;for(let n=0;n<e.length;n++){let r=e[n],{percent_of_total_views:o,views:a}=r,l=Number(o);if(l<=.01){t.push({source:u("other"),views:a,percent_of_total_views:l}),i=!0;break}t.push((0,_._)((0,f._)({},r),{percent_of_total_views:l}))}return{referrers:t,reached_one_percent:i}})(o),m=l&&!h.reached_one_percent;return h.referrers&&h.referrers.length>0?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(et.tu,{gap:16,paddingBottom:16,children:h.referrers.map(e=>{let{percent_of_total_views:t,source:i}=e,n=100*Number(t),r=n<=1?"<1%":"".concat((0,er.numberToString)(n),"%");return(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(ei.xv.B4,{weight:"bold",children:u(i)}),(0,Z.tZ)(ei.xv.B4,{children:r})]})})}),m&&(0,Z.tZ)(ee.zx,{priority:"secondary",size:"sm",onClick:p,children:d?u("Loadingâ€¦"):u("More")})]}):(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"No sources yet"})};function w2(){let e=(0,G._)(["Published at ",""]);return w2=function(){return e},e}function w4(){let e=(0,G._)(["Published ",""]);return w4=function(){return e},e}let w3=e=>{var t,i,{id:n,referrer:r,tab:o}=e,a=(0,ef._)(e,["id","referrer","tab"]);let[l,s]=(0,A.eJ)(o);(0,A.d4)(()=>{s(o)},[o]),(0,A.d4)(()=>{let e=()=>{let e=window.location.pathname.match(/\/detail\/\d+\/(\w+)$/);e?s(e[1]):s("overview")};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[]);let d=pr({url:"/api/v1/post_management/detail/".concat(n),deps:[],dataKey:"posts",pageSize:1,auto:!0}),c=(0,A.Ye)(()=>{switch(l){case"growth":return wM;case"reach":return w$;case"engagement":return Z7;case"tests":return wd;default:return w6}},[l]),{error:u,isLoading:p,rows:h}=d,m=u||!p&&!h&&!(null==h?void 0:h[0]);if(null==d?void 0:d.isLoading)return(0,Z.tZ)(dl,{});if((null==d?void 0:d.error)||!(null==d?void 0:null===(t=d.rows)||void 0===t?void 0:t[0]))return(0,Z.tZ)(hO,{itemLabel:"post"});let g=null==d?void 0:null===(i=d.rows)||void 0===i?void 0:i[0];return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(dt,{children:(0,Z.BX)(et.sg,{gap:20,children:[(0,Z.tZ)(yH.ZP,{}),(0,Z.tZ)(de,{onClick:()=>(0,B.route)(r||"/publish/posts")}),(0,Z.tZ)(w8,{postsResource:d,post:g}),(0,Z.tZ)(wA,{activeTab:l,postId:n,post:g}),!m&&c&&(0,Z.tZ)(c,(0,f._)({postsResource:d,id:n},a)),m&&(0,Z.tZ)(dd,{})]})})})},w8=e=>{let{postsResource:t,post:i}=e,{language:n,iTemplate:r}=(0,Q.M1)(),o=(0,eq.Ij)(),a=pB(),l=(0,re.aF)(),{type:s,cover_image:d,title:c,is_section_pinned:u,section_id:p,section_name:h,pins:m,top_exclusions:g,post_date:v,republishedPosts:b}=i,y=1>vw()().diff(vw()(v),"day"),f=(0,Y.Po)(v,{includeTime:!0,language:n});return(0,Z.tZ)(dn,{title:c||"Post details",description:r(v&&y?w2():w4(),f),leading:d?(0,Z.tZ)(pV,{type:s||"newsletter",cover_image:d,title:c||"",is_section_pinned:u||!1,section_id:p||null,section_name:h,pins:m||[],top_exclusions:g||[]}):null,cta:(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(w9,{republishedPosts:b,post:i,pub:o}),(0,Z.tZ)(ee.zx,{priority:"secondary-outline",disabled:!i,onClick:()=>i&&a.view.onClick({post:i,pub:o}),children:"function"==typeof a.view.label?a.view.label({post:i,pub:o}):a.view.label}),s&&(0,Z.tZ)(pM,{post:i,features:pE({view:"published",type:s,user:l,post:i}),postsResource:t})]})})},w6=e=>{let{postsResource:t,id:i,pub:n}=e,{error:r,isLoading:o,rows:a}=t,{iString:l,iPlural:s}=(0,Q.M1)(),d=(0,re.aF)();if(r||!o&&!a&&!(null==a?void 0:a[0]))return(0,Z.tZ)(dd,{});let{type:c,email_sent_at:u,stats:p,video_upload_id:h}=(null==a?void 0:a[0])||{},{sent:m,views:g,opened:v,clicked:b,signups:y,shares:_,subscribes:w,referrers:C,links:x,has_more_links:S,downloads:k,video_views:B,video_minutes_watched:T,estimated_value:I}=p||{},N=p$(u),P=(y||0)+(w||0),E=m&&v?v/m:0,X=P&&P>0,M=m&&m>0,A=v&&v>0&&m&&m>0?"/publish/".concat(i,"/recipients"):void 0,D=M?"/publish/".concat(i,"/recipients"):void 0,R=eS()(_)||0===_?void 0:s("%1 share","%1 shares",_),F=eS()(v)||0===v?void 0:s("%1 open","%1 opens",v),L=nT()([eS()(w)?void 0:s("%1 paid subscriber","%1 paid subscribers",w),eS()(y)?void 0:s("%1 free subscriber","%1 free subscribers",y)]).join(", ");return(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(et.tu,{gap:12,paddingBottom:32,children:[N&&(0,Z.tZ)(oU.b,{priority:"secondary",showClose:!1,Icon:ZZ.Z,title:l("Data still processing"),description:l("It can take up to 10 minutes for data to first become available.")}),"enabled"===n.payments_state&&(null==d?void 0:d.is_admin)&&(0,Z.BX)(w5,{children:[(0,Z.tZ)(ml,{title:l("New subscribers"),value:P,format:"number",description:X?L:void 0,tooltip:l("The number of people who subscribed to your Substack after reading this post."),loading:o}),(0,Z.tZ)(ml,{title:l("Estimated revenue increase"),value:I,format:"currency",currencyIsCents:!1,tooltip:l("The estimated increase in Gross Annualized Revenue from the new paid subscriptions driven by this post. This estimate excludes coupons, subscription changes, and payment failures after retries."),loading:o})]}),(0,Z.BX)(w5,{children:[(0,Z.tZ)(ml,{title:l("Total views"),value:g,description:R,format:"number",tooltip:l("The total number of times this post has been viewed across web, email, and the Substack App. If one person views this post five times, that counts as five views."),loading:o}),"podcast"===c&&(0,Z.tZ)(ml,{title:l("Podcast downloads"),value:k,format:"number",tooltip:l("The number of times at least 60 seconds of this episode was downloaded to a unique device. This definition follows IAB industry standards."),loading:o}),(0,Z.tZ)(ml,{title:l("Recipients"),value:m,format:"number",description:M?l("View details"):void 0,tooltip:l("The number of subscribers who were sent an email or push notification for this post. Subscribers who receive both an email and push notification are only counted once."),loading:o,href:D}),(0,Z.tZ)(ml,{title:l("Open rate"),value:E,format:"percent",description:F,tooltip:l("The percentage of subscribers who opened this post after receiving an email or app notification about it. If one person opens your post five times, that counts as one open."),loading:o,href:A})]}),!!h&&(0,Z.BX)(w5,{children:[(0,Z.tZ)(ml,{title:l("Video plays"),value:B,format:"number",tooltip:l("The total number of times this video was played on Substack. Plays are counted when the user manually initiates playback or manually unmutes an autoplaying video, then watches for a continuous 30 seconds."),loading:o}),(0,Z.tZ)(ml,{title:l("Watch time"),value:T?6e4*T:0,format:"duration",tooltip:l("The total duration of time this video has played on Substack. Watch time is counted only when the user manually initiates playback or manually unmutes an autoplaying video."),loading:o})]}),(0,Z.BX)(w5,{children:["adhoc_email"!==c&&(0,Z.tZ)(w0,(0,f._)({postId:i,loading:o},C)),(0,Z.tZ)(ZR,{postId:i,loading:o,links:x,hasMoreLinks:S,clicked:b,opened:v})]})]})})},w5=(0,ts.zo)({display:"flex",direction:{desktop:"row",mobile:"column"},gap:12}),w9=e=>{let{republishedPosts:t,post:i,pub:n}=e;if(!t)return null;let r=t.map(e=>{var t,i;let r=null===(t=n.sections)||void 0===t?void 0:t.find(t=>{let{id:i}=t;return i===e.sectionId});return{value:e.postId.toString(),label:"".concat(null!==(i=null==r?void 0:r.name)&&void 0!==i?i:"").concat(e.isRepublish?"":" and Website")}});return(0,Z.tZ)(iT.m,{onChange:e=>(0,Y.uX)((0,en.cwg)(n,parseInt(e))),value:i.id.toString(),options:r})};var w7=i(56219),Ce=i(21316),Ct=i(86092),Ci=i(10045);class Cn extends w.Component{componentDidMount(){this.load_more({alert_errors:!0})}componentDidUpdate(e,t){let i=!1;if(t){for(let t of["dataset"])if(this.props[t]!==e[t]){i=!0;break}for(let e of["order_by","order_asc"])if(this.state[e]!==t[e]){i=!0;break}}i&&this.load_more({alert_errors:!0,reset:!0})}async load_more(){let e,t,{alert_errors:i,reset:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={limit:20,offset:n?0:this.state.items.length,order_by:this.state.order_by,order_asc:this.state.order_asc?"true":""};if(n)this.setState({items:[],has_more:!0});else if(!this.state.has_more||this.state.loading&&eC()(r,this.state.loading))return;this.setState({loading:r});let o=N().get(this.props.dataset).query(r).then(e=>e.body);try{e=await o}catch(e){t=e}this.state.loading===r&&(t?i&&alert((0,Y.zx)(t)):this.setState({has_more:e.length>=r.limit,items:this.state.items.concat(e)}),this.setState({loading:!1}))}render_value(e,t,i,n){if(e.render)return e.render(t,i,n);let r=t[e.key];switch(typeof r){case"boolean":return r.toString();case"number":return(0,er.numberToString)(r);case"string":return r}return r?JSON.stringify(r):""}render(e,t){let{children:i,className:n,on_select:r}=e,{items:o,order_by:a,order_asc:l,has_more:s,loading:d}=t,c=(0,w.toChildArray)(i);return(0,Z.BX)("table",{className:n,children:[(0,Z.tZ)("tr",{className:"header-row",children:c.map(e=>(0,Z.tZ)("th",{className:"".concat(e.className||""," ").concat(e.sort?a!==e.key?"sort-none":l?"sort-asc":"sort-desc":""),onClick:()=>{e.sort&&this.setState({order_by:e.key,order_asc:a===e.key&&!l})},children:e.render_header?e.render_header(e):(0,er.toSentenceCase)(e.key)}))}),o.map((e,t)=>(0,Z.tZ)("a",{className:"tr",href:"javascript:void(0)",onClick:i=>{let n=r(e,t,o);"string"==typeof n&&(0,Y.uX)(n,{event:i})},children:c.map((i,n)=>(0,Z.tZ)("td",{className:"".concat(0===n?"primary":""," ").concat(i.className||""),children:this.render_value(i,e,t,o)}))})),s&&(0,Z.tZ)("tr",{className:"loading-row",children:c.map((e,t)=>(0,Z.tZ)("td",{className:"".concat(0===t?"primary":""," ").concat(e.className||""),children:0===t?(0,Z.tZ)(h5.Z,{threshold:256,onVisible:()=>this.load_more(),children:(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:()=>this.load_more({alert_errors:!0}),children:d?"Loadingâ€¦":"Load more"})}):"\xa0"}))}),0===o.length&&!s&&(0,Z.tZ)("tr",{className:"loading-row",children:c.map((e,t)=>(0,Z.tZ)("td",{className:"".concat(0===t?"primary":""," ").concat(e.className||""),children:t?"\xa0":"No results"}))})]})}constructor(e,t){super(e,t),this.state={loading:!1,items:[],has_more:!0,order_by:this.props.order_by,order_asc:this.props.order_asc||!1}}}var Cr=i(91379),Co=i(30698);let Ca=e=>{let{pub:t}=e,[i,n]=(0,A.eJ)(!1),[r,o]=(0,A.eJ)(!1);(0,A.d4)(()=>{(0,U.j)(U.FP.BOOST_MODAL_SEEN),window.sessionStorage.getItem("seenBoostOptinModal")||(window.sessionStorage.setItem("seenBoostOptinModal","true"),N().put("/api/v1/publication_settings").send({boost_optin_seen:!0,score_based_upsell_optin_seen:!0}).then(()=>n(!0)))},[]);let a=()=>{n(!1)};return(0,Z.BX)(eK.u_,{className:mX,isOpen:i,onClose:a,children:[(0,Z.BX)(et.tu,{children:[(0,Z.BX)("div",{className:mM,children:[(0,Z.tZ)("img",{src:(0,en.zF4)("/img/publish/pledges_launch_modal.jpeg",1e3)}),(0,Z.tZ)(ee.hU,{onClick:a,size:"sm",priority:"secondary",children:(0,Z.tZ)(K.Z,{size:20})})]}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:20,paddingX:6,children:[(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ei.xv.Meta,{color:"primary",children:"GROW YOUR EARNINGS WITH"}),(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.tZ)(ei.xv.H3,{color:"primary",children:"Substack Boost"}),(0,Z.BX)(ei.xv.B3,{color:"primary",children:["Turn on Boost to put our team's data and expertise to work to grow your publication."," ",(0,Z.tZ)("a",{onClick:()=>(0,U.j)(U.FP.BOOST_LEARN_MORE_CLICKED),target:"__blank",href:"https://support.substack.com/hc/en-us/articles/9674586580244",children:"Learn more"}),"."]})]})]}),(0,Z.BX)(et.gq,{gap:20,children:[(0,Z.tZ)(gS.Z,{className:mD}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{children:"Multiple-subscription discount"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:"Offer a discount to new readers when they are buying paid subscriptions to other publications on Substack."})]})]}),(0,Z.BX)(et.gq,{gap:20,children:[(0,Z.tZ)(gk.Z,{className:mD}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{children:"Pre-cancel offer"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:"Reduce subscriber churn. Extend a free month to paid subscribers who enter the cancelation flow."})]})]}),(0,Z.BX)(et.gq,{gap:20,children:[(0,Z.tZ)(Co.Z,{size:20,className:k()(mD,"iconLarge-tJoiKP")}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{children:"Upsell engaged readers"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:"Convert your most engaged readers to paid subs with an automated, customizable email."})]})]})]})})]}),(0,Z.tZ)(eK.mz,{showDivider:!1,direction:"row",primaryButton:(0,Z.tZ)(ee.zx,{disabled:r,onClick:async()=>{o(!0),(0,U.j)(U.FP.BOOST_MODAL_TURN_ON_CLICKED),await N().post("/api/v1/boost").send({enabled:!0}),(0,Y.uX)((0,en.wI3)(t,{params:{search:"boost"}}))},priority:"primary",children:"Turn on"}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:a,priority:"secondary",disabled:r,children:"No thanks"})})]})};var Cl=i(85700);let Cs="icon-ER3sz0",Cd=e=>{let{isOpen:t,pub:i}=e,[n,r]=(0,A.eJ)(!1),[o,a]=(0,A.eJ)(!1);(0,A.d4)(()=>{let e=async()=>{if((0,U.j)(U.FP.PAYMENT_PLEDGE_LAUNCH_MODAL_SEEN),"undefined"!=typeof window&&!window.sessionStorage.getItem("seenPledgesLaunchModal")){window.sessionStorage.setItem("seenPledgesLaunchModal","true");try{await N().put("/api/v1/publication_settings").send({payment_pledges_optin_seen:!0,payment_pledges_enabled:!0}),await N().get("/api/v1/pledges/plans"),r(!0)}catch(e){}}};t&&e()},[t]);let l=()=>{r(!1)},s=async()=>{a(!0),(0,U.j)(U.FP.PAYMENT_PLEDGE_LAUNCH_MODAL_TURN_OFF_CLICKED),await N().put("/api/v1/publication_settings").send({payment_pledges_enabled:!1}),l()};return(0,Z.BX)(eK.u_,{isOpen:n,onClose:l,className:"modal-CyM1lp",children:[(0,Z.BX)(et.tu,{children:[(0,Z.BX)("div",{className:"promoImageWrap-hgUpl9",children:[(0,Z.tZ)("img",{src:(0,en.zF4)("/img/publish/pledges_launch_modal.jpeg",1e3)}),(0,Z.tZ)(ee.hU,{onClick:l,priority:"secondary",size:"sm",children:(0,Z.tZ)(K.Z,{size:20})})]}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:20,paddingX:6,children:[(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ei.xv.Meta,{color:"primary",children:"Introducing"}),(0,Z.tZ)(ei.xv.H3,{color:"primary",children:"Subscriber Pledges"})]}),(0,Z.BX)(et.gq,{gap:20,children:[(0,Z.tZ)(um.Z,{className:Cs}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{children:"Readers can pledge their support"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:"Great writing is valuable. Accepting pledges helps publishers build confidence before turning on paid subscriptions."})]})]}),(0,Z.BX)(et.gq,{gap:20,children:[(0,Z.tZ)(gS.Z,{className:Cs}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{children:"Pledges become paid subscriptions"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:"Pledges are more than a vote of confidence. If you turn on paid, pledges will turn into ongoing paid subscriptions."})]})]}),(0,Z.BX)(et.gq,{gap:20,children:[(0,Z.tZ)(Cl.Z,{size:20,className:k()(Cs,"iconLarge-abTjJp")}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{children:"Youâ€™re in control"}),(0,Z.BX)(ei.xv.B4,{color:"secondary",children:["If you prefer to not accept pledges, you can choose"," ",(0,Z.tZ)("a",{className:"promoLink-g7VOQu",onClick:o?()=>{}:s,children:"turn it off"})," ","at any point."]})]})]})]})})]}),(0,Z.tZ)(eK.mz,{showDivider:!1,direction:"row",primaryButton:(0,Z.tZ)(ee.zx,{disabled:o,onClick:l,priority:"primary",children:"Got it"}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:l,href:(0,en.wI3)(i,{params:{search:"pledge"}}),priority:"secondary",disabled:o,children:"Pledge settings"})})]})},Cc=e=>(0,Z.BX)(eH.l,(0,_._)((0,f._)({},e),{name:"TrendingUpIcon",strokeWidth:2,svgParams:{width:24,height:24,viewBox:"0 0 24 24"},children:[(0,Z.tZ)("polyline",{points:"23 6 13.5 15.5 8.5 10.5 1 18"}),(0,Z.tZ)("polyline",{points:"17 6 23 6 23 12"})]})),Cu=e=>{let{signups:t,subscribes:i,shares:n,postType:r}=e;return t<=0&&i<=0&&n<=0?null:(0,Z.BX)("div",{className:"post-substat","data-testid":"stats-growth",children:[[[i,"paid subscription"],[t,"free subscription"],[n,"share"]].filter(e=>e[0]).map(e=>(0,er.pluralize)(e[0],e[1])).join(", ")," ","after ",(0,er.getPostCtaPresentParticiple)(r)," this"]})},Cp=e=>{var{stroke:t="#555",strokeWidth:i="1.5"}=e,n=(0,ef._)(e,["stroke","strokeWidth"]);return(0,Z.BX)(eH.l,(0,_._)((0,f._)({},n),{name:"HelpCircleIcon",svgParams:{width:24,height:24,viewBox:"0 0 24 24",fill:"none"},children:[(0,Z.tZ)("path",{d:"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z",stroke:t,"stroke-width":i,"stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M9.08984 8.99959C9.32495 8.33126 9.789 7.7677 10.3998 7.40873C11.0106 7.04975 11.7287 6.91853 12.427 7.0383C13.1253 7.15808 13.7587 7.52112 14.2149 8.06312C14.6712 8.60512 14.9209 9.29112 14.9198 9.99959C14.9198 11.9996 11.9198 12.9996 11.9198 12.9996",stroke:t,"stroke-width":i,"stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M12 17H12.01",stroke:t,"stroke-width":i,"stroke-linecap":"round","stroke-linejoin":"round"})]}))},Ch=e=>{let{clicks:t,opens:i}=e,n=100*t/Math.max(t,i);return(0,Z.BX)("span",{className:"post-link-value",children:[(0,er.numberToString)(t)," (",(0,er.numberToString)(n,{precision:n>=1?0:1}),"%)"]})},Cm=e=>{let{sent:t,postEmailSentAt:i}=e,n=(0,A.sO)(null),r=(0,A.sO)(null);return(0,Z.BX)("div",{className:"post-stat","data-testid":"stats-recipients",children:[(0,er.numberToString)(t),(0,Z.BX)("span",{className:"post-stat-label clickable",ref:n,children:[(0,er.pluralize)(t,"Recipient",{just_word:!0,zero_fallback:"Recipients"}),(0,Z.tZ)(Cp,{className:"post-stat-icon",width:12,height:12,stroke:"#757575",strokeWidth:"3"}),(0,Z.tZ)(uQ,{baseRef:n,hoverToggle:!0,onOpen:()=>{r.current.open()},onClose:()=>{r.current.close()},children:(0,Z.tZ)(eY.Fx,{ref:r,noList:!0,className:"explanation",children:(0,H.Z)(i).add(1,"hour").isBeforeNow()?["The number of subscribers who were sent an email or mobile app notification for this post. Subscribers who receive both an email and a mobile app notification are only counted once."]:"Expecting more stats here? These can take up to an hour to populate, so check back in later."})})]})]})},Cg=e=>{let{opened:t,sent:i,opens:n,postEmailSentAt:r}=e,o=(0,A.sO)(null),a=(0,A.sO)(null),l=(0,A.sO)(null),s=(0,A.sO)(null);return(0,Z.BX)("div",{className:"post-stat","data-testid":"stats-opens",children:[(0,er.numberToString)(100*t/i),"%",(0,Z.BX)("span",{className:"post-stat-label open-rate-label",ref:o,children:["Open rate",(0,Z.tZ)(Cp,{className:"post-stat-icon",width:12,height:12,stroke:"#757575",strokeWidth:"3"}),(0,Z.tZ)(uQ,{baseRef:o,hoverToggle:!0,onOpen:()=>{a.current.open()},onClose:()=>{a.current.close()},children:(0,Z.tZ)(eY.Fx,{ref:a,noList:!0,className:"explanation",children:(0,H.Z)(r).add(1,"hour").isBeforeNow()?["The percentage of subscribers who opened this post after receiving an email or mobile app notification about it. If one person opens your post five times, that counts as one open."]:"Expecting more stats here? These can take up to an hour to populate, so check back in later."})})]}),n>0&&[(0,Z.BX)("span",{className:"post-stat-label",ref:l,children:[" ","(",(0,er.pluralize)(n,"open"),")"," ",(0,Z.tZ)(uQ,{baseRef:l,hoverToggle:!0,onOpen:()=>{s.current.open()},onClose:()=>{s.current.close()},children:(0,Z.tZ)(eY.Fx,{ref:s,noList:!0,className:"explanation",children:(0,H.Z)(r).add(1,"hour").isBeforeNow()?["The total number of post opens on email, web, or the mobile app."]:"Expecting more stats here? These can take up to an hour to populate, so check back in later."})})]})]]})},Cv=e=>{let{clicked:t,opened:i,links:n,has_more_links:r,isLoadingLinks:o,loadMoreLinks:a}=e;return t<=0?null:(0,Z.BX)("div",{className:"post-links","data-testid":"stats-clicks",children:[(0,Z.tZ)("div",{className:"post-links-title",children:"Link clicks"}),(0,Z.BX)("div",{className:"post-link",children:[(0,Z.tZ)(Ch,{clicks:t,opens:Math.max(t,i||0)}),(0,Z.tZ)("span",{className:"post-link-description",children:"of openers clicked a link"})]}),null==n?void 0:n.map(e=>(0,Z.BX)("div",{className:"post-link",children:[(0,Z.tZ)(Ch,{clicks:e[1],opens:Math.max(t,i||0)}),(0,Z.tZ)("span",{className:"post-link-description",children:["other urls","Like button"].includes(e[0])?e[0]:(0,Z.tZ)("a",{href:e[0],target:"_blank",rel:"noopener",children:e[0]})})]})),r&&n.length>0&&(0,Z.BX)("div",{className:"post-link",children:[(0,Z.tZ)("span",{}),(0,Z.tZ)("a",{href:"#",onClick:e=>a(e),children:o?"Loadingâ€¦":"More"})]})]})},Cb=e=>{let{postEmailSentAt:t,postSlug:i,postId:n,sent:r,opened:o,opens:a,clicked:l,links:s,has_more_links:d,isLoadingLinks:c,loadMoreLinks:u}=e;return t&&"coming-soon"!==i?r?(0,Z.BX)(Z.HY,{children:[(0,Z.BX)("div",{className:"post-stats",onClick:e=>(0,Y.uX)("/publish/".concat(n,"/recipients"),{event:e}),children:[(0,Z.tZ)(Cm,{postEmailSentAt:t,sent:r}),(0,Z.tZ)(Cg,{opens:a,opened:o,sent:r,postEmailSentAt:t})]}),(0,Z.tZ)(Cv,{clicked:l,links:s,has_more_links:d,loadMoreLinks:u,opened:o,isLoadingLinks:c})]}):(0,Z.tZ)("div",{className:"post-note",children:"No email data yet"}):null},Cy=e=>{let{views:t,email_sent_at:i}=e,n=(0,A.sO)(null),r=(0,A.sO)(null);return(0,Z.BX)("div",{className:"post-stat","data-testid":"stats-views",children:[(0,er.numberToString)(t||0),(0,Z.BX)("span",{className:"post-stat-label",ref:n,children:[(0,er.pluralize)(t||0,"Total View",{zero_fallback:"Total Views",just_word:!0}),(0,Z.tZ)(Cp,{className:"post-stat-icon",width:12,height:12,stroke:"#757575",strokeWidth:"3"}),(0,Z.tZ)(uQ,{baseRef:n,hoverToggle:!0,onOpen:()=>{r.current.open()},onClose:()=>{r.current.close()},children:(0,Z.tZ)(eY.Fx,{ref:r,noList:!0,className:"explanation",children:(0,H.Z)(i).add(1,"hour").isBeforeNow()?["The total number of times this post has been viewed across web, email, and the Substack App. If one person views this post five times, that counts as five views."]:"Expecting more stats here? These can take up to an hour to populate, so check back in later."})})]})]})},Cf=e=>{let{postType:t,downloads:i}=e;return"podcast"!==t?null:(0,Z.BX)("div",{className:"post-stat","data-testid":"stats-downloads",children:[(0,er.numberToString)(i||0),(0,Z.tZ)("span",{children:(0,er.pluralize)(i||0,"Podcast Download",{zero_fallback:"Podcast Downloads",just_word:!0})})]})},C_=e=>{let{views:t,postType:i,email_sent_at:n,downloads:r}=e;return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(Cy,{views:t,email_sent_at:n}),(0,Z.tZ)(Cf,{postType:i,downloads:r})]})},CZ=e=>{let t=async t=>{if(null==t||t.preventDefault(),!e.loading&&0!==e.sources.length&&e.has_more_referrers&&!e.loading_referrers){e.onReferrerQueryChange({loading_referrers:!0});try{let t=await N().get("/api/v1/drafts/".concat(e.post_id,"/referrers")).query({offset:e.sources.length});e.onReferrerQueryChange({referrer_sources:e.sources.concat(t.body.sources),has_more_referrers:t.body.has_more,loading_referrers:!1})}catch(e){console.error("error fetching referrers",e),alert((0,Y.zx)(e,"There was a network issue. Try again in a bit"))}e.onReferrerQueryChange({loading_referrers:!1})}},i=!e||!e.sources||0===e.sources.length,n=(e=>{let t=[],i=!1;for(let n=0;n<e.length;n++){let r=e[n];if(r){if(.01>=Number(r.percent_of_total_views)){t.push({source:"other",views:r.views,percent_of_total_views:r.percent_of_total_views}),i=!0;break}t.push(r)}}return{referrer_sources:t,reached_one_percent:i}})(e.sources),r=e.has_more_referrers&&!n.reached_one_percent,{iString:o}=(0,Q.M1)();return(0,Z.BX)("div",{className:"referrer-sources",children:[(0,Z.tZ)("div",{className:"referrer-sources-title",children:o("Traffic sources")}),i&&(0,Z.tZ)("div",{children:o("nothing to show")}),!i&&n.referrer_sources.map(e=>{let t=100*Number(e.percent_of_total_views),i=t<=1?"<1%":"".concat((0,er.numberToString)(t),"%");return(0,Z.BX)("div",{className:"referrer-source",children:[(0,Z.tZ)("span",{className:"referrer-source-value",children:i}),(0,Z.tZ)("span",{className:"referrer-source-description",children:e.source})]})}),r&&(0,Z.BX)("div",{className:"referrer-source",children:[(0,Z.tZ)("span",{}),(0,Z.tZ)("a",{href:"#",id:"load-more-referrers",onClick:e=>t(e),children:e.loading_referrers?"Loadingâ€¦":"More"})]})]})},Cw=e=>{let{showPlaybackSummary:t,video_views:i}=e;return(0,Z.BX)("div",{className:"post-stat clickable","data-testid":"stats-video-views",onClick:t,children:[(0,er.numberToString)(i),(0,Z.tZ)("span",{children:(0,er.pluralize)(i,"Video Play",{zero_fallback:"Video Plays",just_word:!0})})]})},CC=e=>{let{video_minutes_watched:t,showPlaybackSummary:i}=e,n=60*(t||0);return t>0?(0,Z.BX)("div",{className:"post-stat clickable",onClick:i,"data-testid":"stats-video-minutes-watched",children:[(0,er.numberToString)((0,er.secondsToLargestUnit)(n,{minutesCutoff:6e4,hoursCutoff:1/0,noWord:!0}))," ",(0,Z.BX)("span",{children:[(0,er.toTitleCase)((0,er.secondsToLargestUnit)(n,{minutesCutoff:6e4,hoursCutoff:1/0,noNumber:!0,long:!0}))," ","Watched"]})]}):null},Cx=e=>{let{video_views:t,video_minutes_watched:i,showPlaybackSummary:n}=e;return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(Cw,{showPlaybackSummary:n,video_views:t}),(0,Z.tZ)(CC,{showPlaybackSummary:n,video_minutes_watched:i})]})},CS=e=>{let{loadData:t}=e;return(0,Z.BX)("div",{className:"post-note error",children:["Failed to load!"," ",(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:t,children:"Retry"})]})},Ck=()=>((0,A.d4)(()=>{(0,U.j)(U.FP.STATS_PLACEHOLDER_SEEN)},[]),(0,Z.tZ)("div",{className:"post-stats big",children:(0,Z.BX)("div",{className:"stats-placeholder","data-testid":"stats-placeholder",children:[(0,Z.tZ)(Cc,{}),(0,Z.tZ)("p",{children:"We're still gathering data on this post"})]})})),CB=e=>{let{data:t,post:i,isLoading:n,total_views:r,isLoadingReferrers:o,referrer_sources:a,has_more_referrers:l,onReferrerQueryChange:s,loadData:d,links:c,has_more_links:u,loadMoreLinks:p,isLoadingLinks:h}=e,[m,g]=(0,A.eJ)(!1);return t?t&&0===t.views&&(a.length>0||t.downloads>0||t.video_views>0||t.opens>0||t.signups>0)?(0,Z.tZ)(Ck,{}):(0,Z.BX)(Z.HY,{children:[(t.views>0||t.downloads>0||t.video_views>0||!i.email_sent_at||"coming-soon"===i.slug)&&(0,Z.BX)("div",{className:"post-stats big",children:["video"!==i.type?(0,Z.tZ)(C_,{views:t.views,downloads:t.downloads,postType:i.type,email_sent_at:i.email_sent_at}):(0,Z.tZ)(Cx,{showPlaybackSummary:()=>g(!m),video_views:t.video_views,video_minutes_watched:t.video_minutes_watched}),(0,Z.tZ)(Cu,{signups:t.signups,subscribes:t.subscribes,shares:t.shares,postType:i.type})]}),(0,Z.tZ)(Cb,{opens:t.opens,opened:t.opened,clicked:t.clicked,sent:t.sent,links:c,loadMoreLinks:p,postId:i.id,postSlug:i.slug,postEmailSentAt:i.email_sent_at,has_more_links:u,isLoadingLinks:h}),a.length>1&&(0,Z.tZ)(CZ,{loading:n,has_more_referrers:l,post_id:i.id,total_views:r,sources:a,loading_referrers:o,onReferrerQueryChange:e=>s(e)})]}):n?(0,Z.tZ)(Ck,{}):(0,Z.tZ)(CS,{loadData:d})},CT=e=>{let{post:t,pub:i,collapsed:n,user:r,className:o,onChange:a,publishedLoading:l,showIcon:s}=e,[d,c]=(0,A.eJ)(n),[u,p]=(0,A.eJ)(!0),[h,m]=(0,A.eJ)(void 0),[g,v]=(0,A.eJ)("12345".split("").map(e=>[e,+e])),[b,y]=(0,A.eJ)(!1),[w,C]=(0,A.eJ)(!0),[x,S]=(0,A.eJ)(1),[B,T]=(0,A.eJ)([]),[I,P]=(0,A.eJ)(!1),[E,X]=(0,A.eJ)(!1),M=(0,eW.default)("like_posts_enabled"),D=(0,A.sO)(null),R=async()=>{c(!1);try{let e=(await N().get("/api/v1/drafts/".concat(t.id,"/stats"))).body,{links:i,has_more_links:n,referrers:r}=e,o=(0,ef._)(e,["links","has_more_links","referrers"]),a=[],l=!1,s=0;r&&(a=r.sources,l=r.has_more,s=r.total_views),L({data:o,links:i,has_more_links:n,referrer_sources:a,has_more_referrers:l,total_views:s})}catch(e){console.error(e)}p(!1)},F=(0,A.I4)(R,[t]);(0,A.d4)(()=>{d||l||F().catch(console.error)},[F,d,l]);let L=e=>{let{data:t,links:i,has_more_links:n,referrer_sources:r,has_more_referrers:o,total_views:a}=e;v(i),C(n),T(r),P(o),m(t),S(a)},z=async e=>{if(e&&e.preventDefault(),!u&&h&&w&&!b){y(!0);try{let e=await N().get("/api/v1/drafts/".concat(t.id,"/links")).query({offset:g.length});v(g.concat(e.body.links)),C(e.body.has_more_links)}catch(e){console.error(e),alert((0,Y.zx)(e,"There was a network issue. Try again in a bit"))}y(!1)}},O=async()=>{d&&(await R(),D.current&&D.current.scrollIntoView&&D.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}))};return(0,Z.BX)("div",{className:k()("post",o,{collapsed:d,"loader-big":u&&!d}),onClick:O,ref:D,children:[(0,Z.tZ)(w7.mV,{className:"inline-post",user:r,pub:i,post:(0,_._)((0,f._)({},t),{post_url_override:(0,j.uRy)(i,t,{noBase:!0,edit:!t.is_published&&"restack"!==t.type,uuid:"restack"===t.type})}),showDatetime:!(0,Y.K1)(),allowEdit:"restack"!==t.type,allowSendEmail:"restack"!==t.type,hideAuthor:!0,showEmailSent:!0,hidePinning:t&&!t.is_published,showReactions:!!M,onChange:a,showIcon:s,publishedPost:!0}),!d&&(0,Z.tZ)(CB,{data:h,post:t,loadData:R,links:g,has_more_links:w,isLoadingLinks:b,loadMoreLinks:z,has_more_referrers:I,isLoadingReferrers:E,onReferrerQueryChange:e=>{let{loading_referrers:t,referrer_sources:i,has_more_referrers:n}=e;t&&X(t),i&&T(i),n&&P(n)},referrer_sources:B,isLoading:u,total_views:x})]})},CI=e=>{let{isOpen:t,pub:i}=e,[n,r]=(0,A.eJ)(!1);(0,A.d4)(()=>{let e=async()=>{(0,U.j)(U.FP.READER_REFERRALS_MODAL_LEARN_MORE_SEEN),"undefined"==typeof window||window.sessionStorage.getItem("seenReaderReferralsOptInModalUpdated")||(window.sessionStorage.setItem("seenReaderReferralsOptInModalUpdated","true"),await N().put("/api/v1/publication_settings").send({seen_reader_gift_referrals_modal:!0}),r(!0))};t&&e()},[t]);let o=()=>{r(!1)};return(0,Z.BX)(eK.u_,{className:"reader-referrals-modal",isOpen:n,onClose:o,children:[(0,Z.tZ)("div",{className:"close-icon",onClick:o,children:(0,Z.tZ)(eJ.Z,{})}),(0,Z.tZ)(ei.xv.H2,{children:"Introducing referrals"}),(0,Z.BX)(ei.xv.B3,{className:"body",children:["Send your top paid subscribers gift subscriptions to share with their friends. Customize the email we use to extend the offer in your settings."," ",(0,Z.tZ)("a",{onClick:()=>(0,U.j)(U.FP.READER_REFERRALS_MODAL_LEARN_MORE_CLICKED),target:"__blank",href:"https://support.substack.com/hc/en-us/articles/8946512015892",children:"Learn more"}),"."]}),(0,Z.tZ)("div",{className:"ctas",children:(0,Z.tZ)(ee.zx,{onClick:async()=>{(0,U.j)(U.FP.READER_REFERRALS_MODAL_OPT_IN_CLICKED),await N().post("/api/v1/viral_gifts/config").send({enabled:!0,from_modal:!0}),(0,Y.uX)((0,j.OEk)(i),{local_navigation:!1})},priority:"primary",children:"Turn on referrals"})})]})},CN=e=>{let{pub:t}=e,[i,n]=(0,A.eJ)(!1);(0,A.d4)(()=>{(0,U.j)(U.FP.SCORE_BASED_UPSELL_MODAL_SEEN),window.sessionStorage.getItem("seenScoreBasedUpsellOptinModal")||(window.sessionStorage.setItem("seenScoreBasedUpsellOptinModal","true"),Promise.all([N().put("/api/v1/publication_settings").send({score_based_upsell_optin_seen:!0}),N().put("/api/v1/boost").send({feature:"boost_score_based_upsell",value_bool:!0})]).then(()=>n(!0)))},[]);let r=()=>{n(!1)};return(0,Z.tZ)(eK.u_,{className:"modal-qQgMy1",isOpen:i,onClose:r,children:(0,Z.BX)(et.tu,{paddingX:8,paddingBottom:4,children:[(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.BX)(et.tu,{gap:2,children:[(0,Z.tZ)(ei.xv.Meta,{children:"NEW BOOST FEATURE"}),(0,Z.tZ)(ei.xv.H3,{weight:"bold",children:"Just added! Automated upsell emails"})]}),(0,Z.BX)(ei.xv.B4,{color:"secondary",children:["As part of Boost, an automated email designed to upsell your most engaged free subscribers has been turned on for your publication. Emailing engaged subscribers with this 20% discount special can drive up to a 2x lift in your free-to-paid conversion rates. Customize the email or turn it off in your"," ",(0,Z.tZ)("a",{target:"__blank",href:(0,en.wI3)(t,{params:{search:"boost"}}),children:"Boost settings"}),"."]})]})}),(0,Z.tZ)(eK.mz,{showDivider:!1,direction:"row",primaryButton:(0,Z.tZ)(ee.zx,{onClick:async()=>{(0,U.j)(U.FP.SCORE_BASED_UPSELL_MODAL_DONE_CLICKED),r()},priority:"primary",children:"Done"}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:async()=>{(0,U.j)(U.FP.SCORE_BASED_UPSELL_MODAL_EDIT_EMAIL_CLICKED),(0,Y.uX)((0,en.n1t)("/publish/settings/edit",{redirect:(0,en.wI3)(t,{addBase:!0,section:"boost"}),bodyField:"score_based_upsell",title:"Upsell to engaged subscribers",endpoint:"/api/v1/publication/email_render_elements?include_defaults=true",titleField:"score_based_upsell_subject",titlePlaceholder:"Email subject..."}),{newTab:!0})},priority:"secondary",children:"Edit email"})})]})})};class CP extends w.Component{async componentDidMount(){var e;this.loadMore("published",{force:!0}),this.loadMore("draft",{force:!0}),this.loadMore("scheduled",{force:!0}),(null===(e=this.props.user)||void 0===e?void 0:e.is_admin)&&this.loadTwitterAccount(),(0,H.Z)(this.props.pub.created_at).isAfter((0,H.Z)("2022-11-11T00:00:00.000Z"))&&this.setState({showLaunchChecklist:!0})}async loadTwitterAccount(){var e,t;if(null===(e=this.context)||void 0===e?void 0:e.getConfigFor("twitter_connect_flows_enabled")){let e=await N().get("/api/v1/twitter/account");this.setState({twitterAccount:(null===(t=e.body)||void 0===t?void 0:t.account)||null})}else this.setState({twitterAccount:null})}getFetchBatchSize(e,t){return"published"===e?0===t.length?1:10:0===t.length?6:12}getTwitterBannerAction(e,t){var i;return!(null===(i=this.context)||void 0===i?void 0:i.getConfigFor("twitter_connect_flows_enabled"))||(0,H.Z)(t.created_at).add(2,"weeks").isAfterNow()||void 0===e?null:null===e?"connect":!1===e.discoverable?"set-discoverable":null}render(e,t){var i,n,r;let{pub:o,user:a,eligibleForGoPaidCTA:l,recommendationsAnnouncementUrl:s,showShare:d}=e,{publishedPosts:c,publishedLoading:u,publishedHasMore:p,publishedError:h,draftPosts:m,draftLoading:g,draftHasMore:v,scheduledPosts:b,scheduledLoading:y,scheduledHasMore:f,scheduledError:_,twitterAccount:w,forceShareModal:C,crossPostModalOpen:x,crossPostModalPost:S}=t,k=(0,co.aF)({podcasts:(0,co.EP)(o),isSection:!1}),B=this.getTwitterBannerAction(w,o),T=(0,Y.K1)(),I=!!s&&a.is_admin,N="enabled"===o.payments_state&&!o.paywall_free_trial_enabled;return(0,Z.tZ)(tU.w,{children:(0,Z.BX)("div",{className:"page typography",id:"posts-list-page",children:[(0,Z.tZ)(CM,{user:a,pub:o}),(0,Z.tZ)(yH.ZP,{}),(d||C)&&(0,Z.tZ)(Ci.Z,{authorVersion:!0,publication:o}),l&&!I&&(0,Z.tZ)("div",{className:"container",children:(0,Z.tZ)(P.pI,{})}),!N&&!I&&B&&T&&(0,Z.tZ)(P.QD,{action:B}),this.props.showReaderReferralsOptIn&&(0,Z.tZ)(CI,{pub:o,isOpen:this.props.showReaderReferralsOptIn}),!this.props.showReaderReferralsOptIn&&this.props.showBoostOptIn&&(0,Z.tZ)(Ca,{pub:o}),!this.props.showReaderReferralsOptIn&&!this.props.showBoostOptIn&&this.props.showScoreBasedUpsellOptIn&&(0,Z.tZ)(CN,{pub:o}),!this.props.showReaderReferralsOptIn&&!this.props.showBoostOptIn&&!this.props.showScoreBasedUpsellOptIn,this.props.showPledgesLaunchOptIn&&(0,Z.tZ)(Cd,{isOpen:this.props.showPledgesLaunchOptIn,pub:o}),!this.props.showReaderReferralsOptIn&&!this.props.showBoostOptIn&&!this.props.showScoreBasedUpsellOptIn&&!this.props.showPledgesLaunchOptIn&&this.props.showGAMigrationModal&&(0,Z.tZ)(uz,{pub:o}),(0,Z.tZ)(hB,{isOpen:x,post:S,onClose:async()=>{await this.refetch("scheduled"),this.setState({crossPostModalOpen:!1,crossPostModalPost:null})},pub:o}),(0,Z.BX)("div",{className:"container post-list-container",children:[(0,Z.BX)("div",{className:"drafts",children:[(0,Z.tZ)(ei.xv.H3,{children:"Create"}),(0,Z.BX)(et.tu,{gap:8,alignItems:"start",className:"create-buttons",children:[(0,Z.tZ)(ee.zx,{leading:(0,Z.tZ)(pF.Z,{size:20,"data-testid":"publish-page-new-post"}),priority:"primary",href:(0,j.qYj)(o,{type:"newsletter"}),children:"New post"}),(0,Z.tZ)(ee.zx,{leading:(0,Z.tZ)(mj,{size:20,"data-testid":"publish-page-new-note"}),priority:"primary",href:(0,en.TKM)(),onClick:()=>{(0,U.j)(U.FP.PUBLISHER_DASHBOARD_POST_BUTTON_CLICKED,{type:"note",source:"legacy_dashboard"})},children:"New note"}),o.community_enabled&&[(0,Z.tZ)(ee.zx,{priority:"primary",leading:(0,Z.tZ)(pG.Z,{size:20,color:"white"}),onClick:e=>{if(a.name&&a.photo_url)(0,Y.uX)((0,j.qYj)(o,{type:"thread"}),{event:e});else{var t;null===(t=this.profileUpdater)||void 0===t||t.open()}},children:"New thread"}),(0,Z.tZ)(Ct.EB,{ref:this.assignProfileUpdater,user:a,needsPhoto:!0,onBeforeClose:e=>{if(e)return(0,Y.uX)((0,j.qYj)(o,{type:"thread"})),!1}})],(0,Z.tZ)(ee.zx,{priority:"primary",leading:(0,Z.tZ)(iG.Z,{size:20}),href:(0,j.qYj)(o,{type:"podcast",section:null!==(n=null==k?void 0:k.sectionId)&&void 0!==n?n:"pub",mediaType:"audio"}),localNavigation:!0,children:"New audio"}),(0,Z.tZ)(ee.zx,{priority:"primary",leading:(0,Z.tZ)(iK.Z,{size:20}),href:(0,j.qYj)(o,{type:"podcast",section:null!==(r=null==k?void 0:k.sectionId)&&void 0!==r?r:"pub",mediaType:"video"}),localNavigation:!0,children:"New video"})]}),(_||b&&b.length>0)&&[(0,Z.tZ)(ei.xv.H3,{paddingTop:32,children:"Scheduled"}),(0,Z.BX)("ul",{children:[b&&b.map(e=>(0,Z.tZ)("li",{children:(0,Z.BX)("a",{href:"restack"!==e.type?(0,j.uRy)(o,e,{edit:!0,noBase:!0}):"javascript:void(0)",onClick:()=>{"restack"===e.type&&this.setState({crossPostModalOpen:!0,crossPostModalPost:e})},children:[(0,Z.tZ)(Ce.m,{postType:e.type||"newsletter",className:"icon"}),e.draft_title||"Untitled post",(0,Z.tZ)("span",{children:(0,H.Z)((0,er.getScheduledAt)(e)).standardDatetime()})]})})),y?(0,Z.tZ)("button",{className:"button small no-padding",children:"Loadingâ€¦"}):_||f?(0,Z.tZ)("button",{className:"button small no-padding",onClick:()=>this.loadMore("scheduled"),children:"See More"}):null]})],(!m||m.length>0)&&[(0,Z.tZ)(ei.xv.H3,{paddingTop:32,children:"Drafts"}),(0,Z.BX)("ul",{children:[m&&m.map(e=>(0,Z.tZ)("li",{children:(0,Z.BX)("a",{href:(0,j.uRy)(o,e,{edit:!0,noBase:!0}),children:[(0,Z.tZ)(Ce.m,{postType:e.type||"newsletter",className:"icon"}),e.draft_title||"Untitled post"]})})),g?(0,Z.tZ)("button",{className:"button small no-padding",children:"Loadingâ€¦"}):!m||v?(0,Z.tZ)("button",{className:"button small no-padding",onClick:()=>this.loadMore("draft"),children:"See More"}):null]})],(null===(i=this.context)||void 0===i?void 0:i.getConfigFor("scheduled_pinned_posts"))&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.H3,{paddingTop:32,children:"Pinned posts"}),(0,Z.tZ)("p",{children:"Control and schedule which posts are featured on your homepage"}),(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-outline",href:"/publish/pins",localNavigation:!0,children:"Manage pinned posts"})]}),(0,Z.tZ)(ei.xv.H3,{paddingTop:32,children:"Chat"}),(0,Z.tZ)("p",{children:"Message your subscribers and host conversations"}),(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-outline",href:(0,en.xC8)({pubId:o.id,params:{utm_source:J.b3.writerDashboard,utm_medium:J.lP.web}}),children:"Visit your chat"}),(0,Z.tZ)(ei.xv.H3,{paddingTop:32,children:"Import your archives"}),(0,Z.tZ)("p",{children:"Bring your archives from your old blog or other platforms"}),(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-outline",href:"/publish/import",localNavigation:!0,children:"Import posts"}),(0,Z.tZ)(ei.xv.H3,{paddingTop:32,children:"Resources"}),(0,Z.BX)("ul",{className:"resources",children:[(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{href:"https://on.substack.com/p/start-basics",native:!0,children:"Setting up your Substack"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{href:"https://on.substack.com/p/your-guide-to-going-paid",native:!0,children:"Your guide to going paid"})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{href:"https://on.substack.com/p/a-guide-to-your-substack-metrics",native:!0,children:"What do my numbers mean?"})})]}),(0,Z.BX)(et.sg,{gap:8,children:[(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-outline",onClick:e=>(0,Y.uX)("https://substack.com/resources",{event:e,local_navigation:!1}),children:"More resources"})," ",(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-outline",onClick:e=>(0,Y.uX)("https://support.substack.com/",{event:e,local_navigation:!1}),children:"Frequently asked questions"})]})]}),(0,Z.tZ)("div",{children:c&&c.length>0?(0,Z.tZ)(w7.Ao,{className:"published",posts:c,hideFirstHeading:!0,renderPost:(e,t)=>(0,Z.tZ)(CT,{collapsed:t>0,post:e,pub:o,user:a,onChange:this.handlePublishedPostChange,showIcon:"newsletter"!==e.type}),children:p&&(0,Z.tZ)(h5.Z,{ref:this.publishedLoaderVisibility,threshold:1600,noDedupe:!0,onVisible:()=>!(0,Y.K1)()&&this.loadMore("published"),className:"published-loader",children:u?(0,Z.tZ)("div",{className:"more-loader"}):(0,Z.tZ)(ee.zx,{priority:"secondary",size:"sm",onClick:()=>this.loadMore("published"),children:"Load more posts"})})}):u?(0,Z.tZ)("div",{className:"published calendared-post-list",children:(0,Z.tZ)(CT,{publishedLoading:u,className:"hide-header",collapsed:!1,post:{id:0,publication_id:o.id,top_exclusions:[],pins:[],stub:!0,title:"1",email_sent_at:(0,H.Z)().subtract(1,"day").toISOString(),reactions:{"â¤":0}},pub:o,user:a,get_stats:async()=>({})})}):h?(0,Z.BX)("div",{className:"empty-state-post-list-wrapper",children:["Failed to load published posts."," ",(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:()=>this.loadMore("draft"),children:"Retry"})]}):(0,Z.tZ)("div",{className:"empty-state-post-list-wrapper",children:"No published posts yet."})})]})]})})}constructor(...e){var t;super(...e),t=this,(0,M._)(this,"profileUpdater",void 0),(0,M._)(this,"assignProfileUpdater",e=>{this.profileUpdater=e}),(0,M._)(this,"state",{publishedHasMore:!0,publishedLoading:!0,draftHasMore:!0,draftLoading:!0,scheduledHasMore:!0,scheduledLoading:!0,showLaunchChecklist:!1,crossPostModalOpen:!1}),(0,M._)(this,"publishedLoaderVisibility",(0,w.createRef)()),(0,M._)(this,"handlePublishedPostChange",e=>{var t;let{post:i}=null!=e?e:{};if(!i)return;let n=null!==(t=this.state.publishedPosts)&&void 0!==t?t:[],r=n.findIndex(e=>{let{id:t}=e;return t===i.id}),o=[...n.slice(0,r),i,...n.slice(r+1)];this.setState({publishedPosts:o})}),(0,M._)(this,"hideLaunchChecklist",()=>{this.setState({showLaunchChecklist:!1})}),(0,M._)(this,"loadMore",async function(e){let{force:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await (0,Y.Se)(t,"".concat(e,"Loading"),async i=>{if(i["".concat(e,"HasMore")])try{let n=i["".concat(e,"Posts")]||[],r=t.getFetchBatchSize(e,n),o=await N().get("/api/v1/drafts").query({filter:e,offset:n.length,limit:r});return await (0,Y.IW)(t,{["".concat(e,"Posts")]:n.concat(o.body),["".concat(e,"HasMore")]:o.body.length>=r}),!0}catch(i){console.error("Failed to fetch ".concat(e," posts:"),i),await (0,Y.IW)(t,{["".concat(e,"Error")]:i})}},{force:i})&&"published"===e&&t.publishedLoaderVisibility&&t.publishedLoaderVisibility.current&&t.publishedLoaderVisibility.current.checkVisibility()}),(0,M._)(this,"refetch",async e=>{let t=this.state["".concat(e,"Posts")]||[],i=await N().get("/api/v1/drafts").query({filter:e,limit:t.length});await (0,Y.IW)(this,{["".concat(e,"Posts")]:i.body})})}}(0,M._)(CP,"contextType",tV.WH);let CE=(0,ss.us)(eb(CP));class CX extends w.Component{render(e){let{post_id:t,pub:i}=e;return(0,Z.tZ)("div",{className:"page typography",id:"posts-list-page",children:(0,Z.BX)("div",{className:"container",children:[(0,Z.tZ)("a",{className:"button no-padding gap-bottom",href:"javascript:history.back()",children:"â† Back"}),(0,Z.tZ)("h2",{className:"page-title",children:"Recipients"}),(0,Z.tZ)(Cn,{className:"opener-table",dataset:"/api/v1/drafts/".concat(t,"/recipients"),order_by:"opens",on_select:e=>(0,j.pN7)(i,e.email),children:[{key:"email",className:"opener-email",sort:!0,render:e=>{let{email:t}=e;return t&&t.endsWith("deletion-request.substack.com")?"[deleted user]":t}},{key:"status",className:"opener-status",render:e=>(0,H.Z)(e.expiry).isAfterNow()?(0,Z.tZ)("span",{className:"subscriber-green",children:"Paid subscriber"}):"Free subscriber"},{key:"opens",className:"opener-opens",sort:!0},{key:"clicks",className:"opener-clicks",sort:!0},{key:"agents",className:"opener-agents",sort:!0,render_header:()=>"Devices"}]})]})})}}function CM(e){let{user:t,pub:i}=e;return(0,Cr.c)({user:t,pub:i}),null}var CA=i(7739),CD=i.n(CA),CR=i(57912),CF=i(11712),CL=i(17564);function Cz(){let e=(0,G._)(["Version from ",""]);return Cz=function(){return e},e}let CO=eb(e=>{let{pub:t,post_id:i,restoreVersionLocally:n=null,onClose:r=null,useCurrentAsLatest:o=!1,colorMapping:a=null}=e,{activeVersionContent:l,activeVersionId:s,draft:d,draftContentId:c,loading:u,loadMore:p,loadVersion:h,loadLocalVersion:m,prevPageKey:g,publishedVersionId:v,restoreSelected:b,restoreVersion:y,restoring:f,versions:_}=CH(t,i,n,a),w=CD()(_||{},"group"),C=sL()(Object.keys(w),CK),{iString:x,iTemplate:S,language:T}=(0,Q.M1)();return(0,Z.tZ)(tH.h,{children:(0,Z.BX)("div",{className:"versions-root",children:[(0,Z.BX)("div",{className:"versions-header",children:[(0,Z.BX)("div",{className:"versions-header-left",children:[(0,Z.tZ)("div",{className:"version-title",children:x("Draft History")}),(0,Z.tZ)("div",{className:"version-header-bottom",children:(0,Z.BX)("div",{className:k()("version-title-post",{loading:!d}),onClick:()=>r?r():(0,B.route)((0,j.ANx)(t,i)),children:["â†"," ",(0,er.truncateText)(d?(null==d?void 0:d.draft_title)||"[".concat(x("Untitled"),"]"):x("Loading Draft Versions..."),75)]})})]}),(0,Z.BX)("div",{className:"restore-info",children:[s&&s!==c&&(0,Z.BX)("div",{className:"restore-actions",children:[(0,Z.tZ)(ee.zx,{size:"sm",priority:"primary",disabled:!l||f,onClick:b,children:x(f?"Restoring draft...":"Restore draft")}),(0,Z.tZ)("div",{className:"restore-info-date",children:y?S(Cz(),CW(y,T)):"--"})]}),(0,Z.tZ)(CU,{draft:d})]})]}),(0,Z.BX)("div",{className:"version-content",children:[(0,Z.tZ)("div",{className:"version-list",children:(0,Z.BX)("div",{children:[C.map(e=>{var t;return(0,Z.tZ)(Cj,{group:rT()(e),versions:w[e],showHeader:C.length>1,draftContentId:o?null===(t=_[0])||void 0===t?void 0:t.Key:c,activeVersionId:s,loadVersion:h,loadLocalVersion:m,publishedVersionId:v})}),d&&u&&(0,Z.tZ)("div",{className:"version-row",children:(0,Z.tZ)("div",{className:"version-row-top",children:(0,Z.tZ)("div",{className:"version-main",children:x("Loading...")})})}),!u&&g&&(0,Z.tZ)("div",{className:"version-row",onClick:p,children:(0,Z.tZ)("div",{className:"version-row-top",children:(0,Z.tZ)("div",{className:"version-main",children:x("Load more")})})})]})}),(0,Z.tZ)("div",{className:"version-preview",children:l&&d?(0,Z.tZ)(Cq,{pub:t,post:d,versionContent:l}):(0,Z.tZ)(CY,{paddingTop:32})})]})]})})}),CU=e=>{let{draft:t,icon:i}=e;return(0,Z.tZ)(ZN.z,{content:(0,Z.BX)(et.tu,{padding:8,gap:4,children:[(0,Z.tZ)(ei.xv.H4,{translated:!0,children:"Restoring Drafts"}),(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"Substack automatically saves your draft periodically as you write. This page shows your version history for this post."}),(null==t?void 0:t.is_published)?(0,Z.BX)(ei.xv.B4,{translated:!0,children:["This post has already been published. Restoring a previous draft will"," ",(0,Z.tZ)("b",{children:"not update your published post"}),". Instead, it'll restore just your draft to a previous version. When you're ready to update your post, publish the working draft."]}):(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"This post has not been published yet. Restoring a previous draft will update your working copy. Restoring drafts will never update published posts until you decide to publish."})]}),children:null!=i?i:(0,Z.tZ)(CR.Z,{height:24,width:24,strokeWidth:0,className:"help-icon"})})},CY=e=>(0,Z.BX)(et.tu,(0,_._)((0,f._)({gap:8,className:"postContentSilhouette-CrMs2s"},e),{children:[(0,Z.tZ)(CL.S,{animated:!0,height:24,width:"100%"}),(0,Z.tZ)(CL.S,{animated:!0,height:24,width:"100%"}),(0,Z.tZ)(CL.S,{animated:!0,height:24,width:"100%"}),(0,Z.tZ)(CL.S,{animated:!0,height:24,width:"100%"}),(0,Z.tZ)(CL.S,{animated:!0,height:24,width:"70%"})]})),CH=(e,t,i,n)=>{let[r,o]=(0,A.eJ)(),[a,l]=(0,A.eJ)([]),[s,d]=(0,A.eJ)(),[c,u]=(0,A.eJ)(),[p,h]=(0,A.eJ)(),[m,g]=(0,A.eJ)(),[v,b]=(0,A.eJ)(null),[y,Z]=(0,A.eJ)(!1),[w,C]=(0,A.eJ)(!0),[x,S]=(0,A.eJ)(null),[k,T]=(0,A.eJ)(null),{iString:I,language:P}=(0,Q.M1)(),E={},X=null==n?void 0:n.colors,M=e=>{if(!n||!e)return null;if(E[e.id])return E[e.id];if(n.users[e.id]){let t=n.users[e.id];return E[e.id]=t,t}(null==X?void 0:X.length)||(X=n.colors);let[t,...i]=X;return E[e.id]=t,X=i,t};(0,A.d4)(()=>{l(lD(Number(t)).map(e=>{let t=(0,H.Z)(e.draft_updated_at),{calendar:i,group:n}=CG(t,P);return(0,_._)((0,f._)({},e),{group:n,calendar:i,asDayjs:t,local:!0})}))},[t,P]),(0,A.d4)(()=>{C(!0),N().get("/api/v1/drafts/".concat(t,"/versions")).query({bucket:x}).then(e=>{var t,i,n,r;if((null===(t=e.body)||void 0===t?void 0:t.draft)&&(o(e.body.draft),d(e.body.contentId),g(e.body.contentId),b(e.body.draft.draft_body),u(e.body.publishedContentKey)),null===(n=e.body)||void 0===n?void 0:null===(i=n.versions)||void 0===i?void 0:i.contents){let{contents:t,truncated:i,previousBucket:n}=null===(r=e.body)||void 0===r?void 0:r.versions,o=t.map(e=>{let t=(0,H.Z)(e.LastModified).tz(H.Z.tz.guess()),{calendar:i,group:n}=CG(t,P),r=M(e.user);return(0,_._)((0,f._)({},e),{calendar:i,asDayjs:t,group:n,color:r})});l(e=>e.concat(o)),T(n),i&&alert(I("There are too many versions for this post, all versions are not displayed"))}}).catch(e=>{alert((0,Y.zx)(e))}).finally(()=>{C(!1)})},[t,x]),(0,A.d4)(()=>h(a.find(e=>e.Key===s)),[s,a]);let D=m&&m!==s&&a&&a.find(e=>e.Key===m);return{activeVersionContent:v,activeVersionId:m,draft:r,draftContentId:s,loading:w,loadMore:()=>S(k),loadVersion:e=>{g(e),b(null),h(a.find(t=>t.Key===e)),N().post("/api/v1/drafts/".concat(t,"/load_version")).send({version_key:e}).then(e=>{g(e.body.contentId),b(e.body.version)}).catch(e=>{alert((0,Y.zx)(e))})},loadLocalVersion:e=>{g(e.draft_updated_at),b(e.draft_body),h(e)},prevPageKey:k,publishedVersionId:c,restoreSelected:()=>{if(m&&m!==s){if(i){i(v);return}Z(!0),(null==p?void 0:p.local)?N().put("/api/v1/drafts/".concat(t)).send({draft_body:v}).then(()=>{lU(p),document.location.reload()}).catch(e=>{alert((0,Y.zx)(e))}).finally(()=>Z(!1)):N().put("/api/v1/drafts/".concat(t,"/restore")).send({version_key:m}).then(i=>{o(i.body.draft),d(i.body.contentId),g(m),h(a.find(e=>e.Key===m)),b(i.body.draft.draft_body),(0,B.route)((0,j.ANx)(e,t))}).catch(e=>{alert((0,Y.zx)(e))}).finally(()=>Z(!1))}},restoreVersion:D,restoring:y,versions:a}},Cj=e=>{let{group:t,versions:i,showHeader:n,draftContentId:r,activeVersionId:o,loadVersion:a,loadLocalVersion:l,publishedVersionId:s}=e;return(0,Z.BX)(w.Fragment,{children:[n&&(0,Z.tZ)("div",{className:"group-header",children:t}),i.map(e=>e.local?(0,Z.tZ)(CJ,{version:e,onClick:()=>l(e),isActive:e.draft_updated_at&&e.draft_updated_at===o}):(0,Z.tZ)(CV,{version:e,isSavedDraft:e.Key&&e.Key===r,onClick:()=>a(e.Key),isActive:e.Key&&e.Key===o,isPublishedVersion:e.Key&&e.Key===s}))]})},CJ=e=>{let{onClick:t,version:i,isActive:n}=e,{iString:r,language:o}=(0,Q.M1)();return(0,Z.BX)("div",{className:k()("version-row",{active:n}),id:i.draft_updated_at,onClick:t,children:[(0,Z.BX)("div",{className:"version-row-top",children:[(0,Z.tZ)("div",{className:"version-main",children:i.calendar}),(0,Z.tZ)(h6,{content:r("This draft failed to save, and exists only on your computer. To upload this version to Substack, click the 'Restore draft' button in the upper-right of the page."),children:(0,Z.tZ)("div",{className:"version-tag local",children:r("Offline Draft")})})]}),(0,Z.tZ)("div",{className:"version-detail",children:CW(i,o)})]})},CV=e=>{let{version:t,isSavedDraft:i,onClick:n,isActive:r,isPublishedVersion:o}=e,{iString:a,language:l}=(0,Q.M1)();return(0,Z.BX)("div",{className:k()("version-row",{active:r}),id:t.ETag,onClick:n,children:[(0,Z.BX)("div",{className:"version-row-top",children:[(0,Z.tZ)("div",{className:"version-main",children:t.calendar}),i?(0,Z.tZ)("div",{className:"version-tag",children:a("Latest")}):o?(0,Z.tZ)("div",{className:"version-tag",children:a("Published")}):null]}),(0,Z.BX)(et.tu,{children:[(0,Z.tZ)("div",{className:"version-detail",children:CW(t,l)}),(0,Z.tZ)("div",{className:"version-detail",children:(0,Z.BX)(et.gq,{alignItems:"center",gap:6,children:[t.color&&(0,Z.tZ)("span",{className:"version-color",style:{backgroundColor:t.color}}),t.user&&(0,Z.BX)("div",{children:[!t.color&&"By ",t.user.name]})]})})]})]})},Cq=e=>{var t,i;let{pub:n,post:r,versionContent:o}=e,a=(0,eo.toHtml)(o,!1,{postId:null!==(t=null==r?void 0:r.id)&&void 0!==t?t:null,pubId:null!==(i=null==n?void 0:n.id)&&void 0!==i?i:null});return(0,Z.tZ)("div",{className:"container",children:(0,Z.tZ)("div",{className:"post typography",children:(0,Z.tZ)(CF.Z,{html:a,post:r,pub:n,isVersionView:!0,skipTrackClick:!0})})})},CW=(e,t)=>e.asDayjs.locale(t).format("h:mm a z D MMM YYYY"),CG=(e,t)=>{var i;let n=(0,H.Z)(),r=e.day()<n.day()&&n.date()-e.date()<7,{iString:o}=I18N.i(t),[a,l,s]=null!==(i=e.locale(t).calendar(null,{nextDay:"[tomorrow] ".concat(o("[Tomorrow at] h:mm A")),nextWeek:"[next_week] ".concat(o("dddd [at] h:mm A")),lastDay:"[from_yesterday] ".concat(o("[Yesterday at] h:mm A")),lastWeek:r?"[from_this_week] ".concat(o("dddd [at] h:mm A")):"[from_last_week] ".concat(o("[Last] dddd [at] h:mm A")),sameElse:"[older_versions] MM/DD/YYYY",sameDay:"[from_today] h:mm A [".concat(o("Today"),"]")}).match(/^([\w_]+) (.*)/))&&void 0!==i?i:[];return{calendar:s,group:l}},CK=e=>({next_week:0,tomorrow:1,from_today:2,from_yesterday:3,from_this_week:4,from_last_week:5,older_versions:6})[e],CQ="agreementLink-ULEOEB";function C$(e){let{user:t}=e,{iString:i}=(0,Q.M1)(),n=(0,eq.Ij)(),{refetch:r,isLoading:o}=(0,iS.ib)({pathname:"/api/v1/user/accept_publisher_agreement",method:"post",auto:!1,json:{email:t.email}}),a=async()=>{await r(),location.reload()};return(0,A.d4)(()=>{var e;n&&(0,U.j)(U.FP.PUBLISHER_AGREEMENT_CRM_WALL_SHOWN,{is_personal_publication:null!==(e=n.is_personal_mode)&&void 0!==e&&e})},[n]),(0,Z.tZ)(et.hs,{width:"100%",justifyContent:"center",alignItems:"center",padding:20,children:(0,Z.BX)(et.tu,{className:"barrierContainer-Z8MJjr",alignItems:"center",gap:24,children:[(0,Z.tZ)(et.hs,{className:"logoContainer-reTJGg",radius:"full",alignItems:"center",justifyContent:"center",width:64,height:64,children:(0,Z.tZ)(ZG.Z,{color:"#FFFFFF",width:28,height:28})}),(0,Z.tZ)(ei.xv.H2,{textAlign:"center",translated:!0,children:"Ready to start publishing?"}),(0,Z.BX)(ei.xv.B2,{translated:!0,textAlign:"center",children:["To access all of Substackâ€™s advanced features, including the publisher dashboard, you must first agree to the"," ",(0,Z.tZ)("a",{class:CQ,href:(0,en.f3V)(),target:"_blank",rel:"noopener",children:"publisher agreement"})," ","and"," ",(0,Z.tZ)("a",{class:CQ,href:(0,en.Am1)(),target:"_blank",rel:"noopener",children:"privacy policy"})]}),(0,Z.BX)(et.tu,{className:"buttonContainer-nYBG8v",gap:12,children:[(0,Z.tZ)(ee.zx,{onClick:a,disabled:o,children:i("I agree")}),(0,Z.tZ)(ee.zx,{href:n?(0,en.SVA)(n):(0,en.NNq)(t),priority:"secondary",disabled:o,children:i("Go back")})]})]})})}var C0=i(58017);let C1={comboboxOption:"comboboxOption-Jc7LFA",comboboxOptions:"comboboxOptions-qWg7Gq"},C2=e=>{let{recommendingPub:t,setResult:i,selectedResult:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(""),[l,s]=(0,A.eJ)(!1),[d,c]=(0,A.eJ)([]),[u,p]=(0,A.eJ)(!1),h=(0,A.sO)(null);(0,A.d4)(()=>{n&&!u&&a(n.name)},[n,u]);let m=e=>{let t=e.target.value,n=t.trim();a(t),n||i(null),g(n),p(!1)},g=ip()(async e=>{if(!e){c([]);return}s(!0);try{var i;let n=await N().get("/api/v1/publication/search").query({query:e,prefix:!0,page:0}),r=null===(i=n.body.results)||void 0===i?void 0:i.filter(e=>{let{id:i}=e;return i!==t.id});c(r||[])}catch(e){console.error("Error fetching publications:",e),c([])}finally{s(!1)}},300);return(0,Z.tZ)(et.sg,{position:"relative",children:(0,Z.BX)(C0.h,{value:n,onChange:i,nullable:!0,children:[(0,Z.BX)(et.X2,{alignItems:"center",children:[(0,Z.tZ)(C0.h.Button,{className:(0,sr.oB)({display:"none"}),ref:h}),(0,Z.tZ)(C0.h.Input,{type:"search",className:k()(m1.Z.input,m1.Z.inputText),placeholder:r("Search for a person or publication..."),value:o,onChange:e=>{p(!0),m(e)},onFocus:()=>{var e;return null===(e=h.current)||void 0===e?void 0:e.click()}})]}),(0,Z.tZ)(C0.h.Options,{className:k()((0,sr.oB)({display:"flex",direction:"column",margin:0,padding:4,maxHeight:480,radius:"md",border:"detail",overflowY:"auto",position:"absolute",bg:"primary",shadow:"lg"}),C1.comboboxOptions),children:l?(0,Z.tZ)(et.M5,{flex:"grow",minHeight:220,children:(0,Z.tZ)(iI.$j,{})}):0===d.length?(0,Z.tZ)(et.M5,{flex:"grow",minHeight:220,children:(0,Z.tZ)(tp._Y,{title:r("No results"),text:r("Please try a different search")})}):d.map(e=>(0,Z.tZ)(C0.h.Option,{value:e,as:w.Fragment,children:t=>{let{active:i}=t;return(0,Z.BX)(et.X2,{alignItems:"center",padding:8,gap:12,cursor:"pointer",bg:i?"secondary":"unset",radius:"sm",className:C1.comboboxOption,children:[(0,Z.tZ)(sC.wk,{pub:e,size:32}),(0,Z.BX)(et.sg,{flex:"grow",minWidth:0,children:[(0,Z.tZ)(ei.xv.B4,{color:"primary",weight:"semibold",children:e.name}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:(0,j.FoX)(e)})]})]})}},e.id))})]})})},C4="modalBody-MZ5IIW";function C3(){let e=(0,G._)(["Please enter a reason less than "," characters"]);return C3=function(){return e},e}let C8=e=>{let{isOpen:t,onClose:i,recommendingPub:n,updateList:r,initialPage:o,setLoading:a}=e,{popToast:l}=(0,iN.pm)(),{iString:s,iTemplate:d}=(0,Q.M1)(),[c,u]=(0,A.eJ)(null),[p,h]=(0,A.eJ)(""),[m,g]=(0,A.eJ)(!1),v=()=>{u(null),h(""),g(!1)},b=async e=>{try{if(e){let t=await N().get("/api/v1/recommendations/from/".concat(n.id,"/to/").concat(e.id));t.body.description&&(h(t.body.description),g(!0))}}catch(e){h(""),g(!1)}u(e)},y=async()=>{if(c)try{await N().put("/api/v1/recommendations").send((0,f._)({recommended_publication_id:c.id,recommending_publication_id:n.id,source:"recommendation-stats",suggested:!1},!!p&&{description:p.length>=2?p:null})),l(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:s("Recommendation added")}))),a(!0),r(!(null==o?void 0:o.total)),v(),i()}catch(e){console.error("Failed to add recommendation:",e),l(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:s("Unable to add recommendation")})))}},w=((null==p?void 0:p.length)||0)>500;return(0,Z.tZ)(eK.u_,{isOpen:t,onClose:i,children:(0,Z.BX)(tU.w,{children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:i,showDivider:!0,title:s("Add recommendation")}),(0,Z.tZ)(eK.fe,{className:C4,children:(0,Z.BX)(et.tu,{gap:20,children:[(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.OV,{hint:s("Required"),children:s("Substack to recommend")}),(0,Z.tZ)(C2,{recommendingPub:n,setResult:b,selectedResult:c})]}),(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{children:s("Reason for recommending")}),(0,Z.tZ)(bv.g,(0,f._)({placeholder:s("Tell your subscribers why they'll love this Substack"),onInput:e=>h(e.currentTarget.value),value:p},tJ.J)),w&&(0,Z.tZ)(tM.y,{children:d(C3(),500)})]})]})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{disabled:w,onClick:y,children:m?s("Update recommendation"):s("Add recommendation")})})]})})};var C6=i(39276);function C5(){let e=(0,G._)(["Please enter a reason less than "," characters"]);return C5=function(){return e},e}function C9(){let e=(0,G._)(["By ",""]);return C9=function(){return e},e}let C7=e=>{let{isOpen:t,onClose:i,recommendingPub:n,pubToRecommend:r,updateList:o,initialPage:a,setLoading:l}=e,{popToast:s}=(0,iN.pm)(),{iString:d,iTemplate:c}=(0,Q.M1)(),[u,p]=(0,A.eJ)(""),h=()=>{p("")},m=async()=>{try{await N().put("/api/v1/recommendations").send((0,f._)({recommended_publication_id:null==r?void 0:r.id,recommending_publication_id:n.id,source:"recommendation-stats",suggested:!1},!!u&&{description:u.length>=2?u:null})),s(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:d("Recommendation added")}))),l&&l(!0),o(!(null==a?void 0:a.total)),h(),i()}catch(e){console.error("Failed to add recommendation:",e),s(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:d("Unable to add recommendation")})))}},g=((null==u?void 0:u.length)||0)>500;return(0,Z.tZ)(eK.u_,{isOpen:t,onClose:i,children:(0,Z.BX)(tU.w,{children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:i,showDivider:!0,title:d("Recommend back")}),(0,Z.tZ)(eK.fe,{className:C4,children:(0,Z.BX)(et.tu,{gap:20,children:[(0,Z.tZ)(xe,{pub:r}),(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{children:d("Reason for recommending")}),(0,Z.tZ)(bv.g,(0,f._)({placeholder:d("Tell your subscribers why they'll love this Substack"),onInput:e=>p(e.currentTarget.value),value:u},tJ.J)),g&&(0,Z.tZ)(tM.y,{children:c(C5(),500)})]})]})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{disabled:g,onClick:m,children:d("Recommend back")})})]})})},xe=e=>{let{pub:t}=e,{iString:i,iTemplate:n}=(0,Q.M1)();return t?(0,Z.tZ)(C6.A,{href:t.base_url,rel:"noopener noreferrer",target:"_blank",children:(0,Z.BX)(s6.Z,{padding:12,gap:12,alignItems:"center",direction:"row",bg:"primary-hover",cursor:"pointer",children:[(0,Z.tZ)(sC.wk,{pub:t,size:48,outline:"detail"}),(0,Z.BX)(et.sg,{flex:"grow",gap:2,children:[(0,Z.tZ)(ei.xv.B3,{weight:"medium",children:t.name}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",clamp:2,children:n(C9(),t.author_name)})]})]})}):(0,Z.tZ)(ei.xv,{children:i("Publication")})};function xt(){let e=(0,G._)(["Please enter a reason less than "," characters"]);return xt=function(){return e},e}let xi=e=>{let{isOpen:t,onClose:i,recommendingPub:n,pubToEdit:r,updateList:o,initialPage:a,setLoading:l}=e,{popToast:s}=(0,iN.pm)(),{iString:d,iTemplate:c}=(0,Q.M1)(),[u,p]=(0,A.eJ)(""),h=()=>{p("")},m=async()=>{try{if(r){let e=await N().get("/api/v1/recommendations/from/".concat(n.id,"/to/").concat(r.id));e.body.description&&p(e.body.description)}}catch(e){p("")}};(0,A.d4)(()=>{m()},[r,t]);let g=async()=>{try{await N().put("/api/v1/recommendations").send((0,f._)({recommended_publication_id:null==r?void 0:r.id,recommending_publication_id:n.id,source:"recommendation-stats",suggested:!1},!!u&&{description:u.length>=2?u:null})),s(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:d("Recommendation edited")}))),l&&l(!0),o(!(null==a?void 0:a.total)),h(),i()}catch(e){console.error("Failed to edit recommendation:",e),s(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:d("Unable to edit recommendation")})))}},v=((null==u?void 0:u.length)||0)>500;return(0,Z.tZ)(eK.u_,{isOpen:t,onClose:i,children:(0,Z.BX)(tU.w,{children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:i,showDivider:!0,title:d("Edit recommendation")}),(0,Z.tZ)(eK.fe,{className:C4,children:(0,Z.BX)(et.tu,{gap:20,children:[(0,Z.tZ)(xe,{pub:r}),(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{children:d("Reason for recommending")}),(0,Z.tZ)(bv.g,(0,f._)({placeholder:d("Tell your subscribers why they'll love this Substack"),onInput:e=>p(e.currentTarget.value),value:u},tJ.J)),v&&(0,Z.tZ)(tM.y,{children:c(xt(),500)})]})]})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{disabled:v,onClick:g,children:d("Save")})})]})})},xn=e=>{let{refetchToggle:t,handleRemoveRecommendation:i,handleEditRecommendation:n}=e,{iString:r}=(0,Q.M1)(),o=[{key:"publication_id",name:r("Substack"),sortable:!0,valueFn:e=>(0,Z.tZ)(xr,{pub:e.target_pub}),compact:!0},{key:"xp_signups",name:r("Subs sent"),sortable:!0,valueFn:e=>(0,Z.tZ)(xa,{children:(0,er.numberToString)(e.xp_signups)}),compact:!0},{key:"is_active",name:r("Status"),sortable:!0,valueFn:e=>(0,Z.tZ)(xo,{isActive:e.is_active}),compact:!0},{key:"cta",name:"",sortable:!1,align:"right",valueFn:e=>(0,Z.tZ)(xl,{pub:e.target_pub,handleRemoveRecommendation:i,handleEditRecommendation:n}),compact:!0}];return(0,Z.tZ)(d6,{title:r("Outgoing recommendations"),subtitle:r("Substacks that you recommend"),children:(0,Z.tZ)(ps,{url:"/api/v1/recommendations/stats/from",pageSize:10,appendMode:!1,cols:o,deps:[t],defaultSort:{by:"xp_signups",direction:u8.Desc}})})},xr=e=>{let{pub:t}=e;return(0,Z.BX)(et.X2,{gap:12,alignItems:"center",children:[(0,Z.tZ)(sC.jM,{pub:t,size:32,openInNewTab:!0}),(0,Z.tZ)(ei.hh,{decoration:"hover-underline",href:(0,j.SVA)(t),target:"_blank",rel:"noopener noreferrer",children:(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"primary",children:t.name})})]})},xo=e=>{let{isActive:t}=e,{iString:i}=(0,Q.M1)();return t?(0,Z.tZ)(d_.Vp,{theme:"success",priority:"secondary",children:i("Active")}):(0,Z.tZ)(d_.Vp,{theme:"default",priority:"secondary",children:i("Inactive")})},xa=e=>{let{children:t}=e;return(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"primary",children:t})},xl=e=>{let{pub:t,handleRemoveRecommendation:i,handleEditRecommendation:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{size:"sm",priority:"quaternary",children:(0,Z.tZ)(pu.Z,{size:20})}),children:[(0,Z.BX)(tC.xw,{isFirst:!0,children:[(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(gB.Z,{}),href:(0,j.SVA)(t),target:"_blank",rel:"noopener noreferrer",children:r("View publication")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(nX.Z,{}),onClick:()=>n(t),children:r("Edit")})]}),(0,Z.tZ)(tC.xw,{children:(0,Z.tZ)(tC.sN,{priority:"destructive",leading:(0,Z.tZ)(iW.Z,{}),onClick:()=>i(t),children:r("Remove")})})]})},xs=e=>{let{refetchToggle:t,handleRecommendBack:i}=e,{iString:n}=(0,Q.M1)(),r=[{key:"target_publication_id",name:n("Substack"),sortable:!0,valueFn:e=>(0,Z.tZ)(xr,{pub:e.source_pub}),compact:!0},{key:"xp_signups",name:n("Subs received"),sortable:!0,valueFn:e=>(0,Z.tZ)(xa,{children:(0,er.numberToString)(e.xp_signups)}),compact:!0},{key:"is_active",name:n("Status"),sortable:!0,valueFn:e=>(0,Z.tZ)(xo,{isActive:e.is_active}),compact:!0},{key:"is_mutual",name:"",sortable:!1,align:"right",valueFn:e=>(0,Z.tZ)(xd,{pub:e.source_pub,isMutual:e.is_mutual,handleRecommendBack:i}),compact:!0}];return(0,Z.tZ)(d6,{title:n("Incoming recommendations"),subtitle:n("Substacks that recommend you"),children:(0,Z.tZ)(ps,{url:"/api/v1/recommendations/stats/to",pageSize:10,appendMode:!1,cols:r,deps:[t],defaultSort:{by:"xp_signups",direction:u8.Desc}})})},xd=e=>{let{pub:t,isMutual:i,handleRecommendBack:n}=e,{iString:r}=(0,Q.M1)();return i?(0,Z.tZ)(ee.zx,{size:"sm",priority:"tertiary",disabled:!0,leading:(0,Z.tZ)(eE.Z,{size:18}),children:r("Recommended")}):(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary-accent",onClick:()=>n(t),children:r("Recommend back")})};var xc=i(37313);let xu=e=>{let{setIsAddModalOpen:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.BX)(sh,{children:[(0,Z.tZ)(sx.M5,{children:(0,Z.tZ)(iZ.e,{src:"/img/publish/empty-recommend.png",maxWidth:120,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,Z.BX)(et.sg,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{color:"primary",children:i("Recommend other Substacks")}),(0,Z.BX)(ei.xv.B4,{color:"secondary",children:[i("Help your subscribers find other great Substacks by recommending your favorites. "),(0,Z.tZ)(ei.hh,{decoration:"underline",href:"https://support.substack.com/hc/en-us/articles/5036794583828-How-can-I-recommend-other-publications-on-Substack-",onClick:()=>{(0,U.j)(xc.F.MANAGE_RECOMMENDATIONS_LEARN_MORE_CLICKED,{source:"recommendation-stats"})},children:i("Learn more")})]})]}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{t(!0)},children:i("Add recommendation")})]})};function xp(){let e=(0,G._)(["By ",""]);return xp=function(){return e},e}let xh=e=>{let{suggested:t,pub:i,updateList:n,setHasRecommendedSuggestion:r}=e,{iString:o}=(0,Q.M1)();return(0,Z.tZ)(d6,{title:o("Suggested"),subtitle:o("Substacks you might want to recommend"),children:(0,Z.tZ)(s6.Z,{padding:8,gap:8,flex:"grow",children:(0,Z.tZ)(xm,{suggested:t,pub:i,updateList:n,setHasRecommendedSuggestion:r,max:10})})})},xm=e=>{let{suggested:t,pub:i,updateList:n,setHasRecommendedSuggestion:r,max:o}=e,{iString:a,iTemplate:l}=(0,Q.M1)(),{popToast:s}=(0,iN.pm)(),d=async e=>{try{await N().put("/api/v1/recommendations").send({recommended_publication_id:e.id,recommending_publication_id:i.id,source:"recommendation-stats",suggested:!0}),s(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:a("Recommendation added")})))}catch(e){console.error(e)}n(),r(!0)};return(0,Z.tZ)(Z.HY,{children:t.slice(0,o).map(e=>(0,Z.BX)(xg,{children:[(0,Z.tZ)(sC.wk,{pub:e,size:32}),(0,Z.BX)(et.sg,{flex:"grow",children:[(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"primary",ellipsis:!0,children:(0,Z.tZ)(ei.hh,{href:(0,j.SVA)(e),target:"_blank",rel:"noopener noreferrer",children:e.name})}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:l(xp(),e.author_name)})]}),(0,Z.tZ)(ee.zx,{priority:"secondary-accent",size:"sm",onClick:()=>d(e),disabled:e.invite_only,title:e.invite_only?"This publication is invite only and cannot be recommended":"",children:a("Recommend")})]},e.id))})},xg=(0,ts.zo)({display:"flex",padding:8,gap:12,justifyContent:"space-between",alignItems:"center",minWidth:0}),xv=e=>{let{isAddModalOpen:t,setIsAddModalOpen:i,suggested:n,pub:r,updateList:o,setHasRecommendedSuggestion:a,initialPage:l,setLoading:s,totalPubsRecommending:d}=e;return(0,Z.BX)(tU.w,{children:[(0,Z.BX)(xy,{children:[(0,Z.tZ)(xu,{setIsAddModalOpen:i}),n&&(0,Z.tZ)(xb,{suggested:n,pub:r,updateList:o,setHasRecommendedSuggestion:a})]}),(0,Z.tZ)(C8,{isOpen:t,onClose:()=>i(!1),recommendingPub:r,updateList:o,initialPage:l||{total:d},setLoading:s})]})},xb=e=>{let{suggested:t,pub:i,updateList:n,setHasRecommendedSuggestion:r}=e,{iString:o}=(0,Q.M1)();return(0,Z.BX)(et.sg,{gap:12,style:{width:"100%"},maxWidth:480,children:[(0,Z.tZ)(ei.xv.Meta,{flex:"grow",textAlign:"center",children:o("Suggested")}),(0,Z.tZ)(s6.Z,{padding:8,gap:8,flex:"grow",children:(0,Z.tZ)(xm,{suggested:t,pub:i,updateList:n,setHasRecommendedSuggestion:r,max:3})})]})},xy=(0,ts.zo)({flex:"grow",display:"flex",direction:"column",justifyContent:"center",alignItems:"center",padding:20,gap:32,bg:"primary-hover"}),xf=e=>{let{isOpen:t,onClose:i,onDeleteAll:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(dj.W,{title:r("Remove all recommendations"),description:r("Are you sure you want to remove all outgoing recommendations? This action cannot be undone."),isOpen:t,onClose:i,primaryButton:(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:()=>{n(),i()},children:r("Remove all")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:i,children:r("Cancel")})})},x_=e=>{let{pub:t,updateList:i}=e,{iString:n}=(0,Q.M1)(),{popToast:r}=(0,iN.pm)(),[o,a]=(0,A.eJ)(!1),l=async()=>{try{await N().delete("/api/v1/recommendations/all").send({recommending_publication_id:t.id,source:"publisher_dashboard"}),await i(!0),r(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:n("Recommendations deleted")})))}catch(e){console.error("Failed to remove all recommendations:",e),r(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:n("Unable to delete recommendations")})))}};return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{priority:"secondary",children:(0,Z.tZ)(pu.Z,{size:20})}),children:[(0,Z.BX)(tC.xw,{isFirst:!0,children:[(0,Z.tZ)(tC.sN,{href:"https://support.substack.com/hc/en-us/articles/5036794583828-How-can-I-recommend-other-publications-on-Substack-",onClick:()=>{(0,U.j)(U.FP.MANAGE_RECOMMENDATIONS_LEARN_MORE_CLICKED)},leading:(0,Z.tZ)(eR.Z,{}),children:n("About")}),(0,Z.tZ)(tC.sN,{onClick:()=>{(0,U.j)(U.FP.RECOMMENDATIONS_INVITE_WRITER_CLICKED),(0,Y.uX)("".concat((0,j.ZJn)(),"/referral"))},leading:(0,Z.tZ)(sa.Z,{}),children:n("Refer a creator")})]}),(0,Z.tZ)(tC.xw,{children:(0,Z.tZ)(tC.sN,{priority:"destructive",onClick:()=>a(!0),leading:(0,Z.tZ)(iW.Z,{}),children:n("Delete all")})})]}),(0,Z.tZ)(xf,{isOpen:o,onClose:()=>a(!1),onDeleteAll:l})]})};class xZ extends w.Component{propToValue(e){return this.props.propToValue&&(e=this.props.propToValue(e)),e}valueToProp(e){return this.props.valueToProp&&(e=this.props.valueToProp(e)),e}async onChange(){let e=this.state.value,t=!0;if(this.props.setToTrueWarning&&!0!==e?t="string"==typeof this.props.setToTrueWarning?window.confirm(this.props.setToTrueWarning):await this.props.setToTrueWarning():this.props.setToFalseWarning&&!1!==e&&(t="string"==typeof this.props.setToFalseWarning?window.confirm(this.props.setToFalseWarning):await this.props.setToFalseWarning()),!t){this.setState({value:e});return}this.setState({value:!e});try{this.props.onChange?await this.props.onChange(this.props.field,this.valueToProp(!e)):await N().put(this.props.endpoint||"/api/v1/publication").send({[this.props.field]:this.valueToProp(!e)}),this.props.onSuccess?this.props.onSuccess(this.valueToProp(!e)):window.location.reload()}catch(t){this.setState({value:e}),console.error(t),alert("Network error!")}}render(e,t){let{inverted:i,checkbox:n,disabled:r}=e,{value:o}=t;return n?(0,Z.tZ)(iB.X,{checked:i?!o:o,onChange:()=>this.onChange(),disabled:r}):(0,Z.tZ)(i2.ZP,{checked:i?!o:o,onChange:()=>this.onChange(),"data-testid":this.props.testID,disabled:r})}constructor(e,t){super(e,t),this.state={value:this.propToValue(e.publication[e.field])}}}function xw(e){return(0,Z.BX)(et.tu,{gap:8,id:e.id,children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:e.title,secondaryText:e.subtitle}),(0,Z.tZ)(xZ,(0,f._)({},e))]}),e.children]})}let xC=e=>{let{pub:t,includeRecsInDigest:i,setIncludeRecsInDigest:n,showRecsOnHomepage:r,setShowRecsOnHomepage:o}=e,{iString:a}=(0,Q.M1)();return(0,Z.tZ)(d6,{title:a("Settings"),children:(0,Z.BX)(s6.Z,{padding:20,gap:20,flex:"grow",children:[(0,Z.tZ)(xw,{title:a("Include in recommendation digests"),subtitle:a("Sends your recommendations to subscribers via occasional emails."),publication:{include_recs_in_digest:i},endpoint:"/api/v1/publication_settings",field:"include_recs_in_digest",onSuccess:e=>n(e)}),"profile"!==t.homepage_type&&(0,Z.tZ)(xw,{title:a("Show recommendations on homepage"),subtitle:a("Shows the Substacks you recommend in the sidebar of your website."),publication:{show_recs_on_homepage:r},endpoint:"/api/v1/publication",field:"show_recs_on_homepage",onSuccess:e=>o(e)}),"profile"!==t.homepage_type&&(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:a("Manage recommendation blurbs"),secondaryText:a("Control which recommendation blurbs appear on your welcome page")}),(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary",href:(0,j.An$)(t),children:a("Manage")})]})]})})},xx=e=>{let{totalSignups:t,totalPubsRecommending:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)(dc,{children:[(0,Z.tZ)(ml,{title:n("Subscribers from recommendations"),value:t,format:"number"}),(0,Z.tZ)(ml,{title:n("Substacks recommending you"),value:i,format:"number"})]})};function xS(){let e=(0,G._)(["Remove recommendation for ","?"]);return xS=function(){return e},e}let xk=e=>{var t;let{isOpen:i,onClose:n,pub:r,pubToRemove:o,setLoading:a}=e,{iString:l,iTemplate:s}=(0,Q.M1)(),{popToast:d}=(0,iN.pm)(),c=async()=>{try{await N().delete("/api/v1/recommendations/").send({recommended_publication_id:null==o?void 0:o.id,recommending_publication_id:r.id,source:"recommendation-stats"}),a(!0),n(),d(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:l("Recommendation removed")})))}catch(e){console.error("Failed to remove recommendation:",e),d(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:l("Unable to remove recommendation")})))}};return(0,Z.tZ)(dj.W,{isOpen:i,onClose:n,title:s(xS(),null!==(t=null==o?void 0:o.name)&&void 0!==t?t:"this Substack"),description:l("If you change your mind, you can always recommend this Substack again."),primaryButton:(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:c,children:l("Remove")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:n,children:l("Cancel")})})},xB=e=>{let{pub:t}=e,[i,n]=(0,A.eJ)(!0),[r,o]=(0,A.eJ)(null),[a,l]=(0,A.eJ)(null),[s,d]=(0,A.eJ)(0),[c,u]=(0,A.eJ)(0),[p,h]=(0,A.eJ)(!1),[m,g]=(0,A.eJ)(!1),[v,b]=(0,A.eJ)(!1),[y,f]=(0,A.eJ)(null),[_,w]=(0,A.eJ)(!1),[C,x]=(0,A.eJ)(!1),[S,k]=(0,A.eJ)(null),[B,T]=(0,A.eJ)(!1),[I,P]=(0,A.eJ)(null),[E,X]=(0,A.eJ)([]),[M,D]=(0,A.eJ)(!1),[R,F]=(0,A.eJ)(!1),[L,z]=(0,A.eJ)(null),{iString:O}=(0,Q.M1)(),U=(0,pY.XA)(),Y=(0,A.I4)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if(e){let e=await N().get("/api/v1/recommendations/from/".concat(t.id)).query({offset:0,limit:50,paginate:!0});f(e.body)}else w(e=>!e);let{recommendingOthers:i,beingRecommended:r,totalSignups:a}=(await N().get("/api/v1/recommendations/exist")).body,s=await N().get("/api/v1/recommendations/".concat(t.id,"/suggested"));X(s.body),o(!!i),l(!!r),d(a),u(r),n(!1)}catch(e){console.error(e),n(!1)}},[t]);(0,A.d4)(()=>{!async function(){if(!r||!a||i)try{let{recommendingOthers:e,beingRecommended:t,totalSignups:i}=(await N().get("/api/v1/recommendations/exist")).body;o(!!e),l(!!t),d(i),u(t);let r=await N().get("/api/v1/publication_settings");h(r.body.include_recs_in_digest);let a=await N().get("/api/v1/publication");g(a.body.show_recs_on_homepage),await Y(!0),n(!1)}catch(e){console.error("Failed to load recommendation stats: ",e),n(!1)}}()},[i,r,a,s,c,t,Y]);let H=r||a;return i?(0,Z.tZ)(et.M5,{flex:"grow",padding:64,children:(0,Z.tZ)(iI.$j,{})}):H?(0,Z.tZ)(tU.w,{children:(0,Z.tZ)("div",{className:"page typography",id:"recommendation-stats",children:(0,Z.BX)(dt,{children:[(0,Z.BX)(et.sg,{gap:32,children:[(0,Z.BX)(et.sg,{gap:20,children:[(0,Z.tZ)(di,{title:O("Recommendations"),cta:(0,Z.BX)(et.X2,{gap:8,children:[(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>b(!0),children:O(U?"Add":"Add recommendation")}),(0,Z.tZ)(x_,{pub:t,updateList:Y})]})}),a&&(0,Z.tZ)(xx,{totalSignups:s,totalPubsRecommending:c})]}),a&&(0,Z.tZ)(xs,{refetchToggle:_,handleRecommendBack:e=>{k(e),x(!0)}}),r&&(0,Z.tZ)(xn,{refetchToggle:_,handleRemoveRecommendation:e=>{P(e),T(!0)},handleEditRecommendation:e=>{z(e),F(!0)}}),((null==E?void 0:E.length)||M)&&(0,Z.tZ)(xh,{suggested:E,pub:t,updateList:Y,setHasRecommendedSuggestion:D}),(0,Z.tZ)(xC,{pub:t,includeRecsInDigest:p,setIncludeRecsInDigest:h,showRecsOnHomepage:m,setShowRecsOnHomepage:g}),(0,Z.tZ)(C8,{isOpen:v,onClose:()=>b(!1),recommendingPub:t,updateList:Y,initialPage:y||{total:c},setLoading:n}),(0,Z.tZ)(C7,{isOpen:C,onClose:()=>x(!1),recommendingPub:t,pubToRecommend:S,updateList:Y,initialPage:y||{total:c},setLoading:n}),(0,Z.tZ)(xk,{isOpen:B,onClose:()=>T(!1),pub:t,pubToRemove:I,setLoading:n}),(0,Z.tZ)(xi,{isOpen:R,onClose:()=>F(!1),recommendingPub:t,pubToEdit:L,updateList:Y,initialPage:y||{total:c},setLoading:n})]}),(0,Z.tZ)(yH.ZP,{})]})})}):(0,Z.tZ)(xv,{pub:t,suggested:E,updateList:Y,setHasRecommendedSuggestion:D,initialPage:y||{total:c},totalPubsRecommending:c,setLoading:n,isAddModalOpen:v,setIsAddModalOpen:b})};var xT=i(22166);let xI=eb(e=>{let{onContinue:t,pub:i}=e,{iString:n}=(0,Q.M1)(),[r,o]=(0,A.eJ)(!0);return(0,Z.BX)("div",{id:"add-modal-content",className:"disable-custom-domain-modal-container",children:[(0,Z.tZ)("h2",{children:n("Disable Custom Domain")}),(0,Z.tZ)("p",{children:n("If you disable your custom domain, your publication will revert to being hosted at %1.substack.com.",i.subdomain)}),(0,Z.tZ)("p",{children:n("This might result in a few minutes of downtime and all links to that custom domain will stop working.")}),(0,Z.tZ)(ic.p,{name:"disable-domain-checkbox",label:n("Are you sure you wish to continue?"),checked:!r,onChange:()=>o(!r)}),(0,Z.tZ)("div",{className:"button-container",children:(0,Z.tZ)(ee.zx,{priority:"destructive",disabled:r,onClick:t,children:n("Disable Custom Domain")})})]})}),xN=eb(e=>{var t;let{onContinue:i,pub:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(!0);return(0,Z.BX)("div",{id:"add-modal-content",className:"disable-custom-domain-modal-container",children:[(0,Z.tZ)("h2",{children:r("Disable Root Domain Redirects")}),(0,Z.tZ)("p",{children:r("If you disable root domain redirects, links to https://%1 will stop working.",null!==(t=n.apex_domain)&&void 0!==t?t:"")}),(0,Z.tZ)("p",{children:r("This might result in links that no longer work.")}),(0,Z.tZ)(ic.p,{name:"disable-domain-checkbox",label:r("Are you sure you wish to continue?"),checked:!o,onChange:()=>a(!o)}),(0,Z.tZ)("div",{className:"button-container",children:(0,Z.tZ)(ee.zx,{priority:"destructive",disabled:o,onClick:i,children:r("Disable root domain redirects")})})]})});function xP(){let e=(0,G._)(["Pause until ",""]);return xP=function(){return e},e}function xE(){let e=(0,G._)(["Your subscription billing will resume on ",". You can extend that pause if youâ€™d like."]);return xE=function(){return e},e}function xX(){let e=(0,G._)(["Pause until ",""]);return xX=function(){return e},e}let xM=eb(e=>{let{onFinish:t,onError:i,pub:n}=e,{iString:r,iTemplate:o,language:a}=(0,Q.M1)(),l=new Date;l.setDate(l.getDate()+28);let[s,d]=(0,A.eJ)(!1),[c,u]=(0,A.eJ)((0,H.Z)(l).format("YYYY-MM-DD")),p="paused"===n.payments_state;return(0,Z.BX)("div",{id:"new-pause-modal",children:[!s&&p&&(0,Z.tZ)(xA,{}),s&&p&&(0,Z.tZ)(xD,{}),!s&&!p&&(0,Z.tZ)(xR,{setReturnDate:u,initialDate:c}),s&&!p&&(0,Z.tZ)(xF,{}),(0,Z.BX)(tP.ZP,{method:"put",action:"/api/v1/publication/".concat(p?"unpause":"pause"),onSuccess:()=>d(!0),onError:i,loading:!1,autoLock:!0,prepareData:(e,t)=>{t.target.classList.contains("secondary")?e.returnDate=null:e.returnDate=(0,H.Z)(c).toISOString()},children:[s?(0,Z.tZ)(ee.zx,{priority:"primary",onClick:t,children:r("Close")}):p?(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",children:r("Unpause")}):(0,Z.BX)("div",{className:"submit-pause-buttons",children:[" ",(0,Z.tZ)(ee.zx,{priority:"secondary",type:"submit",onClick:()=>{},children:r("Pause Indefinitely")}),(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",children:o(xP(),(0,H.Z)(c).locale(a).format("YYYY-MM-DD"))})]}),(0,Z.tZ)("div",{id:"error-container"})]})]})}),xA=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.BX)(w.Fragment,{children:[(0,Z.tZ)("h2",{children:e("Unpause Subscription Billing")}),(0,Z.tZ)("p",{children:e("When you unpause, billing will resume for your paid subscribers. For example, if a paid subscriber had 12 days left on their subscription when you paused, they will have 12 days left when you unpause.")})]})},xD=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.BX)(w.Fragment,{children:[(0,Z.tZ)("h2",{children:e("Unpause Request Received")}),(0,Z.tZ)("p",{children:e("Weâ€™re processing your unpause request. This can take several hours, so weâ€™ll email you when itâ€™s all done.")})]})},xR=e=>{let{setReturnDate:t,initialDate:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)(w.Fragment,{children:[(0,Z.tZ)("h2",{children:n("Pause Subscription Billing")}),(0,Z.BX)("p",{children:[n("Pausing will freeze the billing cycle for existing paid subscribers. We recommend you pause no more than three months (pauses for 2-4 weeks are usually not needed).")," ",(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us/articles/360041618252-Can-I-pause-my-publication-",children:n("Learn more")}),"."]}),(0,Z.tZ)("h6",{children:n("Pause Until")}),(0,Z.tZ)(aT.Mt,{min:new Date(new Date().setDate(new Date().getDate()+1)),value:i,onChange:e=>{t(e.currentTarget.value)}})]})},xF=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.BX)(w.Fragment,{children:[(0,Z.tZ)("h2",{children:e("Pause Request Received")}),(0,Z.tZ)("p",{children:e("Weâ€™re processing your pause request. This can take up to an hour, so weâ€™ll email you when itâ€™s all done.")})]})},xL=eb(e=>{let{onFinish:t,onError:i,pub:n}=e,{iString:r,iTemplate:o,language:a}=(0,Q.M1)(),[l,s]=(0,A.eJ)(!1),d=new Date,c=n.pause_return_date?(0,H.Z)(n.pause_return_date):(0,H.Z)(d.setDate(d.getDate()+28)),[u,p]=(0,A.eJ)(c.format("YYYY-MM-DD"));return(0,Z.BX)("div",{id:"new-pause-modal",children:[!l&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("h2",{children:r("Extend subscription billing pause")}),(0,Z.BX)("p",{children:[n.pause_return_date?o(xE(),(0,H.Z)(n.pause_return_date).locale(a).format("MMM D YYYY")):r("Your publication is paused indefinitely. You can set an end date if youâ€™d like.")," ",(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us/articles/360041618252-Can-I-pause-my-publication-",children:r("Learn more")}),"."]}),(0,Z.tZ)("h6",{children:r("Pause Until")}),(0,Z.tZ)(aT.Mt,{min:new Date(new Date().setDate(new Date().getDate()+1)),max:new Date(new Date().setMonth(new Date().getMonth()+3)),value:u,onChange:e=>{p(e.currentTarget.value)}})]}),(0,Z.BX)(tP.ZP,{method:"put",action:"/api/v1/publication/pause/extend",onSuccess:()=>s(!0),onError:i,loading:!1,autoLock:!0,prepareData:e=>{e.returnDate=(0,H.Z)(u).toISOString()},children:[(0,Z.BX)("div",{className:"submit-pause-buttons",children:[" ",(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{t()},children:r("Cancel")}),(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",onClick:()=>t(),children:o(xX(),(0,H.Z)(u).locale(a).format("YYYY-MM-DD"))})]}),(0,Z.tZ)("div",{id:"error-container"})]})]})});function xz(){let e=(0,G._)(["This action cannot be reversed. Are you sure you want to disconnect Stripe, cancel all subscriptions and issue refunds?\n\nTo confirm, type your publication's subdomain (\"",'") below.']);return xz=function(){return e},e}function xO(){let e=(0,G._)(['You typed "','" which did not match "','".']);return xO=function(){return e},e}function xU(){let e=(0,G._)(["Calculating refund.. (started ",")"]);return xU=function(){return e},e}function xY(){let e=(0,G._)(["No subscribers to refund.\nCalculated ",""]);return xY=function(){return e},e}function xH(){let e=(0,G._)(["Calculated ",""]);return xH=function(){return e},e}let xj=eb(e=>{let{onFinish:t,pub:i}=e,{iString:n,iTemplate:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(null),[l,s]=(0,A.eJ)(0),[d,c]=(0,A.eJ)(),[u,p]=(0,A.eJ)(!1),h=(0,A.I4)(()=>{N().get("/api/v1/stripe/calculate_refund").then(e=>{a(e.body),e.body.find(e=>!e.finished_at)&&setTimeout(()=>{s(l+1)},1e3)}).catch(e=>{alert((0,Y.zx)(e)),c(e)})},[l]);(0,A.d4)(()=>{!d&&!(l>=15)&&h()},[l,d,h]);let m=(0,A.I4)(async()=>{let e=(await N().post("/api/v1/stripe/calculate_refund")).body;if(!o){console.error("data not defined, cannot calculate refund");return}o.map(e=>{let{created_at:t}=e;return t}).includes(e.created_at)||a(o.concat(e)),setTimeout(h,1e3)},[o,h]);return(0,A.d4)(()=>{(o&&!o.length||(null==o?void 0:o.length)===1&&o[0]&&(0,H.Z)(o[0].finished_at).isBefore((0,H.Z)().subtract(5,"days")))&&m()},[o,m]),(0,Z.BX)("div",{children:[(0,Z.tZ)("h2",{children:n("Disconnect Stripe, cancel, and refund subscriptions")}),(0,Z.BX)("p",{className:"explainer",children:[n("Going forward with this will:"),(0,Z.BX)("ul",{children:[(0,Z.tZ)("li",{children:n("Refund and notify all your paid subscribers by email")}),(0,Z.tZ)("li",{children:n("Cancel all paid subscriptions to your newsletter")}),(0,Z.tZ)("li",{children:n("Revoke Substackâ€™s access to your Stripe account")})]}),(0,Z.BX)(ei.xv.B3,{as:"span",translated:!0,children:["Please make sure your publication's payments are not paused before disconnecting. If you'd like to disconnect Stripe ",(0,Z.tZ)("b",{children:"without"})," cancelling or refunding subscriptions, please"," ",(0,Z.tZ)("a",{className:"email-with-copy",href:"mailto:support+payments-disconnect@substack.com",children:"contact support"})]})]}),(0,Z.tZ)("hr",{}),(0,Z.tZ)(xJ,{pub:i,data:o}),(0,Z.BX)(et.gq,{justifyContent:"space-between",paddingTop:8,children:[(0,Z.BX)("p",{children:[n("Remove paywall from all posts:")," "]}),(0,Z.tZ)(iB.X,{onChange:()=>p(!u),checked:u})]}),!!(null==o?void 0:o.length)&&(0,Z.tZ)(ee.zx,{priority:"destructive",type:"submit",disabled:!!(null==o?void 0:o.find(e=>{let{finished_at:t}=e;return!t})),onClick:async()=>{let e=prompt(r(xz(),i.subdomain));if(e===i.subdomain)try{await N().delete("/api/v1/stripe/account").send({removePaywall:u}),t()}catch(e){alert((0,Y.zx)(e))}else e&&e.length&&alert(r(xO(),e,i.subdomain))},children:n("Disconnect Stripe, cancel & refund all subscriptions")})]})}),xJ=e=>{var t,i,n,r;let{data:o,pub:a}=e,{iString:l,iTemplate:s,language:d}=(0,Q.M1)();if(!(null==o?void 0:o[0]))return null;let c=null==o?void 0:o.find(e=>{let{finished_at:t}=e;return!t});if(c)return(0,Z.tZ)("p",{className:"calculating-refund",children:s(xU(),(0,H.Z)(c.created_at).locale(d).fromNow())});let u=o[0];return(0,Z.BX)("div",{className:"calculated-refund",children:[(0,Z.BX)("p",{children:[(0,Z.tZ)("b",{children:l("Total to be refunded to readers")})," ",(0,Z.tZ)(h6,{content:s((null===(t=u.refund_amounts)||void 0===t?void 0:t.length)?xH():xY(),(0,H.Z)(u.finished_at).locale(d).fromNow()),portalClass:"calculated-refund__portal",children:(0,Z.tZ)("span",{children:(0,Z.tZ)("b",{children:(null===(i=u.refund_amounts)||void 0===i?void 0:i.map(e=>{let{total:t,currency:i}=e;return(0,er.centsToPriceString)(t,i,{forceDecimals:!0})}).join(" + "))||"".concat((0,er.currencySymbol)((0,er.pubCurrency)(a)),"0")})})})]}),(0,Z.BX)("p",{children:[l("What you will owe")," ",(0,Z.tZ)("span",{children:(null===(n=u.refund_amounts)||void 0===n?void 0:n.map(e=>{let{publisherAmount:t,currency:i}=e;return(0,er.centsToPriceString)(t,i,{forceDecimals:!0})}).join(" + "))||"".concat((0,er.currencySymbol)((0,er.pubCurrency)(a)),"0")})]}),(0,Z.BX)("p",{children:[l("What Substack will owe")," ",(0,Z.tZ)("span",{children:(null===(r=u.refund_amounts)||void 0===r?void 0:r.map(e=>{let{substackAmount:t,currency:i}=e;return(0,er.centsToPriceString)(t,i,{forceDecimals:!0})}).join(" + "))||"".concat((0,er.currencySymbol)((0,er.pubCurrency)(a)),"0")})]})]})};class xV extends L.p{renderChildren(){return this.state.open?(0,Z.tZ)(xj,{onFinish:this.props.onFinish}):null}}function xq(e){let{isOpen:t,onClose:i,onSuccess:n}=e,{iString:r}=(0,Q.M1)(),o=(0,iS.ib)({pathname:"/api/v1/publication_user_invite"}),a=async e=>{e.preventDefault();let t=e.target.email.value,r=await o.refetch({method:"POST",json:{email:t}});r instanceof Error||(n(r),i())};return(0,Z.BX)(eK.u_,{isOpen:t,onClose:i,children:[(0,Z.tZ)(eK.xB,{title:r("Invite a team member"),description:r("Enter an email address to invite a new person to join your team. You can edit their role and visibility after they accept."),showClose:!0,onClose:i,icon:(0,Z.tZ)(mK.AM,{icon:(0,Z.tZ)(uh.Z,{size:20})})}),(0,Z.BX)("form",{onSubmit:a,children:[(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tD.oi,{type:"email",name:"email",placeholder:"email@example.com",autoComplete:"email"}),!!o.error&&(0,Z.tZ)(tM.y,{children:(0,Y.zx)(o.error)})]})}),(0,Z.tZ)(eK.mz,{direction:"column",primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",loading:o.isLoading,children:r("Send invite")})})]})]})}let xW=eb(e=>{let{onError:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)("".concat(new Date().getFullYear()-1,"-01-01")),[o,a]=(0,A.eJ)("".concat(new Date().getFullYear()-1,"-12-31"));return(0,Z.BX)("div",{id:"add-modal-content",children:[(0,Z.tZ)("h2",{children:i("Subscription Invoice Export")}),(0,Z.tZ)("p",{children:i("Request a report detailing all subscription invoices over a period of time. This can be used to help calculate any local taxes that you might owe, such as state sales tax, or VAT.")}),(0,Z.BX)(tP.ZP,{prepareData:e=>{e.startDate=e.startDate?(0,H.Z)(e.startDate).toDate().toString():null,e.endDate=e.endDate?(0,H.Z)(e.endDate).toDate().toString():null},method:"post",action:"/api/v1/document_export/tax_info",onSuccess:e=>{var t;return(0,Y.uX)("/publish/document_exports".concat((null===(t=e.body)||void 0===t?void 0:t.id)?"?id=".concat(e.body.id):""))},onError:t,loading:!1,autoLock:!0,children:[(0,Z.tZ)("input",{type:"date",name:"startDate",onInput:e=>{var t;return r(null===(t=e.target)||void 0===t?void 0:t.value)},value:n}),(0,Z.tZ)("input",{type:"date",name:"endDate",onInput:e=>{var t;return a(null===(t=e.target)||void 0===t?void 0:t.value)},value:o}),(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",children:i("Request report")}),(0,Z.tZ)("div",{id:"error-container"})]})]})}),xG=()=>{window.location.href=(0,j.UA6)("".concat(window.location.pathname,"#podcast-settings"))},xK=eb(e=>{var t;let{pub:i}=e,{iString:n}=(0,Q.M1)(),r=[];if(i.podcast_enabled){let e=(0,co.jU)({pub:i});r.push((0,_._)((0,f._)({},e),{newsletter:{name:i.name},section:null}))}return null===(t=i.sections)||void 0===t||t.filter(e=>e.is_podcast).forEach(e=>{let t=(0,co.d_)({pub:i,section:e});r.push((0,_._)((0,f._)({},t),{newsletter:{name:e.name},section:e}))}),r.length?(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Publication podcasts"),secondaryText:n("Edit your existing publication podcasts or add a new one.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:xG,children:n("Add")})]}),(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{bg:"secondary",children:[(0,Z.tZ)(gK,{style:{width:"var(--size-32)"}}),(0,Z.tZ)(gK,{colSpan:2,children:n("Name")})]})}),(0,Z.tZ)(gq,{children:r.map(e=>(0,Z.tZ)(xQ,{podcastSetting:e,pub:i},e.title))})]})})]}):(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Add a podcast"),secondaryText:n("Bring your newsletter to life with audio notes, read alouds, or full podcast episodes.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:xG,children:n("Add podcast")})]})}),xQ=e=>{let{podcastSetting:t,pub:i}=e,{iString:n}=(0,Q.M1)(),{artUrl:r,title:o,section:a}=t,l=(0,j.UVC)({pub:i,section:a,addBase:!1});return(0,Z.BX)(gG,{children:[(0,Z.tZ)(gQ,{children:r?(0,Z.tZ)(iZ.e,{src:r,maxWidth:32,alt:"".concat(o," artwork"),imageIsFixedWidth:!0,useRetinaSizing:!0,objectFit:"cover",radius:"sm"}):(0,Z.tZ)(et.hs,{width:32,height:32,bg:"secondary",alignItems:"center",justifyContent:"center",radius:"sm",children:(0,Z.tZ)(fz.Z,{size:20,color:"var(--color-fg-secondary)"})})}),(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:(0,Z.tZ)(lx.hh,{href:l,native:!0,target:"blank",children:o})}),(0,Z.tZ)(gQ,{justifyContent:"end",children:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",size:"sm",href:null===a?(0,en.by7)({pub:i,addBase:!1}):(0,en.F6J)({pub:i,section:a,addBase:!1}),children:n("Edit")})})]})},x$=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(cl.A,{children:(0,Z.tZ)(oH._R,{id:"podcast-settings",title:e("Podcasts"),children:(0,Z.tZ)(cl.t5,{extraKeywords:e("sections podcasts"),children:(0,Z.tZ)(xK,{})})})})};var x0=i(84423);let x1="/publish/settings/new_newsletter",x2=eb(e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),n=t.sections||[];return n.length?(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:i("Publication sections"),secondaryText:i("Edit your existing publication sections or add a new one.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:x1,children:i("Add")})]}),(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{bg:"secondary",children:[(0,Z.tZ)(gK,{style:{width:"var(--size-32)"}}),(0,Z.tZ)(gK,{colSpan:2,children:i("Section")})]})}),(0,Z.tZ)(gq,{children:n.map(e=>(0,Z.tZ)(x4,{section:e,pub:t},e.id))})]})})]}):(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:i("Add a section"),secondaryText:i("Create an additional newsletter within your Substack people can subscribe to individually.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:x1,children:i("Add section")})]})}),x4=e=>{let{section:t,pub:i}=e,{iString:n}=(0,Q.M1)(),r=t.logo_url||i.logo_url,o=t.name||i.name,a=(0,en.Ucy)(i,{section:t,addBase:!0}),l=(0,Z.tZ)(d_.Vp,{theme:"warn",priority:"secondary",children:n("Building...")}),s=(0,Z.tZ)(d_.Vp,{theme:"error",priority:"secondary",children:n("Deleting...")}),d=(0,Z.tZ)(tM.y,{children:"Failed to build section, please delete and retry."});return(0,Z.BX)(gG,{borderBottom:"detail",children:[(0,Z.tZ)(gQ,{maxWidth:32,children:r?(0,Z.tZ)(iZ.e,{src:r,maxWidth:32,alt:"".concat(o," logo"),imageIsFixedWidth:!0,useRetinaSizing:!0,objectFit:"cover",radius:"xs"}):(0,Z.tZ)(et.hs,{width:32,height:32,bg:"secondary",alignItems:"center",justifyContent:"center",radius:"sm",children:(0,Z.tZ)(x0.Z,{size:20,color:"var(--color-fg-secondary)"})})}),(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:(0,Z.tZ)(ei.hh,{decoration:"hover-underline",href:a,native:!0,target:"blank",children:o})}),(0,Z.tZ)(gQ,{justifyContent:"end",children:"porting"===t.port_status?l:"deleting"===t.port_status?s:(0,Z.BX)(et.X2,{justifyContent:"end",alignItems:"center",gap:8,children:["error"===t.port_status&&d,(0,Z.tZ)(ee.zx,{priority:"secondary-outline",size:"sm",href:(0,j.ZVf)(i,{type:"newsletter",id:t.id,addBase:!1}),children:n("Edit")})]})})]})},x3=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(cl.A,{children:(0,Z.tZ)(oH._R,{id:"section-settings",title:e("Sections"),children:(0,Z.tZ)(cl.t5,{extraKeywords:e("sections"),children:(0,Z.tZ)(x2,{})})})})};var x8=i(34010);let x6={button:"button-Tg4vQG",icon:"icon-nZjKJ8",waveform:"waveform-j2ML3K"},x5=e=>{let{audioUrl:t}=e,[i,n]=(0,A.eJ)(!1),[r,o]=(0,A.eJ)(!1),a=(0,A.sO)(null),l=(0,A.sO)(null);(0,A.d4)(()=>{if(!l.current)return;let e=getComputedStyle(document.documentElement),i=e.getPropertyValue("--color-fg-tertiary").trim(),r=e.getPropertyValue("--color-bg-secondary").trim(),s=e.getPropertyValue("--color-accent-primary").trim();a.current=x8.Z.create({container:l.current,height:32,waveColor:i,progressColor:r,cursorColor:s,cursorWidth:1,barWidth:1.5,barGap:1.5,barRadius:99,fillParent:!0});let d=a.current;return d.on("ready",()=>o(!0)),d.on("finish",()=>{var e;n(!1),null===(e=a.current)||void 0===e||e.seekTo(0)}),d.on("error",e=>console.error("WaveSurfer error:",e)),d.on("play",()=>n(!0)),d.on("pause",()=>n(!1)),d.load(t),()=>{d.destroy(),a.current=null,o(!1),n(!1)}},[t]);let s=(0,A.I4)(()=>{a.current&&r&&(i?a.current.pause():a.current.play())},[i,r]);return(0,Z.BX)(et.X2,{border:"detail",radius:"sm",overflow:"hidden",height:32,bg:"primary",children:[(0,Z.tZ)(ee.kG,{className:x6.button,resetCss:!0,onClick:s,disabled:!r,"aria-label":i?"Pause":"Play",width:32,height:32,justifyContent:"center",alignItems:"center",flex:"auto",display:"flex",animate:!0,children:i?(0,Z.tZ)(iQ.Z,{size:16,className:x6.icon}):(0,Z.tZ)(i$.Z,{size:16,className:x6.icon})}),(0,Z.tZ)(et.hs,{flex:"grow",height:32,children:(0,Z.tZ)(ts.xu,{ref:l,className:x6.waveform})})]})};class x9 extends w.Component{render(e,t){let{id:i,title:n,subtitle:r,options:o,children:a}=e,{value:l}=t;return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(oH.dk,{id:i,className:"dropDownElement",children:[(0,Z.tZ)(oH.sY,{primaryText:n,secondaryText:r}),(0,Z.tZ)(oY.i,{onChange:this.onChange,value:this.getIndexFromValue(l),children:o.map((e,t)=>(0,Z.tZ)("option",{value:t.toString(),children:e.name}))})]}),a]})}constructor(e,t){super(e,t),(0,M._)(this,"onChange",async e=>{let t=this.props.options[e.currentTarget.value],i=this.state.value;if(t.value===i)return;let n=!0;if(this.props.warnings&&this.props.warnings[t.name]&&(n=window.confirm(this.props.warnings[t.name])),!n){this.setState({value:i});return}this.setState({value:t.value});try{var r;await N().put(null!==(r=this.props.endpoint)&&void 0!==r?r:"/api/v1/publication").send({[this.props.field]:t.value}),window.location.reload()}catch(e){this.setState({value:i}),console.error("Failed to set dropdown value:",e),alert((0,Y.zx)(e))}}),(0,M._)(this,"getIndexFromValue",e=>this.props.options.findIndex(t=>t.value===e)),this.state={value:e.publication[e.field]}}}let x7=e=>{try{if(null==e?void 0:e.text)return JSON.parse(null==e?void 0:e.text).errors[0].msg;return"Something went wrong"}catch(e){return"Something went wrong"}},Se=e=>{let{title:t,description:i,lineField:n,placeholder:r,multiline:o,savedValue:a,editValue:l,saving:s,hasChanges:d,maxLength:c,children:u,error:p,textProgressIndicator:h,setEditValue:m,save:g}=e,{iString:v}=(0,Q.M1)(),b=o?(0,Z.tZ)(bv.g,{maxLength:c||255,value:void 0===l?a:l,name:n,"aria-label":n,placeholder:r,onChange:e=>m(e.currentTarget.value),onInput:e=>m(e.currentTarget.value),rows:3}):(0,Z.tZ)(tD.oi,{name:n,"aria-label":n,value:void 0===l?a:l,type:"text",placeholder:r,maxLength:c||60,onChange:e=>m(e.currentTarget.value),onInput:e=>m(e.currentTarget.value)});return(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(oH.sY,{primaryText:t,secondaryText:i}),b,u,p&&(0,Z.tZ)(ei.xv.B4,{color:"error",children:p}),d&&(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",children:[(0,Z.BX)(et.gq,{alignItems:"start",gap:8,children:[(0,Z.tZ)(ee.zx,{priority:"primary",name:n,onClick:g,disabled:s||!!p,"data-testid":"".concat(n,"-button"),children:v("Save")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>m(void 0),children:v("Cancel")})]}),h&&c&&(0,Z.tZ)(ei.xv.B4,{color:"pub-secondary-text",align:"right",children:"".concat((null==l?void 0:l.length)||0,"/").concat(c)})]})]})},St=e=>{let{lineField:t,placeholder:i,multiline:n,title:r,children:o,maxLength:a,textProgressIndicator:l,tall:s,valueSanitizer:d,validator:c}=e,{getSettingFor:u}=(0,ss.So)(),[p,h]=(0,A.eJ)(u(t)),[m,g]=(0,A.eJ)(!1),[v,b]=(0,A.eJ)(!1),[y,f]=(0,A.eJ)(p),[_,w]=(0,A.eJ)(void 0),C=(0,A.I4)(async e=>{g(!0),w("");let i=null;try{var n;i=d?d(y):e;let r=!!c&&c(i);if(r){w(r),(0,U.j)(xc.F.PUBLICATION_SETTING_TEXT_INPUT_ERRORED,{settingName:t,is_validation_error:!0,value:i,error:r}),g(!1);return}let o=await N().put("/api/v1/publication_settings").send({[t]:i});(null==o?void 0:null===(n=o.body)||void 0===n?void 0:n.length)===1&&(h(o.body[0].value_text),b(!1))}catch(n){w(x7(n.response)),(0,U.j)(xc.F.PUBLICATION_SETTING_TEXT_INPUT_ERRORED,{settingName:t,is_network_error:!0,value:null!=i?i:e,error:n}),console.error(n)}g(!1)},[f,g]);return(0,Z.tZ)(Se,{title:r,lineField:t,placeholder:i,multiline:n,children:o,savedValue:p,editValue:y,saving:m,hasChanges:v,maxLength:a,textProgressIndicator:l,tall:s,setEditValue:e=>{void 0!==e&&(e!==p||e!==y)?(b(!0),w(""),f(e)):void 0===e&&(b(!1),f(void 0))},save:()=>C(y),error:_})},Si=e=>{let{lineField:t,placeholder:i,multiline:n,title:r,description:o,children:a,maxLength:l,defaultValue:s,tall:d,valueSanitizer:c,validator:u}=e,[p,h]=(0,A.eJ)(void 0),[m,g]=(0,A.eJ)(!1),[v,b]=(0,A.eJ)(void 0),{publication:y,setPublication:f}=ey(),_=async(e,t)=>{if(u){let e=u(t);if(e){b(e);return}}let i=c?c(t):t;g(!0);try{let t=await N().put("/api/v1/publication").send({[e]:i});h(void 0),b(void 0),f(t.body)}catch(e){console.error("Save failed:",e),alert((0,Y.zx)(e))}finally{g(!1)}},w=y[t]||s,C=!1;return void 0!==p&&p!==w&&(C=!0),(0,Z.tZ)(Se,{title:r,description:o,lineField:t,placeholder:i,multiline:n,children:a,savedValue:w,editValue:p,saving:m,hasChanges:C,maxLength:l,tall:d,error:v,setEditValue:e=>{h(e),u&&void 0!==e?b(u(e)||void 0):b(void 0)},save:()=>_(t,p)})},Sn=e=>{let{pub:t}=e,{iString:n}=(0,Q.M1)(),[r,o]=(0,A.eJ)(null),a=(0,A.sO)(null),l=(0,en.HQ5)({subdomain:t.subdomain});return(0,A.d4)(()=>{i.e("9327").then(i.t.bind(i,91915,23)).then(e=>{let i=e.default,n=getComputedStyle(document.body),r=n.getPropertyValue("--color-accent-themed"),a={width:1024,height:1024,margin:52,shape:"square",type:"canvas",data:l,dotsOptions:{color:r,type:"rounded"},backgroundOptions:{color:n.getPropertyValue("--color-bg-primary")},cornersSquareOptions:{color:r,type:"extra-rounded"},cornersDotOptions:{color:r,type:"dot"},qrOptions:{typeNumber:0,mode:"Byte",errorCorrectionLevel:"Q"}};t.logo_url&&(a.image="/api/v1/publication/logo",a.imageOptions={hideBackgroundDots:!0,imageSize:.5,margin:24}),o(new i(a))})},[l,t.logo_url]),(0,A.d4)(()=>{r&&a.current&&(a.current.innerHTML="",setTimeout(()=>{if(a.current){r.append(a.current);let e=a.current.querySelector("canvas");e&&(e.style.width="96px",e.style.height="96px")}},100))},[r]),(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("QR Code"),secondaryText:n("Use this QR code to share your publication.")}),(0,Z.BX)(tC.v2,{trigger:(0,Z.BX)(et.hs,{width:96,height:96,border:"detail",radius:"sm",overflow:"hidden",cursor:"pointer",alignItems:"center",justifyContent:"center",sizing:"border-box",position:"relative",children:[(0,Z.tZ)("div",{ref:a,style:{width:96,height:96}}),(0,Z.BX)(et.tu,{gap:8,className:"overlay-sE00lG",alignItems:"center",justifyContent:"center",children:[(0,Z.tZ)(nP.Z,{size:20,className:"icon-N9SWcI"}),(0,Z.tZ)(ei.xv.B4,{weight:"semibold",color:"white",children:n("Download")})]})]}),children:[(0,Z.tZ)(tC.sN,{onClick:()=>{r&&r.download({name:"qr-code",extension:"png"})},children:n("Save as PNG")}),(0,Z.tZ)(tC.sN,{onClick:()=>{r&&r.download({name:"qr-code",extension:"svg"})},children:n("Save as SVG")})]})]})},Sr="https://substack-stickers.s3.us-east-1.amazonaws.com/tts",So=()=>{let{iString:e}=(0,Q.M1)(),t=(0,ss.So)(),i=(0,iN.pm)(),[n,r]=(0,A.eJ)(t.getSettingFor("voiceover_voice_name")||""),o=[{label:e("Oliver"),value:"Oliver",description:e("A male voice with a direct, neutral tone")},{label:e("Cora"),value:"Cora",description:e("A female voice with a soft, smooth tone")},{label:e("Taylor"),value:"Taylor",description:e("A female voice with a direct, neutral tone")},{label:e("Casey"),value:"Casey",description:e("A younger voice with a bright, clear tone")},{label:e("Stewart"),value:"Stewart",description:e("A British male voice with a deep, resonant tone")},{label:e("Victoria"),value:"Victoria",description:e("A British female voice with a precise, clear tone")}],a=async n=>{try{await t.changeSetting({voiceover_voice_name:String(n)}),r(n)}catch(t){console.error(t),i.popToast(t=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},t),{text:e("Failed to update voice setting")})))}};return(0,Z.BX)(et.sg,{gap:8,children:[(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:e("Read-aloud voice"),secondaryText:e("Choose a voice to read your posts aloud in the Substack app.")}),(0,Z.tZ)(Sa,{options:o,value:n,onChange:a})]})}),n&&(0,Z.tZ)(x5,{audioUrl:"".concat(Sr,"/").concat(n.toLowerCase(),".mp3")})]})};function Sa(e){var t,i,n;let{value:r,options:o,onChange:a,disabled:l,className:s,placeholder:d}=e,{iString:c}=(0,Q.M1)();return(0,Z.tZ)(tC.v2,{className:s,trigger:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",disabled:l,trailing:(0,Z.tZ)(tw.Z,{}),"data-testid":"stock-select",children:(0,Z.tZ)(ei.xv.B3,{weight:"regular",children:null!==(n=null!==(i=null===(t=o.find(e=>e.value===r))||void 0===t?void 0:t.label)&&void 0!==i?i:d)&&void 0!==n?n:c("Select")})}),children:o.map(e=>(0,Z.tZ)(tC.sN,{onClick:()=>a(e.value),trailing:r===e.value?(0,Z.tZ)(eE.Z,{size:20}):void 0,children:(0,Z.BX)(et.X2,{gap:12,alignItems:"center",children:[(0,Z.tZ)(ts.xu,{width:48,radius:"sm",overflow:"hidden",outline:"detail",children:(0,Z.tZ)(iZ.e,{maxWidth:48,useRetinaSizing:!0,imageIsFixedWidth:!0,src:(0,en.zF4)("".concat(Sr,"/").concat(e.value.toLowerCase(),".png")),alt:e.label})}),(0,Z.BX)(et.sg,{children:[(0,Z.tZ)(ei.xv.B3,{color:"primary",children:e.label}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:e.description})]})]})}))})}let Sl=eb(e=>{let{publication:t,pub:i,publicationSettings:n}=e,{iString:r}=(0,Q.M1)(),o=(0,io.xR)();return(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{title:r("Branding"),id:"branding",children:[(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Sn,{pub:i})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(xw,{id:"enable-bylines",publication:i,title:r("Show bylines on posts"),subtitle:r("Show author names at the top of your posts."),field:"bylines_enabled"})}),i.bylines_enabled&&(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(xw,{id:"enable-byline-images",publication:i,title:r("Show byline photos on posts"),subtitle:r("Show author names at the top of your posts."),field:"byline_images_enabled"})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(x9,{publication:n,title:r("Post thumbnail cropping method"),field:"post_preview_crop_gravity",options:[{name:r("Center"),value:"center"},{name:r("Smart cropping"),value:"auto"}],endpoint:"/api/v1/publication_settings",subtitle:r("Smart cropping tries to highlight the most interesting part of your image.")})}),t.tts_enabled&&(0,Z.tZ)(So,{}),o.getConfigFor("enable_elevenlabs_voiceovers")&&(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(St,{title:r("ElevenLabs API Key"),description:r("Use ElevenLabs to create AI voiceovers for your posts."),placeholder:"e.g. sk_xxx",lineField:"elevenlabs_api_key"})})]})})}),Ss=()=>{var e;let{iString:t}=(0,Q.M1)(),[i,n]=(0,A.eJ)(!1),r=(0,ss.So)(),[o,a]=(0,A.eJ)(null===(e=r.getSettingFor("show_restacks_below_posts"))||void 0===e||e),l=(0,A.I4)(async e=>{var t;n(!0);let i=await N().put("/api/v1/publication_settings").send({show_restacks_below_posts:e});(null==i?void 0:null===(t=i.body)||void 0===t?void 0:t.length)===1&&a(i.body[0].value_bool),n(!1)},[a,n]);return(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:t("Show restacks below posts"),secondaryText:(0,Z.BX)(Z.HY,{children:[t("Displays restacks in the comments section below your posts.")," ",(0,Z.tZ)(ei.hh,{href:"https://support.substack.com/hc/en-us/articles/30285743283860",target:"_blank",rel:"noopener",decoration:"underline",children:t("Learn more")}),"."]})}),(0,Z.tZ)(i2.ZP,{checked:o,onChange:()=>l(!o),disabled:i})]})};function Sd(){let e=(0,G._)(["Substack will only allow email replies and direct emails to ","@substack.com from the audience you select. \n              â€œVerified subscribersâ€ are users whose behavior suggests they are real people rather than bots."]);return Sd=function(){return e},e}let Sc=e=>{let{publication:t,publicationSettings:i}=e,{iString:n,iTemplate:r,language:o}=(0,Q.M1)(),a=!!(0,eW.default)("like_comments_enabled"),l=!!(0,eW.default)("pub_auto_moderation_enabled"),{new_commenter_approval:s}=i;return(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{title:n("Community"),id:"community-settings",children:[(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(xw,{id:"enable-community-features",publication:t,title:n("Enable comments, likes, and restacks"),field:"community_enabled",subtitle:n("Give readers the ability to like, comment on, and restack your posts.")})}),t.community_enabled&&(0,Z.BX)(oH.he,{children:[(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(xw,{id:"enable-moderation-features",publication:t,title:n("Enable reporting"),field:"moderation_enabled",subtitle:n("Allow readers to report content to you or other admins.")})}),(0,Z.BX)(eW.SiteConfigGate,{configKey:"new_commenter_approval",children:[(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(xw,{id:"enable-new-commenter-approval",publication:i,title:n("Enable new commenter approval"),field:"new_commenter_approval",endpoint:"/api/v1/publication_settings",subtitle:n("Require moderator approval for first-time commenters.")})}),s&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("New commenters awaiting approval")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/moderation/new-commenters",native:!0,children:n("Approve new commenters")})]})})]}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Manage user bans"),secondaryText:n("Review users banned from commenting or subscribing.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/bans",native:!0,children:n("Manage bans")})]})}),t.moderation_enabled&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Moderate reported content"),secondaryText:n("Review comments and chat messages reported by your community.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/moderation",native:!0,children:n("Moderate")})]})}),t.moderation_enabled&&l&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Automatically moderate content"),secondaryText:n("Control which comments are automatically reported for moderation.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/moderation/policy",native:!0,children:n("Manage policy")})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(x9,{id:"homepage-type",publication:t,title:n("Default comment order"),field:"default_comment_sort",subtitle:n("Controls how comments on your posts will be sorted by default."),options:(0,oB.Hz)({likesEnabled:a,language:o}).map(e=>{let{key:t,text:i}=e;return{value:t,name:i}})})})]}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Ss,{})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(x9,{publication:t,title:n("Who can reply to your emails?"),subtitle:r(Sd(),t.subdomain),field:"forward_email_audience",options:[{name:n("Everyone"),value:"everyone"},{name:n("Subscribers"),value:"all_subscribers"},{name:n("Verified subscribers"),value:"verified_subscribers"},{name:n("Paying subscribers"),value:"paid_subscribers"},{name:n("No one"),value:"no_one"}]})})]})})};var Su=i(90966),Sp=i(53766),Sh=i(2609),Sm=i(45773);i(27361);let Sg=(e,t)=>Su.x7.create().show((0,f._)({message:e,timeout:3e3,className:"bp4-dark",position:Sp.Ly.BOTTOM},t)),Sv=(e,t)=>Sg(e,(0,f._)({intent:Sh.S.DANGER,timeout:5e3},t)),Sb=(e,t)=>Sg(e,(0,f._)({icon:Sm.d.TICK,intent:Sh.S.SUCCESS,timeout:5e3},t));var Sy=i(33425);let Sf=()=>{let[e,t]=(0,A.eJ)(!1),{connectedAccountEmail:i,isLoading:n,refetch:r}=iM(),{iString:o}=(0,Q.M1)(),{connectAccount:a,disconnectAccount:l}=iD({source:"pub_settings"}),s=async()=>{if(confirm("This will disconnect your YouTube account from Substack, delete all associated data, and cancel any pending uploads. Are you sure you want to continue?")){try{t(!0),await l(),r(),Sb("Successfully disconnected YouTube account")}catch(e){console.error(e),Sv("error: ".concat((0,Y.zx)(e)))}t(!1)}};return(0,Z.tZ)(cl.A,{children:(0,Z.tZ)(oH._R,{id:"connected-accounts",title:o("Connected accounts"),children:(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.BX)(et.gq,{gap:12,alignItems:"center",children:[(0,Z.tZ)(et.hs,{height:32,width:32,alignItems:"center",justifyContent:"center",children:(0,Z.tZ)(Sy.Z,{fill:"#FF0000",size:24})}),(0,Z.tZ)(oH.sY,{primaryText:o("YouTube"),secondaryText:i||(0,Z.BX)(Z.HY,{children:[o("Connect your account to automatically upload video posts to YouTube. "),(0,Z.tZ)(ei.hh,{decoration:"underline",target:"_blank",href:iX,children:o("Learn more")})]})})]}),e||n?(0,Z.tZ)(iI.$j,{sizing:"border-box",paddingX:12,paddingY:0}):i?(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:s,children:o("Disconnect")}):(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:a,children:o("Connect")})]})})})})},S_={selectDropdown:"selectDropdown-DdzEYJ"},SZ=e=>{let{categories:t,selectedTags:i,onChange:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(!1),[l,s]=(0,A.eJ)(!1),d=(t||[]).filter(e=>"number"==typeof e.id),{primaryId:c,secondaryId:u}=Sw({tags:i,categories:d}),p=d.map(e=>({value:e.id,label:r(e.name)})),h=e=>async t=>{let{value:r}=t,o=d.find(e=>e.id==r),l="primary"===e?[o,i[1]]:[i[0],o];"primary"===e?a(!0):s(!0),await n(nT()(l.map(e=>e))),"primary"===e?a(!1):s(!1)};return(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.BX)("select",{className:S_.selectDropdown,"aria-label":"primary category",disabled:o||!d.length,value:c||"",onChange:e=>h("primary")({value:e.target.value}),children:[(0,Z.tZ)("option",{value:"",disabled:!0,children:r("Select a primary category")}),p.filter(e=>e.value!==u).map(e=>(0,Z.tZ)("option",{value:e.value,children:e.label},e.value))]}),(0,Z.BX)("select",{className:S_.selectDropdown,"aria-label":"secondary category",disabled:l||!d.length,value:u||"",onChange:e=>h("secondary")({value:e.target.value}),children:[(0,Z.tZ)("option",{value:"",disabled:!0,children:r("Select a secondary category")}),p.filter(e=>e.value!==c).map(e=>(0,Z.tZ)("option",{value:e.value,children:e.label},e.value))]})]})},Sw=e=>{var t,i;let{tags:n,categories:r}=e;if(!r)return{primaryId:null,secondaryId:null};let o=n.map(e=>r.find(t=>t.id===e.id||t.id===e.parent_tag_id));return{primaryId:"number"==typeof(null===(t=o[0])||void 0===t?void 0:t.id)?o[0].id:null,secondaryId:"number"==typeof(null===(i=o[1])||void 0===i?void 0:i.id)?o[1].id:null}},SC=()=>{let e="/api/v1/publication/publication_tags",[t,i]=(0,A.eJ)([]),n=async(t,i)=>{await N().post(e).send({tag_id:t,rank:i})},r=async t=>{await N().del(e).send({tag_id:t})},o=(0,A.I4)(async e=>{let o=null!=e?e:[],a=t.map(e=>e.id),l=o.map(e=>e.id),s=t.filter(e=>!l.includes(e.id)),d=o.filter(e=>!a.includes(e.id));try{await Promise.all(s.map(e=>r(e.id))),await Promise.all(d.map(e=>n(e.id,l.indexOf(e.id)))),i([...o])}catch(e){i(t),alert((0,Y.zx)(e)),console.error(e)}},[t]);return(0,A.d4)(()=>{N().get(e).then(e=>e.body&&i(e.body))},[]),{tags:t,onChange:o}},Sx=eb(()=>{let{iString:e}=(0,Q.M1)(),[t,i]=(0,A.eJ)(null),{tags:n,onChange:r}=SC();return(0,A.d4)(()=>{(async()=>{i((await N().get("/api/v1/categories")).body)})()},[]),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(oH.sY,{primaryText:e("Categories"),secondaryText:(0,Z.BX)(Z.HY,{children:["Select categories to help people discover your publication."," ",(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us/articles/360042221312-How-do-I-add-categories-to-my-Substack-publication-",children:e("Learn more")})]})}),(0,Z.tZ)(SZ,{categories:t,selectedTags:n,onChange:r})]})}),SS=eb(e=>{let{publication:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{title:i("Basics"),id:"basics-settings",children:[(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(x9,{publication:t,title:i("Language"),subtitle:i("Select a default language for your posts, website, and emails."),field:"language",options:Object.entries(er.SUPPORTED_LANGUAGES_IN_LANGUAGE).map(e=>{let[t,n]=e;return{name:i(n),value:t}}).concat([{name:"English",value:"en"}])})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Sx,{})})]})})});var Sk=i(20521);function SB(){let e=(0,G._)(["\n            This is the profile that represents "," in the Substack app."]);return SB=function(){return e},e}function ST(e){var t;let{pubUser:i,currentUser:n}=e;return 0===i.ineligibility_reasons.length||(0,Sk.k)({ineligibilityReasons:i.ineligibility_reasons,isSelfOrGlobalAdmin:null!==(t=null==n?void 0:n.is_global_admin)&&void 0!==t?t:(null==n?void 0:n.id)===i.profile.id})}function SI(e){let{pub:t}=e,i=(0,pY.XA)(),{iString:n,iTemplate:r}=(0,Q.M1)(),o=(0,re.aF)(),{result:a,isLoading:l,error:s,refetch:d}=(0,iS.Wf)(async e=>await (0,ix.rd)("/api/v1/publication_user/".concat(t.id,"/primary_user"),e),[t],{auto:!0});(0,A.d4)(()=>{(0,U.j)(xc.F.EDIT_PRIMARY_PROFILE_VIEWED,{publication_id:t.id,current_primary_user_id:t.primary_user_id})});let c=(0,iS.ib)({pathname:"/api/v1/publication_user/".concat(t.id,"/set_as_primary"),method:"POST"}),u=async e=>{var t,i,n;let{pubUser:r}=e,a=await c.refetch({json:{user_id:null!==(t=null==r?void 0:r.profile.id)&&void 0!==t?t:null,ignore_ineligibility:(0,Sk.k)({ineligibilityReasons:null!==(i=null==r?void 0:r.ineligibility_reasons)&&void 0!==i?i:[],isSelfOrGlobalAdmin:null!==(n=null==o?void 0:o.is_global_admin)&&void 0!==n?n:(null==o?void 0:o.id)===(null==r?void 0:r.profile.id)})}});a instanceof Error?console.error("Error setting primary profile:",a):d()};return s?(console.error("Error loading primary profile:",s),(0,Z.tZ)(ei.xv.B4,{color:"error",children:n("Error loading primary profile")})):(0,Z.BX)(et.tu,{alignItems:"stretch",gap:i?12:20,minHeight:48,children:[(0,Z.BX)(et.tu,{gap:2,flex:"grow",children:[(0,Z.BX)(et.gq,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",children:n("Primary profile")}),(0,Z.tZ)(tW.u,{preferPlacement:"right-center",text:n("The primary profile is the account that is the landing page for the publication in the Substack app. This profile includes all of the publication's posts, and the account that receives direct messages on behalf of the publication.  The primary profile must be an admin or a contributor, and the profile must list this publication as its primary publication."),children:(0,Z.tZ)(eR.Z,{size:14,cursor:"pointer"})})]}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:r(SB(),t.name)})]}),l&&(0,Z.tZ)(ei.xv.B4,{children:n("Loading...")}),(0,Z.BX)(et.X2,{gap:12,alignItems:"center",children:[(null==a?void 0:a.primaryUser)?(0,Z.tZ)(SP,{pub:t,pubUser:a.primaryUser,currentUser:o,disabled:!1}):(0,Z.tZ)(SN,{}),a&&(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ts.xu,{children:(0,Z.tZ)(nX.Z,{size:20,style:{cursor:"pointer"}})}),title:n("Select primary profile"),layerOptions:{placement:"top-end"},layerClassName:(0,ts.oB)({maxHeight:500}),children:[a.allUsers.map(e=>(0,Z.tZ)(tC.sN,{onClick:()=>{(0,U.j)(xc.F.SET_PRIMARY_PROFILE_CLICKED,{publication_id:t.id,pub_user_id:e.profile.id,current_primary_user_id:t.primary_user_id}),ST({pubUser:e,currentUser:o})&&u({pubUser:e})},disabled:!ST({pubUser:e,currentUser:o}),children:(0,Z.tZ)(SP,{pub:t,pubUser:e,showRankingInfo:null==o?void 0:o.is_global_admin,currentUser:o,disabled:!ST({pubUser:e,currentUser:o})})},e.profile.id)),(0,Z.BX)(tC.sN,{onClick:()=>{(0,U.j)(xc.F.SET_PRIMARY_PROFILE_CLICKED,{publication_id:t.id,pub_user_id:null,current_primary_user_id:t.primary_user_id}),u({pubUser:null})},children:[(0,Z.tZ)(ei.xv.B4,{children:n("No primary profile")}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:n("Remove the primary profile from this publication")})]},"no-primary-profile")]})]})]})}function SN(){let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(et.tu,{gap:2,flex:"grow",children:(0,Z.tZ)(ei.xv.B4,{children:e("No primary profile set")})})}let SP=e=>{let{pubUser:t,disabled:i,showRankingInfo:n,currentUser:r,pub:o}=e,{iString:a}=(0,Q.M1)(),l=function(e){let{pubUser:t,pub:i}=e;if(0===t.ineligibility_reasons.length)return null;let n=[];for(let e of t.ineligibility_reasons)switch(e){case"not_member_of_pub":console.error("User ".concat(t.profile.id," is not a member of publication ").concat(i.id));break;case"role_is_private":n.push("make membership public");break;case"not_primary_pub":n.push("set ".concat(i.name," to be their primary publication"));break;case"primary_user_of_other_pub":n.push("remove them as primary user from another publication");break;case"role_underpermissioned":n.push("make them a contributor");break;default:console.warn("Unknown ineligibility reason:",e)}return"Setting as primary would: ".concat(n.join(", "),".")}({pubUser:t,pub:o});return(0,Z.BX)(et.X2,{justifyContent:"space-between",alignItems:"center",flex:"grow",children:[(0,Z.BX)(et.X2,{gap:8,alignItems:"center",children:[(0,Z.tZ)(eG.qE,{user:t.profile,showProfileHovercard:!0}),(0,Z.BX)(et.tu,{gap:4,flex:"grow",children:[(0,Z.BX)(et.gq,{gap:8,alignItems:"center",justifyContent:"start",children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",children:t.profile.name}),n&&(0,Z.tZ)(SE,{pubUser:t})]}),t.is_primary_for_pub&&(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:a("Primary profile for publication")}),i&&!ST({pubUser:t,currentUser:r})&&t.ineligibility_reasons.map((e,t)=>(0,Z.tZ)(SX,{reason:e},t)),!i&&l&&(0,Z.tZ)(ei.xv.B4,{maxWidth:500,color:"secondary",textWrap:"balance",children:l})]})]}),(0,Z.tZ)(iy.Z,{size:20,style:{marginLeft:90,cursor:"pointer"},onClick:e=>{(0,U.j)(xc.F.EDIT_PRIMARY_PROFILE_CLICKED,{publication_id:o.id,current_primary_user_id:o.primary_user_id}),e.stopPropagation(),e.preventDefault(),(0,Y.uX)((0,en.GR3)(t.profile.id,t.profile.name),{newTab:!0})}})]})};function SE(e){let{pubUser:t}=e;return(0,Z.tZ)(tW.u,{preferPlacement:"right-center",text:"is_author: ".concat(t.ranking_info.is_author?"true":"false",",\n        show_badge: ").concat(t.ranking_info.show_badge?"true":"false",",\n        is_admin: ").concat(t.ranking_info.is_admin?"true":"false",",\n        is_contributor: ").concat(t.ranking_info.is_contributor?"true":"false",",\n        created_at: ").concat(t.ranking_info.created_at,"\n      "),children:(0,Z.tZ)(eR.Z,{size:14,cursor:"pointer"})})}function SX(e){let{reason:t}=e,{iString:i}=(0,Q.M1)(),n=i("Unknown");return"role_underpermissioned"===t&&(n=i("This profile is not an admin or contributor.")),"role_is_private"===t&&(n=i("This profile is a public member of this publication.")),"primary_user_of_other_pub"===t&&(n=i("This profile is already the primary profile for another publication.")),"not_primary_pub"===t&&(n=i("This profile does not list this publication as its primary publication.")),"not_member_of_pub"===t&&(n=i("This profile is not a member of the publication.")),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:n})}let SM="icon-u9DWfd";function SA(){let e=(0,G._)(["Do you really want to remove "," from your publication team?"]);return SA=function(){return e},e}function SD(e){let{isOpen:t,onClose:i,subdomain:n}=e,{iString:r}=(0,Q.M1)(),{refetch:o}=(0,iS.ib)({pathname:"/api/v1/personal-mode/".concat(n,"/graduate"),method:"post"}),a=async()=>{(0,U.j)(U.FP.GRADUATE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"graduate"}),await o(),window.scrollTo(0,0),location.reload()},l=()=>{(0,U.j)(U.FP.GRADUATE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"close"}),i()};return(0,A.d4)(()=>{t&&(0,U.j)(U.FP.GRADUATE_PERSONAL_PUBLICATION_MODAL_SHOWN)},[t]),(0,Z.BX)(eK.u_,{isOpen:!!t,onClose:l,fullscreenMobile:!0,children:[(0,Z.tZ)(eK.xB,{title:r("Convert to publication?"),showClose:!1}),(0,Z.BX)(SK,{children:[(0,Z.tZ)(ei.xv,{translated:!0,children:"You can already publish, accept payments, and grow your audience with your current settings."}),(0,Z.tZ)(ei.xv,{translated:!0,children:"Converting your Substack into a publication will transform it into a standalone entity with its own name, logo, and website. This will also allow you to add multiple team members and create a subscriber chat."})]}),(0,Z.tZ)(eK.mz,{direction:"column",primaryButton:(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:a,children:r("Convert to publication")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:l,children:r("Cancel")})})]})}function SR(e){let{isOpen:t,onClose:i,pub:n,openDisableDomainModal:r}=e,[o,a]=(0,A.eJ)(!0),[l,s]=(0,A.eJ)(!1),{result:d,isLoading:c,refetch:u}=(0,iS.ib)({pathname:"/api/v1/personal-mode/".concat(n.subdomain,"/state"),auto:!!t,deps:[t]}),{refetch:p,error:h}=(0,iS.ib)({pathname:"/api/v1/personal-mode/".concat(n.subdomain,"/merge"),method:"post"}),m=async()=>{!(await p() instanceof Error)&&s(!0)};return(0,A.d4)(()=>{t&&(a(!0),(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_SHOWN))},[t]),(0,Z.tZ)(eK.u_,{isOpen:!!t,onClose:i,fullscreenMobile:!0,children:c||!d?(0,Z.tZ)(SG,{onClose:i}):h?(0,Z.tZ)(SF,{onClose:()=>{i(),location.reload()}}):l?(0,Z.tZ)(SW,{onClose:()=>{window.scrollTo(0,0),location.reload()}}):o?(0,Z.tZ)(SL,{onContinue:()=>a(!1),onClose:i}):"personal"===d.state||d.mergeFailureReasons.includes("already_set_up")?(0,Z.tZ)(Sz,{onClose:i}):d.mergeFailureReasons.includes("publication_has_custom_domain")?(0,Z.tZ)(SO,{onClose:i,openDisableDomainModal:r}):d.mergeFailureReasons.includes("publication_is_invite_only")?(0,Z.tZ)(SU,{onContinue:()=>u(),onClose:i,pub:n}):d.mergeFailureReasons.includes("chat_is_enabled")?(0,Z.tZ)(SJ,{onContinue:()=>u(),onClose:i,pub:n}):d.mergeFailureReasons.includes("publication_has_other_users")?(0,Z.tZ)(SY,{onContinue:()=>u(),onClose:i}):d.mergeFailureReasons.includes("user_lacks_name_or_handle")?(0,Z.tZ)(SH,{onClose:i}):d.mergeFailureReasons.includes("user_is_private")?(0,Z.tZ)(Sj,{onContinue:()=>u(),onClose:i}):d.mergeFailureReasons.includes("subdomain_handle_mismatch")?(0,Z.tZ)(SV,{subdomain:n.subdomain,onClose:i}):(0,Z.tZ)(Sq,{onMerge:m,onClose:i})})}function SF(e){let{onClose:t}=e,{iString:i}=(0,Q.M1)();return(0,A.d4)(()=>SQ("error"),[]),(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:i("Error"),showClose:!1}),(0,Z.tZ)(SK,{children:(0,Z.tZ)(ei.xv,{translated:!0,children:"There was an error merging this publication with your profile. Please try again later."})}),(0,Z.tZ)(eK.mz,{direction:"column",secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"cancel",step:"error"}),t()},children:i("Done")})})]})}function SL(e){let{onContinue:t,onClose:i}=e,{iString:n}=(0,Q.M1)();return(0,A.d4)(()=>SQ("explainer"),[]),(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:n("Merge with profile?"),showClose:!1}),(0,Z.BX)(SK,{children:[(0,Z.tZ)(ei.xv,{translated:!0,children:"Profiles offer a simpler publishing experience, allowing you to publish, accept payments, and grow an audience without managing a separate publication."}),(0,Z.tZ)(ei.xv,{translated:!0,children:"All your existing posts, subscribers, and payments will seamlessly transfer over."}),(0,Z.tZ)(ei.xv,{translated:!0,children:"However, this will deprecate your publication name, logo, website, and subscriber chat. Advanced features like sections, tags, and adding team members will also be disabled."})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"continue",step:"explainer"}),t()},children:n("Continue")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"cancel",step:"explainer"}),i()},children:n("Cancel")})})]})}function Sz(e){let{onClose:t}=e,{iString:i}=(0,Q.M1)();return(0,A.d4)(()=>SQ("blocked_already_set_up"),[]),(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:i("You can not merge this publication"),showClose:!1}),(0,Z.tZ)(SK,{children:(0,Z.tZ)(ei.xv,{translated:!0,children:"Merging is not available because your profile is already merged with a publication."})}),(0,Z.tZ)(eK.mz,{direction:"column",secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"cancel",step:"blocked_already_set_up"}),t()},children:i("Done")})})]})}function SO(e){let{onClose:t,openDisableDomainModal:i}=e,{iString:n}=(0,Q.M1)();(0,A.d4)(()=>SQ("blocked_publication_has_custom_domain"),[]);let r=()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"cancel",step:"blocked_publication_has_custom_domain"}),t()};return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:n("Disable custom domain"),showClose:!1}),(0,Z.tZ)(SK,{children:(0,Z.tZ)(ei.xv,{translated:!0,children:"Merged publications are exclusively accessed via your profile, and cannot be used with custom domains. You must disable your custom domain to continue."})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"disable_custom_doamin",step:"blocked_publication_has_custom_domain"}),r(),i()},children:n("Disable custom domain")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:r,children:n("Cancel")})})]})}function SU(e){let{onContinue:t,onClose:i,pub:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(n.invite_only);return(0,A.d4)(()=>SQ("blocked_publication_is_invite_only"),[]),(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:r("Disable private mode"),showClose:!1}),(0,Z.BX)(SK,{children:[(0,Z.BX)(ei.xv,{translated:!0,children:[(0,Z.tZ)(ei.Zx,{weight:"semibold",color:"primary",children:"All profiles are public."})," ","You must disable this setting to continue."]}),(0,Z.tZ)(et.tu,{paddingY:8,children:(0,Z.tZ)(et.tu,{gap:12,padding:8,border:"detail",radius:"sm",shadow:"xs",bg:"primary",children:(0,Z.tZ)(xw,{publication:n,title:r("Private mode"),subtitle:r("Please disable this feature to continue"),field:"invite_only",onSuccess:e=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"private_mode_toggle",step:"blocked_publication_is_invite_only"}),a(e)},setToTrueWarning:()=>!0,setToFalseWarning:()=>!0})})})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"continue",step:"blocked_publication_is_invite_only"}),t()},disabled:o,children:r("Continue")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"cancel",step:"blocked_publication_is_invite_only"}),i()},children:r("Cancel")})})]})}function SY(e){var t;let{onContinue:i,onClose:n}=e,{iString:r,iTemplate:o}=(0,Q.M1)(),a=(0,my._I)("/api/v1/publication_user"),{refetch:l}=(0,iS.ib)({pathname:"/api/v1/publication_user/",method:"delete"}),s=(0,re.aF)(),d=(null!==(t=a.data)&&void 0!==t?t:[]).filter(e=>{let{user_id:t}=e;return!s||t!==s.id});(0,A.d4)(()=>SQ("blocked_publication_has_other_users"),[]);let c=e=>async()=>{var t;confirm(o(SA(),null!==(t=e.user.name)&&void 0!==t?t:r("this user")))&&(await l({pathname:"/api/v1/publication_user/".concat(e.id)}),a.mutate())};return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:r("Remove team members"),showClose:!1}),(0,Z.BX)(SK,{children:[(0,Z.BX)(ei.xv,{translated:!0,children:[(0,Z.tZ)(ei.Zx,{weight:"semibold",color:"primary",children:"Profiles do not support mutltiple team members."})," ","You must remove all team members to continue."]}),(0,Z.tZ)(et.tu,{paddingY:8,children:(0,Z.tZ)(et.tu,{radius:"sm",bg:"primary",shadow:"xs",border:"detail",overflow:"auto",maxHeight:200,padding:8,gap:4,children:a.isLoading?"Loading...":0===d.length?(0,Z.BX)(et.tu,{alignItems:"center",gap:8,paddingY:40,paddingX:12,children:[(0,Z.tZ)(yp.Z,{color:"var(--color-fg-secondary)"}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",fontWeight:"medium",translated:!0,children:"All team members removed"})]}):d.map(e=>{var t;return(0,Z.BX)(et.gq,{alignItems:"center",gap:12,padding:8,children:[(0,Z.tZ)(eG.qE,{user:e.user,size:32}),(0,Z.BX)(et.tu,{flex:"fill",children:[(0,Z.tZ)(ei.xv.B3,{fontWeight:"medium",children:null!==(t=e.user.name)&&void 0!==t?t:e.user.id}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:(0,er.toTitleCase)(e.role)})]}),(0,Z.tZ)(ee.zx,{priority:"destructive",size:"sm",onClick:c(e),children:r("Remove")})]})})})})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"continue",step:"blocked_publication_has_other_users"}),i()},disabled:0!==d.length,children:r("Continue")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"cancel",step:"blocked_publication_has_other_users"}),n()},children:r("Cancel")})})]})}function SH(e){let{onClose:t}=e,{iString:i}=(0,Q.M1)();return(0,A.d4)(()=>SQ("blocked_user_lacks_name_or_handle"),[]),(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:i("Set up your profile"),showClose:!1}),(0,Z.tZ)(SK,{children:(0,Z.tZ)(ei.xv,{translated:!0,children:"Your profile must have a name and handle before merging it with a publication. Please edit these fields to continue."})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"setup",step:"blocked_user_lacks_name_or_handle"}),location.href=(0,en.qvS)()},children:i("Edit profile")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"cancel",step:"blocked_user_lacks_name_or_handle"}),t()},children:i("Cancel")})})]})}function Sj(e){var t,i;let{onContinue:n,onClose:r}=e,{iString:o}=(0,Q.M1)(),{isLoading:a,data:l}=(0,my._I)("/api/v1/publication_user"),{refetch:s}=(0,iS.ib)({pathname:"/api/v1",method:"post"}),d=(0,re.aF)(),c=!d||a?void 0:null===(i=null!=l?l:[])||void 0===i?void 0:null===(t=i.find(e=>{let{user_id:t}=e;return t===d.id}))||void 0===t?void 0:t.id,[u,p]=(0,A.eJ)(!1);(0,A.d4)(()=>SQ("blocked_user_is_private"),[]);let h=async e=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"visibility_toggle",step:"blocked_user_is_private"}),await s({pathname:"/api/v1/publication_user/".concat(c,"/visibility"),json:{visibility:e?"public":"private"}}),p(e)};return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:o("Show this publication on your profile"),showClose:!1}),(0,Z.BX)(SK,{children:[(0,Z.tZ)(ei.xv,{translated:!0,children:"Merging will make your association with this publication public."}),(0,Z.tZ)(ei.xv,{translated:!0,children:"You must show this publication on your profile to continue."}),c&&(0,Z.tZ)(et.tu,{paddingY:8,children:(0,Z.tZ)(et.tu,{gap:12,padding:8,border:"detail",radius:"sm",shadow:"xs",bg:"primary",children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:o("Show publication on profile"),secondaryText:o("Please enable this setting to continue.")}),(0,Z.tZ)(i2.ZP,{checked:u,onChange:h})]})})})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"continue",step:"blocked_user_is_private"}),n()},disabled:!u,children:o("Continue")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"cancel",step:"blocked_user_is_private"}),r()},children:o("Cancel")})})]})}function SJ(e){var t;let{onContinue:i,onClose:n,pub:r}=e,{iString:o}=(0,Q.M1)(),{result:a,refetch:l,isLoading:s,setResult:d}=cc({pub:r}),c=null===(t=null==a?void 0:a.threads_v2_enabled)||void 0===t||t,u=async e=>{a&&!s&&((0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"chat_toggle",step:"blocked_chat_is_enabled"}),await l({json:{threads_v2_enabled:e}}),d((0,_._)((0,f._)({},a),{threads_v2_enabled:e})))};return(0,A.d4)(()=>SQ("blocked_chat_is_enabled"),[]),(0,A.d4)(()=>{r&&l({method:"GET"})},[r]),(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:o("Disable subscriber chat"),showClose:!1}),(0,Z.BX)(SK,{children:[(0,Z.tZ)(ei.xv,{translated:!0,children:"Subscriber chat is not supported for profiles. You must disable this feature to continue."}),(0,Z.tZ)(et.tu,{paddingY:8,children:(0,Z.tZ)(et.tu,{gap:12,padding:8,border:"detail",radius:"sm",shadow:"xs",bg:"primary",children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:o("Subscriber chat"),secondaryText:o("Please disable this feature to continue")}),(0,Z.tZ)(i2.ZP,{checked:c,onChange:u})]})})})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"continue",step:"blocked_chat_is_enabled"}),i()},disabled:c,children:o("Continue")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"cancel",step:"blocked_chat_is_enabled"}),n()},children:o("Cancel")})})]})}function SV(e){let{onClose:t,subdomain:i}=e,{iString:n}=(0,Q.M1)();return(0,A.d4)(()=>SQ("blocked_subdomain_handle_mismatch"),[]),(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:n("Change your handle"),showClose:!1}),(0,Z.tZ)(SK,{children:(0,Z.BX)(ei.xv,{children:[n("Your profile handle must match this publication's subdommain. Please change your handle to ")," ",(0,Z.tZ)(ei.Zx,{font:"digit",color:"primary",weight:"bold",fontSize:14,className:"code-acG3Qz",children:i}),n(" to continue.")]})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"setup",step:"blocked_subdomain_handle_mismatch"}),location.href=(0,en.qvS)()},children:n("Edit handle")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"cancel",step:"blocked_subdomain_handle_mismatch"}),t()},children:n("Cancel")})})]})}function Sq(e){let{onMerge:t,onClose:i}=e,{iString:n}=(0,Q.M1)();return(0,A.d4)(()=>SQ("ready_to_merge"),[]),(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:n("You're ready to merge your profile and publication"),showClose:!1}),(0,Z.BX)(SK,{children:[(0,Z.tZ)(ei.xv,{translated:!0,children:"Please confirm the following changes before continuing:"}),(0,Z.BX)(et.gq,{gap:12,alignItems:"center",children:[(0,Z.tZ)(eE.Z,{className:SM,size:20,color:"var(--color-fg-secondary)"}),(0,Z.tZ)(ei.xv,{translated:!0,children:"Your publication name, logo, and website will be deprecated."})]}),(0,Z.BX)(et.gq,{gap:12,alignItems:"center",children:[(0,Z.tZ)(eE.Z,{className:SM,size:20,color:"var(--color-fg-secondary)"}),(0,Z.tZ)(ei.xv,{translated:!0,children:"You will now access all of your posts, subscribers, and settings via your profile."})]}),(0,Z.BX)(et.gq,{gap:12,alignItems:"center",children:[(0,Z.tZ)(eE.Z,{className:SM,size:20,color:"var(--color-fg-secondary)"}),(0,Z.tZ)(ei.xv,{translated:!0,children:"People who visit your old publication URL will be automatically redirected to your profile."})]}),(0,Z.tZ)(ei.xv,{translated:!0,children:"If you change your mind, you can always convert back to a publication in the future."})]}),(0,Z.tZ)(eK.mz,{direction:"column",primaryButton:(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"merge",step:"ready_to_merge"}),t()},children:n("Complete merge")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"cancel",step:"ready_to_merge"}),i()},children:n("Cancel")})})]})}function SW(e){let{onClose:t}=e,{iString:i}=(0,Q.M1)(),n=(0,re.aF)(),r=(0,eq.Ij)();return(0,A.d4)(()=>SQ("success"),[]),(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:i("Merging complete!"),showClose:!1}),(0,Z.tZ)(SK,{children:(0,Z.tZ)(ei.xv,{translated:!0,children:"You successfully merged this publication with your profile."})}),(0,Z.tZ)(eK.mz,{direction:"column",primaryButton:n?(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{n&&((0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"visit_profile",step:"success"}),location.href=(0,en.NNq)(r?{id:r.author_id,name:null}:n))},children:i("Visit your profile")}):void 0,secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_CLICKED,{clickedElement:"close",step:"success"}),t()},children:i("Done")})})]})}function SG(e){let{onClose:t}=e,{iString:i}=(0,Q.M1)();return(0,A.d4)(()=>SQ("loading"),[]),(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{title:i("Merge with profile"),showClose:!1}),(0,Z.tZ)(SK,{children:(0,Z.tZ)(et.tu,{gap:8,padding:64,alignItems:"center",children:(0,Z.tZ)(iI.$j,{flex:"grow"})})}),(0,Z.tZ)(eK.mz,{direction:"column",secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:t,children:i("Cancel")})})]})}function SK(e){let{children:t}=e;return(0,Z.tZ)(eK.fe,{children:(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:(0,Z.tZ)(et.tu,{gap:8,children:t})})})}function SQ(e){(0,U.j)(U.FP.MERGE_PERSONAL_PUBLICATION_MODAL_STEP_SHOWN,{step:e})}var S$=i(1835),S0=i(14773);function S1(){let e=(0,G._)(["To permanently delete ",", please type your publication's subdomain (\"",'") below.']);return S1=function(){return e},e}function S2(){let e=(0,G._)(['You typed "','" which did not match "','".']);return S2=function(){return e},e}function S4(){let e=(0,G._)(["To permanently delete all posts for ",", type your publication's subdomain (\"",'") below.']);return S4=function(){return e},e}function S3(){let e=(0,G._)(['You typed "','" which did not match "','".']);return S3=function(){return e},e}function S8(){let e=(0,G._)(['To confirm that you want to change "','" to "','", type "','" below.']);return S8=function(){return e},e}function S6(){let e=(0,G._)(['You typed "','", which didn\'t match "','".']);return S6=function(){return e},e}function S5(){let e=(0,G._)(["Permanently change your URL (",".substack.com)."]);return S5=function(){return e},e}function S9(){let e=(0,G._)(["Delete publication"]);return S9=function(){return e},e}class S7 extends w.Component{async componentDidMount(){this.setState({canChangeSubdomainAlias:await this.canChangeSubdomainWithAlias(),canDeleteArchive:await this.canDeletePublicationArchive(),mergeWithProfileDialogOpen:!1})}async canChangeSubdomainWithAlias(){let{user:e,pub:t}=this.context;if(e&&e.is_global_admin)return!0;if(!t.has_posts)return!1;try{return(await N().get("/api/v1/publication/subdomain/can_alias")).body.can_alias}catch(e){return console.error("Failed to fetch alias status:",e),!1}}async canDeletePublicationArchive(){let{user:e}=this.context;if(e&&e.is_global_admin)return!0;try{return(await N().get("/api/v1/publication/stats/can-delete-archive")).body.canDeleteArchive}catch(e){return console.error("Failed to fetch subscriber status:",e),!1}}async deletePublication(){var e;let{pub:t}=this.context,{iString:i,iTemplate:n}=this.props;if(t.has_paid_subs){alert(i("Your publication has paid subscribers. Please reach out to support@substackinc.com to delete this publication."));return}let r=null!==(e=prompt(n(S1(),t.name,t.subdomain)))&&void 0!==e?e:"";if(r===t.subdomain)try{await N().del("/api/v1/publication"),alert(i("Ok! The publication is being deleted. This may take a minute or two.")),window.location.href=(0,S0.ZJ)()}catch(e){console.error("Failed to delete publication: ",e),alert((0,Y.zx)(e))}else r.length&&alert(n(S2(),r,t.subdomain))}async deletePublicationArchive(){var e;let{pub:t}=this.context,i=null!==(e=prompt(this.props.iTemplate(S4(),t.name,t.subdomain)))&&void 0!==e?e:"";if(i===t.subdomain)try{await N().del("/api/v1/publication/archive"),alert(this.props.iString("Ok! Your posts are being deleted. This may take a minute or two."))}catch(e){console.error("Failed to delete posts: ",e),alert(this.props.iString("Failed to delete posts: "),(0,Y.zx)(e))}else i.length&&alert(this.props.iTemplate(S3(),i,t.subdomain))}async changeSubdomain(){let{alias:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.context.pub,{iString:i,iTemplate:n}=this.props;if(!confirm(i(e||!t.has_posts?"Are you sure you want to change your subdomain permanently?":"Are you sure you want to change your subdomain permanently, and break your old links?")))return;let r=prompt(i("What would you like your new subdomain to be?"));if(!r)return;let o=!1;try{let e=await N().get("/api/v1/check_subdomain").query({subdomain:r});o=e.body.available,r=e.body.subdomain}catch(e){alert((0,Y.zx)(e));return}if(!o){alert(i("That subdomain has been taken."));return}let a=prompt(n(S8(),t.subdomain,null!=r?r:"",null!=r?r:""));if(a!==r){a&&alert(n(S6(),a,null!=r?r:""));return}try{await N().put("/api/v1/publication/subdomain").send({subdomain:r,alias:e}),window.location.host=window.location.host.replace(t.subdomain,null!=r?r:"")}catch(e){console.error("Failed to delete publication: ",e),alert((0,Y.zx)(e))}}render(e,t){let{openDisconnectStripeModal:i,openDisableDomainModal:n,iString:r,iTemplate:o,showAttachedProfileSetting:a}=e,{canChangeSubdomainAlias:l,canDeleteArchive:s,mergeWithProfileDialogOpen:d}=t,{user:c,pub:u}=this.context;return(0,S$.Kw)(c)?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(SR,{isOpen:!!d,onClose:()=>this.setState({mergeWithProfileDialogOpen:!1}),pub:u,openDisableDomainModal:n}),(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{id:"danger-zone",title:r("Danger Zone"),border:"accent-red",children:[a&&(0,Z.tZ)(SI,{pub:u}),u.draft_plans&&["enabled","disabled","paused"].includes(u.payments_state)&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Turn off paid subscriptions"),secondaryText:(0,Z.BX)(Z.HY,{children:[r(u.has_subscribers?"This will disconnect your Stripe account from Substack, cancel all paid subscriptions, and refund paid subscribers for any time remaining on their subscriptions.  Subscribers will be notified.  You can review and confirm on the next step before turning off subscriptions.":"This will disconnect your Stripe account from Substack."),u.has_subscribers&&(0,Z.BX)(ei.xv.B4,{as:"span",color:"secondary",translated:!0,children:[(0,Z.tZ)("br",{}),"If youâ€™d like to disconnect your account ",(0,Z.tZ)("b",{children:"without"})," cancelling or refunding subscriptions, ",(0,Z.tZ)("a",{href:"mailto:support+payments-disconnect@substack.com",children:"contact Support"}),"."]})]})}),(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:async()=>{if(u.has_subscribers)i();else if(confirm("This will disconnect your Stripe account and remove all plan information. Are you sure?"))try{await N().delete("/api/v1/stripe/account"),document.location.hash="#connect",document.location.reload(!0)}catch(e){alert((0,Y.zx)(e))}},children:r(u.has_subscribers?"Turn off paid subscriptions":"Disconnect Stripe")})]})}),s&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Delete post archive"),secondaryText:r("Permanently delete all posts on this publication.")}),(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:()=>this.deletePublicationArchive(),children:r("Delete archive")})]})}),(0,Z.BX)(cl.t5,{children:[(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Change publication subdomain"),secondaryText:(0,Z.BX)(Z.HY,{children:[o(S5(),u.subdomain)," ",u.has_posts?r("This will break all links to your existing URL."):""]})}),(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:()=>this.changeSubdomain(),children:r("Change subdomain")})]}),l&&[(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Change subdomain without breaking links"),secondaryText:(0,Z.tZ)(et.tu,{children:(0,Z.tZ)(ei.xv.B4,{as:"span",color:"secondary",children:r("YOU CAN ONLY DO THIS ONCE - Permanently change your publication URL and redirects all links to\n                            the new URL.")})})}),(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:()=>this.changeSubdomain({alias:!0}),children:r("Change subdomain")})]})]]}),260347!==u.id&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Delete publication"),secondaryText:r("Permanently delete your publication, posts, podcast, and subscriber list. Once you do this, there is no going back.")}),(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:()=>this.deletePublication(),children:o(S9())})]})})]})})]}):null}}(0,M._)(S7,"contextType",ev);let ke=(0,Q.fz)(S7);function kt(){let e=(0,G._)(["Redirect traffic from ",' (without "www") to your Substack.']);return kt=function(){return e},e}function ki(){let e=(0,G._)(["Traffic from "," is being redirected to your Substack."]);return ki=function(){return e},e}function kn(){let e=(0,G._)(["Traffic from "," is not being redirected to your Substack."]);return kn=function(){return e},e}let kr={none:"none",paymentComplete:"payment_complete",pendingDns:"pending_dns",pendingRedirect:"pending_redirect",active:"active"},ko=e=>{let t,{state:i,customDomain:n}=e,{iString:r}=(0,Q.M1)();if(i===kr.none||i===kr.paymentComplete)t=r("Set up your Substack to live on a domain you already own.");else if(i===kr.pendingDns||i===kr.pendingRedirect)t=r("Your custom domain is being configured:");else{if(i!==kr.active)return null;t=r("Your custom domain is active:")}return(0,Z.tZ)(Z.HY,{children:(0,Z.tZ)(oH.sY,{primaryText:(0,Z.tZ)(Z.HY,{children:r(i===kr.active?"Custom domain is active":"Add a custom domain")}),secondaryText:(0,Z.BX)(Z.HY,{children:[t," ",[kr.pendingDns,kr.pendingRedirect,kr.active].includes(i)&&(0,Z.tZ)("a",{href:"https://".concat(n),children:n})]})})})},ka=e=>{let{pub:t,domainSetupState:i,openDisableDomainRedirectsModal:n,customDomain:r}=e,{iString:o,iTemplate:a}=(0,Q.M1)();if(!t.custom_domain)return null;let l=(0,en.Y3R)(t.custom_domain),s=!!t.apex_domain,d=(null==i?void 0:i.apex_state)==="healthy",c=r.replace("www.","");if(l)return null;let u=o(s?s&&d?"Root domain redirects are enabled":"Root domain redirects are disabled":"Enable root domain redirects"),p=a(s?s&&d?ki():kn():kt(),c);return(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:u,secondaryText:p}),!s&&(0,Z.tZ)(ee.zx,{priority:"secondary",href:(0,j.v5X)(),localNavigation:!0,children:o("Enable")}),s&&!d&&(0,Z.tZ)(ee.zx,{priority:"secondary",href:(0,j.b_Y)(),localNavigation:!0,children:o("Check status")}),s&&(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:n,localNavigation:!0,children:o("Disable")})]})},kl=e=>{let{state:t}=e,{iString:i}=(0,Q.M1)();return t!==kr.pendingDns&&t!==kr.pendingRedirect?null:(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",children:i("Domain status")}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:i("Verifying a domain may take up to 36 hours. We'll send you an email when it's done.")}),(0,Z.BX)(et.tu,{padding:12,gap:16,radius:"sm",border:"detail",shadow:"xs",children:[(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.B4,{children:i("DNS configuration")}),(0,Z.tZ)(et.gq,{gap:4,alignItems:"center",children:t===kr.pendingDns?(0,Z.BX)(d_.Vp,{priority:"secondary",children:[(0,Z.tZ)(pu.Z,{size:12,strokeWidth:3}),i("Verifying...")]}):(0,Z.BX)(d_.Vp,{theme:"success",priority:"secondary",children:[(0,Z.tZ)(eE.Z,{size:12,strokeWidth:3}),i("Verified")]})})]}),(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.B4,{children:i("Domain verification")}),(0,Z.tZ)(et.gq,{gap:4,alignItems:"center",children:t===kr.pendingRedirect?(0,Z.BX)(d_.Vp,{priority:"secondary",children:[(0,Z.tZ)(pu.Z,{size:12,strokeWidth:3}),i("Verifying...")]}):(0,Z.BX)(d_.Vp,{theme:"success",priority:"secondary",children:[(0,Z.tZ)(eE.Z,{size:12,strokeWidth:3}),i("Verified")]})})]})]})]})},ks=e=>{let{pub:t,state:i,domainSetupState:n}=e,{iString:r}=(0,Q.M1)();if(i===kr.none||i===kr.paymentComplete){let e=(0,j.Ul)(t,{payment:!n});return(0,Z.tZ)(ee.zx,{priority:"secondary",href:e,localNavigation:!!n,children:r("Add")})}return(0,Z.tZ)(et.gq,{gap:12,children:(0,Z.tZ)(ee.zx,{priority:"secondary",href:(0,j.gSe)(),flex:"grow",children:r(i===kr.active||i===kr.pendingRedirect?"View configuration":"Check status")})})},kd=e=>{let{openDisableDomainModal:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:i("Disable custom domain"),secondaryText:i("Remove your custom domain and revert to the default Substack domain.")}),(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:t,children:i("Disable")})]})},kc=e=>{let{domainSetupState:t}=e,{iString:i}=(0,Q.M1)();return t&&(null==t?void 0:t.stripe_invoice_id)?(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:i("Custom domain payment receipt"),secondaryText:i("View the receipt for your domain setup payment to Substack.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/account/receipts/view/platform_invoice/".concat(t.stripe_invoice_id),children:i("View receipt")})]})}):null},ku=eb(e=>{let{pub:t,domainSetupState:i,openDisableDomainModal:n,openDisableDomainRedirectsModal:r,error:o,did:a}=e,{iString:l}=(0,Q.M1)(),s=kr.none;(null==i?void 0:i.state)==="payment_complete"?s=kr.paymentComplete:(null==i?void 0:i.state)==="pending"?s=kr.pendingDns:(null==i?void 0:i.state)==="live"&&t.custom_domain_optional?s=kr.pendingRedirect:(null==i?void 0:i.state)!=="live"||t.custom_domain_optional||(s=kr.active);let[d,c]=(0,A.eJ)(a),u=(0,A.sO)(),{refetch:p}=(0,iS.ib)({pathname:"/api/v1/publication_settings",method:"PUT"}),h=(0,iN.pm)(),m=async e=>{var t;let i=e.replace(/^did=/,"");c(null===(t=(await p({json:{did_identity:null!=i?i:null}}))[0])||void 0===t?void 0:t.value_text),h.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:l("Domain identity updated")})))},g="@".concat((0,en.SVA)(t).replace(/^https?:\/\//,"")),v=(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:["To claim"," ",(0,Z.tZ)(ei.xv.B4,{as:"span",color:"pub-accent",children:I18N.p(g)})," ",'as your handle on Bluesky, tap "Copy domain value" in the "Change my handle" section of the Bluesky settings, then paste it into the box below.'," ",(0,Z.tZ)("a",{href:"https://blueskyweb.xyz/blog/4-28-2023-domain-handle-tutorial",target:"_blank",rel:"noopener",children:"Learn more"})]});return(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{id:"domain",title:l("Domain"),children:[(0,Z.BX)(cl.t5,{children:[(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(ko,{state:s,customDomain:t.custom_domain}),(0,Z.tZ)(ks,{pub:t,state:s,domainSetupState:i})]}),(0,Z.tZ)(ka,{pub:t,domainSetupState:i,openDisableDomainRedirectsModal:r,customDomain:t.custom_domain}),(0,Z.tZ)(kl,{state:s}),o&&(0,Z.tZ)(ei.xv.B4,{color:"error",children:o})]}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(oH.ZR,{id:"enable-identity",children:(0,Z.tZ)(oH.sY,{primaryText:l("Use your domain on Bluesky"),secondaryText:v})}),(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)("input",{ref:u,placeholder:"e.g. did:plc:q4jtwinidwadoaiekaweb4",className:"didInputField-Idsm_U",type:"text",maxLength:40,value:d}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{var e;return m(null==u?void 0:null===(e=u.current)||void 0===e?void 0:e.value)},children:l("Submit")})]})]})}),(null==i?void 0:i.stripe_invoice_id)&&(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kc,{domainSetupState:i})}),s!==kr.none&&s!==kr.paymentComplete&&(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kd,{openDisableDomainModal:n})})]})})});var kp=i(30010);let kh=e=>{let{title:t,bodyField:i,titleField:n,titlePlaceholder:r,subtitleField:o,endpoint:a,detailText:l}=e,{iString:s}=(0,Q.M1)(),d=(0,S0.n1)("/publish/settings/edit",(0,_._)((0,f._)({title:t,bodyField:i,titleField:n,titlePlaceholder:r,subtitleField:o},a&&{endpoint:a}),{redirect:"undefined"!=typeof document?document.location.href:""}));return(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:t,secondaryText:l}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:d,children:s("Edit")})]})};function km(){let e=(0,G._)([""," from ",""]);return km=function(){return e},e}let kg=e=>{if(!e)return null;let t=(0,kp.Z)(),i=Array.from(e.matchAll(RegExp(t,"g"))),n=i[0];if(i.length>0&&n&&0===n.index)return"Email sender name cannot start with emojis"},kv=eb(e=>{let{pub:t,dripCampaigns:i}=e,{iString:n,iTemplate:r}=(0,Q.M1)(),o=t.author_name&&r(km(),t.author_name,t.name)||t.name||t.subdomain,a=Array.isArray(i);return(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{title:n("Emails"),id:"email-settings",children:[(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Si,{publication:t,title:n("Email sender name"),description:n('The name that appears in the "from" field of your emails.'),lineField:"email_from_name",defaultValue:o,validator:kg})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Email header & footer"),secondaryText:n("Add content to the top and bottom of every emailed post.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/settings/preamble",children:n("Edit")})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kh,{publication:t,title:n("Email opt-out page"),detailText:n("The page people see after they opt out of receiving emails."),bodyField:"email_disable_message"})}),!t.invite_only&&(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(xw,{id:"require-confirmation",publication:t,title:n("Require email address confirmation"),subtitle:n("Force people who sign up using only their email to confirm it before subscribing."),field:"requires_confirmation",setToTrueWarning:n("Requiring email address confirmation will reduce the number of readers who receive emails. Are you sure?")})}),(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(oH.Uo,{title:n("Welcome emails")}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kh,{title:n(t.draft_plans?"Welcome email to paid subscribers":"Welcome email to new subscribers"),bodyField:"welcome_email_content",titleField:"welcome_email_subject",titlePlaceholder:n("Email subject..."),detailText:n(t.draft_plans?"Email sent to readers immediately after they become a paid subscriber.":"Email sent to readers immediately after they subscribe.")})}),t.draft_plans&&(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kh,{title:n("Welcome email to free subscribers"),bodyField:"unfinished_subscription_email_content",titleField:"unfinished_subscription_email_subject",titlePlaceholder:n("Email subject..."),detailText:n("Email sent to readers immediately after they become a free subscriber.")})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kh,{title:n("Welcome email to imported subscribers"),bodyField:"imported_welcome_email_content",titleField:"imported_welcome_email_subject",titlePlaceholder:n("Email subject..."),detailText:n("Email sent to readers immediately after they are imported to your publication."),endpoint:"/api/v1/publication/email_render_elements?include_defaults=true"})}),t.draft_plans&&t.founding_plan_enabled&&(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kh,{title:n("Welcome email to founding subscribers"),bodyField:"founding_tier_welcome_email_content",titleField:"founding_tier_welcome_email_subject",titlePlaceholder:n("Email subject..."),detailText:n("Email sent to readers immediately after they become a founding member. By default, this is the same email that is sent to new paid subscribers."),endpoint:"/api/v1/publication/email_render_elements?include_defaults=true"})}),a&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(oH.Uo,{title:n("Drip campaigns")}),(0,Z.BX)(cl.t5,{children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Free to paid conversion campaign"),secondaryText:n("Sends a series of emails to new free subscribers until they convert to paid. If enabled, this campaign will override your normal welcome email to free subscribers.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/drip-campaign/free",children:n("Edit")})]}),(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Paid onboarding campaign"),secondaryText:n("Sends a series of emails to new paid subscribers. If enabled, this will override your welcome email to paid subscribers in most places.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/drip-campaign/paid",children:n("Edit")})]}),(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Upgrade onboarding campaign"),secondaryText:n("Sends a series of emails to subscribers who upgrade from free to paid, falling back to Paid onboarding sequence when disabled.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/drip-campaign/upgrade",children:n("Edit")})]})]})]})]}),t.draft_plans&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(oH.Uo,{title:n("Expiration emails")}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kh,{publication:t,title:n("Paid subscription expired email"),bodyField:"subscription_expiry_email_content",titleField:"subscription_expiry_email_subject",titlePlaceholder:n("Email subject..."),detailText:n("Email sent to paid subscribers when their subscription expires.")})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kh,{publication:t,title:n("Paid subscription renewal email"),bodyField:"upcoming_renewal_email",titleField:"upcoming_renewal_email_subject",titlePlaceholder:n("Email subject..."),endpoint:"/api/v1/publication/email_render_elements?include_defaults=true",detailText:n("Email sent to annual subscribers one week before their subscription expires.")})})]})]})})});var kb=i(13285);let ky=e=>{let{pub:t}=e,[i,n]=(0,A.eJ)(!1),{iString:r}=(0,Q.M1)(),o=(0,iN.pm)(),a=(0,to.useRef)(null),l='<iframe src="'.concat(t.base_url,'/embed" width="480" height="').concat(i?150:320,'" style="border:1px solid #EEE; background:white;" frameborder="0" scrolling="no"></iframe>'),s=()=>{(0,Y.vQ)(l)},d=()=>{s(),o.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:r("Copied code to clipboard")})))};return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Embeddable subscribe button"),secondaryText:r("Add the following HTML to any website to show a subscribe button for this publication.")}),(0,Z.BX)(et.tu,{border:"detail",radius:"sm",minWidth:0,children:[(0,Z.BX)(et.gq,{flex:"grow",minWidth:0,className:"container-R8DFK1",ref:a,onClick:d,padding:8,gap:12,alignItems:"center",cursor:"pointer",children:[(0,Z.tZ)(ei.xv.B4,{ellipsis:!0,className:"text-ZX9AKB",minWidth:0,font:"monospace",children:l}),(0,Z.tZ)(ee.zx,{priority:"primary-mono",onClick:d,size:"sm",children:r("Copy")})]}),(0,Z.BX)(et.gq,{padding:12,gap:12,justifyContent:"start",borderTop:"detail",alignItems:"center",children:[(0,Z.tZ)(iB.X,{size:"sm",checked:!i,onChange:()=>n(!i)}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:r("Show logo in embed")})]})]})]})},kf=e=>{var t,i,n,r,o,a,l,s,d,c;let{publication:u}=e,{iString:p}=(0,Q.M1)(),{getSettingFor:h}=(0,ss.So)(),m={boost_enabled:null!==(t=h("boost_enabled"))&&void 0!==t&&t,features:{boost_score_based_upsell:null!==(i=h("boost_score_based_upsell"))&&void 0!==i&&i,boost_post_subscribe_upsell_enabled:null!==(n=h("boost_post_subscribe_upsell_enabled"))&&void 0!==n&&n,boost_precancellation_offer_enabled:null!==(r=h("boost_precancellation_offer_enabled"))&&void 0!==r&&r,paywall_unlock_tokens:null!==(o=h("paywall_unlock_tokens"))&&void 0!==o&&o,boost_free_subscriber_chat_preview:null!==(a=h("boost_free_subscriber_chat_preview"))&&void 0!==a&&a,credit_token_enabled:null!==(l=h("credit_token_enabled"))&&void 0!==l&&l,boost_first_month_upsell:null!==(s=h("boost_first_month_upsell"))&&void 0!==s&&s,boost_free_trials_default_enabled:null!==(d=h("boost_free_trials_default_enabled"))&&void 0!==d&&d,boost_two_pubs_already_read_upsell_enabled:null!==(c=h("boost_two_pubs_already_read_upsell_enabled"))&&void 0!==c&&c}},{result:g,hasLoadedOnce:v,error:b,refetch:y}=(0,iS.ib)({pathname:"/api/v1/boost",initialResult:m,auto:"enabled"===u.payments_state,deps:[]}),f=e=>t=>{y({method:"PUT",json:{feature:e,value_bool:t}})},_=!!v&&(null==g?void 0:g.boost_enabled),w=!_||!!b;return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:p("Enable Substack Boost"),secondaryText:(0,Z.BX)(Z.HY,{children:[p("Automatically show discounts and special offers at the right moment to maximize your revenue. "),(0,Z.tZ)(ei.hh,{decoration:"underline",href:"https://support.substack.com/hc/en-us/articles/9674586580244",children:p("Learn more")})]})}),(0,Z.tZ)(i2.ZP,{checked:_,disabled:!!b,onChange:e=>{y({method:"POST",json:{enabled:e}})}})]})}),!!b&&(0,Z.tZ)(et.gq,{justifyContent:"center",children:(0,Z.tZ)(ei.xv.B4,{weight:"bold",color:"error",paddingBottom:20,translated:!0,children:"Something went wrong. Please refresh the page."})}),v&&!w&&(0,Z.BX)(oH.he,{children:[(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:p("Enable pre-unsubscribe discounts"),secondaryText:p("Offers eligible paid subscribers a free month when they attempt to cancel their subscription, to convince them to stay.")}),(0,Z.tZ)(i2.ZP,{checked:!!(null==g?void 0:g.features.boost_precancellation_offer_enabled),onChange:e=>f("boost_precancellation_offer_enabled")(e),name:"boost_precancellation_offer_enabled"})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:p("Enable teaser posts"),secondaryText:(0,Z.BX)(Z.HY,{children:[p("Allows free subscribers to view one paywalled post in the Substack app, to show them what they're missing. "),(0,Z.tZ)(ei.hh,{decoration:"underline",href:"https://support.substack.com/hc/en-us/articles/24345969253524-What-is-a-teaser-post-on-Substack",children:p("Learn more")})]})}),(0,Z.tZ)(i2.ZP,{checked:!!(null==g?void 0:g.features.paywall_unlock_tokens),onChange:e=>f("paywall_unlock_tokens")(e),name:"paywall_unlock_tokens"})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:p("Enable chat preview"),secondaryText:(0,Z.BX)(Z.HY,{children:[p("Allows people to view the latest top-level messages in chat, to show them what they're missing. "),(0,Z.tZ)(ei.hh,{decoration:"underline",href:"https://support.substack.com/hc/en-us/articles/24345969253524-What-is-a-teaser-post-on-Substack",children:p("Learn more")})]})}),(0,Z.tZ)(i2.ZP,{checked:!!(null==g?void 0:g.features.boost_free_subscriber_chat_preview),onChange:e=>f("boost_free_subscriber_chat_preview")(e),name:"boost_free_subscriber_chat_preview"})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:p("Enable automated upsell emails"),secondaryText:(0,Z.BX)(Z.HY,{children:[p("Emails your most engaged free subscribers with special offers to go paid. By default this offers a 20% discount on an annual subscription. "),(0,Z.tZ)(ei.hh,{decoration:"underline",href:"https://support.substack.com/hc/en-us/articles/13512143478932",children:p("Learn more")})]})}),(0,Z.tZ)(i2.ZP,{checked:!!(null==g?void 0:g.features.boost_score_based_upsell),onChange:e=>f("boost_score_based_upsell")(e),name:"boost_score_based_upsell"})]})}),!!(null==g?void 0:g.features.boost_score_based_upsell)&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:p("Customize automated upsell email"),secondaryText:p("Edit the automated upsell email sent to your most engaged free subscribers via the setting above.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{(0,Y.uX)((0,en.n1t)("/publish/settings/edit",Object.assign({redirect:document.location.href},{bodyField:"score_based_upsell",title:p("Upsell to engaged subscribers"),endpoint:"/api/v1/publication/email_render_elements?include_defaults=true",titleField:"score_based_upsell_subject",titlePlaceholder:p("Email subject...")})))},children:p("Edit")})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:p("Enable multi-subscriber offers"),secondaryText:p("Offers people who just purchased a subscription to another publication a discounted paid subscription to yours, when they are most willing to pay.")}),(0,Z.tZ)(i2.ZP,{checked:!!(null==g?void 0:g.features.boost_post_subscribe_upsell_enabled),onChange:e=>f("boost_post_subscribe_upsell_enabled")(e),name:"boost_post_subscribe_upsell_enabled"})]})})]}),!w&&(0,Z.tZ)(tX.iz,{pullX:20})]})};function k_(){let{iString:e}=(0,Q.M1)(),{getSettingFor:t,changeSetting:i}=(0,ss.So)(),n="gifts_from_substack_disabled",r=!t(n);return(0,Z.tZ)(cl.A,{children:(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{id:"enable-gifts-from-substack",children:[(0,Z.tZ)(oH.sY,{primaryText:e("Enable gifts from Substack"),secondaryText:e("Offers free gift subscriptions to your publication during select campaign windows. Gifts are fully funded by Substack.")}),(0,Z.tZ)(i2.rs,{checked:r,onChange:()=>i({[n]:r})})]})})})}let kZ=e=>{let{publicationSettings:t,isPaid:i}=e,{iString:n}=(0,Q.M1)(),[r,o]=(0,A.eJ)(t.reader_referrals_enabled),[a,l]=(0,A.eJ)(t.reader_referrals_leaderboard_enabled),[s,d]=(0,A.eJ)(t.reader_referrals_footer_enabled),[c,u]=(0,A.eJ)(!1),p=(0,iN.pm)(),h=async e=>{u(!0);try{if("reader_referrals_enabled"===e){let e=!r;await N().put("/api/v1/reader_referrals").send({enabled:e}),o(e),l(e)}else if("reader_referrals_leaderboard_enabled"===e){let e=!a;await N().put("/api/v1/publication_settings").send({reader_referrals_leaderboard_enabled:e}),l(e)}else if("reader_referrals_footer_enabled"===e){let e=!s;await N().put("/api/v1/publication_settings").send({reader_referrals_footer_enabled:e}),d(e)}}catch(e){p.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:n("Unable to save changes")})))}finally{u(!1)}},m=(0,Z.BX)(Z.HY,{children:[n("Reward subscribers for sharing your Substack with others. "),(0,Z.tZ)(ei.hh,{decoration:"underline",href:"https://support.substack.com/hc/en-us/articles/16142857300372",target:"_blank",rel:"noopener",children:n("Learn more")})]}),g=()=>{window.location.href="/publish/settings/reader_referrals"},v=!r&&!i;return(0,Z.BX)(Z.HY,{children:[v?(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Setup subscriber referrals"),secondaryText:m}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:g,children:n("Setup")})]})}):(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Enable subscriber referral program"),secondaryText:m}),(0,Z.tZ)(i2.rs,{disabled:c,checked:r,onChange:()=>h("reader_referrals_enabled")})]})}),r&&(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(oH.he,{children:[(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Show referral link in emails"),secondaryText:n("Adds a footer to emailed posts encouraging subscribers to refer friends.")}),(0,Z.tZ)(i2.rs,{disabled:c,checked:s,onChange:()=>h("reader_referrals_footer_enabled")})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Show referral leaderboard"),secondaryText:n("Adds a referral leaderboard to the navigation bar on your website.")}),(0,Z.tZ)(i2.rs,{disabled:c,checked:a,onChange:()=>h("reader_referrals_leaderboard_enabled")})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Customize rewards"),secondaryText:n("Setup your reward tiers and custom reward emails.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:g,children:n("Edit")})]})})]}),(0,Z.tZ)(tX.iz,{pullX:20})]})]})},kw={numberField:"numberField-qu76Rj"};function kC(){let e=(0,G._)(["Email sent to paid subscribers of "," asking them to share a gift subscription with friends."]);return kC=function(){return e},e}function kx(){let e=(0,G._)(["The number of days before new paid subscribers get their first gift."]);return kx=function(){return e},e}function kS(){let e=(0,G._)(["If enabled, paid subscribers who use all their gifts and have at least one accepted will receive "," more."]);return kS=function(){return e},e}function kk(){let e=(0,G._)(['Shown to gift recipients as an answer to "What is ','?"']);return kk=function(){return e},e}function kB(){let e=(0,G._)(["What is ","?"]);return kB=function(){return e},e}let kT=e=>{let{pub:t,viralGiftsConfig:i,isEasyMode:n}=e,{iString:r,iTemplate:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(i),[s,d]=(0,A.eJ)(null==i?void 0:i.enabled),[c,u]=(0,A.eJ)(null==i?void 0:i.gifts_per_user),[p,h]=(0,A.eJ)(null==i?void 0:i.gift_length_months),[m,g]=(0,A.eJ)(null==i?void 0:i.message),[v,b]=(0,A.eJ)(null==i?void 0:i.days_til_invite),[y,_]=(0,A.eJ)(null==i?void 0:i.send_extra_gifts),[w,C]=(0,A.eJ)(null==i?void 0:i.send_emails),[x,S]=(0,A.eJ)(!1),k=(e,t,i)=>{let n=Number(e);return isNaN(n)||n<t?t:n>i?i:n},B=(e,t,i,n)=>{let r=parseInt(e.currentTarget.value);if(isNaN(r))n(void 0);else{let o=k(r,t,i);e.currentTarget.value="".concat(o),n(o)}},T=(e,t,i,n)=>{let r=k(parseInt(e.currentTarget.value),t,i);e.currentTarget.value="".concat(r),n(r)},I=e=>{if(!e){console.warn("no viral gifts config, cannot resetInputs");return}d(e.enabled),u(e.gifts_per_user),h(e.gift_length_months),g(e.message),b(e.days_til_invite),_(e.send_extra_gifts),C(e.send_emails)};(0,A.d4)(()=>{a&&I(a)},[a]);let P=()=>a?(0,f._)({},s!==a.enabled&&{enabled:s},c!==a.gifts_per_user&&{gifts_per_user:c},p!==a.gift_length_months&&{gift_length_months:p},m!==a.message&&{message:m},v!==a.days_til_invite&&{days_til_invite:v},y!==a.send_extra_gifts&&{send_extra_gifts:y},w!==a.send_emails&&{send_emails:w}):{},E=async e=>{let t;S(!0);try{t=await N().patch("/api/v1/viral_gifts/config").send(e),l(t.body)}catch(e){console.error(e),alert(r("Something went wrong")),I(a)}finally{S(!1)}},X=async e=>{e?a?await E({enabled:!0}):l((await N().post("/api/v1/viral_gifts/config")).body):await E({enabled:!1})},M=(0,Z.BX)(Z.HY,{children:[r("Allows paid subscribers to give friends limited access to paid content. "),(0,Z.tZ)(ei.hh,{decoration:"underline",href:"https://support.substack.com/hc/en-us/articles/8946512015892",target:"_blank",children:r("Learn more")})]});return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Enable paid subscriber gifts"),secondaryText:M}),(0,Z.tZ)(i2.ZP,{disabled:x,checked:null==a?void 0:a.enabled,onChange:e=>{X(e)}})]})}),(null==a?void 0:a.enabled)&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(oH.he,{children:n?[(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kh,{title:r("Referral gift grant email"),bodyField:"grant_email_body",titleField:"grant_email_subject",titlePlaceholder:r("Gift Email"),endpoint:"/api/v1/viral_gifts/config",detailText:o(kC(),t.name)})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Enable re-up referral emails"),secondaryText:r("Email sent to subscribers who have shared all their gift subscriptions. This is a great way to turn your biggest advocates into top referrers.")}),(0,Z.tZ)(i2.ZP,{checked:y,disabled:x,onChange:async e=>{_(e),await E({send_extra_gifts:e})}})]})})]:[(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Gifts per user"),secondaryText:r("The number of gifts each paid subscriber will be given.")}),(0,Z.tZ)(tD.oi,{type:"number",min:1,max:10,value:c,disabled:x,onInput:e=>B(e,1,10,u),onBlur:e=>T(e,1,10,u),className:kw.numberField})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Gift expiration"),secondaryText:r("The number of months each gift will last for.")}),(0,Z.tZ)(tD.oi,{type:"number",min:1,max:12,value:p,disabled:x,onInput:e=>B(e,1,12,h),onBlur:e=>T(e,1,12,h),className:kw.numberField})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Time to first gift"),secondaryText:o(kx())}),(0,Z.tZ)(tD.oi,{type:"number",min:1,max:365,value:v,disabled:x,onInput:e=>B(e,1,365,b),onBlur:e=>T(e,1,365,b),className:kw.numberField})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Enable gift resupplies"),secondaryText:o(kS(),!eS()(c)&&c>0?c:"")}),(0,Z.tZ)(i2.ZP,{checked:y,disabled:x,onChange:e=>{_(e)}})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Enable gift promotion emails"),secondaryText:r("If enabled, paid subscribers will get emails to inform them about gifting and gift resupplies.")}),(0,Z.tZ)(i2.ZP,{checked:w,disabled:x,onChange:e=>{C(e)}})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(oH.sY,{primaryText:r("Optional gift message"),secondaryText:o(kk(),t.name)}),(0,Z.tZ)(bv.g,{maxLength:255,value:m,onInput:e=>g(e.target.value),placeholder:o(kB(),t.name)})]})}),!im()(P())&&(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.tZ)(ee.zx,{priority:"primary",onClick:async()=>{await E(P())},disabled:x,children:r("Save")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>I(a),children:r("Cancel")})]})]}),(0,Z.tZ)(tX.iz,{pullX:20})]})]})},kI=()=>{var e;let{iString:t}=(0,Q.M1)(),[i,n]=(0,A.eJ)(!1),r=(0,ss.So)(),[o,a]=(0,A.eJ)(null===(e=r.getSettingFor("enable_post_page_conversion"))||void 0===e||e),l=(0,A.I4)(async e=>{var t;n(!0);let i=await N().put("/api/v1/publication_settings").send({enable_post_page_conversion:e});(null==i?void 0:null===(t=i.body)||void 0===t?void 0:t.length)===1&&a(i.body[0].value_bool),n(!1)},[a,n]);return(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:t("Enable subscribe prompts on post page"),secondaryText:t("Adds modals, pop-ups, and other prompts to encourage people to subscribe.")}),(0,Z.tZ)(i2.ZP,{checked:o,onChange:()=>l(!o),disabled:i})]})},kN=e=>{let{pub:t,publicationSettings:i,viralGiftsConfig:n,isEasyMode:r}=e,{iString:o}=(0,Q.M1)(),{getSettingFor:a,changeSetting:l}=(0,ss.So)(),s=t.invite_only,d="enabled"===t.payments_state;return(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{id:"growth-settings",title:o("Growth features"),children:[d&&(0,Z.tZ)(kf,{publication:t}),!s&&(0,Z.tZ)(kZ,{publicationSettings:i,isPaid:d}),d&&(0,Z.tZ)(kT,{pub:t,viralGiftsConfig:n,isEasyMode:r}),d&&(0,kb.S)(t)&&(0,Z.tZ)(k_,{}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kI,{})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{id:"enable-notes-feed-homepage",children:[(0,Z.tZ)(oH.sY,{primaryText:o("Enable auto-clips in feed"),secondaryText:o("Substack will automatically feature clips from your latest video posts on Notes")}),(0,Z.tZ)(i2.ZP,{checked:!!a("highlight_video_clips"),onChange:()=>{l({highlight_video_clips:!a("highlight_video_clips")})}})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(ky,{pub:t})})]})})};class kP extends w.Component{async componentDidMount(){await this.loadExports(),"undefined"!=typeof window&&(this.checkInterval=window.setInterval(this.refreshPendingExports,5e3))}componentWillUnmount(){clearInterval(this.checkInterval)}render(e,t){let{publicationExports:i,creatingExport:n}=this.state;return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:this.context.iString("Export your data"),secondaryText:this.context.iString("Export your posts, subscriber list, and related data. We'll send you an email when your export is ready to download.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",disabled:n,onClick:this.createPublicationExport,children:this.context.iString("New export")})]}),i&&i.length>0&&(0,Z.BX)("table",{className:"settings-page-table",children:[(0,Z.BX)("tr",{className:"header-row",children:[(0,Z.tZ)("td",{children:(0,Z.tZ)(ei.xv.B4,{color:"primary",weight:"semibold",children:this.context.iString("Export date")})}),(0,Z.tZ)("td",{})]}),i.map(e=>(0,Z.tZ)(kX,{publicationExport:e}))]})]})}constructor(...e){super(...e),(0,M._)(this,"checkInterval",void 0),(0,M._)(this,"state",{publicationExports:[],creatingExport:!1}),(0,M._)(this,"refreshPendingExports",()=>{this.state.publicationExports.filter(e=>!e.finished_at).length>0&&this.loadExports()}),(0,M._)(this,"loadExports",async()=>{try{let e=await N().get("/api/v1/publication_export");await (0,Y.IW)(this,{publicationExports:e.body})}catch(e){console.error("Failed to fetch publication exports:",e)}}),(0,M._)(this,"createPublicationExport",()=>(0,Y.Se)(this,"creatingExport",async e=>{try{let t=await N().post("/api/v1/publication_export");e.publicationExports.map(e=>e.id).includes(t.body.id)||this.setState({publicationExports:[t.body].concat(e.publicationExports)})}catch(e){alert((0,Y.zx)(e))}}))}}(0,M._)(kP,"contextType",Q.wj);let kE=(e,t)=>{let{iString:i}=I18N.i(t);return e.url?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eE.Z,{size:20,color:"var(--color-fg-secondary)"}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:i("Done")})]}):e.created_at<(0,H.Z)().subtract(1,"week").toDate()?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eL.Z,{size:20,color:"var(--color-accent-fg-red)"}),(0,Z.tZ)(ei.xv.B3,{color:"accent-red",children:i("Failed")})]}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(iI.$j,{padding:0,size:20}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:i(e.stage)})]})},kX=e=>{let{publicationExport:t}=e,{iString:i,language:n}=(0,Q.M1)();return(0,Z.BX)("tr",{children:[(0,Z.tZ)("td",{className:"primary",children:(0,Z.tZ)(ei.xv.B3,{children:(0,H.Z)(t.created_at).standardDatetime()})}),(0,Z.tZ)("td",{className:"primary",align:"right",children:t.url?(0,Z.BX)(ee.zx,{priority:"secondary-outline",size:"sm",href:t.url,native:!0,children:[(0,Z.tZ)(nP.Z,{size:20}),i("Download")]}):(0,Z.tZ)(et.hs,{gap:8,alignItems:"center",justifyContent:"end",children:kE(t,n)})})]})},kM=eb(()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{title:e("Import / Export"),id:"import-export-settings",children:[(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:e("Import email addresses"),secondaryText:e("Bring over your existing subscribers by copy pasting their addresses or uploading a CSV file.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/subscribers/add",children:e("Import emails")})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:e("Import posts"),secondaryText:e("Bring your archives from your blog, Medium, Beehiiv, Ghost, Mailchimp, WordPress, TinyLetter, Tumblr, Webflow, or website with an RSS feed")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/import",children:e("Import posts")})]})}),(0,Z.tZ)(kP,{})]})})});var kA=i(50246),kD=i(51699);function kR(e){var t,i,n;let r=[],o=[],a=[],l=[];if(e)for(let i of e)(0,kD.F)({plan:i})||i.metadata&&i.metadata.bitcoin||(null===(t=i.metadata)||void 0===t?void 0:t.custom_gift)||("month"===i.interval&&1==i.interval_count?r.push(i):"year"===i.interval&&1==i.interval_count?o.push(i):a.push(i),l.push(i));let s=(1===r.length||1===o.length)&&r.length+o.length<=2;return{valid:s,empty:0===l.length,monthlyPlan:s&&null!==(i=r[0])&&void 0!==i?i:null,yearlyPlan:s&&null!==(n=o[0])&&void 0!==n?n:null,customPlans:s?a:l}}let kF={descriptionHtml:"descriptionHtml-gze9og",eventTypeSelect:"eventTypeSelect-dlAm9T",underlined:"underlined-OheSHe",disabled:"disabled-PDhud0",hidden:"hidden-nsiohW",statusIndicator:"statusIndicator-xejbtV",priceInput:"priceInput-pqK3xh",templateButton:"templateButton-Is5OXc"};function kL(){let e=(0,G._)([""," price must be less than paid subscriber price"]);return kL=function(){return e},e}function kz(){let e=(0,G._)([""," price must be less than regular meeting price"]);return kz=function(){return e},e}function kO(){let e=(0,G._)([""," price must be at least $5"]);return kO=function(){return e},e}function kU(){let e=(0,G._)(["Connected to ",""]);return kU=function(){return e},e}function kY(){let e=(0,G._)([""," price"]);return kY=function(){return e},e}function kH(){let e=(0,G._)(["Offer a discounted price to subscribers with in the "," plan"]);return kH=function(){return e},e}let kj=e=>{var t;let{user:i,publication:n,pub:r}=e,{iString:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(!1),[s,d]=(0,A.eJ)(null),[c,u]=(0,A.eJ)(null),[p,h]=(0,A.eJ)(null),m=(0,ss.So)(),[g,v]=(0,A.eJ)(null===(t=m.getSettingFor("enable_meetings"))||void 0===t||t),b=(0,A.I4)(async e=>{l(!0),v((await N().put("/api/v1/meetings/config/enabled").send({enable_meetings:e})).body.enable_meetings),l(!1)},[v,l]),y=(0,A.I4)(async e=>{let{event_type_uri:t,price:i,subscriber_price:n,founding_price:r}=e;l(!0);let a={event_type_uri:t,price:i};n&&(a.subscriber_price=n),r&&(a.founding_price=r);try{let{body:e}=await N().post("/api/v1/meetings/config").send(a);u(e.meetings)}catch(e){window.alert(o("Failed to save changes. Please refresh the page and try again."))}finally{l(!1)}},[u]),f=(0,A.I4)(async()=>{l(!0);try{let{body:e}=await N().get("/api/v1/meetings/config");u(e.meetings),h(e.calendlyAuthorizationUrl),l(!1)}catch(e){l(!1),d("config")}},[u,h,l]);(0,A.d4)(()=>{f()},[g]);let _=(0,A.I4)(()=>{p&&window.open(p,"_blank")},[i,n,p]);return(0,Z.tZ)(cl.A,{children:(0,Z.tZ)(oH._R,{title:o("Meetings"),id:"meetings-settings",children:(0,Z.BX)(cl.t5,{children:[!c&&(a?(0,Z.tZ)(et.gq,{paddingY:24,justifyContent:"center",children:(0,Z.tZ)(ei.xv.B3,{translated:!0,children:"Loading..."})}):s?(0,Z.BX)(et.gq,{paddingY:24,justifyContent:"center",children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"Something went wrong fetching your Meetings settings. Please refresh the page and try again. If this problem persists, you can try disconnecting calendly and reconnecting."}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:async()=>{try{await N().post("/api/v1/meetings/calendly/oauth/disconnect").send({disable:!0})}catch(e){window.alert(o("Failed to disconnect Calendly; please contact meetings@substackinc.com"))}finally{window.location.reload()}},className:kF.connectBtn,children:o("Disconnect Calendly")})]}):(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:o("Start selling one-on-one calls to your readers."),secondaryText:o("Connect a free Calendly account to get started.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:_,children:o("Connect Calendly")})]})),"undefined"!=typeof window&&!!c&&(0,Z.tZ)(kq,{settings:c,saveSettings:y,loading:a,pub:r,changeSetting:b,meetingsEnabled:g})]})})})},kJ=e=>{let{label:t,description:i,price:n,setPrice:r,seedPrice:o,disabled:a,currency:l,loading:s,name:d}=e;return(0,Z.BX)(et.tu,{children:[(0,Z.BX)(et.hs,{alignItems:"center",gap:24,paddingBottom:8,children:[(0,Z.BX)("div",{style:"flex-grow: 1",children:[(0,Z.tZ)(ei.xv.H4,{weight:"bold",children:t}),(0,Z.tZ)(ei.xv.B4,{children:i})]}),(0,Z.tZ)(i2.rs,{checked:!a,onChange:e=>{e?r(o):r(null)}})]}),!a&&(0,Z.tZ)(kA.Z,{disabled:s,className:k()(kF.priceInput),name:d,value:n&&n.toString(),onValueChange:(e,t,i)=>{r(Number(i.value))},allowNegativeValue:!1,decimalsLimit:2,step:5,allowDecimals:!(0,er.isZeroDecimalCurrency)(l),prefix:(0,er.currencySymbol)(l)})]})},kV=e=>{var t,i,n;let{pub:r,price:o,subscriberPrice:a,foundingPrice:l}=e,{iString:s,iTemplate:d}=(0,Q.M1)();return null!==o&&o<5?s("Price must be at least $5"):null!==a&&null!==o&&a>=o?s("Paid subscriber price must be less than regular meeting price"):null!==a&&a<5?s("Subscriber price must be at least $5"):null!==l&&null!==a&&l>=a?d(kL(),(0,er.toSentenceCase)(null!==(t=(0,nC.H$)(r))&&void 0!==t?t:"",!0)):null!==l&&null!==o&&l>=o?d(kz(),(0,er.toSentenceCase)(null!==(i=(0,nC.H$)(r))&&void 0!==i?i:"",!0)):null!==l&&l<5?d(kO(),(0,er.toSentenceCase)(null!==(n=(0,nC.H$)(r))&&void 0!==n?n:"",!0)):null},kq=e=>{var t,i,n,r,o,a;let{pub:l,settings:s,saveSettings:d,loading:c,meetingsEnabled:u,changeSetting:p}=e,{iString:h,iTemplate:m}=(0,Q.M1)(),{yearlyPlan:g}=kR(l.plans||l.draft_plans);if(!g||!g.amount)throw Error("Cannot configure meetings.");let v=(0,nC.H$)(l),b=null!==(t=s.selected_event_type)&&void 0!==t?t:null,y=b?b.price/100:null,f=Math.floor(2*g.amount/100),_=null;(null==b?void 0:b.subscriber_price)&&(_=(null==b?void 0:b.subscriber_price)/100);let w=null;(null==b?void 0:b.founding_price)&&(w=(null==b?void 0:b.founding_price)/100);let[C,x]=(0,A.eJ)(y),[S,k]=(0,A.eJ)(_),[B,T]=(0,A.eJ)(w),[I,P]=(0,A.eJ)(null!==(i=null==b?void 0:b.name)&&void 0!==i?i:null),[E,X]=(0,A.eJ)(null!==(n=null==b?void 0:b.uri)&&void 0!==n?n:null),M=E&&null!==(r=s.all_event_types.find(e=>e.uri===E))&&void 0!==r?r:null,D=C!==y||S!==_||B!==w||E!==(null!==(o=null==b?void 0:b.uri)&&void 0!==o?o:null)||I!==(null!==(a=null==b?void 0:b.name)&&void 0!==a?a:null),R=kV({pub:l,price:C,subscriberPrice:S,foundingPrice:B}),F=!!(null==b?void 0:b.uri)&&!!(null==b?void 0:b.price),L=async()=>{if(!u)try{await N().post("/api/v1/meetings/calendly/oauth/disconnect")}catch(e){window.alert(h("Failed to disconnect Calendly; please contact meetings@substackinc.com"))}finally{document.location.replace((0,j.wI3)(l,{section:"meetings"}))}};return(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(et.gq,{padding:24,gap:40,alignItems:"center",justifyContent:"space-between",className:kF.statusIndicator,children:(0,Z.tZ)(et.tu,{gap:4,children:F?(0,Z.BX)(et.gq,{justifyContent:"space-between",gap:64,alignItems:"center",children:[u?(0,Z.BX)("div",{children:[(0,Z.tZ)(ei.xv.H4,{paddingBottom:4,weight:"bold",translated:!0,children:"You're live!"}),(0,Z.BX)(ei.xv.B4,{paddingTop:4,translated:!0,children:["Readers can book meetings with you. See upcoming meetings in your"," ",(0,Z.tZ)("a",{href:(0,en.ciB)(l),children:"dashboard"}),". You can also"," ",(0,Z.tZ)("a",{target:"_blank",href:(0,en.szv)(l,{referrer:"undefined"!=typeof window&&window.location.href}),rel:"noopener",children:"view your meetings page"}),"."]}),(0,Z.BX)(ei.xv.B4,{paddingTop:16,translated:!0,children:["Next, write an announcement post:",(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{(0,U.j)(U.FP.MEETING_POST_TEMPLATE_CREATED,{publication_id:l.id}),(0,Y.uX)((0,j.qYj)(l,{type:"newsletter",template:"meetings-announce-post_post"}),{newTab:!0})},className:kF.templateButton,children:"Use template"})]}),(0,Z.BX)(ei.xv.B4,{paddingTop:16,translated:!0,children:["Having issues? Let us know at ",(0,Z.tZ)("a",{href:"mailto:meetings@substackinc.com",children:"meetings@substackinc.com"})]})]}):(0,Z.BX)("div",{children:[(0,Z.tZ)(ei.xv.H4,{weight:"bold",translated:!0,children:"You're ready to go live!"}),(0,Z.BX)(ei.xv.B4,{paddingTop:4,translated:!0,children:["As soon as you flip the switch, your readers will be able to book meetings with you. You can also"," ",(0,Z.tZ)("a",{target:"_blank",href:(0,en.szv)(l,{referrer:"undefined"!=typeof window&&window.location.href}),rel:"noopener",children:"preview your meetings page"}),"."]}),(0,Z.BX)(ei.xv.B4,{paddingTop:16,translated:!0,children:["Having issues? Let us know at ",(0,Z.tZ)("a",{href:"mailto:meetings@substackinc.com",children:"meetings@substackinc.com"})]})]}),(0,Z.tZ)(i2.rs,{checked:u,onChange:e=>p(e),disabled:!F||c})]}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.H4,{weight:"bold",translated:!0,children:"Welcome to the Meetings beta!"}),(0,Z.tZ)(ei.xv.B4,{paddingTop:4,translated:!0,children:"Begin by setting and saving an event type and a price for your meetings. Optionally, choose discounts for each of your subscription tiers."}),(0,Z.BX)(ei.xv.B4,{paddingTop:16,translated:!0,children:["Having issues? Let us know at ",(0,Z.tZ)("a",{href:"mailto:meetings@substackinc.com",children:"meetings@substackinc.com"})]})]})})}),(0,Z.BX)("div",{className:"settings-element",children:[(0,Z.tZ)(ei.xv.H4,{weight:"bold",translated:!0,children:"Calendly"}),(0,Z.BX)(ei.xv.B4,{paddingTop:4,children:[m(kU(),s.calendly_email||"")," (",(0,Z.tZ)("a",{href:"https://calendly.com/event_types/user/me",target:"_blank",rel:"noopener",className:kF.underlined,children:h("see account")})," ","|"," ",(0,Z.tZ)(tW.u,{style:{display:"inline"},disabled:!u,text:h("You must disable meetings before disconnecting your Calendly account."),preferPlacement:"top-center",children:(0,Z.tZ)("a",{onClick:L,className:kF.underlined,children:h("disconnect")})}),")"]})]}),(0,Z.BX)("div",{className:"settings-element",children:[(0,Z.tZ)(ei.xv.H4,{weight:"bold",translated:!0,children:"Meeting event type"}),s.all_event_types.length?(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(ei.xv.B4,{paddingTop:4,paddingBottom:8,translated:!0,children:["Choose an event type from your"," ",(0,Z.tZ)("a",{href:"https://calendly.com/event_types/user/me",target:"_blank",rel:"noopener",children:"Calendly account"}),"."]}),(0,Z.tZ)(gd,{options:s.all_event_types.map(e=>{let{uri:t,name:i}=e;return{value:t,label:i}}),placeholder:h("Select an event type"),isDisabled:c,value:M?{label:I,value:E}:null,onChange:e=>{let{label:t,value:i}=e;P(t),X(i)},className:kF.eventTypeSelect,variant:"light"}),(null==M?void 0:M.description_html)&&(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.tZ)("div",{className:kF.descriptionHtml,dangerouslySetInnerHTML:{__html:null==M?void 0:M.description_html.replace(/<br>/g,"")}})})]}):(0,Z.tZ)(et.hs,{children:(0,Z.BX)(ei.xv.B4,{paddingTop:4,paddingBottom:8,translated:!0,children:["No event types found. You can add an event type on your"," ",(0,Z.tZ)("a",{href:"https://calendly.com/event_types/user/me",target:"_blank",rel:"noopener",children:"Calendly dashboard"}),"."]})})]}),(0,Z.tZ)("div",{className:"settings-element",children:(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ei.xv.H4,{weight:"bold",translated:!0,children:"Price"}),(0,Z.tZ)(ei.xv.B4,{paddingBottom:8,translated:!0,children:"Set the default price for booking a meeting with you"}),(0,Z.tZ)(kA.Z,{disabled:c,className:kF.priceInput,name:"price",value:C,placeholder:(0,er.centsToPriceString)(100*f,(0,er.pubCurrency)(l)),onValueChange:(e,t,i)=>{x(Number(i.value))},allowNegativeValue:!1,decimalsLimit:2,step:5,allowDecimals:!(0,er.isZeroDecimalCurrency)((0,er.pubCurrency)(l)),prefix:(0,er.currencySymbol)((0,er.pubCurrency)(l))})]})}),"enabled"===l.payments_state&&(0,Z.tZ)("div",{className:"settings-element",children:(0,Z.tZ)(kJ,{label:h("Paid subscriber price"),description:h("Offer a discounted price to your paid subscribers"),price:S,seedPrice:Math.max(Math.floor((null!=C?C:f)*.8),5),setPrice:k,currency:(0,er.pubCurrency)(l),loading:c,name:"subscriber_price",disabled:null===S})}),v&&(0,Z.tZ)("div",{className:"settings-element",children:(0,Z.tZ)(kJ,{label:m(kY(),(0,er.toSentenceCase)(v,!0)),description:m(kH(),v),price:B,seedPrice:Math.max(Math.floor(S?.625*S:(null!=C?C:f)*.5),5),setPrice:T,currency:(0,er.pubCurrency)(l),name:"founding_price",loading:c,disabled:null===B})}),(0,Z.tZ)("div",{className:"settings-element",children:(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(ei.xv.B4,{color:"error",weight:"bold",children:R}),(0,Z.BX)(et.gq,{gap:8,children:[(0,Z.tZ)(tW.u,{disabled:!!M&&!!C,text:h("You must select an event type and price first."),preferPlacement:"top-center",children:(0,Z.tZ)(ee.zx,{priority:"primary",disabled:!D||!!R||c||!M||!C,onClick:()=>{d({event_type_uri:E,price:100*C,founding_price:B?100*B:null,subscriber_price:S?100*S:null})},children:c?h("Saving..."):!F||D?h("Save"):h("Saved")})}),(0,Z.tZ)(ee.zx,{priority:"secondary",disabled:!D||c,onClick:()=>{x(y),k(_),T(w),P(null==b?void 0:b.name),X(null==b?void 0:b.uri)},children:h("Cancel")})]})]})})]})};var kW=i(48928);function kG(e){let{children:t}=e;return(0,Z.tZ)(cl.t5,{children:t})}let kK=eb(e=>{let{user:t,publication:i,pub:n,oneClickMode:r}=e,{iString:o}=(0,Q.M1)();return(null==t?void 0:t.is_author)||(null==t?void 0:t.is_global_admin)?(0,Z.tZ)(cl.A,{children:(0,Z.tZ)(oH._R,{title:o("Notifications"),id:"notifications",children:(0,Z.tZ)(kW.t,{publication:i,pub:n,pubId:n.id,oneClickMode:r,ItemWrapper:kG})})}):null}),kQ=(e,t)=>{let{is_group:i,is_gift:n,paywallFreeTrialEnabled:r}=t;return!(!e||!e.valid||e.max_redemptions&&e.max_redemptions<=e.times_redeemed||e.group_only&&!i||e.redeem_by&&new Date(e.redeem_by)<new Date)&&(!("type"in e)||"FREE_TRIAL"!==e.type||!!r&&!n&&!i)},k$=(e,t)=>{var i,n;return!!e&&!!t&&(!("error"in e)||!e.error)&&(null===(i=t.metadata)||void 0===i||!i.unlimited_group)&&((null===(n=t.metadata)||void 0===n?void 0:n.no_coupons)?"founding_only"in e&&!!e.founding_only&&!!t.metadata.founding:"forever"!==t.interval&&(!e.yearly_only||"year"===t.interval)&&(!e.monthly_only||"month"===t.interval)&&("repeating"!==e.duration||("month"!==t.interval||!!eS()(e.duration_in_months)||e.duration_in_months%t.interval_count==0)&&("year"!==t.interval||!!eS()(e.duration_in_months)||e.duration_in_months%(12*t.interval_count)==0))&&(!e.amount_off||!e.currency||e.currency===t.currency)&&!0)},k0={};async function k1(e,t,i,n,r){let{required:o=!1,group:a=!1,gift:l=!1}=n;if(!i){r(null);return}i in k0||(r({id:i,required:o,loading:!0}),k0[i]=await k2(i));let s=k0[i],d=s&&"FREE_TRIAL"===s.type&&t&&await k4(i);r(d&&d.length&&o?{id:s&&s.id||i,code:s&&s.code,name:s&&s.name,required:o,error:!0,message:"This coupon has already been redeemed by this user."}:kQ(s,{is_group:a,is_gift:l,paywallFreeTrialEnabled:e.paywall_free_trial_enabled})&&(e.plans||[]).filter(e=>k$(s,e)).length>0?Object.assign({required:o},s):o?{id:s&&s.id||i,code:s&&s.code,name:s&&s.name,required:o,error:!0,message:"The coupon is not valid or has expired."}:null)}async function k2(e){try{return await (0,ix.rd)("/api/v1/coupon/".concat(e),{method:"get"})}catch(e){return console.error("Failed to fetch coupon:",e),null}}async function k4(e){try{return await (0,ix.rd)("/api/v1/coupon_redemption/".concat(e),{method:"get"})}catch(e){return console.error("Failed to fetch coupon redemptions:",e),null}}async function k3(){try{let e=await (0,ix.rd)("/api/v1/coupon",{query:{freeTrialCoupon:!0,includeInvalid:!0},method:"get"});return e&&e[0]?!1===e[0].valid?await (0,ix.rd)("/api/v1/coupon/".concat(e[0].id),{json:Object.assign({},e[0],{is_default:!1,is_group_default:!1,valid:!0}),method:"put"}):console.warn("Coupon id ".concat(e[0].id," already enabled but attempted to be enabled")):await (0,ix.rd)("/api/v1/coupon",{json:{name:"Want to keep reading?",description:"Subscribe now to get an exclusive 7-day free trial.",percent_or_trial:"on",trial_period_days:"7",percent_off:"",duration:"",duration_in_months:"",show_redeem_by:!1,redeem_by:"",show_code:!1,is_default:!1,is_group_default:!1,edu_only:!1,yearly_only:!1,group_only:!1,allowed_suffixes_checked:!1,type:"FREE_TRIAL"},method:"post"}),0}catch(e){return console.error("Failed to create free trial coupon:",e),1}}async function k8(){try{let e=await (0,ix.rd)("/api/v1/coupon",{query:{freeTrialCoupon:!0},method:"get"});e&&e[0]?await (0,ix.rd)("/api/v1/coupon/".concat(e[0].id),{json:Object.assign({},e[0],{is_default:!1,is_group_default:!1,valid:!1}),method:"put"}):console.error("No free trial coupon exists to disable")}catch(e){return console.error("Failed to disable free trial coupon:",e),null}}let k6=e=>{let{pledgeCount:t,opened:i,close:n}=e,{iString:r,iPlural:o}=(0,Q.M1)();return(0,Z.BX)(eK.u_,{isOpen:i,onClose:n,children:[(0,Z.tZ)(eK.fe,{children:(0,Z.tZ)(et.tu,{children:(0,Z.BX)(ei.xv.B2,{children:[o("Congratulations on going paid! Your pledge should convert to a paid subscription over the next few hours. ","Congratulations on going paid! Your %1 pledges should convert to paid subscriptions over the next few hours. ",t),(0,Z.tZ)(ei.xv.B2,{as:"a",href:"https://support.substack.com/hc/en-us/articles/11463706473108-What-are-Substack-Pledges",target:"_blank",rel:"noopener",style:{textDecoration:"underline"},translated:!0,children:"Learn more"})]})})}),(0,Z.tZ)(eK.mz,{direction:"column",primaryButton:(0,Z.tZ)(ee.zx,{onClick:n,children:r("Got it")})})]})};var k5=i(4878);let k9=()=>{let{iString:e}=(0,Q.M1)(),[t,i]=(0,A.eJ)(!1);return t?null:(0,Z.BX)("div",{className:"congrats-box buttons-below",children:[(0,Z.BX)("div",{className:"congrats-box-left",children:[(0,Z.tZ)("div",{className:"star",children:(0,Z.tZ)(D.Z,{strokeWidth:0})}),(0,Z.BX)("div",{className:"text",children:[(0,Z.tZ)("h4",{children:e("Let your readers know youâ€™ve gone paid")}),(0,Z.tZ)("h5",{children:e("Your paid Substack is more likely to succeed if you write an announcement post that explains what youâ€™re doing, why youâ€™re doing it, and what you think your readers will get out of it.")})]})]}),(0,Z.BX)("div",{className:"congrats-box-right",children:[(0,Z.BX)("a",{className:"button primary newsletter-create-button",href:"/publish/post?type=newsletter&launchAnnouncement=true",children:[(0,Z.tZ)(k5.Z,{width:24,height:24,stroke:"white"}),e("New post")]}),(0,Z.tZ)("button",{className:"button secondary",onClick:()=>i(!0),children:e("Maybe later")})]})]})},k7=e=>{let{pub:t,publication:i,openPauseModal:n,promptToLaunch:r,openPauseExtendModal:o,disabled:a}=e,{iString:l}=(0,Q.M1)();if(!t.draft_plans||"disconnecting"===t.payments_state)return null;if("paused"===t.payments_state)return(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(oH.sY,{primaryText:l("Subscription billing is paused"),secondaryText:l("When paused, new subscribers cannot pay and existing subscribers are not being charged. When you unpause, paid subscriptions will resume from where they left off.")}),(0,Z.BX)(et.gq,{gap:8,children:[(0,Z.tZ)(ee.zx,{priority:"primary",onClick:n,disabled:a,children:l("Unpause")}),"paused"===t.payments_state&&(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:o,disabled:a,children:l(t.pause_return_date?"Extend pause":"Choose date to unpause")})]})]})});if("pausing"===t.payments_state)return(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(oH.sY,{primaryText:l("Pausing subscription billing..."),secondaryText:l("Your request to pause paid subscriptions is being processed. This can take several hours, so we'll email you when it's done.")})});if("unpausing"===t.payments_state)return(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(oH.sY,{primaryText:l("Unpausing subscription billing..."),secondaryText:l("Your request to unpause paid subscriptions is being processed. This can take several hours, so we'll email you when it's done.")})});if(t.plans&&t.has_subscribers)return(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:l("Pause subscription billing"),secondaryText:l("Take a break from writing by pausing all paid subscriptions and preventing new ones. Unpause any time to resume billing as normal.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:n,disabled:a,children:l("Pause")})]})});return(0,Z.BX)(cl.t5,{children:[r&&(0,Z.tZ)(k9,{}),(0,Z.tZ)(xw,{publication:i,title:l("Enable paid subscriptions"),subtitle:l("Let readers pay to subscribe to your Substack."),field:"payments_state",valueToProp:e=>e?"enabled":"disabled",propToValue:e=>"enabled"===e,setToTrueWarning:t.first_enabled_payments_at?l("Are you sure you want to re-enable payments?"):null,setToFalseWarning:l("Are you sure? This won't affect existing paid subscriptions, but will prevent new ones."),inverted:!1,onSuccess:()=>{let e=new URL(window.location).searchParams;e.delete("promptToLaunch"),window.location.search=e.toString()}})]})},Be={numberInput:"numberInput-wr96Cs"},Bt=e=>{let{numPostsAddedToPaywall:t,numPostsRemovedFromPaywall:i,archivePeriod:n}=e;return t?"".concat((0,er.pluralize)(t,"post")," paywalled"):i?"".concat((0,er.pluralize)(i,"paywall")," removed"):n?"Auto-paywall date updated":"Paywalls removed"},Bi=e=>{let{publicationSettings:t}=e,{iString:i,iPlural:n}=(0,Q.M1)(),r=(0,iN.pm)(),[o,a]=(0,A.eJ)(null),[l,s]=(0,A.eJ)(2),[d,c]=(0,A.eJ)("week"),[u,p]=(0,A.eJ)(!1),[h,m]=(0,A.eJ)(null),[g,v]=(0,A.eJ)(!1);(0,A.d4)(()=>{let{enable_archive_paywall:e}=t;if(e){let[t,i]=e.split("-");s(Number(t)),c(i),v(!0),a(e)}},[t]);let b=async e=>{if(!e){if(!confirm("Are you sure you want to disable auto-paywalling? This will make all auto-paywalled posts available to everyone."))return;p(!0);try{let e=await N().post("/api/v1/publication/archive_posts").send({archivePeriod:null});r.popToast(t=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},t),{Icon:eE.Z,text:Bt(e.body)}))),a(null),v(!1)}catch(e){304!==e.status&&(m((0,Y.zx)(e)),console.error(e))}p(!1)}v(e)},y=async()=>{p(!0);try{var e,t;let i=g?"".concat(l,"-").concat(d):null,n=await N().post("/api/v1/publication/archive_posts").send({archivePeriod:i});r.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{Icon:eE.Z,text:Bt(n.body)}))),a(null!==(t=null===(e=n.body)||void 0===e?void 0:e.archivePeriod)&&void 0!==t?t:null)}catch(e){304!==e.status&&(m((0,Y.zx)(e)),console.error(e))}p(!1)},w="".concat(l,"-").concat(d),C=!!o!==g||g&&w!==o;return(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(et.tu,{id:"paywallArchives",gap:12,children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:(0,Z.tZ)(et.gq,{alignItems:"center",gap:8,children:i("Auto-paywall older posts")}),secondaryText:(0,Z.BX)(Z.HY,{children:[i("Automatically paywall posts older than a certain time period. "),(0,Z.tZ)(ei.hh,{target:"_blank",decoration:"underline",rel:"noopener",native:!0,href:"https://support.substack.com/hc/en-us/articles/9503089884308",children:i("Learn more")})]})}),(0,Z.tZ)(i2.ZP,{checked:g,onChange:()=>b(!g)})]}),g&&(0,Z.tZ)(et.tu,{radius:"md",border:"detail",paddingY:8,paddingX:16,shadow:"xs",bg:"primary",children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:(0,Z.tZ)(et.gq,{alignItems:"center",gap:8,children:i("Auto-paywall after")})}),(0,Z.BX)(et.hs,{alignItems:"center",gap:8,children:[(0,Z.tZ)(tD.oi,{type:"number",min:1,placeholder:"2",value:String(l),className:Be.numberInput,onChange:e=>s(parseInt(e.currentTarget.value))}),(0,Z.BX)("select",{className:S_.selectDropdown,onChange:e=>c(e.currentTarget.value),value:d,children:[(0,Z.tZ)("option",{value:"day",children:n("Day","Days",l)}),(0,Z.tZ)("option",{value:"week",children:n("Week","Weeks",l)}),(0,Z.tZ)("option",{value:"month",children:n("Month","Months",l)}),(0,Z.tZ)("option",{value:"year",children:n("Year","Years",l)})]})]})]})}),C&&(0,Z.BX)(et.hs,{alignItems:"center",justifyContent:h?"space-between":"start",gap:8,paddingTop:4,children:[!h&&g&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ee.zx,{priority:"secondary",disabled:u,onClick:()=>{let{enable_archive_paywall:e}=t;v(!!e)},children:i("Cancel")}),(0,Z.tZ)(ee.zx,{priority:"primary",disabled:u,onClick:y,children:i("Save")})]}),h&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",color:"error",children:i("There was an error saving your changes. Please try again.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>m(null),children:i("OK")})]})]})]})})};function Bn(e){let{href:t,className:i}=e;return(0,Z.BX)(et.hs,{as:"a",alignItems:"center",justifyContent:"center",paddingX:12,href:t,className:k()("stripeConnect-p6Ww90",i),children:["Connect with",(0,Z.tZ)("svg",{xmlns:"http://www.w3.org/2000/svg",height:24,viewBox:"0 0 468 222.5",children:(0,Z.tZ)("path",{class:"st0",fill:"white",d:"M414 113.4c0-25.6-12.4-45.8-36.1-45.8-23.8 0-38.2 20.2-38.2 45.6 0 30.1 17 45.3 41.4 45.3 11.9 0 20.9-2.7 27.7-6.5v-20c-6.8 3.4-14.6 5.5-24.5 5.5-9.7 0-18.3-3.4-19.4-15.2h48.9c0-1.3.2-6.5.2-8.9zm-49.4-9.5c0-11.3 6.9-16 13.2-16 6.1 0 12.6 4.7 12.6 16h-25.8zM301.1 67.6c-9.8 0-16.1 4.6-19.6 7.8l-1.3-6.2h-22v116.6l25-5.3.1-28.3c3.6 2.6 8.9 6.3 17.7 6.3 17.9 0 34.2-14.4 34.2-46.1-.1-29-16.6-44.8-34.1-44.8zm-6 68.9c-5.9 0-9.4-2.1-11.8-4.7l-.1-37.1c2.6-2.9 6.2-4.9 11.9-4.9 9.1 0 15.4 10.2 15.4 23.3 0 13.4-6.2 23.4-15.4 23.4zM223.8 61.7l25.1-5.4V36l-25.1 5.3zM223.8 69.3h25.1v87.5h-25.1zM196.9 76.7l-1.6-7.4h-21.6v87.5h25V97.5c5.9-7.7 15.9-6.3 19-5.2v-23c-3.2-1.2-14.9-3.4-20.8 7.4zM146.9 47.6l-24.4 5.2-.1 80.1c0 14.8 11.1 25.7 25.9 25.7 8.2 0 14.2-1.5 17.5-3.3V135c-3.2 1.3-19 5.9-19-8.9V90.6h19V69.3h-19l.1-21.7zM79.3 94.7c0-3.9 3.2-5.4 8.5-5.4 7.6 0 17.2 2.3 24.8 6.4V72.2c-8.3-3.3-16.5-4.6-24.8-4.6C67.5 67.6 54 78.2 54 95.9c0 27.6 38 23.2 38 35.1 0 4.6-4 6.1-9.6 6.1-8.3 0-18.9-3.4-27.3-8v23.8c9.3 4 18.7 5.7 27.3 5.7 20.8 0 35.1-10.3 35.1-28.2-.1-29.8-38.2-24.5-38.2-35.7z"})})]})}let Br=e=>{let{loading:t,plans:i,accountError:n,showDisconnect:r,reloadPlans:o,account:a,user:l}=e,{iString:s}=(0,Q.M1)();return i&&!n&&r&&(a||t)?(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:s("Manage Stripe account"),secondaryText:t?s("Loading..."):a&&(0,Z.BX)(Z.HY,{children:[s("Your Stripe account is connected."),(null==l?void 0:l.is_global_admin)&&o&&(0,Z.BX)(Z.HY,{children:[" ",(0,Z.tZ)(lx.hh,{decoration:"underline",onClick:o,children:"Refresh"})]})]})}),a&&(0,Z.tZ)(ee.zx,{priority:"secondary",href:"https://dashboard.stripe.com/".concat(a.id),disabled:t,newTab:!0,children:s("View account")})]})}):null},Bo=e=>{var t;let{plan:i,percentOff:n}=e,r=null!==(t=null==i?void 0:i.amount)&&void 0!==t?t:0;return r-.01*n*r},Ba={editOpenNodeSettings:"editOpenNodeSettings-yMhGAU",inputContainer:"inputContainer-QSZJ8v",input:"input-w9SGxc",priceInput:"priceInput-moyMx9",currencySelect:"currencySelect-xJCNRy"};function Bl(){let e=(0,G._)(["Allow founding members to select an amount less than suggested, but more than your annual plan."]);return Bl=function(){return e},e}function Bs(){let e=(0,G._)(["Offer a discount on subscriptions purchased in groups of "," or more. "]);return Bs=function(){return e},e}class Bd extends w.Component{renderPlans(e){let{saving:t,newMonthlyValue:i,newYearlyValue:n,setMonthlyValue:r,setYearlyValue:o,hasNewRates:a,saveNewRates:l,organizedPlans:s,setMonthlyCurrency:d,setYearlyCurrency:c,newMonthlyCurrency:u,newYearlyCurrency:p,account:h,cancelNewRates:m,showSubmit:g}=e,{monthlyPlan:v,yearlyPlan:b,customPlans:y,empty:f}=s,{iString:_}=this.context;return(0,Z.BX)(Z.HY,{children:[f?(0,Z.tZ)("span",{children:this.context.iString("No plans found")}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(oH.Uo,{title:_("Plans")})}),v&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:_("Monthly plan price"),secondaryText:_("The amount monthly paid subscribers pay per month.")}),(0,Z.BX)(et.gq,{className:k()("planInput",Ba.inputContainer),alignSelf:"start",children:[(0,Z.tZ)(tD.oi,{type:"text",readOnly:t,value:null!=i?i:void 0,onChange:r,onInput:r,className:k()(Ba.priceInput,Ba.input)}),(0,Z.tZ)(Bh,{disabled:t,value:null!=u?u:void 0,onChange:d,onInput:d,isIndianAccount:!!h&&"IN"===h.country})]})]})}),b&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:_("Annual plan price"),secondaryText:_("The amount annual paid subscribers pay per year.")}),(0,Z.BX)(et.gq,{className:k()("planInput",Ba.inputContainer),alignSelf:"start",children:[(0,Z.tZ)(tD.oi,{type:"text",readOnly:t,value:null!=n?n:void 0,onChange:o,onInput:o,className:k()(Ba.priceInput,Ba.input)}),(0,Z.tZ)(Bh,{disabled:t,value:null!=p?p:void 0,onChange:c,onInput:c,isIndianAccount:!!h&&"IN"===h.country})]})]})}),y.map(e=>(0,Z.tZ)(et.gq,{children:(0,Z.tZ)(ei.xv.B3,{children:e.metadata&&e.metadata.short_description||e.name||e.nickname||e.id})}))]}),a&&g&&(0,Z.BX)(et.gq,{gap:8,alignItems:"center",children:[(0,Z.tZ)(ee.zx,{"data-testid":"save-plan-button",priority:"primary",onClick:l,disabled:t,children:t?this.context.iString("Saving..."):this.context.iString("Save")}),(0,Z.tZ)(ee.zx,{"data-testid":"cancel-plan-button",priority:"secondary",onClick:m,disabled:t,children:this.context.iString("Cancel")})]})]})}render(e,t){let{user:i,stripe_error:n,showDisconnect:r,plans:o,loading:a,accountError:l,accountErrorStatus:s,account:d,reloadPlans:c}=e,{}=t,{iString:u}=this.context;return(0,Z.BX)(Z.HY,{children:[(n||l)&&(0,Z.BX)(ei.xv.B4,{color:"error",children:[n||l," ",403===s&&(0,Z.tZ)("a",{href:"/api/v1/stripe/authorize",native:!0,children:u("Connect an account")})]}),d&&"IN"===d.country&&(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Paid subscriptions are currently in beta for writers in India. During this time, India-based writers can still add paid subscriptions but Substack does not currently charge a fee (you will still be charged a fee by our payment processor). Please note that Substack's 10% fee will eventually apply once India-based paid subscriptions are out of beta. Additionally, while India-based paid subscriptions are in beta, India-based writers can only accept payment in Indian Rupees (INR)."}),(0,Z.tZ)(Br,{loading:a,plans:o,accountError:l,showDisconnect:r,reloadPlans:(d||o)&&c,account:d,user:i}),!a&&!d&&!l&&!o&&(0,Z.tZ)(cl.t5,{"data-testid":"connect-stripe-setting",children:(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:this.context.iString("Connect Stripe"),secondaryText:(0,Z.tZ)(et.tu,{gap:12,children:(0,Z.BX)("div",{children:[this.context.iString("Takes about 5 minutes. This is how money from subscribers gets to your bank account. Stripe may display your business phone number and address on subscriber invoices unless hidden. "),(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us/articles/4405482746132-How-do-I-set-up-my-Stripe-account-to-start-receiving-payments-",target:"_blank",rel:"noopener noreferrer",children:this.context.iString("Learn more")})]})})}),(0,Z.tZ)(Bn,{href:"/api/v1/stripe/authorize"})]})}),!a&&(d||o)&&this.renderPlans(this.props)]})}}(0,M._)(Bd,"contextType",Q.wj);class Bc extends w.Component{render(e){let{pub:t,showSubmit:i,foundingAmountInputValue:n,founding_plan_name:r,minimumInputValue:o,saving:a,setFoundingPlanNameState:l,setFoundingPlanValueState:s,hasValidPlans:d,founding_plan_enabled:c,hasChanges:u,newYearlyValue:p,newYearlyCurrency:h,toggleFoundingPlanEnabled:m,setFoundingPlanMinimum:g,saveFoundingPlanInfo:v,cancelFoundingChanges:b}=e;return!t.draft_plans||!t.founding_plan_enabled&&!d||["thepillar","thepillartest99"].includes(t.subdomain)?null:(0,Z.BX)(Z.HY,{children:[!c&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:this.context.iString("Founding plan"),secondaryText:this.context.iString("Add a founding plan to let your most loyal subscribers pay even more. Founding plans renew annually.")}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>m(!0),children:this.context.iString("Add plan")})]})}),c&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:this.context.iString("Founding plan price"),secondaryText:(0,Z.BX)(Z.HY,{children:[this.context.iString("The amount founding members pay per year. "),(0,Z.tZ)(ei.hh,{decoration:"underline",cursor:"pointer",onClick:()=>m(!1),children:this.context.iString("Remove plan")})]})}),(0,Z.BX)(et.gq,{className:k()("planInput",Ba.inputContainer),alignSelf:"start",children:[(0,Z.tZ)(tD.oi,{type:"text",readOnly:a,value:null!=n?n:void 0,onChange:s,onInput:s,className:k()(Ba.priceInput,Ba.input)}),(0,Z.tZ)(Bh,{disabled:!0,value:null!=h?h:void 0})]})]})}),c&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:this.context.iString("Founding plan name"),secondaryText:this.context.iString("Give your founding plan a custom name.")}),(0,Z.tZ)(tD.oi,{type:"text",maxLength:24,readOnly:a,value:r,onChange:l,onInput:l})]})}),c&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:this.context.iString("Flexible founding plan pricing"),secondaryText:h&&p?this.context.iTemplate(Bl()):this.context.iString("Allow founding members to select an amount less than suggested.")}),(0,Z.tZ)(i2.ZP,{checked:!o||(0,er.dollarStringToCents)(o)<(0,er.dollarStringToCents)(n),onChange:e=>g(e),disabled:a})]})}),u&&i&&(0,Z.BX)(et.gq,{gap:8,alignItems:"center",children:[(0,Z.tZ)(ee.zx,{priority:"primary",onClick:v,disabled:a,children:a?this.context.iString("Savingâ€¦"):this.context.iString("Save")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:b,disabled:a,children:this.context.iString("Cancel")})]})]})}}(0,M._)(Bc,"contextType",Q.wj);class Bu extends w.Component{componentDidMount(){this.loadOpenNodeAccount()}getCurrency(){let e=this.props.pub.draft_plans;if(!e)return"usd";let t=e.find(e=>"year"===e.interval)||e[0];return t?t.currency:"usd"}canLoadOpenNodeAccount(){let{pub:e}=this.props;return!!e.draft_plans&&(!!(0,eW.default)("bitcoin_enabled")||e.bitcoin_plan)}render(){let{loadingOpenNodeAccount:e,openNodeAccount:t}=this.state;return this.canLoadOpenNodeAccount()?(0,Z.BX)("li",{className:"settings-element bitcoin-plan",children:[(0,Z.tZ)("h3",{children:"Bitcoin plan"}),(0,Z.BX)("p",{children:["This plan allows your readers to subscribe using Bitcoin."," ",!t&&"Complete the following steps to get started:"]}),e?(0,Z.tZ)("p",{children:"Loadingâ€¦"}):t?this.renderBitcoinPlanOptions():this.renderOpenNodeSetup()]}):null}constructor(e,t){var i;super(e,t),i=this,(0,M._)(this,"INTERVALS",["month:3","month:6","year:1"]),(0,M._)(this,"track",e=>{let{user:t,pub:i}=this.props;(0,U.j)(e,{user_id:t.id,publication_id:i.id})}),(0,M._)(this,"loadOpenNodeAccount",()=>(0,Y.Se)(this,"loadingOpenNodeAccount",async()=>{if(this.canLoadOpenNodeAccount())try{let e=await N().get("/api/v1/opennode/account");this.setState({openNodeAccount:e.body})}catch(e){alert((0,Y.zx)(e))}})),(0,M._)(this,"saveApiKey",()=>(0,Y.Se)(this,"savingApiKey",async()=>{try{await N().post("/api/v1/opennode/account").send({api_key:this.state.typedApiKey}),window.location.reload()}catch(e){alert((0,Y.zx)(e))}})),(0,M._)(this,"getBitcoinPlanFields",function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.state,t={},{pub:n}=i.props;for(let i of["enabled","prefer_bitcoin","amount","interval","interval_count"])t[i]=eS()(e[i])?n.bitcoin_plan&&n.bitcoin_plan[i]:e[i];if("string"==typeof e.planAmountInputValue&&(t.amount=(0,er.dollarStringToCents)(e.planAmountInputValue)),"string"==typeof e.planIntervalInputValue){let[i,n]=e.planIntervalInputValue.split(":");t.interval=i,t.interval_count=Number(n)}return t}),(0,M._)(this,"getOpenNodeFields",function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.state,t={},{openNodeAccount:n}=i.state;if(n)for(let i of["auto_settle","api_key"])t[i]=eS()(e[i])?n[i]:e[i];return t}),(0,M._)(this,"getFields",function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.state;return Object.assign(i.getBitcoinPlanFields(e),i.getOpenNodeFields(e))}),(0,M._)(this,"hasChanges",()=>{let e=this.getFields({}),t=this.getFields();return!eC()(e,t)}),(0,M._)(this,"cancelBitcoinPlanChanges",()=>{let e={},{pub:t}=this.props;for(let t of Object.keys(this.getFields()))e[t]=void 0;e.planAmountInputValue=(0,er.centsToDollarString)(t.bitcoin_plan.amount),e.planIntervalInputValue="".concat(t.bitcoin_plan.interval,":").concat(t.bitcoin_plan.interval_count),e.isEditingOpenNodeAccount=!1,this.setState(e)}),(0,M._)(this,"saveChanges",()=>(0,Y.Se)(this,"savingPlan",async e=>{let t=this.getBitcoinPlanFields(e),i=this.getOpenNodeFields(e);try{await N().put("/api/v1/opennode/account").send(i),await N().put("/api/v1/publication/bitcoin_plan").send(t),window.location.reload()}catch(e){console.error("Failed to update bitcoin payment plan:",e),alert((0,Y.zx)(e))}})),(0,M._)(this,"renderOpenNodeSetup",()=>{let{typedApiKey:e,savingApiKey:t}=this.state;return(0,Z.tZ)("p",{children:(0,Z.BX)("ol",{children:[(0,Z.BX)("li",{children:["Create an OpenNode account"," ",(0,Z.tZ)("a",{href:"https://app.opennode.com/signup",onClick:()=>this.track(U.FP.OPENNODE_ACCOUNT_SIGNUP_CLICKED),target:"_blank",rel:"noopener",children:"here"})]}),(0,Z.BX)("li",{children:["Create an API key"," ",(0,Z.tZ)("a",{href:"https://app.opennode.com/developers/integrations?newKey",onClick:()=>this.track(U.FP.OPENNODE_GENERATE_API_KEY_CLICKED),target:"_blank",rel:"noopener",children:"here"})]}),(0,Z.BX)("li",{children:["Paste your API key below",(0,Z.tZ)("br",{}),(0,Z.tZ)("br",{}),(0,Z.tZ)("input",{type:"text",placeholder:"Paste API key here",onInput:e=>this.setState({typedApiKey:e.target.value}),value:e}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:this.saveApiKey,disabled:t,children:t?"Savingâ€¦":"Save"})]})]})})}),(0,M._)(this,"renderOpenNodeOptions",()=>{if(!(0,eW.default)("pub_update_opennode_api_key"))return null;let{isEditingOpenNodeAccount:e,savingPlan:t}=this.state;return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)("div",{className:Ba.editOpenNodeSettings,children:[(0,Z.tZ)("b",{children:"OpenNode API key"}),e?(0,Z.tZ)("input",{type:"text",disabled:!e,readOnly:t,onChange:e=>this.setState({api_key:e.target.value.trim()}),onInput:e=>this.setState({api_key:e.target.value.trim()})}):(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>this.setState({isEditingOpenNodeAccount:!e}),children:"Set new key"})]}),(0,Z.tZ)("p",{children:"Typically, you only need to provide your API key when setting up your Bitcoin plan. You can set a new key here if necessary."})]})}),(0,M._)(this,"renderBitcoinPlanOptions",()=>{let{planIntervalInputValue:e,savingPlan:t,planAmountInputValue:i}=this.state,n=this.getFields();return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)("p",{children:[(0,Z.tZ)("b",{children:"Plan Duration"}),(0,Z.tZ)("select",{className:"select",onChange:e=>this.setState({planIntervalInputValue:e.target.value,enabled:!0}),value:e,children:this.INTERVALS.includes(e)?[]:nT()([e]).concat(this.INTERVALS).map(e=>{let[t,i]=e.split(":");return eS()(t)||eS()(i)?(console.warn("failed to collect interval and intervalCount from value",e),null):(0,Z.tZ)("option",{value:e,children:(0,er.pluralize)(Number(i),t)})})})]}),(0,Z.BX)("p",{children:[(0,Z.tZ)("b",{children:"Plan Pricing"}),(0,Z.tZ)("input",{className:"number",type:"text",readOnly:t,value:i,onChange:e=>this.setState({planAmountInputValue:e.target.value,enabled:!0}),onInput:e=>this.setState({planAmountInputValue:e.target.value,enabled:!0})}),(0,Z.tZ)(Bh,{className:"currency",disabled:!0,value:this.getCurrency()})]}),(0,Z.BX)("p",{children:["Bitcoin plan subscribers will pay this amount in BTC at the current"," ",(0,Z.tZ)("a",{href:"https://help.opennode.com/en/articles/3179796-where-are-opennode-s-bitcoin-exchange-rates-sourced-from",target:"_blank",children:"conversion rate"}),"."]}),(0,Z.tZ)("p",{children:"Bitcoin plan subscribers will receive paid subscriptions for this duration. Please note Bitcoin plans do not auto-renew."}),(0,Z.BX)("p",{children:[(0,Z.tZ)("b",{children:"Settlement"}),(0,Z.BX)("select",{onChange:e=>{this.setState({auto_settle:"true"===e.target.value,enabled:!0})},value:n.auto_settle?"true":"false",children:[(0,Z.tZ)("option",{value:"true",children:"Automatically convert BTC to USD"}),(0,Z.tZ)("option",{value:"false",children:"Keep payments as BTC"})]})]}),(0,Z.BX)("p",{children:["Bitcoin plan payments arrive in your"," ",(0,Z.tZ)("a",{href:"https://app.opennode.com/dashboard",target:"_blank",children:"OpenNode wallet"})," ","as BTC, but you can auto-settle to USD if you prefer."]}),(0,Z.BX)("p",{children:[(0,Z.tZ)("input",{type:"checkbox",checked:n.prefer_bitcoin,onChange:()=>this.setState({prefer_bitcoin:!n.prefer_bitcoin,enabled:!0})})," ","Present the Bitcoin plan to potential subscribers as the default payment option."]}),this.renderOpenNodeOptions(),this.hasChanges()&&(0,Z.BX)("div",{className:"save-buttons",children:[(0,Z.tZ)(ee.zx,{priority:"primary",onClick:this.saveChanges,disabled:t,children:t?"Savingâ€¦":"Save"}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:this.cancelBitcoinPlanChanges,disabled:t,children:"Cancel"})]}),n.enabled&&!this.hasChanges()?(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:()=>this.setState({enabled:!1}),children:"Turn off Bitcoin plan"}):(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>this.setState({enabled:!0}),children:"Turn on Bitcoin plan"})]})});let{bitcoin_plan:n}=e.pub;this.state={planAmountInputValue:(0,er.centsToDollarString)((null==n?void 0:n.amount)||5e3),planIntervalInputValue:n?"".concat(n.interval,":").concat(n.interval_count):"year:1",enabled:!!n&&n.enabled,prefer_bitcoin:!!n&&n.prefer_bitcoin,isEditingOpenNodeAccount:!1}}}class Bp extends w.Component{_getBenefits(e){let t={};for(let i of["paid_subscription_benefits","free_subscription_benefits","founding_subscription_benefits"])t[i]=e[i].map(e=>e.trim()).filter(e=>e);return t}getDefaultBenefits(){return this._getBenefits(this.props.pub)}getUpdatedBenefits(){return this._getBenefits(this.state.benefits)}isChanged(){return!eC()(this.getDefaultBenefits(),this.getUpdatedBenefits())}canSave(){return!!this.isChanged()&&0!==this.getUpdatedBenefits().paid_subscription_benefits.length&&0!==this.getUpdatedBenefits().free_subscription_benefits.length}render(){var e;let t=this.state.benefits.paid_subscription_benefits.slice(0);for(;t.length<this.MIN_PAID_SUBSCRIPTION_BENEFITS;)t.push("");let i=this.state.benefits.free_subscription_benefits.slice(0);for(;i.length<this.MIN_FREE_SUBSCRIPTION_BENEFITS;)i.push("");let n=this.state.benefits.founding_subscription_benefits.slice(0);for(;n.length<this.MIN_FOUNDING_SUBSCRIPTION_BENEFITS;)n.push("");return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(oH.Uo,{title:this.context.iString("Benefits")}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.xQ,{children:[(0,Z.tZ)(oH.sY,{primaryText:this.context.iString("Free subscriber benefits"),secondaryText:this.context.iString("Let free subscribers know what they'll get out of their subscription")}),i.map((e,t)=>(0,Z.tZ)(tD.oi,{type:"text",maxLength:128,readOnly:this.state.saving,value:e,placeholder:this.context.iString("Add a free benefit..."),onChange:e=>this.onChange(e,"free_subscription_benefits",t),onInput:e=>this.onChange(e,"free_subscription_benefits",t)}))]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.xQ,{children:[(0,Z.tZ)(oH.sY,{primaryText:this.context.iString("Paid subscriber benefits"),secondaryText:this.context.iString("Let paid subscribers know what they'll get out of their subscription")}),t.map((e,t)=>(0,Z.tZ)(tD.oi,{type:"text",maxLength:128,readOnly:this.state.saving,value:e,placeholder:(()=>{switch(t){case 1:return this.context.iString("Add a second paid benefit...");case 2:return this.context.iString("Add a third paid benefit...");default:return this.context.iString("Add a paid benefit...")}})(),onChange:e=>this.onChange(e,"paid_subscription_benefits",t),onInput:e=>this.onChange(e,"paid_subscription_benefits",t)}))]})}),(null===(e=this.props.pub.draft_plans)||void 0===e?void 0:e.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.xQ,{children:[(0,Z.tZ)(oH.sY,{primaryText:this.context.iString("Founding member benefits"),secondaryText:this.context.iString("Let founding members know what they'll get out of their subscription")}),n.map((e,t)=>(0,Z.tZ)(tD.oi,{type:"text",maxLength:128,readOnly:this.state.saving,value:e,placeholder:this.context.iString("Add a founding benefit..."),onChange:e=>this.onChange(e,"founding_subscription_benefits",t),onInput:e=>this.onChange(e,"founding_subscription_benefits",t)}))]})}),this.isChanged()&&(0,Z.BX)(et.gq,{gap:8,children:[(0,Z.tZ)(ee.zx,{priority:"primary",onClick:this.saveChanges,disabled:this.state.saving||!this.canSave(),children:this.state.saving?this.context.iString("Savingâ€¦"):this.context.iString("Save")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:this.cancelFoundingChanges,disabled:this.state.saving,children:this.context.iString("Cancel")})]})]})}constructor(e,t){super(e,t),(0,M._)(this,"MIN_PAID_SUBSCRIPTION_BENEFITS",3),(0,M._)(this,"MIN_FREE_SUBSCRIPTION_BENEFITS",1),(0,M._)(this,"MIN_FOUNDING_SUBSCRIPTION_BENEFITS",1),(0,M._)(this,"onChange",(e,t,i)=>(0,Y.nn)(this,async n=>{let r=n.benefits[t];for(;i>=r.length;)r.push("");r[i]=e.target.value,this.setState({benefits:n.benefits})})),(0,M._)(this,"cancelFoundingChanges",()=>{this.setState({benefits:this.getDefaultBenefits()})}),(0,M._)(this,"saveChanges",()=>(0,Y.nn)(this,async e=>{if(!e.saving){this.setState({saving:!0});try{await N().put("/api/v1/publication").send(this.getUpdatedBenefits()),window.location.reload()}catch(e){console.error("Failed to update subscription benefits:",e),alert((0,Y.zx)(e)),this.setState({saving:!1})}}})),(0,oo.HD)({pub:e.pub})&&(this.MIN_PAID_SUBSCRIPTION_BENEFITS=8,this.MIN_FOUNDING_SUBSCRIPTION_BENEFITS=5),this.state={benefits:this.getDefaultBenefits()}}}(0,M._)(Bp,"contextType",Q.wj);let Bh=e=>{let{className:t="",disabled:i=!1,value:n,onChange:r,onInput:o,isIndianAccount:a=!1}=e;n=(n||(a?"inr":"usd")).toLowerCase();let l=a?["inr"]:er.SUPPORTED_CURRENCIES.concat(er.SUPPORTED_CURRENCIES.includes(n)?[]:[n]);return(0,Z.tZ)("select",{className:k()(S_.selectDropdown,Ba.currencySelect,t),disabled:i,value:n,onChange:r,onInput:o,children:l.map(e=>(0,Z.tZ)("option",{value:e,children:e.toUpperCase()},e))})},Bm=e=>{let t={};return null==e||e.forEach(e=>{let{currency:i,currency_options:n,interval_count:r,interval:o,metadata:a}=e;n&&("month"===o&&1===r?Object.entries(n).forEach(e=>{let[n,r]=e;n!==i&&(t[n]=(0,_._)((0,f._)({},t[n]),{currency:n,monthly_price:r.unit_amount}))}):(null==a?void 0:a.founding)?Object.entries(n).forEach(e=>{let[n,r]=e;n!==i&&(t[n]=(0,_._)((0,f._)({},t[n]),{currency:n,founding_price:r.unit_amount}))}):"year"===o&&1===r&&Object.entries(n).forEach(e=>{let[n,r]=e;n!==i&&(t[n]=(0,_._)((0,f._)({},t[n]),{currency:n,yearly_price:r.unit_amount}))}))}),t},Bg=e=>{let{automaticallyEnable:t}=e,{iString:i}=(0,Q.M1)(),{getSettingFor:n,changeSetting:r}=(0,ss.So)(),[o,a]=(0,A.eJ)(!1),[l,s]=(0,A.eJ)(!!n("use_local_currency"));(0,A.d4)(()=>{t&&!l&&(r({use_local_currency:!0,local_currency_modal_seen:!0}),s(!0))},[]);let d=async e=>{a(!0),s(e);try{await r({use_local_currency:e})}catch(t){alert((0,Y.zx)(t)),s(!e)}a(!1)};return(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:i("Automatically localize prices"),secondaryText:(0,Z.BX)(Z.HY,{children:[i("Displays all prices in the subscribers' local currency. "),(0,Z.tZ)(ei.hh,{decoration:"underline",target:"_blank",href:"https://support.substack.com/hc/en-us/articles/16523703337108",children:i("Learn more")})]})}),(0,Z.tZ)(i2.ZP,{checked:l,disabled:o,onChange:d,name:"local-currencies-enabled"})]})})},Bv=e=>{let{plans:t}=e,i=(0,io.xR)(),{iString:n}=(0,Q.M1)(),[r,o]=(0,A.eJ)(!1),[a,l]=(0,A.eJ)(null!=t?t:[]),s=i.getConfigFor("disable_monthly_subscriptions"),d=i.getConfigFor("disable_annual_subscriptions");(0,A.d4)(()=>{let{monthlyPlan:e,yearlyPlan:i}=kR(t),{monthlyPlan:n,yearlyPlan:r}=kR(a);n&&(e&&e.amount!==n.amount||i&&r&&i.amount!==r.amount)&&l(nT()([...null!=t?t:[],a.find(e=>{var t;return null==e?void 0:null===(t=e.metadata)||void 0===t?void 0:t.founding})]))},[t,a]);let c=Bm(a);return(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.xQ,{children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Supported currencies"),secondaryText:(0,Z.BX)(Z.HY,{children:[n("Substack will convert prices to these currencies using the latest exchange rates. "),(0,Z.tZ)(ei.hh,{decoration:"underline",target:"_blank",href:"https://support.substack.com/hc/en-us/articles/16523703337108",children:n("Learn more")})]})}),(0,Z.tZ)(ee.hU,{priority:"tertiary",size:"sm",onClick:()=>o(!r),children:r?(0,Z.tZ)(iv.Z,{size:20}):(0,Z.tZ)(ib.Z,{size:20})})]}),(0,Z.tZ)(ik.H,{expanded:r,children:(0,Z.tZ)(Bb,{currencyOptionsMap:c,disableMonthlySubscriptions:s,disableAnnualSubscriptions:d,allPlans:a})})]})})},Bb=e=>{let{currencyOptionsMap:t,disableMonthlySubscriptions:i,disableAnnualSubscriptions:n,allPlans:r}=e,{iString:o}=(0,Q.M1)();return(0,Z.tZ)(et.tu,{paddingTop:16,gap:16,children:(0,Z.tZ)(u9,{appendMode:!0,hasMoreRows:!1,cols:nT()([{key:"currency",name:o("Currency"),sortable:!1,valueFn:e=>e.currency.toUpperCase()},!i&&{key:"monthly_price",name:o("Monthly"),sortable:!1,valueFn:e=>(0,er.centsToPriceString)(e.monthly_price,e.currency),align:"right"},!n&&{key:"yearly_price",name:o("Annual"),sortable:!1,valueFn:e=>(0,er.centsToPriceString)(e.yearly_price,e.currency),align:"right"},(null==r?void 0:r.find(e=>{var t;return null==e?void 0:null===(t=e.metadata)||void 0===t?void 0:t.founding}))&&{key:"founding_price",name:o("Founding"),sortable:!1,valueFn:e=>(0,er.centsToPriceString)(e.founding_price,e.currency),align:"right"}]),rows:Object.values(t)})})},By=()=>{let{getSettingFor:e,changeSetting:t}=(0,ss.So)(),[i,n]=(0,A.eJ)(e("disable_optimistic_bank_payments")),[r,o]=(0,A.eJ)(!1),{iString:a}=(0,Q.M1)(),l=async e=>{o(!0),n(!e);try{await t({disable_optimistic_bank_payments:!e})}catch(t){alert((0,Y.zx)(t)),n(e)}o(!1)};return(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:a("Accept direct debit payments"),secondaryText:a("Direct debit payments can take 5-14 business days to clear, and readers can access paid content during this period. You can disable direct debit payments if the content behind your paywall is especially sensitive.")}),(0,Z.tZ)(i2.ZP,{checked:!i,disabled:r,onChange:l,name:"optimistic-payments-disabled"})]})})},Bf=e=>{let{saving:t,freeTrialsEnabled:i,toggleFreeTrialsEnabled:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(!1),l=async e=>{a(!0);try{await n(e)}catch(e){console.error("Failed to set free trial setting:",e)}finally{a(!1)}};return(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Offer 7-day free trials in paywall"),secondaryText:(0,Z.BX)(Z.HY,{children:[r("Offering a trial coupon can increase conversion 10-20% on average. "),(0,Z.tZ)(ei.hh,{decoration:"underline",target:"_blank",href:"https://support.substack.com/hc/en-us/articles/4418620510100",children:r("Learn more")})]})}),(0,Z.tZ)(i2.ZP,{checked:i,disabled:t||o,onChange:e=>l(e),name:"free-trials-enabled"})]})})};function B_(e){let{saving:t,boostEnabled:i,toggleBoostEnabled:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Enable Substack Boost"),secondaryText:(0,Z.BX)(Z.HY,{children:[r("Automatically show discounts and special offers at the right moment to maximize your revenue. "),(0,Z.tZ)(ei.hh,{decoration:"underline",href:"https://support.substack.com/hc/en-us/articles/4418620510100",children:r("Learn more")})]})}),(0,Z.tZ)(i2.ZP,{checked:null!=i&&i,disabled:t,onChange:n,name:"boost_enabled"})]})})}function BZ(e){let{saving:t,referralsEnabled:i,toggleReferralsEnabled:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Enable reader referral program"),secondaryText:(0,Z.BX)(Z.HY,{children:[r("Reward subscribers for sharing your Substack with others. "),(0,Z.tZ)(ei.hh,{decoration:"underline",href:"https://support.substack.com/hc/en-us/articles/8946512015892",target:"_blank",rel:"noopener",children:r("Learn more")})]})}),(0,Z.tZ)(i2.ZP,{checked:null!=i&&i,disabled:t,onChange:n,name:"referrals_enabled"})]})})}let Bw=e=>{let{minimumGroupSize:t,setMinimumGroupSize:i,saving:n,hasGroupSizeChanges:r,saveMinimumGroupSizeSettings:o,onCancel:a}=e,{iString:l}=(0,Q.M1)();return(0,Z.BX)(cl.t5,{children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:l("Minimum group size")}),(0,Z.tZ)(et.gq,{alignItems:"center",gap:8,children:(0,Z.tZ)(tD.oi,{"data-testid":"minimum-group-size",className:Ba.priceInput,type:"text",readOnly:n,value:t,onChange:i,onInput:i})})]}),r&&(0,Z.BX)(et.gq,{gap:8,alignItems:"center",children:[(0,Z.tZ)(ee.zx,{priority:"primary",onClick:o,disabled:n,children:l(n?"Savingâ€¦":"Save group size")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:a,disabled:n,children:l("Cancel")})]})]})},BC=e=>{var t;let{defaultGroupCoupon:i,groupSubscriptionPercentOff:n,pub:r,setGroupSubscriptionPercentOff:o,saveGroupSubscriptionSettings:a,saving:l}=e,{iString:s,iTemplate:d}=(0,Q.M1)(),[c,u]=(0,A.eJ)(!!i),p=n?n.split(".")[0]:"",h=Number(p)!==Number(r.default_group_coupon_percent_off);return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:s("Group subscription discount"),secondaryText:d(Bs(),null!==(t=r.minimum_group_size)&&void 0!==t?t:2)}),!c&&(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>u(!0),children:s("Add group discount")})]})}),c&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:s("Discount per seat"),secondaryText:i&&(0,Z.tZ)(ei.hh,{decoration:"underline",href:"/publish/offers/".concat(i),children:s("See details")})}),(0,Z.BX)(et.gq,{alignItems:"center",gap:8,children:[(0,Z.tZ)(tD.oi,{"data-testid":"group-coupon-percent-off",className:Ba.priceInput,type:"text",readOnly:l,value:p,onChange:o,onInput:o}),(0,Z.tZ)(ei.xv.B2,{weight:"medium",children:"%"})]})]})}),h&&c&&(0,Z.BX)(et.gq,{gap:8,alignItems:"center",children:[(0,Z.tZ)(ee.zx,{priority:"primary",onClick:a,disabled:l,children:s(l?"Savingâ€¦":"Save discount")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>u(!1),disabled:l,children:s("Cancel")})]})]})};function Bx(){let e=(0,G._)(["When turned on, readers of "," will be able to pledge to pay for a future paid subscription to ",""]);return Bx=function(){return e},e}let BS=e=>{var t;let{pub:i}=e,{iString:n,iTemplate:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(!1),[l,s]=(0,A.eJ)([]),[d,c]=(0,A.eJ)(""),u=(0,ss.So)(),[p,h]=(0,A.eJ)(null===(t=u.getSettingFor("payment_pledges_enabled"))||void 0===t||t),m=async()=>{a(!0);try{let{body:e}=await N().get("/api/v1/pledges/plans"),t=(0,Y.er)(e.payment_pledge_plans);s(t),h(e.enabled),c("")}catch(e){c((0,Y.zx)(e))}finally{a(!1)}};(0,A.d4)(()=>{m()},[]);let g=(0,A.I4)(m,[s]),v=(0,A.I4)(async e=>{let{monthly_price:t,yearly_price:i,founding_price:n,currency:r}=e,o=(0,Y.lf)(t,i,n,r);if(o){c(o);return}a(!0);try{let{body:e}=await N().post("/api/v1/pledges/plans").send({yearly_price:i,monthly_price:t,founding_price:n,currency:r}),o=(0,Y.er)(e.payment_pledge_plans);s(o),c("")}catch(e){c((0,Y.zx)(e))}finally{a(!1)}},[s]);return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(oH.Uo,{title:n("Pledges")}),(0,Z.BX)(cl.t5,{children:[o?(0,Z.tZ)(et.gq,{paddingY:24,justifyContent:"center",children:(0,Z.tZ)(ei.xv.B3,{translated:!0,children:"Loading..."})}):(0,Z.tZ)(xw,{id:"enable-pledges",publication:{payment_pledges_enabled:p},title:n("Allow readers to pledge subscriptions"),field:"payment_pledges_enabled",endpoint:"/api/v1/publication_settings",onSuccess:g,subtitle:r(Bx(),i.name,i.name)}),"undefined"!=typeof window&&!o&&!!p&&(null==l?void 0:l.length)>0&&(0,Z.tZ)(Bk,{pledgePlans:l,savePledgePlans:v,loading:o,error:d})]})]})},Bk=e=>{let{pledgePlans:t,savePledgePlans:i,loading:n,error:r}=e,{iString:o}=(0,Q.M1)(),a=t.find(e=>"month"===e.interval),l=t.find(e=>"year"===e.interval&&!e.is_founding),s=t.find(e=>"year"===e.interval&&e.is_founding),[d,c]=(0,A.eJ)((null==a?void 0:a.currency)||"usd"),u=e=>"".concat((0,er.centsToDollarString)(e*((0,er.isZeroDecimalCurrency)(d)?100:1))),[p,h]=(0,A.eJ)("".concat(u((null==a?void 0:a.amount)||8))),[m,g]=(0,A.eJ)("".concat(u((null==l?void 0:l.amount)||80))),[v,b]=(0,A.eJ)("".concat(u((null==s?void 0:s.amount)||150))),y=e=>{c(e.currentTarget.value)},f=d!==((null==a?void 0:a.currency)||"usd")||Number(p)!==Number(u((null==a?void 0:a.amount)||8))||Number(m)!==Number(u((null==l?void 0:l.amount)||80))||Number(v)!==Number(u((null==s?void 0:s.amount)||150));return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:o("Monthly pledge amount"),secondaryText:o("The amount pledged subscribers are asked to pay per month.")}),(0,Z.BX)(et.gq,{className:k()("planInput",Ba.inputContainer),children:[(0,Z.tZ)(tD.oi,{type:"text",readOnly:n,value:p,onChange:e=>h(e.currentTarget.value),onInput:e=>h(e.currentTarget.value),className:k()(Ba.priceInput,Ba.input)}),(0,Z.tZ)(Bh,{disabled:n,value:d,onChange:y,onInput:y})]})]}),(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:o("Annual pledge amount"),secondaryText:o("The amount pledged subscribers are asked to pay per year.")}),(0,Z.BX)(et.gq,{className:k()("planInput",Ba.inputContainer),children:[(0,Z.tZ)(tD.oi,{type:"text",readOnly:n,value:m,onChange:e=>g(e.currentTarget.value),onInput:e=>g(e.currentTarget.value),className:k()(Ba.priceInput,Ba.input)}),(0,Z.tZ)(Bh,{disabled:n,value:d,onChange:y,onInput:y})]})]}),(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:o("Founding pledge amount"),secondaryText:o("The amount pledged founding members are asked to pay per year.")}),(0,Z.BX)(et.gq,{className:k()("planInput",Ba.inputContainer),children:[(0,Z.tZ)(tD.oi,{type:"text",readOnly:n,value:v,onChange:e=>b(e.currentTarget.value),onInput:e=>b(e.currentTarget.value),className:k()(Ba.priceInput,Ba.input)}),(0,Z.tZ)(Bh,{disabled:n,value:d,onChange:y,onInput:y})]})]}),r&&(0,Z.tZ)(ei.xv.B4,{color:"error",weight:"bold",children:r}),f&&(0,Z.BX)(et.gq,{alignItems:"center",gap:8,children:[(0,Z.tZ)(ee.zx,{priority:"primary",disabled:!f||n,onClick:()=>{i({monthly_price:Number(p),yearly_price:Number(m),founding_price:Number(v),currency:d})},children:o(n?"Saving...":f?"Save":"Saved")}),(0,Z.tZ)(ee.zx,{priority:"secondary",disabled:!f||n,onClick:()=>{h("".concat(u((null==a?void 0:a.amount)||8))),g("".concat(u((null==l?void 0:l.amount)||80))),b("".concat(u((null==s?void 0:s.amount)||150))),c((null==a?void 0:a.currency)||"usd")},children:o("Cancel")})]})]})};var BB=i(74691),BT=i.n(BB);let BI=e=>{let{onSave:t,onSetLimit:i,limit:n,primaryText:r,secondaryText:o,disabled:a}=e;return(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r,secondaryText:o}),(0,Z.tZ)(tD.oi,{style:{maxWidth:100},type:"number",min:0,max:50,value:n,disabled:a,onInput:e=>i(Number(e.currentTarget.value)),onBlur:t})]})},BN=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),{getConfigFor:n}=(0,io.xR)(),[r,o]=(0,A.eJ)(!1),{getSettingFor:a,changeSetting:l}=(0,ss.So)(),[s,d]=(0,A.eJ)({post_metering_anon_limit:Number(a("post_metering_anon_limit"))||0,post_metering_free_subscriber_limit:Number(a("post_metering_free_subscriber_limit"))||0});if(!(n("post_metering_enabled")&&(0,oo.HD)({pub:t})))return null;let c=!!a("post_metering_enabled"),u=(e,t)=>{d((0,_._)((0,f._)({},s),{[e]:t}))},p=async()=>{o(!0);let e=BT()(s.post_metering_anon_limit,0,50),t=BT()(s.post_metering_free_subscriber_limit,0,50);await l({post_metering_anon_limit:String(e),post_metering_free_subscriber_limit:String(t)}),d({post_metering_anon_limit:e,post_metering_free_subscriber_limit:t}),o(!1)};return(0,Z.BX)(cl.t5,{children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:i("Enable post metering"),secondaryText:i("Allow anonymous users and free subscribers to view a limited number of posts before registering or subscribing.")}),(0,Z.tZ)(i2.ZP,{checked:c,onChange:e=>{l({post_metering_enabled:e})}})]}),c&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(BI,{primaryText:i("Anonymous reader limit"),disabled:r,secondaryText:i("The number of free or paid posts an anonymous user can read before being prompted to sign up."),onSetLimit:e=>{u("post_metering_anon_limit",e)},limit:s.post_metering_anon_limit,onSave:p}),(0,Z.tZ)(BI,{primaryText:i("Free subscriber limit"),disabled:r,secondaryText:i("The number of paid posts a free subscriber can read before being prompted to subscribe."),onSetLimit:e=>{u("post_metering_free_subscriber_limit",e)},limit:s.post_metering_free_subscriber_limit,onSave:p})]})]})},BP=e=>{var t;let{settingName:i,primaryText:n,secondaryText:r}=e,[o,a]=(0,A.eJ)(!1),{getSettingFor:l}=(0,ss.So)(),[s,d]=(0,A.eJ)(null===(t=l(i))||void 0===t||t),c=(0,A.I4)(async e=>{var t;a(!0);let n=await N().put("/api/v1/publication_settings").send({[i]:e});(null==n?void 0:null===(t=n.body)||void 0===t?void 0:t.length)===1&&d(n.body[0].value_bool),a(!1)},[d,a]);return(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n,secondaryText:r}),(0,Z.tZ)(i2.ZP,{checked:s,onChange:()=>c(!s),disabled:o})]})})},BE=e=>{let{settingName:t,primaryText:i,secondaryText:n,trueText:r,falseText:o}=e,[a,l]=(0,A.eJ)(!1),{getSettingFor:s}=(0,ss.So)(),[d,c]=(0,A.eJ)(s(t)===r),u=(0,A.I4)(async e=>{var i;l(!0);let n=await N().put("/api/v1/publication_settings").send({[t]:e?r:o});(null==n?void 0:null===(i=n.body)||void 0===i?void 0:i.length)===1&&c(n.body[0].value_text===r),l(!1)},[c,l]);return(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:i,secondaryText:n}),(0,Z.tZ)(i2.ZP,{checked:d,onChange:()=>u(!d),disabled:a})]})})};var BX=i(12048),BM=i(57640);let BA=e=>{var t;let{pub:i}=e,{getSettingFor:n}=(0,ss.So)(),{iString:r}=(0,Q.M1)(),{getConfigFor:o}=(0,io.xR)(),[a,l]=(0,A.eJ)(!!(null===(t=i.draft_iap_advanced_plans)||void 0===t?void 0:t.length)),[s,d]=(0,A.eJ)(!1),[c,u]=(0,A.eJ)(!1),p=n("iap_advanced_plans_initial_setting");if(!o("iap_advanced_commerce_in_publisher_dash")&&!p||!i.stripe_country||-1===er.STRIPE_COUNTRIES_WITH_TRANSFERS_ENABLED.indexOf(i.stripe_country))return null;let h=async e=>{d(!0);try{e?p?await N().post("/api/v1/iap_advanced_plans").send({increasePrices:"increase"===p,currency:"usd"}):u(!0):(await N().delete("/api/v1/iap_advanced_plans"),l(!1))}catch(e){alert((0,Y.zx)(e))}finally{d(!1),e&&p&&window.location.reload()}};return(0,Z.BX)(cl.t5,{children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Enable in-app payments"),secondaryText:(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(ei.xv.B4,{translated:!0,color:"secondary",children:["Let people pay for subscriptions in the Substack app."," ",(0,Z.tZ)(ei.hh,{href:"https://support.substack.com/hc/en-us/articles/19718129670420-Can-my-subscribers-pay-on-the-Substack-iOS-app",target:"_blank",color:"secondary",style:{textDecoration:"underline"},children:"Learn more"})]})})}),(0,Z.tZ)(i2.ZP,{checked:a,disabled:s,onChange:h,name:"in-app-purchases-disabled"})]}),!!a&&(0,Z.BX)(oH.he,{children:[" ",(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("In-app pricing options"),secondaryText:r("Choose how to price subscriptions in the Substack app. ")}),(0,Z.tZ)(ee.hU,{priority:"tertiary",children:(0,Z.tZ)(uY.Z,{size:20,onClick:()=>u(!0)})})]})})]}),(0,Z.tZ)(BD,{isOpen:c,setOpen:u})]})},BD=e=>{let{isOpen:t,setOpen:i}=e,{iString:n}=(0,Q.M1)(),{getSettingFor:r}=(0,ss.So)(),o=r("iap_advanced_plans_initial_setting"),[a,l]=(0,A.eJ)(!o||"increase"===o),s=()=>{l(!0),i(!1)},d=async()=>{try{await N().post("/api/v1/iap_advanced_plans").send({increasePrices:a,currency:"usd"}),i(!1),window.location.reload()}catch(e){alert((0,Y.zx)(e))}};return(0,Z.BX)(eK.u_,{isOpen:t,onClose:s,children:[(0,Z.tZ)(eK.xB,{title:n("In-app pricing options"),description:(0,Z.tZ)(BX.V.Description,{as:"span",children:(0,Z.BX)(ei.xv.B3,{translated:!0,color:"secondary",children:["Apple and Google charge additional fees to use in-app purchases on their platforms. Choose how youâ€™d like to handle these fees."," ",(0,Z.tZ)(ei.hh,{href:"https://support.substack.com/hc/en-us/articles/19718129670420-Can-my-subscribers-pay-on-the-Substack-iOS-app",target:"_blank",color:"secondary",style:{textDecoration:"underline"},children:"Learn more"})]})}),showClose:!1}),(0,Z.tZ)(eK.ex,{}),(0,Z.tZ)(tX.iz,{}),(0,Z.BX)(et.tu,{gap:12,padding:20,children:[(0,Z.tZ)(BR,{value:"Increase prices",checked:a,onClick:()=>l(!0),title:n("Adjust prices for in-app purchases"),subTitle:n("You'll earn approximately the same on all platforms."),children:(0,Z.tZ)(et.hs,{children:(0,Z.tZ)(tA.__,{bg:"secondary",radius:"sm",padding:4,children:(0,Z.tZ)(ei.xv.B5,{weight:"semibold",lineHeight:16,children:n("Recommended")})})})}),(0,Z.tZ)(BR,{value:"Keep prices same",checked:!a,onClick:()=>l(!1),title:n("Keep prices the same"),subTitle:n("Subscribers will pay approximately the same amount on all platforms")})]}),(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(eK.ex,{}),(0,Z.tZ)(eK.mz,{primaryButton:o?"increase"===o&&a||"keep"===o&&!a?(0,Z.tZ)(ee.zx,{priority:"primary",onClick:s,children:n("Continue")}):(0,Z.tZ)(ee.zx,{priority:"primary",onClick:d,children:n("Update settings")}):(0,Z.tZ)(ee.zx,{priority:"primary",onClick:d,children:n("Enable in-app payments")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:s,children:n("Cancel")})})]})},BR=e=>{let{title:t,subTitle:i,value:n,checked:r,onClick:o,children:a}=e;return(0,Z.tZ)(et.hs,{gap:12,padding:12,outline:"detail",radius:"md",children:(0,Z.tZ)("label",{style:{width:"100%"},children:(0,Z.BX)(et.gq,{gap:12,justifyContent:"space-between",userSelect:"none",cursor:"pointer",children:[(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.B3,{fontSize:15,weight:"semibold",children:t}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",size:13,children:i}),a]}),(0,Z.tZ)(BM.Y,{value:n,checked:r,onClick:o})]})})})},BF=e=>{var{stroke:t="white"}=e,i=(0,ef._)(e,["stroke"]);return(0,Z.BX)(eH.l,(0,_._)((0,f._)({name:"TriangleAlert",svgParams:{height:20,width:21,fill:"none",stroke:t}},i),{children:[(0,Z.tZ)("path",{d:"M9.07514 3.21684L2.01681 15.0002C1.87128 15.2522 1.79428 15.5379 1.79346 15.8289C1.79265 16.12 1.86805 16.4061 2.01216 16.6589C2.15627 16.9118 2.36408 17.1225 2.6149 17.27C2.86571 17.4176 3.15081 17.497 3.44181 17.5002H17.5585C17.8495 17.497 18.1346 17.4176 18.3854 17.27C18.6362 17.1225 18.844 16.9118 18.9881 16.6589C19.1322 16.4061 19.2076 16.12 19.2068 15.8289C19.206 15.5379 19.129 15.2522 18.9835 15.0002L11.9251 3.21684C11.7766 2.97193 11.5674 2.76944 11.3178 2.62891C11.0682 2.48838 10.7866 2.41455 10.5001 2.41455C10.2137 2.41455 9.93208 2.48838 9.68248 2.62891C9.43287 2.76944 9.2237 2.97193 9.07514 3.21684V3.21684Z","stroke-width":"1.66667","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M10.5 7.5V10.8333","stroke-width":"1.66667","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M10.5 14.1665H10.5083","stroke-width":"1.66667","stroke-linecap":"round","stroke-linejoin":"round"})]}))};function BL(){let e=(0,G._)(["Consider enabling your founding plan"]);return BL=function(){return e},e}function Bz(){let e=(0,G._)(["Consider allowing prices below your founding plan's suggested price"]);return Bz=function(){return e},e}function BO(){let e=(0,G._)(["You have "," pledges at ","/month (or ","/year)"]);return BO=function(){return e},e}function BU(){let e=(0,G._)(["You're setting a higher price than ","/month for your subscriptions. This means your pledges won't convert automatically. Consider switching to ","/month"]);return BU=function(){return e},e}function BY(){let e=(0,G._)(["You have "," pledges at ","/month"]);return BY=function(){return e},e}function BH(){let e=(0,G._)(["You're setting a higher price than ","/month for your subscriptions. This means your pledges won't convert automatically. Consider switching to ","/month"]);return BH=function(){return e},e}function Bj(){let e=(0,G._)(["You have "," pledges at ","/year"]);return Bj=function(){return e},e}function BJ(){let e=(0,G._)(["You're setting a higher price than ","/year for your subscriptions. This means your pledges won't convert automatically. Consider switching to ","/year"]);return BJ=function(){return e},e}function BV(){let e=(0,G._)(["You have "," pledges in currencies other than ",""]);return BV=function(){return e},e}function Bq(){let e=(0,G._)(["You're setting a different currency than your existing pledges. This means your pledges won't convert automatically. Consider switching to ","."]);return Bq=function(){return e},e}let BW=e=>{let{pledgeSummary:t,newMonthlyValue:i,newYearlyValue:n,newCurrency:r,foundingPlanEnabled:o,minimumInputValue:a}=e,{iString:l,iTemplate:s,iPlural:d}=(0,Q.M1)(),c=(0,ss.So)(),[u,p]=(0,A.eJ)(!!c.getSettingFor("accept_mismatched_pledges"));if(!r)return(0,Z.tZ)(Z.HY,{});let h=[],m=0,g=0,v=Number(i)*((0,er.isZeroDecimalCurrency)(r)?1:100),b=Number(n)*((0,er.isZeroDecimalCurrency)(r)?1:100),y=Number(a)*((0,er.isZeroDecimalCurrency)(r)?1:100);for(let e of Object.keys(t))if(e.toLowerCase()!==r.toLowerCase()){let i=0;for(let n of Object.keys(t[e]))for(let r of Object.keys(t[e][n]))i+=t[e][n][r];i>0&&(m+=i,h.push(e))}let f=0,_=0,w=0,C=0,x=0,S=0,k=t[r.toLowerCase()];if(k)for(let e of Object.keys(k))for(let t of Object.keys(k[e]))if("month"===t){if(Number(e)<v){let i=k[e][t];g+=i,Number(e)>f&&i>0&&(f=Number(e),_=i)}}else if("year"===t){if(Number(e)<b){let i=k[e][t];g+=i,Number(e)>w&&i>0&&(w=Number(e),C=i)}}else"founding"===t&&(o?y&&Number(e)<y&&(x+=k[e][t]):S+=k[e][t]);if(0===m&&0===g&&0===S&&0===x)return(0,Z.tZ)(Z.HY,{});let B="",T="";return S>0?(B=d("You have ".concat(S," pledge at your founding plan"),"You have ".concat(S," pledges at your founding plan"),S),T=S?s(BL()):""):x>0?(B=d("You have ".concat(x," pledge below your founding plan"),"You have ".concat(x," pledges below your founding plan"),x),T=s(Bz())):g>0?f>0&&w>0?(B=s(BO(),_+C,(0,er.centsToPriceString)(f,r),(0,er.centsToPriceString)(w,r)),T=s(BU(),(0,er.centsToPriceString)(f,r),(0,er.centsToPriceString)(f,r))):f>0?(B=s(BY(),_,(0,er.centsToPriceString)(f,r)),T=s(BH(),(0,er.centsToPriceString)(f,r),(0,er.centsToPriceString)(f,r))):w>0&&(B=s(Bj(),C,(0,er.centsToPriceString)(w,r)),T=s(BJ(),(0,er.centsToPriceString)(w,r),(0,er.centsToPriceString)(w,r))):m>0&&(B=s(BV(),m,r),T=s(Bq(),h.join(", "))),(0,U.j)(U.FP.PAYMENT_PLEDGE_PRICE_WARNING_SEEN,{numCurrencyDelinquent:m,numPriceDelinquent:g,totalLostPledges:m+g}),(0,Z.BX)(et.tu,{padding:24,gap:24,radius:"md",bg:"secondary",children:[(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.tZ)(et.hs,{children:(0,Z.tZ)(BF,{height:24,stroke:"#404040"})}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.H4,{color:"primary",children:B}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:T})]})]}),(0,Z.tZ)(xw,{title:l("Accept pledges at any price"),subtitle:l("When turned on, all pledges will automatically convert to paid subscriptions, even if they're smaller than your new subscription price"),publication:{accept_mismatched_pledges:u},endpoint:"/api/v1/publication_settings",field:"accept_mismatched_pledges",onSuccess:p})]})},BG={footer:"footer-qrxNMw"};class BK extends w.Component{async componentDidMount(){let{onLoadStripeAccount:e}=this.props;try{let t=await N().get("/api/v1/stripe/account");this.setState({account:t.body.account}),this.setPlans(t.body.plans),e&&e(t.body.account)}catch(e){if(!e.response||404!==e.response.statusCode){var t;console.error("Failed to fetch Stripe account:",e),(0,U.j)(U.FP.SETUP_PLANS_PAGE_FAILED,{errorMessage:null==e?void 0:e.message,userFacingMessage:(0,Y.zx)(e)}),this.setState({accountError:(0,Y.zx)(e),accountErrorStatus:null===(t=e.response)||void 0===t?void 0:t.statusCode})}}try{let e=(await N().get("/api/v1/pledges/plans/summary")).body;this.setState({pledgePlans:e.plans}),this.setState({pledgeSummary:e.pledgeSummary}),this.setState({pledgeCount:e.pledgeCount})}catch(e){e.response&&404===e.response.statusCode||console.error("Failed to fetch pledges:",e)}if(this.props.full_page_version)try{(await N().get("/api/v1/has_publication_staff")).body.hasPublicationStaff&&this.setState({hasPublicationStaff:!0})}catch(e){e.response&&404===e.response.statusCode||console.error("Failed to fetch publication staff:",e)}}render(e,t){var i;let{pub:n,user:r,stripe_error:o,full_page_version:a,iString:l,embedded:s}=e,{plans:d,account:c,boostEnabled:u,referralsEnabled:p,pledgeSummary:h,hasPublicationStaff:m}=t,g=!0;(c||d)&&(g=!1);let v=a?cl.A:w.Fragment;return(0,Z.tZ)(v,{children:(0,Z.BX)(et.tu,{className:k()("subscription-plan-page"),alignItems:a?"center":void 0,paddingX:16*!!a,children:[(0,Z.BX)(et.tu,{gap:20,maxWidth:a?560:void 0,paddingBottom:a?20:void 0,sizing:"border-box",children:[a&&(0,Z.tZ)(ei.xv.H3,{paddingTop:20,children:l("Set up paid subscriptions")}),a&&m?(0,Z.tZ)(et.gq,{bg:"secondary",radius:"md",padding:16,gap:12,children:(0,Z.BX)(ei.xv.B3,{translated:!0,color:"secondary",children:["Please note that by default, Stripe will show your phone number and address on subscriber invoices. We do not recommend using your personal contact information in your Stripe account."," ",(0,Z.tZ)("a",{href:"https://dashboard.stripe.com/settings/update/public/support-details",style:{color:"inherit"},target:"_blank",children:"Update public details"})]})}):null,(0,Z.tZ)(Bd,(0,f._)({pub:n,user:null!=r?r:null,stripe_error:o,showDisconnect:!a,showSubmit:!a,setMonthlyValue:this.setMonthlyValue,setYearlyValue:this.setYearlyValue,reloadPlans:this.reloadPlans,hasNewRates:this.hasNewRates(),saveNewRates:this.saveNewRates,organizedPlans:kR(d),setMonthlyCurrency:this.setMonthlyCurrency,setYearlyCurrency:this.setYearlyCurrency,cancelNewRates:this.cancelNewRates},this.state)),(a||c)&&h&&"disabled"===n.payments_state&&(0,Z.tZ)(BW,{pledgeSummary:h,newMonthlyValue:this.state.newMonthlyValue,newCurrency:this.state.newMonthlyCurrency,newYearlyValue:this.state.newYearlyValue,foundingPlanEnabled:this.state.founding_plan_enabled,minimumInputValue:this.state.minimumInputValue}),(0,Z.tZ)(Bc,(0,f._)({pub:n,showSubmit:!a,setFoundingPlanNameState:this.setFoundingPlanNameState,hasValidPlans:this.hasValidPlans(),hasChanges:this.hasChanges(),setFoundingPlanMinimum:this.setFoundingPlanMinimum,setFoundingPlanValueState:this.setFoundingPlanValueState,saveFoundingPlanInfo:this.saveFoundingPlanInfo,toggleFoundingPlanEnabled:this.toggleFoundingPlanEnabled,cancelFoundingChanges:this.cancelFoundingChanges},this.state)),n.draft_plans&&!s&&(0,Z.tZ)(Bp,{pub:n,paidBenefits:!0,foundingBenefits:!0}),!g&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(oH.Uo,{title:l("Group subscriptions")}),(0,Z.tZ)(Bw,{minimumGroupSize:this.state.minimumGroupSize,saving:this.state.saving,setMinimumGroupSize:this.setMinimumGroupSize,hasGroupSizeChanges:"".concat(this.state.minimumGroupSize)!=="".concat(n.minimum_group_size),saveMinimumGroupSizeSettings:this.saveMinimumGroupSizeSettings,onCancel:()=>{this.setState({minimumGroupSize:n.minimum_group_size.toString()})}})]}),!g&&!s&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(BC,{groupSubscriptionPercentOff:this.state.defaultGroupCouponPercentOff,defaultGroupCoupon:this.state.defaultGroupCoupon,pub:n,setGroupSubscriptionPercentOff:this.setGroupSubscriptionPercentOff,saveGroupSubscriptionSettings:this.saveGroupDiscountSettings,saving:this.state.saving}),(0,Z.tZ)(oH.Uo,{title:l("Billing")}),(0,Z.tZ)(BA,{pub:n}),(0,Z.tZ)(By,{}),(0,Z.tZ)(Bg,{automaticallyEnable:"disabled"===n.payments_state&&!!a}),(0,Z.tZ)(Bv,{plans:null!==(i=this.state.plans)&&void 0!==i?i:null})]}),a&&!g&&!s&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(oH.Uo,{title:l("Growth features")}),(0,Z.tZ)(B_,{saving:this.state.saving,boostEnabled:u,toggleBoostEnabled:()=>{this.setState({boostEnabled:!this.state.boostEnabled})}}),(0,Z.tZ)(BZ,{saving:this.state.saving,referralsEnabled:p,toggleReferralsEnabled:()=>{this.setState({referralsEnabled:!this.state.referralsEnabled})}})]})]}),a&&(0,Z.BX)(et.tu,{paddingY:20,paddingX:{mobile:16,desktop:0},width:560,justifyContent:"center",bg:"primary",sizing:"border-box",gap:12,borderTop:"detail",className:BG.footer,children:[(0,Z.tZ)(ee.zx,{disabled:this.state.saving,onClick:()=>{this.setState({saving:!0}),(0,U.j)(U.FP.PAYMENT_SETUP_BUTTON_CLICKED,{enabled:!0}),this.saveNewRates({payments_state:"enabled"})},priority:"primary",children:l("Enable payments")}),(0,Z.tZ)(ee.zx,{onClick:()=>{(0,U.j)(U.FP.PAYMENT_SETUP_BUTTON_CLICKED,{enabled:!1}),this.saveNewRates({payments_state:"disabled"})},priority:"secondary",children:l("Enable payments later")})]})]})})}constructor(e){var t,i,n;super(e),t=this,(0,M._)(this,"state",void 0),(0,M._)(this,"reloadPlans",e=>{let{iString:t}=this.props;e.preventDefault(),this.state.saving||this.setState({loading:!0},()=>{N().post("/api/v1/stripe/update_plans").then(e=>{this.setPlans(e.body)}).catch(e=>{console.error(e),alert(t("Error reloading plans"))}).then(()=>{this.setState({loading:!1})})})}),(0,M._)(this,"setPlans",function(e){let{init:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{monthlyPlan:n,yearlyPlan:r}=kR(e||t.state.plans),o={newMonthlyValue:n?(0,er.centsToDollarString)(n.amount):null,newMonthlyCurrency:n?n.currency:null,newYearlyValue:r?(0,er.centsToDollarString)(r.amount):null,newYearlyCurrency:r?r.currency:null,plans:e};i?Object.assign(t.state,o):t.setState(o)}),(0,M._)(this,"setMonthlyCurrency",e=>{this.setState({newMonthlyCurrency:e.currentTarget.value,newYearlyCurrency:e.currentTarget.value})}),(0,M._)(this,"setMonthlyValue",e=>{this.setState({newMonthlyValue:e.currentTarget.value})}),(0,M._)(this,"setYearlyCurrency",e=>{this.setState({newMonthlyCurrency:e.currentTarget.value,newYearlyCurrency:e.currentTarget.value})}),(0,M._)(this,"setYearlyValue",e=>{this.setState({newYearlyValue:e.currentTarget.value})}),(0,M._)(this,"cancelNewRates",()=>{this.state.saving||this.setPlans(this.state.plans)}),(0,M._)(this,"toggleFreeTrialsEnabled",e=>{this.state.saving||this.setState({freeTrialsEnabled:!this.state.freeTrialsEnabled})}),(0,M._)(this,"setGroupSubscriptionPercentOff",e=>{this.setState({defaultGroupCouponPercentOff:e.currentTarget.value})}),(0,M._)(this,"setMinimumGroupSize",e=>{this.setState({minimumGroupSize:e.currentTarget.value})}),(0,M._)(this,"getNewRates",()=>{let e=Math.round(100*Number(this.state.newMonthlyValue&&this.state.newMonthlyValue.replace(/,/g,""))),t=this.state.newMonthlyCurrency,i=Math.round(100*Number(this.state.newYearlyValue&&this.state.newYearlyValue.replace(/,/g,""))),n=this.state.newYearlyCurrency;return isNaN(e)&&(e=null),isNaN(i)&&(i=null),{monthlyRate:e,monthlyCurrency:t,yearlyRate:i,yearlyCurrency:n}}),(0,M._)(this,"hasNewRates",()=>{let{monthlyPlan:e,yearlyPlan:t}=kR(this.state.plans),{monthlyRate:i,monthlyCurrency:n,yearlyRate:r,yearlyCurrency:o}=this.getNewRates();return!!i&&i!=(null==e?void 0:e.amount)||!!i&&n!=(null==e?void 0:e.currency)||!!t&&r!=t.amount||!!t&&o!=t.currency}),(0,M._)(this,"saveNewRates",e=>{let{iString:t}=this.props,{pledgeCount:i}=this.state;if(this.state.saving)return;let n=this.getNewRates();this.setState({saving:!0},()=>{(0,U.j)(U.FP.SET_NEW_RATES_CLICKED,n),N().post("/api/v1/stripe/set_rates").send(n).then(e=>{this.setPlans(e.body.plans)}).catch(e=>{alert((0,Y.zx)(e,t("Failed to set new rates")))}).then(()=>{(0,Y.nn)(this,async()=>{let t=this.getFields({withFreeTrials:!0,withBoost:!0,withReferrals:!0});t.founding_plan_enabled||(t=(0,_._)((0,f._)({},t),{founding_plan_enabled:!1,founding_plan_amount:void 0,founding_plan_name:void 0,founding_plan_minimum:void 0})),e&&(t=(0,f._)({},t,e));try{await N().put("/api/v1/publication").send(t),t.paywall_free_trial_enabled?await k3():await k8(),t.boost_enabled&&await N().post("/api/v1/boost").send({enabled:!0}),t.referrals_enabled&&await N().post("/api/v1/viral_gifts/config").send({enabled:!0}),document.location.href=this.props.redirect||(0,j.wI3)(this.props.pub,{addBase:!0,section:"payments-settings",params:{pledgeCount:i}})}catch(e){console.error("Failed to update plans:",e),alert((0,Y.zx)(e))}}),this.setState({saving:!1})})})}),(0,M._)(this,"saveFoundingPlanInfo",()=>(0,Y.nn)(this,async e=>{let t=this.getFields();if(t.founding_plan_enabled||(t={founding_plan_enabled:!1}),!e.saving){this.setState({saving:!0});try{await N().put("/api/v1/publication").send(t),window.location.reload()}catch(e){console.error("Failed to update founding member plan:",e),alert((0,Y.zx)(e)),this.setState({saving:!1})}}})),(0,M._)(this,"saveFreeTrialsChanges",()=>(0,Y.nn)(this,async e=>{let t={paywall_free_trial_enabled:this.state.freeTrialsEnabled};if(!e.saving){this.setState({saving:!0});try{await N().put("/api/v1/publication").send(t),t.paywall_free_trial_enabled?await k3():await k8(),window.location.reload()}catch(e){console.error("Failed to update free trials plan:",e),alert((0,Y.zx)(e)),this.setState({saving:!1})}}})),(0,M._)(this,"saveGroupDiscountSettings",()=>{let{iString:e}=this.props;(0,Y.nn)(this,async t=>{let i={percent_off:this.state.defaultGroupCouponPercentOff,is_group_default:!0,name:e("Group Subscription Discount"),duration:"forever",group_only:!0,is_default:!1,yearly_only:!1,edu_only:!1};if(!t.saving){this.setState({saving:!0});try{this.state.defaultGroupCoupon?await N().put("/api/v1/coupon/".concat(this.state.defaultGroupCoupon)).send(i):await N().post("/api/v1/coupon").send(i),window.location.reload()}catch(e){console.error("Failed to update default group discount:",e),alert((0,Y.zx)(e)),this.setState({saving:!1})}}})}),(0,M._)(this,"saveMinimumGroupSizeSettings",()=>{(0,Y.nn)(this,async e=>{if(!e.saving){this.setState({saving:!0});try{await N().put("/api/v1/publication").send({minimum_group_size:this.state.minimumGroupSize}),window.location.reload()}catch(e){console.error("Failed to update minimum group size:",e),alert((0,Y.zx)(e)),this.setState({saving:!1})}}})}),(0,M._)(this,"cancelFreeTrialsChanges",()=>{this.setState({freeTrialsEnabled:this.state.paywall_free_trial_enabled})}),(0,M._)(this,"hasValidPlans",()=>{let e=this.props.pub.draft_plans;if(!e)return!1;let t=e.filter(e=>"month"===e.interval),i=e.filter(e=>"year"===e.interval);return(1===t.length||1===i.length)&&t.length+i.length<=2}),(0,M._)(this,"getYearlyPlanAmount",()=>{let e=this.props.pub.draft_plans;if(e)return Math.min(...nT()(e.filter(e=>"year"===e.interval).map(e=>e.amount)))}),(0,M._)(this,"getCurrency",()=>{var e,t,i;let n=null!==(i=this.props.pub.draft_plans)&&void 0!==i?i:[],r=n.find(e=>"year"===e.interval)||n[0];return r?r.currency:(null===(t=this.state.pledgePlans)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.payment_currency)||"usd"}),(0,M._)(this,"_getFieldsFromSource",e=>{let t=eI()(e,["founding_plan_enabled","founding_plan_amount","founding_plan_name","founding_plan_minimum"]);return t.founding_plan_minimum===this.getYearlyPlanAmount()&&(t.founding_plan_minimum=null),t}),(0,M._)(this,"getDefaultFields",()=>this._getFieldsFromSource(this.props.pub)),(0,M._)(this,"getFields",function(){let{withFreeTrials:e,withBoost:i,withReferrals:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t._getFieldsFromSource(t.state);return r.founding_plan_amount=(0,er.dollarStringToCents)(t.state.foundingAmountInputValue),r.founding_plan_minimum=(0,er.dollarStringToCents)(t.state.minimumInputValue),e&&(r.paywall_free_trial_enabled=t.state.freeTrialsEnabled),i&&(r.boost_enabled=t.state.boostEnabled),n&&(r.referrals_enabled=t.state.referralsEnabled),(eS()(r.founding_plan_amount)||isNaN(r.founding_plan_amount))&&(r.founding_plan_amount=null),r.founding_plan_minimum===t.getYearlyPlanAmount()&&(r.founding_plan_minimum=null),r}),(0,M._)(this,"hasChanges",()=>!eC()(this.getFields(),this.getDefaultFields())),(0,M._)(this,"cancelFoundingChanges",()=>{let e=this.getDefaultFields();this.setState((0,f._)({foundingAmountInputValue:(0,er.centsToDollarString)(e.founding_plan_amount),minimumInputValue:(0,er.centsToDollarString)(e.founding_plan_minimum||this.getYearlyPlanAmount())},e))}),(0,M._)(this,"setFoundingPlanNameState",e=>{this.setState({founding_plan_name:e.target.value,founding_plan_enabled:!0})}),(0,M._)(this,"setFoundingPlanValueState",e=>{this.setState({foundingAmountInputValue:e.target.value,minimumInputValue:this.state.minimumInputValue?e.target.value:null,founding_plan_enabled:!0})}),(0,M._)(this,"toggleFoundingPlanEnabled",e=>{this.setState({founding_plan_enabled:e})}),(0,M._)(this,"setFoundingPlanMinimum",e=>{this.setState({minimumInputValue:e?null:this.state.foundingAmountInputValue,founding_plan_enabled:!0})}),this.state={},e.pub.draft_plans&&this.setPlans(e.pub.draft_plans,{init:!0}),this.state=Object.assign(this.state,this.getDefaultFields()),this.state.foundingAmountInputValue=(0,er.centsToDollarString)(this.state.founding_plan_amount),this.state.minimumInputValue=(0,er.centsToDollarString)(this.state.founding_plan_minimum||this.getYearlyPlanAmount()),this.state.paywall_free_trial_enabled=this.props.pub.paywall_free_trial_enabled,this.state.defaultGroupCouponPercentOff=null!==(n=this.props.pub.default_group_coupon_percent_off)&&void 0!==n?n:"20",this.state.defaultGroupCoupon=this.props.pub.default_group_coupon,this.state.minimumGroupSize=(null===(i=this.props.pub.minimum_group_size)||void 0===i?void 0:i.toString())||"2","disabled"===e.pub.payments_state&&this.props.full_page_version?this.state.freeTrialsEnabled=!0:this.state.freeTrialsEnabled=this.props.pub.paywall_free_trial_enabled,this.state.boostEnabled=!e.pub.first_enabled_payments_at||e.boostEnabled,this.state.referralsEnabled=!e.pub.viralGiftsConfig||e.pub.viralGiftsConfig.enabled,this.state.saving=!1}}(0,M._)(BK,"contextType",c0.kx);let BQ=(0,Q.fz)((0,io.xY)(eb(BK)));var B$=i(44908),B0=i.n(B$),B1=i(8635),B2=((m={}).Queued="queued",m.Scanning="scanning",m.ScanError="scan_error",m.Ready="ready",m.ImportRequested="import_requested",m.Importing="importing",m.ImportError="import_error",m.Finished="finished",m);function B4(){let e=(0,G._)(["Importing "," paid subscriptionsâ€¦"]);return B4=function(){return e},e}function B3(){let e=(0,G._)(["Successfully imported "," paid subscriptions"]);return B3=function(){return e},e}function B8(){let e=(0,G._)(["Your Stripe account has "," paid subscriptions that can be imported to Substack for the following plans: ","."]);return B8=function(){return e},e}function B6(){let e=(0,G._)(["Your Stripe account has "," paid subscriptions that can be imported to Substack."]);return B6=function(){return e},e}function B5(){let e=(0,G._)(["Your Stripe account has paid subscriptions that can be imported to Substack for the following plans: ","."]);return B5=function(){return e},e}let B9=e=>{var t;let{pub:i}=e,{iString:n,iTemplate:r}=(0,Q.M1)(),o=(0,yA.Q)({pathname:"/api/v1/stripe/account/import",auto:!!(null==i?void 0:i.stripe_user_id)}),a=o.result;if((0,B1.Z)(async()=>{a&&[B2.Queued,B2.Scanning,B2.ImportRequested,B2.Importing].includes(a.state)&&o.refetch()},15e3),!(null==i?void 0:i.stripe_user_id)||!a&&o.isLoading||(null===(t=o.error)||void 0===t?void 0:t.status)===404||(null==a?void 0:a.state)===B2.Ready&&0===a.importable_subscriptions)return null;let l=(null==a?void 0:a.importable_plans)?B0()(a.importable_plans.sort((e,t)=>e.amount-t.amount).map(e=>(0,er.planBasePricing)(e))):[];return(0,Z.BX)("li",{className:"settings-element stripe-account-import-notice",children:[(0,Z.tZ)("h3",{children:n("Import paid subscriptions")}),o.error?(0,Z.tZ)("p",{className:"error",children:n("Failed to load Stripe account import status")}):[B2.Queued,B2.Scanning].includes(null==a?void 0:a.state)?(0,Z.tZ)("p",{className:"pending",children:n("Scanning Stripe account for paid subscriptionsâ€¦")}):[B2.Importing,B2.ImportRequested].includes(null==a?void 0:a.state)?(0,Z.tZ)("p",{className:"pending",children:(null==a?void 0:a.importable_subscriptions)?r(B4(),(0,er.numberToString)(null==a?void 0:a.importable_subscriptions)):n("Importing paid subscriptionsâ€¦")}):(null==a?void 0:a.state)===B2.ScanError?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("p",{className:"error",children:n("Failed to scan for paid subscriptions from Stripe account")}),(0,Z.tZ)(ee.zx,{priority:"secondary",size:"sm",href:(0,j.TID)(i),localNavigation:!0,children:n("View subscriptions scan results")})]}):(null==a?void 0:a.state)===B2.ImportError?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("p",{className:"error",children:n("Failed to import paid subscriptions from Stripe account")}),(0,Z.tZ)(ee.zx,{priority:"secondary",size:"sm",href:(0,j.TID)(i),localNavigation:!0,children:n("View subscriptions import results")})]}):(null==a?void 0:a.state)===B2.Finished?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("p",{className:"success",children:a.importable_subscriptions?r(B3(),(0,er.numberToString)(a.importable_subscriptions)):n("Successfully imported paid subscriptions")}),(0,Z.tZ)(ee.zx,{priority:"secondary",size:"sm",href:(0,j.TID)(i),localNavigation:!0,children:n("View subscriptions imports")})]}):(null==a?void 0:a.state)!==B2.Ready?(0,Z.tZ)("p",{className:"error",children:n("Something went wrong")}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("p",{children:a.importable_subscriptions?l.length>0?r(B8(),(0,er.numberToString)(a.importable_subscriptions),(0,er.formatArray)(l)):r(B6(),(0,er.numberToString)(a.importable_subscriptions)):l.length>0?r(B5(),(0,er.formatArray)(l)):n("Your Stripe account has paid subscriptions that can be imported to Substack.")}),(0,Z.tZ)(ee.zx,{priority:"primary",size:"sm",href:(0,j.TID)(i),localNavigation:!0,children:n("Import paid subscriptions")})]})]})},B7=(0,ss.us)(eb(e=>{let{pub:t,user:i,publication:n,publicationSettings:r,stripe_error:o,openPauseModal:a,openPauseExtendModal:l,openInvoiceExportModal:s,promptToLaunch:d,embedded:c}=e,{iString:u,iTemplate:p}=(0,Q.M1)(),[h,m]=(0,A.eJ)(!1),[g,v]=(0,A.eJ)(0),[b,y]=(0,A.eJ)(!1),[f,_]=(0,A.eJ)(t.paywall_free_trial_enabled);(0,A.d4)(()=>{if(void 0!==window){let e=(0,iP.x)("pledgeCount");e&&(window.history.replaceState({},document.title,(0,j.rhs)({pledgeCount:null})),v(e))}},[]);let w=async e=>{if(!b){y(!0);try{_(e),await N().put("/api/v1/publication").send({paywall_free_trial_enabled:e}),e?await k3(t):await k8()}catch(t){throw alert((0,Y.zx)(t)),_(!e),t}finally{y(!1)}}};if("disconnecting"===t.payments_state){let e=u(t.has_subscribers?"Youâ€™ve started to disconnect Stripe and refund subscribers. This may take up to twenty minutes, so please refresh the page after a while. In the meantime, payments have been disabled, so no readers can become new paid subscribers.":"Youâ€™ve started to disconnect Stripe. This may take up to twenty minutes, so please refresh the page after a while. In the meantime, payments have been disabled, so no readers can become new paid subscribers.");return(0,Z.tZ)(cl.A,{children:(0,Z.tZ)(oH._R,{title:u("Payments"),id:"payments-settings",children:(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(oH.ZR,{children:(0,Z.tZ)(oH.sY,{primaryText:u("Youâ€™ve turned off billing and disconnected Stripe"),secondaryText:e})})})})})}let C=(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(B9,{pub:t}),(0,Z.tZ)(k7,{pub:t,publication:n,user:i,openPauseModal:a,promptToLaunch:d,openPauseExtendModal:l,disabled:!h}),c?(0,Z.tZ)(BQ,{pub:t,user:i,stripe_error:o,full_page_version:!1,embedded:c,onLoadStripeAccount:e=>m(!!e)}):(0,Z.tZ)(BQ,{pub:t,user:i,stripe_error:o,full_page_version:!1,embedded:c,onLoadStripeAccount:e=>m(!!e)}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Bu,{pub:t,user:i})}),t.draft_plans&&!c&&[(0,Z.tZ)(oH.Uo,{title:u("Discounts")}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:u("Special offers"),secondaryText:u("Create discounts or coupons for special occasions")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/offers",native:!0,children:u("Manage")})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:u("Gift paid subscriptions"),secondaryText:u("Add any email address to your paid subscriber list for free.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/subscribers/add",children:u("Add subscribers")})]})}),(0,Z.tZ)(oH.Uo,{title:u("Paywalling")}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Bi,{publicationSettings:r})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(BN,{pub:t})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Bf,{pub:t,freeTrialsEnabled:f,toggleFreeTrialsEnabled:w,showSubmit:!c})}),(0,Z.tZ)(BP,{settingName:"enable_renew_email_footer",primaryText:u("Custom paywall for churned subscribers"),secondaryText:u("Show paid subscribers who have cancelled their subscriptions a special paywall prompting them to resubscribe.")}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(x9,{publication:n,title:u("Auto-paywall paid posts"),subtitle:u("Make a portion of all paid posts visible to everyone before adding a paywall."),field:"post_preview_limit",warnings:{Disabled:u("Are you sure? This may hurt conversion since free readers won't know what they're missing.")},options:[{name:u("Disabled"),value:0},{name:u("Short preview"),value:200},{name:u("Default preview"),value:null},{name:u("Long preview"),value:1e3}]})}),(0,Z.tZ)(oH.Uo,{title:u("Advanced")}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:u("Subscription invoice reports"),secondaryText:(0,Z.BX)(Z.HY,{children:[u("View invoices over a given time period to help with sales tax and VAT obligations. "),(0,Z.tZ)(ei.hh,{decoration:"underline",onClick:s,children:u("Request new report")})]})}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/document_exports",children:u("View")})]})})],"disabled"===t.payments_state&&(0,Z.tZ)(BS,{user:i,publication:n,pub:t,publicationSettings:r})]});return c?C:(0,Z.BX)(cl.A,{children:[(0,Z.tZ)(oH._R,{title:u("Payments"),id:"payments-settings",children:C}),g>0&&(0,Z.tZ)(k6,{close:()=>v(0),opened:g>0,pledgeCount:g})]})})),Te=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),n=(0,S0.n1)("/publish/settings/edit",{title:i("Terms of Service"),bodyField:"tos_content",redirect:"undefined"!=typeof document?document.location.href:""}),r=(0,S0.n1)("/publish/settings/edit",{title:i("Privacy Policy"),bodyField:"privacy_content",redirect:"undefined"!=typeof document?document.location.href:""});return(0,Z.BX)(cl.t5,{children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:i("Custom terms of service"),secondaryText:i("Add your own terms of service to your publication.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:n,children:i(t.has_custom_tos?"Edit":"Customize")})]}),(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:i("Custom privacy policy"),secondaryText:i("Add your own privacy policy to your publication.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:r,children:i(t.has_custom_privacy?"Edit":"Customize")})]})]})};var Tt=i(48884),Ti=i(31742);let Tn=e=>{let{iString:t}=Tt.mb.i(e||"en");return[{name:"_ga family",id:Ti.YJ.GA_TRACKING,type:Ti.pt.PERFORMANCE,description:t("3rd party analytics tracking."),owner:Ti.js.PUBLISHER},{name:"Google Tag Manager",id:Ti.YJ.GA_TAG_MANAGER,type:Ti.pt.PERFORMANCE,description:t("Used for Google tag management and 3rd party analytics tracking."),owner:Ti.js.PUBLISHER},{name:"Facebook Pixel",id:Ti.YJ.FB_PIXEL,type:Ti.pt.PERFORMANCE,description:t("Used for facebook ad campaign 3rd party analytics."),owner:Ti.js.PUBLISHER},{name:"Twitter Pixel",id:Ti.YJ.TWITTER_PIXEL,type:Ti.pt.PERFORMANCE,description:t("Used for X (formerly known as Twitter) ad campaign 3rd party analytics."),owner:Ti.js.PUBLISHER},{name:"Parse.ly Pixel",id:Ti.YJ.PARSELY_PIXEL,type:Ti.pt.PERFORMANCE,description:t("Used for parse.ly 3rd party analytics."),owner:Ti.js.PUBLISHER},{name:"intro_popup_last_hidden_at",id:Ti.ky.INTRO_POPUP_LAST_HIDDEN_AT,type:Ti.pt.FUNCTIONALITY,description:t("Prevents showing introductory information the user has already seen."),owner:Ti.js.SUBSTACK},{name:"muxData",id:Ti.ky.MUX_DATA,type:Ti.pt.FUNCTIONALITY,description:t("Used for anonymous video metric collection and aggregation."),owner:Ti.js.SUBSTACK},{name:"like_upsell_last_shown_at",id:Ti.ky.LIKE_UPSELL_LAST_SHOWN_AT,type:Ti.pt.FUNCTIONALITY,description:t("Prevents users from repeatedly being shown features."),owner:Ti.js.SUBSTACK},{name:"chatbot_terms_last_accepted_at",id:Ti.ky.CHATBOT_TERMS_LAST_ACCEPTED_AT,type:Ti.pt.FUNCTIONALITY,description:t("Prevents users from repeatedly having to accept chatbot terms."),owner:Ti.js.SUBSTACK},{name:"preferred_language",id:Ti.ky.PREFERRED_LANGUAGE,type:Ti.pt.FUNCTIONALITY,description:t("Stores the user's preferred language"),owner:Ti.js.SUBSTACK},{name:"visit_id",id:Ti.ky.VISIT_ID,type:Ti.pt.PERFORMANCE,description:t("First party analytics tracking."),owner:Ti.js.SUBSTACK},{name:"ajs_anonymous_id",id:Ti.ky.ANONYMOUS_ID,type:Ti.pt.PERFORMANCE,description:t("First party analytics tracking."),owner:Ti.js.SUBSTACK},{name:"ab_testing_id",id:Ti.ky.AB_TESTING_ID,type:Ti.pt.PERFORMANCE,description:t("First party analytics tracking."),owner:Ti.js.SUBSTACK},{name:"ab_experiment_sampled",id:Ti.ky.AB_EXPERIMENT_SAMPLED,type:Ti.pt.PERFORMANCE,description:t("First party analytics tracking."),owner:Ti.js.SUBSTACK},{name:"_ga family",id:Ti.ky.GA_TRACKING,type:Ti.pt.PERFORMANCE,description:t("3rd party analytics tracking."),owner:Ti.js.SUBSTACK},{name:"AdQuick tracking pixel",id:Ti.ky.AD_QUICK_TRACKING_PIXEL,type:Ti.pt.PERFORMANCE,description:t("3rd party analytics tracking."),owner:Ti.js.SUBSTACK},{name:"_dd_s",id:Ti.ky.DATADOG_S,type:Ti.pt.PERFORMANCE,description:t("First party cookie used to identify and diagnose technical problems on the site."),owner:Ti.js.SUBSTACK},{name:"fs_uid",id:Ti.ky.FULLSTORY_UID,type:Ti.pt.PERFORMANCE,description:t("Used to track user actions across the site for debugging purposes."),owner:Ti.js.SUBSTACK},{name:"__zlcmid",id:Ti.ky.ZENDESK_ID,type:Ti.pt.PERFORMANCE,description:t("Stores visitorâ€™s machine-id for authentication with Zendesk chat widget."),owner:Ti.js.SUBSTACK},{name:"substack.sid",id:Ti.ky.SESSION_SID,type:Ti.pt.NECESSARY,description:t("Session identifier."),owner:Ti.js.SUBSTACK},{name:"connect.sid",id:Ti.ky.CUSTOM_DOMAIN_SESSION_SID,type:Ti.pt.NECESSARY,description:t("Session identifier."),owner:Ti.js.SUBSTACK},{name:"substack.lli",id:Ti.ky.LIKELY_LOGGED_IN,type:Ti.pt.NECESSARY,description:t("Communicates login state across first party domains"),owner:Ti.js.SUBSTACK},{name:"disable_html_pixels",id:Ti.ky.DISABLE_HTML_PIXELS,type:Ti.pt.NECESSARY,description:t("Ensures a consistent user experience across network requests."),owner:Ti.js.SUBSTACK},{name:"experiment_",id:Ti.ky.DISABLE_EXPERIMENTS,type:Ti.pt.NECESSARY,description:t("Ensures a consistent user experience across network requests."),owner:Ti.js.SUBSTACK},{name:"hideCookieBanner",id:Ti.ky.HIDE_COOKIE_BANNER,type:Ti.pt.NECESSARY,description:t("Ensures a consistent user experience across network requests."),owner:Ti.js.SUBSTACK},{name:"cf_clearance",id:Ti.ky.CF_CLEARENCE,type:Ti.pt.NECESSARY,description:t("Used to grant access to our servers from our Content Delivery Network."),owner:Ti.js.SUBSTACK},{name:"__cf_bm",id:Ti.ky.CF_BM,type:Ti.pt.NECESSARY,description:t("Used to block bot access to the site"),owner:Ti.js.SUBSTACK},{name:"AWSALBTG / AWSALBTGCORS",id:Ti.ky.AWSALB,type:Ti.pt.NECESSARY,description:t("Ensures a consistent user experience across network requests."),owner:Ti.js.SUBSTACK},{name:"cookie_storage_key",id:Ti.ky.COOKIE_STORAGE_KEY,type:Ti.pt.NECESSARY,description:t("Allows us to store your cookie preferences."),owner:Ti.js.SUBSTACK}]};Tn().filter(e=>e.owner===Ti.js.SUBSTACK&&e.type!==Ti.pt.NECESSARY).map(e=>e.id),Tn().filter(e=>e.owner===Ti.js.PUBLISHER&&e.type!==Ti.pt.NECESSARY).map(e=>e.id);let Tr={DO_NOT_ASK:"",EVERYONE:"everyone"},To={[Ti.ky.GA_TRACKING]:"_ga",[Ti.ky.GA_TAG_MANAGER]:"_ga",[Ti.ky.MUX_DATA]:"muxData",[Ti.ky.ANONYMOUS_ID]:Ti.Ic.ANONYMOUS_ID,[Ti.ky.VISIT_ID]:Ti.Ic.VISIT_ID,[Ti.ky.AB_TESTING_ID]:Ti.Ic.AB_TESTING_ID,[Ti.ky.AB_EXPERIMENT_SAMPLED]:Ti.Ic.AB_EXPERIMENT_SAMPLED,[Ti.ky.LIKE_UPSELL_LAST_SHOWN_AT]:Ti.Ic.LIKE_UPSELL_LAST_SHOWN_AT,[Ti.ky.INTRO_POPUP_LAST_HIDDEN_AT]:Ti.Ic.INTRO_POPUP_LAST_HIDDEN_AT,[Ti.ky.DISABLE_HTML_PIXELS]:Ti.Ic.DISABLE_HTML_PIXELS,[Ti.ky.COOKIE_STORAGE_KEY]:Ti.Ic.COOKIE_STORAGE_KEY,[Ti.ky.EXPERIMENTS]:"experiment_",[Ti.ky.DATADOG_S]:"_dd_s",[Ti.ky.FULLSTORY_UID]:"fs_",[Ti.ky.ZENDESK_ID]:"__zlcmid",[Ti.YJ.GA_TAG_MANAGER]:"_ga",[Ti.YJ.GA_TRACKING]:"_ga",[Ti.YJ.FB_PIXEL]:"_fbp",[Ti.YJ.TWITTER_PIXEL]:"_twq",[Ti.YJ.PARSELY_PIXEL]:"_parsely_visitor"};function Ta(){let e=(0,G._)(["This will hide ","'s posts from non-subscribers. Are you sure?"]);return Ta=function(){return e},e}function Tl(){let e=(0,G._)(["This will make ","'s posts publicly visible. Are you sure?"]);return Tl=function(){return e},e}function Ts(){let e=(0,G._)(["Allow free posts to be cross-posted to other publications. Cross-posting can help expose your publication get discovered by new audiences."]);return Ts=function(){return e},e}Ti.ky.AB_TESTING_ID,Ti.ky.AB_EXPERIMENT_SAMPLED,Ti.ky.ANONYMOUS_ID,Ti.ky.VISIT_ID,Ti.ky.EXPERIMENTS,Ti.ky.DISABLE_HTML_PIXELS,Ti.ky.DISABLE_EXPERIMENTS,Ti.ky.COOKIE_STORAGE_KEY,null==To||To[Ti.ky.ANONYMOUS_ID];let Td=eb(e=>{let{pub:t,publicationSettings:i}=e,{iString:n,iTemplate:r}=(0,Q.M1)(),{getSettingFor:o,changeSetting:a}=(0,ss.So)(),{getConfigFor:l}=(0,io.xR)(),s="block_ai_crawlers",d=!!o(s);return(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{title:n("Privacy"),id:"privacy-settings",children:[(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(et.tu,{gap:12,children:(0,Z.tZ)(xw,{id:"invite-only",publication:t,title:n("Private mode"),subtitle:n("In private mode, only people you approve can subscribe and view your posts. Existing subscribers will not be affected."),field:"invite_only",setToTrueWarning:r(Ta(),t.name),setToFalseWarning:r(Tl(),t.name)})})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(xw,{id:"enable-restacking-link",publication:i,title:n("Allow cross-posting"),field:"enable_restacking",endpoint:"/api/v1/publication_settings",subtitle:r(Ts())})}),!t.explicit&&(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(xw,{id:"enable-publicly-ranked",publication:t,title:n("Allow listing on Substack.com"),subtitle:n("Allow visitors to the Substack website to search for and discover your publication"),field:"publicly_ranked"})}),"enabled"===t.payments_state&&(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(xw,{id:"enable-index-paywalled-posts",publication:t,title:n("Allow search engines to index paywalled content"),field:"expose_paywall_content_to_search_engines",subtitle:n("Allows excerpts from paywalled posts to show up in search results. Non-subscribers will still see a paywall when they click through to your website.")})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{id:"disable-ai-crawlers",children:[(0,Z.tZ)(oH.sY,{primaryText:n("Block AI training"),secondaryText:n("Tells third-party AI-tools like ChatGPT and Google Gemini that their models should not be trained on your content. Note this may limit your discoverability on these platforms.")}),(0,Z.tZ)(i2.rs,{checked:d,onChange:()=>{a({[s]:!d})}})]})}),(0,Z.tZ)(BP,{settingName:"display_welcome_page_details",primaryText:n("Show approximate subscriber count"),secondaryText:n("Displays your rough subscriber count in places like your profile and welcome page. This can help boost free subscriber conversion.")}),l("display_cookie_settings")&&(0,Z.tZ)(BE,{settingName:"cookie_settings",primaryText:n("Enhanced cookie consent"),secondaryText:n("Requests all publication visitors consent to your use of cookies and trackers. Visitors may see the popup more than once if they begin a new session. Even if disabled, Substack may still ask visitors for consent to cookies in some jurisdictions."),trueText:Tr.EVERYONE,falseText:Tr.DO_NOT_ASK}),(0,Z.tZ)(Te,{pub:t})]})})});function Tc(){let e=(0,G._)(["The email displayed on your RSS feeds. By default, we'll use your publication's Substack email (",'@substack.com). Any email sent to this address is forwarded to the publication owner based on the "receive email replies from" setting above.']);return Tc=function(){return e},e}let Tu=eb(e=>{let{publication:t,pub:i}=e,{iString:n,iTemplate:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(!0),[l,s]=(0,A.eJ)(!1),d=async e=>{try{let t=await N().get("/api/v1/recommendations/from/".concat(e));a(t.body.length>0)}catch(e){console.error((0,Y.zx)(e))}};return(0,A.d4)(()=>{(async function(){await d(i.id)})()},[i.id]),(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{title:n("Details"),id:"pub-details",children:[(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Si,{title:n("Copyright owner"),lineField:"copyright",children:(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Name for copyright notices"})})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Si,{title:n("Mailing address"),lineField:"mailing_address",defaultValue:"548 Market Street PMB 72296\nSan Francisco, CA 94104\n  ",multiline:!0,children:(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Business address to show at the bottom of all emails. Can be a PO Box"})})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Si,{title:n("Email address for RSS feeds"),lineField:"itunes_email",defaultValue:t.itunes_email||"".concat(t.subdomain,"@substack.com"),valueSanitizer:e=>""===e?null:e,children:(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:r(Tc(),t.subdomain)})})}),!t.explicit&&(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Publication introduction"),secondaryText:n("Add 2-3 sentences to introduce your publication to new readers on discovery surfaces.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{s(!0)},children:n("Edit")}),(0,Z.tZ)(ci,{pub:i,open:l,setOpen:s})]}),"petition"===t.subdomain&&[(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kh,{title:n("Terms of Service"),bodyField:"tos_content",detailText:(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(ei.xv.B4,{as:"span",color:"secondary",translated:!0,children:["Lives at"," ",(0,Z.tZ)("a",{href:"/tos",native:!0,children:"/tos"})]})})})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kh,{title:n("Privacy Policy"),bodyField:"privacy_content",detailText:(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(ei.xv.B4,{as:"span",color:"secondary",translated:!0,children:["Lives at"," ",(0,Z.tZ)("a",{href:"/privacy",native:!0,children:"/privacy"})]})})})})]]})})}),Tp=e=>{let{settingName:t,validator:i,valueSanitizer:n,primaryText:r,secondaryText:o,maxlength:a=60,placeholder:l}=e,{getSettingFor:s}=(0,ss.So)(),[d,c]=(0,A.eJ)(s(t)),[u,p]=(0,A.eJ)(!1),[h,m]=(0,A.eJ)(!1),[g,v]=(0,A.eJ)(d),[b,y]=(0,A.eJ)(""),f=e=>{void 0!==e&&(e!==d||e!==g)&&(m(!0),y(""),v(e))},_=(0,A.I4)(async e=>{p(!0),y("");let r=null;try{var o,a,l;r=n?n(e):e;let s=!!i&&i(r);if(s){y(s),(0,U.j)(U.FP.PUBLICATION_SETTING_TEXT_INPUT_ERRORED,{settingName:t,is_validation_error:!0,value:r,error:s}),p(!1);return}let d=await N().put("/api/v1/publication_settings").send({[t]:r});if((null==d?void 0:null===(o=d.body)||void 0===o?void 0:o.length)===1)c(d.body[0].value_text),m(!1);else if(null==d?void 0:null===(a=d.body)||void 0===a?void 0:a.length){let e=null===(l=d.body.find(e=>e.type===t))||void 0===l?void 0:l.value_text;e&&(c(e),m(!1))}else throw Error("No settings returned from server")}catch(i){y(x7(i.response)),(0,U.j)(U.FP.PUBLICATION_SETTING_TEXT_INPUT_ERRORED,{settingName:t,is_network_error:!0,value:null!=r?r:e,error:i}),console.error(i)}p(!1)},[v,p]);return(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(oH.sY,{primaryText:r,secondaryText:o}),(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)("input",{name:t,"aria-label":r,value:h?g:d,type:"text",maxLength:a,onChange:e=>f(e.currentTarget.value),onInput:e=>f(e.currentTarget.value),className:"inputField-FgnMgP",placeholder:l}),(0,Z.BX)(et.gq,{justifyContent:b?"space-between":"end",children:[b&&(0,Z.tZ)(ei.xv.B4,{color:"error",children:b}),h&&(0,Z.tZ)(ei.xv.B4,{color:"secondary",align:"right",children:"".concat((null==g?void 0:g.length)||0,"/").concat(a)})]})]}),h&&(0,Z.tZ)(et.tu,{gap:8,children:(0,Z.BX)(et.gq,{alignItems:"start",gap:16,children:[(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>_(g),disabled:u||!h&&""!==b,"data-testid":"".concat(t,"-button"),children:"Save"}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{v(d),y(""),m(!1)},children:"Cancel"})]})})]})})};function Th(){let e=(0,G._)(["Created on ",""]);return Th=function(){return e},e}let Tm=(e,t)=>(0,H.Z)(e).tz(H.Z.tz.guess()).locale(t).format("MMMM D, YYYY"),Tg=e=>{var t;let{hooksEnabled:i}=e,{iString:n,iTemplate:r,language:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(!1),{result:s,error:d,isLoading:c,hasLoadedOnce:u,refetch:p}=(0,iS.ib)({pathname:"/api/v1/publisher_api/api_key",method:"get",auto:!0}),h=(0,iN.pm)();(0,A.d4)(()=>{d&&h.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:n("Something went wrong"),Icon:eL.Z})))},[d]);let m=e=>{(0,Y.vQ)(e),h.popToast(()=>(0,Z.tZ)(iN.FN,{text:n("Copied to clipboard")}))},g=(0,A.I4)(e=>{confirm(n("Are you sure you want to permanently delete this API key? Any code that depends on this key will immediately break."))&&p({method:"delete",json:{api_key_identifier:e}})},[p]);return(0,Z.tZ)(cl.A,{children:(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH._R,{id:"publisher-api",title:n("Publisher API"),children:[(0,Z.BX)(eK.u_,{isOpen:!c&&a,onClose:()=>{l(!1)},children:[(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(eK.xB,{showClose:!1,title:n("Your API key")}),(0,Z.BX)(eK.fe,{children:[(0,Z.tZ)(ei.xv.B3,{className:"newApiKeyPopup-gC706d",paddingTop:4,paddingBottom:4,font:"monospace",children:null==s?void 0:s.new_api_key}),(0,Z.tZ)(ee.zx,{rounded:!0,size:"sm",leading:(0,Z.tZ)(R.Z,{fill:"#FFF","stroke-width":"0"}),onClick:()=>m((null==s?void 0:s.new_api_key)||""),children:n("Copy API key")}),(0,Z.tZ)(ei.xv.B3,{paddingTop:8,translated:!0,children:"Save this key - it cannot be shown to you again!"})]})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{l(!1)},children:n("Close")})})]}),(0,Z.BX)(et.tu,{gap:16,alignItems:"start",children:[(0,Z.tZ)(oH.sY,{primaryText:n("API keys"),secondaryText:(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(ei.xv.B4,{as:"span",color:"secondary",translated:!0,children:["The"," ",(0,Z.tZ)("a",{href:"https://publisher-api.substack.com/v1/docs/#/",target:"_blank",rel:"noopener",children:"Publisher API"})," ","allows programmatic access to a publication's resources. Create an API key to use this feature."]})})}),(0,Z.tZ)(ee.zx,{disabled:(null==s?void 0:null===(t=s.api_keys)||void 0===t?void 0:t.length)===2,onClick:()=>{p({method:"post"}),l(!0)},children:n("Create API key")})]}),u?null==s?void 0:s.api_keys.map(e=>(0,Z.BX)(et.gq,{gap:16,alignItems:"start",justifyContent:"space-between",children:[(0,Z.tZ)(oH.sY,{primaryText:"*******".concat(e.api_key_identifier.slice(-4)),secondaryText:r(Th(),Tm(e.created_at,o))}),(0,Z.tZ)(ee.zx,{priority:"destructive",size:"sm",onClick:()=>g(e.api_key_identifier),children:n("Delete API key")})]})):(0,Z.tZ)(et.gq,{justifyContent:"center",children:(0,Z.tZ)(iI.$j,{})}),i&&(0,Z.tZ)(Tp,{settingName:"export_hook_url",validator:(0,er.textLengthAlphaNumericMinimumValidator)({minLength:2,maxLength:255,minAlphaNumeric:2}),primaryText:n("Zapier Hook URL"),secondaryText:n("The URL of the Zapier hook where new subscribers will be sent for processing."),maxlength:255})]})})})};class Tv extends w.Component{render(e){let{pub:t,invites:i,error:n,loading:r}=e;return n?(0,Z.BX)("p",{className:"danger",children:[this.context.iString("Error:")," ",n]}):r?(0,Z.tZ)(et.tu,{padding:20,alignItems:"center",radius:"sm",border:"detail",children:(0,Z.tZ)(iI.$j,{})}):(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{bg:"secondary",children:[(0,Z.tZ)(gK,{children:this.context.iString("Name")}),(0,Z.tZ)(gK,{colSpan:2,children:this.context.iString("Date invited")})]})}),(0,Z.tZ)(gq,{children:i&&i.length?i.map(e=>(0,Z.tZ)(Ty,{invite:e,pub:t})):(0,Z.tZ)(Tb,{})})]})})}}(0,M._)(Tv,"contextType",Q.wj);let Tb=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(gG,{children:(0,Z.tZ)(gQ,{colSpan:3,children:(0,Z.tZ)(ei.xv,{color:"secondary",children:e("No pending invites")})})})};class Ty extends w.Component{render(){let e=this.invite();return null===e?null:(0,Z.BX)(gG,{borderBottom:"detail",children:[(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:e.email||e.user&&e.user.name}),(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:(0,H.Z)(e.last_sent_at||e.created_at).locale(this.context.language).standardDatetime()}),(0,Z.tZ)(gQ,{justifyContent:"end",children:this.actionsComponent()})]})}constructor(...e){super(...e),(0,M._)(this,"state",{loading:!1}),(0,M._)(this,"actionMenu",void 0),(0,M._)(this,"setLoading",e=>this.setState({loading:e})),(0,M._)(this,"invite",()=>void 0===this.state.invite?this.props.invite:this.state.invite),(0,M._)(this,"resend",()=>(this.setLoading(!0),N().put("/api/v1/publication_user_invite/".concat(this.props.invite.id,"/resend")).catch(e=>(this.setLoading(!1),alert((0,Y.zx)(e)),{body:null})).then(e=>e.body).then(e=>this.setState({invite:e,loading:!1})))),(0,M._)(this,"deleteInvite",()=>(this.setLoading(!0),N().del("/api/v1/publication_user_invite/".concat(this.props.invite.id)).catch(e=>{this.setLoading(!1),alert((0,Y.zx)(e))}).then(e=>e&&200===e.status&&this.setState({invite:null,loading:!1})))),(0,M._)(this,"deleteAction",()=>(0,Z.tZ)(tC.sN,{onClick:this.deleteInvite,leading:(0,Z.tZ)(pw.Z,{}),priority:"destructive",children:this.context.iString("Cancel invite")})),(0,M._)(this,"resendAction",()=>(0,Z.tZ)(tC.sN,{onClick:this.resend,leading:(0,Z.tZ)(iq.Z,{}),children:this.context.iString("Resend email")})),(0,M._)(this,"actions",()=>nT()([this.resendAction(),this.deleteAction()])),(0,M._)(this,"actionsComponent",()=>{if(this.state.loading)return(0,Z.tZ)("div",{className:"more-loader"});let e=this.actions();return e.length?(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{priority:"quaternary",size:"xs",children:(0,Z.tZ)(pu.Z,{size:20})}),hideOnScroll:!0,children:e}):null})}}(0,M._)(Ty,"contextType",Q.wj);var Tf=i(87184),T_=i(81),TZ=i(73207);function Tw(){let e=(0,G._)(["Edit profile for ",""]);return Tw=function(){return e},e}let TC=e=>{var t,i,n,r,o,a,l,s;let{pubUser:d,onClose:c}=e,{iTemplate:u,iString:p}=(0,Q.M1)(),[h,m]=(0,A.eJ)({name:null!==(t=d.name)&&void 0!==t?t:"",bio:null!==(i=d.bio)&&void 0!==i?i:"",photo_url:null!==(n=d.photo_url)&&void 0!==n?n:"",twitter_screen_name:null!==(r=d.twitter_screen_name)&&void 0!==r?r:"",email:null!==(o=d.email)&&void 0!==o?o:"",primary_section_id:null!==(a=d.primary_section_id)&&void 0!==a?a:null}),[g,v]=(0,A.eJ)(!1),b=(0,eq.Ij)();if(!b)throw Error("Pub is required in pub user modal");let y=nN()(b.sections,"id"),{ids:w}=(0,TZ.I)({pub:b,pubSetting:"column_section_ids"}),{ids:C}=(0,TZ.I)({pub:b,pubSetting:"fp_primary_column_section_ids"}),x=w.concat(C).map(e=>{var t;return{value:String(e),label:(null===(t=y[e])||void 0===t?void 0:t.name)||""}});x.unshift({value:"",label:"None"});let S=async()=>{v(!0);let{status:e}=await N().put("/api/v1/publication_user/".concat(d.id)).send(h);v(!1),200===e&&c()};return(0,Z.BX)(eK.u_,{isOpen:!0,onClose:c,children:[(0,Z.tZ)(eK.xB,{showClose:!0,onClose:c,title:u(Tw(),null!==(l=d.user.name)&&void 0!==l?l:"user")}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:24,children:[(0,Z.tZ)(T_.J,{user:{photo_url:null!==(s=d.photo_url)&&void 0!==s?s:d.user.photo_url},onChangePhoto:e=>{let{photo_url:t}=e;m(e=>(0,_._)((0,f._)({},e),{photo_url:t}))}}),(0,Z.tZ)(ij.n,{helpText:p("Overrides how this user's name appears on this publication. Leave blank to use the user's Substack name."),label:p("Name override"),placeHolder:d.user.name,value:h.name,onChange:e=>{m(t=>(0,_._)((0,f._)({},t),{name:e}))}}),(0,Z.tZ)(ln,{helpText:p("Overrides how this user's bio appears on this publication. Leave blank to use the user's Substack bio."),label:p("Bio override"),placeHolder:d.user.bio,value:h.bio,onChange:e=>{m(t=>(0,_._)((0,f._)({},t),{bio:e}))}}),(0,Z.tZ)(ij.n,{helpText:p("Your X (formerly Twitter) handle"),label:p("X handle"),placeHolder:"username",value:h.twitter_screen_name,onChange:e=>{let t=e.replace(/^@/,"").replace(/^https?:\/\//,"").replace(/^.*?\//,"").substring(0,15);m(e=>(0,_._)((0,f._)({},e),{twitter_screen_name:t}))}}),(0,Z.tZ)(ij.n,{helpText:p("Your contact email"),label:p("Email"),placeHolder:"email@example.com",value:h.email,onChange:e=>{let t=e.substring(0,254);m(e=>(0,_._)((0,f._)({},e),{email:t}))}}),(0,oo.HD)({pub:b})&&(0,Z.tZ)(iT.m,{helpText:p("The section to which this user is the primary contributor."),label:p("Related Section"),options:x,value:String(h.primary_section_id||""),onChange:e=>m(t=>(0,_._)((0,f._)({},t),{primary_section_id:e?Number(e):null}))}),(0,Z.BX)(et.gq,{alignItems:"center",gap:12,justifyContent:"end",children:[(0,Z.tZ)(ee.zx,{disabled:g,priority:"secondary",onClick:c,children:p("Cancel")}),(0,Z.tZ)(ee.zx,{disabled:g,priority:"primary",onClick:S,children:p("Save")})]})]})})]})};var Tx=i(55722);function TS(){let e=(0,G._)(["Disable badge for ",""]);return TS=function(){return e},e}function Tk(){let e=(0,G._)(["Enable badge for ",""]);return Tk=function(){return e},e}function TB(){let e=(0,G._)(["Are you sure you want to remove ","?"]);return TB=function(){return e},e}class TT extends w.Component{render(e,t){let{authorPagesEnabled:i,bestsellerTier:n,pub:r}=e,{editProfileModalOpen:o}=t,a=this.pubUser();if(!a)return null;let{user:l}=a,s=function(e){let{pubUser:t}=e;return null===t.show_badge?"admin"===t.role:t.show_badge}({pubUser:a}),d=i&&a.name?a.name:l.name||l.email;return(0,Z.BX)(gG,{children:[(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:(0,Z.tZ)(lx.hh,{decoration:"hover-underline",href:(0,j.LwU)(l,r),native:!0,target:"blank",children:d})}),!!n&&(0,Z.tZ)(gQ,{children:["admin","contributor"].includes(a.role)&&(0,Z.tZ)(tW.u,{text:s?this.context.iString("Badge visible"):this.context.iString("Badge hidden"),children:(0,Z.tZ)(sr.hU,{"aria-label":s?this.context.iTemplate(TS(),l.name||l.email):this.context.iTemplate(Tk(),l.name||l.email),priority:"secondary-outline",disabled:this.state.loading,size:"sm",onClick:()=>{this.changeBadge(!s)},children:s?(0,Z.tZ)(Tx.o,{tier:n}):(0,Z.tZ)(Tf.Z,{size:20})})})}),(0,Z.tZ)(gQ,{children:this.publicComponent()}),(0,Z.tZ)(gQ,{children:this.roleComponent()}),(0,Z.tZ)(gQ,{justifyContent:"end",children:this.actionsComponent()}),o&&(0,Z.tZ)(TC,{pubUser:a,onClose:()=>{this.setState({editProfileModalOpen:!1}),this.bustCache()}})]})}constructor(...e){super(...e),(0,M._)(this,"state",{loading:!1,deleted:!1,editProfileModalOpen:!1,pubUser:null}),(0,M._)(this,"setLoading",e=>this.setState({loading:e})),(0,M._)(this,"pubUser",()=>this.state.deleted?null:this.state.pubUser||this.props.pubUser),(0,M._)(this,"bustCache",()=>{this.props.onUpdate()}),(0,M._)(this,"changePublic",e=>()=>{let t=this.pubUser();if(!t||void 0===t.id){console.error("Attempted to change visibility for a publication user that has no id for pub ".concat(this.props.pub.id)),alert("Something went wrong, we were not able to change the visibility for this user.");return}this.setLoading(!0),N().put("/api/v1/publication_user/".concat(t.id)).send({public:e}).catch(e=>{alert((0,Y.zx)(e)),this.setLoading(!1)}).then(e=>null==e?void 0:e.body).then(e=>this.setState({pubUser:e,loading:!1}))}),(0,M._)(this,"changeRole",e=>async()=>{let t=this.pubUser();t&&(this.setLoading(!0),await N().put("/api/v1/publication_user/".concat(t.id)).send({role:e}).catch(e=>{alert((0,Y.zx)(e)),this.setLoading(!1)}).then(e=>null==e?void 0:e.body).then(e=>this.setState({pubUser:e,loading:!1})),this.bustCache())}),(0,M._)(this,"delPubUser",async()=>{let e=this.pubUser();if(!e)return;let t=e.user;if(window.confirm(this.context.iTemplate(TB(),t.name||t.email))){this.setLoading(!0);try{await N().del("/api/v1/publication_user/".concat(e.id)),this.setState({pubUser:null,deleted:!0})}catch(e){alert((0,Y.zx)(e))}this.setLoading(!1),this.bustCache()}}),(0,M._)(this,"publicComponent",()=>{if(this.state.loading)return(0,Z.tZ)(iI.$j,{});let e=this.pubUser();return e?(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(sr.zx,{priority:"secondary-outline",size:"sm",children:e.public?this.context.iString("Public"):this.context.iString("Private")}),hideOnScroll:!0,children:[(0,Z.tZ)(tC.sN,{onClick:this.changePublic(!1),leading:e.public?(0,Z.tZ)(tC.$j,{}):(0,Z.tZ)(eE.Z,{}),children:this.context.iString("Private")}),(0,Z.tZ)(tC.sN,{onClick:this.changePublic(!0),leading:e.public?(0,Z.tZ)(eE.Z,{}):(0,Z.tZ)(tC.$j,{}),children:this.context.iString("Public")})]}):null}),(0,M._)(this,"changeBadge",async e=>{let t=this.pubUser();if(t)try{this.setState({loading:!0});let{body:i}=await N().put("/api/v1/publication_user/".concat(t.id)).send({show_badge:e});this.setState({loading:!1,pubUser:i})}catch(e){alert((0,Y.zx)(e)),this.setState({loading:!1})}}),(0,M._)(this,"roleComponent",()=>{if(this.state.loading)return(0,Z.tZ)(iI.$j,{});let e=this.pubUser();if(!e)return null;let t=(0,Y.tu)(e,this.props.pub);return(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(sr.zx,{priority:"secondary-outline",size:"sm",disabled:"owner"==t,children:_p()(this.context.iString(t))}),hideOnScroll:!0,children:[(0,Z.tZ)(tC.sN,{onClick:this.changeRole("admin"),leading:"admin"===t?(0,Z.tZ)(eE.Z,{}):(0,Z.tZ)(tC.$j,{}),children:this.context.iString("Admin")}),(0,Z.tZ)(tC.sN,{onClick:this.changeRole("contributor"),leading:"contributor"===t?(0,Z.tZ)(eE.Z,{}):(0,Z.tZ)(tC.$j,{}),children:this.context.iString("Contributor")}),(0,Z.tZ)(tC.sN,{onClick:this.changeRole("byline"),leading:"byline"===t?(0,Z.tZ)(eE.Z,{}):(0,Z.tZ)(tC.$j,{}),children:this.context.iString("Byline")})]})}),(0,M._)(this,"actionsComponent",()=>{if(this.state.loading)return(0,Z.tZ)(iI.$j,{});let e="owner"===(0,Y.tu)(this.pubUser(),this.props.pub);if(!e||this.props.authorPagesEnabled)return(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(sr.hU,{priority:"quaternary",size:"xs",children:(0,Z.tZ)(pu.Z,{size:20})}),hideOnScroll:!0,children:[this.props.authorPagesEnabled&&(0,Z.tZ)(tC.sN,{onClick:()=>{this.setState({editProfileModalOpen:!0})},children:this.context.iString("Edit profile")}),!e&&(0,Z.tZ)(tC.sN,{onClick:this.delPubUser,priority:"destructive",children:this.context.iString("Remove")})]})})}}(0,M._)(TT,"contextType",Q.wj);let TI=e=>{var t,i;let{pub:n,autoAccepted:r=null}=e,{iString:o}=(0,Q.M1)(),{getConfigFor:a}=(0,io.xR)(),l=!!a("enable_author_pages"),s=(0,my._I)("/api/v1/publication_user"),d=(0,my._I)("/api/v1/publication/bestseller_tier"),c=s.error||d.error;if(c){let e=c instanceof my.kp?c.getMessage():c;return(0,Z.BX)("p",{className:"danger",children:[o("Error:")," ",e]})}if(s.isLoading||d.isLoading)return(0,Z.tZ)(sr.tu,{padding:20,alignItems:"center",radius:"sm",border:"detail",children:(0,Z.tZ)(iI.$j,{})});let u=null!==(i=s.data)&&void 0!==i?i:[],p={user_id:n.author_id,user:{name:n.author_name,id:n.author_id},public:!1,role:"admin"},h=(u.find(e=>e.user_id===n.author_id)?u:[p].concat(u)).concat(r||[]),m=null===(t=d.data)||void 0===t?void 0:t.bestseller_tier;return(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{bg:"secondary",children:[(0,Z.tZ)(gK,{children:o("Name")}),!!m&&(0,Z.tZ)(gK,{children:o("Badge")}),(0,Z.tZ)(gK,{children:o("Visibility")}),(0,Z.tZ)(gK,{colSpan:2,children:o("Role")})]})}),(0,Z.tZ)(gq,{children:h.map(e=>(0,Z.tZ)(TT,{authorPagesEnabled:l,bestsellerTier:null!=m?m:null,pub:n,pubUser:e,onUpdate:()=>s.mutate()},e.user_id))})]})})},TN=eb(e=>{let{pub:t,openInviteModal:i,autoAcceptedPubU:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(null),[l,s]=(0,A.eJ)(null),[d,c]=(0,A.eJ)(!1),u=async()=>{c(!0);try{let e=await N().get("/api/v1/publication_user_invite");a(e.body)}catch(e){s((0,Y.zx)(e))}c(!1)};return(0,A.d4)(()=>{u()},[]),(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{title:r("Team"),id:"team-settings",children:[(0,Z.tZ)(cl.t5,{extraKeywords:"".concat(r("admin")," ").concat(r("contributor")," ").concat(r("byline")," ").concat(r("permissions")),children:(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Publication team"),secondaryText:r("Add others to help manage your publication.")}),(0,Z.tZ)(et.gq,{justifyContent:"start",children:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:i,children:r("Invite")})})]}),(0,Z.tZ)(TI,{pub:t,autoAccepted:n})]})}),o&&o.length||d||l?(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(oH.sY,{primaryText:r("Pending team invites"),secondaryText:r("People invited to your team who have not yet accepted.")}),(0,Z.tZ)(Tv,{pub:t,invites:o,loading:d,error:l})]})}):null,(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(oH.sY,{primaryText:r("Team definitions")}),(0,Z.tZ)(function(){return(0,Z.BX)(et.tu,{gap:8,paddingX:16,paddingY:12,bg:"secondary",border:"detail",radius:"sm",children:[(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:[(0,Z.tZ)(ei.Zx,{weight:"semibold",children:"Admin:"})," Full publication access, including all settings"]}),(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:[(0,Z.tZ)(ei.Zx,{weight:"semibold",children:"Contributor:"})," Able to publish and edit posts, but can not access publication settings"]}),(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:[(0,Z.tZ)(ei.Zx,{weight:"semibold",children:"Byline:"})," Can be listed as an author on posts, but can not publish or access this dashboard"]}),(0,Z.BX)(ei.xv.B4,{as:"span",color:"secondary",translated:!0,children:[(0,Z.tZ)(ei.Zx,{weight:"semibold",children:"Public:"})," Publicly listed as a contributor to this publication"]}),(0,Z.BX)(ei.xv.B4,{as:"span",color:"secondary",translated:!0,children:[(0,Z.tZ)(ei.Zx,{weight:"semibold",children:"Private:"})," Not listed as a contributor to this publication"]})]})},{})]})]})})}),TP=e=>{if(e){let t=/content="([^"]+)"/.exec(e);t&&(e=t[1])}return e},TE=eb(e=>{var t,i;let{publication:n,canSetGoogleSiteVerification:r}=e,{iString:o}=(0,Q.M1)(),a=(0,ss.So)(),l=(0,iN.pm)(),[s,d]=(0,A.eJ)(!1),[c,u]=(0,A.eJ)({twitterPixelSignupEventId:null!==(t=a.getSettingFor("twitter_pixel_signup_event_id"))&&void 0!==t?t:"",twitterPixelSubscribeEventId:null!==(i=a.getSettingFor("twitter_pixel_subscribe_event_id"))&&void 0!==i?i:""}),[p,h]=(0,A.eJ)(c.twitterPixelSignupEventId),[m,g]=(0,A.eJ)(c.twitterPixelSubscribeEventId),v=(0,A.I4)(async()=>{try{d(!0);let{twitter_pixel_signup_event_id:e,twitter_pixel_subscribe_event_id:t}=(await N().put("/api/v1/publication_settings").send({twitter_pixel_signup_event_id:p.trim(),twitter_pixel_subscribe_event_id:m.trim()})).body.reduce((e,t)=>Object.assign(e,{[t.type]:t.value_text}),{});u({twitterPixelSignupEventId:null!=e?e:"",twitterPixelSubscribeEventId:null!=t?t:""})}catch(e){l.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:o("An error occurred"),Icon:K.Z})))}finally{d(!1)}},[o,p,m,d,l]),b=p!==c.twitterPixelSignupEventId||m!==c.twitterPixelSubscribeEventId;return(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{title:o("Analytics"),id:"analytics-settings",children:[(0,Z.tZ)(Tp,{settingName:"google_analytics_4_token",validator:e=>(null==e?void 0:e.startsWith("UA"))?o("Universal analytics is no longer supported. Please use a Google Analytics 4 ID."):null,valueSanitizer:e=>{var t;return null!==(t=null==e?void 0:e.trim())&&void 0!==t?t:null},primaryText:o("Google Analytics Measurement ID"),secondaryText:(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(ei.xv.B4,{as:"span",color:"secondary",translated:!0,children:["Use a GA4 measurement ID to track page views and conversion."," ",(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us/articles/15955098199444",children:"Learn more"}),"."]})}),maxlength:25,placeholder:"e.g. G-12345"}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Si,{title:o("Google Tag Manager ID"),description:o("Use a Google Tag Manager ID to add custom tags to your publication."),placeholder:"e.g. GTM-1234",lineField:"google_tag_manager_token"})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Si,{title:o("Facebook pixel ID"),description:o("Use a Facebook pixel to track conversion from Facebook ads."),placeholder:"e.g. 123456789",lineField:"fb_pixel_id"})}),(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(Si,{title:o("Twitter pixel ID"),description:o("Use a Twitter pixel to track conversion from Twitter ads."),placeholder:"e.g. abcdef",lineField:"twitter_pixel_id"}),(0,Z.tZ)(ik.H,{expanded:!!n.twitter_pixel_id,children:n.twitter_pixel_id&&(0,Z.BX)(et.tu,{padding:16,radius:"md",border:"detail",gap:8,style:{marginTop:"16px"},children:[(0,Z.tZ)(ei.xv.H4,{weight:"semibold",size:14,translated:!0,children:"Additional Twitter settings"}),(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:["Twitter recently released a new version of their tracking tools which allows advertisers to create events for specific actions taken by readers. Substack will, by default, send events corresponding to page views to Twitter. If you wish to also send events for free and paid subscriptions, create new event types following the rules"," ",(0,Z.tZ)("a",{href:"https://business.twitter.com/en/help/campaign-measurement-and-analytics/conversion-tracking-for-websites.html#event-types-and-parameters",target:"_blank",children:"here"})," ","and insert the corresponding event IDs below."]}),(0,Z.tZ)(tD.oi,{value:p,disabled:s,onChange:e=>{h(e.currentTarget.value)},paddingBottom:8,placeholder:o("Event ID for free signup event")}),(0,Z.tZ)(tD.oi,{value:m,disabled:s,onChange:e=>{g(e.currentTarget.value)},placeholder:o("Event ID for paid subscribe event")}),(0,Z.BX)(et.gq,{justifyContent:"end",gap:8,children:[(0,Z.tZ)(ee.zx,{priority:"secondary",disabled:!b||s,onClick:()=>{var e,t;h(null!==(e=c.twitterPixelSignupEventId)&&void 0!==e?e:""),g(null!==(t=c.twitterPixelSubscribeEventId)&&void 0!==t?t:"")},children:o("Cancel")}),(0,Z.tZ)(ee.zx,{priority:"primary",disabled:!b||s,onClick:v,children:o("Save")})]})]})})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Si,{title:o("Parse.ly pixel ID"),description:o("Use a Parse.ly pixel for tracking."),placeholder:"e.g. abcdef.com",lineField:"parsely_pixel_id"})}),r&&(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Si,{title:o("Google Site Verification"),description:o('Some Google products will require you verify control of this publication. When doing so, choose "URL prefix property" and the "HTML tag" method. Paste the "meta tag" Google provides you here to complete verification.'),placeholder:'e.g. <meta name="google-site-verification" content="xxxxxxxx">',lineField:"google_site_verification_token",maxLength:255,valueSanitizer:TP})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Si,{title:o("Facebook Site Verification"),description:o('Some Facebook products (e.g. ads) will require you verify control of this publication. When doing so, choose the "HTML meta tag" method. Paste the "meta tag" Facebook provides you here to complete verification.'),placeholder:'e.g. <meta name="facebook-domain-verification" content="xxxxxxxx">',lineField:"fb_site_verification_token",maxLength:255,valueSanitizer:TP})})]})})});var TX=i(19237),TM=i(51110);let TA={logo:"logo-cuPJWF",wordmark:"wordmark-EDBmW5",welcomeImage:"welcomeImage-XgMJyZ",placeholder:"placeholder-BgI3ut",loadingOverlay:"loadingOverlay-Nf0VrN",logoImageWrapper:"logoImageWrapper-eihFTX",logoWrapper:"logoWrapper-yk7PbA",deleteButton:"deleteButton-KkxbxA"},TD=(0,en.zF4)("/icon/SubstackIcon?height=128&fill=%23DDDDDD&stroke=%23DDDDDD",256),TR=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(et.gq,{children:(0,Z.tZ)(oH.sY,{primaryText:e("Publication logo"),secondaryText:e("Square image at least 256\xd7256 pixels")})})},TF=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(et.gq,{children:(0,Z.tZ)(oH.sY,{primaryText:e("Publication wordmark"),secondaryText:e("Image at least 1344\xd7256 pixels that replaces your publication name in the navigation bar.")})})},TL=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(et.gq,{children:(0,Z.tZ)(oH.sY,{primaryText:e("Welcome page photo"),secondaryText:(0,Z.BX)(Z.HY,{children:[e("Image at least 600x600 pixels that is shown on your "),(0,Z.tZ)(ei.hh,{href:"/welcome",target:"_blank",rel:"noopener",decoration:"underline",children:e("welcome page")}),"."]})})})},Tz=e=>{let{photoUrl:t,onChange:i,onDelete:n,allowGeneratedImage:r,loading:o}=e,{iString:a}=(0,Q.M1)();return(0,Z.tZ)(TV,{photoUrl:t,onChange:i,onDelete:n,allowGeneratedImage:r,loading:o,children:(0,Z.tZ)(iZ.e,{useRetinaSizing:!0,imageIsFixedWidth:!0,width:96,className:TA.logo,src:t||TD,alt:a("Publication logo")})})},TO=e=>{let{photoUrl:t,onChange:i,onDelete:n,allowGeneratedImage:r,loading:o}=e,{iString:a}=(0,Q.M1)();return(0,Z.tZ)(TV,{photoUrl:t,onChange:i,onDelete:n,allowGeneratedImage:r,loading:o,children:(0,Z.tZ)(iZ.e,{useRetinaSizing:!0,imageIsFixedWidth:!0,width:96,className:TA.wordmark,src:t||TD,alt:a("Publication wordmark")})})},TU=e=>{let{photoUrl:t,onChange:i,onDelete:n,allowGeneratedImage:r,loading:o}=e,{iString:a}=(0,Q.M1)();return(0,Z.tZ)(TV,{photoUrl:t,onChange:i,onDelete:n,allowGeneratedImage:r,loading:o,children:(0,Z.tZ)(iZ.e,{useRetinaSizing:!0,imageIsFixedWidth:!0,width:96,className:TA.welcomeImage,src:t||TD,alt:a("Welcome page photo")})})},TY=e=>{let{error:t}=e;return(0,Z.tZ)(et.gq,{alignSelf:"flex-start",justifyContent:"start",bg:"accent-red",radius:"sm",paddingX:8,paddingY:4,children:(0,Z.tZ)(ei.xv.B4,{color:"error",weight:"semibold",children:t})})},TH=e=>{let{onChange:t,allowGeneratedImage:i,loading:n}=e,{iString:r}=(0,Q.M1)(),o=(0,A.sO)(null),[a,l]=(0,A.eJ)(!1),s=async e=>{t({target:{files:[new File([e],"generated.png",{type:"image/png"})]}})};return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(Tj,{onReplace:()=>{var e;null===(e=o.current)||void 0===e||e.click()},onGenerate:()=>{l(!0)},allowGeneratedImage:i,trigger:e=>(0,Z.tZ)(et.tu,(0,_._)((0,f._)({bg:"secondary",className:TA.placeholder,alignItems:"center",justifyContent:"center",padding:8,gap:8,border:"detail",radius:"sm",cursor:"pointer"},e),{children:n?(0,Z.tZ)(iI.$j,{size:24}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(TX.Z,{size:20,stroke:"var(--color-fg-secondary)"}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",align:"center",weight:"semibold",children:r("Add image")})]})}))}),(0,Z.tZ)("input",{type:"file",name:"logo",onChange:t,style:{display:"none"},ref:o}),i&&(0,Z.tZ)(_a.Z,{open:a,insertionPointSelector:"#basics",onAfterClose:()=>l(!1),onImageSelected:s})]})},Tj=e=>{let{onReplace:t,onGenerate:i,allowGeneratedImage:n,trigger:r}=e,{iString:o}=(0,Q.M1)();return(0,Z.BX)(tC.v2,{trigger:r,children:[(0,Z.tZ)(tC.sN,{onClick:t,leading:(0,Z.tZ)(uc.Z,{}),children:o("Upload image")}),n&&(0,Z.tZ)(tC.sN,{onClick:i,leading:(0,Z.tZ)(TM.Z,{}),children:o("Generate image")})]})},TJ=e=>{let{onReplace:t,onGenerate:i,onDelete:n,allowGeneratedImage:r,trigger:o}=e,{iString:a}=(0,Q.M1)();return(0,Z.BX)(tC.v2,{trigger:o,children:[(0,Z.tZ)(tC.sN,{onClick:t,leading:(0,Z.tZ)(uc.Z,{}),children:a("Upload new image")}),r&&(0,Z.tZ)(tC.sN,{onClick:i,leading:(0,Z.tZ)(TM.Z,{}),children:a("Generate new image")}),(0,Z.tZ)(tC.xw,{children:(0,Z.tZ)(tC.sN,{onClick:n,leading:(0,Z.tZ)(g3.Z,{}),priority:"destructive",children:a("Delete image")})})]})},TV=e=>{let{photoUrl:t,onChange:i,children:n,onDelete:r,allowGeneratedImage:o,loading:a}=e,l=(0,A.sO)(null),[s,d]=(0,A.eJ)(!1),c=async e=>{i({target:{files:[new File([e],"generated.png",{type:"image/png"})]}})};return(0,Z.BX)(et.tu,{position:"relative",className:TA.logoWrapper,children:[t?(0,Z.tZ)(TJ,{onReplace:()=>{var e;null===(e=l.current)||void 0===e||e.click()},onGenerate:()=>{d(!0)},onDelete:r,allowGeneratedImage:o,trigger:e=>(0,Z.BX)(et.tu,(0,_._)((0,f._)({position:"relative",border:"detail",radius:"sm",className:TA.logoImageWrapper},e),{children:[n,a&&(0,Z.tZ)(et.tu,{position:"absolute",alignItems:"center",justifyContent:"center",className:TA.loadingOverlay,children:(0,Z.tZ)(iI.$j,{media:!0,size:24})})]}))}):(0,Z.tZ)(TH,{onChange:i,allowGeneratedImage:o,loading:a}),t&&!a&&(0,Z.tZ)(ee.kG,{onClick:e=>{e.stopPropagation(),r()},className:TA.deleteButton,"aria-label":"Delete image",children:(0,Z.tZ)(K.Z,{size:16})}),(0,Z.tZ)("input",{type:"file",name:"logo",onChange:i,style:{display:"none"},ref:l}),o&&(0,Z.tZ)(_a.Z,{open:s,insertionPointSelector:"#basics",onAfterClose:()=>d(!1),onImageSelected:c})]})},Tq=async function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new FormData().append("logo",t),N().post(e).attach("logo",t).query(i)},TW=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return N().delete(e).query(t)};class TG extends w.Component{setLoading(e){this.setState({loading:e})}setError(e){this.setState({error:e})}handleApiError(e,t){let i=(0,Y.zx)(e,this.context.iString(t));this.setError(i),this.setLoading(!1),console.error("".concat(t,":"),i)}render(e){return console.warn("BaseImageUploadElementProps.render called, but it should be overridden by subclasses"),null}async handleImageUpload(e,t,i){var n,r,o,a;let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.setLoading(!0),this.setError(null);let s=null===(n=e.target)||void 0===n?void 0:n.files[0];if(!s){this.setLoading(!1);return}try{if(this.props.submitWithAjax){let e=await Tq(t,s,(0,f._)({noRedirect:!0},l));this.setLoading(!1),this.setError(null),null===(r=(o=this.props).onChangeLogo)||void 0===r||r.call(o,e.body.url)}else{let e=new FormData(null!==(a=this.form)&&void 0!==a?a:void 0);e.set("logo",s),await N().post(t).query(l).send(e),window.location.reload()}}catch(e){this.handleApiError(e,i)}}async handleImageDelete(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(window.confirm(this.context.iString(t))){this.setLoading(!0),this.setError(null);try{if(this.props.submitWithAjax){var r,o;await TW(e,n),this.setLoading(!1),this.setError(null),null===(r=(o=this.props).onChangeLogo)||void 0===r||r.call(o,null)}else await TW(e,n),window.location.reload()}catch(e){this.handleApiError(e,i)}}}constructor(e,t){super(e,t),(0,M._)(this,"form",void 0),(0,M._)(this,"assignForm",e=>{this.form=e});let i={url:this.props.url||null,loading:!1,error:null};this.state=i}}(0,M._)(TG,"contextType",Q.wj);class TK extends TG{render(e){let{publication:t,logoError:i,submitWithAjax:n,id:r}=e,o=n?this.props.url:null==t?void 0:t.logo_url,a=i||this.state.error;return(0,Z.tZ)("form",{id:r,action:"/api/v1/publication/logo",method:"post",enctype:"multipart/form-data",ref:this.assignForm,children:(0,Z.BX)(et.gq,{gap:20,children:[(0,Z.BX)(et.tu,{flex:"grow",gap:8,children:[(0,Z.tZ)(TR,{}),a&&(0,Z.tZ)(TY,{error:a})]}),(0,Z.tZ)(et.tu,{children:(0,Z.tZ)(Tz,{photoUrl:o,onChange:this.handleChange,onDelete:this.handleDelete,onGenerate:()=>this.setState({generationModalOpen:!0}),allowGeneratedImage:!0,loading:this.state.loading})})]})})}constructor(...e){super(...e),(0,M._)(this,"handleChange",e=>{this.handleImageUpload(e,"/api/v1/publication/logo","error uploading logo")}),(0,M._)(this,"handleDelete",()=>{this.handleImageDelete("/api/v1/publication/logo","Are you sure you'd like to delete your logo?","error deleting logo")})}}class TQ extends TG{render(e){let{publication:t,logoErrorWide:i,submitWithAjax:n,id:r}=e,o=n?this.props.url:t.logo_url_wide,a=i||this.state.error;return(0,Z.tZ)("form",{id:r,action:"/api/v1/publication/logo?wide=true",method:"post",enctype:"multipart/form-data",ref:this.assignForm,children:(0,Z.BX)(et.gq,{gap:20,children:[(0,Z.BX)(et.tu,{flex:"grow",gap:8,children:[(0,Z.tZ)(TF,{}),a&&(0,Z.tZ)(TY,{error:a})]}),(0,Z.tZ)(et.tu,{children:(0,Z.tZ)(TO,{photoUrl:o,onChange:this.handleChange,onDelete:this.handleDelete,allowGeneratedImage:!1,loading:this.state.loading})})]})})}constructor(...e){super(...e),(0,M._)(this,"handleChange",e=>{this.handleImageUpload(e,"/api/v1/publication/logo","error uploading wordmark",{wide:!0})}),(0,M._)(this,"handleDelete",()=>{this.handleImageDelete("/api/v1/publication/logo","Are you sure you'd like to delete your wordmark?","error deleting wordmark",{wide:!0})})}}class T$ extends TG{render(e){var t;let{publication:i,logoErrorCover:n}=e,r=(0,en.zF4)(null!==(t=i.cover_photo_url)&&void 0!==t?t:""),o=n||this.state.error;return(0,Z.tZ)(et.tu,{gap:8,children:(0,Z.tZ)("form",{action:"/api/v1/publication/logo?cover=true",method:"post",encType:"multipart/form-data",ref:this.assignForm,children:(0,Z.BX)(et.gq,{justifyContent:"space-between",gap:20,children:[(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(TL,{}),o&&(0,Z.tZ)(TY,{error:o})]}),(0,Z.tZ)(et.tu,{children:(0,Z.tZ)(TU,{photoUrl:r,onChange:this.handleChange,onDelete:this.handleDelete,allowGeneratedImage:!1,loading:this.state.loading})})]})})})}constructor(...e){super(...e),(0,M._)(this,"handleChange",e=>{this.handleImageUpload(e,"/api/v1/publication/logo","error uploading welcome page photo",{cover:!0})}),(0,M._)(this,"handleDelete",()=>{this.handleImageDelete("/api/v1/publication/logo","Are you sure you'd like to delete your welcome page photo?","error deleting welcome page photo",{cover:!0})})}}function T0(){let{iString:e}=(0,Q.M1)(),{getSettingFor:t,changeSetting:i}=(0,ss.So)(),n="notes_feed_enabled",r=!!t(n);return(0,Z.tZ)(cl.A,{children:(0,Z.BX)(cl.t5,{children:[(0,Z.BX)(oH.ZR,{id:"enable-notes-feed",children:[(0,Z.tZ)(oH.sY,{primaryText:e("Enable notes tab"),secondaryText:e("Show your notes in a new tab on your publication website.")}),(0,Z.tZ)(i2.rs,{checked:r,onChange:()=>{i({[n]:!r})}})]}),r&&(0,Z.tZ)(T1,{})]})})}function T1(){var e;let{iString:t}=(0,Q.M1)(),{data:i,isLoading:n,mutate:r}=(0,my._I)("/api/v1/publication_user",{},{revalidateOnMount:!0}),o=null!=i?i:[],a=o.filter(e=>"byline"!==e.role);if(0===a.length||1===a.length&&(null===(e=a[0])||void 0===e?void 0:e.is_in_notes_feed))return null;let l=async(e,t)=>{let i=o.map(i=>i.id===e?(0,_._)((0,f._)({},i),{is_in_notes_feed:t}):i);r((0,ix.rd)("/api/v1/publication_user/".concat(e),{method:"PUT",json:{is_in_notes_feed:t}}).then(()=>i).catch(e=>{throw console.error(e),alert(e.getMessage()),e}),{revalidate:!1,optimisticData:i,rollbackOnError:!0})};return(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(oH.ZR,{id:"notes-feed-contributors",children:(0,Z.tZ)(oH.sY,{primaryText:t("Include notes from"),secondaryText:t("Choose whose notes should appear in your notes tab.")})}),n?(0,Z.tZ)(et.tu,{padding:20,alignItems:"center",radius:"sm",border:"detail",children:(0,Z.tZ)(iI.$j,{})}):(0,Z.tZ)(T2,{publicationUsers:o,changeUser:l})]})}let T2=e=>{let{publicationUsers:t,changeUser:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{bg:"secondary",children:[(0,Z.tZ)(gK,{style:{width:"var(--size-32)"}}),(0,Z.tZ)(gK,{children:n("Contributor")}),(0,Z.tZ)(gK,{align:"right",children:n("Include notes")})]})}),(0,Z.tZ)(gq,{children:t.filter(e=>"byline"!==e.role).map(e=>(0,Z.tZ)(T4,{publicationUser:e,changeUser:i},e.id))})]})})},T4=e=>{let{publicationUser:t,changeUser:i}=e;return(0,Z.BX)(gG,{children:[(0,Z.tZ)(gQ,{children:(0,Z.tZ)(eG.qE,{user:t.user,size:32})}),(0,Z.tZ)(gQ,{maxWidth:200,ellipsis:!0,children:t.user.name}),(0,Z.tZ)(gQ,{justifyContent:"end",children:(0,Z.tZ)(i2.rs,{size:"sm",checked:t.is_in_notes_feed,onChange:e=>i(t.id,e)})})]})};var T3=i(81623),T8=i(76819),T6=i(75561);function T5(){let e=(0,G._)(["This will hide the newsletter "," tab from your homepage, but all of its episodes will still be visible. Are you sure you want to proceed?"]);return T5=function(){return e},e}function T9(){let e=(0,G._)(["This will hide the newsletter "," tab from your homepage, but all of its post will still be visible. Are you sure you want to proceed?"]);return T9=function(){return e},e}function T7(){let e=(0,G._)(["This will make the newsletter "," tab visible on your homepage. Do you want to proceed?"]);return T7=function(){return e},e}function Ie(e){var t;let{isChatActive:i,isMeetingsActive:n}=e,{iString:r}=(0,Q.M1)(),o=ey(),{getSettingFor:a}=(0,ss.So)(),l=o.pub,s=l.podcast_enabled&&l.show_pub_podcast_tab,d=!!(a("reader_referrals_enabled")&&a("reader_referrals_leaderboard_enabled")),[c,u]=(0,A.eJ)(l.navigationBarItems||[]),[p,h]=(0,A.eJ)(null),[m,g]=(0,A.eJ)(!1),v=c.length>1,b=!!l.threads_v2_enabled,y=!!a("notes_feed_enabled"),w=(0,T8.Rx)(c,{isChatActive:!!i,isChatEnabled:b,isMeetingsActive:!!n,hasMultipleNewsletters:!!l&&l.sections&&l.sections.length>0,isFeedEnabled:y,isReaderReferralsLeaderboardActive:d,language:l.language}),C=(0,A.I4)(async(e,t)=>{if(e===t||m)return;g(!0);let i=c.map(e=>e.id).filter(t=>t!==e),n=i.indexOf(t);i.splice(n,0,e),u(c.map(e=>(0,_._)((0,f._)({},e),{sibling_rank:i.indexOf(e.id)})).sort((e,t)=>e.sibling_rank-t.sibling_rank));try{await N().put("/api/v1/publication/navigation-bar-item/siblingRank").send({siblingRank:i})}catch(e){u(c),alert((0,Y.zx)(e))}finally{g(!1)}},[m,c]),x=(0,A.I4)((e,t)=>{let i=[...c],n=i.findIndex(t=>t.id===e);t?n>=0?i[n]=t:i.push(t):n>=0&&i.splice(n,1),u(i)},[c]);return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Navigation bar links"),secondaryText:r("Add or remove items from the navigation bar at the top of your website.")}),(0,Z.tZ)(hp.J,{content:e=>{let{closePopover:t}=e;return(0,Z.tZ)(Ir,{pub:l,onNavigationBarItemChanged:x,onClose:t})},preferPlacement:"bottom-start",closeOnOutsideClick:!1,children:(0,Z.tZ)(ee.zx,{priority:"secondary",children:r("Add")})})]}),(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{bg:"secondary",children:[(0,Z.tZ)(gK,{children:r("Tab")}),(0,Z.tZ)(gK,{children:r("URL")}),(0,Z.tZ)(gK,{colSpan:2,children:r("Type")})]})}),(0,Z.BX)(gq,{children:[(0,Z.tZ)(Ii,{url:"/",title:r("Home")}),s&&(0,Z.tZ)(Ii,{url:"/podcast",title:r("Podcast")}),w.map(e=>e.standard_key?(0,Z.tZ)(It,{item:e}):(0,Z.tZ)(In,{pub:l,navigationBarItem:e,canSetSiblingRank:v,draggedId:p,setDraggedId:h,setNavigationBarOrder:C,onNavigationBarItemChanged:x},e.id))]})]})}),(0,Z.tZ)(eW.SiteConfigGate,{configKey:"group_sections_and_podcasts_in_menu",children:(0,Z.tZ)(xw,{id:"group-sections-and-podcasts-in-menu-enabled",publication:null!==(t=o.publicationSettings)&&void 0!==t?t:{},title:r("Group sections and podcasts in the navigation bar"),field:"group_sections_and_podcasts_in_menu_enabled",endpoint:"/api/v1/publication_settings",subtitle:r("When checked, sections and podcasts will be grouped into dropdowns.")})})]})}function It(e){let{item:t}=e,{result:i,setResult:n,refetch:r}=(0,iS.ib)({pathname:"/api/v1/publication/navigation-bar-item/standard",method:"PUT",initialResult:t}),o=(0,T6.CD)((0,f._)({},t),i);return(0,Z.tZ)(Ii,{url:o.link_url,title:o.link_title,actions:(0,Z.tZ)(ee.hU,{priority:"tertiary",onClick:()=>{let e=!o.is_hidden;n((0,_._)((0,f._)({},o),{is_hidden:e})),r({json:{standard_key:o.standard_key,is_hidden:e}})},size:"sm",children:o.is_hidden?(0,Z.tZ)(pf.Z,{size:20}):(0,Z.tZ)(py.Z,{size:20})})})}function Ii(e){let{url:t,title:i,actions:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.BX)(gG,{children:[(0,Z.tZ)(gQ,{children:i}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.hh,{decoration:"hover-underline",href:t,native:!0,color:"secondary",children:t})}),(0,Z.tZ)(gQ,{children:r("Standard")}),(0,Z.tZ)(gQ,{justifyContent:"end",children:n})]})}let In=e=>{var t;let{pub:i,navigationBarItem:n,canSetSiblingRank:r,draggedId:o,setDraggedId:a,setNavigationBarOrder:l,onNavigationBarItemChanged:s}=e,{iString:d,iTemplate:c}=(0,Q.M1)(),[u,p]=(0,A.eJ)(!1),[h,m]=(0,A.eJ)(!1),g=(0,A.sO)(null),v=(0,A.I4)(e=>{e.dataTransfer.effectAllowed="move",a(n.id)},[a,n.id]),b=(0,A.I4)(e=>{e.preventDefault(),g.current&&(g.current.classList.add("targeted"),g.current.classList.add("up"))},[]),y=(0,A.I4)(e=>{var t,i,n;e.preventDefault(),null===(t=g.current)||void 0===t||t.classList.remove("targeted"),null===(i=g.current)||void 0===i||i.classList.remove("up"),null===(n=g.current)||void 0===n||n.classList.remove("down")},[]),f=(0,A.I4)(e=>{e.preventDefault()},[]),_=(0,A.I4)(e=>{var t,i,n;e.preventDefault(),a(null),null===(t=g.current)||void 0===t||t.classList.remove("targeted"),null===(i=g.current)||void 0===i||i.classList.remove("up"),null===(n=g.current)||void 0===n||n.classList.remove("down")},[a]),w=(0,A.I4)(async e=>{var t,i,r;e.preventDefault(),null===(t=g.current)||void 0===t||t.classList.remove("targeted"),null===(i=g.current)||void 0===i||i.classList.remove("up"),null===(r=g.current)||void 0===r||r.classList.remove("down"),a(null),await l(o,n.id)},[o,a,n.id,l]),C=(0,A.I4)(async()=>{try{await N().delete("/api/v1/publication/navigation-bar-item/".concat(n.id)),s(n.id,null);let e=(0,T8.Hs)(n);["tag","page"].includes(e)&&window.location.reload()}catch(e){alert((0,Y.zx)(e))}},[n,s]),x=async e=>{let{section:t}=e;if(!t){console.warn("section missing in call to hide from navbar");return}let i=!t.hide_from_navbar,n=i?t.is_podcast?c(T5(),t.name):c(T9(),t.name):c(T7(),t.name);if(window.confirm(n)){try{await N()[i?"put":"delete"]("/api/v1/publication/sections/".concat(t.id,"/hide_from_navbar"))}catch(e){alert((0,Y.zx)(e))}window.location.reload()}};return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(gG,{ref:g,draggable:r,onDragStart:r?v:void 0,onDragEnter:r?f:void 0,onDragOver:r?b:void 0,onDragLeave:r?y:void 0,onDragEnd:r?_:void 0,onDrop:r?w:void 0,children:[(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:(0,Z.BX)(et.gq,{alignItems:"center",gap:12,minWidth:0,children:[r&&(0,Z.tZ)(et.hs,{flex:"auto",children:(0,Z.tZ)(T3.Z,{size:20,color:"var(--color-fg-tertiary)"})}),(0,Z.tZ)(ei.xv,{ellipsis:!0,children:(0,T8.ye)(n)})]})}),(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:(0,Z.tZ)(ei.hh,{decoration:"hover-underline",color:"secondary",href:(0,en.Oz)(i,n,{addBase:!0}),native:!0,children:(0,en.Oz)(i,n)})}),(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,width:200,children:(0,er.toTitleCase)((0,T8.Hs)(n))}),(0,Z.tZ)(gQ,{justifyContent:"end",children:n.section?(0,Z.tZ)(ee.hU,{priority:"tertiary",onClick:()=>{n.section&&x({section:n.section})},size:"sm",children:(null===(t=n.section)||void 0===t?void 0:t.hide_from_navbar)?(0,Z.tZ)(pf.Z,{size:20}):(0,Z.tZ)(py.Z,{size:20})}):(0,Z.tZ)(hp.J,{layerOptions:{triggerOffset:4,placement:"bottom-end"},onClose:()=>{m(!1)},content:e=>{let{closePopover:t}=e;return h?(0,Z.tZ)(Ir,{pub:i,navigationBarItem:n,onNavigationBarItemChanged:s,onClose:t}):(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(tC.sN,{onClick:()=>{m(!0)},children:d("Edit")}),(0,Z.tZ)(tC.sN,{priority:"destructive",onClick:()=>{p(!0),t()},children:d("Delete")})]})},closeOnOutsideClick:!h,children:(0,Z.tZ)(ee.hU,{priority:"tertiary",size:"sm",children:(0,Z.tZ)(pu.Z,{size:20})})})})]}),(0,Z.tZ)(dj.W,{isOpen:u,title:d("Delete link"),description:d("Are you sure you want to delete this link?"),onClose:()=>p(!1),primaryButton:(0,Z.tZ)(ee.zx,{onClick:C,priority:"destructive",children:d("Delete")}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:()=>p(!1),priority:"secondary",children:d("Cancel")})})]})},Ir=e=>{let{pub:t,navigationBarItem:i,onNavigationBarItemChanged:n,onClose:r}=e,{iString:o}=(0,Q.M1)(),a=(0,A.sO)(null),[l,s]=(0,A.eJ)(i?(0,T8.ye)(i):""),[d,c]=(0,A.eJ)(i?(0,en.Oz)(t,i):""),[u,p]=(0,A.eJ)(!1),[h,m]=(0,A.eJ)(null);(0,A.d4)(()=>{var e;null===(e=a.current)||void 0===e||e.focus()},[]);let g=(0,A.I4)(async()=>{if(!u){p(!0);try{let e;i?e=await N().put("/api/v1/publication/navigation-bar-item/".concat(i.id)).send({linkTitle:l,linkUrl:d}):(e=await N().post("/api/v1/publication/navigation-bar-item").send({linkTitle:l,linkUrl:d}),s(""),c("")),r(),n(e.body.id,e.body)}catch(e){m(e)}p(!1)}},[l,d,u,i,n,r]),v=(0,A.I4)(async()=>{i||(s(""),c("")),r()},[i,s,c,r]);return(0,Z.BX)("form",{style:{width:230},onSubmit:g,children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",paddingBottom:4,translated:!0,children:"Title"}),(0,Z.tZ)(tD.oi,{ref:a,name:"linkTitle",placeholder:o("Enter titleâ€¦"),value:l,onChange:e=>s(e.currentTarget.value)}),(0,Z.tZ)(ei.xv.B4,{weight:"semibold",paddingBottom:4,style:{marginTop:8},translated:!0,children:"Link"}),(0,Z.tZ)(tD.oi,{name:"linkUrl",placeholder:o("Enter linkâ€¦"),value:d,onChange:e=>c(e.currentTarget.value)}),(0,Z.BX)(et.hs,{paddingTop:8,gap:8,children:[(0,Z.tZ)(ee.zx,{type:"submit",size:"sm",priority:"primary",onClick:g,disabled:u,children:o("Save")}),(0,Z.tZ)(ee.zx,{size:"sm",priority:"tertiary",onClick:v,disabled:u,children:o("Cancel")})]}),h&&(0,Z.tZ)(ei.xv.H4,{color:"error",weight:"semibold",style:{marginTop:4},children:(0,Y.zx)(h)})]})};function Io(){let{pub:e}=ey(),{iString:t}=(0,Q.M1)(),i=(0,iS.NL)({pathname:"/api/v1/drafts",query:{filter:"pages",limit:3,offset:0},auto:!0,getPageInit:e=>{let{page:t,init:i}=e,n=i.query;return n.offset=t*n.limit,i}}),n=i.pages.map(e=>e.result||[]).flat(),r={back:(0,j.wI3)(e,{section:"Pages"})};return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:t("Custom pages"),secondaryText:t("Create custom pages and add to your navigation bar.")}),i.hasLoadedOnce&&(0,Z.tZ)(ee.zx,{priority:"secondary",href:(0,j.qYj)(e,(0,f._)({type:"page"},r)),children:t(0===n.length?"Add page":"Add")})]}),i.hasLoadedOnce&&n.length>0?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{bg:"secondary",children:[(0,Z.tZ)(gK,{children:t("Page")}),(0,Z.tZ)(gK,{children:t("URL")}),(0,Z.tZ)(gK,{colSpan:2,children:t("Status")})]})}),(0,Z.tZ)(gq,{children:n.map(t=>(0,Z.tZ)(Il,{pub:e,page:t,pagesResource:i,editorQueryParams:r}))})]})}),(0,Z.tZ)(Ia,{pagesResource:i})]}):i.lastPage.error?(0,Z.BX)(tM.y,{children:[t("Error:")," ",(0,Y.zx)(i.lastPage.error)]}):null]})}let Ia=e=>{var t,i,n,r;let{pagesResource:o}=e,{iString:a}=(0,Q.M1)();return(null===(t=o.lastPage)||void 0===t?void 0:t.isLoading)||(null===(n=o.lastPage)||void 0===n?void 0:null===(i=n.result)||void 0===i?void 0:i.length)&&o.lastPage.result.length>=3?(0,Z.tZ)(et.sg,{justifyContent:"center",alignItems:"center",children:(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary",onClick:()=>o.fetchMore(),children:a((null===(r=o.lastPage)||void 0===r?void 0:r.isLoading)?"Loadingâ€¦":"Show more")})}):null},Il=e=>{var t;let{pub:i,page:n,pagesResource:r,editorQueryParams:o}=e,{iString:a}=(0,Q.M1)(),[l,s]=(0,A.eJ)(null),d=null===(t=i.navigationBarItems)||void 0===t?void 0:t.some(e=>e.post_id===n.id),c=(0,A.I4)(async e=>{try{await N().delete("/api/v1/drafts/".concat(e)),s(null),r.fetchFirstPage()}catch(e){console.error(a("Error deleting:"),e),alert((0,Y.zx)(e,a("There was a network issue. Try again in a bit")))}},[a,r]),u=(0,A.I4)(async()=>{try{var e;await N().post("/api/v1/publication/navigation-bar-item").send({linkTitle:n.title,linkUrl:"/p/".concat(n.slug)}),null===(e=document.getElementById("Navigation"))||void 0===e||e.scrollIntoView(),window.location.reload()}catch(e){alert((0,Y.zx)(e))}},[n.title,n.slug]),p=(0,A.I4)(async()=>{let e=i.navigationBarItems.find(e=>e.post_id===n.id);try{if(!e)throw Error(a("No nav item found"));await N().delete("/api/v1/publication/navigation-bar-item/".concat(e.id)),window.location.reload()}catch(e){alert((0,Y.zx)(e))}},[a,n.id,i.navigationBarItems]),h=n.is_published&&n.slug;return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(gG,{"data-page":JSON.stringify(n),borderBottom:"detail",children:[(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:n.title||n.draft_title||a("Untitled page")}),(0,Z.BX)(gQ,{ellipsis:!0,maxWidth:200,children:[(0,Z.tZ)(ei.hh,{decoration:n.is_published&&n.slug?"hover-underline":"none",href:"/p/".concat(n.slug),native:!0,children:n.slug?"/p/".concat(n.slug):"No link"}),n.slug]}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(d_.Vp,{theme:h?"success":"default",priority:"secondary",children:h?a("Live"):a("Draft")})}),(0,Z.tZ)(gQ,{justifyContent:"end",children:(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{priority:"quaternary",size:"xs",children:(0,Z.tZ)(pu.Z,{size:20})}),layerOptions:{triggerOffset:4,placement:"bottom-end"},stopPropagation:!0,children:[(0,Z.tZ)(tC.sN,{onClick:d?p:u,children:d?a("Remove from navigation bar"):a("Add to navigation bar")}),(0,Z.tZ)(tC.sN,{href:(0,j.ANx)(i,n.id,{params:o}),children:a("Edit")}),!n.is_published&&(0,Z.tZ)(tC.sN,{onClick:async()=>{await N().post("/api/v1/drafts/".concat(n.id,"/publish")).send({send:!1,share_automatically:!1}),r.fetchFirstPage()},children:a("Publish")}),(0,Z.BX)(tC.xw,{children:[n.is_published&&n.slug&&(0,Z.tZ)(tC.sN,{priority:"destructive",onClick:async()=>{await N().post("/api/v1/drafts/".concat(n.id,"/unpublish")).send({}),r.fetchFirstPage(),p()},children:a("Unpublish")}),(0,Z.tZ)(tC.sN,{priority:"destructive",onClick:()=>{s(n.id)},children:a("Delete")})]})]})})]}),(0,Z.tZ)(dj.W,{isOpen:!eS()(l),title:a("Delete page"),description:a("Are you sure you want to delete this page?"),onClose:()=>s(null),primaryButton:(0,Z.tZ)(ee.zx,{onClick:()=>c(l),priority:"destructive",children:a("Delete")}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:()=>s(null),priority:"secondary",children:a("Cancel")})})]})};var Is=i(37730),Id=i(94895);function Ic(){let e=(0,G._)(["Show "," more tags"]);return Ic=function(){return e},e}function Iu(){var e;let{pub:t}=ey(),{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(!1),[o,a]=(0,A.eJ)(!1),l=(0,iS.ib)({pathname:"/api/v1/publication/post-tag/settings",auto:!0,deps:[t]}),s=(l.result||[]).sort((e,t)=>e.name.localeCompare(t.name)),d=o?s.length:8,c=s.slice(0,d),u=s.slice(d),p=!l.error&&l.hasLoadedOnce&&l.result&&l.result.length>0,h=l.error,m=(0,A.I4)((e,t)=>{t?l.result&&l.result.find(t=>t.id===e)?l.setResult(l.result.map(i=>i.id===e?t:i)):l.setResult(l.result.concat([t])):l.setResult(l.result&&l.result.filter(t=>t.id!==e))},[l]);return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:i("Custom tags"),secondaryText:i("Create custom tags to organize your posts.")}),l.hasLoadedOnce&&(0,Z.tZ)(ee.zx,{priority:"secondary",size:"md",onClick:()=>r(!0),children:i((null==l?void 0:null===(e=l.result)||void 0===e?void 0:e.length)?"Add":"Add tag")})]}),p?(0,Z.tZ)(Ip,{shownTags:c,pub:t,onPostTagChange:m}):h?(0,Z.BX)(tM.y,{children:[i("Error:"),(0,Y.zx)(l.error)]}):null,u.length>0&&(0,Z.tZ)(Ih,{truncatedTags:u,setShowAllTags:a}),(0,Z.tZ)(Ig,{isOpen:n,onClose:()=>r(!1),onChange:m})]})}let Ip=e=>{let{shownTags:t,pub:i,onPostTagChange:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{bg:"secondary",children:[(0,Z.tZ)(gK,{children:r("Tag")}),(0,Z.tZ)(gK,{colSpan:2,children:r("URL")})]})}),(0,Z.tZ)(gq,{children:t.map(e=>(0,Z.tZ)(Im,{pub:i,postTag:e,onChange:n}))})]})})},Ih=e=>{let{truncatedTags:t,setShowAllTags:i}=e,{iTemplate:n}=(0,Q.M1)();return(0,Z.tZ)(et.sg,{justifyContent:"center",alignItems:"center",children:(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary",onClick:()=>i(!0),children:n(Ic(),(0,er.numberToString)(t.length))})})};function Im(e){let{pub:t,postTag:i,onChange:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(!1),l=!!i.navigationBarItem,[s,d]=(0,A.eJ)(!1),c=(0,A.I4)(async()=>{try{await N().delete("/api/v1/publication/post-tag/".concat(i.id)),l&&window.location.reload(),n(i.id,null),a(!1)}catch(e){alert((0,Y.zx)(e))}},[i,n]),u=(0,A.I4)(async()=>{try{var e;await N().post("/api/v1/publication/navigation-bar-item").send({linkTitle:i.name,linkUrl:(0,en.Mk9)(t,i)}),null===(e=document.getElementById("Navigation"))||void 0===e||e.scrollIntoView(),window.location.reload()}catch(e){alert((0,Y.zx)(e))}},[i,t]),p=(0,A.I4)(async e=>{try{await N().delete("/api/v1/publication/navigation-bar-item/".concat(e)),window.location.reload()}catch(e){alert((0,Y.zx)(e))}},[]);return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(gG,{borderBottom:"detail",children:[(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:i.name}),(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:(0,Z.tZ)(ei.hh,{decoration:"underline",href:(0,en.Mk9)(t,i),children:(0,en.Mk9)(t,i)})}),(0,Z.tZ)(gQ,{justifyContent:"end",children:(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{priority:"quaternary",size:"xs",children:(0,Z.tZ)(pu.Z,{size:20})}),children:[(0,Z.tZ)(tC.sN,{onClick:l?()=>{var e;return p(null===(e=i.navigationBarItem)||void 0===e?void 0:e.id)}:u,children:r(l?"Remove from navigation bar":"Add to navigation bar")}),(0,Z.tZ)(tC.sN,{onClick:()=>d(!0),children:r("Edit")}),(0,Z.tZ)(tC.xw,{children:(0,Z.tZ)(tC.sN,{onClick:()=>a(!0),priority:"destructive",children:r("Delete")})})]})})]}),(0,Z.tZ)(Iv,{isOpen:s,onClose:()=>d(!1),onChange:n,postTag:i}),(0,Z.tZ)(dj.W,{isOpen:o,title:r("Delete tag"),description:r("Are you sure you want to delete this tag?"),onClose:()=>a(!1),primaryButton:(0,Z.tZ)(ee.zx,{onClick:c,priority:"destructive",children:r("Delete")}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:()=>a(!1),priority:"secondary",children:r("Cancel")})})]})}function Ig(e){let{isOpen:t,onClose:i,onChange:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(""),[l,s]=(0,A.eJ)(!1),[d,c]=(0,A.eJ)(null),u=(0,A.sO)(null);(0,A.d4)(()=>{if(t){var e;null===(e=u.current)||void 0===e||e.focus()}},[t]);let p=(0,A.I4)(async()=>{if(!l&&o.trim()){s(!0),c(null);try{let e=await N().post("/api/v1/publication/post-tag").send({name:o});n(e.body.id,e.body),a(""),i()}catch(e){c(e)}s(!1)}},[o,l,n,i]);return(0,Z.BX)(eK.u_,{isOpen:t,onClose:i,children:[(0,Z.tZ)(eK.xB,{title:r("New tag"),showClose:!0,onClose:i}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{children:r("Tag name")}),(0,Z.tZ)(tD.oi,{ref:u,placeholder:r('e.g. "Travel" or "Roundups"'),leading:(0,Z.tZ)(Is.Z,{size:18}),value:o,disabled:l,error:!!d,onChange:e=>a(e.target.value)}),d&&(0,Z.tZ)(tM.y,{children:(0,Y.zx)(d)})]})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{loading:l,onClick:p,priority:"primary",disabled:!o.trim(),children:r("Save")}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:i,priority:"secondary",disabled:l,children:r("Cancel")})})]})}function Iv(e){let{isOpen:t,onClose:i,onChange:n,postTag:r}=e,{iString:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(r?r.name:""),[s,d]=(0,A.eJ)(r?r.slug:""),[c,u]=(0,A.eJ)(!1),[p,h]=(0,A.eJ)(null),m=(0,A.sO)(null),g=r&&!!r.navigationBarItem;(0,A.d4)(()=>{if(t){var e;null===(e=m.current)||void 0===e||e.focus()}},[t]);let v=(0,A.I4)(async()=>{if(!c&&a.trim()){u(!0),h(null);try{let e=await N().put("/api/v1/publication/post-tag/".concat(r.id)).send({name:a,slug:s});g&&window.location.reload(),n(e.body.id,e.body),i()}catch(e){h(e)}u(!1)}},[a,s,c,r.id,g,n,i]);return(0,Z.BX)(eK.u_,{isOpen:t,onClose:i,children:[(0,Z.tZ)(eK.xB,{title:o("Edit tag"),showClose:!0,onClose:i}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.sg,{gap:20,children:[(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{children:o("Tag name")}),(0,Z.tZ)(tD.oi,{ref:m,name:"tagName",placeholder:o('e.g. "Travel" or "Roundups"'),leading:(0,Z.tZ)(Is.Z,{size:18}),value:a,disabled:c,onChange:e=>l(e.target.value)})]}),(0,Z.BX)(tD.fv,{children:[(0,Z.tZ)(tA.__,{children:o("URL")}),(0,Z.tZ)(tD.oi,{name:"tagSlug",placeholder:o('e.g. "travel" or "roundups"'),leading:(0,Z.tZ)(Id.Z,{size:18}),value:s,disabled:c,onChange:e=>d(e.target.value)})]}),p&&(0,Z.tZ)(tM.y,{children:(0,Y.zx)(p)})]})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{onClick:v,priority:"primary",disabled:c||!a.trim(),children:o(c?"Saving...":"Save")}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:i,priority:"secondary",disabled:c,children:o("Cancel")})})]})}let Ib=()=>{let{iString:e}=(0,Q.M1)(),t={contributorsAndAdmins:e("All contributors"),admins:e("Admins only"),noone:e("No one")},i=(0,ss.So)();return(0,Z.tZ)(x9,{publication:i.preloadedPubSettings,title:e("Show live videos on homepage"),subtitle:e("Choose whose live videos should appear on your website"),field:"live_stream_homepage_visibility",endpoint:"/api/v1/publication_settings",options:Object.entries(t).map(t=>{let[i,n]=t;return{name:e(n),value:i}})})},Iy=()=>{let{iString:e}=(0,Q.M1)(),t={autoPlay:e("Auto-play live video"),banner:e("Banner")},i=(0,ss.So)();return(0,Z.tZ)(x9,{publication:i.preloadedPubSettings,title:e("Style of live video on homepage"),subtitle:e("Choose how live videos should appear on your homepage"),field:"live_stream_homepage_style",endpoint:"/api/v1/publication_settings",options:Object.entries(t).map(t=>{let[i,n]=t;return{name:e(n),value:i}})})};function If(){let e=(0,G._)([""," is a Substack about..."]);return If=function(){return e},e}function I_(e){let{value:t,options:i,onChange:n}=e,r="profile"===t?i.find(e=>"profile"===e.value):i.find(e=>"newspaper"===e.value),{iString:o}=(0,Q.M1)(),a=e=>"profile"===e?o("Default"):o("Enable advanced navigation, layout, and branding");return(0,Z.tZ)(et.sg,{position:"relative",children:(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",trailing:(0,Z.tZ)(tw.Z,{}),children:(null==r?void 0:r.label)||""}),layerOptions:{placement:"bottom-end",triggerOffset:4,auto:!0},children:i.map(e=>(0,Z.tZ)(tC.LF,{onClick:()=>n(e.value),selected:"profile"===e.value?"profile"===t:"profile"!==t,subtitle:a(e.value),children:e.label},e.value))})})}function IZ(e){let{isChatActive:t,isMeetingsActive:i,publicationSettings:n,logoError:r,logoErrorWide:o,publication:a}=e,{pub:l}=ey(),{iString:s,iTemplate:d}=(0,Q.M1)(),{refetch:c}=(0,iS.ib)({pathname:"/theme",method:"put"});return(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{title:s("Website"),id:"website",withSubdomainLink:!0,pub:l,children:[(0,Z.BX)(cl.t5,{children:[(0,Z.BX)(oH.dk,{children:[(0,Z.tZ)(oH.sY,{primaryText:s("Publication theme"),secondaryText:s("Set color, layout, and font styles for your site.")}),(0,Z.tZ)(et.gq,{gap:12,children:(0,Z.tZ)(I_,{value:a.homepage_type,options:[{value:"profile",label:s("Match profile")},{value:"newspaper",label:s("Custom theme")}],onChange:e=>{(0,U.j)(U.FP.PUBLICATION_THEME_TOGGLED,{theme:e,previous_theme:a.homepage_type}),e!==a.homepage_type&&c({json:{homepage_type:e}}).then(()=>{window.scrollTo(0,0),window.location.reload()})}})})]}),"profile"!==a.homepage_type&&(0,Z.tZ)(oH.dk,{children:(0,Z.tZ)(et.gq,{gap:12,style:{width:"100%"},children:(0,Z.BX)(ee.zx,{flex:"grow",priority:"secondary",onClick:()=>(0,B.route)("/publish/settings/website-theme"),children:[s("Go to website theme editor"),(0,Z.tZ)(iy.Z,{})]})})})]}),"profile"!==a.homepage_type&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(TK,{id:"logo",publication:l,logoError:r})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Si,{title:s("Publication name"),lineField:"name"})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Si,{title:s("Publication short description"),description:s("Add a single sentence that succinctly explains what your publication is about."),lineField:"hero_text",placeholder:d(If(),l.name),multiline:!0})}),(0,Z.tZ)(cl.t5,{children:l.logo_url&&(0,Z.tZ)(TQ,{publication:a,logoError:o})}),(0,Z.tZ)(tX.iz,{pullX:20}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(et.tu,{height:32,justifyContent:"center",children:(0,Z.tZ)(ei.xv.B2,{weight:"bold",children:s("Pages and navigation")})})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(kh,{title:s("About page"),bodyField:"subscribe_content",detailText:s("This page should describe the benefits of subscribing to your publication.")})}),("newspaper"===l.homepage_type||"magaziney"===l.homepage_type)&&(0,Z.tZ)(cl.t5,{children:(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:s("Homepage links"),secondaryText:s("Add, edit, or remove links to your Substack homepage. Use them for a blogroll, community resources, or other related references.")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/settings/homepage_links",children:s("Edit")})]})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(xw,{id:"enable-prev-next-link",publication:n,title:s("Enable navigation buttons on posts"),field:"enable_prev_next_nav",endpoint:"/api/v1/publication_settings",subtitle:s("Show links to the next and previous post on each post page")})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Ib,{})}),"noone"!==n.live_stream_homepage_visibility&&(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Iy,{})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(Ie,{isChatActive:t,isMeetingsActive:i})}),(0,Z.tZ)(cl.t5,{extraKeywords:"pages",children:(0,Z.tZ)(Io,{})}),(0,Z.tZ)(cl.t5,{extraKeywords:"tags",children:(0,Z.tZ)(Iu,{})}),(0,Z.tZ)(tX.iz,{pullX:20}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(et.tu,{height:32,justifyContent:"center",children:(0,Z.tZ)(ei.xv.B2,{weight:"bold",children:s("Notes")})})}),(0,Z.tZ)(T0,{})]})]})})}function Iw(e){let{logoErrorCover:t}=e,{pub:i}=ey(),{iString:n}=(0,Q.M1)(),r=!!i.cover_photo_url;return(0,Z.tZ)(cl.A,{children:(0,Z.BX)(oH._R,{title:n("Welcome page"),id:"welcome-page",children:[(0,Z.tZ)(T$,{publication:i,logoError:t}),r&&"profile"!==i.homepage_type&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(xw,{id:"show-welcome-page-pub-name",publication:i,title:n("Show name on welcome page"),subtitle:n("Shows your publication name on your welcome page."),field:"hide_intro_title",endpoint:"/api/v1/publication",inverted:!0})}),(0,Z.tZ)(cl.t5,{children:(0,Z.tZ)(xw,{id:"show-welcome-page-pub-subtitle",publication:i,title:n("Show short description on welcome page"),subtitle:n("Shows your publication short description on your welcome page."),field:"hide_intro_subtitle",endpoint:"/api/v1/publication",inverted:!0})})]}),(0,Z.tZ)(Tp,{settingName:"welcome_page_opt_out_text",validator:(0,er.textLengthAlphaNumericMinimumValidator)({minLength:2,maxLength:25,minAlphaNumeric:2}),primaryText:n('Custom "Skip" button on welcome page'),secondaryText:n("The button that allows visitors to continue without subscribing on your welcome page."),maxlength:25})]})})}let IC={settingsSidebarWrapper:"settingsSidebarWrapper-DThiHl",settingsSidebar:"settingsSidebar-tb4stT",row:"row-DeQXRL",active:"active-bfM9GL"},Ix=e=>{let{id:t}=e;return()=>{let e=document.getElementById(t);if(!e)return;history&&history.pushState(null,"","#".concat(t));let i=document.body.getBoundingClientRect().top,n=e.getBoundingClientRect().top;window.scrollTo({top:n-i-125,behavior:"smooth"})}},IS=e=>{let{item:t,isActive:i}=e,n=(0,A.I4)(Ix({id:t.id}),[t.id]);return(0,Z.tZ)(et.tu,{paddingX:8,paddingY:8,flex:"grow",onClick:n,className:k()(IC.row,i&&IC.active),children:(0,Z.tZ)(ei.xv.B4,{fontSize:14,weight:"medium",color:i?"primary":"secondary",children:t.name})})},Ik=e=>{let{sideBarItems:t}=e,[i,n]=(0,A.eJ)(t[0].id),r=e=>{let t=document.getElementById(e);if(!t)return;let i=document.body.getBoundingClientRect().top,n=t.getBoundingClientRect().top-i-(window.innerHeight/2-100);window.scrollTo({top:n,behavior:"smooth"})};return(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(et.tu,{paddingY:12,children:(0,Z.tZ)(cl.Vs,{slash:!0})}),(0,Z.tZ)(oY.i,{value:i,onChange:e=>{let t=e.target.value;n(t),r(t)},children:t.map(e=>(0,Z.tZ)("option",{value:e.id,children:e.name}))})]})};function IB(e){let{pub:t,user:i,meetingsEnabled:n,publisherApiEnabled:r,showDropdown:o}=e,a=function(e,t,i){let{meetingsEnabled:n,publisherApiEnabled:r}=i,{iString:o}=(0,Q.M1)(),a="enabled"===e.payments_state,l=e.invite_only,s=!!e.draft_plans&&["enabled","disabled","paused"].includes(e.payments_state)&&n;return nT()([{name:o("Basics"),id:"basics-settings"},{name:o("Payments"),id:"payments-settings"},{name:o("Website"),id:"website"},{name:o("Welcome page"),id:"welcome-page"},{name:o("Branding"),id:"branding"},a||!l?{name:o("Growth features"),id:"growth-settings"}:null,{name:o("Emails"),id:"email-settings"},{name:o("Community"),id:"community-settings"},{name:o("Chat"),id:"chat-settings"},{name:o("Podcasts"),id:"podcast-settings"},s?{name:o("Meetings"),id:"meetings-settings"}:null,{name:o("Sections"),id:"section-settings"},{name:o("Team"),id:"team-settings"},{name:o("Privacy"),id:"privacy-settings"},{name:o("Notifications"),id:"notifications"},{name:o("Connected accounts"),id:"connected-accounts"},{name:o("Domain"),id:"domain"},r?{name:o("Publisher API"),id:"publisher-api"}:null,{name:o("Analytics"),id:"analytics-settings"},{name:o("Details"),id:"pub-details"},{name:o("Import / Export"),id:"import-export-settings"},(0,S$.Kw)(t)?{name:o("Danger Zone"),id:"danger-zone"}:null])}(t,i,{meetingsEnabled:n,publisherApiEnabled:r}),l=function(e){var t,i;let n=[];for(let t of e){let[e,i]=(0,ov.Z)({rootMargin:"0px 0px -80% 0px"});(0,A.d4)(()=>{e(document.getElementById(t.id))},[t,e]),(null==i?void 0:i.isIntersecting)&&n.push(t)}return 0===n.length?null:1===n.length?null!==(t=n[0])&&void 0!==t?t:null:null!==(i=n[1])&&void 0!==i?i:null}(a);return o?(0,Z.tZ)(Ik,{sideBarItems:a}):(0,Z.tZ)(et.gq,{className:IC.settingsSidebarWrapper,children:(0,Z.BX)(et.tu,{gap:8,className:IC.settingsSidebar,padding:8,shadow:"xs",border:"detail",flex:"grow",children:[(0,Z.tZ)(cl.Vs,{className:IC.sidebarSearch,slash:!0}),(0,Z.tZ)(et.tu,{children:a.map(e=>(0,Z.tZ)(IS,{item:e,isActive:(null==l?void 0:l.id)===e.id}))})]})})}let IT={settingsContainer:"settingsContainer-sIM3dh"};function II(){let e=(0,G._)(["No results for ",""]);return II=function(){return e},e}class IN extends w.Component{async componentDidMount(){if(setTimeout(()=>(0,Y.pK)(),0),this.state.loading)try{let e=this.state.publication?this.state.publication:await N().get("/api/v1/publication").body,t=this.state.publicationSettings?this.state.publicationSettings:await N().get("/api/v1/publication_settings").body;this.setState({publication:e,publicationSettings:t,loading:!1})}catch(e){console.error(e),alert(this.context.iString("Error loading publication information"))}}render(e,t){let{pub:i,publication:n,publicationSettings:r,user:o,promptToLaunch:a,stripe_error:l,chatSettings:s,isChatActive:d,isMeetingsActive:c,logoError:u,logoErrorWide:p,logoErrorCover:h,didIdentity:m,dripCampaigns:g}=e,{loading:v,autoAcceptedPubU:b,customDomainError:y,exitPersonalModeDialogOpen:f,isInviteModalOpen:_}=t;return v?(0,Z.tZ)(IP,{}):(0,Z.BX)(tU.w,{children:[(0,Z.tZ)(et.hs,{className:"page typography",id:"settings",children:(0,Z.BX)(et.gq,{gap:{desktop:20,mobile:8},flex:"grow",sizing:"border-box",className:k()(IT.settingsContainer,"container"),children:[(0,Z.tZ)(mG(),{minWidth:750,children:(0,Z.tZ)(IB,{pub:i,user:o,meetingsEnabled:(0,eW.getConfigFor)("meetings_v1"),publisherApiEnabled:(0,eW.getConfigFor)("publisher_api_enabled")})}),(0,Z.BX)(et.tu,{flex:"grow",paddingBottom:20,className:IT.settingsColumn,children:[(0,Z.tZ)(mG(),{maxWidth:750,children:(0,Z.tZ)(IB,{pub:i,user:o,meetingsEnabled:(0,eW.getConfigFor)("meetings_v1"),publisherApiEnabled:(0,eW.getConfigFor)("publisher_api_enabled"),showDropdown:!0})}),(0,Z.BX)(cl.A,{noResults:e=>(0,Z.tZ)(IE,{searchQuery:e}),children:[(0,Z.tZ)(SS,{pub:i,publication:n}),(0,Z.tZ)(B7,{publication:n,publicationSettings:r,openPauseModal:this.openPauseModal,openPauseExtendModal:this.openPauseExtendModal,openInvoiceExportModal:this.openInvoiceExportModal,promptToLaunch:a,stripe_error:l}),(0,Z.tZ)(IZ,{isChatActive:d,isMeetingsActive:c,publication:n,publicationSettings:r,logoError:u,logoErrorWide:p}),(0,Z.tZ)(Iw,{logoErrorCover:h}),(0,Z.tZ)(Sl,{publication:n,publicationSettings:r,logoErrorCover:h}),(0,Z.tZ)(kN,{publication:n,pub:i,viralGiftsConfig:i.viralGiftsConfig,isEasyMode:(0,eW.getConfigFor)("reader_gift_referrals_enabled"),publicationSettings:r}),(0,Z.tZ)(kv,{pub:i,dripCampaigns:g}),(0,Z.tZ)(Sc,{publication:n,publicationSettings:r}),s&&(0,Z.tZ)(cb,{pub:i,chatSettings:s}),(0,Z.tZ)(x$,{publication:n}),!!i.draft_plans&&["enabled","disabled","paused"].includes(i.payments_state)&&(0,eW.getConfigFor)("meetings_v1")&&(0,Z.tZ)(kj,{user:o,publication:n,pub:i}),(0,Z.tZ)(x3,{}),(0,Z.tZ)(TN,{publication:n,publicationSettings:r,openInviteModal:this.handleOpenInviteModal,autoAcceptedPubU:b}),(0,Z.tZ)(Td,{pub:n,publicationSettings:r}),(0,Z.tZ)(kK,{publication:n}),(0,Z.tZ)(Sf,{}),(0,Z.tZ)(ku,{openDisableDomainModal:this.openDisableDomainModal,openDisableDomainRedirectsModal:this.openDisableDomainRedirectsModal,error:y,did:m}),(0,eW.getConfigFor)("publisher_api_enabled")&&(0,Z.tZ)(Tg,{hooksEnabled:(0,eW.getConfigFor)("export_hooks_enabled")}),(0,Z.tZ)(TE,{canSetGoogleSiteVerification:i.can_set_google_site_verification}),(0,Z.tZ)(Tu,{publication:n,publicationSettings:r}),(0,Z.tZ)(kM,{pub:n}),(0,Z.tZ)(ke,{openDisconnectStripeModal:this.openDisconnectStripeModal,openDisableDomainModal:this.openDisableDomainModal,openExitPersonalModeModal:this.openExitPersonalModeModal,showAttachedProfileSetting:(0,eW.getConfigFor)("show_attached_profile_for_pub_setting")})]})]}),(0,Z.tZ)(yH.ZP,{})]})}),(0,Z.tZ)(L.p,{ref:this.assignPauseModal,className:"pause-modal",children:(0,Z.tZ)(xM,{onFinish:this.onPauseModalFinish})}),(0,Z.tZ)(L.p,{ref:this.assignExtendPauseModal,className:"pause-modal",children:(0,Z.tZ)(xL,{onFinish:this.onPauseModalFinish})}),(0,Z.tZ)(L.p,{ref:this.assignInvoiceExportModal,children:(0,Z.tZ)(xW,{})}),(0,Z.tZ)(xV,{className:"disconnect-stripe-modal",ref:this.assignDisconnectStripeModal,onFinish:this.onDisconnectModalFinish}),(0,Z.tZ)(L.p,{ref:this.assignDisableDomainModal,children:(0,Z.tZ)(xI,{onContinue:this.onDisableDomainModalContinue})}),(0,Z.tZ)(L.p,{ref:this.assignDisableDomainRedirectsModal,children:(0,Z.tZ)(xN,{onContinue:this.onDisableDomainRedirectsModalContinue})}),(0,Z.tZ)(SD,{isOpen:!!f,onClose:()=>this.setState({exitPersonalModeDialogOpen:!1}),subdomain:n.subdomain}),(0,Z.tZ)(xq,{isOpen:_,onClose:this.handleCloseInviteModal,onSuccess:this.handleInviteSuccess})]})}constructor(e,t){super(e,t),(0,M._)(this,"assignPauseModal",e=>{this.pauseModal=e}),(0,M._)(this,"assignExtendPauseModal",e=>{this.extendPauseModal=e}),(0,M._)(this,"assignInvoiceExportModal",e=>{this.invoiceExportModal=e}),(0,M._)(this,"assignDisableDomainModal",e=>{this.disableDomainModal=e}),(0,M._)(this,"assignDisableDomainRedirectsModal",e=>{this.disableDomainRedirectsModal=e}),(0,M._)(this,"assignDisconnectStripeModal",e=>{this.disconnectStripeModal=e}),(0,M._)(this,"setCustomDomainError",e=>this.setState({customDomainError:e})),(0,M._)(this,"handleOpenInviteModal",()=>{this.setState({isInviteModalOpen:!0})}),(0,M._)(this,"handleCloseInviteModal",()=>{this.setState({isInviteModalOpen:!1})}),(0,M._)(this,"handleInviteSuccess",e=>{this.onNewInvite(e)}),(0,M._)(this,"openPauseModal",()=>this.pauseModal&&this.pauseModal.open()),(0,M._)(this,"openPauseExtendModal",()=>this.extendPauseModal&&this.extendPauseModal.open()),(0,M._)(this,"openInvoiceExportModal",()=>this.invoiceExportModal&&this.invoiceExportModal.open()),(0,M._)(this,"openDisconnectStripeModal",()=>this.disconnectStripeModal&&this.disconnectStripeModal.open()),(0,M._)(this,"openDisableDomainModal",()=>{this.disableDomainModal&&(this.disableDomainModal.open(),this.setCustomDomainError(null))}),(0,M._)(this,"openDisableDomainRedirectsModal",()=>{this.disableDomainRedirectsModal&&(this.disableDomainRedirectsModal.open(),this.setCustomDomainError(null))}),(0,M._)(this,"onPauseModalFinish",()=>{this.pauseModal&&(this.pauseModal.close(),document.location.reload()),this.extendPauseModal&&(this.extendPauseModal.close(),document.location.reload())}),(0,M._)(this,"onDisconnectModalFinish",()=>{this.disconnectStripeModal&&(this.disconnectStripeModal.close(),document.location.hash="#connect",document.location.reload(!0))}),(0,M._)(this,"onDisableDomainModalContinue",async()=>{try{await N().delete("/api/v1/domains"),(0,Y.uX)((0,j.wI3)(this.state.publication,{forceSubdomain:!0,section:"domain"}),{local_navigation:!1}),window.location.reload()}catch(e){this.setCustomDomainError((0,Y.zx)(e))}finally{this.disableDomainModal&&this.disableDomainModal.close()}}),(0,M._)(this,"onDisableDomainRedirectsModalContinue",async()=>{try{await N().post("/api/v1/domains/redirects").send({enabled:!1}),(0,Y.uX)((0,j.wI3)(this.state.publication,{section:"domain"}),{local_navigation:!1}),window.location.reload()}catch(e){this.setCustomDomainError((0,Y.zx)(e))}finally{this.disableDomainRedirectsModal&&this.disableDomainRedirectsModal.close()}}),(0,M._)(this,"onNewInvite",e=>{if(e.publicationUser){let t=this.state.autoAcceptedPubU||[];t.find(t=>t.id===e.publicationUser.id)||(t.push(e.publicationUser),this.setState({autoAcceptedPubU:t}))}else document.location.reload();this.handleCloseInviteModal()}),(0,M._)(this,"openExitPersonalModeModal",()=>{this.setState({exitPersonalModeDialogOpen:!0})}),this.state={genericError:(0,iP.x)("error"),customDomainError:null,loading:!0,loadingInvites:!0,exitPersonalModeDialogOpen:!1,isInviteModalOpen:!1},e.publication&&(this.state.publication=e.publication),e.publicationSettings&&(this.state.publicationSettings=e.publicationSettings),this.state.publication&&this.state.publicationSettings&&(this.state.loading=!1)}}(0,M._)(IN,"contextType",Q.wj);let IP=()=>(0,Z.tZ)(et.gq,{gap:20,paddingY:20,height:320,justifyContent:"center",alignItems:"center",children:(0,Z.tZ)(iI.$j,{})}),IE=e=>{let{searchQuery:t}=e,{iString:i,iTemplate:n}=(0,Q.M1)();return(0,Z.tZ)(et.gq,{gap:20,paddingY:20,height:320,children:(0,Z.tZ)(tp.mb,{icon:(0,Z.tZ)(xT.Z,{}),title:n(II(),t?'"'.concat(t,'"'):"this query"),text:i("Please try another search")})})},IX=(0,c0.f9)((0,ss.us)(eb(IN)));class IM extends ub.Z{getUploadLink(){return(0,Z.BX)("a",{href:"javascript:void(0)",className:"uploader-link edit",onClick:()=>{if((0,Y.w1)()||(0,Y.vU)()){var e;null===(e=this.input)||void 0===e||e.click()}},children:[this.props.iString("Upload"),(0,Z.tZ)("input",{ref:this.assignInput,className:"uploader-input",type:"file",accept:this.props.accepts||this.accepts,onChange:async()=>{var e,t;let i=null===(t=this.input)||void 0===t?void 0:null===(e=t.files)||void 0===e?void 0:e[0];this.input&&(this.input.value=""),this.uploadFile(i)}})]})}getRemoveLink(){let e=async e=>{e.preventDefault();try{var t;(null===(t=this.urls)||void 0===t?void 0:t[0])&&(await N().del(this.urls[0]),document.location.reload())}catch(e){alert((0,Y.zx)(e))}};return(0,Z.tZ)("a",{className:"edit remove",href:"javascript:void(0)",onClick:e,children:this.props.iString("Remove")})}render(e,t){let{className:i,bannerUrl:n}=e,{uploading:r,percentComplete:o,hasCompleted:a}=t;a&&(r=!0,o=100);let l=null;return l=r?(0,Z.tZ)("div",{className:"setting-body banner-placeholder",children:(0,Z.BX)("span",{children:[this.props.iString("Uploading:")," ",o||100,"%"]})}):n?(0,Z.tZ)("img",{className:"email-banner",src:n}):(0,Z.tZ)("div",{className:"setting-body banner-placeholder",children:(0,Z.tZ)("span",{children:this.props.iString("For best results, use 1100px x 220px PNG")})}),(0,Z.BX)("div",{className:k()("setting",i),children:[(0,Z.BX)("div",{className:"setting-title",children:[(0,Z.tZ)("span",{children:this.props.iString("Banner image")}),this.getUploadLink(),n&&this.getRemoveLink()]}),l]})}async onComplete(){this.setState({hasCompleted:!0}),super.onComplete()}onError(){this.setState({hasCompleted:!1}),super.onError()}constructor(e,t){super(e,t),(0,M._)(this,"input",void 0),(0,M._)(this,"assignInput",e=>{this.input=e}),this.accepts="image/png",this.urls=[e.uploadUrl]}}let IA=(0,Q.fz)(IM);var ID=i(46527);let IR=e=>{let{customEditEndpoint:t,customResetEndpoint:i,field:n,html:r,section:o,title:a,titleAugmentation:l}=e;return(0,Z.BX)("div",{className:"setting",children:[(0,Z.BX)("div",{className:"setting-title",children:[(0,Z.BX)("span",{children:[a,l]}),(0,Z.tZ)(IF,{bodyField:n,title:a,endpoint:t,section:o}),(0,Z.tZ)(IL,{field:n,endpoint:i,sectionId:null==o?void 0:o.id})]}),(0,Z.tZ)("div",{className:"setting-body markup",dangerouslySetInnerHTML:{__html:null!=r?r:""}})]})},IF=e=>{var{section:t}=e,i=(0,ef._)(e,["section"]);let{iString:n}=(0,Q.M1)(),[r,o]=(0,A.eJ)(document.location.href);return(0,A.d4)(()=>{setTimeout(()=>{o(document.location.href)},0)},[t]),(0,Z.tZ)("a",{href:(0,j.n1t)("/publish/settings/edit",(0,_._)((0,f._)({},i,t?{endpoint:Iz({sectionId:t.id}),title:"".concat(i.title," (").concat(t.name,")")}:{}),{redirect:r})),children:n("Edit")})},IL=e=>{let{field:t,endpoint:i="/api/v1/publication",sectionId:n}=e,{iString:r}=(0,Q.M1)(),o=n?Iz({sectionId:n}):i,a=async()=>{if(!window.confirm(r("Are you sure you want to reset this setting to its default?")))return;let e={};e[t]=null;try{await N().put(o).send(e),window.location.reload()}catch(e){var i;alert(null!==(i=e.message)&&void 0!==i?i:r("Something went wrong"))}};return(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:a,children:r("Reset")})},Iz=e=>{let{sectionId:t}=e;return"/api/v1/publication/sections/".concat(t,"/section_email_render_elements")},IO=e=>{let{open:t,setOpen:i,children:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)("div",{children:t?n:(0,Z.tZ)("div",{className:"show-more",children:(0,Z.tZ)("p",{onClick:()=>i(!0),children:r("Preview more options...")})})})},IU=e=>{var t,i,n,r;let{hasConnectedStripe:o,isPaid:a,oPost:l,pub:s,publication:d}=e,{iString:c}=(0,Q.M1)(),{oPost:u}=(0,ID.Z)({oPre:null,oPost:null});return(0,Z.BX)(Z.HY,{children:[!a&&(0,Z.tZ)(IR,{title:c("Footer for all posts"),field:"email_postscript_for_free_writer",html:null===(t=d.email_render_elements)||void 0===t?void 0:t.email_postscript_for_free_writer_html,customEditEndpoint:"/api/v1/publication/email_render_elements?include_defaults=true",customResetEndpoint:"/api/v1/publication/email_render_elements"}),(o||a)&&(0,Z.tZ)(IO,{open:void 0!==l?!!l:a,setOpen:u,children:(0,Z.BX)(et.tu,{gap:32,className:a?"":"draft",children:[a?null:(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:["Your publication does not have paid subscriptions enabled. You can still edit the following footers and see them in preview emails.",(0,Z.BX)("b",{children:["They will not be included in your emails until you"," ",(0,Z.tZ)("a",{href:(0,j.wI3)(s,{section:"payments-settings"}),native:!0,children:"enable payments"}),"."]})]}),(0,Z.tZ)(IR,{title:c("Footer for free subscribers on posts sent to everyone"),field:"public_post_free_signup_postscript",html:null===(i=d.email_render_elements)||void 0===i?void 0:i.public_post_free_signup_postscript_html,customEditEndpoint:"/api/v1/publication/email_render_elements?include_defaults=true",customResetEndpoint:"/api/v1/publication/email_render_elements"}),(0,Z.tZ)(IR,{title:c("Footer for paid subscribers on posts sent to everyone"),field:"public_post_subscriber_postscript",html:null===(n=d.email_render_elements)||void 0===n?void 0:n.public_post_subscriber_postscript_html,customEditEndpoint:"/api/v1/publication/email_render_elements?include_defaults=true",customResetEndpoint:"/api/v1/publication/email_render_elements"}),(0,Z.tZ)(IR,{title:c("Footer for paid subscribers on paywalled posts"),field:"subscriber_post_subscriber_postscript",html:null===(r=d.email_render_elements)||void 0===r?void 0:r.subscriber_post_subscriber_postscript_html,customEditEndpoint:"/api/v1/publication/email_render_elements?include_defaults=true",customResetEndpoint:"/api/v1/publication/email_render_elements"})]})})]})},IY=e=>{var t,i,n,r,o,a,l;let{hasConnectedStripe:s,isPaid:d,oPre:c,pub:u,publication:p,section:h,sectionEmailRenderElements:m}=e,{iString:g}=(0,Q.M1)(),{oPre:v}=(0,ID.Z)({oPre:null,oPost:null});return(0,Z.BX)(Z.HY,{children:[!d&&(0,Z.tZ)(IR,{customEditEndpoint:"/api/v1/publication/email_render_elements?include_defaults=true",customResetEndpoint:"/api/v1/publication/email_render_elements",field:"email_preamble_for_free_writer",html:h?null!==(n=null==m?void 0:m.email_preamble_for_free_writer_html)&&void 0!==n?n:null:null===(t=p.email_render_elements)||void 0===t?void 0:t.email_preamble_for_free_writer_html,section:h,title:g(h?"Header for all posts in section":"Header for all posts")}),(s||d)&&(0,Z.tZ)(IO,{open:void 0!==c?!!c:d,setOpen:v,children:(0,Z.BX)(et.tu,{gap:32,className:d?"":"draft",children:[!d&&(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:["Your publication does not have paid subscriptions enabled. You can still edit the following headers and see them in preview emails."," ",(0,Z.BX)("b",{children:["They will not be included in your post emails until you"," ",(0,Z.tZ)("a",{href:(0,j.wI3)(u,{section:"payments-settings"}),native:!0,children:"enable payments"}),"."]})]}),(0,Z.tZ)(IR,{field:"public_post_free_signup_preamble",html:h?null!==(r=null==m?void 0:m.public_post_free_signup_preamble_html)&&void 0!==r?r:null:p.public_post_free_signup_preamble_html,section:h,title:g(h?"Header for free subscribers on posts in this section that are sent to everyone":"Header for free subscribers on posts sent to everyone")}),(0,Z.tZ)(IR,{field:"public_post_subscriber_preamble",html:h?null!==(o=null==m?void 0:m.public_post_subscriber_preamble_html)&&void 0!==o?o:null:p.public_post_subscriber_preamble_html,section:h,title:g(h?"Header for paid subscribers on posts in this section that are sent to everyone":"Header for paid subscribers on posts sent to everyone")}),(0,Z.tZ)(IR,{field:"subscriber_post_subscriber_preamble",html:h?null!==(a=null==m?void 0:m.subscriber_post_subscriber_preamble_html)&&void 0!==a?a:null:p.subscriber_post_subscriber_preamble_html,section:h,title:g(h?"Header for paid subscribers on paywalled posts in this section":"Header for paid subscribers on paywalled posts")}),d&&(0,Z.tZ)(IR,{customEditEndpoint:"/api/v1/publication/email_render_elements?include_defaults=true",customResetEndpoint:"/api/v1/publication/email_render_elements",field:"free_preview_preamble",html:h?null!==(l=null==m?void 0:m.free_preview_preamble_html)&&void 0!==l?l:null:null===(i=p.email_render_elements)||void 0===i?void 0:i.free_preview_preamble_html,section:h,title:g(h?"Header for free subscribers on free preview posts in this section":"Header for free subscribers on free preview posts"),titleAugmentation:(0,Z.BX)(Z.HY,{children:[" ",(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us/articles/4407989020308-How-do-I-publish-a-free-preview-of-a-paid-post-on-Substack-",children:g("Learn more")})]})})]})})]})},IH=e=>{let{hasConnectedStripe:t,isPaid:i,oPost:n,oPre:r,pub:o,publication:a,user:l}=e,{iString:s}=(0,Q.M1)();return(0,Z.BX)(et.tu,{gap:40,children:[(0,Z.BX)(et.tu,{gap:32,children:[(0,Z.tZ)(ei.xv.H1,{translated:!0,children:"Email headers"}),(0,Z.tZ)(IA,{bannerUrl:a.email_banner_url,uploadUrl:"/api/v1/publication/email_banner_url",onUpload:()=>document.location.reload()}),(0,Z.tZ)(IY,{hasConnectedStripe:t,isPaid:i,oPre:r,pub:o,publication:a})]}),(0,Z.tZ)("hr",{}),(0,Z.BX)(et.tu,{gap:32,children:[(0,Z.tZ)(ei.xv.H1,{translated:!0,children:"Email footers"}),(0,Z.tZ)(IU,{hasConnectedStripe:t,isPaid:i,oPost:n,pub:o,publication:a})]}),(0,Z.tZ)("hr",{}),(0,Z.BX)(et.tu,{gap:32,children:[(0,Z.tZ)(ei.xv.H1,{translated:!0,children:"Send test emails"}),(0,Z.tZ)("div",{className:"test-section",children:(0,Z.BX)(tP.ZP,{action:"/api/v1/drafts/test_multi".concat(r||n?"?include_paid=true":""),onSuccess:()=>alert(s("sent")),children:[(0,Z.BX)(et.gq,{gap:16,className:"sideBySideWrap",children:[(0,Z.tZ)("input",{type:"text",name:"email",defaultValue:l.email,placeholder:s("Email...")}),(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",children:i?s("Send 4 test emails"):r||n?s("Send 5 test emails"):""})]}),(0,Z.tZ)("div",{id:"error-container"})]})})]})]})},Ij=e=>{var t;let{hasConnectedStripe:i,isPaid:n,oPre:r,pub:o,publication:a,sectionId:l}=e,{iString:s}=(0,Q.M1)(),[d,c]=(0,A.eJ)({}),u=o.sections.find(e=>e.id===l),p=null!==(t=null==u?void 0:u.ignore_publication_email_settings)&&void 0!==t&&t;(0,A.d4)(()=>{let e=async e=>{let t=await N().get("/api/v1/publication/sections/".concat(e,"/section_email_render_elements"));c(i=>(0,_._)((0,f._)({},i),{[e]:t.body}))};l&&e(l)},[l]);let h=async e=>{try{await N().patch("/api/v1/publication/sections/".concat(null==u?void 0:u.id)).send({ignore_publication_email_settings:!e}),document.location.reload()}catch(e){console.error(e),(0,O.ZP)(s("Something went wrong. Please try again."))}};return u?(0,Z.BX)(et.tu,{gap:32,children:[(0,Z.tZ)(ei.xv.H1,{translated:!0,children:"Email headers"}),(0,Z.tZ)(iw.j,{value:!p,label:s("Default to publication settings"),onChange:h,details:s("If checked, posts will fall back to the publication setting if these settings are not set")}),(0,Z.BX)(et.tu,{gap:40,children:[(0,Z.tZ)(i1.g,{children:(0,Z.tZ)(IA,{bannerUrl:u.email_banner_url,uploadUrl:"/api/v1/publication/sections/".concat(l,"/email_banner_url"),onUpload:()=>document.location.reload()})}),(0,Z.tZ)(IY,{hasConnectedStripe:i,isPaid:n,oPre:r,pub:o,publication:a,section:u,sectionEmailRenderElements:d[l]})]})]}):null},IJ=e=>{let{pub:t,publication:i,section:n,user:r,oPre:o,oPost:a}=e,{getConfigFor:l}=(0,io.xR)(),[s,d]=(0,hc.t)({alwaysPersistQuery:!0,initialValue:n?parseInt(n):null,key:"section",type:"number",isArray:!1}),c=l("section_specific_preambles"),u=!!(t.plans||t.draft_plans),p=(0,er.isPaidPub)(t);return(0,A.d4)(()=>{s&&!t.sections.find(e=>e.id===s)&&d(null)},[t.sections,s,d]),(0,Z.tZ)("div",{className:"page typography",id:"preamble-postscript-settings",children:(0,Z.tZ)("div",{className:"container",children:(0,Z.BX)(et.tu,{gap:40,children:[t.sections.length>0&&c&&(0,Z.tZ)(mE,{pub:t,selectedSectionId:s,onChangeSection:e=>{let{sectionId:t}=e;d(t)}}),null!==s&&c?(0,Z.tZ)(Ij,{hasConnectedStripe:u,isPaid:p,oPre:o,pub:t,publication:i,sectionId:s}):(0,Z.tZ)(IH,{hasConnectedStripe:u,isPaid:p,oPost:a,oPre:o,pub:t,publication:i,user:r})]})})})},IV=eb(e=>{let{pub:t,publication:i,initialSectionId:n}=e;if(!t)return null;let r="string"==typeof n?Number(n):n;return(0,Z.tZ)("div",{className:"new-section-page",children:(0,Z.tZ)("div",{className:"container",children:(0,Z.tZ)(_Q,{pub:t,publication:i,initialSectionId:null!=r?r:null})})})}),Iq=e=>{let{section:t,onSuccess:i,podcastSettings:n}=e,{iString:r}=(0,Q.M1)(),o=n.paidEpisodeArtUrl,a=(0,A.sO)(null),[l,s]=(0,A.eJ)(!1),[d,c]=(0,A.eJ)(o),[u,p]=(0,A.eJ)(null),[h,m]=(0,A.eJ)(null);return(0,A.d4)(()=>{_n({paid_podcast_episode_art_url:null!=o?o:void 0})},[]),(0,Z.tZ)(_4,{title:r("Advanced settings"),children:(0,Z.BX)(tP.ZP,{className:k()("section",_H,_J),ref:a,loading:l,method:t?"patch":"put",prepareData:async e=>{s(!0);try{if(u){m(null);let i=await N().post("/api/v1/podcast_art").field("for_section",!!t).attach("podcast_art",u);return(0,_._)((0,f._)({},e),{paid_podcast_episode_art_url:i.body.podcast_art_url})}if(d)return(0,_._)((0,f._)({},e),{paid_podcast_episode_art_url:d});return(0,_._)((0,f._)({},e),{paid_podcast_episode_art_url:null})}catch(e){throw console.error(e),m((0,Y.zx)(e)),e}finally{s(!1)}},action:t?"/api/v1/publication/sections/".concat(t.id):"/api/v1/publication",autoLock:!0,onSuccess:(e,t)=>{_r({paid_podcast_episode_art_url:t.paid_podcast_episode_art_url}),i&&i(e)},onError:e=>{_i({isNew:!1}),m((0,Y.zx)(e))},children:[(0,Z.tZ)(_s,{artUrl:null!=d?d:void 0,disabled:l,error:h,label:r("Optional: podcast artwork for paid feeds"),loading:l,removable:!!d,requirements:r("If you set this, paid feeds will show this image instead of your primary podcast art on Substack and in podcast players. It must be a square and at least 1400px wide."),onChange:(e,t)=>{p(e),c(t)},onClear:()=>{p(null),c(null)}}),(0,Z.tZ)("div",{className:"button-container",children:(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",children:r("Save")})})]})})};function IW(){let e=(0,G._)(["Your podcast RSS feed is being redirected to ",""]);return IW=function(){return e},e}let IG=e=>{let{podcastSettings:t,section:i}=e,{iString:n,iTemplate:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)(!1),[l,s]=(0,A.eJ)(!1),[d,c]=(0,A.eJ)(""),u=(0,A.sO)(null),p=async e=>{if(e!==t.podcastRssUrl&&window.confirm(n("This will redirect your Substack podcast feed to the URL you provide.")))try{i?await N().patch("/api/v1/publication/sections/".concat(i.id)).send({podcast_feed_url:e}):await N().put("/api/v1/publication").send({podcast_feed_url:e}),window.location.reload()}catch(e){console.log(e),alert((0,Y.zx)(e))}},h=async()=>{if(!l&&window.confirm(n("Are you sure you want to stop redirecting your podcast?"))){s(!0);try{i?await N().patch("/api/v1/publication/sections/".concat(i.id)).send({podcast_feed_url:null}):await N().put("/api/v1/publication").send({podcast_feed_url:null}),window.location.reload()}catch(e){console.log(e),alert((0,Y.zx)(e))}s(!1)}};return t.isRedirected?(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Stop redirecting RSS feed"),secondaryText:r(IW(),t.podcastRssUrl||"")}),(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:()=>{h()},children:n("Stop redirecting")})]}):o?(0,Z.BX)("div",{className:"label",children:[(0,Z.tZ)("span",{id:"redirect-label",children:n("URL to redirect RSS feed to")}),(0,Z.BX)("form",{className:"inline-form",onSubmit:async e=>{e.preventDefault(),s(!0),await p(u.current.value),s(!1),a(!1)},children:[(0,Z.tZ)("input",{"aria-labelledby":"redirect-label",type:"text",onChange:e=>{c(e.target.value)},value:d,ref:u}),(0,Z.BX)("div",{className:"buttons danger",children:[(0,Z.tZ)(ee.zx,{priority:"destructive",type:"submit",size:"sm",disabled:l,children:n("Redirect to this URL")}),(0,Z.tZ)(ee.zx,{priority:"secondary-outline",size:"sm",onClick:()=>{a(!1),c("")},disabled:l,children:n("Cancel")})]})]})]}):(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Migrate podcast"),secondaryText:n("Moving away from Substack? You'll want to import your current episodes on your new host, then redirect the RSS feed to your new URL")}),(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:()=>{a(!0)},children:n("Redirect RSS feed")})]})};function IK(){let e=(0,G._)(["To permanently delete ",", please type your podcast's title (\"",'") below.']);return IK=function(){return e},e}function IQ(){let e=(0,G._)(['You typed "','" which did not match "','".']);return IQ=function(){return e},e}let I$=()=>{let{iString:e,iTemplate:t}=(0,Q.M1)();return async i=>{let{pub:n}=i,r=n.podcast_title||n.name,o=prompt(t(IK(),r,r));if(o&&0!==o.length){if(o!==r){alert(t(IQ(),o,r));return}try{await N().del("/api/v1/publication/podcast"),alert(e("Ok! The publication is being deleted. This may take a minute or two.")),window.location.assign((0,en.wI3)(n,{section:"podcast-settings",addBase:!1,baseUrlOptions:{},params:{}})),window.location.reload()}catch(t){console.error(e("Failed to delete podcast: "),t),alert((0,Y.zx)(t))}}}},I0=e=>{let{pub:t,podcastSettings:i,section:n}=e,{iString:r}=(0,Q.M1)(),o=I$();return(0,Z.tZ)("div",{children:(0,Z.tZ)(_4,{title:r("Danger zone"),children:(0,Z.BX)(et.tu,{gap:32,children:[!n&&(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:r("Delete podcast"),secondaryText:r("Delete your podcast and all associated data")}),(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:()=>{!n&&o({pub:t})},children:r("Delete")})]}),(0,Z.tZ)(IG,{podcastSettings:i,section:n})]})})})},I1=e=>{var{children:t,icon:i,newTab:n,size:r="medium",variant:o="primary",className:a}=e,l=(0,ef._)(e,["children","icon","newTab","size","variant","className"]);return(0,Z.BX)("a",(0,_._)((0,f._)({className:k()("button button-link",o,a,{small:"small"===r,"no-margin":"small"===r,"with-icon":!!i})},n?{target:"_blank",rel:"noopener"}:{},l),{children:[i,t]}))},I2=e=>{let{hasImports:t=!1,sectionId:i}=e,{iString:n}=(0,Q.M1)(),r=i?"/publish/import/podcast/".concat(i):"/publish/import/podcast";return(0,Z.tZ)("div",{className:k()("form",_H),children:(0,Z.tZ)(_4,{title:n("Import"),children:(0,Z.BX)(et.tu,{gap:32,children:[(0,Z.BX)(oH.ZR,{children:[(0,Z.tZ)(oH.sY,{primaryText:n("Import episodes from an existing podcast RSS feed"),secondaryText:n("If you already have a podcast, you can migrate from your old podcast host to consolidate everything on Substack.")}),(0,Z.tZ)(I1,{href:r,variant:"primary",children:n("Import episodes")})]}),t&&(0,Z.tZ)("div",{className:"form",children:(0,Z.BX)("div",{className:"label",children:[n("Your podcast has been imported"),(0,Z.tZ)("div",{className:"info margin-top-small",children:n("Don't forget to submit your new feed link to Apple and your old podcast host.")}),(0,Z.BX)("ul",{className:"info",children:[(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{href:(0,en.n1t)("/publish/import/podcast",{tellApple:!0,sectionId:null!=i?i:void 0}),children:n("Submit your new feed link to podcast directories")})}),(0,Z.tZ)("li",{children:(0,Z.tZ)("a",{href:(0,en.n1t)("/publish/import/podcast",{previousHost:!0,sectionId:null!=i?i:void 0}),children:n("Tell your previous podcast host to use the new link")})})]})]})})]})})})},I4=e=>{var t;let{pub:i,publication:n,section:r,referrer:o}=e,{iString:a}=(0,Q.M1)(),l=()=>{o?window.location.href=o:(alert(a("You successfully updated your podcast!")),window.location.reload())};if(r&&!r.is_podcast||!r&&!i.podcast_enabled)return(0,Z.tZ)("div",{children:a("Podcast not enabled")});let s=r?(0,co.d_)({pub:i,section:r}):(0,co.jU)({pub:i}),d=r?(0,Z.tZ)(_G,{podcastHasBeenPersisted:!0,pub:i,publication:n,podcastSettings:s,section:r,onSuccess:l}):(0,Z.tZ)(_G,{podcastHasBeenPersisted:!0,pub:i,publication:n,podcastSettings:s,section:null,onSuccess:l,showNavigationTabOption:!0});return(0,Z.tZ)("div",{className:"page typography",children:(0,Z.BX)(et.tu,{gap:32,children:[(0,Z.tZ)(_4,{title:a("Podcast settings"),children:d}),!s.isRedirected&&(0,Z.tZ)(I2,{hasImports:n.has_imported_podcast,sectionId:null!==(t=null==r?void 0:r.id)&&void 0!==t?t:null}),(0,nC.oH)(i)&&(0,Z.tZ)(Iq,{podcastSettings:s,pub:i,section:r}),(0,Z.tZ)(I0,{podcastSettings:s,pub:i,section:r})]})})},I3=eb(e=>{var t,i,n,r;let{pub:o,publication:a,sectionId:l,matches:s}=e;if(!o||!a)return null;let d=null!==(n=null===(t=o.sections)||void 0===t?void 0:t.find(e=>e.id===Number(l)))&&void 0!==n?n:null;if(l&&!d)return null;let c=!l&&!o.podcast_enabled,u=null!==(r=null===(i=o.sections)||void 0===i?void 0:i.find(e=>e.is_podcast))&&void 0!==r?r:null;return"undefined"!=typeof window&&c&&u?((0,Y.uX)((0,en.HQ2)({pub:o,section:u})),null):(0,Z.tZ)("div",{className:"edit-podcast-page",children:(0,Z.tZ)("div",{className:"container",children:(0,Z.tZ)(I4,{pub:o,publication:a,section:c?u:d,referrer:null==s?void 0:s.referrer})})})});var I8=i(18967);let I6={numReferralsInput:"numReferralsInput-f4Duu2",rewardNameInput:"rewardNameInput-kuG39l",rewardNameInputContainer:"rewardNameInputContainer-HiSsQ_",rewardNameInputCharLimit:"rewardNameInputCharLimit-hwn7sX",referralsSetup:"referralsSetup-Ynjbrx",fixedFooter:"fixedFooter-PQzSRP",footerInnerContainer:"footerInnerContainer-CWy9dF",announcementCtaContainer:"announcementCtaContainer-c3jmPP",cross:"cross-BsVXr8"};function I5(){let e=(0,G._)(["Tier "," Reward"]);return I5=function(){return e},e}let I9=e=>{let{pub:t,referralsEnabled:i}=e;return(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(et.gq,{justifyContent:"start",paddingBottom:20,children:(0,Z.tZ)(ee.hU,{href:(0,j.wI3)(t,{section:"referrals"}),"aria-label":"Back to publish settings",title:"Back to publish settings",priority:"tertiary",size:"sm",children:(0,Z.tZ)(eF.Z,{stroke:"var(--color-light-primary)"})})}),(0,Z.BX)(et.gq,{justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.H1,{translated:!0,children:"Subscriber Referrals"}),i&&(0,Z.tZ)(Nn,{pub:t})]}),(0,Z.BX)(ei.xv.B3,{translated:!0,color:"secondary",paddingTop:4,children:["Reward subscribers for sharing your Substack and growing your audience."," ",(0,Z.tZ)(ei.hh,{decoration:"underline",href:"https://support.substack.com/hc/en-us/articles/16142857300372",target:"_blank",rel:"noopener",children:"Learn more"}),"."]})]})},I7=()=>{let[e,t]=(0,A.eJ)(void 0),i=async()=>{try{let{body:e}=await N().get("/api/v1/reader_referrals/admin_stats");t({total_free_subscribers:e.total_free_subscribers,total_referrers:e.total_referrers})}catch(e){alert((0,Y.zx)(e))}};return((0,A.d4)(()=>{i()},[]),e)?(0,Z.BX)(et.gq,{justifyContent:"center",gap:96,paddingX:80,children:[(0,Z.BX)(et.tu,{alignItems:"center",children:[(0,Z.tZ)(ei.xv.H1,{as:"div",weight:"heavy",children:e.total_free_subscribers}),(0,Z.tZ)(ei.xv.B4,{translated:!0,color:"secondary",children:"Referrals"})]}),(0,Z.BX)(et.tu,{alignItems:"center",children:[(0,Z.tZ)(ei.xv.H1,{as:"div",weight:"heavy",children:e.total_referrers}),(0,Z.tZ)(ei.xv.B4,{translated:!0,color:"secondary",children:"Referrers"})]})]}):null},Ne=e=>{let{pub:t,referralsEnabled:i,setReferralsEnabled:n}=e,{iString:r}=(0,Q.M1)(),[o,a]=(0,A.eJ)([]),[l,s]=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sd?localStorage:void 0,[n,r]=sc(e,(0,A.Ye)(()=>JSON.stringify(t),[t]),i);return[(0,A.Ye)(()=>{try{return JSON.parse(n)}catch(e){return console.error("Failed to parse stored value:",e),t}},[n,t]),e=>r(JSON.stringify(e))]}("draft-referrals-tiers",null,"undefined"!=typeof window?sessionStorage:void 0),[d,c]=(0,A.eJ)(""),[u,p]=(0,A.eJ)(!1),h=(0,iN.pm)(),m=l||o,g="enabled"===t.payments_state,v=async()=>{try{let{body:e}=await N().get("/api/v1/reader_referrals/tiers"),t=e.tiers;a(t)}catch(e){alert((0,Y.zx)(e))}};(0,A.d4)(()=>{v()},[]);let b=()=>m.map(e=>{let t=!1,i=o.find(t=>t.display_order===e.display_order);return i&&(i.reward_type!==e.reward_type||i.num_referrals_required!==e.num_referrals_required||i.reward_description!==e.reward_description)&&(t=!0),(0,f._)({id:e.id,display_order:e.display_order,reward_type:e.reward_type,num_referrals_required:e.num_referrals_required},e.reward_type===I8.E4.Custom&&{reward_description:e.reward_description},{is_default:!t&&e.is_default})}),y=(e,t,i)=>{let n=[...m];n[e]=(0,_._)((0,f._)({},n[e]),{[t]:i}),s(n)},C=()=>{let e=m.map(e=>e.num_referrals_required);if(!e.every(e=>e>0))throw Error("Number of referrals required must be greater than 0");if(!e.every((t,i)=>0===i||t>e[i-1]))throw Error("The number of referrals required must be in ascending order");if(m.some(e=>e.reward_type===I8.E4.Custom&&!e.reward_description))throw Error("One or more custom rewards are empty");return!0},x=async()=>{p(!0),c("");try{C()}catch(t){let e=t instanceof Error?t.message:"Unable to save changes";c(e),(0,U.j)(U.FP.SUBSCRIBER_REFERRALS_SETUP_ERROR,{message:e}),p(!1);return}try{i||(await N().put("/api/v1/reader_referrals").send({enabled:!0}),n(!0));let e=(await N().put("/api/v1/reader_referrals/tiers").send({tiers:b()})).body.tiers;a(e),s(null),h.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:r("Changed Saved. View updates on your referrals page."),cta:r("Visit Page"),href:(0,en.j8T)(t)})))}catch(e){c("Unable to save changes")}finally{p(!1)}};if(!o.length)return(0,Z.tZ)(iI.$j,{});let S=m.every(e=>e.reward_type!==I8.E4.Custom||e.reward_description),k=m.some(e=>e.reward_type!==I8.E4.Custom||e.reward_description),B=i?!!l:S,T=(!i||!!l)&&(0,Z.tZ)("div",{className:I6.fixedFooter,children:(0,Z.BX)(et.gq,{className:I6.footerInnerContainer,justifyContent:"space-between",alignItems:"center",children:[(0,Z.BX)(et.gq,{gap:12,children:[(0,Z.tZ)(ee.zx,{priority:"primary",onClick:x,disabled:!B||u,children:i?r("Save Changes"):r("Enable Referrals")}),i&&l&&(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{s(null),c("")},children:r("Cancel")})]}),!d&&k&&!S&&(0,Z.BX)(ei.xv.B4,{color:"secondary",display:"flex",direction:"row",alignItems:"center",children:[(0,Z.tZ)(eL.Z,{height:16})," ",r("Enter a reward for all 3 tiers to enable")]}),d&&(0,Z.BX)(ei.xv.B4,{color:"error",weight:"bold",display:"flex",direction:"row",alignItems:"center",children:[(0,Z.tZ)(eL.Z,{height:16})," ",d]})]})});return(0,Z.BX)(et.tu,{children:[i&&(0,Z.tZ)(Nt,{}),(0,Z.tZ)(ei.xv.H4,{translated:!0,children:"Customize tiers"}),(0,Z.tZ)(tX.iz,{paddingY:24}),m.map((e,t)=>(0,Z.BX)(w.Fragment,{children:[(0,Z.tZ)(Ni,{referralsEnabled:i,pubIsPaid:g,tier:e,index:t,updateTier:y}),(0,Z.tZ)(tX.iz,{paddingY:32})]},t)),T]})},Nt=()=>{let{iString:e}=(0,Q.M1)(),t=(0,ss.So)(),[i,n]=(0,A.eJ)("undefined"==typeof window||"true"===window.sessionStorage.getItem("dismissedReferralAnnouncementCTA")||t.getSettingFor("referral_announcement_cta_dismissed")),[r,o]=(0,A.eJ)(!1),a=(0,re.aF)(),l=(0,eq.Ij)(),s=async()=>{window.sessionStorage.setItem("dismissedReferralAnnouncementCTA","true"),(null==a||!a.is_global_admin)&&await N().put("/api/v1/publication_settings").send({referral_announcement_cta_dismissed:!0})};return i?null:(0,Z.BX)(ts.xu,{className:I6.announcementCtaContainer,radius:"md",border:"detail",padding:48,alignItems:"center",display:"flex",direction:"column",children:[(0,Z.tZ)(K.Z,{color:"var(--color-light-tertiary)",className:I6.cross,size:20,onClick:()=>{n(!0),s()}}),(0,Z.tZ)(m7.Z,{size:24}),(0,Z.tZ)(ei.xv.H4,{translated:!0,paddingBottom:4,paddingTop:8,children:"Tell your readers about Referrals"}),(0,Z.tZ)(ei.xv.B4,{translated:!0,paddingBottom:16,color:"secondary",align:"center",children:"Announce your referral program to your readers. You can also add the new â€œRefer a friendâ€ button to any post."}),(0,Z.tZ)(ee.zx,{priority:"primary",disabled:r,onClick:async()=>{o(!0),await s(),(0,Y.uX)((0,j.maq)(l,{template:"referral-announcement"}),{local_navigation:!1})},children:e(r?"Loadingâ€¦":"Edit announcement")})]})},Ni=e=>{var t,i,n;let{tier:r,index:o,updateTier:a,pubIsPaid:l,referralsEnabled:s}=e,{iString:d,iTemplate:c}=(0,Q.M1)(),u=(0,A.sO)(null),[p,h]=(0,A.eJ)(!1),[m,g]=(0,eO.XI)({delayEnter:100,delayLeave:300}),v=c(I5(),o+1),b=e=>{if(!e)throw Error("tierNumber is required");(0,Y.uX)((0,en.n1t)("/publish/settings/edit",Object.assign({redirect:document.location.href},{bodyField:"referrals_reward_tier_".concat(e),title:d("Reward Milestone"),endpoint:"/api/v1/publication/email_render_elements?include_defaults=true",titleField:"referrals_reward_tier_".concat(e,"_subject"),titlePlaceholder:"Email subject..."})))},y=r.reward_type===I8.E4.Custom&&!l&&r.is_default,w=r.reward_type!==I8.E4.Custom&&!l;return(0,Z.BX)(et.tu,{children:[(0,Z.BX)(et.gq,{justifyContent:"space-between",children:[(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",gap:24,children:[!y&&(0,Z.BX)("div",{children:[(0,Z.tZ)(ei.xv.H4,{size:14,paddingBottom:16,children:v}),(0,Z.tZ)(oY.i,{value:r.reward_type,onChange:e=>{a(o,"reward_type",e.target.value)},children:Object.values(I8.E4).map(e=>(0,Z.tZ)("option",{value:e,children:I8.ML[e]}))})]}),r.reward_type===I8.E4.Custom&&(0,Z.tZ)("div",{children:(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.H4,{size:14,paddingBottom:16,children:l?"Reward Name":v}),(0,Z.BX)("div",{className:I6.rewardNameInputContainer,children:[(0,Z.tZ)(tD.oi,{className:I6.rewardNameInput,value:r.reward_description||"",placeholder:s?d("EBook..."):2===o?d("30 minute Zoom chat"):1===o?d("Access to private slack"):d("EBook..."),onChange:e=>a(o,"reward_description",e.currentTarget.value),maxLength:30,width:250,ref:u,onFocus:()=>{var e;h(!0),null==u||null===(e=u.current)||void 0===e||e.focus()},onBlur:()=>{h(!1)}}),p?(0,Z.tZ)(ei.xv.B4,{className:I6.rewardNameInputCharLimit,children:30-(null!==(n=null===(i=u.current)||void 0===i?void 0:null===(t=i.value)||void 0===t?void 0:t.length)&&void 0!==n?n:0)}):null]})]})})]}),(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",gap:24,children:[(0,Z.BX)("div",{children:[(0,Z.tZ)(ei.xv.H4,{translated:!0,size:14,paddingBottom:16,children:"# of Referrals"}),(0,Z.tZ)(o9,{className:I6.numReferralsInput,onChange:e=>a(o,"num_referrals_required",parseInt(e.target.value)),value:r.num_referrals_required,min:1})]}),(0,Z.BX)("div",{children:[(0,Z.tZ)(ei.xv.H4,{translated:!0,size:14,paddingBottom:16,children:"Reward Email"}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>b(o+1),children:d("Edit")})]})]})]}),w&&(0,Z.BX)(ei.xv.B4,{color:"error",weight:"bold",display:"flex",direction:"row",alignItems:"center",paddingTop:12,children:[(0,Z.tZ)(eL.Z,{height:16})," ",d("Payments must be enabled for this reward type")]}),r.reward_type===I8.E4.Custom&&(p||m)&&(0,Z.BX)(ei.xv.B4,(0,_._)((0,f._)({translated:!0,color:"secondary",paddingTop:16},g),{children:["Tip: For custom rewards, you can edit the reward email to contain the reward itself (pdf, meeting link, etc). For tips on rewards to offer, check out this"," ",(0,Z.tZ)("a",{href:"https://on.substack.com/p/referral-rewards",target:"_blank",rel:"noopener",children:"article"})]}))]})},Nn=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)(!1),o=(0,iN.pm)(),a=async()=>{r(!0);try{await N().put("/api/v1/reader_referrals").send({enabled:!1}),window.location.href=(0,j.wI3)(t)}catch(e){o.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:"Unable to save changes"})))}finally{r(!1)}};return(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{"aria-label":"More",priority:"tertiary",title:i("More settings"),children:(0,Z.tZ)(eD.Z,{size:20})}),children:(0,Z.BX)(et.tu,{alignItems:"stretch",padding:8,children:[(0,Z.tZ)(tC.sN,{href:(0,en.j8T)(t),children:i("Visit Leaderboard")}),(0,Z.tZ)(tC.sN,{priority:"destructive",onClick:a,disabled:n,children:i("Turn off referrals")})]})})},Nr=e=>{let{pub:t}=e,{getSettingFor:i}=(0,ss.So)(),[n,r]=(0,A.eJ)(!!i("reader_referrals_enabled"));return(0,Z.BX)(et.tu,{className:k()("container",I6.referralsSetup),paddingY:64,gap:80,children:[(0,Z.tZ)(I9,{pub:t,referralsEnabled:n}),n&&(0,Z.tZ)(I7,{}),(0,Z.tZ)(Ne,{pub:t,referralsEnabled:n,setReferralsEnabled:r})]})},No=eb(e=>{let{pub:t,publication:i}=e;return t&&i?(0,Z.tZ)("div",{className:"new-section-page",children:(0,Z.tZ)("div",{className:"container",children:(0,Z.tZ)(Za,{pub:t,publication:i})})}):null});function Na(){let e=(0,G._)(["You successfully updated your newsletter, ","!"]);return Na=function(){return e},e}let Nl=e=>{let{sectionId:t,pub:i,publication:n}=e,{iString:r,iTemplate:o}=(0,Q.M1)(),a=i.sections.find(e=>e.id===Number(t));return a?(i=(0,_._)((0,f._)({},i),{section:a}),(0,Z.tZ)("div",{className:"page typography",children:(0,Z.tZ)(Zt,{pub:i,publication:n,section:a,onSuccess:e=>{let{section:t}=e.body;alert(o(Na(),t.name)),window.location.assign((0,j.wI3)(i,{section:"section-settings"}))}})})):(0,Z.tZ)("div",{children:r("Section not found")})},Ns=eb(e=>{let{sectionId:t,pub:i,publication:n}=e;return i?(0,Z.tZ)("div",{className:"edit-section-page",children:(0,Z.tZ)("div",{className:"container",children:(0,Z.tZ)(Nl,{sectionId:t,pub:i,publication:n})})}):null}),Nd=e=>(0,Z.BX)(eH.l,(0,_._)((0,f._)({},e),{name:"StripeLogo",svgParams:{height:222.5,width:468,strokeWidth:0,fill:"#ffffff"},children:[(0,Z.tZ)("path",{className:"st0",d:"M414,113.4c0-25.6-12.4-45.8-36.1-45.8c-23.8,0-38.2,20.2-38.2,45.6c0,30.1,17,45.3,41.4,45.3 c11.9,0,20.9-2.7,27.7-6.5v-20c-6.8,3.4-14.6,5.5-24.5,5.5c-9.7,0-18.3-3.4-19.4-15.2h48.9C413.8,121,414,115.8,414,113.4z M364.6,103.9c0-11.3,6.9-16,13.2-16c6.1,0,12.6,4.7,12.6,16H364.6z"}),(0,Z.tZ)("path",{className:"st0",d:"M301.1,67.6c-9.8,0-16.1,4.6-19.6,7.8l-1.3-6.2h-22v116.6l25-5.3l0.1-28.3c3.6,2.6,8.9,6.3,17.7,6.3 c17.9,0,34.2-14.4,34.2-46.1C335.1,83.4,318.6,67.6,301.1,67.6z M295.1,136.5c-5.9,0-9.4-2.1-11.8-4.7l-0.1-37.1 c2.6-2.9,6.2-4.9,11.9-4.9c9.1,0,15.4,10.2,15.4,23.3C310.5,126.5,304.3,136.5,295.1,136.5z"}),(0,Z.tZ)("polygon",{className:"st0",points:"223.8,61.7 248.9,56.3 248.9,36 223.8,41.3 "}),(0,Z.tZ)("rect",{x:"223.8",y:"69.3",className:"st0",width:"25.1",height:"87.5"}),(0,Z.tZ)("path",{className:"st0",d:"M196.9,76.7l-1.6-7.4h-21.6v87.5h25V97.5c5.9-7.7,15.9-6.3,19-5.2v-23C214.5,68.1,202.8,65.9,196.9,76.7z"}),(0,Z.tZ)("path",{className:"st0",d:"M146.9,47.6l-24.4,5.2l-0.1,80.1c0,14.8,11.1,25.7,25.9,25.7c8.2,0,14.2-1.5,17.5-3.3V135 c-3.2,1.3-19,5.9-19-8.9V90.6h19V69.3h-19L146.9,47.6z"}),(0,Z.tZ)("path",{className:"st0",d:"M79.3,94.7c0-3.9,3.2-5.4,8.5-5.4c7.6,0,17.2,2.3,24.8,6.4V72.2c-8.3-3.3-16.5-4.6-24.8-4.6 C67.5,67.6,54,78.2,54,95.9c0,27.6,38,23.2,38,35.1c0,4.6-4,6.1-9.6,6.1c-8.3,0-18.9-3.4-27.3-8v23.8c9.3,4,18.7,5.7,27.3,5.7 c20.8,0,35.1-10.3,35.1-28.2C117.4,100.6,79.3,105.9,79.3,94.7z"})]})),Nc=e=>{let{color:t,loading:i,children:n}=e;return(0,Z.BX)(et.gq,{gap:12,justifyContent:"center",children:[i&&(0,Z.tZ)(iI.$j,{className:"stripe-account-import-loader"}),(0,Z.tZ)(ei.xv.B3,{align:"center",color:t,weight:"semibold",children:n})]})},Nu=e=>{var t;let{pub:i,user:n,importer_name:r}=e,[o,a]=(0,A.eJ)(!1),l=(0,yA.Q)({pathname:"/api/v1/stripe/account/import",auto:!!(null==i?void 0:i.stripe_user_id)}),s=l.result,d=(0,yA.Q)({method:"post",pathname:"/api/v1/stripe/account/import/".concat(null===(t=l.result)||void 0===t?void 0:t.id),body:{planIds:[]},deps:[l]}),c="https://dashboard.stripe.com/".concat(null==i?void 0:i.stripe_user_id,"/settings/apps"),u=(0,j.wI3)(i,{section:"payments-settings"}),p=(0,en.n1t)("".concat((0,j.wI3)(i),"/setup_plans"),{redirect:"/"});(0,B1.Z)(async()=>{s&&[B2.Queued,B2.Scanning,B2.ImportRequested,B2.Importing].includes(s.state)&&l.refetch()},15e3),(0,A.d4)(()=>{var e;(null==l?void 0:null===(e=l.error)||void 0===e?void 0:e.status)===404||(null==s?void 0:s.state)===B2.Ready&&0===s.importable_subscriptions?(0,Y.uX)(u,{replace:!0}):r&&(null==s?void 0:s.state)===B2.Finished&&(0,Y.uX)(p,{local_navigation:!1})},[u,null==l?void 0:l.error,null==s?void 0:s.importable_subscriptions,null==s?void 0:s.state]);let h=(0,A.I4)(async()=>{try{let e=await d.refetch();e instanceof Error||l.setResult(e)}catch(e){}},[l,d]),m=null==n?void 0:n.is_global_admin,g=(null==s?void 0:s.importable_plans)?B0()(s.importable_plans.sort((e,t)=>e.amount-t.amount).map(e=>(0,er.planBasePricing)(e))):[];return(0,Z.tZ)("section",{className:"page typography stripe-account-import-page",children:(0,Z.BX)("div",{className:"container",style:{maxWidth:528},children:[(0,Z.BX)(et.tu,{paddingTop:24,paddingBottom:16,children:[(0,Z.tZ)(ei.xv.H1,{align:"center",children:"Import Paid Subscriptions"}),(0,Z.tZ)(ei.xv.B3,{align:"center",children:"Bring your subscribers to Substack by connecting your Stripe."})]}),(null==i?void 0:i.stripe_user_id)?l.error?(0,Z.tZ)(Nc,{color:"error",loading:!1,children:"Failed to load Stripe account import status"}):[B2.Queued,B2.Scanning].includes(null==s?void 0:s.state)?(0,Z.tZ)(Nc,{color:"secondary",loading:!0,children:"Scanning Stripe account for paid subscriptionsâ€¦"}):d.isLoading||[B2.Importing,B2.ImportRequested].includes(null==s?void 0:s.state)?(0,Z.BX)(Nc,{color:"secondary",loading:!0,children:["Importing"," ",(null==s?void 0:s.importable_subscriptions)?"".concat((0,er.numberToString)(null==s?void 0:s.importable_subscriptions)," "):"","paid subscriptionsâ€¦"]}):(null==s?void 0:s.state)===B2.Finished?(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(Nc,{color:"success",loading:!1,children:["Successfully imported",s.importable_subscriptions?" ".concat((0,er.numberToString)(s.importable_subscriptions)):""," ","paid subscriptions"]}),m?(0,Z.BX)(Nc,{color:"secondary",loading:!1,children:["Download a CSV with your import results here"," ",(0,Z.tZ)("a",{href:"/api/v1/stripe/account/import/".concat(null==s?void 0:s.id,"/customers?state=import"),target:"_blank",rel:"noopener",children:"here"}),"."]}):null]}):!s&&l.isLoading?(0,Z.tZ)(Nc,{color:"secondary",loading:!0,children:"Loadingâ€¦"}):[B2.Ready,B2.ImportError].includes(null==s?void 0:s.state)?(0,Z.BX)(Z.HY,{children:[(d.error||(null==s?void 0:s.state)===B2.ImportError)&&(0,Z.BX)(Nc,{color:"error",loading:!1,children:["Failed to import paid subscriptions from Stripe account."," ",d.error&&(0,Y.zx)(d.error)]}),(null==s?void 0:s.importable_subscriptions)>0&&(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(ei.xv.B4,{paddingBottom:8,children:["Your Stripe account has ",(0,Z.BX)("b",{children:[(0,er.numberToString)(s.importable_subscriptions)," paid subscriptions"]})," that can be imported to Substack",g.length>0?" for the following plans: ".concat((0,er.formatArray)(g),"."):"!"]}),m?(0,Z.BX)(ei.xv.B4,{paddingBottom:8,children:["Download a CSV of the Stripe customers we found"," ",(0,Z.tZ)("a",{href:"/api/v1/stripe/account/import/".concat(null==s?void 0:s.id,"/customers?state=scan"),target:"_blank",rel:"noopener",children:"here"}),"."]}):null]}),(0,Z.tZ)(ei.xv.B4,{paddingBottom:8,children:"The subscriptions will be detached from any previous service they may have been associated with and imported into your Substack paid subscriber list. Depending on which services these subscriptions were previously associated with, this import may trigger unexpected actions by them."}),(0,Z.tZ)(ei.xv.B4,{paddingBottom:8,children:(0,Z.BX)("b",{children:["To prevent any unexpected actions by your old services"," ",(0,Z.tZ)("a",{href:c,target:"_blank",rel:"noopener",children:"go to your Stripe dashboard"})," ",'and click "Revoke access" for any service was previously associated with these subscriptions.']})}),(0,Z.tZ)(ic.p,{className:"confirmation",checked:o,onChange:a,name:null,label:null,info:"I've disconnected other services from the Stripe account"}),(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ee.zx,{size:"md",priority:"primary",title:o?null:"Please confirm that you've disconnected other services from the Stripe account",disabled:!o,onClick:h,children:d.error||(null==s?void 0:s.state)===B2.ImportError?"Retry import":"Import".concat(s.importable_subscriptions?" ".concat((0,er.numberToString)(s.importable_subscriptions)):""," paid subscriptions")}),(0,Z.tZ)(ee.zx,{size:"md",priority:"tertiary",href:r?"/":u,localNavigation:!r,children:"Not right now"})]})]}):(0,Z.tZ)(Nc,{color:"error",loading:!1,children:"Something went wrong"}):(0,Z.BX)(et.tu,{paddingTop:20,children:[(0,Z.tZ)(ee.zx,{size:"md",priority:"primary",style:{backgroundColor:"#635bff",color:"#ffffff",gap:0},href:(0,en.n1t)("/api/v1/stripe/authorize",{redirect:(0,j.TID)(i,{addBase:!0,params:{importer_name:r}}),stripeAccountImportOnlyExistingSubscribers:!!r}),trailing:(0,Z.tZ)(Nd,{height:26}),children:"Connect with"}),(0,Z.tZ)(ee.zx,{size:"md",priority:"tertiary",href:r?"/":u,localNavigation:!r,children:"Not right now"})]})]})})},Np=["welcome_email_subject","unfinished_subscription_email_subject","imported_welcome_email_subject","founding_tier_welcome_email_subject","grant_email_subject"];class Nh extends tq.ZP{isEmailOnly(){var e;return Np.includes(null!==(e=this.props.titleField)&&void 0!==e?e:"")}async componentDidMount(){let e=[this.props.iString("Welcome email"),this.props.iString("Welcome email to paid subscribers"),this.props.iString("Welcome email to free subscribers"),this.props.iString("Referral gift grant email")];await super.componentDidMount().then(()=>{});let t=!!this.props.title&&e.includes(this.props.title);this.setState({hideSharePostAndComment:t})}getEndpoint(){var e;return null!==(e=this.props.endpoint)&&void 0!==e?e:"/api/v1/publication"}loadDocument(){return new Promise((e,t)=>{N().get(this.getEndpoint()).then(t=>{var i;let n={body:t.body[null!==(i=this.props.bodyField)&&void 0!==i?i:"undefined"]};this.props.titleField&&(n.title=t.body[this.props.titleField]),this.props.subtitleField&&(n.substitle=t.body[this.props.subtitleField]),e(n)}).catch(e=>{console.error("Failed to fetch publication: ",e),t(e)})})}renderHeader(){return(0,Z.BX)(et.gq,{className:"header",justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:this.goBack,children:this.props.iString("â† Settings")}),this.props.title&&(0,Z.tZ)(ei.xv.H3,{children:this.props.title}),(0,Z.tZ)(ee.zx,{style:{opacity:0,pointerEvents:"none"},children:this.props.iString("â† Settings")})]})}async saveDocument(e){var t;let i={};return i[null!==(t=this.props.bodyField)&&void 0!==t?t:"undefined"]=e.body,this.props.titleField&&(i[this.props.titleField]=e.title),this.props.subtitleField&&(i[this.props.subtitleField]=e.subtitle),0!==Object.keys(i).length&&await N().put(this.getEndpoint()).send(i),null}getBackButton(){return this.props.iString("Settings")}backButtonClose(){return!!this.props.backButtonClose}renderButtons(){return(0,Z.tZ)(ee.zx,{priority:"primary",onClick:this.saveAndGoBack,children:this.props.iString("Save")})}openVideoModal(e){var t,i;!this.isEmailOnly()&&"adhoc_email"!==this.getPostType()&&(null===(t=(i=this.props).setIsDrawerOpen)||void 0===t||t.call(i,{drawerId:"videoEmbedDnD",isOpen:!0}),this.setState({droppedVideoFile:e}))}renderModals(){var e,t,i;return this.isEmailOnly()?[]:[(0,Z.tZ)(lh.t,{id:"videoEmbedDnD",editorDroppedFile:null!==(t=this.state.droppedVideoFile)&&void 0!==t?t:null,mediaUploadId:null,open:"videoEmbedDnD"===this.props.openDrawerId,pub:this.props.pub,postId:null!==(i=null===(e=this.state.post)||void 0===e?void 0:e.id)&&void 0!==i?i:null,onClose:()=>{var e,t;null===(e=(t=this.props).setIsDrawerOpen)||void 0===e||e.call(t,{drawerId:null,isOpen:!1}),this.setState({droppedVideoFile:null})},onSave:e=>{var t,i;let{mediaUploadId:n,duration:r}=e;if(!this.tipTapEditor){console.warn("no tipTapEditor available");return}this.tipTapEditor.chain().focus().insertVideo({mediaUploadId:n,duration:r}).run(),null===(t=(i=this.props).setIsDrawerOpen)||void 0===t||t.call(i,{drawerId:null,isOpen:!1}),this.setState({droppedVideoFile:null})},setPostId:null})]}constructor(e,t){var i,n=()=>super.onEdit;super(e,t),i=this,(0,M._)(this,"onEdit",function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{force:!1};i.updateDocumentState().then(()=>{var e;let{doc:t}=i.state;if(!i.editorView){console.warn("onEdit called before editorView is ready");return}if("grant_email_body"===i.props.bodyField&&!(null==t?void 0:null===(e=t.body)||void 0===e?void 0:e.includes("%%grant_gift_url%%"))){let e=i.editorView.state;i.editorView.dispatch(e.tr.replaceRangeWith(e.selection.ranges[0].$from.pos,e.selection.ranges[0].$to.pos,e.schema.nodes.button.create({url:"%%grant_gift_url%%",text:"Give a subscription"}))),alert(i.props.iString('The "Give a subscription" button is required for this email.'))}}),n().call(i,e)}),(0,M._)(this,"saveAndGoBack",()=>{this.save().then(()=>{this.state.unsaved?alert(this.props.iString("Network error! Failed to save")):this.props.redirect?(0,Y.uX)(this.props.redirect,{local_navigation:!1}):window.history.back()})}),this.autoSaveEnabled=!1,this.commandSaveEnabled=!1,this.state.hideSharePostAndComment=!1,this.state.droppedVideoFile=null}}let Nm=(0,Q.fz)(Nh),Ng=e=>(0,Z.tZ)(t1.DQ,{drawerIds:["podcast","videoEmbed","audioEmbed"],children:(0,Z.tZ)(t1.rf.Consumer,{children:t=>{let{openDrawerId:i,setIsDrawerOpen:n}=t;return(0,Z.tZ)(Nm,(0,_._)((0,f._)({},e),{openDrawerId:i,setIsDrawerOpen:n}))}})});var Nv=i(2460),Nb=i(72572),Ny=i(98422),Nf=i(32129);let N_=e=>{let{post:t}=e,{iString:i}=(0,Q.M1)(),{getSettingFor:n,changeSetting:r}=(0,ss.So)(),[o,a]=(0,A.eJ)(!1);return(0,A.d4)(()=>{n("has_seen_app_stats_modal")||((0,U.j)(U.FP.POST_STATS_IN_APP_UPSELL_SEEN,{post_id:t.id,source:"post_publish_page"}),r({has_seen_app_stats_modal:!0}).then(()=>a(!0)))},[]),(0,Z.BX)(eK.u_,{isOpen:o,onClose:()=>a(!1),width:400,overflow:"hidden",children:[(0,Z.tZ)(iZ.e,{className:"image-TnTA2O",src:"/img/publish/app_stats_launch.jpg",maxWidth:400,useRetinaSizing:!0,imageIsFixedWidth:!0}),(0,Z.tZ)(ee.hU,{position:"absolute",size:"sm",priority:"tertiary",className:"closeButton-NAVAZv",onClick:()=>{(0,U.j)(U.FP.POST_STATS_IN_APP_UPSELL_CLOSED,{post_id:t.id,source:"post_publish_page"}),a(!1)},children:(0,Z.tZ)(K.Z,{size:20})}),(0,Z.BX)(et.sg,{gap:4,alignItems:"center",paddingX:20,paddingTop:24,paddingBottom:8,children:[(0,Z.tZ)(ts.xu,{paddingBottom:4,children:(0,Z.tZ)(d_.Vp,{priority:"primary",theme:"accent",children:i("NEW")})}),(0,Z.tZ)(ei.xv.H4,{weight:"heavy",color:"primary",translated:!0,children:"Stats are better in the app"}),(0,Z.tZ)(ei.xv.B3,{align:"center",color:"secondary",translated:!0,children:"See realtime views, subscriber sources, and discussion of your post exclusively in the Substack app."})]}),(0,Z.tZ)(eK.mz,{direction:"column",primaryButton:(0,Z.tZ)(ee.zx,{size:"lg",href:(0,vz.rN)({postId:t.id,params:{utm_campaign:J.VX.postStatsUpsellPostPublishPage,utm_medium:J.lP.web,utm_source:J.b3.substack,redirect:"app-store"}}),onClick:()=>(0,U.j)(U.FP.POST_STATS_IN_APP_UPSELL_CLICKED,{post_id:t.id,source:"post_publish_page"}),children:i("View in app")})})]})},NZ=e=>{let{post:t,test:i}=e,{iString:n}=(0,Q.M1)(),{testEnded:r}=wb(i);return r?null:(0,Z.tZ)(wi,{test:i,cta:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",size:"sm",href:"/publish/posts/detail/".concat(t.id,"/tests"),children:n("See details")})})};var Nw=i(10968),NC=i(17172),Nx=i(45783);let NS=e=>{let{children:t}=e,i=(0,pY.XA)(),n=(0,er.isTouchDevice)()||i,r=(0,A.sO)(null),o=(0,NC.aZ)(r),{state:a,handleArrowClick:l}=(0,Nx.eK)(r);return(0,Z.BX)(Nk,{children:[(0,Z.tZ)(NB,(0,_._)((0,f._)({ref:r},o.props),{children:t})),!n&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(Nw.ew,{direction:"left",visible:a.showLeft,onClick:l(-1)}),(0,Z.tZ)(Nw.ew,{direction:"right",visible:a.showRight,onClick:l(1)})]})]})},Nk=(0,sx.zo)({flex:"grow",position:"relative",alignItems:"start",justifyContent:"start"}),NB=(0,sx.zo)({display:"flex",overflowX:"auto",alignItems:"start",justifyContent:"start",scrollBar:"hidden",cursor:"grab",gap:8,paddingX:20});var NT=i(36781);let NI=function(e,t,i){let{source:n,hidePreviewText:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return(0,A.Ye)(()=>i?NP(e,t,i).map(i=>(0,Z.tZ)(NN,{pub:e,post:t,style:{bgColor:i.bgColor,textColor:i.textColor,aspectRatio:i.aspectRatio,bgImage:i.bgImage,hidePreviewText:r},source:n})):[],[e,t,i,n])},NN=(0,to.memo)(NT.Z),NP=(e,t,i)=>NX(NE(e,t,i)),NE=(e,t,i)=>{let n=i.web_bg_color||i.cover_bg_color,r=[],{iString:o}=Tt.mb.i();return(t.cover_image||e.cover_photo_url)&&r.push({bgImage:!0,textColor:"#ffffff",text:o("Image")}),"#ffffff"!==n.toLowerCase()&&r.push({bgColor:"#ffffff",textColor:"#404040",text:o("Grayscale")}),r.push({bgColor:n,textColor:i.print_on_web_bg_color||i.cover_print_primary||"#1a1a1a",bgImage:!1,text:o("Background color")}),i.background_pop&&r.push({bgColor:i.background_pop,textColor:i.print_on_pop,text:o("Accent color")}),r},NX=e=>{let t=[];for(let i of e)t.push((0,_._)((0,f._)({},i),{aspectRatio:"square"}));for(let i of e)t.push((0,_._)((0,f._)({},i),{aspectRatio:"stories"}));return t};var NM=i(2236),NA=i(4038);let ND=(e,t,i)=>(0,A.Ye)(()=>(null==i?void 0:i.length)?NF(i).map(i=>(0,Z.tZ)(NR,{pub:e,post:t,style:{aspectRatio:i.aspectRatio},selectionId:i.selectionId},"inference-".concat(i.index,"-").concat(i.aspectRatio))):[],[e,t,i]),NR=(0,to.memo)(e=>{let{pub:t,post:i,style:n,selectionId:r}=e,{img:o,imgDownload:a,shareData:l,useNativeShare:s}=(0,NA.Q)((0,NM.lx)({pub:t,post:i,selectionId:r,style:n})),d=(0,A.I4)(async()=>{await (0,NM.mT)({post_id:i.id,selection_id:r,type:"post_selection",aspect_ratio:n.aspectRatio,source:"post-share-center",shareData:s?l:void 0,eventName:"WRITER_MEDIA_ASSETS_IMAGE_DOWNLOADED"})},[i.id,r,n.aspectRatio,s,l]);return(0,Z.tZ)(NM.kA,{onClick:d,href:s?void 0:a,children:(0,Z.BX)(NM.A4,{children:[!(0,aI.tq)()&&o&&(0,Z.tZ)(NM.rA,{onClick:d}),(0,Z.tZ)(NM.M$,{img:o})]})})}),NF=e=>Nz(NL(e)),NL=e=>e.map((e,t)=>({selectionId:e.id,index:t,isFirstItem:0===t})),Nz=e=>{let t=[];for(let i of e)t.push((0,_._)((0,f._)({},i),{aspectRatio:"square"}));for(let i of e)t.push((0,_._)((0,f._)({},i),{aspectRatio:"stories"}));return t},NO=e=>{let{pub:t,post:i,themeVariables:n,selectionsInferences:r,setShareableImageModelOpen:o}=e,{iString:a}=(0,Q.M1)(),{orderedAssets:l}=NY(t,i,n,r);return(0,Z.BX)(Pl,{children:[(0,Z.tZ)(Pr,{title:a("Share as an image"),subtitle:a("Download images to promote your post"),cta:(0,Z.tZ)(NU,{trackClick:e=>{(0,U.j)(U.FP.SHARE_LINK_CLICKED,{name:e,source:"post-share-center"})},setShareableImageModelOpen:o})}),(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(et.sg,{pullX:20,children:(0,Z.tZ)(NS,{children:l})})]})},NU=e=>{let{trackClick:t,setShareableImageModelOpen:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"primary-mono",size:"sm",onClick:()=>{t("media-assets"),null==i||i(!0)},children:n("Create image")})},NY=(e,t,i,n)=>({orderedAssets:[...NI(e,t,i,{source:"post-share-center",hidePreviewText:!0}),...ND(e,t,n)]}),NH=e=>{let{post:t,pub:i}=e,{iString:n}=(0,Q.M1)(),r=(0,re.aF)(),o=(0,tE.O1)(null,{pub:i,post:t,user:r,params:{showWelcomeOnShare:!0}});return!r||t.postSchedule||t.is_draft||i.invite_only?null:(0,Z.BX)(Pl,{children:[(0,Z.tZ)(Pr,{title:n("Share as a note"),subtitle:n("Write a note to share your post on Substack")}),(0,Z.tZ)(rU.sA,{restackUrl:o,placeholder:n("Share something about this post..."),initialText:n("Check out my new post!"),className:"composer-qg_AIk",textClassName:"placeholder-ySt_Sk"})]})},Nj=e=>{var{size:t=24,color:i="var(--color-fg-primary)",className:n}=e,r=(0,ef._)(e,["size","color","className"]);return(0,Z.tZ)(eH.l,(0,_._)((0,f._)({},r),{name:"CopyIconFilled",svgParams:{viewBox:"0 0 24 24"},stroke:"none",width:t,height:t,fill:i,className:n,children:(0,Z.tZ)("path",{stroke:"none",d:"M16.8919 5.02835V4.87091C16.8919 2.96314 15.9246 2 14.0266 2H4.86522C2.95812 2 2 2.96314 2 4.87091V14.243C2 16.1508 2.95812 17.114 4.86522 17.114H5.1846V9.15873C5.1846 6.77213 7 5 9.29081 5.02835H16.8919ZM19.1348 22H9.97335C8.06625 22 7.10813 21.0369 7.10813 19.1291V9.75701C7.10813 7.83998 8.06625 6.8861 9.97335 6.8861H19.1348C21.0328 6.8861 22 7.84924 22 9.75701V19.1291C22 21.0369 21.0328 22 19.1348 22Z"})}))};var NJ=i(79138),NV=i(23365),Nq=i(37632),NW=i(39535);i(98170);let NG=(0,to.memo)(e=>{let{isOpen:t,onClose:i,pub:n,post:r,source:o,themeVariables:a}=e;(0,A.d4)(()=>{t&&(0,U.j)(U.FP.INSTAGRAM_SHARE_MODAL_SEEN,{source:o||"share center"})},[t,o]);let{iString:l}=(0,Q.M1)(),[s,d]=(0,A.eJ)(!1),[c,u]=(0,A.eJ)(!1),p=(0,iN.pm)(),h=NI(n,r,a,{source:"instagram-modal-share-center",hidePreviewText:!0}),m=async()=>{(0,U.j)(U.FP.SHARE_CENTER_MEDIA_ASSETS_EMAILED,{post_id:r.id}),d(!0);try{(await (0,ix.rd)("/api/v1/press_kit/".concat(r.id,"/email"))).success&&(u(!0),p.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:l("Email sent")}))))}catch(e){(0,U.j)(U.FP.SHARE_CENTER_MEDIA_ASSETS_EMAILED_FAILED,{post_id:r.id}),p.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:l("Error sending email. Please try again.")})))}finally{d(!1)}};return(0,Z.tZ)(eK.u_,{isOpen:t,onClose:i,fullscreenMobile:!0,children:(0,Z.BX)(tU.w,{children:[(0,Z.tZ)(eK.xB,{alignItems:"center",icon:(0,Z.tZ)(mK.AM,{icon:(0,Z.tZ)(NV.Z,{size:20})}),title:l("Share to Instagram"),description:l("Download images to share this post on Instagram"),showClose:!0,onClose:i}),(0,Z.tZ)(et.sg,{paddingY:20,children:(0,Z.tZ)(NS,{children:h})}),(0,Z.tZ)(eK.mz,{direction:"column",showDivider:!0,primaryButton:(0,Z.tZ)(ee.zx,{size:"lg",priority:"primary",disabled:c,loading:s,onClick:m,leading:c?(0,Z.tZ)(eE.Z,{size:20}):null,children:c?l("Sent"):l("Send all via email")})})]})})},(e,t)=>e.post.id===t.post.id&&e.isOpen===t.isOpen),NK=e=>{let{pub:t,post:i,themeVariables:n}=e,r=(0,re.aF)(),{iString:o}=(0,Q.M1)(),{getSettingFor:a}=(0,ss.So)(),{handleCopyLink:l}=(0,tE.Uo)(),s=!!a("display_intro_popup_on_shares"),d=(0,tE.O1)(null,(0,f._)({pub:t,post:i,user:r},s&&{params:{showWelcomeOnShare:!0}}));return(0,Z.BX)(Pl,{children:[(0,Z.tZ)(Pr,{title:o("Share your link"),subtitle:o("Copy this link and share it everywhere"),cta:(0,Z.tZ)(ee.zx,{size:"sm",priority:"primary-mono",onClick:()=>{l({shareUrl:d})},children:o("Copy link")})}),(0,Z.BX)(et.sg,{gap:8,children:[(0,Z.tZ)(NQ,{shareUrl:d}),(0,Z.tZ)(N1,{pub:t,post:i,themeVariables:n,shareUrl:d})]})]})},NQ=e=>{let{shareUrl:t}=e,{handleCopyLink:i}=(0,tE.Uo)();return(0,Z.BX)(N$,{children:[(0,Z.tZ)(N0,{children:(0,Z.tZ)(ee.hU,{size:"sm",priority:"quaternary",onClick:()=>{i({shareUrl:t})},children:(0,Z.tZ)(Nj,{size:20})})}),(0,Z.tZ)(tD.oi,{readOnly:!0,flex:"grow",value:t,className:"input-snx8m6",onClick:e=>{e.currentTarget.select()}})]})},N$=(0,sx.zo)({display:"flex",alignItems:"center",height:48,paddingY:4,paddingX:16,radius:"sm",bg:"secondary",flex:"grow"}),N0=(0,sx.zo)({width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center"}),N1=e=>{let{pub:t,post:i,themeVariables:n,shareUrl:r}=e,[o,a]=(0,A.eJ)(!1),{iString:l}=(0,Q.M1)(),s=(0,tE.B8)({post:i,pub:t});return(0,Z.BX)(ts.xu,{gap:8,flex:"grow",className:"shareButtons-CE2QF_",children:[(0,Z.tZ)(ee.zx,{priority:"secondary",leading:(0,Z.tZ)(NV.Z,{size:16}),flex:"grow",onClick:()=>{(0,U.j)(U.FP.SHARE_CENTER_INSTAGRAM_MODAL_OPENED,{post_id:i.id}),a(!0)},children:l("Instagram")}),(0,Z.tZ)(ee.zx,{priority:"secondary",leading:(0,Z.tZ)(NW.Z,{size:16}),flex:"grow",onClick:()=>{(0,tE.Wn)({shareUrl:r,shareName:s,pub:t,post:i,utm_campaign:J.VX.postShareCenter})},children:l("Twitter")}),(0,Z.tZ)(ee.zx,{priority:"secondary",leading:(0,Z.tZ)(NJ.Z,{size:16}),flex:"grow",onClick:()=>{(0,tE.Po)({shareUrl:r,pub:t,post:i,utm_campaign:J.VX.postShareCenter})},children:l("Facebook")}),(0,Z.tZ)(ee.zx,{priority:"secondary",leading:(0,Z.tZ)(Nq.Z,{size:16}),flex:"grow",onClick:()=>{(0,tE.lc)({shareUrl:r,pub:t,post:i,utm_campaign:J.VX.postShareCenter})},children:l("LinkedIn")}),(0,Z.tZ)(NG,{isOpen:o,onClose:()=>a(!1),pub:t,post:i,themeVariables:n})]})},N2=e=>{let{pub:t,post:i,initialClipId:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.BX)(Pl,{children:[(0,Z.tZ)(Pr,{title:r("Share clips"),subtitle:r("Download clips to promote your full video"),cta:(0,Z.tZ)(ee.zx,{priority:"primary-mono",size:"sm",onClick:()=>{(0,U.j)(U.FP.SHARE_CENTER_CREATE_CLIP_CLICKED,{post_id:i.id}),window.open("".concat((0,j.uRy)(t,i,{urlParams:{clippingMode:!0}})))},children:r("Create clip")})}),i.videoUpload&&i.podcastUpload&&(0,Z.tZ)(il.C,{isUploadingMedia:!1,podcastUpload:i.podcastUpload,postId:i.id,videoUpload:i.videoUpload,children:(0,Z.tZ)(rj,{post:i,pub:t,videoUpload:i.videoUpload,canEdit:!1,variant:"download",initialClipId:n})})]})},N4=(e,t)=>{var i,n,r,o,a;let l=(0,H.Z)(null==e?void 0:null===(i=e.postSchedule)||void 0===i?void 0:i.trigger_at).diff((0,H.Z)(),"day"),{iString:s,iPlural:d}=Tt.mb.i(t);if(l>0)switch(null==e?void 0:null===(n=e.postSchedule)||void 0===n?void 0:n.post_audience){case"founding":return d("Your founding list will receive your post in %1 day. Spread the word and tease your upcoming post to find new readers!","Your founding list will receive your post in %1 days. Spread the word and tease your upcoming post to find new readers!",l);case"only_paid":return d("Your paid list will receive your post in %1 day. Spread the word and tease your upcoming post to find new readers!","Your paid list will receive your post in %1 days. Spread the word and tease your upcoming post to find new readers!",l);case"only_free":return d("Your free list will receive your post in %1 day. Spread the word and tease your upcoming post to find new readers!","Your free list will receive your post in %1 days. Spread the word and tease your upcoming post to find new readers!",l);default:return d("Your whole list will receive your post in %1 day. Spread the word and tease your upcoming post to find new readers!","Your whole list will receive your post in %1 days. Spread the word and tease your upcoming post to find new readers!",l)}else if((l=(0,H.Z)(null==e?void 0:null===(r=e.postSchedule)||void 0===r?void 0:r.trigger_at).diff((0,H.Z)(),"hour"))>0)switch(null==e?void 0:null===(o=e.postSchedule)||void 0===o?void 0:o.post_audience){case"founding":return d("Your founding list will receive your post in %1 hour. Spread the word and tease your upcoming post to find new readers!","Your founding list will receive your post in %1 hours. Spread the word and tease your upcoming post to find new readers!",l);case"only_paid":return d("Your paid list will receive your post in %1 hour. Spread the word and tease your upcoming post to find new readers!","Your paid list will receive your post in %1 hours. Spread the word and tease your upcoming post to find new readers!",l);case"only_free":return d("Your free list will receive your post in %1 hour. Spread the word and tease your upcoming post to find new readers!","Your free list will receive your post in %1 hours. Spread the word and tease your upcoming post to find new readers!",l);default:return d("Your whole list will receive your post in %1 hour. Spread the word and tease your upcoming post to find new readers!","Your whole list will receive your post in %1 hours. Spread the word and tease your upcoming post to find new readers!",l)}else switch(null==e?void 0:null===(a=e.postSchedule)||void 0===a?void 0:a.post_audience){case"founding":return s("Your founding list will receive your post in less than an hour. Spread the word and tease your upcoming post to find new readers!");case"only_paid":return s("Your paid list will receive your post in less than an hour. Spread the word and tease your upcoming post to find new readers!");case"only_free":return s("Your free list will receive your post in less than an hour. Spread the word and tease your upcoming post to find new readers!");default:return s("Your whole list will receive your post in less than an hour. Spread the word and tease your upcoming post to find new readers!")}},N3={"en-US-OnyxTurboMultilingualNeural":{voice_id:"en-US-OnyxTurboMultilingualNeural",voice_display_name:"Oliver",voice_description:"A male voice with a direct, neutral tone"},"en-US-CoraMultilingualNeural":{voice_id:"en-US-CoraMultilingualNeural",voice_display_name:"Cora",voice_description:"A female voice with a soft, smooth tone"},"en-US-AlloyTurboMultilingualNeural":{voice_id:"en-US-AlloyTurboMultilingualNeural",voice_display_name:"Taylor",voice_description:"A female voice with a direct, neutral tone"},"en-US-NovaTurboMultilingualNeural":{voice_id:"en-US-NovaTurboMultilingualNeural",voice_display_name:"Casey",voice_description:"A younger voice with a bright, clear tone"},"en-GB-OllieMultilingualNeural":{voice_id:"en-GB-OllieMultilingualNeural",voice_display_name:"Stewart",voice_description:"A British male voice with a deep, resonant tone"},"en-GB-AdaMultilingualNeural":{voice_id:"en-GB-AdaMultilingualNeural",voice_display_name:"Victoria",voice_description:"A British female voice with a precise, clear tone"}},N8=Object.entries(N3).reduce((e,t)=>{let[i,n]=t;return(0,_._)((0,f._)({},e),{[n.voice_display_name]:n.voice_id})},{});Object.values(N3).map(e=>e.voice_id);let N6={root:"root-agC9Jp",youTubeStatus:"youTubeStatus-d5p9sQ"},N5=e=>{var t;let{id:i,pub:n,themeVariables:r,openAssetModal:o,clipId:a}=e,[l,s]=(0,A.eJ)(!!o),{isMobile:d}=(0,Ny.v9)();(0,A.d4)(()=>{(0,U.j)(U.FP.SHARE_CENTER_SEEN,{post_id:i})},[i]);let{result:c,error:u,isLoading:p}=(0,iS.ib)({pathname:"/api/v1/post_management/share_center/".concat(i),deps:[],auto:!0}),h=2===n.tier&&!n.invite_only,{result:m}=(0,iS.ib)({pathname:"/api/v1/post_management/share_center/".concat(i,"/recommended_selections"),deps:[h],auto:h});return((0,A.d4)(()=>{if(c){(0,Y.pt)((0,Nf.getPostMetaImage)(n,c)[0]);let e=(0,Nf.getPostMetaImageForTwitter)(n,c);e&&(0,Y.pt)(e)}},[n,c]),p)?(0,Z.tZ)(Pi,{}):u||!c?(0,Z.tZ)(Pn,{}):(0,Z.tZ)(tU.w,{children:(0,Z.BX)(et.sg,{className:N6.root,flex:"grow",gap:20,paddingY:32,paddingX:{mobile:16,desktop:0},children:[(0,Z.tZ)(Pe,{post:c}),!c.postSchedule&&c.headlineTest&&(0,Z.tZ)(NZ,{post:c,test:c.headlineTest}),(0,Z.tZ)(Pt,{post:c,pub:n}),(0,Z.tZ)(NH,{post:c,pub:n}),(0,Z.tZ)(NK,{pub:n,post:c,themeVariables:r}),c.videoUpload&&(0,Z.tZ)(iz,{mediaUploadId:c.videoUpload.id,className:N6.youTubeStatus,postId:c.id,source:"share_center"}),c.videoUpload&&!d&&(0,Z.tZ)(N2,{pub:n,post:c,initialClipId:a}),(0,Z.tZ)(NO,{pub:n,post:c,themeVariables:r,selectionsInferences:null==m?void 0:null===(t=m.inference)||void 0===t?void 0:t.selections,setShareableImageModelOpen:s}),!c.postSchedule&&!c.videoUpload&&(0,Z.tZ)(N7,{pub:n,post:c,themeVariables:r}),(0,Z.tZ)(h8.iL,{isOpen:l,setOpen:e=>{e||(0,Y.iO)("openAssetModal"),s(e)},pub:n,themeVariables:r,item:{type:"post_asset",post:c}}),(0,Z.tZ)(N_,{post:c})]})})},N9=e=>{let{selection:t,setVoice:i,pub:n,postId:r,setUploadId:o}=e,[a,l]=(0,A.eJ)(null),[s,d]=(0,A.eJ)(null),[c,u]=(0,A.eJ)(null),[p,h]=(0,A.eJ)(!1),{iString:m,language:g}=(0,Q.M1)(),{getSettingFor:v}=(0,ss.So)(),b=N3[N8[v("voiceover_voice_name")]||"en-US-OnyxTurboMultilingualNeural"];return a?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"Your selection:"}),(0,Z.tZ)(ei.xv.B3,{color:"primary",children:t}),(0,Z.tZ)(iH.Z,{initialFile:s,feature:is.MR.ShareQuote,mediaType:"audio",pub:n,postId:r,onChange:e=>{let{mediaUpload:t}=e;h(!1),u(t),d(null)},onUploadStarted:()=>{h(!0)},onUploadCanceled:()=>{h(!1)},language:g,setPostId:null}),c&&"transcoded"===c.state&&(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{i("user"),o(c.id)},disabled:p,children:m("Use this recording")})]}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(tX.iz,{}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(ei.xv.H4,{translated:!0,color:"secondary",children:"Select a voice"}),(0,Z.BX)(et.gq,{gap:8,children:[b&&(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{l(b.voice_id),i(b.voice_id)},children:(0,Z.BX)(et.gq,{gap:8,children:[(0,Z.tZ)(Nv.Z,{size:20}),m((0,aI.tq)()?"AI Voice":"AI Voiceover")]})},b.voice_id),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{l("user")},children:(0,Z.BX)(et.gq,{gap:8,children:[(0,Z.tZ)(fz.Z,{size:20}),m((0,aI.tq)()?"Upload Voice":"Upload Voiceover")]})})]})]})]})},N7=e=>{let t,{pub:i,post:n,themeVariables:r}=e,[o,a]=(0,A.eJ)(!1),[l,s]=(0,A.eJ)(null),[d,c]=(0,A.eJ)(!1),[u,p]=(0,A.eJ)(n.cover_image?"social_image":"#000000"),[h,m]=(0,A.eJ)(!1),[g,v]=(0,A.eJ)(null),[b,y]=(0,A.eJ)(null),[f,_]=(0,A.eJ)(0),{iString:w}=(0,Q.M1)();"undefined"!=typeof window&&(t=new URLSearchParams(window.location.search).get("selectionForQuote")),(0,A.d4)(()=>{(async()=>{t&&g&&(await N().post("/api/v1/video_clip/".concat(n.id,"/start")).send({sentence:t,voice:g,uploadId:b}),a(!0))})()},[t,n.id,g,b]),(0,B1.Z)(async()=>{if(t&&o&&!d&&!h){var e,i;let r=encodeURIComponent(t),o=await N().get("/api/v1/video_clip/".concat(n.id,"/").concat(r,"/").concat(g,"/status"));o.body.url&&(s(o.body.url),a(!1)),(null===(e=o.body)||void 0===e?void 0:e.status)==="failed"&&(c(!0),_(0));let l=!1;if(null===(i=o.body)||void 0===i?void 0:i.status){let e=o.body.status;"generating_tts"===e&&f<10&&(_(10),l=!0),"generating_transcript"===e&&f<25&&(_(25),l=!0),"generating_audiogram"===e&&f<80&&(_(80),l=!0)}!l&&f<100&&_(f+2)}},1e3);let C=async e=>{m(!0),a(!0),s(null),p(e),_(60);let i=await N().post("/api/v1/video_clip/".concat(n.id)).send({sentence:t,background:e});i.body.url&&(s(i.body.url),a(!1))},x=w(t&&o?"Generating Video":"Share as a video"),S=w(t?o&&!d?"This can take up to 30 seconds...":d?"Video generation failed, please try again. ":g?"Preview and download your video":"Finish configuring your video":"Turn your post into a shareable video"),k=(0,Z.BX)(et.X2,{gap:8,children:[t&&g&&(0,Z.tZ)(ee.zx,{priority:"secondary",size:"sm",onClick:()=>{v(null),y(null),s(null),m(!1),_(0)},children:w("Change Voice")}),t&&(0,Z.tZ)(ee.zx,{priority:"secondary",size:"sm",onClick:()=>{(0,U.j)(U.FP.SHARE_CENTER_VIDEO_SELECT_QUOTE_CLICKED,{post_id:n.id,text:t}),(0,Y.uX)((0,j.uRy)(i,n,{urlParams:{selectQuote:!0}}))},children:w("Edit Quote")}),(0,Z.tZ)(ee.zx,{size:"sm",priority:"primary-mono",onClick:()=>{if(t&&l){(0,U.j)(U.FP.SHARE_CENTER_VIDEO_DOWNLOADED,{post_id:n.id,text:t}),window.open(l);return}(0,U.j)(U.FP.SHARE_CENTER_VIDEO_SELECT_QUOTE_CLICKED,{post_id:n.id,text:t}),(0,Y.uX)((0,j.uRy)(i,n,{urlParams:{selectQuote:!0}}))},disabled:t&&(o||!g),children:w(t?"Download":"Create")})]});return(0,Z.BX)(Pl,{children:[(0,Z.tZ)(Pr,{title:x,subtitle:S,cta:k}),t&&(g?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Background"}),(0,Z.BX)(et.gq,{gap:8,children:[n.cover_image&&(0,Z.tZ)(ee.zx,{style:{borderRadius:"100%",width:38,padding:0,background:"url(".concat(n.cover_image,") center"),filter:"blur(1px)",webkitFilter:"blur(1px)",backgroundSize:"cover"},onClick:async()=>{await C("social_image")},disabled:o,children:"social_image"===u&&(0,Z.tZ)(eE.Z,{size:20})}),(0,Z.tZ)(ee.zx,{style:{borderRadius:"100%",width:38,padding:0,background:r.color_theme_bg_web},onClick:async()=>{await C("pub_theme")},disabled:o,children:"pub_theme"===u&&(0,Z.tZ)(eE.Z,{size:20})}),(0,Z.tZ)(ee.zx,{style:{background:"white",borderRadius:"100%",border:"1px solid #ccc",width:38,padding:0},onClick:async()=>{await C("#FFFFFF")},disabled:o,children:"#FFFFFF"===u&&(0,Z.tZ)(eE.Z,{size:20,color:"#000000"})}),(0,Z.tZ)(ee.zx,{style:{background:"black",borderRadius:"100%",border:"1px solid #ccc",width:38,padding:0},onClick:async()=>{await C("#000000")},disabled:o,children:"#000000"===u&&(0,Z.tZ)(eE.Z,{size:20})})]})]}):(0,Z.tZ)(N9,{selection:t,setVoice:v,pub:i,postId:n.id,setUploadId:y})),t&&g&&(0,Z.tZ)(tX.iz,{}),t&&g&&(0,Z.tZ)(et.tu,{gap:4,children:l?(0,Z.tZ)("video",{width:320,height:320,controls:!0,children:(0,Z.tZ)("source",{src:l,type:"video/mp4"})}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.H4,{translated:!0,children:"Progress"}),(0,Z.tZ)(iI.uk,{percent:f,width:300})]})})]})},Pe=e=>{let{post:t}=e,{iString:i,language:n}=(0,Q.M1)();return(0,Z.BX)(et.sg,{alignItems:"center",gap:4,children:[(0,Z.tZ)(ei.xv.H2,{weight:"heavy",children:i(t.postSchedule?"Your post is scheduled!":"Your post is live!")}),t.should_send_email&&t.postSchedule&&(0,Z.tZ)(ei.xv.B3,{color:"secondary",textAlign:"center",children:N4(t,n)})]})},Pt=e=>{var t;let{post:i,pub:n}=e,r=(0,j.uRy)(n,i,{feedViewer:!1});return(0,Z.tZ)(et.sg,{shadow:"xs",radius:"md",children:(0,Z.tZ)(sx.A0,{href:r,target:"_blank",rel:"noopener noreferrer",children:(0,Z.tZ)(Nb.N,{url:r,title:i.title,host:n.name,image:null!==(t=i.cover_image)&&void 0!==t?t:"",readOnly:!0})})})},Pi=()=>(0,Z.tZ)(et.sg,{gap:4,flex:"grow",justifyContent:"center",alignItems:"center",padding:72,children:(0,Z.tZ)(iI.$j,{})}),Pn=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(et.sg,{gap:4,flex:"grow",justifyContent:"center",alignItems:"center",padding:72,children:(0,Z.tZ)(tp._Y,{icon:(0,Z.tZ)(eN.Z,{size:24}),title:e("Something went wrong"),text:e("Please try reloading the page")})})};function Pr(e){let{title:t,subtitle:i,cta:n}=e;return(0,Z.BX)(Po,{children:[(0,Z.BX)(Pa,{children:[(0,Z.tZ)(ei.xv.B3,{weight:"semibold",color:"primary",children:t}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:i})]}),n]})}let Po=(0,ts.zo)({display:"flex",flex:"grow",justifyContent:"space-between",alignItems:"center",gap:12}),Pa=(0,ts.zo)({display:"flex",flex:"grow",direction:"column",gap:2}),Pl=(0,ts.zo)({display:"flex",direction:"column",border:"detail",radius:"md",padding:20,gap:16,overflow:"hidden",shadow:"xs"}),Ps={imageInput:"imageInput-txLQDJ",clearButton:"clearButton-uJFaWD"},Pd=e=>{var t,i,n,r,o,a,l,s,d;let{campaignId:c}=e,{iString:u}=(0,Q.M1)(),p=(0,A.sO)(null),{result:h,isLoading:m,error:g,setResult:v}=(0,iS.ib)({pathname:"/api/v1/sponsorship-campaigns/".concat(c),method:"GET",auto:!0}),[b,y]=(0,A.eJ)({}),[w,C]=(0,A.eJ)(!1),x=async()=>{if(h){C(!0);try{var e,t;let i=await fetch("/api/v1/sponsorship-campaigns/".concat(c),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!i.ok)throw Error("Failed to save campaign");let n=await i.json();v(n),(null===(t=window._preloads)||void 0===t?void 0:null===(e=t.pub)||void 0===e?void 0:e.sponsorshipCampaigns)&&c&&(window._preloads.pub.sponsorshipCampaigns[c]=n),y({})}catch(e){console.error("Error saving campaign:",e)}finally{C(!1)}}};if(m)return(0,Z.tZ)(dt,{children:(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"Loading campaign details..."})});if(g)return(0,Z.tZ)(dt,{children:(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"Error loading campaign. Please try again later."})});if(!h)return(0,Z.tZ)(dt,{children:(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"Campaign not found."})});let S=e=>t=>{y(i=>(0,_._)((0,f._)({},i),{[e]:t}))},k=null===b.image_url?null:null!==(t=b.image_url)&&void 0!==t?t:h.image_url;return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(dt,{children:(0,Z.BX)(et.tu,{gap:32,children:[(0,Z.tZ)(et.tu,{alignItems:"start",children:(0,Z.tZ)("a",{href:"/publish/sponsorship-campaigns",children:(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"Back to Campaigns"})})}),(0,Z.tZ)(ei.xv.H2,{children:h.title}),(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(ij.n,{label:"Title",value:null!==(i=b.title)&&void 0!==i?i:h.title,onChange:S("title"),placeHolder:"Campaign title"}),(0,Z.tZ)(ij.n,{label:"Short Text",value:null!==(r=null!==(n=b.short_text)&&void 0!==n?n:h.short_text)&&void 0!==r?r:"",onChange:S("short_text"),placeHolder:"Short description"}),(0,Z.tZ)(ij.n,{label:"Image Alt Text",value:null!==(a=null!==(o=b.image_alt_text)&&void 0!==o?o:h.image_alt_text)&&void 0!==a?a:"",onChange:S("image_alt_text"),placeHolder:"Image alt text"}),(0,Z.BX)(et.tu,{gap:4,className:Ps.imageField,children:[(0,Z.tZ)(ei.xv.B4,{weight:"bold",translated:!0,children:"Image"}),(0,Z.BX)("button",{className:Ps.imageInput,onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},children:[k?(0,Z.tZ)("img",{src:k,alt:"Campaign Image"}):(0,Z.tZ)("div",{className:Ps.imagePlaceholder,children:"Upload an image"}),(0,Z.tZ)("input",{ref:p,type:"file",name:"image_url",accept:"image/*",onChange:async()=>{if(!p.current)return;let e=await (0,Y.zw)(p.current);if(!e||eS()(e.url))return;let{url:t}=e;y(e=>(0,_._)((0,f._)({},e),{image_url:t}))},style:{display:"none"}}),k&&(0,Z.tZ)(ee.hU,{priority:"secondary",size:"sm",rounded:!0,className:Ps.clearButton,onClick:e=>{e.preventDefault(),e.stopPropagation(),y(e=>(0,_._)((0,f._)({},e),{image_url:null}))},children:(0,Z.tZ)(K.Z,{size:20})})]})]}),(0,Z.tZ)(ij.n,{label:"Link URL",value:null!==(l=b.link_url)&&void 0!==l?l:h.link_url,onChange:S("link_url"),placeHolder:"Link URL"}),(0,Z.tZ)(iT.m,{label:"Exclude Audience Minimum",value:null!==(d=null!==(s=b.exclude_audience_minimum)&&void 0!==s?s:h.exclude_audience_minimum)&&void 0!==d?d:"",onChange:S("exclude_audience_minimum"),options:[{value:"",label:"Show to everyone"},{value:"paid",label:"Only show to free subscribers"}]}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:x,disabled:w||0===Object.keys(b).length,children:u(w?"Saving...":"Save Changes")})]})]})})})},Pc=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)(),{data:n,loading:r,error:o}=fM("/api/v1/sponsorship-campaigns",{method:"GET"}),a=async()=>{let e=await fetch("/api/v1/sponsorship-campaigns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({publication_id:t.id,title:i("New Sponsorship Campaign"),short_text:"Presented by",link_url:(0,j.TJI)(t)})});if(!e.ok)throw Error("Failed to save campaign");let n=await e.json();n.id&&(0,Y.uX)("/publish/sponsorship-campaigns/".concat(n.id))};return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(dt,{children:(0,Z.BX)(et.tu,{gap:32,children:[(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(ei.xv.H2,{translated:!0,children:"Sponsorship Campaigns"}),(0,Z.tZ)(ee.zx,{onClick:a,priority:"primary",children:i("Create Campaign")})]}),(null==n?void 0:n.length)?(0,Z.tZ)(et.tu,{gap:8,children:n.map(e=>(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",padding:8,borderBottom:"detail",borderTop:"detail",children:[(0,Z.tZ)(ei.xv.B2,{children:e.title}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:"/publish/sponsorship-campaigns/".concat(e.id),children:i("Edit")})]},e.id))}):(null==n?void 0:n.length)!==0||r?o&&(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"Error loading campaigns. Please try again later."}):(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"No campaigns found. Create your first campaign to get started."})]})})})},Pu=e=>{let{pub:t}=e,[i,n]=(0,A.eJ)(0),{iString:r,language:o}=(0,Q.M1)(),a=nN()(t.sections,"id"),l=t.sections.length>0,s=e=>{switch(e){case"founding":return r("Founding members only");case"only_paid":return r("Paid subscribers");case"only_free":return r("Free subscribers");default:return r("Everyone")}},d=[{key:"title",name:r("Post title"),sortable:!0,valueFn:e=>(0,Z.tZ)("a",{href:(0,j.MoQ)(t,e.post_id),target:"_blank",rel:"noopener",children:e.title})},{key:"post_date",name:r("Post date and time"),sortable:!0,valueFn:e=>(0,H.Z)(e.post_date).format("MMM DD YYYY, h:mma")},{key:"audience",name:r("Audience"),sortable:!0,valueFn:e=>s(e.audience)},{key:"delivered",name:r("Email deliveries"),sortable:!0,valueFn:e=>u3(e.delivered,e=>(0,er.numberToString)(e,{language:o}),{language:o})},{key:"opens",name:r("Email opens"),sortable:!0,valueFn:e=>u3(e.opens,e=>(0,er.numberToString)(e,{language:o}),{language:o})},{key:"open_rate",name:r("Open Rate"),sortable:!0,valueFn:e=>u3(e.open_rate,e=>"".concat((0,er.numberToString)(100*e,{language:o}),"%"),{language:o})},{key:"signups",name:r("Free subscriptions driven by the post"),sortable:!0,valueFn:e=>u3(e.signups,e=>(0,er.numberToString)(e,{language:o}),{language:o})},{key:"subscribes",name:r("Paid subscriptions driven by the post"),sortable:!0,valueFn:e=>u3(e.subscribes,e=>(0,er.numberToString)(e,{language:o}),{language:o})},{key:"likes",name:r("Likes"),sortable:!0,valueFn:e=>u3(e.likes,e=>(0,er.numberToString)(e,{language:o}),{language:o})},{key:"comments",name:r("Comments"),sortable:!0,valueFn:e=>u3(e.comments,e=>(0,er.numberToString)(e,{language:o}),{language:o})},{key:"shares",name:r("Shares"),sortable:!0,valueFn:e=>u3(e.shares,e=>(0,er.numberToString)(e,{language:o}),{language:o})}];l&&d.push({key:"section_id",name:r("Section"),sortable:!1,valueFn:e=>{var t;return e.section_id?null===(t=a[e.section_id])||void 0===t?void 0:t.name:"-"}});let c={by:"post_date",direction:u8.Desc};(0,A.d4)(()=>{(0,U.j)(U.FP.STATS_PAGE_VIEWED,{type:"email"})},[]);let u=i?"/api/v1/publication/stats/email_stats?section_id=".concat(i):"/api/v1/publication/stats/email_stats";return(0,Z.tZ)(dp,{children:(0,Z.tZ)(d6,{title:r("Email stats"),subtitle:r("The sum of all views to your publication across platforms."),action:l?(0,Z.BX)(oY.i,{value:i,onChange:e=>n(Number(e.currentTarget.value)),children:[(0,Z.tZ)("option",{value:0,children:r("All sections")}),t.sections.map(e=>(0,Z.tZ)("option",{value:e.id,children:e.name},e.id))]}):void 0,children:(0,Z.tZ)(ps,{url:u,appendMode:!0,pageSize:20,cols:d,defaultSort:c,isPannable:!0})})})};var Pp=i(75616),Ph=i(34354),Pm=i(46208),Pg=i(43815);let Pv=e=>{let{active:t,payload:i,label:n,format:r="number",percent:o,color:a}=e;return t&&i&&0!==i.length?(0,Z.tZ)(fw.W,{children:(0,Z.BX)(fy,{children:[(0,Z.tZ)(fm,{label:n}),(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(ff,{children:(0,Z.tZ)(Pb,{payload:i,format:r,percent:o,color:a})}),(0,Z.tZ)(fv,{payload:i})]})}):null},Pb=e=>{var t;let{payload:i,format:n,percent:r,color:o}=e;if(!i||0===i.length)return null;let a=(0,ma.L)((null===(t=i[0])||void 0===t?void 0:t.value)!==void 0?i[0].value:0,n,"currency"===n?"USD":void 0),l=void 0!==r&&(0,ma.L)(r,"percent");return(0,Z.BX)(f_,{children:[(0,Z.tZ)(fb,{color:o}),(0,Z.BX)(fZ,{children:[(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"primary",children:a}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:l})]})]})},Py={cell:"cell-jKHwV2",inactive:"inactive-V2FNCG"},Pf=e=>{let{data:t,loading:i,format:n="number",height:r=360}=e,{tooltipFormat:o}=fu(n),{transformedData:a}={transformedData:(0,A.Ye)(()=>{if(!t||!t.datasets||0===t.datasets.length||!t.labels)return[];let e=t.datasets[0];return e&&e.data?t.labels.map((t,i)=>{var n,r,o;return{name:t,value:e.data[i]||0,color:null===(n=e.backgroundColor)||void 0===n?void 0:n[i],tooltip:null===(r=e.tooltip)||void 0===r?void 0:r[i],percent:null===(o=e.percent)||void 0===o?void 0:o[i]}}):[]},[t])},[l,s]=(0,A.eJ)(null);return 0===a.length?null:i?(0,Z.tZ)(et.M5,{height:r,children:(0,Z.tZ)(iI.$j,{})}):(0,Z.tZ)(yG.h,{height:r,children:(0,Z.BX)(Ph.u,{children:[(0,Z.tZ)(Pm.b,{data:a,dataKey:"value",innerRadius:"66%",outerRadius:"100%",paddingAngle:.5,isAnimationActive:!1,startAngle:90,endAngle:-270,children:a.map((e,t)=>{let i=e.color||y8[t];return(0,Z.tZ)(Pg.b,{fill:i,onMouseEnter:()=>s(t),onMouseLeave:()=>s(null),className:k()(Py.cell,null!==l&&l!==t&&Py.inactive)},"cell-".concat(t))})}),(0,Z.tZ)(y1.u,{isAnimationActive:!1,content:e=>{var t,i,n;let r=a.find(t=>{var i,n;return t.name===(null===(n=e.payload)||void 0===n?void 0:null===(i=n[0])||void 0===i?void 0:i.name)});return(0,Z.tZ)(Pv,{active:e.active,payload:e.payload,label:String(null!==(n=null===(i=e.payload)||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:t.name)&&void 0!==n?n:""),format:o,percent:null==r?void 0:r.percent,color:null==r?void 0:r.color})}})]})})};class P_ extends w.Component{componentDidMount(){"undefined"!=typeof window&&(this._layoutChart=this.layoutChart.bind(this),window.addEventListener("resize",this._layoutChart))}componentWillUnmount(){"undefined"!=typeof window&&this._layoutChart&&window.removeEventListener("resize",this._layoutChart)}layoutChart(){this.chart&&this.chart.chart_instance&&this.chart.chart_instance.resize()}render(e){let{className:t,data:i,options:n}=e,r=fI()({cutout:"55%",plugins:{legend:{display:!1},tooltip:{boxPadding:3,multiKeyBackground:void 0,callbacks:{labelColor(e){var t,i;let n=e.dataIndex||0,r=null===(t=(null===(i=e.dataset)||void 0===i?void 0:i.backgroundColor)||[])||void 0===t?void 0:t[n];return(0,_._)((0,f._)({},r&&{backgroundColor:r}),{borderWidth:1,borderColor:"white"})}}}}},n);return(0,Z.tZ)("div",{className:t||"",children:(0,Z.tZ)(fP,{plugins:[{id:"custom_label_plugin",afterDatasetDraw:e=>{if(!this.props.label)return;let t=Array.isArray(this.props.label)?this.props.label[0]:this.props.label;if(!t)return;let i=e.canvas.getContext("2d");if(!i){console.warn("could not get 2d context");return}i.fillStyle="#565656",i.textAlign="center",i.textBaseline="middle",i.font='100 48px "Helvetica Neue", Helvetica, Arial, sans-serif',i.fillText(t,e.chartArea.width/2,e.chartArea.height/2-16);let n=Array.isArray(this.props.label)&&this.props.label[1]?this.props.label[1]:null;n&&(i.font='bold 18px "Helvetica Neue", Helvetica, Arial, sans-serif',i.fillText(n,e.chartArea.width/2,e.chartArea.height/2+16))}}],ref:this.assignChart,type:"doughnut",data:i,options:r,style:{maxHeight:450}})})}constructor(...e){super(...e),(0,M._)(this,"_layoutChart",void 0),(0,M._)(this,"chart",void 0),(0,M._)(this,"assignChart",e=>{this.chart=e})}}var PZ=i(88426);let Pw=e=>{let{active:t,payload:i,label:n,format:r="number",totalLabel:o}=e;if(!t||!i||0===i.length)return null;let a=i.reduce((e,t)=>{var i;return e+(null!==(i=t.value)&&void 0!==i?i:0)},0);return(0,Z.tZ)(fw.W,{children:(0,Z.BX)(fy,{children:[(0,Z.tZ)(fm,{label:n}),(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(ff,{children:(0,Z.tZ)(PC,{payload:i,format:r})}),(0,Z.tZ)(fg,{total:a,label:o})]})})},PC=e=>{let{payload:t,format:i}=e;return t&&0!==t.length?(0,Z.tZ)(Z.HY,{children:t.map(e=>{var n;let r=(0,ma.L)(void 0!==e.value?e.value:0,i,"currency"===i?"USD":void 0);return(0,Z.BX)(f_,{children:[(0,Z.tZ)(fb,{color:null!==(n=e.color)&&void 0!==n?n:y3.accent}),(0,Z.BX)(fZ,{children:[(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:t.length>1&&"".concat(e.name)}),(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"primary",children:r})]})]})})}):null},Px=e=>{let{data:t,loading:i,format:n="number",colors:r,height:o=y7.CHART_HEIGHT}=e,{axisFormat:a,tooltipFormat:l}=fu(n),{datasetLabels:s,transformedData:d}=fp(t);return 0===d.length?null:i?(0,Z.tZ)(et.M5,{height:o,children:(0,Z.tZ)(iI.$j,{})}):(0,Z.tZ)(yG.h,{height:o,children:(0,Z.BX)(PZ.c,{data:d,margin:y7.CHART_MARGIN,reverseStackOrder:!0,children:[(0,Z.tZ)(yQ.q,{stroke:y3.detail,opacity:.5}),(0,Z.tZ)(y$.K,{dataKey:"name",tick:e=>(0,Z.tZ)(fa,(0,f._)({},e)),axisLine:{stroke:y3.axis},tickLine:{stroke:y3.axis},minTickGap:y7.X_AXIS_MIN_TICK_GAP,tickMargin:y7.X_AXIS_TICK_MARGIN,tickSize:y7.TICK_SIZE}),(0,Z.tZ)(y0.B,{domain:e=>{let[t,i]=e;return function(e,t,i){let n=Math.min(...e.map(e=>Number(e[t[0]]||0))),r=.1*(i-n);return[Math.max(n-r,0),i+r]}(d,s,i)},allowDataOverflow:!0,tick:(0,Z.tZ)(fl,{format:a}),axisLine:{stroke:y3.axis},tickLine:{stroke:y3.axis},minTickGap:y7.Y_AXIS_MIN_TICK_GAP,tickMargin:y7.Y_AXIS_TICK_MARGIN,tickSize:y7.TICK_SIZE,padding:y7.Y_AXIS_PADDING,scale:"linear"}),(0,Z.tZ)(y1.u,{cursor:(0,Z.tZ)(ft,{fill:y3.cursor}),isAnimationActive:!1,content:e=>(0,Z.tZ)(Pw,{active:e.active,payload:e.payload,label:e.label,format:l}),showLegend:!0}),(0,Z.tZ)("defs",{children:s.map((e,t)=>(0,Z.tZ)(fn,{color:y9(e,r),index:t},"gradient-".concat(t)))}),s.slice().reverse().map((e,t)=>{let i=s.length-1-t;return(0,Z.tZ)(y4.u,{dataKey:e,fill:"url(#gradient-".concat(i,")"),stroke:y9(e,r),strokeWidth:2,type:"monotone",activeDot:{r:4},isAnimationActive:!1,stackId:1},"line-".concat(i))})]})})};function PS(){let e=(0,G._)(["Total: ",""]);return PS=function(){return e},e}let Pk=e=>{let{pub:t}=e,{iString:i,iTemplate:n}=(0,Q.M1)(),{getConfigFor:r}=(0,io.xR)(),o=!!r("enable_recharts"),a=[{id:0,label:i("Gross annualized revenue"),name:"arr",url:"/api/v1/publication/stats/arr/timeseries",colors:[gb.h1],stacked:!1,format:"currency"},{id:1,label:i("Paid subscribers"),name:"subscribers",url:"/api/v1/publication/stats/subscribers/timeseries",colors:[gb.di,gb.sj,gb.Zr,gb.g,gb.B_,gb.di],stacked:!0,format:"number",suffix:"subscribers"},{id:2,label:i("All subscribers"),name:"emails",url:"/api/v1/publication/stats/emails/timeseries",colors:[gb.h1],stacked:!1,format:"number",suffix:"emails"},{id:3,label:i("Followers"),name:"followers",url:"/api/v1/publication/stats/followers/timeseries",colors:[gb.h1],stacked:!1,format:"number",suffix:"followers"}],l=[{id:0,label:i("30 days"),fromDate:(0,H.Z)().subtract(30,"day")},{id:1,label:i("90 days"),fromDate:(0,H.Z)().subtract(90,"day")},{id:2,label:i("180 days"),fromDate:(0,H.Z)().subtract(180,"day")},{id:3,label:i("1 year"),fromDate:(0,H.Z)().subtract(1,"year")},{id:4,label:i("All time"),fromDate:(0,H.Z)().subtract(10,"year")}],[s,d]=(0,A.eJ)(2*!t.plans),[c,u]=(0,A.eJ)(l[1].id),[p,h]=(0,A.eJ)(null),[m,g]=(0,A.eJ)([]),[v,b]=(0,A.eJ)(!0),[y,f]=(0,A.eJ)(o),_=(0,A.sO)({}),w=(0,A.sO)({}),C=(0,A.sO)(null);(0,A.d4)(()=>{(async(e,t)=>{let i;let n=a.find(t=>t.id===e),r=l.find(e=>e.id===t);if(!n||!r)return;b(!0);let o=r.fromDate.toISOString(),s="".concat(n.url,"?from=").concat(o);if(_.current[s]){h(_.current[s]),b(!1);return}let d=Math.random();C.current=d,h(null);let c=w.current[s];try{let e=c;c||(e=N().get(s),w.current[s]=e),i=(await e).body}catch(e){i=e}if(c||(delete w.current[s],i instanceof Error||(_.current[s]=i)),C.current===d&&(h(i),b(!1)),1===e)try{let e=await N().get("/api/v1/publication/stats/subscribers/timeseries/tooltips?from=".concat(o));e.body&&g(e.body)}catch(e){}})(s,c)},[s,c]);let x=a.find(e=>e.id===s),S=l.find(e=>e.id===c);if(!x||!S)return(0,Z.tZ)("div",{children:i("Error")});let k=[["date","count"]];for(let e=S.fromDate.max(t.created_at);e.isBeforeNow();e=e.add(1,"day"))k.push([e.subtract(1,"day").format("YYYY/MM/DD"),0]);let B=function(e){let t=e.slice(Math.floor(e.length*(3/4))),i=Math.max(...e)-Math.min(...e);return!t.map(t=>t<Math.min(...e)+i/4).some(e=>e)}((p||k).slice(1).map(e=>e[1]));return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(PT,{tabs:a,tab:x,tabId:s,setTabId:d,range:S,ranges:l,setRangeId:u,timeseries:p,loading:v}),(0,Z.tZ)(dr,{children:p instanceof Error?(0,Z.tZ)(du,{children:(0,Z.tZ)(tp._Y,{icon:(0,Z.tZ)(eL.Z,{}),title:(0,Y.zx)(p),text:i("Please try reloading the page")})}):p&&p.length<=1?(0,Z.tZ)(ds,{}):(0,Z.BX)(Z.HY,{children:[y?x.stacked?(0,Z.BX)(PI,{children:[(0,Z.tZ)(Px,{data:p||k,loading:v,format:x.format,colors:y6,height:400}),!v&&(0,Z.tZ)(ZK,{pub:t})]}):(0,Z.BX)(PI,{children:[(0,Z.tZ)(fS,{data:p||k,loading:v,format:x.format,height:400}),!v&&(0,Z.tZ)(ZK,{pub:t})]}):(0,Z.tZ)(et.hs,{className:"subscriber-line-chart",style:{position:"relative",height:"434px"},children:(0,Z.tZ)(fE,{className:v?"loader-big":"",data:p||k,colors:x.colors,noLegend:!0,watermarkText:(0,en.SVA)(t).replace(/^https?:\/\//,"").replace(".localhost:5000","").toUpperCase(),watermarkPosition:B?"bottom":"top",dataLoaded:!!p,stacked:x.stacked,datasetFiller:e=>0===e||p&&e===p[0].length-2?"origin":void 0,options:{plugins:{tooltip:{callbacks:{footer:e=>{if(1===x.id)return n(PS(),(0,er.numberToString)(e[e.length-1].raw))},afterLabel:(null==m?void 0:m.length)?e=>{for(let t of m)if(e.dataset.label===t.dataset&&(0,H.Z)(e.label).isBetween(t.fromDate,t.toDate,"day","[]"))return t.message}:void 0}}}}})}),o&&(0,Z.tZ)(PB,{setShowRecharts:f,showRecharts:y})]})})]})},PB=e=>{let{setShowRecharts:t,showRecharts:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(tX.iz,{paddingY:8}),(0,Z.BX)(et.X2,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.BX)(et.X2,{gap:8,alignItems:"center",children:[(0,Z.tZ)(nA.Z,{size:18}),(0,Z.tZ)(tA.__,{children:n("New charts")}),(0,Z.tZ)(d_.Vp,{theme:"accent",children:n("Beta")})]}),(0,Z.tZ)(i2.ZP,{size:"sm",checked:i,onChange:()=>t(!i)})]})]})},PT=e=>{let{tabs:t,tab:i,tabId:n,setTabId:r,range:o,ranges:a,setRangeId:l,timeseries:s,loading:d}=e,{iString:c}=(0,Q.M1)(),u=e=>{l(e)},p=e=>{window.open("".concat(e.url,"?from=").concat((0,H.Z)().subtract(10,"year").toISOString(),"&format=csv"))};return(0,Z.BX)(et.X2,{gap:8,direction:{desktop:"row",mobile:"column"},children:[(0,Z.tZ)(et.X2,{flex:"grow",children:(0,Z.tZ)(tx.Z,{tabs:t.map(e=>({value:e.id,label:e.label})),value:n,onChange:e=>{var i;(0,U.j)(U.FP.SUBSCRIBER_SUMMARY_TAB_CHANGED,{tab_viewed:null===(i=t.find(t=>t.id===e))||void 0===i?void 0:i.name}),r(e)}})}),(0,Z.BX)(et.X2,{flex:"auto",gap:8,children:[(0,Z.tZ)(oY.i,{value:o.label,onChange:e=>{var t;let i=e.target.value,n=null===(t=a.find(e=>e.label===i))||void 0===t?void 0:t.id;"number"==typeof n&&u(n)},children:a.map(e=>(0,Z.tZ)("option",{value:e.label,children:e.label},"range-".concat(e.id)))}),(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{priority:"secondary-outline",disabled:!s||s.length<=7||d,children:(0,Z.tZ)(pu.Z,{size:20})}),children:(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(nP.Z,{}),onClick:()=>p(i),children:c("Download CSV")})})]})]})},PI=(0,sx.zo)({display:"block",position:"relative"}),PN=e=>{let{label:t,color:i,tooltip:n}=e;return(0,Z.tZ)(tW.u,{text:n,children:(0,Z.BX)(et.X2,{gap:8,alignItems:"center",cursor:"pointer",children:[(0,Z.tZ)(fb,{color:i}),(0,Z.tZ)(ei.xv,{children:t})]})})},PP=e=>{let{label:t,total:i}=e;return(0,Z.BX)(et.M5,{position:"absolute",direction:"column",inset:0,pointerEvents:"none",zIndex:-1,children:[(0,Z.tZ)(ei.xv.H1,{fontSize:44,children:(0,ma.L)(null!=i?i:0,"number")}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:t})]})},PE=e=>{var t,i;let{pub:n}=e,{iString:r,language:o}=(0,Q.M1)(),a=[{key:"30 days",label:r("30 days"),value:(0,H.Z)().subtract(30,"day").toISOString()},{key:"90 days",label:r("90 days"),value:(0,H.Z)().subtract(90,"day").toISOString()},{key:"all time",label:r("All time"),value:(0,H.Z)().subtract(100,"year").toISOString()}],l=[];["enabled","paused"].includes(n.payments_state)&&l.push({label:r("Paid"),value:!0}),l.push({label:r("All"),value:!1});let s=null!==(t=a.find(e=>"90 days"===e.key))&&void 0!==t?t:a[a.length-1],d=null!==(i=l.find(e=>e.label===r("All")))&&void 0!==i?i:l[l.length-1],[c,u]=(0,A.eJ)(s),[p,h]=(0,A.eJ)(d),{getConfigFor:m}=(0,io.xR)(),g=!!m("enable_recharts"),[v,b]=(0,A.eJ)(g);(0,A.d4)(()=>{(0,U.j)(U.FP.STATS_PAGE_VIEWED,{type:"network"})},[]);let{data:y,loading:f,error:_}=fM("/api/v1/publication/stats/network_attribution",{time_window:c.key,is_subscribed:p.value}),w={0:{label:r("Substack App"),color:"#FF6719",tooltip:r("People who subscribed via a Substack app surface such as Notes, Chat, or Leaderboards.")},1:{label:r("Other Substack Network"),color:"#FF853D",tooltip:r("People who subscribed via a Substack network feature such as recommendations or referrals.")},2:{label:r("Substack saved credit cards"),color:"#FFA567",tooltip:r("People who subscribed in one click because they already had a card on file with Substack.")},3:{label:r("Substack existing accounts"),color:"#FFC598",tooltip:r("People who subscribed more easily because they already had a Substack account.")},4:{label:r("Imported accounts"),color:"#888888",tooltip:r("People whose information you imported.")},5:{label:r("New accounts"),color:"#DBDBDB",tooltip:r("People who came directly to your publication.")}},C={labels:(null==y?void 0:y.rows)?y.rows.map(e=>e.label):[],datasets:(null==y?void 0:y.rows)&&y.rows.length?[{data:y&&y.rows.map(e=>e.subs_count),backgroundColor:y&&y.rows.map(e=>w[e.criteria].color),tooltip:y&&y.rows.map(e=>w[e.criteria].tooltip),percent:y&&y.rows.map(e=>e.pct_time_window_total)}]:[]},x=[{key:"label",name:r("Source"),valueFn:e=>{let t=e.label,i=w[e.criteria].color,n=w[e.criteria].tooltip;return(0,Z.tZ)(PN,{label:t,color:i,tooltip:n})}},{key:"subs_count",name:r("Subscribers"),valueFn:e=>(0,er.numberToString)(e.subs_count,{language:o})},{key:"pct_time_window_total",name:r("Percent"),valueFn:e=>{let t=(0,er.numberToString)(100*e.pct_time_window_total,{language:o});return(0,er.formatPercentForDisplay)(t)}}],S=(null==p?void 0:p.value)?r("What percent of your paid subscribers came from the Substack network?"):r("What percent of your subscribers came from the Substack network?");return(0,Z.BX)(dp,{children:[(0,Z.tZ)(d6,{title:r("Network effect"),subtitle:S,action:(0,Z.BX)(dm,{children:[(0,Z.tZ)(oY.i,{onChange:e=>{let t=a.find(t=>t.key===e.currentTarget.value);t&&u(t)},value:null==c?void 0:c.key,children:a.map(e=>(0,Z.tZ)("option",{value:e.key,children:e.label},e.key))}),l.length>1&&(0,Z.tZ)(oY.i,{onChange:e=>{let t=l.find(t=>String(t.value)===e.currentTarget.value);t&&h(t)},value:String(null==p?void 0:p.value),children:l.map(e=>(0,Z.tZ)("option",{value:String(e.value),children:e.label},String(e.value)))})]}),children:(0,Z.BX)(dr,{children:[(0,Z.tZ)(fA,{hasAvailableData:!!C.datasets.length,loading:f,empty:(0,Z.tZ)(u0,{icon:(0,Z.tZ)(Pp.Z,{}),title:r("No network data"),text:r("No data available within your selected time window")}),error:_,children:v?(0,Z.BX)(ts.xu,{position:"relative",zIndex:1,children:[(0,Z.tZ)(Pf,{data:C,loading:f}),!f&&(0,Z.tZ)(PP,{label:r("Subscribers"),total:(null==y?void 0:y.rows)&&y.rows.map(e=>e.subs_count).reduce((e,t)=>e+t,0)})]}):(0,Z.tZ)(P_,{data:C,label:[(null==y?void 0:y.rows)&&(0,er.numberToString)(y.rows.map(e=>e.subs_count).reduce((e,t)=>e+t,0),{language:o}),r("Subscribers")],options:{plugins:{tooltip:{callbacks:{label:e=>{let t=e.chart.data,i=t.labels[e.dataIndex],n=(0,er.numberToString)(t.datasets[e.datasetIndex].data[e.dataIndex],{language:o}),r=y&&y.rows.map(e=>(0,er.numberToString)(100*e.pct_time_window_total,{language:o}))[e.dataIndex];return"".concat(i,": ").concat(n," (").concat((0,er.formatPercentForDisplay)(null!=r?r:0),")")},afterLabel:e=>{var t;return y&&(null===(t=Object.values(w).find(t=>t.label===e.label))||void 0===t?void 0:t.tooltip)||""}}}}}})}),g&&(0,Z.tZ)(PB,{setShowRecharts:b,showRecharts:v})]})}),(0,Z.tZ)(pt,{appendMode:!0,pageSize:20,cols:x,rows:(null==y?void 0:y.rows)||[],loading:f,error:_})]})};function PX(e){let{onApply:t}=e,{iString:i}=(0,Q.M1)(),[n,r]=(0,A.eJ)((0,H.Z)().subtract(10,"years")),[o,a]=(0,A.eJ)((0,H.Z)());return(0,Z.BX)(et.gq,{gap:8,alignItems:"center",children:[(0,Z.tZ)(aT.Mt,{onChange:e=>{let i=e.currentTarget.value?(0,H.Z)(e.currentTarget.value):(0,H.Z)().subtract(1,"month");r(i),t(i,o)},value:n.format("YYYY-MM-DD")}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:i("to")}),(0,Z.tZ)(aT.Mt,{onChange:e=>{let i=e.currentTarget.value?(0,H.Z)(e.currentTarget.value):(0,H.Z)();a(i),t(n,i)},value:o.format("YYYY-MM-DD")})]})}function PM(){let e=(0,G._)([""," selected"]);return PM=function(){return e},e}let PA=e=>{let{pub:t,selectedTotal:i,selectedValues:n,setSelectedValues:r,filterFrom:o,filterTo:a}=e,{iString:l,iTemplate:s}=(0,Q.M1)();return(0,Z.tZ)(ik.H,{expanded:i>0,children:(0,Z.tZ)(et.sg,{paddingBottom:16,children:(0,Z.BX)(da,{children:[(0,Z.BX)(et.X2,{alignItems:"center",gap:12,children:[(0,Z.tZ)(ei.xv.B3,{weight:"medium",children:s(PM(),i)}),(0,Z.tZ)(ee.zx,{priority:"secondary-outline",size:"sm",onClick:()=>r({selectedRowValues:[],dynamicTotal:0}),children:l("Deselect")})]}),(0,Z.tZ)(ee.zx,{priority:"primary-mono",size:"sm",onClick:async()=>{var e;let i=new URL("/api/v1/publication/stats/reader-referrals/subscriber-set",null===(e=document)||void 0===e?void 0:e.location.origin),r=await N().post(i.href).send({from:o?o.toISOString():void 0,to:a?a.toISOString():void 0,user_ids:0===n.dynamicTotal?n.selectedRowValues.map(e=>Number(e)):null});r.body.subscriber_set_id&&(0,Y.uX)((0,j.qYj)(t,{type:"adhoc_email",subscriber_set_id:r.body.subscriber_set_id}),{local_navigation:!1})},children:l("Send email")})]})})})},PD=e=>{var t;let{pub:i}=e,{iString:n,language:r}=(0,Q.M1)();(0,A.d4)(()=>{(0,U.j)(U.FP.STATS_PAGE_VIEWED,{type:"reader-sharing"})},[]);let[o,a]=(0,A.eJ)({selectedRowValues:[],dynamicTotal:0}),[l,s]=(0,A.eJ)(null),[d,c]=(0,A.eJ)((0,H.Z)()),u=new URL("/api/v1/publication/stats/reader-referrals",null===(t=document)||void 0===t?void 0:t.location.origin);l&&u.searchParams.set("from",l.format()),d&&u.searchParams.set("to",d.format());let p=[{key:"referrer_email",name:n("Subscriber"),sortable:!1,valueFn:e=>{var t,n,r,o,a;return(0,Z.tZ)(et.X2,{gap:12,alignItems:"center",children:(0,Z.BX)(sx.A0,{href:(null===(t=e.user)||void 0===t?void 0:t.email)?(0,j.pN7)(i,e.user.email):"javascript:void(0)",children:[(0,Z.tZ)(eG.qE,{photoUrl:(null==e?void 0:null===(n=e.user)||void 0===n?void 0:n.photo_url)||(0,j.I4e)(e.referrer_user_id),size:24}),(0,Z.tZ)(ei.xv,{weight:"medium",children:null!==(a=null===(r=e.user)||void 0===r?void 0:r.name)&&void 0!==a?a:null===(o=e.user)||void 0===o?void 0:o.email})]})})}},{key:"visitors",name:n("Views driven"),hoverText:n("The number of page views driven by this subscriberâ€™s shares"),sortable:!0,valueFn:e=>(0,er.numberToString)(e.visitors,{language:r})},{key:"free_subscribers",name:n("Free subs driven"),hoverText:n("The number of free subscriptions driven by this subscriberâ€™s shares"),sortable:!0,valueFn:e=>(0,er.numberToString)(e.free_subscribers,{language:r})},{key:"paid_subscribers",name:n("Paid subs driven"),hoverText:n("The number of paid subscriptions driven by this subscriberâ€™s shares"),sortable:!0,valueFn:e=>(0,er.numberToString)(e.paid_subscribers,{language:r})}],h={by:"visitors",direction:u8.Desc},m=o.dynamicTotal?o.dynamicTotal:o.selectedRowValues.length;return(0,Z.tZ)(dp,{children:(0,Z.BX)(d6,{title:n("Top sharers"),subtitle:n("See who is sharing your publication and recruiting new subscribers."),action:(0,Z.tZ)(PX,{onApply:(e,t)=>{s(e),c(t),a({selectedRowValues:[],dynamicTotal:0})}}),children:[(0,Z.tZ)(PA,{pub:i,selectedTotal:m,selectedValues:o,setSelectedValues:a,filterFrom:l,filterTo:d}),(0,Z.tZ)(ps,{url:u.href,pageSize:20,cols:p,appendMode:!0,defaultSort:h,selectedValues:o,setSelectedValues:a,getRowKey:e=>{var t;return String((null===(t=e.user)||void 0===t?void 0:t.id)||0)},empty:(0,Z.tZ)(u0,{title:n("No referrals yet"),icon:(0,Z.tZ)(eL.Z,{})})})]})})};var PR=i(67659);function PF(){let e=(0,G._)(["Reader Survey ",""]);return PF=function(){return e},e}function PL(){let e=(0,G._)(["Reader Survey"]);return PL=function(){return e},e}let Pz=e=>{var t,i;let{pub:n}=e,{iString:r,iTemplate:o,iPlural:a}=(0,Q.M1)(),{isLoading:l,result:s}=(0,iS.ib)({pathname:"/api/v1/survey",auto:!0,deps:[n.id],query:{createFirstIfMissing:"true"}}),{isLoading:d,result:c,refetch:u}=(0,iS.ib)({pathname:"/api/v1/survey",auto:!1,method:"POST",json:{title:(null==s?void 0:null===(t=s.surveys)||void 0===t?void 0:t.length)?o(PF(),(null==s?void 0:null===(i=s.surveys)||void 0===i?void 0:i.length)+1):o(PL())}});return(0,to.useEffect)(()=>{c&&(window.location.href="/publish/stats/reader-surveys-editor/".concat(c.id))},[d]),(0,Z.tZ)(dp,{children:(0,Z.tZ)(d6,{title:r("Surveys"),subtitle:r("Create and embed surveys directly into your posts"),action:(0,Z.tZ)(ee.zx,{priority:"primary",disabled:d||l,onClick:()=>{u()},children:r("New survey")}),children:(0,Z.BX)(et.tu,{borderTop:"detail",children:[!l&&(null==s?void 0:s.surveys)&&(null==s?void 0:s.surveys.length)>0&&(null==s?void 0:s.surveys.map(e=>(0,Z.BX)(et.gq,{paddingY:20,alignItems:"center",borderBottom:"detail",gap:16,children:[(0,Z.tZ)(et.M5,{bg:"secondary",width:40,height:40,radius:"sm",outline:"detail",children:(0,Z.tZ)(PR.Z,{size:20,color:"var(--color-fg-secondary)"})}),(0,Z.BX)(et.tu,{flex:"grow",children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",children:e.title}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:(0,Z.tZ)(et.gq,{gap:8,children:(0,Z.tZ)(ei.xv,{children:a("%1 Response","%1 Responses",e.responseCount||0)})})})]}),(0,Z.BX)(et.gq,{gap:8,children:[(0,Z.tZ)(ee.zx,{disabled:d,priority:"secondary-outline",size:"sm",href:"/publish/stats/reader-surveys-editor/".concat(e.id),children:r("Edit")}),(0,Z.tZ)(ee.zx,{disabled:d,priority:"secondary",size:"sm",href:"/publish/stats/reader-surveys-editor/".concat(e.id,"?activeTab=results"),children:r("Results")})]})]}))),!l&&(!(null==s?void 0:s.surveys)||(null==s?void 0:s.surveys.length)===0)&&(0,Z.tZ)(tp.mb,{icon:(0,Z.tZ)(PR.Z,{}),title:r("No surveys yet"),text:r("Create a new survey to get started"),action:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",size:"sm",onClick:()=>{u()},children:r("New survey")})})]})})})},PO=e=>{let{giftsSent:t,giftsAccepted:i,giftsConverted:n,loading:r}=e,{iString:o}=(0,Q.M1)();return(0,Z.BX)(dc,{children:[(0,Z.tZ)(ml,{title:o("Gifts sent"),format:"number-truncated",value:t,loading:r}),(0,Z.tZ)(ml,{title:o("Gifts accepted"),format:"number-truncated",value:i,loading:r}),(0,Z.tZ)(ml,{title:o("Gifts converted"),format:"number-truncated",value:n,loading:r})]})},PU=e=>{let{pub:t}=e,[i,n]=(0,A.eJ)(0),[r,o]=(0,A.eJ)(0),[a,l]=(0,A.eJ)(0),[s,d]=(0,A.eJ)(!0),{iString:c,language:u}=(0,Q.M1)(),p=async()=>{let e=await N().get("/api/v1/publication/stats/referrals/summary");n(e.body.gifts_sent),o(e.body.gifts_accepted),l(e.body.gifts_converted),d(!1)};(0,A.d4)(()=>{(0,U.j)(U.FP.STATS_PAGE_VIEWED,{type:"referrals"}),p()},[]),(0,A.d4)(()=>{var e;(null===(e=t.viralGiftsConfig)||void 0===e?void 0:e.enabled)||(0,Y.uX)("/publish/stats",{replace:!0})},[t]);let h=[{key:"email",name:c("Email"),valueFn:e=>(0,Z.tZ)("a",{href:(0,j.pN7)(t,e.email,{addBase:!0,tab:void 0}),target:"_blank",rel:"noopener",children:e.email})},{key:"last_sent_at",name:c("Last gift sent"),sortable:!0,valueFn:e=>(0,H.Z)(e.last_sent_at).standardDate()},{key:"num_gifts_sent",name:c("Gifts sent"),sortable:!0,valueFn:e=>(0,er.numberToString)(e.num_gifts_sent,{language:u})},{key:"num_gifts_accepted",name:c("Gifts accepted"),sortable:!0,valueFn:e=>(0,er.numberToString)(e.num_gifts_accepted,{language:u})},{key:"num_gifts_converted",name:c("Gifts converted to paid"),sortable:!0,valueFn:e=>(0,er.numberToString)(e.num_gifts_converted,{language:u})},{key:"num_gifts_expired",name:c("Gifts expired"),sortable:!0,valueFn:e=>(0,er.numberToString)(e.num_gifts_expired,{language:u})}],m={by:"num_gifts_accepted",direction:u8.Desc};return(0,Z.BX)(dp,{children:[(0,Z.tZ)(PO,{giftsSent:i,giftsAccepted:r,giftsConverted:a,loading:s}),(0,Z.tZ)(d6,{title:c("Top referrers"),children:(0,Z.tZ)(ps,{url:"/api/v1/publication/stats/referrals/leaderboard",appendMode:!0,pageSize:20,cols:h,defaultSort:m})})]})},PY={stateColor:"stateColor-tg6Klb",isHovered:"isHovered-J5RdAR",stateColor10:"stateColor10-ZkE7xV",stateColor20:"stateColor20-fP898P",stateColor30:"stateColor30-axzTeW",stateColor40:"stateColor40-qKspmr",stateColor50:"stateColor50-ctwe8j",stateColor60:"stateColor60-Mkcp__",stateColor70:"stateColor70-J_Zqu5",stateColor80:"stateColor80-f7Nt9U",stateColor90:"stateColor90-WXjPSo",stateColor100:"stateColor100-uW4wII",mapWrapper:"mapWrapper-ALjZq6",map:"map-qkO5j7",locations:"locations-VKYS7M",overlapWrapper:"overlapWrapper-DvIhsO",hover:"hover-Mal40k",overlap:"overlap-iMe917",icon:"icon-FR3oif",watermark:"watermark-s3qLjx",percent:"percent-YhZm1Y",mapSVG:"mapSVG-Lu0jYu",mapSvg:"mapSVG-Lu0jYu"};function PH(){let e=(0,G._)([""," is read across "," and ","."]);return PH=function(){return e},e}let Pj=e=>{let{pub:t,overlap:i}=e;return(0,Z.BX)(et.gq,{gap:20,justifyContent:"space-between",borderBottom:"detail",paddingY:12,alignItems:"center",children:[(0,Z.BX)(et.gq,{gap:12,alignItems:"center",as:"a",href:t.base_url,className:PY.overlap,children:[(0,Z.tZ)(sC.wk,{size:24,pub:t}),(0,Z.tZ)(ei.xv.B4,{weight:"semibold",children:t.name})]}),(0,Z.BX)(ei.xv.B4,{children:[i,"%"]})]})},PJ=e=>{let{pub:t}=e,{SVGMap:n,SVGMapOfUSA:r,SVGMapOfWorld:o,countryNames:a={},stateNames:l={}}=(0,iS.Wf)(async()=>{let e=await i.e("5571").then(i.bind(i,21812)),t=await i.e("553").then(i.bind(i,43015)),n=await i.e("4139").then(i.t.bind(i,36211,23)),r=t.default.locations.reduce((e,t)=>(e[t.id]=t.name,e),{}),o=e.default.locations.reduce((e,t)=>(e[t.id]=t.name,e),{});return{SVGMapOfUSA:e.default,SVGMapOfWorld:t.default,SVGMap:n.SVGMap,stateNames:o,countryNames:r}},[],{auto:!0,initialResult:null}).result||{},[s,d]=(0,A.eJ)("lifetime"),[c,u]=(0,A.eJ)("free signups"),[p,h]=(0,A.eJ)("usa"),{result:m,isLoading:g}=(0,iS.ib)({pathname:"/api/v1/publication/stats/audience_insights/location",auto:!0,query:{time_window:s,metric:c,granularity:p},deps:[s,c,p]}),v="usa"===p?r:o,{result:b,isLoading:y}=(0,iS.ib)({pathname:"/api/v1/publication/stats/audience_insights/overlap",query:{limit:6},auto:!0,deps:[]}),{result:f}=(0,iS.ib)({pathname:"/api/v1/publication/stats/audience_insights/location/total",auto:!0,deps:[]}),{iTemplate:_,iString:w,iPlural:C}=(0,Q.M1)(),[x,S]=(0,A.eJ)(null),[B,T]=(0,A.eJ)(!1),I=(0,A.sO)(null),{locationMap:N,max:P,total:E}=(0,A.Ye)(()=>{let e=m?m.reduce((e,t)=>(e[t.location.toLowerCase()]=t.value,e),{}):{};return{locationMap:e,max:m?Math.max(...m.map(e=>e.value)):0,total:m?m.reduce((e,t)=>e+t.value,0):0}},[m]),X="";if(f){let e=C("%1 US state","%1 US states",f.usa.locations),i=C("%1 country","%1 countries",f.global.locations);X=_(PH(),t.name,e,i)}return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(d6,{title:w("Audience location"),subtitle:f?X:"...",action:(0,Z.BX)(dm,{children:[(0,Z.BX)(oY.i,{value:s,disabled:g,onChange:e=>d(e.currentTarget.value),children:[(0,Z.tZ)("option",{value:"last 30d",children:w("30 days")}),(0,Z.tZ)("option",{value:"last 90d",children:w("90 days")}),(0,Z.tZ)("option",{value:"lifetime",children:w("All time")})]}),(0,Z.BX)(oY.i,{value:p,disabled:g,onChange:e=>h(e.currentTarget.value),children:[(0,Z.tZ)("option",{value:"usa",children:w("US")}),(0,Z.tZ)("option",{value:"global",children:w("Global")})]}),(0,Z.BX)(oY.i,{value:c,disabled:g,onChange:e=>u(e.currentTarget.value),children:[(0,Z.tZ)("option",{value:"free signups",children:w("All")}),(0,Z.tZ)("option",{value:"paid subscribers",children:w("Paid only")})]})]}),children:(0,Z.tZ)(dr,{children:(0,Z.BX)(et.hs,{direction:{desktop:"row",mobile:"column"},gap:24,paddingTop:8,children:[n&&v?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(et.hs,{className:PY.map,onMouseMove:e=>{I.current&&(I.current.style.top="".concat((null==e?void 0:e.clientY)+20,"px"),I.current.style.left="".concat(null==e?void 0:e.clientX,"px"))},onMouseEnter:()=>{T(!0)},onMouseLeave:()=>{T(!1)},children:(0,Z.tZ)(n,{className:PY.mapSVG,map:v,locationClassName:e=>{let t=N[e.id]||0,i=10*Math.floor(Math.log(t)/Math.log(P)*100/10)||10;return k()(PY.stateColor,{[PY["stateColor".concat(i)]]:t>0})},onLocationMouseOver:e=>{S(e.target.id)},onLocationMouseOut:e=>{"svg"===e.toElement.tagName&&S(null)}})}),x&&B&&(0,Z.tZ)(et.gq,{ref:I,id:"audience_insights_hover",padding:8,className:PY.hover,children:(0,Z.BX)(ei.xv.B4,{color:"bg-light",children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",color:"bg-light",as:"span",children:"global"===p?a[x]:l[x]}),N[x]?(0,er.truncateNumber)(N[x]):w("No")," ",1===N[x]&&c===w("paid subscribers")?w("paid subscriber"):w(1===N[x]&&"paid subscribers"!==c?"subscriber":"paid subscribers"===c?"paid subscribers":"subscribers")]})})]}):(0,Z.tZ)(et.tu,{className:PY.map,paddingTop:64,alignItems:"center",justifyContent:"center",gap:12,children:(0,Z.tZ)(Id.Z,{className:PY.icon})}),(0,Z.BX)(et.tu,{className:PY.locations,paddingTop:12,children:[(0,Z.BX)(et.gq,{justifyContent:"space-between",borderBottom:"detail",paddingY:12,children:[(0,Z.tZ)(ei.xv.Meta,{weight:"semibold",children:w("global"===p?"Country":"State")}),(0,Z.tZ)(ei.xv.Meta,{weight:"semibold",translated:!0,children:"Subscribers"})]}),m&&m.length?(0,Z.BX)(Z.HY,{children:[m.slice(0,5).map(e=>{let t=e.value||0,i=Math.round(t/E*100);return(0,Z.BX)(et.gq,{justifyContent:"space-between",borderBottom:"detail",paddingY:12,children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",children:"global"===p?a[e.location.toLowerCase()]:l[e.location.toLowerCase()]}),(0,Z.tZ)(tW.u,{text:"".concat((0,er.numberToString)(t)," Subscribers"),preferPlacement:"top-center",children:(0,Z.BX)(ei.xv.B4,{className:PY.percent,children:[i,"%"]})})]})}),(0,Z.tZ)(et.gq,{justifyContent:"end",paddingTop:4,children:(0,Z.tZ)(ei.xv.Meta,{className:PY.watermark,children:t.base_url.replace(/https?:\/\//g,"").toUpperCase()})})]}):g?(0,Z.tZ)(dl,{}):(0,Z.tZ)(et.tu,{padding:72,children:(0,Z.tZ)(tp._Y,{icon:(0,Z.tZ)(yj.Z,{}),title:w("No data yet"),text:w("Location data will appear here.")})})]})]})})}),(0,Z.tZ)(d6,{title:w("Audience overlap"),subtitle:w("Substacks with overlapping audiences make great collaborators."),action:(0,Z.tZ)(ee.zx,{priority:"secondary-outline",href:"https://on.substack.com/p/collaboration?utm_source=".concat(J.b3.audienceInsights,"&utm_medium=").concat(J.lP.web),children:w("Learn more")}),children:(0,Z.BX)(dr,{children:[(0,Z.BX)(et.gq,{justifyContent:"space-between",borderBottom:"detail",paddingY:12,children:[(0,Z.tZ)(ei.xv.Meta,{weight:"semibold",translated:!0,children:"Publication"}),(0,Z.tZ)(ei.xv.Meta,{weight:"semibold",translated:!0,children:"Overlap"})]}),b&&b.length?b.map(e=>(0,Z.tZ)(Pj,{pub:e.pub,overlap:Math.round(100*e.percentOverlap)})):y?(0,Z.tZ)(dl,{}):(0,Z.tZ)(et.sg,{padding:72,children:(0,Z.tZ)(tp._Y,{icon:(0,Z.tZ)(ph.Z,{}),title:w("No overlap data yet"),text:w("Overlap data will appear here.")})})]})})]})};var PV=i(4545),Pq=i(64963);let PW=e=>{let{payload:t=[]}=e;return(null==t?void 0:t.length)?(0,Z.tZ)(et.M5,{gap:20,children:t.map(e=>(0,Z.BX)(et.M5,{gap:8,alignItems:"center",children:[(0,Z.tZ)(fb,{color:e.color}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:e.value})]},e.value))}):null};function PG(e){return(0,A.Ye)(()=>{var t,i,n;if(!e||!e.labels||!e.datasets||0===e.datasets.length)return{datasetLabels:[],transformedData:[],dataSetColors:[],dataSetStackIds:[]};let{labels:r,datasets:o}=e,a=o.map((e,t)=>e.label||"Dataset ".concat(t+1)),l=o.map(e=>e.color||y3.accent),s=o.map(e=>e.stack||""),d=(t=r,i=o,n=a,t.map((e,t)=>{var r;let o={name:(r=e)instanceof Date?fh.format(r)||r.toString():"string"==typeof r&&/^\d{4}[-/]\d{1,2}[-/]?\d{0,2}/.test(r)?fh.format(new Date(r.split("T")[0]||r))||r:String(r)};return i.forEach((e,i)=>{let r=n[i];r&&(o[r]=t<e.data.length&&e.data[t]||0)}),o}));return{datasetLabels:a,dataSetColors:l,dataSetStackIds:s,transformedData:d}},[e])}let PK=e=>{let{data:t,loading:i,showLegend:n=!0,format:r="number",height:o=440}=e,{axisFormat:a,tooltipFormat:l}=fu(r),{datasetLabels:s,dataSetColors:d,dataSetStackIds:c,transformedData:u}=PG(t),{iString:p}=(0,Q.M1)();return 0===u.length?null:i?(0,Z.tZ)(et.M5,{height:o,children:(0,Z.tZ)(iI.$j,{})}):(0,Z.tZ)(yG.h,{height:o,children:(0,Z.BX)(PZ.c,{data:u,margin:y7.CHART_MARGIN,barGap:0,style:{cursor:"pointer"},children:[(0,Z.tZ)(yQ.q,{stroke:y3.detail,opacity:.5,vertical:!1}),(0,Z.tZ)(y$.K,{dataKey:"name",tick:e=>(0,Z.tZ)(fa,(0,f._)({},e)),axisLine:{stroke:y3.axis},tickLine:{stroke:y3.axis},minTickGap:y7.X_AXIS_MIN_TICK_GAP,tickMargin:y7.X_AXIS_TICK_MARGIN,tickSize:y7.TICK_SIZE,padding:y7.X_AXIS_PADDING}),(0,Z.tZ)(y0.B,{tick:(0,Z.tZ)(fl,{format:a}),axisLine:{stroke:y3.axis},tickLine:{stroke:y3.axis},minTickGap:y7.Y_AXIS_MIN_TICK_GAP,tickMargin:y7.Y_AXIS_TICK_MARGIN,tickSize:y7.TICK_SIZE,padding:y7.Y_AXIS_PADDING}),(0,Z.tZ)(PV.d,{y:0,stroke:y3.detail}),(0,Z.tZ)(y1.u,{isAnimationActive:!1,cursor:{fill:y3.cursor,opacity:.2},content:e=>{var t;let i=null===(t=e.payload)||void 0===t?void 0:t.filter(e=>"netValue"!==e.dataKey);return(0,Z.tZ)(Pw,{active:e.active,payload:null!=i?i:[],label:e.label,format:l,totalLabel:p("Net")})}}),n&&(0,Z.tZ)(y2.D,{content:e=>(0,Z.tZ)(PW,(0,f._)({},e)),wrapperStyle:{padding:"var(--size-12) 0"}}),s.map((e,t)=>(0,Z.tZ)(Pq.$,{dataKey:e,fill:null==d?void 0:d[t],stackId:null==c?void 0:c[t],isAnimationActive:!1,barSize:32,style:{transition:"var(--animate-hover)"}},"bar-".concat(t)))]})})};var PQ=i(5463);let P$=e=>{let{comparison:t}=e,{iString:i}=(0,Q.M1)();switch(t){case"average":return(0,Z.tZ)(d_.Vp,{theme:"default",leading:(0,Z.tZ)(eE.Z,(0,f._)({},d_.NH)),children:i("Average")});case"above_average":return(0,Z.tZ)(d_.Vp,{theme:"success",leading:(0,Z.tZ)(rf.Z,(0,f._)({},d_.NH)),children:i("Above average")});case"below_average":return(0,Z.tZ)(d_.Vp,{theme:"default",leading:(0,Z.tZ)(PQ.Z,(0,f._)({},d_.NH)),children:i("Below average")});default:return null}},P0=e=>{let{}=e,{iString:t}=(0,Q.M1)(),{getConfigFor:i}=(0,io.xR)(),n=!!i("enable_recharts"),[r,o]=(0,A.eJ)(n);(0,A.d4)(()=>{(0,U.j)(U.FP.STATS_PAGE_VIEWED,{type:"paid_subscriber_growth"})},[]);let a=[{label:t("Daily"),value:"day"},{label:t("Weekly"),value:"week"},{label:t("Monthly"),value:"month"}],[l,s]=(0,A.eJ)((0,H.Z)().startOf("week").subtract(7,"week").toDate()),[d,c]=(0,A.eJ)(new Date),[u,p]=(0,A.eJ)(a[1]),{result:h,error:m,isLoading:g}=(0,iS.ib)({pathname:"/api/v1/publication/stats/paid_subscriber_growth",query:{start:(0,H.Z)(l).toISOString(),end:(0,H.Z)(d).toISOString(),period:u.value},auto:!0,deps:[l,d,u]});if(!h)return(0,Z.tZ)(dl,{});let{subscriberGrowth:v,heroStat:b}=h,y={labels:r?v.map(e=>e.dt):v.map(e=>"day"===u.value?(0,H.Z)(e.dt).format("ddd MMM D, YYYY"):"week"===u.value?"".concat((0,H.Z)(e.dt).format("MMM D")," - ").concat((0,H.Z)(e.dt).add(6,"day").format("MMM D, YYYY")):(0,H.Z)(e.dt).format("MMM YYYY")),datasets:[{label:t("New"),data:v.map(e=>e.total_new_subs-e.num_upgrades-e.num_free_trials),color:y5.paid,backgroundColor:"#38775E",stack:"1"},{label:t("Upgrades"),data:v.map(e=>e.num_upgrades),color:y5.upgrade,backgroundColor:"#53D09C",stack:"1"},{label:t("Trials"),data:v.map(e=>e.num_free_trials),color:y5.trial,backgroundColor:"#AEE7CE",stack:"1"},{label:t("Expirations"),data:v.map(e=>e.num_expirations),color:y5.expired,backgroundColor:"#FF6B6B",stack:"2"}]};return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(d6,{title:t("Paid audience growth"),subtitle:t("How fast your paid audience is growing and retaining."),children:(0,Z.BX)(et.sg,{gap:12,children:[(0,Z.tZ)(P1,{period:u,periods:a,start:l,end:d,setPeriod:p,setStart:s,setEnd:c}),!!b&&(0,Z.tZ)(et.gq,{justifyContent:"space-between",alignItems:"end",children:(0,Z.tZ)(ml,{title:t("Paid growth rate"),value:(null==b?void 0:b.growth_rate)||0,format:"percent",tooltip:t("Percentage of subscribers who went from free to paid in the last 30 days. Comparisons are based on publications with similar subscriber counts."),description:_p()(b.period),renderDelta:()=>(0,Z.tZ)(P$,{comparison:null==b?void 0:b.comparison_outcome})})}),(0,Z.tZ)(dr,{children:(0,Z.BX)(fA,{hasAvailableData:(null==y?void 0:y.labels.length)>0&&!!y,loading:g,error:!!m,children:[r?(0,Z.tZ)(PK,{data:y,showLegend:!0,format:"number"}):(0,Z.tZ)(ZI,{data:y,legendPosition:"top",legendAlignment:"start",tooltipLabels:[t("Upgrades"),t("New"),t("Trials"),t("Unsubscribes"),t("Expirations")],includeLineLabel:!1,colors:Object.values(y5),stacked:!0,labelOptions:{boxWidth:8,padding:16,usePointStyle:!0,pointStyle:"circle"},options:{plugins:{tooltip:{callbacks:{title:e=>e[0].label}}}}}),n&&(0,Z.tZ)(PB,{setShowRecharts:o,showRecharts:r})]})})]})})})},P1=e=>{let{period:t,periods:i,start:n,end:r,setPeriod:o,setStart:a,setEnd:l}=e,{iString:s}=(0,Q.M1)(),d=(0,A.Ye)(()=>ip()(e=>{(0,H.Z)(e).isValid()&&a((0,H.Z)(e).toDate())}),[a]),c=(0,A.Ye)(()=>ip()(e=>{(0,H.Z)(e).isValid()&&l((0,H.Z)(e).toDate())}),[l]);return(0,Z.BX)(dh,{children:[(0,Z.BX)(oY.i,{value:null==t?void 0:t.value,onChange:e=>{var t;o(null!==(t=i.find(t=>t.value===e.currentTarget.value))&&void 0!==t?t:i[0])},children:[(0,Z.tZ)(oY.d,{children:s("Select period")}),i.map(e=>(0,Z.tZ)("option",{value:e.value,children:e.label},e.value))]}),(0,Z.BX)(dm,{children:[(0,Z.tZ)(aT.Mt,{value:n,onChange:e=>d(e.currentTarget.value)}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:s("to")}),(0,Z.tZ)(aT.Mt,{value:r,onChange:e=>c(e.currentTarget.value)})]})]})},P2=e=>{var t,i;let{pub:n,setHideSummaries:r}=e,{iString:o}=(0,Q.M1)(),{result:a,isLoading:l,error:s}=(0,iS.ib)({pathname:"/api/v1/publication/stats/paid_subscriber_growth/summary",auto:!0,deps:[n]});s&&r(!0);let d=(null==a?void 0:a.period)?(null==a?void 0:null===(t=a.period)||void 0===t?void 0:t.charAt(0).toUpperCase())+(null==a?void 0:null===(i=a.period)||void 0===i?void 0:i.slice(1)):null;return(0,Z.tZ)(et.tu,{flex:"grow",children:(0,Z.tZ)(ml,{title:o("Paid growth rate"),value:(null==a?void 0:a.growth_rate)||0,format:"percent",tooltip:o("Percentage of subscribers who went from free to paid in the last 30 days. Comparisons are based on publications with similar subscriber counts."),description:d||null,renderDelta:()=>(0,Z.tZ)(P$,{comparison:null==a?void 0:a.comparison_outcome}),flex:"auto",children:!l&&a&&(0,Z.tZ)(P4,{heroStat:a})})})},P4=e=>{let{heroStat:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(tX.iz,{pullX:20}),(0,Z.tZ)(P3,{title:i("New paid subscribers"),value:t.total_new_subs}),(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(P3,{title:i("Expired paid subscriptions"),value:-1*t.num_expirations}),(0,Z.tZ)(tX.iz,{}),(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary",href:"/publish/stats/subscriber-report?detail=growth",children:i("View chart")})]})},P3=e=>{let{title:t,value:i}=e;return(0,Z.BX)(et.gq,{justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.B4,{color:"primary",weight:"semibold",children:t}),(0,Z.tZ)(ei.xv.B4,{color:"primary",children:i})]})},P8="cell-rNCk4X",P6=()=>{var e;let[t,i]=(0,A.eJ)((0,H.Z)().subtract(1,"year").format("YYYY-MM")),[n,r]=(0,A.eJ)((0,H.Z)().startOf("month").format("YYYY-MM")),[o,a]=(0,A.eJ)(12),{iString:l}=(0,Q.M1)();(0,A.d4)(()=>{(0,U.j)(U.FP.STATS_PAGE_VIEWED,{type:"paid_subscriber_retention"})},[]);let{result:s,isLoading:d}=(0,iS.ib)({pathname:"/api/v1/publication/stats/subscriber_retention",query:{start:(0,H.Z)(t).toISOString(),end:(0,H.Z)(n).toISOString(),months:o},auto:!0,deps:[o,t,n]});return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(d6,{title:l("Paid subscriber retention"),subtitle:l("How fast your paid audience is growing and retaining."),children:(0,Z.BX)(et.sg,{gap:12,children:[(0,Z.tZ)(Eh,{startMonth:t,endMonth:n,setStartMonth:i,setEndMonth:r,numMonths:o,setNumMonths:a}),(0,Z.tZ)(g$,{children:d?(0,Z.tZ)(dl,{}):s&&0!==Object.keys(null!==(e=null==s?void 0:s.cohortStats)&&void 0!==e?e:{}).length?(0,Z.tZ)(P5,{result:s,months:o}):(0,Z.tZ)(ds,{})})]})})})},P5=e=>{let{result:t,months:i}=e,n=(0,A.Ye)(()=>{var e;return t?Object.keys(null!==(e=null==t?void 0:t.cohortStats)&&void 0!==e?e:{}).sort((e,t)=>(0,H.Z)(e).isBefore(t)?-1:1):[]},[t]),r=(0,A.Ye)(()=>{var e;return Object.values(null!==(e=null==t?void 0:t.cohortStats)&&void 0!==e?e:{}).reduce((e,t)=>e+t[0].subscribes,0)},[t]);return(0,Z.BX)(ts.xu,{className:"table-Xd1lry",style:{"--months":i},children:[(0,Z.tZ)(P9,{months:i}),n.map(e=>{var n;let o=null==t?void 0:t.cohortStats[e][0].subscribes;return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(Et,{date:e}),(0,Z.tZ)(Ei,{totalSubs:r,subCount:o}),null==t?void 0:null===(n=t.cohortStats[e])||void 0===n?void 0:n.sort((e,t)=>e.months_since_subscription-t.months_since_subscription).concat((null==t?void 0:t.cohortStats[e].length)<i?[...Array(i-(null==t?void 0:t.cohortStats[e].length))]:[]).map(e=>e?(0,Z.tZ)(Er,{stat:e}):(0,Z.tZ)(Ea,{}))]})})]})},P9=e=>{let{months:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(P7,{children:i("Month")}),(0,Z.tZ)(P7,{children:i("New subs")}),[...Array(t).keys()].map(e=>(0,Z.tZ)(P7,{children:e+1}))]})},P7=e=>{let{children:t}=e;return(0,Z.tZ)(Ed,{children:(0,Z.tZ)(Ee,{children:t})})},Ee=e=>{let{children:t}=e;return(0,Z.tZ)(ei.xv.B5,{color:"primary",weight:"medium",size:12,children:t})},Et=e=>{let{date:t}=e;return(0,Z.tZ)(Ec,{children:(0,Z.tZ)(El,{children:new Intl.DateTimeFormat(void 0,{month:"short",year:"numeric"}).format(new Date(t))})})},Ei=e=>{let{totalSubs:t,subCount:i}=e;return(0,Z.BX)(Eu,{children:[(0,Z.tZ)(En,{subCount:i,totalSubs:t}),(0,Z.tZ)(El,{children:null==i?void 0:i.toLocaleString()})]})},En=e=>{let{subCount:t,totalSubs:i}=e;return(0,Z.tZ)(ts.xu,{position:"absolute",className:"bar-nM2xeT",style:{width:"".concat(t?t/i*100:0,"%")}})},Er=e=>{let{stat:t}=e;return(0,Z.BX)(Ep,{children:[(0,Z.tZ)(Eo,{stat:t}),(0,Z.tZ)(El,{color:t.retention_rate>=.75||t.retention_rate<=.2?"white":"primary",children:(0,ma.L)(t.retention_rate,"percent",void 0,void 0,"tag")})]})},Eo=e=>{var t;let{stat:i}=e;return(0,Z.tZ)(ts.xu,{className:"background-J4Y083",style:{opacity:(t=i.retention_rate)>=.5?Math.min(1,(t-.5)*2):Math.min(1,(.5-t)*2),backgroundColor:i.retention_rate>=.5?"var(--color-accent-fg-blue)":"var(--color-accent-fg-red)"}})},Ea=()=>(0,Z.tZ)(Ep,{className:"emptyCell-N6oTBn"}),El=e=>{let{children:t,color:i="primary"}=e;return(0,Z.tZ)(ei.xv.B4,{color:i,children:t})},Es={position:"relative",display:"flex",alignItems:"center",justifyContent:"start",color:"primary",paddingX:12,paddingY:8,gap:8,className:P8},Ed=(0,ts.zo)((0,_._)((0,f._)({},Es),{bg:"primary",className:"headerCell-wc9bed"})),Ec=(0,ts.zo)((0,_._)((0,f._)({},Es),{bg:"primary",borderRight:void 0,className:"dateCell-J1NsZC"})),Eu=(0,ts.zo)((0,_._)((0,f._)({},Es),{className:"subscribersCell-M_5Fgi"})),Ep=(0,ts.zo)((0,_._)((0,f._)({},Es),{className:P8})),Eh=e=>{let{startMonth:t,endMonth:i,setStartMonth:n,setEndMonth:r,numMonths:o,setNumMonths:a}=e,{iString:l}=(0,Q.M1)();return(0,Z.BX)(dh,{children:[(0,Z.BX)(oY.i,{onChange:e=>{let t=parseInt(e.currentTarget.value);a(t),n((0,H.Z)().subtract(t,"months").format("YYYY-MM"))},value:o.toString(),children:[(0,Z.tZ)(oY.d,{children:l("Select period")}),(0,Z.tZ)("option",{value:"6",children:l("6 months")}),(0,Z.tZ)("option",{value:"12",children:l("12 months")}),(0,Z.tZ)("option",{value:"24",children:l("24 months")})]}),(0,Z.BX)(dm,{children:[(0,Z.tZ)(aT.lH,{value:t,onChange:e=>n(e.currentTarget.value)}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:l("to")}),(0,Z.tZ)(aT.lH,{value:i,onChange:e=>r(e.currentTarget.value),max:(0,H.Z)().startOf("month").format("YYYY-MM")})]})]})},Em=e=>{let{isOpen:t,detail:i}=e,n=()=>{(0,B.route)("/publish/stats/subscriber-report")};return(0,Z.tZ)(eK.u_,{onClose:n,isOpen:t,position:"full",children:(0,Z.tZ)(et.tu,{className:"overlay-cZbBXA",children:(0,Z.BX)("div",{className:"contentWrapper-DZPxJU",children:[(0,Z.BX)(et.hs,{justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.H2,{children:"Advanced stats"}),(0,Z.tZ)(ee.hU,{priority:"tertiary",onClick:n,children:(0,Z.tZ)(K.Z,{size:20})})]}),(0,Z.BX)(r7.m,{children:[(0,Z.tZ)(r7.E,{title:"Retention",href:"/publish/stats/subscriber-report?detail=retention",isActive:"undefined"!=typeof window&&"?detail=retention"===window.location.search}),(0,Z.tZ)(r7.E,{title:"Growth",href:"/publish/stats/subscriber-report?detail=growth",isActive:"undefined"!=typeof window&&"?detail=growth"===window.location.search})]}),"retention"===i?(0,Z.tZ)(P6,{}):(0,Z.tZ)(P0,{})]})})})},Eg=e=>{switch(e){case 12:return"1 year";case 6:return"6 months";case 1:return"30 days"}return""};function Ev(){let e=(0,G._)(["Percentage of subscribers who continue to pay over a given period of time. Comparisons are based on publications with similar subscriber counts"]);return Ev=function(){return e},e}function Eb(){let e=(0,G._)(["Average retention at ",""]);return Eb=function(){return e},e}let Ey=e=>{var t,i;let{pub:n,setHideSummaries:r}=e,{result:o,isLoading:a,error:l}=(0,iS.ib)({pathname:"/api/v1/publication/stats/subscriber_retention/summary",auto:!0,deps:[n]}),{iString:s,iTemplate:d}=(0,Q.M1)();l&&r(!0);let c=Eg(null==o?void 0:null===(t=o.heroStat)||void 0===t?void 0:t.months_since_subscription);return(0,Z.tZ)(et.tu,{flex:"grow",children:(0,Z.tZ)(ml,{title:s("Paid subscriber retention"),value:(null==o?void 0:null===(i=o.heroStat)||void 0===i?void 0:i.rate)||0,format:"percent",tooltip:d(Ev()),description:o?d(Eb(),c):null,renderDelta:()=>{var e;return(0,Z.tZ)(P$,{comparison:null==o?void 0:null===(e=o.heroStat)||void 0===e?void 0:e.comparison})},flex:"auto",children:!a&&o&&o.rates&&(0,Z.tZ)(Ef,{retentionSummary:o})})})},Ef=e=>{let{retentionSummary:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(tX.iz,{pullX:20}),(0,Z.tZ)(wF,{categories:t.rates.map(e=>({title:"After ".concat(Eg(e.months_since_subscription)),rate:e.rate}))}),(0,Z.tZ)(tX.iz,{pullX:20}),(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary",href:"/publish/stats/subscriber-report?detail=retention",children:i("View chart")})]})},E_=e=>{let{pub:t,detail:i}=e,[n,r]=(0,A.eJ)(!1);(0,A.d4)(()=>{i||(0,U.j)(U.FP.STATS_PAGE_VIEWED,{type:"subscriber_reports"})},[i]);let{iString:o}=(0,Q.M1)();return(0,Z.BX)(dp,{children:["enabled"===t.payments_state&&!n&&(0,Z.tZ)(d6,{title:o("Summary"),subtitle:o("How well your paid audience is growing and retaining."),children:(0,Z.BX)(dc,{children:[(0,Z.tZ)(Ey,{pub:t,setHideSummaries:r}),(0,Z.tZ)(P2,{pub:t,setHideSummaries:r})]})}),"enabled"===t.payments_state&&n&&(0,Z.tZ)(P0,{}),(0,Z.tZ)(PJ,{pub:t}),(0,Z.tZ)(Em,{pub:t,detail:i,isOpen:!!i})]})};var EZ=i(94831);let Ew=e=>{let{data:t,loading:i,showLegend:n=!1,format:r="number",height:o=y7.CHART_HEIGHT,suffix:a}=e,{axisFormat:l,tooltipFormat:s}=fu(r),{datasetLabels:d,transformedData:c}=PG(t);return 0===c.length?null:i?(0,Z.tZ)(et.M5,{height:o,children:(0,Z.tZ)(iI.$j,{})}):(0,Z.tZ)(yG.h,{height:o,children:(0,Z.BX)(EZ.v,{data:c,margin:y7.CHART_MARGIN,children:[(0,Z.tZ)("defs",{children:(0,Z.tZ)(fr,{color:y3.accent})}),(0,Z.tZ)(yQ.q,{stroke:"var(--color-utility-detail)",opacity:.5,vertical:!1}),(0,Z.tZ)(y$.K,{dataKey:"name",tick:e=>(0,Z.tZ)(fa,(0,f._)({},e)),axisLine:{stroke:y3.axis},tickLine:{stroke:y3.axis},minTickGap:y7.X_AXIS_MIN_TICK_GAP,tickMargin:y7.X_AXIS_TICK_MARGIN,tickSize:y7.TICK_SIZE,padding:y7.X_AXIS_PADDING}),(0,Z.tZ)(y0.B,{tick:(0,Z.tZ)(fl,{format:l}),axisLine:{stroke:y3.axis},tickLine:{stroke:y3.axis},minTickGap:y7.Y_AXIS_MIN_TICK_GAP,tickMargin:y7.Y_AXIS_TICK_MARGIN,tickSize:y7.TICK_SIZE,padding:y7.Y_AXIS_PADDING,scale:"linear"}),(0,Z.tZ)(y1.u,{isAnimationActive:!1,cursor:{fill:y3.cursor,opacity:.2},content:e=>(0,Z.tZ)(fC,{active:e.active,payload:e.payload,label:e.label,format:s,suffix:a})}),n&&(0,Z.tZ)(y2.D,{}),d.map((e,t)=>e?(0,Z.tZ)(Pq.$,{dataKey:e,fill:"url(#gradient)",isAnimationActive:!1,radius:[2,2,0,0],maxBarSize:60},"bar-".concat(t)):null)]})})},EC=e=>e.toISOString().split("T")[0],Ex=e=>{let{start:t,end:i,setStart:n,setEnd:r,minDate:o,maxDate:a,setCategory:l}=e,{iString:s}=(0,Q.M1)();return(0,Z.BX)(dh,{children:[(0,Z.BX)(oY.i,{onChange:e=>l(e.currentTarget.value),children:[(0,Z.tZ)(oY.d,{children:s("Select category")}),(0,Z.tZ)("option",{value:"All",children:s("All Sources")}),(0,Z.tZ)("option",{value:"Substack",children:s("Substack")}),(0,Z.tZ)("option",{value:"Social",children:s("Social")}),(0,Z.tZ)("option",{value:"Search",children:s("Search")}),(0,Z.tZ)("option",{value:"Paid",children:s("Paid")}),(0,Z.tZ)("option",{value:"Referral",children:s("Referral")})]}),(0,Z.BX)(dm,{children:[(0,Z.tZ)(aT.Mt,{value:t,max:a,min:o,onChange:e=>n(e.currentTarget.value)}),(0,Z.tZ)(ei.xv.B3,{color:"secondary",children:s("to")}),(0,Z.tZ)(aT.Mt,{value:i,max:a,min:o,onChange:e=>r(e.currentTarget.value)})]})]})},ES=e=>{let{data:t,loading:i,error:n,chartData:r}=e,{iString:o}=(0,Q.M1)(),{getConfigFor:a}=(0,io.xR)(),l=!!a("enable_recharts"),[s,d]=(0,A.eJ)(l);return(0,Z.BX)(dr,{children:[(0,Z.tZ)(fA,{hasAvailableData:!!t,loading:i,error:n,children:r&&!s?(0,Z.tZ)(ZI,{data:r,legendOptions:{display:!1},tooltipLabelPostfix:o("total views"),options:{plugins:{tooltip:{callbacks:{title:e=>{var t,i;let n=e[0],r=null==n?void 0:null===(t=n.chart)||void 0===t?void 0:t.data;return(0,H.Z)((null==r?void 0:null===(i=r.labels)||void 0===i?void 0:i[n.dataIndex])||new Date,"MMM D, YYYY").format("ddd MMM D, YYYY")}}}}}}):r?(0,Z.tZ)(Ew,{data:r,format:"number",height:400,loading:i,suffix:o("Views")}):null}),l&&(0,Z.tZ)(PB,{setShowRecharts:d,showRecharts:s})]})},Ek=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)();(0,A.d4)(()=>{(0,U.j)(U.FP.STATS_PAGE_VIEWED,{type:"traffic"})},[]);let n=new Date,r=(0,H.Z)(n).subtract(90,"day")<(0,H.Z)(t.created_at)?new Date(t.created_at):(0,H.Z)(n).subtract(90,"day").toDate(),o=EC(new Date(t.created_at)),a=EC(n),[l,s]=(0,A.eJ)(EC(r)),[d,c]=(0,A.eJ)(EC(n)),[u,p]=(0,A.eJ)("All"),[h,m]=(0,A.eJ)(!0),[g,v]=(0,A.eJ)(null),[b,y]=(0,A.eJ)(!1);(0,A.d4)(()=>{(async()=>{try{y(!1);let e=await N().get("/api/v1/publication/stats/publication_traffic/timeseries").query({from:l,to:d,category:"All"===u?null:u});v(e.body)}catch(e){y(!0),console.error(e)}finally{m(!1)}})()},[l,d,u]);let f=[{key:"source",name:i("Top Sources"),sortable:!0},{key:"source_category",name:i("Category"),sortable:!1},{key:"views",name:i("Views"),sortable:!0,valueFn:e=>e.views?(0,er.numberToString)(e.views):"n/a"},{key:"users",name:i("Users"),sortable:!0,valueFn:e=>e.users?(0,er.numberToString)(e.users):"n/a"},{key:"free_signup",name:i("Free subscriptions"),sortable:!0,valueFn:e=>e.free_signup?(0,er.numberToString)(e.free_signup):"0"},{key:"subscribed",name:i("Paid subscriptions"),sortable:!0,valueFn:e=>e.subscribed?(0,er.numberToString)(e.subscribed):"0"}],_={by:"views",direction:u8.Desc},w=(0,A.Ye)(()=>{if(!g)return null;let e=null==g?void 0:g.slice(1);return{labels:e.map(e=>e[0]),datasets:[{data:e.map(e=>e[1]),backgroundColor:Array(e.length).fill("#000000")}]}},[g]);return(0,Z.BX)(dp,{children:[(0,Z.tZ)(d6,{title:i("Total traffic"),subtitle:i("The sum of all views to your publication across platforms."),children:(0,Z.BX)(et.sg,{gap:12,children:[(0,Z.tZ)(Ex,{start:l,end:d,setStart:s,setEnd:c,minDate:o,maxDate:a,setCategory:p}),(0,Z.tZ)(ES,{data:g,loading:h,error:b,chartData:w})]})}),(0,Z.tZ)(d6,{title:i("Traffic by source"),subtitle:i("Where views to your publication came from."),children:(0,Z.tZ)(ps,{url:(0,en.n1t)("/api/v1/publication/stats/visitor_sources",{from_date:l,to_date:d,category:"All"===u?null:u}),pageSize:20,appendMode:!0,cols:f,defaultSort:_})})]})},EB=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)();(0,A.d4)(()=>{(0,U.j)(U.FP.STATS_PAGE_VIEWED,{type:"unsubscribes"})},[]);let n=[{key:"email",name:i("Email"),valueFn:e=>(0,Z.tZ)("a",{href:(0,j.pN7)(t,e.email,{addBase:!0,tab:void 0}),target:"_blank",rel:"noopener",children:e.email})},{key:"feedback",name:i("Feedback"),valueFn:e=>e.feedback?e.feedback:"n/a"},{key:"unsubscribed_at",name:i("Unsubscribed on"),sortable:!0,valueFn:e=>(0,H.Z)(e.unsubscribed_at).standardTime()},{key:"cancel_reason_bucket",name:i("Reason"),sortable:!0,valueFn:e=>e.cancel_reason_bucket?rT()(e.cancel_reason_bucket):"n/a"}],r={by:"unsubscribed_at",direction:u8.Desc};return(0,Z.tZ)(dp,{children:(0,Z.tZ)(d6,{title:i("Unsubscribe feedback"),subtitle:i("Feedback left by paid subscribers after canceling their subscriptions."),children:(0,Z.tZ)(ps,{url:"/api/v1/publication/stats/unsubscribes",appendMode:!0,pageSize:20,cols:n,defaultSort:r})})})},ET=e=>{var t;let{pub:i,statType:n}=e,{iString:r}=(0,Q.M1)(),o=[{value:"network",label:r("Network")},{value:"subscriber-report",label:r("Audience")}];return"disabled"!==i.payments_state||i.invite_only||o.push({value:"pledges",label:r("Pledges")}),o.push({value:"reader-sharing",label:r("Sharing")}),(null===(t=i.viralGiftsConfig)||void 0===t?void 0:t.enabled)&&o.push({value:"referrals",label:r("Referrals")}),"enabled"===i.payments_state&&o.push({value:"notes",label:r("Notes")}),o.push({value:"traffic",label:r("Traffic")}),o.push({value:"emails",label:r("Email")}),"enabled"===i.payments_state&&o.push({value:"unsubscribes",label:r("Unsubscribes")}),o.push({value:"reader-surveys",label:r("Surveys")}),(0,Z.tZ)(tx.Z,{tabs:o,value:n,onChange:e=>{(0,B.route)("/publish/stats/".concat(e))}})},EI=e=>{let{pub:t,statType:i,themeVariables:n}=e;(0,A.d4)(()=>{i||"undefined"==typeof window||(0,Y.uX)("/publish/stats/network",{replace:!0})},[i]);let r=(0,pY.XA)(),{iString:o}=(0,Q.M1)();return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)("div",{className:"page typography",id:"stats",children:(0,Z.BX)(dt,{children:[(0,Z.tZ)(di,{title:o("Stats")}),(0,Z.tZ)(et.sg,{alignItems:r?void 0:"start",paddingBottom:16,children:(0,Z.tZ)(ET,{pub:t,statType:i})}),(0,Z.BX)(B.default,{onChange:sn.Uu,children:[(0,Z.tZ)(Ek,{path:"/publish/stats/traffic",pub:t}),(0,Z.tZ)(Pu,{path:"/publish/stats/emails",pub:t}),(0,Z.tZ)(EB,{path:"/publish/stats/unsubscribes",pub:t}),(0,Z.tZ)(PU,{path:"/publish/stats/referrals",pub:t}),(0,Z.tZ)(PE,{path:"/publish/stats/network",pub:t}),(0,Z.tZ)(PD,{path:"/publish/stats/reader-sharing",pub:t}),(0,Z.tZ)(mv,{path:"/publish/stats/pledges",themeVariables:n}),(0,Z.tZ)(mC,{path:"/publish/stats/notes",themeVariables:n}),(0,Z.tZ)(E_,{path:"/publish/stats/subscriber-report",pub:t}),(0,Z.tZ)(Pz,{path:"/publish/stats/reader-surveys",pub:t})]}),(0,Z.tZ)(yH.ZP,{})]})})})};var EN=i(95398),EP=i(78096);let EE={wrapper:"wrapper-Bxcc6h",shareButton:"shareButton-ZHsMsG",questionList:"questionList-QUScbq",tabContainer:"tabContainer-WpS7iY",questionListQuestions:"questionListQuestions-MEhB0C",questionListHeader:"questionListHeader-bDG2yi",saveBar:"saveBar-J4Opgk",saveBarInner:"saveBarInner-togU7b",questionTypeDropdown:"questionTypeDropdown-ePjvwv",dummyTextArea:"dummyTextArea-Kw6TeA",dummyTextBox:"dummyTextBox-kM2OTy",dummyDropdown:"dummyDropdown-Qn92Ko",dummyCheckbox:"dummyCheckbox-bDLGTO",questionResults:"questionResults-xNmF8o",otherButton:"otherButton-P8nsEZ"};function EX(){let e=(0,G._)(["Option ",""]);return EX=function(){return e},e}let EM=function*(){let e=-1;for(;;)yield e--}(),EA=()=>EM.next().value,ED=e=>Array(e).fill("").map(()=>({id:EA(),label:""})),ER=()=>({id:EA(),label:"",type:"text",is_required:!0}),EF=e=>{let{isOpen:t,onClose:i,survey:n,title:r}=e,{iString:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(r),{isLoading:s,refetch:d}=(0,iS.ib)({pathname:"/api/v1/survey/".concat(n.id),auto:!1,method:"PATCH",json:{title:a}}),c=(0,iN.pm)();return(0,Z.tZ)(eK.u_,{isOpen:t,onClose:i,children:(0,Z.BX)(eK.fe,{children:[(0,Z.tZ)(ei.xv.H3,{translated:!0,children:"Edit survey name"}),(0,Z.BX)("form",{onSubmit:async e=>{e.preventDefault(),await d(),c.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:"Name changed to ".concat(a)}))),i(a)},children:[(0,Z.tZ)(et.tu,{gap:4,paddingY:16,paddingRight:16,children:(0,Z.tZ)(tD.oi,{value:a,onChange:e=>{l(e.currentTarget.value)}})}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{disabled:s,type:"submit",priority:"primary",children:o("Save")}),secondaryButton:(0,Z.tZ)(ee.zx,{disabled:s,type:"button",priority:"secondary-outline",onClick:()=>{i(n.title)},children:o("Cancel")})})]})]})})},EL=e=>{let{option:t,onChange:i,onDelete:n,index:r,type:o,canChange:a=!0,canDelete:l=!0,placeholder:s}=e,{iTemplate:d,iString:c}=(0,Q.M1)();return(0,Z.BX)(et.gq,{gap:12,alignItems:"center",justifyContent:"space-between",children:["checkbox"===o&&(0,Z.tZ)(ts.xu,{border:"detail",radius:"sm",className:EE.dummyCheckbox}),"radio"===o&&(0,Z.tZ)(ts.xu,{border:"detail",radius:"full",className:EE.dummyCheckbox}),(0,Z.tZ)(tD.oi,{className:EE.optionTextInput,placeholder:s||d(EX(),r+1),disabled:!a,value:t.label,onChange:e=>{i(e.currentTarget.value)}}),l&&(0,Z.tZ)(ee.hU,{priority:"tertiary","aria-label":c("Delete"),onClick:n,children:(0,Z.tZ)(K.Z,{size:20})})]},t.id)},Ez=e=>{let{question:t,onChange:i,onDelete:n,onReorder:r,isFirst:o,isLast:a,isPlatformMode:l}=e,{id:s,type:d="text",options:c,is_required:u,is_platform_question:p,is_default_platform_question:h}=t,{iString:m}=(0,Q.M1)(),g=l?"label":"displayLabel";return(0,Z.BX)(et.tu,{className:EE.question,border:"detail",radius:"md",overflow:"hidden",children:[(0,Z.BX)(et.tu,{paddingX:24,gap:24,paddingY:32,children:[(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.tZ)(tD.oi,{placeholder:m("Question"),value:t[g],onChange:e=>i((0,_._)((0,f._)({},t),{[g]:e.currentTarget.value}))}),(0,Z.tZ)(sE.G,{value:d.replace("_freeform",""),buttonClassName:EE.questionTypeDropdown,onChange:e=>{i((0,_._)((0,f._)({},t),{options:EY(e)?ED(3):null,type:e}))},options:[{label:m("Text"),value:"text"},{label:m("Number"),value:"number"},{label:m("Multiple Choice"),value:"checkbox"},{label:m("Single Choice"),value:"radio"},{label:m("Country / Region"),value:"country"}]})]}),"text"===d&&(0,Z.tZ)(et.tu,{padding:12,border:"detail",radius:"sm",className:EE.dummyTextArea,sizing:"border-box",children:(0,Z.tZ)(ei.xv,{translated:!0,font:"text",color:"secondary",size:14,children:"Text Answer"})}),"number"===d&&(0,Z.tZ)(et.tu,{padding:12,border:"detail",radius:"sm",className:EE.dummyTextBox,sizing:"border-box",children:(0,Z.tZ)(ei.xv,{translated:!0,font:"text",color:"secondary",size:14,children:"Number Answer"})}),"country"===d&&(0,Z.BX)(et.tu,{gap:24,children:[(0,Z.BX)(et.gq,{padding:12,border:"detail",alignItems:"center",justifyContent:"space-between",radius:"sm",className:EE.dummyDropdown,sizing:"border-box",children:[(0,Z.tZ)(ei.xv,{translated:!0,font:"text",color:"secondary",size:14,children:"Country dropdown"}),(0,Z.tZ)(ib.Z,{size:20})]}),(0,Z.BX)(et.gq,{padding:12,border:"detail",alignItems:"center",justifyContent:"space-between",radius:"sm",className:EE.dummyDropdown,sizing:"border-box",children:[(0,Z.tZ)(ei.xv,{translated:!0,font:"text",color:"secondary",size:14,children:"Region dropdown"}),(0,Z.tZ)(ib.Z,{size:20})]})]}),c&&EY(t.type)&&c.length>0&&(0,Z.BX)(et.tu,{gap:24,children:[c.map((e,n)=>(0,Z.tZ)(EL,{type:"checkbox"===t.type||"checkbox_freeform"===t.type?"checkbox":"radio",index:n,option:e,canDelete:!0,canChange:!0,onChange:e=>{let r=(0,f._)({},t);r.options&&(r.options[n].label=e),i(r)},onDelete:()=>{let e=(0,f._)({},t);e.options&&e.options.splice(n,1),i(e)}})),EH(t.type)&&(0,Z.tZ)(EL,{type:"checkbox_freeform"===t.type?"checkbox":"radio",index:c.length-1,option:{id:-9999},placeholder:m("What is your gender?"===t.label?"Prefer to self describe":"Other..."),canChange:!1,canDelete:!0,onDelete:()=>{let e=(0,f._)({},t);e.type="checkbox_freeform"===t.type?"checkbox":"radio",i(e)}})]}),c&&EY(t.type)&&(0,Z.BX)(et.gq,{gap:16,alignItems:"center",children:[(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>{let e={id:EA(),label:""},n=(0,f._)({},t);n.options&&n.options.push(e),i(n)},children:m("Add option")}),!EH(t.type)&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,color:"secondary",children:"or"}),(0,Z.tZ)(ee.zx,{onClick:()=>{let e=(0,f._)({},t);e.type="radio"===t.type?"radio_freeform":"checkbox_freeform",i(e)},priority:"secondary",children:m('Add "Other"')})]})]})]}),(0,Z.BX)(et.gq,{bg:"secondary",alignItems:"center",justifyContent:"space-between",paddingY:12,paddingX:24,gap:24,children:[(0,Z.BX)(et.gq,{alignItems:"center",children:[!(o&&a)&&(0,Z.tZ)(ei.xv.B4,{weight:"semibold",translated:!0,children:"Order:"}),!o&&(0,Z.tZ)(ee.hU,{size:"sm",priority:"tertiary",onClick:()=>{r("up")},children:(0,Z.tZ)(iv.Z,{size:20})}),!a&&(0,Z.tZ)(ee.hU,{size:"sm",priority:"tertiary",onClick:()=>{r("down")},children:(0,Z.tZ)(ib.Z,{size:20})})]}),(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.BX)(et.gq,{gap:8,alignItems:"center",children:[(0,Z.tZ)(iB.X,{checked:!!u,onChange:e=>{i((0,_._)((0,f._)({},t),{is_required:e}))},size:"sm"}),(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",children:"Required"})]}),l&&(0,Z.BX)(et.gq,{gap:8,alignItems:"center",children:[(0,Z.tZ)(iB.X,{checked:!!p,onChange:e=>{i((0,_._)((0,f._)({},t),{is_platform_question:e,is_default_platform_question:!!e&&t.is_default_platform_question}))},size:"sm"}),(0,Z.tZ)(ei.xv.B4,{weight:"semibold",translated:!0,children:"Platform Question"})]}),l&&(0,Z.BX)(et.gq,{gap:8,alignItems:"center",children:[(0,Z.tZ)(iB.X,{checked:!!h,onChange:e=>{i((0,_._)((0,f._)({},t),{is_platform_question:!!e||t.is_platform_question,is_default_platform_question:e}))},size:"sm"}),(0,Z.tZ)(ei.xv.B4,{weight:"semibold",translated:!0,children:"Default Survey Question"})]}),(0,Z.tZ)(ee.hU,{size:"sm",priority:"secondary",onClick:()=>{n(s)},children:(0,Z.tZ)(iW.Z,{size:16})})]})]})]})},EO=e=>{let{question:t,onAdd:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)(et.gq,{borderBottom:"detail",paddingY:16,paddingX:12,alignItems:"center",justifyContent:"space-between",children:[(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ei.xv.Meta,{children:n("country"===t.type?"Country / Region":"number"===t.type?"Number":t.type.indexOf("checkbox")>-1?"Multiple Choice":t.type.indexOf("radio")>-1?"Single Choice":"Text")}),(0,Z.tZ)(ei.xv.B4,{weight:"bold",children:t.displayLabel||t.label})]}),(0,Z.tZ)(ee.hU,{onClick:i,size:"sm",priority:"secondary",children:(0,Z.tZ)(ta.Z,{size:16})})]})},EU=e=>{let{isSaving:t,onSave:i,includePlatformCheck:n,setIsPlatformMode:r,isPlatformMode:o,popup:a}=e,{iString:l}=(0,Q.M1)();return(0,Z.tZ)(et.gq,{className:EE.saveBar,paddingX:20,justifyContent:"center",borderTop:"detail",sizing:"border-box",children:(0,Z.BX)(et.gq,{className:EE.saveBarInner,paddingY:20,justifyContent:"start",gap:16,children:[(0,Z.tZ)(ee.zx,{priority:"secondary",disabled:t,onClick:()=>{i()},children:l("Save Changes")}),!a&&(0,Z.tZ)(ee.zx,{priority:"secondary",disabled:t,href:"/publish/stats/reader-surveys",children:l("Cancel")}),a&&(0,Z.tZ)(ee.zx,{priority:"secondary",disabled:t,onClick:()=>window.close(),children:l("Back to post editor")}),n&&(0,Z.BX)(et.gq,{gap:8,alignItems:"center",children:[(0,Z.tZ)(iB.X,{checked:o,onChange:e=>{r(e)}}),l("Platform mode")]})]})})},EY=e=>["checkbox","checkbox_freeform","radio","radio_freeform"].includes(e||""),EH=e=>["checkbox_freeform","radio_freeform"].includes(e||""),Ej=e=>{let{pub:t,surveyId:i,user:n,popup:r}=e,[o,a]=(0,A.eJ)(null),[l,s]=(0,A.eJ)(""),[d,c]=(0,A.eJ)(!1),[u,p]=(0,A.eJ)(!1),h=(0,rY.m)("undefined"!=typeof window?window.location.href:""),[m,g]=(0,A.eJ)("results"===h.activeTab?"results":"edit"),{iString:v,iPlural:b}=(0,Q.M1)(),y=(0,iN.pm)(),w=e=>a([].concat(e)),C=(0,A.Ye)(()=>o?o.reduce((e,t)=>{var i;return null===(i=t.options)||void 0===i||i.forEach(t=>e[t.id]=t),e},{}):{},[o]),{result:x,isLoading:S}=(0,iS.ib)({pathname:"/api/v1/survey/".concat(i),auto:!0}),{result:k}=(0,iS.ib)({pathname:"/api/v1/survey/platform-questions",auto:!0}),{isLoading:B,result:T,refetch:I}=(0,iS.ib)({pathname:"/api/v1/survey/".concat(i),auto:!1,method:"PATCH",json:{questions:o,isPlatformMode:u}}),{refetch:N}=(0,iS.ib)({pathname:"/api/v1/survey/".concat(i),auto:!1,method:"DELETE"}),P=async()=>{var e;await I(),r&&(null===(e=window.opener)||void 0===e?void 0:e.postMessage)&&window.opener.postMessage("surveySavedInPopup",window.location.origin),y.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:v("Changes saved!")})))};if((0,A.d4)(()=>{if(T&&!B&&u){window.location.reload();return}if(T&&!B){w(T.questions),s(T.title);return}x&&!B&&(w(x.questions),s(x.title))},[S,B]),!x&&!S)return(0,Z.tZ)("div",{className:"container",children:(0,Z.tZ)(ei.xv.H1,{translated:!0,children:"There was an error fetching this survey."})});if(!x)return(0,Z.tZ)("div",{className:"container"});let E=(0,j.qYj)(t,{type:"adhoc_email",template:"survey",surveyId:i});return(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(et.gq,{justifyContent:"center",paddingY:12,children:(0,Z.tZ)(et.gq,{className:EE.wrapper,children:(0,Z.tZ)(ee.zx,{href:"/publish/stats/reader-surveys",priority:"secondary",children:v("Back to surveys")})})}),(0,Z.BX)(et.gq,{justifyContent:"center",paddingBottom:80,children:[(0,Z.tZ)(EF,{title:l,survey:x,isOpen:d,onClose:e=>{c(!1),s(e)}},l),"edit"===m&&(0,Z.tZ)(EU,{onSave:P,isSaving:B,includePlatformCheck:n.is_global_admin,isPlatformMode:u,setIsPlatformMode:p,popup:r}),(0,Z.BX)(et.hs,{direction:{desktop:"row",mobile:"column"},className:EE.wrapper,gap:48,paddingTop:36,paddingBottom:48,paddingX:20,justifyContent:"space-between",children:[(0,Z.BX)(et.tu,{gap:24,flex:"grow",children:[(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.H3,{children:l}),(0,Z.BX)(et.gq,{gap:12,children:[(0,Z.tZ)(EP.gd,{priority:"primary",className:EE.shareButton,menuItems:[(0,Z.tZ)(tC.sN,{href:E,priority:"primary",leading:(0,Z.tZ)(uh.Z,{}),children:v("Send email")}),(0,Z.tZ)(tC.sN,{onClick:()=>{(0,Y.vQ)("".concat((0,j.TJI)(t),"survey/").concat(i)),y.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:v("Copied link to clipboard. Remember, only subscribers can respond to your survey.")})))},priority:"primary",leading:(0,Z.tZ)(tI.Z,{}),children:v("Copy link")})],leading:(0,Z.tZ)(EN.Z,{height:20}),href:E,localNavigation:!1,"data-testid":"menu-dashboard-button",children:v("Share")}),(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{children:(0,Z.tZ)(pu.Z,{})}),children:[(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(nX.Z,{}),onClick:()=>c(!0),children:v("Edit name")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(g3.Z,{}),priority:"destructive",onClick:async()=>{window.confirm(v("Are you sure you want to delete this survey? All questions and responses will be lost. All links to the survey in your welcome email will fail."))&&(await N(),window.location.href="/publish/stats/reader-surveys")},children:v("Delete survey")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(nP.Z,{}),href:"/api/v1/survey/".concat(i,"/export"),native:!0,target:"_blank",rel:"noopener noreferrer",children:v("Export results")})]})]})]}),(0,Z.tZ)(et.tu,{className:EE.tabContainer,children:(0,Z.tZ)(yo.n,{tabs:[{value:"edit",label:v("Edit survey")},{value:"results",label:v("View responses"),trailingIcon:x.responseCount?(0,Z.tZ)(d_.Vp,{priority:"results"===m?"primary":"secondary",children:x.responseCount}):null}],value:m,onChange:g})}),"edit"===m&&(0,Z.BX)(et.tu,{className:EE.questions,gap:48,children:[o&&o.map((e,t)=>{let i=0===t,n=t===o.length-1;return(0,Z.tZ)(Ez,{question:e,isFirst:i,isLast:n,isPlatformMode:u,onChange:e=>{o[t]=e,w(o)},onDelete:()=>{o.splice(t,1),w(o)},onReorder:r=>{"up"!==r||i||(o[t]=o[t-1],o[t-1]=e),"down"!==r||n||(o[t]=o[t+1],o[t+1]=e),w(o)}},e.id)}),(0,Z.tZ)(ee.zx,{priority:"secondary",disabled:B,onClick:()=>{let e=ER();w((o||[]).concat([e]))},leading:(0,Z.tZ)(ta.Z,{size:20}),children:v("Add question")})]}),"results"===m&&(0,Z.tZ)(et.tu,{gap:36,paddingTop:24,children:null==o?void 0:o.filter(e=>e.id&&e.id>0).map(e=>{let t=EY(e.type)?[{key:"option",name:v("Option"),wrap:!0,valueFn:e=>{let t=C[e.value];return(0,Z.tZ)("span",{className:"bold",children:(null==t?void 0:t.label)||""})}},{key:"percentage",name:v("Percentage"),wrap:!0,valueFn:t=>(0,Z.BX)("span",{className:"bold",children:[Math.round(t.num_responses/(e.responseCount||1)*100),"%"]})},{key:"num_responses",name:v("# of Responses"),wrap:!0,valueFn:e=>(0,Z.tZ)("span",{className:"bold",children:e.num_responses})}]:[{key:"value",wrap:!0,valueFn:e=>(0,Z.tZ)(ei.xv.B4,{children:"string"==typeof e.data.value?e.data.value.trim():e.data.value||v("Empty response")})}];return(0,Z.BX)(et.tu,{className:EE.questionResults,gap:12,children:[(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{children:e.displayLabel||e.label}),(0,Z.tZ)(ei.xv.Meta,{children:b("%1 Response","%1 Responses",e.responseCount||0)})]}),(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(gu.Z,{children:(0,Z.tZ)(ps,{url:"/api/v1/survey/".concat(x.id,"/responses/").concat(e.id),cols:t,pageSize:10,hidePagination:EY(e.type),hideHeaders:!EY(e.type),dataKey:"responses",totalKey:"total",empty:(0,Z.tZ)(u0,{title:v("No responses yet"),text:v("Responses will appear here as users fill out your survey.")})})}),EH(e.type)&&(0,Z.tZ)(gu.Z,{children:(0,Z.tZ)(ps,{url:"/api/v1/survey/".concat(x.id,"/responses/").concat(e.id,"?freeform=true"),cols:[{key:"value",name:v('"Other" responses'),wrap:!0,valueFn:e=>(0,Z.tZ)(ei.xv.B4,{children:"string"==typeof e.data.value?e.data.value.trim():e.data.value||v("Empty response")})}],pageSize:10,dataKey:"responses",totalKey:"total",empty:(0,Z.tZ)(u0,{title:v('No "Other" responses yet'),text:v('"Other" responses will appear here as users fill out your survey.')})})})]}),(0,Z.tZ)(ts.xu,{borderBottom:"detail"})]})})})]}),"edit"===m&&(0,Z.BX)(et.tu,{className:EE.questionList,border:"detail",radius:"md",children:[(0,Z.tZ)(et.tu,{paddingX:12,paddingY:20,className:EE.questionListHeader,children:(0,Z.tZ)(ei.xv.H4,{translated:!0,children:"Suggested questions"})}),(0,Z.tZ)(et.tu,{className:EE.questionListQuestions,children:k&&o&&k.filter(e=>!o.find(t=>t.id===e.id||t.seed_question_id===e.id)).map(e=>(0,Z.tZ)(EO,{question:e,onAdd:()=>{o.push(e),w(o),(0,U.j)(U.FP.READER_SURVEY_SUGGESTED_QUESTION_ADDED,{questionId:e.id,surveyId:x.id})}}))})]})]})]})]})};var EJ=i(17204),EV=i.n(EJ),Eq=i(98913),EW=i.n(Eq),EG=i(43645),EK=i(70228),EQ=i(96935),E$=i(12808);let E0=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t[0]?setTimeout(async()=>{!await e()&&t.length&&E0(e,t.slice(1))},1e3*t[0]):i&&i()},E1=function(e){let[t,i]=(0,A.eJ)(e);return[t,e=>i([...t,e]),()=>{if(!t.length)return null;let[e,...n]=t;return i(n),e}]},E2=e=>{let{counts:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.BX)(dc,{children:[(0,Z.tZ)(ml,{title:i("All subscribers"),value:null==t?void 0:t.totalEmail,format:"number",loading:!t,menu:(null==t?void 0:t.totalEmail)?(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{size:"xs",priority:"quaternary",children:(0,Z.tZ)(pu.Z,{size:16})}),children:(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(uc.Z,{}),href:"/api/v1/download_signups",download:!0,target:"_blank",children:i("Export all subscribers")})}):null}),(0,Z.tZ)(ml,{title:i("Paid subscribers"),value:null==t?void 0:t.subscribers,format:"number",loading:!t,menu:(null==t?void 0:t.subscribers)?(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{size:"xs",priority:"quaternary",children:(0,Z.tZ)(pu.Z,{size:16})}),children:(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(uc.Z,{}),href:"/api/v1/download_subscribers",download:!0,target:"_blank",children:i("Export paid subscribers")})}):null})]})},E4={user_name:{name:"Name"},user_email_address:{name:"Email"},subscription_created_at:{name:"Subscription date",explanation:"The date when this reader first subscribed to your publication."},subscription_type:{name:"Subscription type",explanation:"Free, paid, founding, gift, or comp. Also includes subscription interval (monthly, yearly) where applicable."},subscription_country:{name:"Subscriber country",explanation:"The reader's country based on the IP address of the reader's most recent subscription event."},is_subscribed:{name:"Can see paid content"},bestseller_tier:{name:"Is Bestseller",explanation:"The reader is a Substack Bestseller"},num_emails_received:{name:"Email receives (last 6 months)",explanation:"Number of times emails sent to this subscriber have been delivered in the last 6 months."},num_emails_dropped:{name:"Email drops (last 6 months)",explanation:"Number of times emails sent to this subscriber have been dropped in the last 6 months."},num_emails_opened:{name:"Emails opened (last 6 months)",explanation:"Number of emails opened by this subscriber in the last 6 months."},num_email_opens:{name:"Email opens (last 6 months)",explanation:"Number of times emails sent to this subscriber have been opened in the last 6 months. If the number is large, it may be because the subscriber is forwarding emails to other people."},num_email_opens_last_7d:{name:"Email opens (last 7 days)",explanation:"Number of times emails sent to this subscriber have been opened in the last 7 days. If the number is large, it may be because the subscriber is forwarding emails to other people."},num_email_opens_last_30d:{name:"Email opens (last 30 days)",explanation:"Number of times emails sent to this subscriber have been opened in the last 30 days. If the number is large, it may be because the subscriber is forwarding emails to other people."},last_opened_at:{name:"Email last opened at",explanation:"The date when this reader last opened an email from your publication."},links_clicked:{name:"Link clicks"},last_clicked_at:{name:"Last clicked at"},num_unique_email_posts_seen_last_7d:{name:"Unique emails seen (last 7 days)",explanation:"How many distinct emails sent to this subscriber in the last 7 days have been opened. Emails that are forwarded and then opened by someone else are not distinctly counted."},num_unique_email_posts_seen_last_30d:{name:"Unique emails seen (last 30 days)",explanation:"How many distinct emails sent to a subscriber in the last 30 days have been opened. Emails that are forwarded and then opened by someone else are not distinctly counted."},num_unique_email_posts_seen:{name:"Unique emails seen (last 6 months)",explanation:"How many distinct emails sent to a subscriber have been opened in the last 6 months. Emails that are forwarded and then opened by someone else are not distinctly counted."},num_web_post_views_last_7d:{name:"Post views (last 7 days)"},num_web_post_views_last_30d:{name:"Post views (last 30 days)"},num_web_post_views:{name:"Post views (last 6 months)"},num_unique_web_posts_seen_last_7d:{name:"Unique posts seen (last 7 days)"},num_unique_web_posts_seen_last_30d:{name:"Unique posts seen (last 30 days)"},num_unique_web_posts_seen:{name:"Unique posts seen (all-time)"},num_comments_last_7d:{name:"Comments (last 7 days)"},num_comments_last_30d:{name:"Comments (last 30 days)"},num_comments:{name:"Comments (all time)"},num_shares_last_7d:{name:"Shares (last 7 days)",explanation:"How many times a subscriber has clicked a button to share one of your posts in the last 7 days."},num_shares_last_30d:{name:"Shares (last 30 days)",explanation:"How many times a subscriber has clicked a button to share one of your posts in the last 30 days."},num_shares:{name:"Shares (all time)",explanation:"How many times a subscriber has clicked a button to share one of your posts."},num_subs_gifted:{name:"Subscriptions gifted"},subscription_expires_at:{name:"Expires at",explanation:"For paid subscribers, the date at which they will be charged to renew their subscription (if they have not cancelled), or when their paid subscription will end."},first_payment_at:{name:"First payment at"},subscription_interval:{name:"Subscription interval"},total_revenue_generated:{name:"Revenue",explanation:"How much money the subscriber has paid for your newsletter, not including any money refunded."},free_attribution:{name:"Subscription source (free)",explanation:"A tag explaining how a subscriber arrived at your publication before becoming a free subscriber (e.g. from the Substack homepage or Google)."},paid_attribution:{name:"Subscription source (paid)",explanation:"A tag explaining how a subscriber arrived at your publication before becoming a paying subscriber (e.g. from the Substack homepage or Google)."},days_active_last_30d:{name:"Days active (last 30 days)",explanation:"The number of days, out of the last 30, where a subscriber viewed a post or opened an email from your publication."},activity_rating:{name:"Activity",explanation:"A high-level rating of how actively the subscriber has used your newsletter in the last month, including email opens and web views."},last_subscribed_at:{name:"Paid upgrade date",explanation:"The most recent date on which a subscriber converted from free to paid."},unsubscribed_at:{name:"Cancel date",explanation:"The date on which a subscriber chose to cancel their paid subscription."},emails_enabled:{name:"Receiving emails for",explanation:"The lists for which a subscriber has emails enabled, including your root publication and any sections in your publication."},stripe_plan_name:{name:"Stripe plan nickname",explanation:"The nickname of the Stripe plan which the user is subscribed to."}},E3=[{key:"subscription_type",visible:!0},{key:"activity_rating",visible:!0},{key:"subscription_created_at",visible:!0},{key:"total_revenue_generated",visible:!0},{key:"num_comments",visible:!1},{key:"num_comments_last_7d",visible:!1},{key:"num_comments_last_30d",visible:!1},{key:"num_shares",visible:!1},{key:"num_shares_last_7d",visible:!1},{key:"num_shares_last_30d",visible:!1},{key:"subscription_country",visible:!1},{key:"num_emails_received",visible:!1},{key:"num_emails_dropped",visible:!1},{key:"num_emails_opened",visible:!1},{key:"num_email_opens",visible:!1},{key:"num_email_opens_last_7d",visible:!1},{key:"num_email_opens_last_30d",visible:!1},{key:"last_opened_at",visible:!1},{key:"links_clicked",visible:!1},{key:"last_clicked_at",visible:!1},{key:"num_unique_email_posts_seen",visible:!1},{key:"num_unique_email_posts_seen_last_7d",visible:!1},{key:"num_unique_email_posts_seen_last_30d",visible:!1},{key:"num_web_post_views",visible:!1},{key:"num_web_post_views_last_7d",visible:!1},{key:"num_web_post_views_last_30d",visible:!1},{key:"num_unique_web_posts_seen",visible:!1},{key:"num_unique_web_posts_seen_last_7d",visible:!1},{key:"num_unique_web_posts_seen_last_30d",visible:!1},{key:"num_subs_gifted",visible:!1},{key:"subscription_expires_at",visible:!1},{key:"free_attribution",visible:!1},{key:"paid_attribution",visible:!1},{key:"days_active_last_30d",visible:!1},{key:"first_payment_at",visible:!1},{key:"last_subscribed_at",visible:!1},{key:"unsubscribed_at",visible:!1},{key:"emails_enabled",visible:!1},{key:"bestseller_tier",visible:!1},{key:"stripe_plan_name",visible:!1}],E8=e=>"lifetime"===e.subscription_interval?"Lifetime ":"annual"===e.subscription_interval?"Yearly ":"monthly"===e.subscription_interval?"Monthly ":"quarterly"===e.subscription_interval?"Quarterly ":"semiannually"===e.subscription_interval?"Semiannual ":"",E6=e=>e.founding_plan_name||"Founding member",E5=(e,t)=>i=>(0,er.centsToPriceString)(i[e],(0,er.pubCurrency)(t),{forceDecimals:!0}),E9=(e,t)=>(0,er.pubUsesZeroDecimalCurrency)(t)?e:100*e,E7=e=>t=>{let i=(0,H.Z)(t[e]),n=new Date(i.toDate());return i.isValid()?(0,Z.tZ)("span",{title:"".concat(n.toLocaleDateString()," ").concat(n.toLocaleTimeString()),children:i.format("MMMM Do, YYYY")}):""},Xe=e=>{var t,i,n;let r=null==e?void 0:null===(t=e.plans)||void 0===t?void 0:t.find(e=>"month"===e.interval&&3===e.interval_count),o=null==e?void 0:null===(i=e.plans)||void 0===i?void 0:i.find(e=>"month"===e.interval&&6===e.interval_count),a=["annual","monthly","lifetime"].concat(r?"quarterly":[]).concat(o?"semiannually":[]),l=fI()(E4,{user_name:{rollup:"subscriber"},user_email_address:{rollup:"subscriber"},sections_enabled:{rollup:"emails_enabled"},root_enabled:{rollup:"emails_enabled"},emails_enabled:{valueFn:t=>{if(!t.sections_enabled)return t.root_enabled?e.name:"";let i=t.sections_enabled.split(",").map(e=>Number(e)).map(t=>{var i;return null===(i=e.sections.find(e=>e.id===t))||void 0===i?void 0:i.name}).filter(Boolean),n=t.root_enabled?[e.name,...i]:i;if(n.reduce((e,t)=>e+t.length,0)>60){let e=[],t=0;for(let i of n){if((t+=i.length)>48)break;e.push(i)}return(0,Z.tZ)("span",{className:"emails-enabled-list",children:(0,Z.BX)(h6,{content:n.join(", "),baseRef:void 0,portalClass:void 0,children:[e.length>0?e.join(", "):n.join(", "),", and"," ",n.length-e.length," more"]})})}return n.join(", ")}},subscription_created_at:{valueFn:E7("subscription_created_at")},subscription_type:{type:"String",valueFn:t=>t.user_email_address===e.author_email?(0,Z.tZ)("span",{className:"paid",children:"Author"}):t.is_founding?t.is_gift?(0,Z.tZ)("span",{className:"founding",children:"".concat(E6(e)," Gift")}):(0,Z.tZ)("span",{className:"founding",children:E6(e)}):t.is_bitcoin?(0,Z.tZ)("span",{className:"paid",children:"Bitcoin"}):t.is_gift?(0,Z.BX)("span",{className:"paid",children:[E8(t),"Gift"]}):t.is_comp?(0,Z.BX)("span",{className:"paid",children:[E8(t),"Comp"]}):t.is_free_trial?(0,Z.BX)("span",{className:"paid",children:[E8(t),"(Free Trial)"]}):t.is_subscribed?(0,Z.BX)("span",{className:"paid",children:[E8(t),"Paid"]}):(0,Z.tZ)("span",{className:"free",children:"Free"})},subscription_expires_at:{valueFn:t=>"paused"===e.payments_state&&t.subscription_expires_at&&(0,H.Z)(t.subscription_expires_at)>(0,H.Z)()?"Paused":"lifetime"===t.subscription_interval?"Never":E7("subscription_expires_at")(t)},bestseller_tier:{type:"Boolean",valueFn:e=>e.bestseller_tier>=100?"âœ”ï¸":""},first_payment_at:{valueFn:E7("first_payment_at")},subscription_interval:{rollup:"subscription_type",values:a},activity_rating:{valueFn:e=>["","â˜…","â˜…â˜…","â˜…â˜…â˜…","â˜…â˜…â˜…â˜…","â˜…â˜…â˜…â˜…â˜…"][e.activity_rating||0],className:"activity-rating"},total_revenue_generated:{valueFn:E5("total_revenue_generated",e),filterTranslator:t=>E9(t,e)},last_subscribed_at:{valueFn:E7("last_subscribed_at")},unsubscribed_at:{valueFn:E7("unsubscribed_at")},last_opened_at:{valueFn:E7("last_opened_at")},last_clicked_at:{valueFn:E7("last_clicked_at")},free_attribution:{valueFn:e=>(0,er.getReadableAttribution)(e.free_attribution)},paid_attribution:{valueFn:e=>(0,er.getReadableAttribution)(e.paid_attribution)}});return(null===(n=e.sections)||void 0===n?void 0:n.length)>0||delete l.emails_enabled,l},Xt=e=>{let t=EV()(e.map(e=>[e.key,e]));return E3.map(e=>t[e.key]||e)},Xi=[{suffix:"_gt",name:">",types:["Int"]},{suffix:"_gt",name:"is after",types:["DateTime"]},{suffix:"_gte",name:">=",types:["Int"]},{suffix:"_gte",name:"is on or after",types:["DateTime"]},{suffix:"_lt",name:"<",types:["Int"]},{suffix:"_lt",name:"is before",types:["DateTime"]},{suffix:"_lte",name:"<=",types:["Int"]},{suffix:"_is_on_or_before",name:"is on or before",types:["DateTime"]},{suffix:"",name:"is",types:["Int","Boolean","subscription_type","Enum"]},{suffix:"_string_is",name:"is",types:["String"]},{suffix:"_is_on",name:"is on",types:["DateTime"]},{suffix:"_distinct_from",name:"is not",types:["Int","Boolean","Enum"]},{suffix:"_not",name:"is not",types:["subscription_type"]},{suffix:"_string_not",name:"is not",types:["String"]},{suffix:"_similar_to",name:"contains",types:["String"]},{suffix:"_starts_with",name:"starts with",types:["String"]},{suffix:"_ends_with",name:"ends with",types:["String"]},{suffix:"_in",name:"is any of",types:["subscription_type","Enum","String"]},{suffix:"_includes_any",name:"includes any of",types:["emails_enabled"]},{suffix:"_includes_all",name:"includes all of",types:["emails_enabled"]},{suffix:"_includes_none",name:"includes none of",types:["emails_enabled","String"]}],Xn=(0,w.createContext)({subStats:{},setSubStats:()=>{}});function Xr(e){var t,i,n;let{isOpen:r,onClose:o,getSubSet:a}=e,{iPlural:l,iString:s}=(0,Q.M1)(),{popToast:d}=(0,iN.pm)(),[c,u]=(0,A.eJ)(!0),[p,h]=(0,A.eJ)(30),[m,g]=(0,A.eJ)(!1),[v,b]=(0,A.eJ)(!1),{subStats:y}=(0,A.qp)(Xn),w=y.isDynamic?null!==(i=y.count)&&void 0!==i?i:0:null!==(n=null===(t=y.selected)||void 0===t?void 0:t.length)&&void 0!==n?n:0,C=(0,A.Ye)(()=>{var e,t;return!!w&&(!!c||(y.isDynamic?!!(null===(e=y.subscribers)||void 0===e?void 0:e.some(e=>e.is_subscribed)):!!(null===(t=y.subscribers)||void 0===t?void 0:t.some(e=>{var t;return e.is_subscribed&&(null===(t=y.selected)||void 0===t?void 0:t.includes(e.user_id))}))))},[c,y,w]);(0,A.d4)(()=>{C||g(!1)},[C]);let x=(0,A.I4)(()=>{b(!0),a().then(e=>e.body.id).then(e=>N().post("/api/v1/subscriber_set/comp").send({subscriberSetId:e,expiryDays:c?p:0,founding:m})).then(o).then(()=>d(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:l("Comping 1 subscriber. Data on this page will update shortly.","Comping %2 subscribers. Data on this page will update shortly.",w,w.toLocaleString())})))).catch(e=>d(t=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},t),{text:(0,Y.zx)(e)})))).finally(()=>b(!1))},[o,a,l,d,c,p,m,w]);return(0,Z.tZ)(eK.u_,{isOpen:r,onClose:o,children:(0,Z.BX)(tU.w,{children:[(0,Z.tZ)(eK.xB,{onClose:o,showClose:!0,title:l("Comp subscription","Comp subscriptions",w)}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.tu,{gap:12,children:[(0,Z.tZ)(ei.xv.B2,{translated:!0,children:"Give away paid subscription status for free."}),(0,Z.BX)(et.gq,{alignItems:"center",gap:12,children:[(0,Z.tZ)(iB.X,{checked:c,onChange:u}),(0,Z.tZ)(ei.xv.B2,{translated:!0,onClick:()=>u(!c),cursor:"pointer",userSelect:"none",children:"Give or extend paid status:"}),(0,Z.tZ)(sE.G,{value:p,options:[{value:7,label:s("for 7 days")},{value:30,label:s("for 30 days")},{value:90,label:s("for 90 days")},{value:183,label:s("for 6 months")},{value:365,label:s("for 1 year")},{value:36500,label:s("forever")}],onChange:h,disabled:!c||v})]}),(0,Z.BX)(et.gq,{alignItems:"center",gap:12,children:[(0,Z.tZ)(iB.X,{checked:m,onChange:g,disabled:!C}),(0,Z.tZ)(ei.xv.B2,{translated:!0,color:C?"primary":"tertiary",cursor:"pointer",onClick:()=>C&&g(!m),userSelect:"none",children:"Set to Founding"})]}),(0,Z.tZ)(ik.H,{expanded:!c&&C&&m,children:(0,Z.tZ)(et.tu,{paddingBottom:12,children:(0,Z.BX)(et.gq,{alignItems:"center",bg:"secondary",gap:8,radius:"md",padding:12,children:[(0,Z.tZ)(eR.Z,{size:20}),(0,Z.tZ)(ei.xv.B3,{translated:!0,children:"This change will only apply to paid subscriptions."})]})})}),(0,Z.BX)(et.gq,{gap:12,children:[(0,Z.tZ)(ee.zx,{onClick:x,priority:"primary",disabled:!c&&!m||v,children:l("Comp 1 subscriber","Comp %2 subscribers",w,w.toLocaleString())}),(0,Z.tZ)(ee.zx,{onClick:o,priority:"secondary",disabled:v,children:s("Cancel")})]})]})})]})})}Xn.displayName="SubStatsContext";let Xo=e=>{let{columnView:t,setColumnView:i,columnDetails:n}=e,r=async e=>{let n=t.map(t=>t.key===e?(0,_._)((0,f._)({},t),{visible:!t.visible}):t);await i(n)};return(0,Z.tZ)(Xl,{children:t.filter(e=>{let{key:t}=e;return n[t]}).sort((e,t)=>{var i,r;let o=(null===(i=n[e.key])||void 0===i?void 0:i.name)||"",a=(null===(r=n[t.key])||void 0===r?void 0:r.name)||"";return o.localeCompare(a)}).map(e=>{var t;let{key:i,visible:o}=e;return(0,Z.tZ)(Xa,{colKey:i,checked:o,toggle:r,name:(null===(t=n[i])||void 0===t?void 0:t.name)||""})})})},Xa=e=>{let{colKey:t,checked:i,toggle:n,name:r}=e;return(0,Z.tZ)("label",{children:(0,Z.BX)(et.X2,{alignItems:"center",gap:8,cursor:"pointer",children:[(0,Z.tZ)(iB.X,{size:"xs",checked:i,onChange:()=>n(t)}),(0,Z.tZ)(ei.xv.B4,{children:r})]})})},Xl=(0,sx.zo)({display:"flex",direction:"column",gap:12,padding:12,maxHeight:500,overflow:"auto"});function Xs(){let e=(0,G._)(["Exporting "," for "," members."]);return Xs=function(){return e},e}function Xd(){let e=(0,G._)(["Only the "," selected subscribers"]);return Xd=function(){return e},e}function Xc(){let e=(0,G._)(["Only the "," matching subscribers"]);return Xc=function(){return e},e}let Xu=e=>{let{doExport:t,downloadURL:i,selected:n,isDynamic:r,count:o,filtering:a,exporting:l,isOpen:s,onClose:d}=e,c=a&&o>0||n.length>0,[u,p]=(0,A.eJ)(c?"matching":"everyone"),[h,m]=(0,A.eJ)("all"),[g,v]=(0,A.eJ)(!0),{iString:b,iTemplate:y}=(0,Q.M1)();(0,A.d4)(()=>{p(c?"matching":"everyone")},[c]),(0,A.d4)(()=>{v(!0)},[n,r,u,h]);let f="everyone"===u||0===n.length||r?o:n.length;return(0,Z.tZ)(eK.u_,{isOpen:s,onClose:d,children:(0,Z.BX)(tU.w,{children:[(0,Z.tZ)(eK.xB,{title:b("Export subscribers"),showClose:!0,onClose:d,showDivider:!0}),(0,Z.tZ)(eK.fe,{children:(0,Z.tZ)(et.tu,{gap:24,children:l?(0,Z.tZ)(tp._Y,{icon:(0,Z.tZ)(iI.$j,{}),title:b("Export in progress..."),text:y(Xs(),"all"===h?"all columns":"selected columns",(0,er.numberToString)(f))}):(0,Z.BX)(Z.HY,{children:[c&&(0,Z.tZ)(ok.g,{label:b("Export statistics forâ€¦"),name:"targetRows",options:nT()([{value:"everyone",label:b("All subscribers")},{value:"matching",label:n.length&&!r?y(Xd(),(0,er.numberToString)(n.length)):y(Xc(),(0,er.numberToString)(o))}]),value:u,onChange:p}),(0,Z.tZ)(ok.g,{label:b("For each subscriber..."),name:"targetCols",options:[{value:"all",label:b("Export all columns")},{value:"selected",label:b("Export visible columns only")}],value:h,onChange:m})]})})}),!l&&(0,Z.tZ)(eK.mz,{showDivider:!0,direction:"column",primaryButton:g?(0,Z.tZ)(ee.zx,{priority:"primary",onClick:e=>{e.stopPropagation(),v(!1),t(u,h)},disabled:l,children:b(i?"New export":"Export")}):void 0,secondaryButton:i?(0,Z.tZ)(ee.zx,{priority:"secondary-accent",href:i,newTab:!0,children:b("Download last export")}):void 0})]})})},Xp=e=>t=>{let i=(0,to.forwardRef)((i,n)=>{let r=(0,A.qp)(e);return(0,Z.tZ)(t,(0,_._)((0,f._)({},r,i),{ref:n}))});return i.displayName="with".concat(e.displayName||e.name||"AnonymousContext","(").concat(t.name||t.displayName||"Anonymous",")"),i};var Xh=i(3570);let Xm={input:"input-qt18Br",smallInput:"smallInput-AR6OQS"},Xg=()=>({column:"subscription_type",relation:"",value:"",staged:!0}),Xv=e=>e.filter(e=>!e.staged),Xb=e=>{var t;let{columnDetails:i,schema:n,filter:r,setFilter:o,deleteFilter:a,publicationCurrency:l,sectionOptions:s}=e,d=n[r.column]?n[r.column].type:r.column,c=(null==n?void 0:null===(t=n[r.column])||void 0===t?void 0:t.values)||null,u=Xi.filter(e=>{let{types:t}=e;return t.includes(d)}),{iString:p}=(0,Q.M1)(),h=Object.keys(i).filter(e=>!!i[e].name).map(e=>(0,Z.tZ)("option",{value:e,children:p(i[e].name)},e)),m=u.map(e=>(0,Z.tZ)("option",{value:e.suffix,children:p(e.name)},e.suffix)),g=eI()(r,["column","relation","value","staged"]),v=e=>{var t;let i=(null==n?void 0:n[e])?n[e].type:e,a=(null==n?void 0:null===(t=n[e])||void 0===t?void 0:t.values)||null,l=Xi.filter(e=>{let{types:t}=e;return t.includes(i)}),s={Boolean:!0,String:"",Int:0,DateTime:(0,H.Z)().format("MM/DD/YYYY"),Enum:a&&a[0],subscription_type:"free"},d=r.staged?void 0:s[i],c=(0,_._)((0,f._)({},g),{column:e});void 0!==d&&(c=(0,_._)((0,f._)({},c),{value:d})),l.some(e=>e.suffix===r.relation)||(c=(0,_._)((0,f._)({},c),{relation:l[0].suffix})),o(c)},b=e=>o((0,_._)((0,f._)({},g),{relation:e}));return(0,Z.tZ)(Z.HY,{children:(0,Z.BX)(et.X2,{gap:8,alignItems:"center",children:[(0,Z.tZ)(oY.i,{value:r.column,onChange:e=>v(e.currentTarget.value),children:h}),(0,Z.tZ)(oY.i,{value:r.relation,onChange:e=>b(e.currentTarget.value),children:m}),(0,Z.tZ)(Xy,{type:d,filter:r,onChange:e=>o((0,_._)((0,f._)({},g),{value:e,staged:!1})),options:c,publicationCurrency:l,sectionOptions:s,iString:p}),(0,Z.tZ)(ee.hU,{priority:"quaternary",size:"sm",onClick:a,children:(0,Z.tZ)(iW.Z,{size:16})})]})})},Xy=e=>{let{filter:{value:t,column:i,relation:n},onChange:r,type:o,options:a,publicationCurrency:l,sectionOptions:s,iString:d}=e,{pub:c}=ey();switch(o){case"DateTime":return(0,Z.tZ)(aT.Mt,{value:t,placeholder:(0,H.Z)().format("MM/DD/YYYY"),onChange:e=>r(e.currentTarget.value),className:Xm.smallInput});case"Int":if("activity_rating"===i)return(0,Z.BX)(oY.i,{value:t,onChange:e=>r(e.currentTarget.value),className:Xm.smallInput,children:[(0,Z.tZ)("option",{value:0,children:d("None")}),(0,Z.tZ)("option",{value:1,children:"â˜…"}),(0,Z.tZ)("option",{value:2,children:"â˜…â˜…"}),(0,Z.tZ)("option",{value:3,children:"â˜…â˜…â˜…"}),(0,Z.tZ)("option",{value:4,children:"â˜…â˜…â˜…â˜…"}),(0,Z.tZ)("option",{value:5,children:"â˜…â˜…â˜…â˜…â˜…"})]});if("total_revenue_generated"===i){let e=(0,er.isZeroDecimalCurrency)(l)?"10":"1";return(0,Z.tZ)(tD.oi,{type:"number",onChange:e=>{let t=parseFloat(e.currentTarget.value);r(t>=0?t:0)},step:e,value:t,leading:(0,Z.tZ)(ei.xv.B3,{children:(0,er.currencySymbol)(l)}),className:Xm.input,placeholder:"0.00"})}return(0,Z.tZ)(tD.oi,{type:"number",value:t,onChange:e=>r(parseFloat(e.currentTarget.value)>=0?e.currentTarget.value:0),className:Xm.input,placeholder:"0"});case"Boolean":return(0,Z.BX)(oY.i,{value:t.toString(),onChange:e=>r("true"===e.currentTarget.value),children:[(0,Z.tZ)(oY.d,{children:d("Select an option")}),(0,Z.tZ)("option",{value:"true",children:d("True")}),(0,Z.tZ)("option",{value:"false",children:d("False")})]});case"Enum":if("_in"===n)return(0,Z.tZ)(XC,{options:a,value:t,onChange:r});return(0,Z.BX)(oY.i,{value:t,onChange:e=>r(e.currentTarget.value),children:[(0,Z.tZ)(oY.d,{children:d("Select an option")}),a.map(e=>(0,Z.tZ)("option",{value:e,children:e},e))]});case"subscription_type":if("_in"===n){let e=[{value:"free",label:d("Free")},{value:"paid",label:d("Paid")},{value:"founding",label:d("Founding")},{value:"comp",label:d("Comp")},{value:"gift",label:d("Gift")},{value:"free_trial",label:d("Free trial")},{value:"group_parent",label:d("Group")}].concat((null==c?void 0:c.bitcoin_plan)?[{value:"bitcoin",label:d("Bitcoin")}]:[]);return(0,Z.tZ)(XC,{options:e,value:t,onChange:r})}return(0,Z.BX)(oY.i,{value:t,onChange:e=>r(e.currentTarget.value),children:[(0,Z.tZ)(oY.d,{children:d("Select an option")}),(0,Z.tZ)("option",{value:"paid",children:d("Paid")}),(0,Z.tZ)("option",{value:"free",children:d("Free")}),(0,Z.tZ)("option",{value:"founding",children:d("Founding")}),(0,Z.tZ)("option",{value:"group_parent",children:d("Group Parent")}),(null==c?void 0:c.bitcoin_plan)&&(0,Z.tZ)("option",{value:"bitcoin",children:d("Bitcoin")}),(0,Z.tZ)("option",{value:"comp",children:d("Comp")}),(0,Z.tZ)("option",{value:"gift",children:d("Gift")}),(0,Z.tZ)("option",{value:"free_trial",children:d("Free Trial")})]});case"emails_enabled":return(0,Z.tZ)(XC,{options:s,value:s.filter(e=>{let{value:i}=e;return null==t?void 0:t.includes(i)}),onChange:r});case"String":if("_in"===n||"_includes_none"===n)return(0,Z.tZ)(XZ,{onChange:r,value:t})}return(0,Z.tZ)(tD.oi,{maxLength:80,value:t,onChange:e=>r(e.currentTarget.value),className:Xm.input,placeholder:d("Enter a value")})},Xf={DropdownIndicator:null},X_=/[\s,;\t\n]+/,XZ=e=>{let{value:t,onChange:i}=e,[n,r]=(0,A.eJ)(""),{publication:o}=ey(),{iString:a}=(0,Q.M1)();return(0,Z.tZ)(og.ZP,{className:Xm.input,isMulti:!0,menuIsOpen:!1,value:t,isClearable:!0,components:Xf,defaultValue:[],theme:(0,Y._I)({primary:o.theme_var_background_pop||gb.Hu}),onChange:(e,n)=>{null===e&&(null==n?void 0:n.action)==="remove-value"?i(t.filter(e=>e!==n.removedValue)):i(e)},onInputChange:e=>{if(e!==n){if(X_.test(e)){let n=e.split(X_).filter(e=>e);i([...Array.isArray(t)?t:[],...n]),r("")}else r(e)}},onKeyDown:e=>{if(!n)return;let o=Array.isArray(t)?t:[];switch(e.key){case"Enter":case"Tab":i([...o,n]),r(""),e.preventDefault()}},placeholder:a("Type values here..."),getOptionLabel:e=>e,inputValue:n,styles:{valueContainer:e=>(0,_._)((0,f._)({},e),{maxWidth:180,maxHeight:240,overflowY:"scroll"})}})},Xw=Xp(Xn)(e=>{let{columnDetails:t,schema:i,subStats:{filters:n},setFilters:r,setShowFilters:o,loading:a,publicationCurrency:l,sectionOptions:s}=e,[d,c]=(0,A.eJ)(n),u=e=>t=>c(d.map((i,n)=>n===e?t:i)),p=e=>()=>c(d.filter((t,i)=>i!==e)),h=()=>c([...d,Xg()]),m=async()=>{let e=Xv(d);c(e.length>0?e:[Xg()]),null==r||r(e)},g=async()=>{o(!1),setTimeout(()=>{c(n.length>0?n:[Xg()])},500)};(0,A.d4)(()=>{c(n)},[n]),(0,A.d4)(()=>{0===d.length&&h()},[]);let{iString:v,iPlural:b}=(0,Q.M1)(),y=d.length>=10;return(0,Z.BX)(et.sg,{padding:16,gap:12,children:[(0,Z.tZ)(ei.xv.B3,{weight:"medium",color:"secondary",children:v("Filter subscribers by")}),!(d.length>0)&&(0,Z.tZ)(et.M5,{outline:"detail",radius:"sm",padding:12,children:(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:v("No filters")})}),d.map((e,n)=>(0,Z.tZ)(Xb,{filter:e,setFilter:u(n),deleteFilter:p(n),columnDetails:t,schema:i,publicationCurrency:l,sectionOptions:s})),(0,Z.BX)(et.X2,{flex:"grow",justifyContent:"space-between",children:[!y&&(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:h,loading:a,leading:(0,Z.tZ)(ta.Z,{size:16}),children:v("Add new filter")}),(0,Z.BX)(et.X2,{gap:8,justifyContent:"end",alignItems:"center",children:[n.length>0&&(0,Z.tZ)(ei.xv.B3,{color:"secondary",paddingRight:8,children:b("%1 filter applied","%1 filters applied",n.length)}),n.length>0?(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:()=>{o(!1),setTimeout(()=>{c([]),null==r||r([])},500)},children:v("Clear all")}):(0,Z.tZ)(ee.zx,{priority:"secondary-outline",onClick:g,loading:a,children:v("Cancel")}),(0,Z.tZ)(ee.zx,{priority:"primary",onClick:m,loading:a,disabled:!(d.length!==n.length||d.some((e,t)=>{if(t>=n.length)return!0;let i=n[t];return!i||e.column!==i.column||e.relation!==i.relation||e.value!==i.value}))||d.some(e=>e.staged&&(!e.relation||!e.value)),children:v("Save changes")})]})]})]})});function XC(e){let{options:t,value:i,onChange:n}=e,r=t.map(e=>"string"==typeof e?{value:e,label:e}:e),o=Array.isArray(i)?i.map(e=>"object"==typeof e&&"value"in e?e.value:e):""===i?[]:[i];return(0,Z.tZ)(Xh.N,{options:r,value:o,onChange:n})}let Xx=e=>{let{setIsAddModalOpen:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.BX)(sh,{children:[(0,Z.tZ)(sx.M5,{children:(0,Z.tZ)(iZ.e,{src:"/img/publish/empty-subscribe.png",maxWidth:120,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,Z.BX)(et.sg,{gap:4,children:[(0,Z.tZ)(ei.xv.H4,{color:"primary",children:i("Start getting subscribers")}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:i("Share your Substack on other platforms to start getting subscribers, or start by adding a few emails manually.")})]}),(0,Z.BX)(et.sg,{gap:8,children:[(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>{t(!0)},children:i("Share now")}),(0,Z.tZ)(ee.zx,{priority:"secondary",href:(0,j.xOy)(),children:i("Add subscribers")})]})]})},XS=e=>{let{isOpen:t,onClose:i,pub:n,count:r,getSubSet:o}=e,[a,l]=(0,A.eJ)(!1),[s,d]=(0,A.eJ)("Confirm your subscription for ".concat(n.name)),[c,u]=(0,A.eJ)("We noticed that you haven't opened any of the newsletter posts you received and want to make sure youâ€™re still interested. If youâ€™d like to stay on the list, please confirm by clicking the button below. Otherwise we will remove you from this mailing list, and youâ€™ll no longer receive posts from ".concat(n.name)),p=async()=>{l(!0);try{let e=await o();await N().post("/api/v1/subscriber_set/prune").send({subscriberSetId:e.body.id,subject:s,message:c}),l(!1);let t="We're sending re-engagment emails and pruning ".concat((0,er.pluralize)(r,"email")," from your list. Stats on this page should update shortly.");alert(t),document.location.reload()}catch(e){l(!1),alert("Error starting email pruning: ".concat((0,Y.zx)(e)))}};return(0,Z.tZ)(eK.u_,{isOpen:t,onClose:i,testId:"pruning-email-modal",children:(0,Z.BX)(eK.fe,{children:[(0,Z.tZ)(ei.xv.H4,{children:"Prune Inactive Emails"}),(0,Z.BX)(ei.xv.B4,{children:[(0,Z.BX)("p",{children:["We have found ",(0,er.pluralize)(r,"inactive subscriber")," that are eligible for pruning. Customize the following subject and message, and we will send a re-engagement email to those subscribers before removing them from your list."]}),(0,Z.BX)("form",{className:"pruningEmailForm-LIqgfI",children:[(0,Z.tZ)(ij.n,{label:"Subject",value:s,onChange:d,paddingBottom:16}),(0,Z.tZ)(ln,{label:"Message",value:c,onChange:u}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{onClick:p,disabled:a,priority:"primary",children:a?"Loading...":"Prune ".concat((0,er.pluralize)(r,"email"))}),secondaryButton:(0,Z.tZ)(ee.zx,{onClick:i,disabled:a,priority:"secondary",children:"Cancel"})})]})]})]})})};class Xk extends w.Component{render(e,t){let{count:i,singleton:n}=e,{loading:r}=t,o=n?[(0,Z.tZ)("h4",{children:"Remove Email"}),n.is_subscribed?n.is_bitcoin?(0,Z.tZ)("p",{children:"This user will be removed from your email list. Because they have a Bitcoin subscription, they will not receive a refund."}):(0,Z.tZ)("p",{children:"This user will be issued a pro-rated refund before being removed from the list."}):(0,Z.tZ)("p",{children:"This user will be removed from your email list."})]:[(0,Z.tZ)("h4",{children:"Remove Emails"}),(0,Z.BX)("p",{children:["You've selected ",i," email",(null!=i?i:0)>1?"s":"","."]}),(0,Z.tZ)("p",{children:"If any of these emails have paid subscriptions, they will be issued a pro-rated refund before being removed from the list. Free subscribers will simply be removed from your email list."})];return(0,Z.BX)(L.p,{className:"remove-sub-modal",ref:this.modal,openByDefault:!1,onBeforeClose:this.props.onClose,noExit:r,children:[o,(0,Z.BX)("div",{className:"buttons",children:[(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:this.props.singleton?this.removeSubSingleton:this.removeSubBatch,disabled:r,children:r?"Loading...":"Remove email".concat((null!=i?i:0)>1?"s":"")}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:this.close,disabled:r,children:"Cancel"})]})]})}constructor(...e){super(...e),(0,M._)(this,"modal",(0,w.createRef)()),(0,M._)(this,"removeSubSingleton",async()=>{this.setState({loading:!0});try{var e,t;if(!this.props.singleton)throw console.error("singleton not set, cannot removeSubSingleton"),Error("singleont not defined");await N().delete("/api/v1/subscriber-stats/remove/".concat(this.props.singleton.user_email_address)),this.setState({loading:!1}),null===(e=(t=this.props).refresh)||void 0===e||e.call(t)}catch(e){this.setState({loading:!1}),alert("Error removing email: ".concat((0,Y.zx)(e)))}finally{this.close()}}),(0,M._)(this,"removeSubBatch",async()=>{this.setState({loading:!0});try{if(!this.props.getSubSet)throw Error("getSubSet not defined");let e=await this.props.getSubSet();await N().post("/api/v1/subscriber_set/remove_subscriber").send({subscriberSetId:e.body.id}),this.setState({loading:!1});let t=1===this.props.count?"We're now attempting to remove 1 email from your list.":"We're now attempting to remove ".concat(this.props.count," emails from your list.");t+=" Results should be available on this page shortly.",alert(t),document.location.reload()}catch(e){this.setState({loading:!1}),alert("Error removing emails: ".concat((0,Y.zx)(e))),this.close()}}),(0,M._)(this,"open",()=>{this.modal.current&&this.modal.current.open()}),(0,M._)(this,"close",()=>{this.modal.current&&this.modal.current.close()})}}var XB=i(70522),XT=i(71460),XI=i(42205),XN=i(11025),XP=i(39705),XE=i(12799),XX=i(50384);function XM(){let e=(0,G._)(["Paid subscription canceled with refund (",")"]);return XM=function(){return e},e}function XA(){let e=(0,G._)(["This will cancel the paid subscription for "," and issue a refund. You can also turn off auto-renew to have their paid subscription end after the current billing period."]);return XA=function(){return e},e}function XD(){let e=(0,G._)(["This will cancel the paid subscription for "," and issue a refund."]);return XD=function(){return e},e}function XR(){let e=(0,G._)(["This will cancel the paid subscription for "," and move them to the free plan. They will then be eligible to request a full refund."]);return XR=function(){return e},e}function XF(){let e=(0,G._)(["This will cancel the paid subscription for "," and move them to the free plan."]);return XF=function(){return e},e}function XL(){let e=(0,G._)(["This will end the paid trial for "," and move them to the free plan."]);return XL=function(){return e},e}let Xz=e=>{let{isOpen:t,setOpen:i,details:n,refresh:r}=e,{iString:o,iTemplate:a}=(0,Q.M1)(),l=(0,iN.pm)(),[s,d]=(0,A.eJ)(!1),{id:c,type:u,stripeSub:p}=n,h=null==p?void 0:p.cancel_at_period_end,m=!p||"ios_app"===u,g=(null==p?void 0:p.status)==="trialing"&&!(null==p?void 0:p.metadata.extended),v=()=>{i(!1),d(!1)},b=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(s)return;let{refund:t,fullRefund:i,canceledAtPeriodEnd:n}=e;try{d(!0);let e=await N().post("/api/v1/subscriber/cancel_subscription").send({subId:c,refund:t,fullRefund:i,canceledAtPeriodEnd:n});await new Promise(e=>setTimeout(e,250)),r&&await r();let s=n?o("Auto-renew disabled"):t||i?e.body.refundAmount?a(XM(),e.body.refundAmount):o("Paid subscription canceled with refund"):o("Paid subscription canceled");l.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:s}))),v()}catch(e){console.error("Error during cancel operation:",e),alert((0,Y.zx)(e))}finally{d(!1)}};return(0,Z.tZ)(tU.w,{children:m?(0,Z.tZ)(XU,{isOpen:t,isSubmitting:s,handleCancelSubscription:b,handleClose:v,isAppSub:"ios_app"===u,details:n}):g?(0,Z.tZ)(XY,{isOpen:t,isSubmitting:s,handleCancelSubscription:b,handleClose:v,details:n}):(0,Z.tZ)(XO,{isOpen:t,isSubmitting:s,handleCancelSubscription:b,handleClose:v,alreadySetToCancel:h,details:n})})},XO=e=>{let{isOpen:t,isSubmitting:i,handleCancelSubscription:n,handleClose:r,alreadySetToCancel:o,details:a}=e,{iString:l,iTemplate:s}=(0,Q.M1)();return(0,Z.BX)(eK.u_,{isOpen:t,onClose:()=>r(),children:[(0,Z.tZ)(mK.xB,{title:l("Cancel paid subscription?"),description:s(o?XD():XA(),a.email),showClose:!0,onClose:()=>r(),icon:(0,Z.tZ)(XH,{})}),(0,Z.tZ)(eK.ex,{}),(0,Z.tZ)(XX.m,{direction:"column",showDivider:!0,primaryButton:(0,Z.tZ)(XJ,{onClick:()=>n({refund:!0}),loading:i}),secondaryButton:(0,Z.tZ)(XV,{onClick:()=>n({fullRefund:!0}),loading:i}),tertiaryButton:o?void 0:(0,Z.tZ)(Xq,{onClick:()=>n({canceledAtPeriodEnd:!0}),loading:i})})]})},XU=e=>{let{isOpen:t,isSubmitting:i,handleCancelSubscription:n,isAppSub:r,handleClose:o,details:a}=e,{iString:l,iTemplate:s}=(0,Q.M1)();return(0,Z.BX)(eK.u_,{isOpen:t,onClose:()=>o(),children:[(0,Z.tZ)(mK.xB,{title:l("Cancel paid subscription?"),description:s(r?XR():XF(),a.email),showClose:!0,onClose:()=>o(),icon:(0,Z.tZ)(XH,{})}),(0,Z.tZ)(eK.ex,{}),(0,Z.tZ)(XX.m,{direction:"column",showDivider:!0,primaryButton:(0,Z.tZ)(XW,{onClick:()=>n(),loading:i}),secondaryButton:(0,Z.tZ)(Xj,{onClick:()=>o()})})]})},XY=e=>{let{isOpen:t,isSubmitting:i,handleCancelSubscription:n,handleClose:r,details:o}=e,{iString:a,iTemplate:l}=(0,Q.M1)();return(0,Z.BX)(eK.u_,{isOpen:t,onClose:()=>r(),children:[(0,Z.tZ)(mK.xB,{title:a("End paid trial?"),description:l(XL(),o.email),showClose:!0,onClose:()=>r(),icon:(0,Z.tZ)(XH,{})}),(0,Z.tZ)(eK.ex,{}),(0,Z.tZ)(XX.m,{direction:"column",showDivider:!0,primaryButton:(0,Z.tZ)(XG,{onClick:()=>n(),loading:i}),secondaryButton:(0,Z.tZ)(Xj,{onClick:()=>r()})})]})},XH=()=>(0,Z.tZ)(mK.AM,{bg:"accent-red",icon:(0,Z.tZ)(pw.Z,{color:"var(--color-semantic-error-fg-primary)"})}),Xj=e=>{let{onClick:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:t,children:i("Dismiss")})},XJ=e=>{let{onClick:t,loading:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:t,loading:i,children:n("Cancel with prorated refund")})},XV=e=>{let{onClick:t,loading:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"secondary-destructive",onClick:t,loading:i,children:n("Cancel with full refund")})},Xq=e=>{let{onClick:t,loading:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"secondary-destructive",onClick:t,loading:i,children:n("Turn off auto-renew")})},XW=e=>{let{onClick:t,loading:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:t,loading:i,children:n("Cancel paid subscription")})},XG=e=>{let{onClick:t,loading:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:t,loading:i,children:n("End paid trial")})};function XK(){let e=(0,G._)(["Comp until ",""]);return XK=function(){return e},e}function XQ(){let e=(0,G._)(["Comp for ",""]);return XQ=function(){return e},e}function X$(){let e=(0,G._)(["Comp ",""]);return X$=function(){return e},e}function X0(){let e=(0,G._)(["Give this user access to paid subscriber-only posts and features for a set duration."]);return X0=function(){return e},e}function X1(){let e=(0,G._)([""," days"]);return X1=function(){return e},e}let X2=e=>{let{isOpen:t,setOpen:i,details:n,refresh:r}=e,{iString:o,iTemplate:a}=(0,Q.M1)(),l=(0,iN.pm)(),s=(0,A.I4)(()=>vw()().add(7,"day").format("YYYY-MM-DD"),[]),[d,c]=(0,A.eJ)(7),[u,p]=(0,A.eJ)(s),[h,m]=(0,A.eJ)(!1),{email:g,paused:v}=n,b=0!==d&&(-1!==d||u);(0,A.d4)(()=>{p(s())},[s]);let y=()=>{i(!1),c(7),p(s()),m(!1)},w=async()=>{if(h)return;let e=Math.max(-1===d?vw()(u).diff(new Date,"day"):d,1);try{m(!0),await N().post("/api/v1/subscriber/add").send({email:g,subscription:!0,expiryDays:e}),await new Promise(e=>setTimeout(e,250)),r&&await r(),l.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:o("Subscriber comped")}))),y()}catch(e){console.error("Error during comp operation:",e),alert((0,Y.zx)(e))}finally{m(!1)}},C=X8(),x=b?-1===d?a(XK(),vw()(u).format("MMM D, YYYY")):d>365?o("Comp indefinitely"):a(XQ(),C(d).toLowerCase()):o("Select a comp duration");return(0,Z.tZ)(tU.w,{children:(0,Z.BX)(eK.u_,{isOpen:t,onClose:y,children:[(0,Z.tZ)(eK.xB,{title:a(X$(),g),showClose:!0,onClose:y,description:a(X0()),icon:(0,Z.tZ)(mK.AM,{icon:(0,Z.tZ)(XI.Z,{})})}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(et.X2,{gap:8,children:[(0,Z.tZ)(X4,{days:d,setDays:c,details:n}),-1===d&&!v&&(0,Z.tZ)(X3,{setExpiry:p,expiry:u})]})}),(0,Z.tZ)(eK.mz,{showDivider:!0,primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",disabled:!b,onClick:w,loading:h,children:x}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:y,children:o("Cancel")})})]})})};function X4(e){let{days:t,setDays:i,details:n}=e,{iString:r}=(0,Q.M1)(),o="ios_app"===n.type,a=X8();return(0,Z.BX)(oY.i,{onChange:e=>i(Number(e.currentTarget.value)),value:t,flex:"grow",children:[(0,Z.tZ)(oY.d,{children:r("Select a duration")}),(0,Z.tZ)("option",{value:7,children:a(7)}),(0,Z.tZ)("option",{value:30,children:a(30)}),(0,Z.tZ)("option",{value:90,children:a(90)}),!o&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("option",{value:183,children:a(183)}),(0,Z.tZ)("option",{value:365,children:a(365)}),(0,Z.tZ)("option",{value:36500,children:a(36500)}),(0,Z.tZ)("option",{value:-1,children:a(-1)})]})]})}function X3(e){let{setExpiry:t,expiry:i}=e;return(0,Z.tZ)(aT.Mt,{flex:"grow",value:i,onChange:e=>{t(e.currentTarget.value)},min:vw()().add(1,"day").format("YYYY-MM-DD"),max:vw()().add(10,"year").format("YYYY-MM-DD")})}function X8(){let{iString:e,iTemplate:t}=(0,Q.M1)();return i=>-1===i?e("Other"):183===i?e("6 months"):365===i?e("1 year"):36500===i?e("Forever"):t(X1(),i)}let X6=function(e){let{stripeSub:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,H.Z)(e).subtract((!t||t.cancel_at_period_end||"trialing"===t.status?0:"send_invoice"===t.billing?er.MANUAL_BILLING_DAYS_UNTIL_DUE:er.GRACE_PERIOD_DAYS)*24,"hour")};function X5(){let e=(0,G._)(["Extended subscription ",""]);return X5=function(){return e},e}function X9(){let e=(0,G._)(["Extend until ",""]);return X9=function(){return e},e}function X7(){let e=(0,G._)(["Extend for ",""]);return X7=function(){return e},e}function Me(){let e=(0,G._)(["This will add extra time to ","'s paid subscription at no additional cost."]);return Me=function(){return e},e}function Mt(){let e=(0,G._)(["Select a date after the current expiration (",")"]);return Mt=function(){return e},e}let Mi=e=>{let{isOpen:t,setOpen:i,details:n,refresh:r}=e,{iString:o,iTemplate:a}=(0,Q.M1)(),l=(0,iN.pm)(),s=(0,A.I4)(()=>X6(null==n?void 0:n.expiry,{stripeSub:null==n?void 0:n.stripeSub}).add(7,"day").format("YYYY-MM-DD"),[null==n?void 0:n.expiry,null==n?void 0:n.stripeSub]),[d,c]=(0,A.eJ)(7),[u,p]=(0,A.eJ)(s),[h,m]=(0,A.eJ)(!1),{email:g,expiry:v,stripeSub:b}=n,y=n.paused,w=0!==d&&(-1!==d||u),C=X6(v,{stripeSub:b}).format("YYYY-MM-DD");(0,A.d4)(()=>{p(s())},[null==n?void 0:n.expiry,null==n?void 0:n.stripeSub,s]);let x=()=>{i(!1),c(7),p(s()),m(!1)},S=async()=>{if(h)return;let e=d,t=X6(v,{stripeSub:b});if(-1===d){if(!u||vw()(u).isBefore(t))return;e=Math.ceil(vw()(u).diff(t,"days",!0))}try{m(!0),await N().post("/api/v1/subscriber/".concat(g,"/extend")).send({days:e}),await new Promise(e=>setTimeout(e,250)),r&&await r();let i=t.add(e,"day"),n=e>365?"indefinitely":"until ".concat(i.format("MMM D, YYYY"));l.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:a(X5(),n)}))),x()}catch(e){console.error("Error during extend operation:",e),alert((0,Y.zx)(e))}finally{m(!1)}},k=X8(),B=w?-1===d?a(X9(),vw()(u).format("MMM D, YYYY")):d>365?o("Extend indefinitely"):a(X7(),k(d).toLowerCase()):o("Select an extension length");return(0,Z.tZ)(tU.w,{children:(0,Z.BX)(eK.u_,{isOpen:t,onClose:x,children:[(0,Z.tZ)(eK.xB,{title:o("Extend paid subscription"),showClose:!0,onClose:x,description:a(Me(),g),icon:(0,Z.tZ)(mK.AM,{icon:(0,Z.tZ)(XP.Z,{})})}),(0,Z.tZ)(eK.fe,{children:(0,Z.BX)(tD.fv,{children:[(0,Z.BX)(et.X2,{gap:8,children:[(0,Z.tZ)(Mn,{days:d,setDays:c,details:n}),-1===d&&!y&&(0,Z.tZ)(Mr,{setExpiry:p,expiry:u,minDate:C})]}),-1===d&&!y&&u&&vw()(u).isBefore(C)&&(0,Z.tZ)(tM.y,{children:a(Mt(),vw()(C).format("MMM D, YYYY"))}),-1===d&&y&&(0,Z.tZ)(tM.y,{children:o("This subscription is paused and cannot be extended to a custom date.")})]})}),(0,Z.tZ)(eK.mz,{showDivider:!0,primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:S,loading:h,disabled:!w||-1===d&&(y||vw()(u).isBefore(C)),children:B}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:x,children:o("Cancel")})})]})})};function Mn(e){let{days:t,setDays:i,details:n}=e,{iString:r}=(0,Q.M1)(),o="ios_app"===n.type,a=X8();return(0,Z.BX)(oY.i,{onChange:e=>i(Number(e.currentTarget.value)),value:t,flex:"grow",children:[(0,Z.tZ)(oY.d,{children:r("Select a duration")}),(0,Z.tZ)("option",{value:7,children:a(7)}),(0,Z.tZ)("option",{value:30,children:a(30)}),(0,Z.tZ)("option",{value:90,children:a(90)}),!o&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("option",{value:183,children:a(183)}),(0,Z.tZ)("option",{value:365,children:a(365)}),(0,Z.tZ)("option",{value:36500,children:a(36500)}),(0,Z.tZ)("option",{value:-1,children:a(-1)})]})]})}function Mr(e){let{setExpiry:t,expiry:i,minDate:n}=e;return(0,Z.tZ)(aT.Mt,{flex:"grow",value:i,onChange:e=>{t(e.currentTarget.value)},min:n,max:vw()().add(10,"year").format("YYYY-MM-DD")})}function Mo(){let e=(0,G._)(["This will remove "," from your list and prevent them from receiving future emails. "]);return Mo=function(){return e},e}let Ma=e=>{let t,{isOpen:i,setOpen:n,details:r,pub:o}=e,{iString:a,iTemplate:l}=(0,Q.M1)(),[s,d]=(0,A.eJ)(!1),{email:c,type:u,membership_state:p}=r,h="subscribed"===p,m="bitcoin"===u,g="ios_app"===u,v=()=>{n(!1),d(!1)},b=async()=>{if(!s)try{d(!0),await N().delete("/api/v1/subscriber/".concat(c,"?disable_email=true")),document.location.pathname=(0,j.dIB)(o)}catch(e){console.error("Error during remove operation:",e),alert((0,Y.zx)(e)),d(!1)}};return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(dj.W,{isOpen:i,onClose:v,title:a("Remove from email list?"),description:(t=l(Mo(),c),h&&(m?t+=a("Because they subscribed using Bitcoin, they will not receive a refund."):g?t+=a("Because they subscribed via the iOS app, they will be eligible to request a full refund."):t+=a("This will also cancel their paid subscription and issue a prorated refund.")),t),icon:(0,Z.tZ)(mK.AM,{bg:"accent-red",icon:(0,Z.tZ)(iW.Z,{color:"var(--color-semantic-error-fg-primary)"})}),primaryButton:(0,Z.tZ)(ee.zx,{priority:"destructive",onClick:b,loading:s,children:a(!h||m||g?"Remove":"Remove and refund")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:v,children:a("Cancel")})})})};function Ml(){let e=(0,G._)(["Upgraded to founding"]);return Ml=function(){return e},e}function Ms(){let e=(0,G._)(["This will grant "," access to all founding member posts and benefits."]);return Ms=function(){return e},e}let Md=e=>{let{isOpen:t,setOpen:i,details:n,refresh:r}=e,{iString:o,iTemplate:a}=(0,Q.M1)(),l=(0,iN.pm)(),[s,d]=(0,A.eJ)(!1),{email:c,id:u}=n,p=()=>{i(!1),d(!1)},h=async()=>{if(!s)try{d(!0),await N().post("/api/v1/subscriber/set_to_founding").send({subId:u}),await new Promise(e=>setTimeout(e,250)),r&&await r(),l.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:a(Ml())}))),p()}catch(e){console.error("Error during upgrade operation:",e),alert((0,Y.zx)(e))}finally{d(!1)}};return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(dj.W,{isOpen:t,onClose:p,title:o("Upgrade to founding tier?"),description:a(Ms(),c),icon:(0,Z.tZ)(mK.AM,{icon:(0,Z.tZ)(XN.Z,{})}),primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:h,loading:s,children:o("Upgrade")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:p,children:o("Cancel")})})})},Mc=e=>{let{details:t,pub:i,refresh:n,disabled:r,onOpen:o,onClose:a}=e,[l,s]=(0,A.eJ)(!1),[d,c]=(0,A.eJ)(!1),[u,p]=(0,A.eJ)(!1),[h,m]=(0,A.eJ)(!1),[g,v]=(0,A.eJ)(!1);return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(tC.v2,{onOpen:o,onClose:a,trigger:(0,Z.tZ)(ee.hU,{priority:"secondary-outline",disabled:r,children:(0,Z.tZ)(pu.Z,{size:20})}),children:t?(0,Z.tZ)(Mu,{details:t,pub:i,setIsCompModalOpen:s,setIsUpgradeModalOpen:p,setIsExtendModalOpen:c,setIsCancelModalOpen:v,setIsRemoveModalOpen:m}):(0,Z.tZ)(Mp,{})}),t&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(X2,{isOpen:l,setOpen:s,details:t,refresh:n}),(0,Z.tZ)(Md,{isOpen:u,setOpen:p,details:t,refresh:n}),(0,Z.tZ)(Xz,{isOpen:g,setOpen:v,details:t,refresh:n}),(0,Z.tZ)(Ma,{isOpen:h,setOpen:m,details:t,pub:i}),(0,Z.tZ)(Mi,{isOpen:d,setOpen:c,details:t,refresh:n})]})]})},Mu=e=>{var t;let{details:i,pub:n,setIsCompModalOpen:r,setIsUpgradeModalOpen:o,setIsExtendModalOpen:a,setIsCancelModalOpen:l,setIsRemoveModalOpen:s}=e,d=!!(null==n?void 0:n.plans)||!!(null==n?void 0:n.has_subscribers),c=d&&!!(null==n?void 0:null===(t=n.plans)||void 0===t?void 0:t.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding})),u=(null==i?void 0:i.membership_state)==="subscribed",p=null==i?void 0:i.is_founding,h=(null==i?void 0:i.email_disabled)&&Object.values((null==i?void 0:i.email_settings)||{}).every(e=>"disabled"===e),m=vw()(null==i?void 0:i.expiry).isAfter("2100-01-01"),g=!u&&d,v=u&&!m,b=u&&!p&&c,y=!h,f=g||v||b,_=u||y;return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(tC.xw,{isFirst:!0,children:[(0,Z.tZ)(M_,{details:i}),(0,Z.tZ)(Mf,{details:i}),(0,Z.tZ)(My,{details:i})]}),f&&(0,Z.BX)(tC.xw,{children:[g&&(0,Z.tZ)(Mh,{setIsModalOpen:r}),b&&(0,Z.tZ)(Mm,{setIsModalOpen:o}),v&&(0,Z.tZ)(Mg,{setIsModalOpen:a})]}),_&&(0,Z.BX)(tC.xw,{children:[u&&(0,Z.tZ)(Mv,{setIsModalOpen:l}),y&&(0,Z.tZ)(Mb,{setIsModalOpen:s})]})]})},Mp=()=>(0,Z.tZ)(et.M5,{padding:40,children:(0,Z.tZ)(iI.$j,{})}),Mh=e=>{let{setIsModalOpen:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(Z.HY,{children:(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(XI.Z,{}),onClick:()=>t(!0),children:i("Comp")})})},Mm=e=>{let{setIsModalOpen:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(XN.Z,{}),onClick:()=>t(!0),children:i("Upgrade subscription")})},Mg=e=>{let{setIsModalOpen:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(XP.Z,{}),onClick:()=>t(!0),children:i("Extend subscription")})},Mv=e=>{let{setIsModalOpen:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(pw.Z,{}),priority:"destructive",onClick:()=>t(!0),children:i("Cancel subscription")})},Mb=e=>{let{setIsModalOpen:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(iW.Z,{}),priority:"destructive",onClick:()=>t(!0),children:i("Remove from list")})},My=e=>{let{details:t}=e,{iString:i}=(0,Q.M1)();return t.name?(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(tN.Z,{}),onClick:async()=>{try{let e=await (0,ix.rd)("/api/v1/messages/dm/start",{method:"POST",json:{user_ids:[t.user_id],source:"writer-dashboard"}});(0,Y.uX)("".concat((0,j.SVA)(),"/chat/").concat(e.thread.id),{local_navigation:!1})}catch(e){console.error("Failed to start DM",e)}},children:i("Send message")}):null},Mf=e=>{let{details:t}=e,{iString:i}=(0,Q.M1)();return t.name?(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(gB.Z,{}),href:(0,j.NNq)({id:t.user_id,name:t.name}),children:i("View profile")}):null},M_=e=>{let{details:t}=e,{iString:i}=(0,Q.M1)(),n=(0,XE.g)();return(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(ph.Z,{}),onClick:()=>{n(t.email,"email")},children:i("Copy email")})};function MZ(e,t){let{auto:i=!0,updateComments:n}=t,[r,o]=(0,A.eJ)(),[a,l]=(0,A.eJ)(!1),s=(0,A.I4)(async()=>{try{let t=await N().get("/api/v1/subscriber/".concat(encodeURIComponent(null!=e?e:"")));o(t.body),n&&n({data:t.body.comments,hasMore:t.body.hasMoreComments})}catch(e){o(null),l(!0),alert((0,Y.zx)(e))}},[e,n]);return(0,A.d4)(()=>{e&&i&&s()},[s,e,i]),{details:r,hasError:a,setHasError:l,refreshSubscriber:s}}let Mw=eb(e=>{let{sub:t,refresh:i,batchActionPending:n,pub:r}=e,{iString:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(!1),{details:s}=MZ(t.user_email_address,{auto:a});return(0,Z.tZ)(tW.u,{text:o("Batch action pending"),disabled:!n,children:(0,Z.tZ)(Mc,{details:null!=s?s:null,pub:r,refresh:i,disabled:n,onOpen:()=>l(!0),onClose:()=>l(!1)})})}),MC=e=>{var{children:t,explanation:i,scrollingTable:n}=e,r=(0,ef._)(e,["children","explanation","scrollingTable"]);let o=(0,A.sO)(null),a=(0,A.sO)(null);return(0,Z.BX)("th",(0,_._)((0,f._)({},r),{ref:a,children:[i&&(0,Z.tZ)(uQ,{baseRef:a,hoverToggle:!0,onOpen:()=>{var e;null===(e=o.current)||void 0===e||e.open()},onClose:()=>{var e;null===(e=o.current)||void 0===e||e.close()},rootElement:document.getElementsByClassName("subscriber-stats-page")[0],scrollContainers:[n],children:(0,Z.tZ)(eY.Fx,{ref:o,noList:!0,className:"explanation",children:i})}),t]}))},Mx=e=>{var t,i,n;let{col:r,columnDetails:o,rollups:a,loading:l,order:s,setOrder:d,isNumber:c,scrollingTable:u}=e,{key:p}=r,h=null===(t=o[p])||void 0===t?void 0:t.name,m=null===(i=o[p])||void 0===i?void 0:i.explanation,g=null===(n=o[p])||void 0===n?void 0:n.className;if(a.has(p))return(0,Z.tZ)(MC,{explanation:m,scrollingTable:u,children:h},"header-".concat(p));let v=!!(l&&(null==s?void 0:s.direction)&&(null==s?void 0:s.by)===p),b=s&&"desc"===s.direction?(0,Z.tZ)(uq.Z,{}):(0,Z.tZ)(uW,{});return(0,Z.tZ)(MC,{className:k()("sortable",g,{number:c(p),silhouette:v}),onClick:()=>{s&&s.by===p&&"asc"!==s.direction?null==d||d({by:p,direction:"asc"}):null==d||d({by:p,direction:"desc"})},explanation:m,scrollingTable:u,children:(0,Z.BX)("span",{children:[(0,Z.tZ)("span",{className:"label",children:(0,Z.tZ)("span",{className:"label-text",children:h})}),(0,Z.tZ)("span",{className:k()("indicator",{visible:(null==s?void 0:s.by)===p,desc:(null==s?void 0:s.direction)==="desc",asc:(null==s?void 0:s.direction)==="asc"}),children:b})]})},"header-".concat(p))},MS=(0,to.memo)(e=>{let{setSubStats:t,setOrder:i,subStats:{selected:n,subscribers:r,filters:o,order:a,count:l,isDynamic:s},batchSubscriberActions:d,pub:c,columns:u,columnDetails:p,refresh:h,schema:m,loadingMore:g,hasMore:v,showNames:b,showSubscriberActions:y,loading:f}=e,_=n.length===(null==r?void 0:r.length)&&n.length>0,w=(0,A.sO)(null),C=(0,A.sO)(null),[x,S]=(0,A.eJ)(null),B=new Set;Object.values(p).forEach(e=>{e.rollup&&B.add(e.rollup)});let T=(0,A.I4)(e=>{let t=null==m?void 0:m[e];return!!t&&("Int"===t.type||"BigInt"===t.type||"Float"===t.type)},[m]),I=(null==n?void 0:n.length)===(null==r?void 0:r.length)&&(null==n?void 0:n.length)>0;return(0,Z.BX)("div",{className:"scrolling-table-container",onScroll:e=>{let t=w.current;if((null==e?void 0:e.target)&&t){let i=e.target.scrollLeft||0;t.style.paddingLeft="".concat(i+12,"px")}},ref:C,children:[(0,Z.BX)("table",{className:k()("custom",{"no-actions":!y}),children:[(0,Z.BX)("thead",{children:[(0,Z.BX)("tr",{children:[y&&(0,Z.tZ)("th",{className:"check-header desktop-only",children:(0,Z.tZ)("input",{className:"check",type:"checkbox","data-testid":"subscribe-stats-table-checkbox",checked:_,onInput:()=>{_?t({isDynamic:!1,selected:[]}):r&&t({selected:r.map(e=>e.user_id)})}})}),(0,Z.tZ)("th",{children:"Subscriber"}),u.map(e=>(0,Z.tZ)(Mx,{col:e,columnDetails:p,rollups:B,loading:f,order:a,setOrder:i,isNumber:T,scrollingTable:C})),y&&(0,Z.tZ)("th",{})]}),I&&v&&(0,Z.tZ)("tr",{children:(0,Z.tZ)("td",{className:"selection-info",colSpan:u.length+3,ref:w,children:s?(0,Z.BX)("span",{children:["All ",(0,er.numberToString)(l)," ",(null==o?void 0:o.length)?"matching readers selected.":"subscribers selected."," ",(0,Z.tZ)("span",{className:"selection-action",onClick:()=>t({isDynamic:!1,selected:[]}),children:"Clear selection"})]}):(0,Z.BX)("span",{children:[(0,er.numberToString)((null==n?void 0:n.length)||0)," ",(null==o?void 0:o.length)?"matching readers selected.":"subscribers selected."," ",(0,Z.BX)("span",{className:"selection-action",onClick:()=>t({isDynamic:!s}),children:["Select"," ",(null==o?void 0:o.length)?"all ".concat((0,er.numberToString)(l)):"everyone (".concat((0,er.numberToString)(l),")")]})]})})})]}),(0,Z.BX)("tbody",{children:[null==r?void 0:r.map(e=>(0,Z.tZ)(MI,{sub:e,pub:c,columns:u,columnDetails:p,isNumber:T,checked:_||n.includes(e.user_id),setChecked:(i,o)=>{if(i){if(o&&x&&n.length){let i=r.findIndex(e=>{let{user_id:t}=e;return t===x}),o=r.findIndex(t=>{let{user_id:i}=t;return i===e.user_id}),a=r.slice(Math.min(i,o),Math.max(i,o)+1).map(e=>{let{user_id:t}=e;return t});t({selected:B0()(n.concat(a))})}else t({selected:B0()(n.concat(e.user_id))});S(e.user_id)}else x===e.user_id&&S(null),t({selected:n.filter(t=>t!==e.user_id),isDynamic:!1})},refresh:h,showNames:null!=b&&b,showSubscriberActions:null!=y&&y,batchActionPending:d.length>0,loading:null!=f&&f,order:a},"row-".concat(e.user_email_address))),g&&(0,Z.tZ)(MP,{numCols:u.length,showSubscriberActions:null!=y&&y})]})]}),(!r||0===r.length)&&(0,Z.BX)("div",{className:"empty-table",children:[(0,Z.tZ)(xT.Z,{size:20}),(0,Z.tZ)("p",{children:"No results found"})]})]})},(e,t)=>{var i,n;return eC()(e.subStats.selected,t.subStats.selected)&&eC()(e.subStats.filters,t.subStats.filters)&&eC()(e.subStats.isDynamic,t.subStats.isDynamic)&&eC()(e.subStats.count,t.subStats.count)&&eC()(e.hasMore,t.hasMore)&&eC()(e.loading,t.loading)&&eC()(null===(i=e.subStats.subscribers)||void 0===i?void 0:i.map(e=>e.user_id),null===(n=t.subStats.subscribers)||void 0===n?void 0:n.map(e=>e.user_id))&&eC()(e.subStats.order,t.subStats.order)&&eC()(e.user,t.user)&&eC()(e.pub,t.pub)&&eC()(e.batchSubscriberActions,t.batchSubscriberActions)&&e.columns.length===t.columns.length&&e.loadingMore===t.loadingMore});function Mk(e){let{email:t}=e,[i,n]=(0,A.eJ)(!1);return(0,A.d4)(()=>{let e;return i&&(e=setTimeout(()=>n(!1),3e3)),()=>clearTimeout(e)},[i]),(0,Z.tZ)("span",{className:"copy-email",onClick:e=>{e.stopPropagation(),e.preventDefault(),(0,Y.vQ)(t),n(!0)},children:i?(0,Z.tZ)(eE.Z,{size:20,color:"var(--color-accent-fg-green)",className:"copy-email-icon"}):(0,Z.tZ)(ph.Z,{size:20,color:"var(--color-fg-secondary)",className:"copy-email-icon"})})}function MB(e){let{sub:t,showNames:i}=e;return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)("span",{className:"email",children:t.user_email_address}),i&&t.user_name&&(0,Z.BX)("span",{className:"user-name",children:["â—† ",t.user_name]}),!!t.bestseller_tier&&(0,Z.tZ)(et.hs,{alignItems:"center",paddingLeft:4,children:(0,Z.tZ)(XT.UserBadge,{userId:t.user_id,tier:t.bestseller_tier,size:"sm",tooltipOnHover:!0})})]})}function MT(e){let{c:t,col:i,sub:n,isNumber:r,loading:o,order:a}=e,l=!!(o&&(null==a?void 0:a.direction)&&(null==a?void 0:a.by)===t.key);return(0,Z.tZ)("td",{className:k()(i.className,{number:r(t.key)}),children:(0,Z.tZ)("p",{className:k()("table-content",{silhouette:l}),children:(0,Z.tZ)("span",{className:"outer",children:(0,Z.tZ)("span",{className:k()("text",i.className),children:i.valueFn?i.valueFn(n):n[t.key]})})})},"cell-".concat(n.user_email_address,"-").concat(t.key))}let MI=e=>{let{sub:t,isNumber:i,columns:n,columnDetails:r,checked:o,setChecked:a,refresh:l,batchActionPending:s,showNames:d,showSubscriberActions:c,loading:u,order:p,pub:h}=e,m=t.user_photo_url||(0,j.I4e)(t.user_id);return(0,Z.BX)("tr",{className:k()({checked:o}),children:[c&&(0,Z.tZ)("td",{className:"desktop-only",children:(0,Z.tZ)("input",{className:"check",type:"checkbox",checked:o,onClick:e=>a(!o,e.shiftKey)})}),(0,Z.tZ)("td",{className:"subscriber",children:(0,Z.BX)("a",{href:(0,j.pN7)(h,t.user_email_address),children:[(0,Z.tZ)(XB.m1,{photo_url:m,size:24,isStatic:!0,isBanned:!1}),(0,Z.tZ)(MB,{sub:t,showNames:d}),(0,Z.tZ)(Mk,{email:t.user_email_address})]})}),n.map(e=>(0,Z.tZ)(MT,{c:e,col:r[e.key],sub:t,isNumber:i,loading:u,order:p},e.key)),c&&(0,Z.tZ)("td",{className:"action-button-cell",children:(0,Z.tZ)(Mw,{batchActionPending:s,pub:h,refresh:l,sub:t})})]})},MN=e=>{let{numRows:t,numCols:i,showSubscriberActions:n}=e;return(0,Z.tZ)("div",{className:"scrolling-table-container",children:(0,Z.BX)("table",{className:k()("custom",{"no-actions":!n}),children:[(0,Z.tZ)("thead",{children:(0,Z.BX)("tr",{className:"table-head-silhouette",children:[n&&(0,Z.tZ)("th",{className:"check-header desktop-only",children:(0,Z.tZ)("input",{className:"check",type:"checkbox",disabled:!0})}),(0,Z.tZ)("th",{children:"\xa0"}),[...Array(i)].map(()=>(0,Z.tZ)("th",{children:"\xa0"}))]})}),(0,Z.tZ)("tbody",{children:[...Array(t)].map(()=>(0,Z.tZ)(MP,{numCols:i,showSubscriberActions:n}))})]})})},MP=e=>{let{numCols:t,showSubscriberActions:i}=e;return(0,Z.BX)("tr",{className:"table-row-silhouette",children:[i&&(0,Z.tZ)("td",{className:"desktop-only",children:(0,Z.tZ)("input",{className:"check",type:"checkbox",disabled:!0})}),(0,Z.BX)("td",{className:"subscriber",children:[(0,Z.tZ)(XB.m1,{photo_url:j.zUJ,size:24,isStatic:!0,isBanned:!1}),(0,Z.tZ)("p",{className:"table-content",children:"\xa0"})]}),[...Array(t)].map(()=>(0,Z.tZ)("td",{children:(0,Z.tZ)("p",{className:"table-content",children:"\xa0"})}))]})},ME=Xp(Xn)(MS),MX={container:"container-QEsrSF",top:"top-_144ru",menu:"menu-OSTILh",icon:"icon-KS87lU",rotated:"rotated-iISqkE"};function MM(){let e=(0,G._)(["Approved request for ",""]);return MM=function(){return e},e}function MA(){let e=(0,G._)(["Denied request for ",""]);return MA=function(){return e},e}function MD(){let e=(0,G._)(["You have "," ","."]);return MD=function(){return e},e}function MR(){let e=(0,G._)([""," selected"]);return MR=function(){return e},e}function MF(){let e=(0,G._)(["Approved request for ",""]);return MF=function(){return e},e}let ML={selected:[],subscribers:null,count:-1,isDynamic:!1,lastSync:null,filters:[]},Mz=function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return(0,f._)({},EV()((t?[...n,{column:"search",relation:"",value:t}]:n).filter(e=>!e.staged).map(t=>{var i;let{column:n,relation:r,value:o}=t,a=null===(i=e[n])||void 0===i?void 0:i.filterTranslator;return["".concat(n).concat(r),a?a(o):o]})),i&&"desc"===i.direction&&{order_by_desc_nulls_last:i.by},i&&"desc"!==i.direction&&{order_by:i.by})},MO=e=>{let{user:t,pub:i}=e,n=(0,A.sO)();return(0,Z.tZ)("div",{className:"page typography subscriber-stats-page",children:(0,Z.BX)(tU.w,{children:[(0,Z.tZ)(MU,{children:(0,Z.tZ)(Xx,{setIsAddModalOpen:()=>{var e;return null===(e=n.current)||void 0===e?void 0:e.open()}})}),(0,Z.tZ)(z.ZP,{ref:n,user:t,pub:i})]})})},MU=(0,sx.zo)({flex:"grow",display:"flex",direction:"column",justifyContent:"center",alignItems:"center",padding:20,gap:32,bg:"primary-hover"}),MY=e=>{let{columnDetails:t,batchSubscriberAction:i,subscriberSetId:n,pruningSubscribers:r,setIsExportModalOpen:o}=e,{subStats:{count:a,selected:l,search:s,order:d,filters:c,isDynamic:u},setSubStats:p}=(0,A.qp)(Xn),{pub:h}=ey(),m=u?null!=a?a:0:(null==l?void 0:l.length)||0,[g,v]=(0,A.eJ)(!1),b=(0,A.sO)(),[y,f]=(0,A.eJ)(!1),{iString:_,iTemplate:w}=(0,Q.M1)(),C=()=>{let e=u?{query:Mz(t,s,d,c)}:{user_ids:l};return N().post("/api/v1/subscriber_set").send(e)},x=()=>C().then(e=>(0,Y.uX)((0,j.qYj)(h,{type:"adhoc_email",subscriber_set_id:e.body.id}),{local_navigation:!1})),S=()=>(0,Y.uX)((0,j.qYj)(h,{type:"adhoc_email",subscriber_set_id:n})),B={hidden:!m&&!n};return(0,Z.tZ)(ik.H,{expanded:!(0===m&&!n&&!r),children:(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.BX)(da,{children:[(0,Z.BX)(et.X2,{alignItems:"center",gap:12,children:[(0,Z.BX)(et.tu,{children:[n?(0,Z.tZ)(ei.xv.B3,{weight:"medium",children:_("Send another hoc email")}):r&&m?(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(ei.xv.B3,{weight:"medium",children:[(0,er.pluralize)(m,"inactive subscription")," found. To continue,"]}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:(0,Z.BX)("ol",{children:[(0,Z.tZ)("li",{children:_("Click the 'Export' button above if you would like to save these addresses before continuing. After the process is complete, you will no longer have access to pruned emails through the CRM.")}),(0,Z.tZ)("li",{children:_("Next, click the 'Email' button to right to send a re-engagement email to these inactive subscribers. Users who click on this email will be kept on your list. You will have options for customizing the subject and content of this message.")}),(0,Z.tZ)("li",{children:_("After sending the re-engagement email, we will disable emails for these inactive users until they confirm they are interested. Users who confirm will be re-added to your list.")})]})})]}):r?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.B3,{weight:"semibold",children:_("No inactive subscriptions found.")}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:_("Click cancel to exit the pruning flow")})]}):(0,Z.tZ)(ei.xv.B3,{weight:"medium",children:w(MR(),m)}),i&&(0,Z.tZ)("span",{className:"batch-subscriber-action",children:i.description})]}),(0,Z.tZ)(ee.zx,{priority:"secondary-outline",size:"sm",onClick:()=>p({selected:[]}),children:_("Deselect")})]}),(0,Z.BX)(et.X2,{alignItems:"center",gap:8,children:[(0,Z.tZ)(ee.zx,{priority:"primary-mono",size:"sm",className:k()(B),onClick:()=>{r?f(!0):n?S():x()},disabled:!!i,"data-testid":"send-adhoc-email-button",children:_(n?"Email again":"Send email")}),!n&&(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{priority:"secondary-outline",size:"sm",className:k()(B),disabled:!!i,children:(0,Z.tZ)(pu.Z,{size:16})}),children:[(0,Z.BX)(tC.xw,{isFirst:!0,children:[(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(nE.Z,{}),onClick:()=>o(!0),children:_("Export")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(E$.Z,{}),onClick:()=>v(!0),children:_("Comp")})]}),(0,Z.tZ)(tC.xw,{children:(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(iW.Z,{}),onClick:()=>{var e;return null===(e=b.current)||void 0===e?void 0:e.open()},priority:"destructive",children:_("Remove")})})]})]}),(0,Z.tZ)(Xr,{isOpen:g,onClose:()=>v(!1),getSubSet:C}),(0,Z.tZ)(Xk,{ref:b,count:m,getSubSet:C}),(0,Z.tZ)(XS,{isOpen:y,onClose:()=>f(!1),count:m,pub:h,getSubSet:C})]})})})},MH=e=>{var t,i;let{subscriptionRequests:n}=e,{iString:r,iTemplate:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)(null!=n?n:[]),[s,d]=(0,A.eJ)((null==n?void 0:n.length)||0),[c,u]=(0,A.eJ)(0),[p,h]=(0,A.eJ)(!1),m=fM("/api/v1/subscription/requests",{limit:10,offset:c});return(0,A.d4)(()=>{var e,t,i;d(null==m?void 0:null===(e=m.data)||void 0===e?void 0:e.total),(null==m?void 0:null===(i=m.data)||void 0===i?void 0:null===(t=i.rows)||void 0===t?void 0:t.length)&&l(e=>{var t,i;let n=new Set(e.map(e=>e.user_id));return[...e,...(null!==(i=null===(t=m.data)||void 0===t?void 0:t.rows)&&void 0!==i?i:[]).filter(e=>!n.has(e.user_id))]})},[null==m?void 0:null===(t=m.data)||void 0===t?void 0:t.total,null==m?void 0:null===(i=m.data)||void 0===i?void 0:i.rows]),a&&a.length||!eS()(s)&&s>(null==a?void 0:a.length)?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ei.xv.H1,{paddingBottom:24,translated:!0,children:"Subscriber requests"}),(0,Z.tZ)("div",{className:"subscription-request-table",children:a.map(e=>{let{user_id:t,user:i}=e;return(0,Z.BX)("div",{className:"subscription-request-row",children:[(0,Z.tZ)("img",{src:(0,j.zF4)(i.photo_url||j.zUJ,40)}),(0,Z.BX)("span",{children:[i.name||i.email,i.name?(0,Z.BX)("span",{className:"email",children:[" (",i.email,")"]}):""]}),(0,Z.tZ)(ee.zx,{className:"approve primary",onClick:async()=>{try{h(!0),await N().post("/api/v1/subscription/request/accept").send({user_id:t}),h(!1),l(a.filter(e=>e.user_id!==t)),d((null!=s?s:NaN)-1),(0,O.ZP)(o(MF(),i.name||i.email))}catch(e){alert((0,Y.zx)(e))}},disabled:p,children:r("Approve")}),(0,Z.tZ)(ee.zx,{className:"deny",onClick:async()=>{try{h(!0),await N().delete("/api/v1/subscription/request/deny").send({user_id:t}),h(!1),l(a.filter(e=>e.user_id!==t)),d((null!=s?s:NaN)-1),(0,O.ZP)("Deleted request for ".concat(i.name||i.email))}catch(e){alert((0,Y.zx)(e))}},disabled:p,children:r("Delete")})]})})}),!eS()(s)&&s>a.length?(0,Z.tZ)(ee.zx,{className:"primary subscription-request-load-more",onClick:async()=>{u(c+10)},children:r("Load more")}):null,(0,Z.tZ)("div",{className:"subscription-request-spacer"})]}):null},Mj=eb(e=>{let{user:t,pub:i,subscriptionRequests:n,subscriber_set_id:r,fs:o,s:a,o:l}=e,[s,d]=(0,A.eJ)(0),[c,u]=(0,A.eJ)(!1),[p,h]=(0,A.eJ)(!1),[m,g]=(0,A.eJ)(!1),[v,b]=(0,A.eJ)(E3),[y,w]=(0,A.eJ)(ML),[C,x]=(0,A.eJ)([]),[S,B]=(0,A.eJ)(null),[T,I]=(0,A.eJ)(null),[P,E]=(0,A.eJ)(!1),[X,M]=(0,A.eJ)(null),[D,R]=(0,A.eJ)(!1),[F,L]=(0,A.eJ)(!1),[z,U]=(0,A.eJ)(!1),{iString:J,iTemplate:V,iPlural:q,language:W}=(0,Q.M1)(),{fs:G,s:K,o:$}=(0,ID.Z)({fs:e=>e&&e.length&&Array.isArray(e)?JSON.stringify(e.filter(e=>null!=e&&!Reflect.get(e,"staged")).map(e=>eI()(e,["column","relation","value"]))):void 0,o:JSON.stringify,s:null}),ei=o||"[]",en=JSON.parse(ei),eo=Array.isArray(en)?en:[],ea=a||"",el=JSON.parse(l||"null")||{by:"subscription_created_at",direction:"desc"},es=(0,A.Ye)(()=>({setSubStats:e=>w((0,f._)({},y,e)),setOrder:$,setFilters:G,subStats:(0,_._)((0,f._)({},y),{filters:eo,search:ea,order:el})}),[y,ei,ea,l]),ed=(0,pY.XA)(),{setSubStats:ec,subStats:{selected:eu,count:ep,isDynamic:eh,lastSync:em}}=es,eg=s+50<ep,[ev,eb,ef]=E1([]),{crmSchema:e_}=ey(),eZ=(0,ss.So)(),ew=(0,io.xR)(),ex=!!eZ.getSettingFor("list_pruning_required_by")||ew.getConfigFor("list_pruning_enabled"),eS=r&&parseInt(r)||null,ek=Xe(i),eB=(0,A.Ye)(()=>(0,Z.tZ)(Pk,{pub:i}),[i]);Object.keys(ek).forEach(e=>{let t=ek[e];if(!t||!(null==t?void 0:t.name))return null;ek[e]=(0,f._)({},t,t.name&&{name:J(t.name)},t.explanation&&{explanation:J(t.explanation)})});let eT=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e&&d(0),(0,f._)({filters:Mz(ek,ea,el,eo),limit:50,offset:e?0:s},eS&&{subscriberSetId:eS})};(0,A.d4)(()=>{(async()=>{if(!y.subscribers)try{let{subscribers:e,count:t,columnView:i,chartCounts:n,batchSubscriberActions:r,lastSync:o,pendingImports:a}=(await N().post("/api/v1/subscriber-stats").send(eT())).body;ec({subscribers:e,count:t,lastSync:o}),B(n),I(a),x(r),i&&b(Xt(i))}catch(e){console.error("failed to get stats",e)}})()},[]),(0,A.d4)(()=>{(async()=>{0!==s&&(g(!0),await eN())})()},[s]);let eN=async()=>{try{var e;let t=await N().post("/api/v1/subscriber-stats").send(eT()),i=gg()([...null!==(e=y.subscribers)&&void 0!==e?e:[],...t.body.subscribers],e=>{let{subscription_id:t}=e;return t});ec({subscribers:i,count:t.body.count,lastSync:t.body.lastSync})}catch(e){console.error("failed to get stats",e)}finally{g(!1)}},eP=async e=>{u(!0),e||h(!0),ec({selected:[]});try{let e=await N().post("/api/v1/subscriber-stats").send(eT(!0));return eb(e.body),e}catch(t){console.error("failed to get stats",t),u(!1),e||h(!1)}},eE=async()=>{u(!0);try{let e=await N().get("/api/v1/subscriber-stats/batch-actions");return x(e.body.batchSubscriberActions),e}catch(e){console.error("failed to get stats",e)}finally{u(!1)}};(0,A.d4)(()=>{y.subscribers&&eP()},[o]),(0,A.d4)(()=>{y.subscribers&&eP(!0)},[l]),(0,A.d4)(()=>{if(ev.length){let e=ef();if(e){let{subscribers:t,count:i,columnView:n,lastSync:r,batchSubscriberActions:o}=e;eC()(e.order,el)&&(ec({subscribers:t,count:i,columnView:n,lastSync:r}),x(o),0===C.length&&1===o.length&&E0(async()=>{var e;let t=await eE();return(null==t?void 0:null===(e=t.body)||void 0===e?void 0:e.batchSubscriberActions.length)===0},[5,10,20,60]),u(!1),h(!1))}}},[ev]);let eX=async e=>{if(b(e),!(null==t?void 0:t.is_global_admin))try{await N().put("/api/v1/subscriber-stats/columns").send({columnView:e})}catch(e){console.error(J("failed to update column settings"),e)}},eM=(0,A.I4)(ip()(eP,500),[ea]);(0,A.d4)(()=>{if(y.subscribers)return eM(),eM.cancel},[ea]),(0,A.d4)(()=>{if("undefined"!=typeof window){let{approved:e,denied:t}=(0,rY.m)(window.location.search);e?((0,O.ZP)(V(MM(),e)),(0,Y.iO)("approved")):t&&((0,O.ZP)(V(MA(),t)),(0,Y.iO)("denied"))}},[]);let eA=e=>{u(!0),null==K||K(e)},eF=e=>async()=>{try{let t=await N().get("/api/v1/subscriber_set/export/".concat(e));return M(t.body.url),E(!1),!0}catch(e){return!1}},eL=async()=>{D?(R(!1),ec({isDynamic:!1})):(R(!0),null==G||G([{column:"subscription_type",relation:"",value:"free"},{column:"num_email_opens",relation:"",value:"0"},{column:"free_attribution",relation:"_string_is",value:"import"},{column:"activity_rating",relation:"",value:"0"},{column:"links_clicked",relation:"",value:"0"},{column:"num_web_post_views",relation:"",value:"0"},{column:"num_emails_received",relation:"_gt",value:"5"},{column:"subscription_created_at",relation:"_lt",value:(0,H.Z)().subtract(2,"months").format("YYYY-MM-DD")}]),ec({isDynamic:!0}))},ez=async(e,t)=>{E(!0);try{let i={};i="everyone"===e?{query:Mz(ek,"",el,[])}:eh||!eu.length?{query:Mz(ek,ea,el,eo)}:{user_ids:eu};let n="all"===t?["user_email_address","user_name",...v.map(e=>e.key)]:["user_email_address","user_name",...v.filter(e=>e.visible).map(e=>e.key)],r=await N().post("/api/v1/subscriber_set").send(i),o=await N().post("/api/v1/subscriber_set/export").send({subscriberSetId:r.body.id,columns:n});E0(eF(o.body.export_id),[1,5,10,30,...EW()(30,()=>60)],()=>{E(!1)})}catch(e){E(!1)}},eO=(null==eo?void 0:eo.length)?"".concat(eo.length," ").concat(q("Filter","Filters",eo.length)):J("Filter"),eU=ea||!!(null==eo?void 0:eo.find(e=>"user_name"===e.column)),eY=!eS&&!D,eH=!eS,ej=T&&T.length>0;if(S&&0===S.totalEmail&&!ej)return(0,Z.tZ)(MO,{user:t,pub:i});let eJ=(0,er.pubCurrency)(i),eV=[{value:"__root__",label:i.name},...i.sections.map(e=>({label:e.name,value:e.id}))];return(0,Z.tZ)(Xn.Provider,{value:es,children:(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(dt,{className:k()(MX.container,"subscriber-stats-page"),children:(0,Z.BX)(et.tu,{gap:32,children:[(0,Z.BX)(dt,{className:MX.top,children:[(0,Z.tZ)(di,{title:J("Subscribers"),cta:(0,Z.tZ)(et.X2,{gap:8,children:(0,Z.tZ)(ee.zx,{priority:"primary",href:(0,j.xOy)(),children:ed?J("Add"):J("Add subscribers")})})}),eH&&(0,Z.tZ)(E2,{counts:S}),eH&&eB,(0,Z.tZ)(MH,{subscriptionRequests:n})]}),(0,Z.BX)(d6,{title:(()=>{let e=eo.length>0||ea?J("Results"):eS?J("Audience"):J("All subscribers");return"".concat(e," ").concat("number"==typeof ep&&ep>=0&&!c?"(".concat((0,er.numberToString)(ep),")"):"")})(),tag:em&&(0,Z.BX)(d_.Vp,{children:[J("Updated")," ",(0,H.Z)(em).locale(W).fromNow()]}),children:[ej&&(0,Z.tZ)(et.tu,{paddingBottom:12,children:(0,Z.tZ)(sx.A0,{href:(0,j.xOy)(),children:(0,Z.tZ)(oU.b,{title:V(MD(),T.length,q("pending import","pending imports",T.length)),description:J("It may take a few minutes for imported emails to appear in the table below."),Icon:eR.Z,priority:"secondary",theme:"warn",showClose:!1})})}),(0,Z.BX)(et.tu,{className:"options",justifyContent:"space-between",paddingBottom:12,children:[(0,Z.BX)(et.gq,{gap:8,alignItems:"center",justifyContent:"start",wrap:"wrap",children:[(0,Z.tZ)(Zg.M,{value:ea,onChange:e=>eA(e),placeholder:J("Search by name or email..."),maxLength:80,flex:"grow"}),(0,Z.tZ)(ee.zx,{leading:(0,Z.tZ)(hd.Z,{size:20}),priority:(null==eo?void 0:eo.length)?"primary-mono":"secondary-outline",className:(null==eo?void 0:eo.length)?"header-button-active":"",onClick:()=>{L(!F)},trailing:(0,Z.tZ)(tw.Z,{color:(null==eo?void 0:eo.length)?"var(--color-button-mono-fg)":void 0,className:k()(MX.icon,F&&MX.rotated)}),children:eO}),(0,Z.tZ)(tC.v2,{layerClassName:MX.menu,trigger:(0,Z.tZ)(ee.zx,{leading:(0,Z.tZ)(EG.Z,{size:20}),priority:"secondary-outline",children:J("Display")}),children:(0,Z.tZ)(Xo,{columnView:v,setColumnView:eX,columnDetails:ek})}),(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{priority:"secondary-outline",children:(0,Z.tZ)(pu.Z,{size:20})}),children:[(0,Z.tZ)(tC.xw,{isFirst:!0,children:(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(ta.Z,{}),href:(0,j.xOy)(),children:J("Add subscribers")})}),(0,Z.BX)(tC.xw,{children:[(0,Z.tZ)(tC.sN,{onClick:()=>U(!0),priority:P?"secondary":"primary",leading:P?(0,Z.tZ)(EK.Z,{size:20}):(0,Z.tZ)(nE.Z,{}),children:P?J("Exporting..."):J("Export")}),(0,Z.tZ)(tC.sN,{leading:(0,Z.tZ)(eD.Z,{}),href:(0,j.GIj)(),children:J("Manage group subscriptions")})]}),ex&&(0,Z.tZ)(tC.xw,{children:(0,Z.tZ)(tC.sN,{leading:D?(0,Z.tZ)(_b.Z,{size:20}):(0,Z.tZ)(EQ.Z,{size:20}),priority:D?"primary":"destructive",onClick:eL,children:D?J("Cancel pruning"):J("Prune inactive subscribers")})})]})]}),(0,Z.tZ)(MY,{subscriberSetId:eS,columnDetails:ek,batchSubscriberAction:C.length?C[0]:null,pruningSubscribers:D,setIsExportModalOpen:U}),(0,Z.tZ)(Xu,{doExport:ez,downloadURL:X,selected:eu,count:ep,exporting:P,filtering:eo.length>0||ea,isDynamic:eh,isOpen:z,onClose:()=>U(!1)})]}),(0,Z.tZ)(ik.H,{expanded:F,children:(0,Z.tZ)(et.sg,{paddingBottom:12,children:(0,Z.tZ)(s6.Z,{bg:"primary-hover",radius:"sm",shadow:"none",children:(0,Z.tZ)(Xw,{columnDetails:ek,schema:e_,loading:c,publicationCurrency:eJ,sectionOptions:eV,setShowFilters:L})})})}),!y.subscribers||p?(0,Z.tZ)(MN,{numRows:25,numCols:0,showSubscriberActions:eY}):(0,Z.tZ)(ME,{user:t,pub:i,columns:v.filter(e=>e.visible&&ek[e.key]),columnDetails:ek,refresh:eP,schema:e_,loadingMore:m,batchSubscriberActions:C,hasMore:eg,showNames:!!eU,showSubscriberActions:eY,loading:c}),eg&&(0,Z.tZ)(ee.zx,{disabled:m||c,onClick:()=>d(s+50),className:"primary",children:m||c?J("Loading..."):J("Load more...")})]}),(0,Z.tZ)(yH.ZP,{})]})})})})});function MJ(){let e=(0,G._)(["Until "," at ",""]);return MJ=function(){return e},e}function MV(){let e=(0,G._)(["Expired "," at ",""]);return MV=function(){return e},e}let Mq=e=>{let{details:t,onUnban:i}=e,n=t.bans.filter(e=>"comment"===e.type);return 0===n.length?null:(0,Z.tZ)(Z.HY,{children:n.map(e=>(0,Z.tZ)(MW,{ban:e,onUnban:i},e.id))})},MW=e=>{let{ban:t,onUnban:i}=e,{language:n}=(0,Q.M1)(),r=(0,H.Z)(t.expiry).isAfterNow(),o=new Intl.DateTimeFormat(n,{month:"short",day:"numeric",year:"numeric"}).format(new Date(t.expiry)),a=new Intl.DateTimeFormat(n,{hour:"numeric",minute:"numeric"}).format(new Date(t.expiry));return r?(0,Z.tZ)(MG,{date:o,time:a,onUnban:i}):(0,Z.tZ)(MK,{date:o,time:a})},MG=e=>{let{date:t,time:i,onUnban:n}=e,{iString:r,iTemplate:o}=(0,Q.M1)();return(0,Z.tZ)(oU.b,{priority:"secondary",theme:"error",title:r("Banned from commenting"),description:(0,Z.BX)(Z.HY,{children:[o(MJ(),t,i)," - ",(0,Z.tZ)(ei.hh,{decoration:"underline",onClick:n,cursor:"pointer",children:r("Remove ban")})]}),showClose:!1})},MK=e=>{let{date:t,time:i}=e,{iString:n,iTemplate:r}=(0,Q.M1)();return(0,Z.tZ)(oU.b,{priority:"secondary",theme:"warn",title:n("Previously banned from commenting"),description:(0,Z.tZ)(ei.xv,{children:r(MV(),t,i)}),showClose:!1})},MQ=e=>{let{comments:t,pub:i,hasMore:n,loading:r,loadMore:o}=e,{iString:a}=(0,Q.M1)();return t?0===t.length?(0,Z.tZ)(dr,{children:(0,Z.tZ)(ds,{})}):(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{bg:"secondary",borderLeft:"detail",borderBottom:"detail",children:[(0,Z.tZ)(gK,{children:a("Date")}),(0,Z.tZ)(gK,{children:a("Status")}),(0,Z.tZ)(gK,{children:a("Post")}),(0,Z.tZ)(gK,{children:a("Comment")})]})}),(0,Z.tZ)(gq,{children:t.map(e=>(0,Z.BX)(gG,{borderLeft:"detail",children:[(0,Z.tZ)(gQ,{width:140,children:(0,H.Z)(e.date).standardTime()}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(M$,{status:e.status})}),(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:220,children:e.post_title}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.hh,{target:"_blank",href:(0,j.MoQ)(i,e.slug,{commentId:e.id}),fontStyle:"italic",children:'"'.concat(e.body,'"')})})]},e.id))}),n&&(0,Z.tZ)(gW,{children:(0,Z.tZ)(gG,{children:(0,Z.tZ)(gQ,{colSpan:4,align:"center",children:(0,Z.tZ)(et.M5,{children:(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary",loading:r,onClick:()=>o(!0),children:a("Load more")})})})})})]})}):null},M$=e=>{let{status:t}=e,{iString:i}=(0,Q.M1)();switch(t){case oB.ql.moderator_removed:return(0,Z.tZ)(d_.Vp,{theme:"error",children:i("Removed")});case oB.ql.moderator_approved:return(0,Z.tZ)(d_.Vp,{theme:"success",children:i("Approved")});case oB.ql.published:return(0,Z.tZ)(d_.Vp,{theme:"success",children:i("Published")});case oB.ql.flagged:return(0,Z.tZ)(d_.Vp,{theme:"warn",children:i("Flagged")});case oB.ql.deleted:return(0,Z.tZ)(d_.Vp,{theme:"default",children:i("Deleted")});case oB.ql.new_commenter_approval_required:case oB.ql.edit_review_required:case oB.ql.review_required:return(0,Z.tZ)(d_.Vp,{theme:"warn",children:i("Needs review")});default:return(0,Z.tZ)(d_.Vp,{theme:"default",children:i(t)})}},M0=e=>{var t,i,n,r;let{details:o,pub:a}=e,{iString:l}=(0,Q.M1)();return(0,Z.BX)(dc,{children:[!o.parent_subscription_id&&(0,Z.tZ)(ml,{value:o.amount_paid,format:"currency",currency:(0,er.pubCurrency)(a),currencyIsCents:!0,title:l("Total revenue"),description:l("All time")}),(0,Z.tZ)(ml,{value:null!==(n=null===(t=o.crmData)||void 0===t?void 0:t.num_emails_received)&&void 0!==n?n:0,format:"number",title:l("Emails received"),description:l("Last 30 days")}),(0,Z.tZ)(ml,{value:null!==(r=null===(i=o.crmData)||void 0===i?void 0:i.num_emails_opened)&&void 0!==r?r:0,format:"number",title:l("Emails opened"),description:l("Last 30 days")})]})},M1=e=>{var t;let{details:i,pub:n,email:r,refreshSubscriber:o}=e,a=null===(t=i.crmData)||void 0===t?void 0:t.user_photo_url;return i.name?(0,Z.tZ)(dn,{leading:a?(0,Z.tZ)(eG.qE,{photoUrl:a,size:48}):null,title:i.name,description:r,cta:(0,Z.tZ)(Mc,{details:i,pub:n,refresh:o})}):(0,Z.tZ)(di,{title:r,cta:(0,Z.tZ)(Mc,{details:i,pub:n,refresh:o})})},M2=e=>{let{events:t,hasMore:i,loading:n,loadMore:r}=e,{iString:o}=(0,Q.M1)();return t?n&&0===t.length?(0,Z.tZ)(dr,{children:(0,Z.tZ)(dl,{})}):0===t.length?(0,Z.tZ)(dr,{children:(0,Z.tZ)(ds,{})}):(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{bg:"secondary",borderLeft:"detail",borderBottom:"detail",children:[(0,Z.tZ)(gK,{children:o("Date")}),(0,Z.tZ)(gK,{children:o("Event")}),(0,Z.tZ)(gK,{children:o("Post")})]})}),(0,Z.tZ)(gq,{children:t.map(e=>{var t;return(0,Z.BX)(gG,{borderLeft:"detail",children:[(0,Z.tZ)(gQ,{width:100,children:(0,H.Z)(e.timestamp).standardTime()}),(0,Z.tZ)(gQ,{width:180,children:null!==(t=e.text)&&void 0!==t?t:"n/a"}),(0,Z.tZ)(gQ,{children:M4(e)})]},e.timestamp)})}),i&&(0,Z.tZ)(gW,{children:(0,Z.tZ)(gG,{children:(0,Z.tZ)(gQ,{colSpan:4,align:"center",children:(0,Z.tZ)(et.M5,{children:(0,Z.tZ)(ee.zx,{size:"sm",priority:"secondary",loading:n,onClick:()=>r(!0),children:o("Load more")})})})})})]})}):null},M4=e=>{let t=[];e.post_url&&(t=[(0,Z.tZ)(ei.xv,{as:"span",children:(0,Z.tZ)(ei.hh,{href:e.post_url,target:"_blank",rel:"noopener",children:(0,er.truncateText)(e.post_title,100)})})]);let i=[];if("Like button"===e.url)i=[" (Like button)"];else if(e.url){let t=e.url;if((0,Y.Fo)(t)===(0,Y.Fo)(document.location.href)){var n;t=null!==(n=t.split("?")[0])&&void 0!==n?n:""}i=[(0,Z.BX)(ei.xv,{color:"secondary",fontStyle:"italic",as:"span",children:[" - ",(0,Z.tZ)(ei.hh,{href:t,target:"_blank",rel:"noopener",children:"Link"})]})]}return[...t,...i]};function M3(){let e=(0,G._)(["Open (",")"]);return M3=function(){return e},e}function M8(){let e=(0,G._)(["Click (",")"]);return M8=function(){return e},e}let M6=e=>{let{details:t,pub:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{bg:"secondary",borderLeft:"detail",borderBottom:"detail",children:[(0,Z.tZ)(gK,{children:n("Group")}),(0,Z.tZ)(gK,{children:n("Recent Activity")})]})}),t.child_emails.map((e,t)=>(0,Z.BX)(gG,{borderLeft:"detail",children:[(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.hh,{href:(0,j.pN7)(i,e.email),native:!0,children:e.email})}),(0,Z.tZ)(gQ,{children:(0,Z.tZ)(M5,{lastActivity:e})})]},t))]})})},M5=e=>{var t,i;let{lastActivity:n}=e,{iTemplate:r,language:o}=(0,Q.M1)();return(0,Z.BX)(w.Fragment,{children:[n.last_opened_at&&!(n.last_opened_at<(null!==(t=n.last_clicked_at)&&void 0!==t?t:0))&&(0,Z.tZ)("div",{children:r(M3(),(0,H.Z)(n.last_opened_at).locale(o).standardTime())}),n.last_clicked_at&&!(n.last_clicked_at<(null!==(i=n.last_opened_at)&&void 0!==i?i:0))&&(0,Z.tZ)("div",{children:r(M8(),(0,H.Z)(n.last_clicked_at).locale(o).standardTime())})]})},M9={grid:"grid-AIXs8B",mobile:"mobile-_B9dIs"};function M7(){let e=(0,G._)(["",""]);return M7=function(){return e},e}let Ae=e=>{var t;let{details:i,pub:n}=e,r=!!(null===(t=i.bans)||void 0===t?void 0:t.find(e=>"subscribe"===e.type&&(0,H.Z)(e.expiry).isAfterNow())),o="subscribed"===i.membership_state&&(!i.type||"ios_app"===i.type);return r?null:(0,Z.BX)(Ad,{children:[(0,Z.tZ)(At,{details:i}),(0,Z.tZ)(Ai,{details:i,pub:n}),(0,Z.tZ)(An,{details:i}),(0,Z.tZ)(Ar,{details:i}),o?(0,Z.tZ)(Ao,{details:i}):(0,Z.tZ)(Aa,{details:i}),(0,Z.tZ)(Al,{details:i,pub:n}),(0,Z.tZ)(As,{details:i})]})},At=e=>{var t,i;let{details:n}=e,r=!!(null===(t=n.bans)||void 0===t?void 0:t.find(e=>"subscribe"===e.type&&(0,H.Z)(e.expiry).isAfterNow())),o=n.email_disabled,a=!!n.parent_subscription_id,l=null===(i=n.stripeSub)||void 0===i?void 0:i.cancel_at_period_end,{iString:s}=(0,Q.M1)();return(0,Z.tZ)(Ag,{title:s("Subscription status"),children:(0,Z.BX)(et.X2,{gap:8,children:[r?(0,Z.tZ)(Ac,{}):l?(0,Z.tZ)(Ap,{}):(0,Z.tZ)(Au,{}),o&&(0,Z.tZ)(Ah,{}),a&&n.parent_subscription_id&&(0,Z.tZ)(Am,{href:(0,j.OGV)(n.parent_subscription_id)})]})})},Ai=e=>{let{details:t,pub:i}=e,{iString:n,iTemplate:r}=(0,Q.M1)(),o="subscribed"===t.membership_state,a=t.is_founding,l=t.type;return(0,Z.tZ)(Ag,{title:n("Subscription type"),children:o?l?(0,er.toTitleCase)(l):a?r(M7(),E6(i)):n("Paid subscriber"):n("Free subscriber")})},An=e=>{var t,i,n,r,o,a,l,s,d,c,u,p,h;let{details:m}=e,{iString:g}=(0,Q.M1)(),v="subscribed"===m.membership_state,b=null===(n=m.stripeSub)||void 0===n?void 0:null===(i=n.discount)||void 0===i?void 0:null===(t=i.coupon)||void 0===t?void 0:t.percent_off,y=null===(a=m.stripeSub)||void 0===a?void 0:null===(o=a.discount)||void 0===o?void 0:null===(r=o.coupon)||void 0===r?void 0:r.percent_off,f=null===(l=m.stripeSub)||void 0===l?void 0:l.plan;return v&&m.stripeSub&&f?(0,Z.BX)(Ag,{title:g("Subscription plan"),children:[b?(0,er.centsToPriceString)((null!==(s=null==f?void 0:f.amount)&&void 0!==s?s:0)*(1-(null!=y?y:0)/100),null!==(d=null==f?void 0:f.currency)&&void 0!==d?d:""):(0,er.centsToPriceString)(null!==(c=null==f?void 0:f.amount)&&void 0!==c?c:0,null!==(u=null==f?void 0:f.currency)&&void 0!==u?u:"")," ",(null==f?void 0:f.interval_count)===1?"/ ".concat(f.interval):"per ".concat(null!==(p=null==f?void 0:f.interval_count)&&void 0!==p?p:""," ").concat(null!==(h=null==f?void 0:f.interval)&&void 0!==h?h:"","s"),b&&" (".concat(null!=y?y:"","% Discount)")]}):null},Ar=e=>{let{details:t}=e,{iString:i,language:n}=(0,Q.M1)(),r=t.created_at,o=new Intl.DateTimeFormat(n,{month:"short",day:"numeric",year:"numeric"}).format(new Date(r));return(0,Z.tZ)(Ag,{title:i("Start date"),children:o})},Ao=e=>{let{details:t}=e,{iString:i}=(0,Q.M1)(),n=null===t.expiry||(0,H.Z)(t.expiry).isAfter("2100-01-01"),r=t.stripeSub&&t.stripeSub.cancel_at_period_end;return t.expiry?(0,Z.tZ)(Ag,{title:i(r?"End date":"Renewal date"),children:n?i("Forever"):X6(t.expiry,{stripeSub:t.stripeSub}).standardTime()}):null},Aa=e=>{let{details:t}=e,{iString:i,language:n}=(0,Q.M1)(),r=null===t.expiry,o=t.expiry;if(!o)return null;let a=new Intl.DateTimeFormat(n,{month:"short",day:"numeric",year:"numeric"}).format(new Date(o));return(0,Z.tZ)(Ag,{title:i("End date"),children:r?i("Forever"):a})},Al=e=>{let{pub:t,details:i}=e,{iString:n}=(0,Q.M1)(),r=i.gift_email;return"subscribed"===i.membership_state&&"gift"===i.type&&r&&r?(0,Z.tZ)(Ag,{title:n("Gifted from"),children:(0,Z.tZ)(ei.hh,{decoration:"underline",href:(0,j.pN7)(t,r),native:!0,children:r})}):null},As=e=>{let{details:t}=e,{iString:i}=(0,Q.M1)(),n=t.source;return n?(0,Z.tZ)(Ag,{title:i("Acquisition source"),children:_p()(n)}):null},Ad=e=>{let{children:t}=e,i=(0,pY.XA)();return(0,Z.tZ)(s6.Z,{shadow:"none",padding:16,children:(0,Z.tZ)(et.hs,{className:k()(M9.grid,i&&M9.mobile),children:t})})},Ac=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(d_.Vp,{theme:"error",children:e("Banned")})},Au=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(d_.Vp,{theme:"success",children:e("Active")})},Ap=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(d_.Vp,{theme:"warn",children:e("Canceled")})},Ah=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(d_.Vp,{theme:"default",children:e("Email disabled")})},Am=e=>{let{href:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(d_.Vp,{href:t,children:i("Group subscription")})},Ag=e=>{let{title:t,children:i}=e;return(0,Z.BX)(Av,{children:[(0,Z.tZ)(Ab,{children:t}),(0,Z.tZ)(Ay,{children:i})]})},Av=(0,sx.zo)({display:"flex",direction:"column",gap:4,className:M9.cell}),Ab=e=>{let{children:t}=e;return(0,Z.tZ)(ei.xv.B4,{color:"secondary",children:t})},Ay=e=>{let{children:t}=e;return(0,Z.tZ)(ei.xv.B3,{color:"primary",children:t})};var Af=i(20144);let A_=e=>{let{data:t,pub:i}=e,{iString:n}=(0,Q.M1)(),r=Xe(i);return t?(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(gV,{children:(0,Z.BX)(gG,{bg:"secondary",borderLeft:"detail",children:[(0,Z.tZ)(gK,{children:n("Attribute")}),(0,Z.tZ)(gK,{children:n("Value")})]})}),(0,Z.tZ)(gq,{children:[...E3].filter(e=>{let{key:t}=e;return!!r[t]&&"subscription_type"!==t}).map(e=>{var i,n,o,a,l;let{key:s}=e,d=null===(i=r[s])||void 0===i?void 0:i.name,c=null===(n=r[s])||void 0===n?void 0:n.explanation,u=null!==(l=null===(a=r[s])||void 0===a?void 0:null===(o=a.valueFn)||void 0===o?void 0:o.call(a,t))&&void 0!==l?l:t[s];return(0,Z.BX)(gG,{borderLeft:"detail",children:[(0,Z.tZ)(gQ,{title:d,children:(0,Z.BX)(et.X2,{gap:8,alignItems:"center",children:[d,c&&(0,Z.tZ)(AC,{text:c,title:d})]})}),(0,Z.tZ)(gQ,{children:(()=>{switch(s){case"subscription_country":return(0,Z.tZ)(AZ,{value:u});case"activity_rating":return(0,Z.tZ)(Aw,{value:u});default:return u}})()})]},s)})})]})}):null},AZ=e=>{let{value:t}=e;return(0,Z.BX)(et.X2,{gap:8,alignItems:"center",children:[(0,Z.tZ)(et.M5,{height:20,children:(0,Z.tZ)(yJ.Z,{countryCode:t,style:{fontSize:"1.25em"}})}),(0,Z.tZ)(ei.xv,{children:t})]})},Aw=e=>{let{value:t}=e;return(0,Z.tZ)(et.X2,{height:20,children:Array.from({length:5}).map((e,i)=>(0,Z.tZ)(Af.Z,{size:16,fill:i<t.length?"var(--color-semantic-warn-bg-primary)":"var(--color-fg-tertiary)"},i))})},AC=e=>{let{text:t,title:i}=e;return(0,Z.tZ)(tW.u,{text:t,title:i,children:(0,Z.tZ)(ts.xu,{height:16,width:16,cursor:"pointer",children:(0,Z.tZ)(eR.Z,{size:16,color:"var(--color-fg-tertiary)"})})})},Ax=e=>{var t;let{pub:i,email:n,userId:r}=e,{iString:o}=(0,Q.M1)(),[a,l]=(0,A.eJ)("STATS"),s=(0,yA.Q)({method:"get",pathname:"/api/v1/subscriber/email/".concat(r),auto:!!r,deps:[r]}),d=null!=n?n:null===(t=s.result)||void 0===t?void 0:t.email,{comments:c,hasMoreComments:u,loadingComments:p,loadMoreComments:h,updateComments:m}=function(e){let[t,i]=(0,A.eJ)({data:void 0,hasMore:void 0,loading:!1}),n=(0,A.I4)(e=>{i(t=>(0,f._)({},t,e))},[]),r=(0,A.I4)(async function(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!t.loading){n({loading:!0});try{var r,o;let i=await N().get("/api/v1/subscriber/".concat(encodeURIComponent(null!=e?e:""),"/comments")).query({latestDate:null===(o=t.data)||void 0===o?void 0:null===(r=o.at(-1))||void 0===r?void 0:r.date}),a=[...t.data||[],...i.body.comments];n({data:a,hasMore:i.body.hasMoreComments,loading:!1})}catch(e){console.error(e),i&&alert((0,Y.zx)(e,"There was a network issue. Try again in a bit")),n({loading:!1})}}},[e,t.data,t.loading,n]);return{comments:t.data,hasMoreComments:t.hasMore,loadingComments:t.loading,loadMoreComments:r,updateComments:n}}(d),{details:g,hasError:v,setHasError:b,refreshSubscriber:y}=MZ(d,{updateComments:m}),{events:_,hasMoreEvents:w,loadingEvents:C,loadMoreEvents:x}=function(e,t){let[i,n]=(0,A.eJ)({data:[],hasMore:!0,loading:!1}),[r,o]=(0,A.eJ)(!1),a=(0,A.I4)(e=>{n(t=>(0,f._)({},t,e))},[]),l=(0,A.I4)(async function(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(i.loading)return;a({loading:!0});let r=[...i.data],o=r[r.length-1],l=o&&(0,H.Z)(o.timestamp).subtract(6,"month"),s=l&&l.toISOString();try{let t=await N().post("/api/v1/subscriber/".concat(encodeURIComponent(null!=e?e:""),"/events")).send({email:e,before:o,after:s,limit:20});Array.prototype.push.apply(r,t.body.events);let i=t.body.events.length>=20;a({data:r,hasMore:i,loading:!1})}catch(e){console.error(e),(n||413===e.status)&&alert((0,Y.zx)(e,"There was a network issue. Try again in a bit")),t(!0),a({loading:!1})}},[e,i.data,i.loading,a,t]);return(0,A.d4)(()=>{0===i.data.length&&!r&&e&&(l(),o(!0))},[l,i.data.length,r,e]),{events:i.data,hasMoreEvents:i.hasMore,loadingEvents:i.loading,loadMoreEvents:l}}(d,b);if("object"!=typeof g||s.isLoading)return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(dt,{children:(0,Z.tZ)(dl,{})})});if(null===g||v||!d)return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(dt,{children:(0,Z.tZ)(dd,{})})});let S=[{value:"STATS",label:o("Details")},{value:"COMMENTS",label:o("Comments")},{value:"EVENTS",label:o("Events")},...g.child_emails.length>0?[{value:"GROUPS",label:o("Groups")}]:[]];return(0,Z.tZ)(tU.w,{children:(0,Z.tZ)(dt,{children:(0,Z.BX)(et.sg,{id:"subscriber-list",minWidth:0,gap:20,children:[(0,Z.tZ)(de,{href:(0,j.dIB)(i)}),(0,Z.tZ)(M1,{details:g,pub:i,email:d,refreshSubscriber:y}),(0,Z.tZ)(Mq,{details:g,onUnban:()=>Ak(d)}),(0,Z.tZ)(M0,{details:g,pub:i}),(0,Z.tZ)(Ae,{details:g,pub:i}),(0,Z.tZ)(et.X2,{children:(0,Z.tZ)(tx.Z,{tabs:S,value:a,onChange:e=>l(e)})}),(0,Z.tZ)(AS,{tab:a,details:g,pub:i,eventsData:{events:_,hasMoreEvents:w,loadingEvents:C,loadMoreEvents:x},commentsData:{comments:c,hasMoreComments:u,loadingComments:p,loadMoreComments:h}})]})})})},AS=e=>{let{tab:t,details:i,pub:n,eventsData:r,commentsData:o}=e,{events:a,hasMoreEvents:l,loadingEvents:s,loadMoreEvents:d}=r,{comments:c,hasMoreComments:u,loadingComments:p,loadMoreComments:h}=o;return(0,Z.BX)(Z.HY,{children:["EVENTS"===t&&(0,Z.tZ)(M2,{events:a,hasMore:l,loading:s,loadMore:d}),"STATS"===t&&(0,Z.tZ)(A_,{data:i.crmData,pub:n}),"COMMENTS"===t&&(0,Z.tZ)(MQ,{comments:c,pub:n,hasMore:u,loading:p,loadMore:h}),"GROUPS"===t&&(0,Z.tZ)(M6,{details:i,pub:n})]})},Ak=async e=>{if(window.confirm("Remove ban and allow user to comment?"))try{await N().post("/api/v1/subscriber/".concat(encodeURIComponent(e),"/unban")).send(),document.location.reload()}catch(e){console.error("Error ending ban",e),alert((0,Y.zx)(e,"There was a network issue. Try again in a bit"))}};class AB extends w.Component{async componentDidMount(){this.props.email||this.props.userId?await new Promise(e=>setTimeout(e,1e3)):this.loadMore(!1)}search(){let{auto_load_results:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.termInput&&this.termInput.value||"",i=this.filterInput&&this.filterInput.value||null;if(this.state&&t===this.state.searchTerm&&i===this.state.searchFilter)return;let n={searchTerm:t,searchFilter:i,searchResults:[],searchHasMore:!0};this.state?this.setState(n,()=>{e&&this.loadMore("object"==typeof this.state.counts)}):this.state=n}onSearchInput(){this.termInput&&this.termInput.value||this.search()}async loadMore(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{iString:t}=this.props;await (0,Y.Se)(this,"searchLoading",async i=>{let{searchResults:n,searchTerm:r,searchFilter:o}=i;try{let e=(await N().post("/api/v1/subscriber/").send({term:r,after:n[n.length-1],filter:o,limit:20})).body;Array.prototype.push.apply(n,e.subscribers),this.setState({searchResults:n,searchHasMore:e.subscribers.length>=20})}catch(i){console.error(i),e&&alert((0,Y.zx)(i,t("There was a network issue. Try again in a bit")))}})}render(e,t){let{pub:i,user:n,email:r,userId:o,iString:a}=e,{counts:l,searchResults:s,searchLoading:d,searchHasMore:c}=t;return r||o?(0,Z.tZ)(Ax,{pub:i,email:r,userId:o}):(0,Z.tZ)("section",{className:"page typography",id:"subscriber-list",children:(0,Z.tZ)("div",{className:"container",children:n.is_admin&&null===l?(0,Z.BX)("p",{children:[a("Failed to load!")," ",(0,Z.tZ)("a",{href:"javascript:window.location.reload()",children:a("Reload page")})]}):[n.is_admin&&(0,Z.tZ)(E2,{counts:l}),(0,Z.tZ)("a",{href:(0,j.xOy)(),children:(0,Z.tZ)(ee.zx,{priority:"primary",children:a("Add Subscribers")})}),(0,Z.BX)(tP.ZP,{performSubmit:this.search.bind(this),children:[(0,Z.tZ)("input",{ref:this.assignTermInput,name:"term",className:"small-input",placeholder:a("Search for email..."),type:"text",disabled:d,readOnly:d,onInput:this.onSearchInput.bind(this)}),(0,Z.BX)("select",{ref:this.assignFilterInput,name:"filter",disabled:d,onInput:this.search.bind(this),children:[(0,Z.tZ)("option",{value:"",children:a("Everyone")}),(0,Z.tZ)("option",{value:"FREE_SIGNUP",children:a("Free subscribers only")}),(0,Z.tZ)("option",{value:"PAYING_SUBSCRIBED",children:a("Paid subscribers only")}),(0,Z.tZ)("option",{value:"COMP_SUBSCRIBED",children:a("Comps only")}),(0,Z.tZ)("option",{value:"GIFT_SUBSCRIBED",children:a("Gifts only")})]})]}),s.length>0||c?(0,Z.BX)("table",{children:[s.length>0&&(0,Z.BX)("tr",{className:"header-row",children:[(0,Z.tZ)("th",{className:"subscriber-email",children:a("Email")}),(0,Z.tZ)("th",{className:"subscriber-status",children:a("Status")}),(0,Z.tZ)("th",{className:"subscriber-recent-activity",children:a("Recent Activity")})]}),s.map(e=>{var t;return(0,Z.BX)("a",{className:"tr",href:(0,j.pN7)(i,e.email),children:[(0,Z.tZ)("td",{className:"subscriber-email primary",children:e.email}),new Date(null!==(t=e.expiry)&&void 0!==t?t:0)>new Date?(0,Z.tZ)("td",{className:"subscriber-status active-subscriber subscriber-green",children:(0,er.toTitleCase)(e.type||"Paid subscriber")}):(0,Z.tZ)("td",{className:"subscriber-status free-signup",children:a("Free subscriber")}),(0,Z.tZ)("td",{className:"subscriber-recent-activity",children:e.lastActivity&&(0,Z.tZ)(M5,{lastActivity:e.lastActivity})})]})}),c&&(0,Z.BX)("tr",{className:"loading-row",children:[(0,Z.tZ)("td",{className:"subscriber-email",children:(0,Z.tZ)(h5.Z,{threshold:256,onVisible:this.loadMore.bind(this,!1),children:(0,Z.tZ)("a",{href:"javascript:void(0)",onClick:this.loadMore.bind(this,!0),children:d?a("Loading.."):a("Load more..")})})}),(0,Z.tZ)("td",{className:"subscriber-status"}),(0,Z.tZ)("td",{className:"subscriber-recent-activity"})]})]}):(0,Z.tZ)("p",{className:"no-results",children:a("No results")})]})})}constructor(e,t){super(e,t),(0,M._)(this,"termInput",void 0),(0,M._)(this,"filterInput",void 0),(0,M._)(this,"assignTermInput",e=>{this.termInput=e}),(0,M._)(this,"assignFilterInput",e=>{this.filterInput=e}),this.search({auto_load_results:!1})}}let AT=(0,io.xY)((0,Q.fz)(AB));var AI=i(63584);let AN=e=>{let{pub:t,sectionsContext:i,setSectionsContext:n}=e,{iString:r,iPlural:o}=(0,Q.M1)(),a=1+ +!!t.podcast_enabled+t.sections.length,l=+!!i.publicationEmailEnabled+(t.podcast_enabled&&i.podcastEmailEnabled?1:0)+i.sectionIdsToEnable.length,s=l===a?r("All sections"):o("%1 section","%1 sections",l);return(0,Z.BX)(tC.v2,{trigger:(0,Z.BX)(et.X2,{className:k()(AI.Z.select),children:[(0,Z.tZ)(ei.xv.B3,{flex:"grow",children:s}),(0,Z.tZ)(tw.Z,{})]}),layerOptions:{placement:"bottom-end",triggerOffset:4},children:[(0,Z.tZ)(tC.sN,{leading:i.publicationEmailEnabled?(0,Z.tZ)(eE.Z,{size:20}):(0,Z.tZ)(tC.$j,{}),onClick:e=>{e.preventDefault();let t=+!!i.podcastEmailEnabled+i.sectionIdsToEnable.length;(!i.publicationEmailEnabled||0!==t)&&n((0,_._)((0,f._)({},i),{publicationEmailEnabled:!i.publicationEmailEnabled}))},children:t.name}),t.podcast_enabled&&(0,Z.tZ)(tC.sN,{leading:i.podcastEmailEnabled?(0,Z.tZ)(eE.Z,{size:20}):(0,Z.tZ)(tC.$j,{}),onClick:e=>{e.preventDefault();let t=+!!i.publicationEmailEnabled+i.sectionIdsToEnable.length;(!i.podcastEmailEnabled||0!==t)&&n((0,_._)((0,f._)({},i),{podcastEmailEnabled:!i.podcastEmailEnabled}))},children:"".concat(t.podcast_title)}),t.sections.length>0&&(0,Z.tZ)(Z.HY,{children:t.sections.map(e=>(0,Z.tZ)(tC.sN,{leading:i.sectionIdsToEnable.includes(e.id)?(0,Z.tZ)(eE.Z,{size:20}):(0,Z.tZ)(tC.$j,{}),onClick:t=>{(t.preventDefault(),i.sectionIdsToEnable.includes(e.id))?0!==+!!i.publicationEmailEnabled+ +!!i.podcastEmailEnabled+i.sectionIdsToEnable.filter(t=>t!==e.id).length&&n((0,_._)((0,f._)({},i),{sectionIdsToEnable:i.sectionIdsToEnable.filter(t=>t!==e.id)})):n((0,_._)((0,f._)({},i),{sectionIdsToEnable:[...i.sectionIdsToEnable,e.id]}))},children:e.name},e.id))})]})};var AP=i(10704);let AE=e=>{let{selectValue:t,setSelectValue:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)(oY.i,{onChange:e=>i(e.currentTarget.value),value:t,children:[(0,Z.tZ)(oY.d,{children:n("Select subscription type")}),(0,Z.tZ)("option",{value:"free",children:n("Free subscription")}),(0,Z.tZ)("option",{value:"lifetime",children:n("Lifetime paid subscription")}),(0,Z.tZ)("option",{value:7,children:n("1 week trial")}),(0,Z.tZ)("option",{value:30,children:n("1 month trial")}),(0,Z.tZ)("option",{value:90,children:n("3 month trial")}),(0,Z.tZ)("option",{value:183,children:n("6 month trial")}),(0,Z.tZ)("option",{value:365,children:n("1 year trial")})]})},AX=e=>!isNaN(e)||"lifetime"===e;function AM(){let{forFreeSignup:e,shouldUseCustomImportEmail:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t?(0,j.n1t)("/publish/settings/edit",{title:"Import email sent to imported subscribers",bodyField:"imported_welcome_email_content",titleField:"imported_welcome_email_subject",titlePlaceholder:"Email Subject...",backButtonClose:!0,redirect:"undefined"!=typeof document?document.location.href:"",endpoint:"/api/v1/publication/email_render_elements?include_defaults=true"}):(0,j.n1t)("/publish/settings/edit",{title:"Welcome email sent to new subscribers",bodyField:e?"unfinished_subscription_email_content":"welcome_email_content",backButtonClose:!0,redirect:"undefined"!=typeof document?document.location.href:""})}let AA=e=>{var t,i;let{pub:n,isPubPaid:r,csvImport:o,finishImport:a,importing:l,isManagedPublication:s,isOpen:d,onClose:c,setCsvImport:u}=e,{getConfigFor:p}=(0,io.xR)(),{iString:h}=(0,Q.M1)(),m=(null===(i=n.sections)||void 0===i?void 0:i.length)>0&&!!p("section_specific_csv_imports_enabled")&&(0,_._)((0,f._)({publicationEmailEnabled:!0},n.podcast_title?{podcastEmailEnabled:!0}:{podcastEmailEnabled:!1}),{sectionIdsToEnable:n.sections.filter(e=>e.is_default_on).map(e=>e.id)}),[g,v]=(0,A.eJ)("free"),[b,y]=(0,A.eJ)(!1),[w,C]=(0,A.eJ)(!0),[x,S]=(0,A.eJ)(!0),[k,B]=(0,A.eJ)(""),[T,I]=(0,A.eJ)(m),N=()=>{u(null),c()};(0,A.d4)(()=>{v("free"),y(!1),C(!0),S(!0),B("")},[o,s]);let P=AX(g);return(0,Z.tZ)(eK.u_,{isOpen:d,onClose:N,children:(0,Z.BX)(tU.w,{children:[(0,Z.tZ)(mK.xB,{title:h("Add subscribers via CSV"),showClose:!0,onClose:N,showDivider:!0}),(0,Z.tZ)(AP.fe,{children:(0,Z.BX)(et.tu,{gap:20,children:[(0,Z.tZ)(AO,{}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(AD,{csvImport:o}),r&&(0,Z.tZ)(AE,{selectValue:g,setSelectValue:v}),(null===(t=n.sections)||void 0===t?void 0:t.length)>0&&T&&(0,Z.tZ)(AN,{pub:n,sectionsContext:T,setSectionsContext:I,defaultSectionsContext:m}),(0,Z.tZ)(AR,{emailListOrigin:k,setEmailListOrigin:B})]}),(0,Z.tZ)(tX.iz,{}),P&&(0,Z.tZ)(AF,{extendComp:w,setExtendComp:C}),(0,Z.tZ)(AL,{sendEmails:x,setSendEmails:S}),(0,Z.tZ)(Az,{optedInChecked:b,setOptedInChecked:y})]})}),(0,Z.tZ)(eK.mz,{showDivider:!0,direction:"column",primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",onClick:()=>{if(!o){console.error("csvImport not defined, cannot finish import"),alert("Something went wrong, please try again.");return}return a({csvImport:o,compSelected:P,selectValue:g,extendComp:w,sendEmails:x,emailListOrigin:k,sectionImportContext:T})},disabled:!b,loading:l,children:"Import"})})]})})},AD=e=>{let{csvImport:t}=e,{iString:i,iPlural:n}=(0,Q.M1)();return(0,Z.BX)(et.X2,{paddingY:8,paddingX:12,border:"detail",radius:"sm",gap:12,alignItems:"center",style:{background:"var(--color-bg-primary-hover)"},children:[(0,Z.tZ)(g4.Z,{size:20,color:"var(--color-fg-secondary)"}),(0,Z.BX)(et.sg,{children:[(0,Z.tZ)(ei.xv.B4,{weight:"medium",children:(null==t?void 0:t.file_name)||i("Uploaded file")}),(null==t?void 0:t.num_emails)&&(0,Z.tZ)(ei.xv.B4,{size:12,color:"secondary",children:n("%1 email","%1 emails",t.num_emails)})]})]})},AR=e=>{let{emailListOrigin:t,setEmailListOrigin:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(bv.g,{rows:2,style:{resize:"none"},name:"email_list_origin",placeholder:n("Where did this list come from?"),value:t,onChange:e=>i(e.currentTarget.value)})},AF=e=>{let{extendComp:t,setExtendComp:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)(AU,{children:[(0,Z.tZ)(iB.X,{size:"sm",checked:t,onChange:e=>i(e),defaultChecked:!0}),(0,Z.tZ)(ei.xv.B3,{children:n("Give trials to existing free subscribers")})]})},AL=e=>{let{sendEmails:t,setSendEmails:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)(AU,{children:[(0,Z.tZ)(iB.X,{size:"sm",checked:t,onChange:e=>i(e),defaultChecked:!0}),(0,Z.BX)(ei.xv.B3,{children:[n("Send  "),(0,Z.tZ)(ei.hh,{decoration:"underline",href:AM({shouldUseCustomImportEmail:!0}),target:"_blank",children:n("welcome email")}),n(" to new subscribers")]})]})},Az=e=>{let{optedInChecked:t,setOptedInChecked:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.BX)(AU,{children:[(0,Z.tZ)(iB.X,{size:"sm",checked:t,onChange:e=>i(e)}),(0,Z.tZ)(ei.xv.B3,{className:"required",children:n("These people have opted-in to receiving emails")})]})},AO=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(oU.b,{theme:"warn",priority:"secondary",title:e("Only add people who have explicitly opted-in"),description:e("Adding readers who have not explicitly opted-in hurts your deliverability and may cause your import to be rejected."),showClose:!1})},AU=(0,ts.zo)({display:"flex",gap:8,alignItems:"center"}),AY=e=>{let{importId:t,onClose:i}=e,[n,r]=(0,A.eJ)(!1),[o,a]=(0,A.eJ)(!0),[l,s]=(0,A.eJ)(0),{iString:d}=(0,Q.M1)();(0,A.d4)(()=>{t&&(s(t),r(!0),a(!1))},[t]);let c=async()=>{if(l){a(!0);try{await (0,ix.rd)("/api/v1/import/partially_validated/confirm",{method:"PUT",json:{csvImportId:l}})}catch(e){console.error(e)}finally{a(!1),r(!1)}}},u=async()=>{if(l){a(!0);try{await (0,ix.rd)("/api/v1/import/partially_validated/deny",{method:"PUT",json:{csvImportId:l}})}catch(e){console.error(e)}finally{a(!1),r(!1)}}};return n&&l&&!o?(0,Z.tZ)(dj.W,{icon:(0,Z.tZ)(mK.AM,{bg:"accent-yellow",icon:(0,Z.tZ)(eN.Z,{color:"var(--color-semantic-warn-fg-primary)"})}),isOpen:n,onClose:()=>{i(),r(!1)},title:d("Confirmation required"),description:d("Your import has been flagged as potentially risky and requires extra confirmation. Have all imported emails explicitly opted in to receiving your communications?"),primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary-mono",loading:o,onClick:c,children:d("Confirm import")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",loading:o,onClick:u,children:d("Cancel")})}):null},AH=e=>{let{imports:t}=e,[i,n]=(0,A.eJ)(0),{iString:r}=(0,Q.M1)();return(0,A.d4)(()=>{let e=async e=>{try{var t;let i=await N().get("/api/v1/import/partially_validated/validate?csvImportId=".concat(e));(null===(t=i.body)||void 0===t?void 0:t.exists)&&n(e)}catch(e){console.error(e)}},t=new URL(location.toString()),i=t.searchParams.get("conditional_import_id");i&&(e(i),t.searchParams.delete("conditional_import_id"),history.replaceState({},"",t))},[]),(0,Z.BX)(s9,{children:[(0,Z.tZ)(s7,{title:r("Your imports")}),(0,Z.tZ)(A5,{imports:t,onShowConfirmation:n}),(0,Z.tZ)(AY,{importId:i,onClose:()=>n(0)})]})},Aj=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.BX)(gG,{bg:"secondary",children:[(0,Z.tZ)(gK,{children:e("File")}),(0,Z.tZ)(gK,{children:e("Status")}),(0,Z.tZ)(gK,{children:e("Date")}),(0,Z.tZ)(gK,{children:e("Emails")}),(0,Z.tZ)(gK,{children:e("Added")}),(0,Z.tZ)(gK,{children:e("Skipped")})]})},AJ=e=>{var t;return(0,Z.BX)(gG,{borderBottom:"detail",children:[(0,Z.tZ)(Aq,{file_name:null!==(t=e.file_name)&&void 0!==t?t:null}),(0,Z.tZ)(AW,(0,f._)({},e)),(0,Z.tZ)(A4,{upload_date:e.upload_date}),(0,Z.tZ)(A6,(0,f._)({},e)),(0,Z.tZ)(A3,(0,f._)({},e)),(0,Z.tZ)(A8,(0,f._)({},e))]})},AV=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(gG,{children:(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.xv,{color:"secondary",children:e("No imports")})})})},Aq=e=>{let{file_name:t}=e;return(0,Z.tZ)(gQ,{ellipsis:!0,maxWidth:200,children:(0,Z.tZ)(ei.xv,{children:t})})},AW=e=>{let{status:t,upload_date:i,id:n,onShowConfirmation:r}=e;if("importing"===t&&(0,H.Z)().diff(i,"hour")>3)return(0,Z.tZ)(AG,{});switch(t){case"partially_accept_waiting":return(0,Z.tZ)(AK,{onShowConfirmation:r,id:n});case"review_required":return(0,Z.tZ)(AQ,{});case"rejected":return(0,Z.tZ)(A$,{});case"completed":case"completed_awaiting_post":return(0,Z.tZ)(A1,{});case"removed":return(0,Z.tZ)(A2,{});default:return(0,Z.tZ)(A0,{})}},AG=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(gQ,{children:(0,Z.tZ)(d_.Vp,{theme:"error",children:e("Failed")})})},AK=e=>{let{onShowConfirmation:t,id:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(gQ,{children:(0,Z.tZ)(d_.Vp,{theme:"warn",onClick:()=>t(i),cursor:"pointer",children:n("Action required")})})},AQ=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ts.xu,{cursor:"pointer",children:(0,Z.tZ)(d_.Vp,{theme:"warn",href:"https://support.substack.com/hc/en-us/articles/5826291148308",newTab:!0,children:e("Under review")})})})},A$=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ts.xu,{cursor:"pointer",children:(0,Z.tZ)(d_.Vp,{theme:"error",href:"https://support.substack.com/hc/en-us/articles/5826215563796",newTab:!0,children:e("Denied")})})})},A0=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(gQ,{children:(0,Z.tZ)(tW.u,{text:e("This may take a few minutes"),children:(0,Z.tZ)(d_.Vp,{theme:"default",children:e("Importing...")})})})},A1=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(gQ,{children:(0,Z.tZ)(d_.Vp,{theme:"success",children:e("Imported")})})},A2=()=>{let{iString:e}=(0,Q.M1)();return(0,Z.tZ)(gQ,{children:(0,Z.tZ)(d_.Vp,{theme:"error",children:e("Removed")})})},A4=e=>{let{upload_date:t}=e;return(0,Z.tZ)(gQ,{children:(0,Z.tZ)(ei.xv,{children:(0,H.Z)(t).standardTime()})})},A3=e=>{let{num_added:t,is_comp:i,num_comped:n,status:r}=e;return(0,Z.tZ)(gQ,{children:["completed","completed_awaiting_post"].includes(r)?(0,Z.tZ)(ei.xv,{children:(0,er.numberToString)(i?n:t)}):(0,Z.tZ)(ei.xv,{color:"tertiary",children:"-"})})},A8=e=>{let{num_skipped:t,status:i}=e;return(0,Z.tZ)(gQ,{children:["completed","completed_awaiting_post"].includes(i)?(0,Z.tZ)(ei.xv,{children:(0,er.numberToString)(t)}):(0,Z.tZ)(ei.xv,{color:"tertiary",children:"-"})})},A6=e=>{let{num_emails:t,upload_date:i}=e;return(0,Z.tZ)(gQ,{children:i?(0,Z.tZ)(ei.xv,{children:(0,er.numberToString)(t)}):(0,Z.tZ)(ei.xv,{color:"tertiary",children:"-"})})},A5=e=>{let{imports:t,onShowConfirmation:i}=e;return(0,Z.tZ)(g$,{children:(0,Z.BX)(gJ,{children:[(0,Z.tZ)(Aj,{}),(0,Z.tZ)(gq,{children:0===t.length?(0,Z.tZ)(AV,{}):t.map(e=>(0,Z.tZ)(AJ,(0,_._)((0,f._)({},e),{onShowConfirmation:i}),"".concat(e.upload_date)))})]})})},A9=e=>{let{isPubPaid:t}=e,[i,n]=(0,A.eJ)(!1),[r,o]=(0,A.eJ)(""),[a,l]=(0,A.eJ)(!0),[s,d]=(0,A.eJ)("free"),c=(0,A.sO)(null),u=!!r.trim(),{iString:p}=(0,Q.M1)(),{popToast:h}=(0,iN.pm)();return(0,Z.tZ)(et.sg,{gap:20,radius:"md",border:"detail",shadow:"xs",className:"container-iqoWfZ",children:(0,Z.BX)(tP.ZP,{className:"unstyled",performSubmit:()=>{let e;return isNaN(Number(s))||(e=s),N().post("/api/v1/subscriber/add").send({email:r,subscription:AX(s),expiryDays:e,sendEmail:a})},onSuccess:()=>{h(e=>{let{onClose:t}=e;return(0,Z.tZ)(iN.FN,{text:p("Emails added"),onClose:t,Icon:eE.Z})}),o(""),(0,U.j)(U.FP.EMAIL_IMPORT_STARTED,{emails:r,is_comp:AX(s),select_value:s,send_email:a})},onError:e=>{let t=(0,Y.zx)(e);h(e=>{let{onClose:i}=e;return(0,Z.tZ)(iN.FN,{text:t,onClose:i})}),(0,U.j)(U.FP.EMAIL_IMPORT_FAILED,{emails:r,is_comp:AX(s),select_value:s,send_email:a,error:t})},onChangeLoadingState:e=>n(e),noInlineErrors:!0,children:[(0,Z.BX)(et.sg,{gap:8,padding:20,children:[(0,Z.tZ)(tD.oi,{ref:c,flex:"grow",type:"text",name:"email",value:r,placeholder:p("Enter email addresses (comma separated)"),onChange:()=>{var e,t,i;return o(null!==(i=null===(t=c.current)||void 0===t?void 0:null===(e=t.value)||void 0===e?void 0:e.trim())&&void 0!==i?i:"")},autoComplete:"off"}),t&&(0,Z.tZ)(AE,{selectValue:s,setSelectValue:d}),(0,Z.tZ)("label",{children:(0,Z.BX)(et.gq,{gap:8,alignItems:"center",paddingTop:8,children:[(0,Z.tZ)(iB.X,{checked:a,size:"sm",onChange:()=>l(!a)}),(0,Z.BX)(ei.xv.B3,{children:[p("Send  "),(0,Z.tZ)(ei.hh,{decoration:"underline",href:AM({shouldUseCustomImportEmail:!0}),target:"_blank",children:p("welcome email")}),p(" to new subscribers")]})]})})]}),(0,Z.tZ)(et.sg,{padding:20,paddingTop:0,children:(0,Z.tZ)(ee.zx,{type:"submit",priority:"primary",disabled:!u,loading:i,children:p("Add emails")})})]})})},A7=0,De=e=>{let{pub:t,isManagedPublication:i}=e,[n,r]=(0,A.eJ)([]),o=t.draft_plans&&t.draft_plans.length>0,[a,l]=(0,A.eJ)(!1),[s,d]=(0,A.eJ)(!1),[c,u]=(0,A.eJ)(!1),[p,h]=(0,A.eJ)(null),{iString:m}=(0,Q.M1)(),g=()=>{try{return N().get("/api/v1/import/instances").then(e=>{if(e&&e.body){let{pubImports:t}=e.body;return r(t),t}})}catch(e){alert((0,er.truncateText)((0,Y.zx)(e),200))}};(0,A.d4)(()=>{g()},[]),(0,A.d4)(()=>{if(c){let e=setInterval(()=>{var t;null===(t=g())||void 0===t||t.then(t=>{t&&t.length&&t.every(e=>{let{completed_at:t}=e;return!!t})?(u(!1),clearInterval(e)):60===A7&&clearInterval(e),A7++})},5e3);return()=>{clearInterval(e)}}},[c]),(0,A.d4)(()=>{p&&l(!0)},[p,null==p?void 0:p.id]);let v=async e=>{try{let t=new FormData;t.append("csv",e),d(!0);let{csvImport:i}=(await N().post("/api/v1/import/prepare").send(t)).body;h(i)}catch(e){alert((0,er.truncateText)((0,Y.zx)(e),200))}finally{d(!1)}},b=async e=>{let t,i,{csvImport:o,compSelected:a,selectValue:s,extendComp:d,sendEmails:c,emailListOrigin:p,sectionImportContext:h}=e;a&&!isNaN(s)&&(t=s),u(!0);try{await N().post("/api/v1/import/finish").send({csvImportId:o.id,isComp:a,compDays:t,extendComp:d,sendEmails:c,emailListOrigin:p,sectionImportContext:h})}catch(e){alert(e.response.body.error)}finally{l(!1),r([{file_name:o.file_name,is_comp:a,upload_date:o.upload_date},...n])}};return(0,Z.tZ)(tU.w,{children:(0,Z.BX)(et.sg,{className:"container-B0bx6X",paddingY:32,paddingX:16,gap:36,children:[(0,Z.tZ)(de,{}),(0,Z.tZ)(oU.b,{showClose:!1,theme:"warn",Icon:eN.Z,priority:"secondary",title:m("Only add people who have explicitly opted-in to receiving emails"),description:(0,Z.BX)(Z.HY,{children:[m("Do not add people whose information was obtained solely via the exchange of products/services, giveaways, or similar collection methods. "),(0,Z.tZ)(ei.hh,{href:"".concat((0,j.SVA)(),"/content"),target:"_blank",rel:"noopener nofollow",decoration:"underline",children:m("View content guidelines")})]})}),(0,Z.BX)(s9,{children:[(0,Z.tZ)(s7,{title:m("Add subscribers by email")}),(0,Z.tZ)(A9,{isPubPaid:o})]}),(0,Z.BX)(s9,{children:[(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(s7,{title:m("Add subscribers by upload")}),(0,Z.BX)(ei.xv.B3,{color:"secondary",children:[m("Import existing subscribers from platforms like "),(0,Z.tZ)(ei.hh,{href:u_.Z.PATREON,target:"_blank",rel:"noopener nofollow",decoration:"underline",children:m("Patreon")}),","," ",(0,Z.tZ)(ei.hh,{href:u_.Z.GHOST,target:"_blank",rel:"noopener nofollow",decoration:"underline",children:m("Ghost")}),","," ",(0,Z.tZ)(ei.hh,{href:u_.Z.MAILCHIMP,target:"_blank",rel:"noopener nofollow",decoration:"underline",children:m("Mailchimp")}),m(", or "),(0,Z.tZ)(ei.hh,{href:u_.Z.TINYLETTER,target:"_blank",rel:"noopener nofollow",decoration:"underline",children:m("TinyLetter")}),"."]})]}),(0,Z.tZ)(uf.G,{loading:s,onFileSelected:v,info:m("Add a .csv, .xlsx, or .ods file")})]}),(0,Z.tZ)(AH,{imports:n}),(0,Z.tZ)(AA,{pub:t,isPubPaid:!!o,csvImport:p,setCsvImport:h,finishImport:b,importing:c,isManagedPublication:i,isOpen:a,onClose:()=>l(!1)})]})})};var Dt=i(31582);let Di={pageContainer:"pageContainer-NBTBTX",backLink:"backLink-s0Yzb1",open:"open-okgTu4",overdue:"overdue-W8NQku",invoiceLink:"invoiceLink-I6DI8u"},Dn=e=>{let{card_header:t,card_content:i}=e;return(0,Z.BX)(et.tu,{border:"detail",paddingX:16,paddingY:12,radius:"md",flex:"grow",children:[(0,Z.BX)(ei.xv.Meta,{children:[t,":"]}),(0,Z.tZ)(ei.xv.B3,{children:i})]})},Dr=e=>{let{email:t,pub:i}=e;return(0,Z.BX)(et.tu,{gap:48,children:[(0,Z.tZ)(et.gq,{children:(0,Z.BX)("a",{className:Di.backLink,href:(0,j.rCb)(i),children:[(0,Z.tZ)(eF.Z,{height:16})," Manage Groups"]})}),(0,Z.tZ)(et.gq,{justifyContent:"space-between",children:(0,Z.BX)(et.tu,{gap:4,children:[(0,Z.tZ)(ei.xv.Meta,{children:"Group Subscription managed by"}),(0,Z.tZ)(ei.xv.H1,{children:t}),(0,Z.tZ)("a",{className:"tr",href:(0,j.pN7)(i,t),children:(0,Z.tZ)("text",{children:"See Activity"})})]})})]})},Do=e=>{let{currency:t,expiry:i,extraSeatsGranted:n,isExtraSeatsGroup:r,isUnlimitedGroup:o,rate:a,seatsPurchased:l}=e;return(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.tZ)(Dn,{card_header:"Annual group rate",card_content:"".concat((0,er.centsToPriceString)(a,t)).concat(o?"":" per seat")}),(0,Z.tZ)(Dn,{card_header:"Renews On",card_content:(0,H.Z)(i).format("MMMM D, YYYY")}),(0,Z.tZ)(Dn,{card_header:r?"Extra seats granted":"Seats purchased",card_content:o?"Unlimited":r?n:l})]})},Da=e=>{let{groupChildren:t,seatsPurchased:i,pub:n,isUnlimitedGroup:r}=e;return(0,Z.BX)("table",{children:[(0,Z.tZ)("tr",{className:"header-row",children:(0,Z.BX)("th",{className:"subscriber-email primary",children:["Group Members (",null==t?void 0:t.length,i&&!r?" of ".concat(i," seats filled"):"",")"]})}),null==t?void 0:t.map(e=>(0,Z.tZ)("tr",{children:(0,Z.tZ)("td",{className:"subscriber-email primary",children:(0,Z.tZ)("a",{href:(0,j.pN7)(n,e),children:e})})}))]})},Dl=e=>{let{invoices:t,pub:i,isUnlimitedGroup:n}=e,r=[{key:"created_at",name:"Issued on",valueFn:e=>{let{created_at:t,invoice_id:n}=e;return(0,Z.tZ)("a",{className:Di.invoiceLink,href:(0,en.hYg)(i,n),target:"_blank",rel:"noopener",children:t?(0,H.Z)(t).format("MMMM D, YYYY"):"None"})}},{key:"plan_amount",name:"Plan",valueFn:e=>{let{plan_amount:t}=e;return"".concat((0,er.centsToPriceString)(t,(0,er.pubCurrency)(i))," per year")}},{key:"quantity",name:"Seats",valueFn:e=>{let{quantity:t}=e;return n?"Unlimited":t}},{key:"due_at",name:"Due date",valueFn:e=>{let{due_at:t}=e;return t?(0,H.Z)(t).format("MMMM D, YYYY"):"None"}},{key:"amount",name:"Amount",valueFn:e=>{let{amount:t,currency:i}=e;return(0,er.centsToPriceString)(t,i)}},{key:"payment_status",name:"Status",valueFn:e=>{let{payment_status:t,due_at:i}=e;return(0,Z.tZ)("span",{className:k()(Di[t],{[Di.overdue]:"open"===t&&(0,H.Z)(i).isBeforeNow()}),children:(0,Dt.uG)(t,i)})}}];return(null==t?void 0:t.length)>0?(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ei.xv.H3,{paddingBottom:12,children:"Payment History"}),(0,Z.tZ)(pt,{cols:r,rows:t})]}):null},Ds=()=>(0,Z.tZ)(et.hs,{alignItems:"center",justifyContent:"center",paddingTop:32,children:(0,Z.tZ)(iI.$j,{})}),Dd=e=>{let{pub:t,subscription_id:i}=e,{result:n,isLoading:r,error:o}=(0,iS.ib)({pathname:"/api/v1/subscriber/groups/".concat(i),method:"GET",auto:!0,initialResult:{currency:"",email:"",expiry:"",extraSeatsGranted:0,groupChildren:[],invoices:[],isExtraSeatsGroup:!1,isUnlimitedGroup:!1,rate:0,seatsPurchased:1},deps:[t.id]});return r||o?(0,Z.tZ)(Ds,{}):(0,Z.BX)(et.tu,{gap:56,className:k()("container",Di.pageContainer),children:[(0,Z.tZ)(Dr,{email:null==n?void 0:n.email,pub:t}),(0,Z.tZ)(Do,{currency:null==n?void 0:n.currency,expiry:null==n?void 0:n.expiry,extraSeatsGranted:null==n?void 0:n.extraSeatsGranted,isExtraSeatsGroup:null==n?void 0:n.isExtraSeatsGroup,isUnlimitedGroup:null==n?void 0:n.isUnlimitedGroup,rate:null==n?void 0:n.rate,seatsPurchased:null==n?void 0:n.seatsPurchased}),(0,Z.tZ)(Dl,{pub:t,invoices:null==n?void 0:n.invoices,isUnlimitedGroup:null==n?void 0:n.isUnlimitedGroup}),(0,Z.tZ)(Da,{groupChildren:null==n?void 0:n.groupChildren,pub:t,seatsPurchased:null==n?void 0:n.seatsPurchased,isUnlimitedGroup:null==n?void 0:n.isUnlimitedGroup})]})};async function Dc(e){try{return await (0,ix.rd)("/api/v1/group/offer?user_id=".concat(e))}catch(t){return console.error("Failed to fetch user for user id ".concat(e),t),null}}let Du={offerForm:"offerForm-g3U1WV",emailInput:"emailInput-YJjNvk",numberInput:"numberInput-DYooce",rateTotalInput:"rateTotalInput-jOEyCF",changeGlobalDiscountLink:"changeGlobalDiscountLink-kZn3Yz",percentInput:"percentInput-o7snAZ",inputPercentage:"inputPercentage-I8Q1P1",inputDollar:"inputDollar-UhnSZ_",relative:"relative-QsOaKa",rateInfo:"rateInfo-Fx7NIr",planDetails:"planDetails-h440pR",roundedInfoIcon:"roundedInfoIcon-mF383p",dropdown:"dropdown-QX_Mn9"};function Dp(){let e=(0,G._)(["Edit offer for ",""]);return Dp=function(){return e},e}function Dh(){let e=(0,G._)(["Success! You've sent an offer to ",""]);return Dh=function(){return e},e}function Dm(){let e=(0,G._)(["Success! You've updated the offer for ",""]);return Dm=function(){return e},e}function Dg(){let e=(0,G._)(["Set the default discount for all subscriptions purchased in groups of "," or more from your Settings page"]);return Dg=function(){return e},e}let Dv=e=>{let{pub:t,user_id:i}=e,[n,r]=(0,A.eJ)(""),[o,a]=(0,A.eJ)(null),[l,s]=(0,A.eJ)("per_seat"),[d,c]=(0,A.eJ)(0),[u,p]=(0,A.eJ)(0),[h,m]=(0,A.eJ)(null),{iString:g,iTemplate:v}=(0,Q.M1)();return((0,A.d4)(()=>{(async()=>{if(i){var e;let t=await Dc(i);if(!t)throw Error("failed to find offer");let{user:n,type:o,coupon:l,plan:d}=t;r(null!==(e=null==n?void 0:n.email)&&void 0!==e?e:""),a(t),s(o),(null==l?void 0:l.percent_off)&&c(l.percent_off),m(null!=d?d:null),"unlimited"===o&&p((null==d?void 0:d.amount)?d.amount/100:0)}})()},[t,i]),o)?(0,Z.tZ)(Dy,{pub:t,offerEmail:n,offerPercentOff:d,offerMinSeats:null==o?void 0:o.minimum_initial_seats,offerFlatRateAmount:u,offerType:l,offerPlan:h,headerText:v(Dp(),n),buttonText:g("Update"),offerExists:!0}):(0,Z.tZ)(DZ,{})},Db=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.tZ)(Dy,{pub:t,headerText:i("Create a new group subscription offer"),buttonText:i("Create")})},Dy=e=>{var t,i,n,r,o,a,l;let{offerEmail:s="",offerPercentOff:d=0,offerFlatRateAmount:c=0,offerMinSeats:u=2,offerExists:p=!1,offerType:h="per_seat",offerPlan:m,pub:g,headerText:v,buttonText:b}=e,{iString:y,iTemplate:w}=(0,Q.M1)(),C={per_seat:{label:y("Discount per seat"),value:"per_seat"},unlimited:{label:y("Unlimited"),value:"unlimited"}},[x,S]=(0,A.eJ)(s),[k,B]=(0,A.eJ)(d),[T,I]=(0,A.eJ)(u),[P,E]=(0,A.eJ)({}),[X,M]=(0,A.eJ)(c),[D,R]=(0,A.eJ)(!1),[F,L]=(0,A.eJ)(!0),[z,O]=(0,A.eJ)(!1),[U,H]=(0,A.eJ)(C[h]),[J,V]=(0,A.eJ)(null!==(o=null!=m?m:null===(t=g.plans)||void 0===t?void 0:t.find(e=>{var t,i;return"year"===e.interval&&!(null===(t=e.metadata)||void 0===t?void 0:t.founding)&&!(null===(i=e.metadata)||void 0===i?void 0:i.bitcoin)}))&&void 0!==o?o:null),{popToast:q}=(0,iN.pm)();(0,A.d4)(()=>{(async()=>{var e;return g.default_group_coupon&&Object.values(P).length!==(null===(e=g.plans)||void 0===e?void 0:e.length)?await k1(g,null,g.default_group_coupon,{group:!0,required:!0},e=>{var t;if(!e||e.loading)return;let i={};null===(t=g.plans)||void 0===t||t.map(t=>{k$(e,t)?i[t.id]=e.percent_off:i[t.id]=0}),B(!eS()(e.percent_off)&&k$(e,J)?Math.round(e.percent_off):0),E(i)}):null})().catch(e=>{E({}),console.error(e)})},[g,J,P]);let W=(0,A.Ye)(()=>J?P[J.id]:null,[J,P]),G=(0,A.Ye)(()=>"unlimited"===U.value?{email:x,fixed_price:100*X}:{email:x,minimum_seats:null!=T?T:2,percent_off:k,stripe_plan_id:null==J?void 0:J.id},[x,T,X,k,U,J]),K=(0,A.I4)(async()=>{O(!0);try{await N().post("/api/v1/group/offer").send(G),(0,Y.uX)("/publish/groups"),q(()=>(0,Z.tZ)(iN.FN,{text:w(Dh(),x)}))}catch(e){console.error("Failed to create group offer:",e),409===e.response.status?R(!0):q(()=>(0,Z.tZ)(iN.FN,{text:(0,Y.zx)(e,y("There was an issue while creating your offer."))}))}O(!1)},[x,q,G]),$=(0,A.I4)(async e=>{R(!1);try{await N().patch("/api/v1/group/offer").send((0,_._)((0,f._)({},G),{resend_email:e})),(0,Y.uX)("/publish/groups"),q(()=>(0,Z.tZ)(iN.FN,{text:w(Dm(),x)}))}catch(e){console.error("Failed to update group offer:",e),q(()=>(0,Z.tZ)(iN.FN,{text:(0,Y.zx)(e,y("There was an issue while creating your offer."))}))}L(!1)},[x,q,G]),en=(0,A.I4)(async e=>{e.preventDefault(),O(!0),p?await $(F):await K(),O(!1)},[p,K,$,F]);if(g.default_group_coupon&&0===Object.values(P).length)return(0,Z.tZ)(DZ,{});let eo=g.plans?null===(i=g.plans)||void 0===i?void 0:i.map(e=>{var t,i;return e.nickname&&e.id?{label:"".concat((0,er.centsToPriceString)(null!==(i=e.amount)&&void 0!==i?i:0,e.currency)," / ").concat(y(e.interval)).concat((null===(t=e.metadata)||void 0===t?void 0:t.founding)?" (\n                      ".concat(e.metadata.short_description,"\n                    )"):""),value:e.id}:null}).filter(e=>null!==e):[],ea=(0,Z.BX)(et.gq,{alignItems:"center",gap:4,children:[(0,Z.tZ)(tW.u,{text:w(Dg(),2),preferPlacement:"top-center",children:(0,Z.tZ)(Cp,{height:14,stroke:"var(--color-fg-secondary)",strokeWidth:"2",className:Du.roundedInfoIcon})}),(0,Z.BX)(ei.xv.B4,{color:"secondary",as:"span",children:[y("Default discount: "),W?(0,er.formatPercentForDisplay)(W):y("None")," ",!(null==J?void 0:null===(n=J.metadata)||void 0===n?void 0:n.founding)&&(0,Z.tZ)("a",{href:(0,j.wI3)(g,{section:"group-subscription-discount"}),target:"_blank",rel:"noopener",className:Du.changeGlobalDiscountLink,children:y("(Change)")})]})]});return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(et.tu,{paddingTop:48,alignItems:"center",justifyContent:"center",children:[(0,Z.tZ)(ei.xv.H2,{paddingBottom:32,children:v}),(0,Z.BX)(et.tu,{as:"form",className:Du.offerForm,gap:48,onSubmit:en,paddingX:32,paddingY:48,children:[(0,Z.tZ)(Df,{paddingBottom:48,borderBottom:"detail",children:(0,Z.tZ)(c8.B,{alignment:"horizontal",label:y("Group admin email"),children:(0,Z.tZ)(tD.oi,{className:Du.emailInput,value:x,onChange:e=>S(e.currentTarget.value)})})}),(0,Z.BX)(Df,{paddingBottom:48,borderBottom:"detail",children:[(0,Z.tZ)(c8.B,{alignment:"horizontal",label:y("Offer Type"),children:(0,Z.tZ)(gd,{options:Object.values(C),defaultValue:U,onChange:e=>{H(e)},className:Du.dropdown,variant:"light"})}),"per_seat"===U.value?(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(c8.B,{alignment:"horizontal",label:y("Subscription plan"),children:(0,Z.tZ)(gd,{options:eo,defaultValue:eo.find(e=>e.value===(null==J?void 0:J.id)),className:Du.dropdown,variant:"light",onChange:e=>{var t,i;V(null!==(i=null===(t=g.plans)||void 0===t?void 0:t.find(t=>t.id==e.value))&&void 0!==i?i:null),B(P[e.value])}})}),(0,Z.tZ)(c8.B,{alignment:"horizontal",label:y("Minimum Seats"),error:T<2,children:(0,Z.tZ)(o9,{className:Du.numberInput,value:null!==(a=null==T?void 0:T.toString())&&void 0!==a?a:2,onChange:e=>I(parseInt(e.target.value)),min:2})}),(0,Z.BX)(c8.B,{label:y("Discount"),alignment:"horizontal",detail:(null==J?void 0:null===(r=J.metadata)||void 0===r?void 0:r.founding)?"":ea,className:Du.relative,children:[(0,Z.tZ)(o9,{className:Du.percentInput,value:(null!=k?k:0).toString(),step:.01,onChange:e=>B(parseInt(e.target.value))}),(0,Z.tZ)(ei.xv.B4,{color:"secondary",className:Du.inputPercentage,children:"%"})]}),(0,Z.tZ)(D_,{percentOff:k,defaultRate:null==J?void 0:J.amount,currency:null==J?void 0:J.currency,minimumSeats:T,plan:J})]}):(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(c8.B,{alignment:"horizontal",label:"Minimum Seats",children:(0,Z.tZ)(tD.oi,{className:Du.numberInput,value:"Unlimited",disabled:!0})}),(0,Z.tZ)(c8.B,{detail:"Total annual price for unlimited seats",alignment:"horizontal",label:"Total Amount",children:(0,Z.BX)(et.gq,{className:Du.relative,alignItems:"center",children:[(0,Z.tZ)(ei.xv.B4,{color:"primary",className:Du.inputDollar,children:(0,er.currencySymbol)(null!==(l=null==J?void 0:J.currency)&&void 0!==l?l:"usd")}),(0,Z.tZ)(o9,{step:"0.01",className:Du.rateTotalInput,value:X.toString(),onChange:e=>M(parseFloat(e.target.value))})]})})]})]}),(0,Z.BX)(Df,{children:[(0,Z.BX)(ei.xv.B4,{color:"secondary",translated:!0,children:["The group subscription begins when the admin ",(0,Z.tZ)("b",{children:"accepts your offer"}),". When an admin accepts we automatically send them their first invoice. Admins have ",(0,Z.tZ)("b",{children:"30 days to complete their payment"})," ","otherwise the group subscription is canceled"]}),(0,Z.BX)(et.gq,{gap:12,children:[(0,Z.tZ)(ee.zx,{priority:"primary",type:"submit",disabled:z||D,children:z?y("Loading..."):b}),(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>(0,Y.uX)((0,j.rCb)(g)),children:y("Cancel")})]})]})]})]}),(0,Z.BX)(eK.u_,{isOpen:D,onClose:()=>R(!1),children:[(0,Z.BX)(eK.fe,{children:[(0,Z.tZ)(ei.xv.B3,{paddingTop:24,translated:!0,children:"An offer already exists for this email. Would you like to update it?"}),(0,Z.BX)(et.gq,{gap:8,paddingTop:24,children:[(0,Z.tZ)("input",{className:"check",type:"checkbox",onChange:e=>L(e.target.checked)}),(0,Z.tZ)(ei.xv.B4,{weight:"semibold",translated:!0,children:"Resend offer email"})]})]}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{onClick:()=>$(F),children:y("Confirm")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>R(!1),children:y("Cancel")})})]})]})},Df=e=>{var{children:t}=e,i=(0,ef._)(e,["children"]);return(0,Z.tZ)(et.tu,(0,_._)((0,f._)({gap:24},i),{children:t}))},D_=e=>{let{defaultRate:t,currency:i,plan:n,percentOff:r,minimumSeats:o}=e;if(!t)return null;let a=r?Bo({plan:n,percentOff:r}):t;return(0,Z.BX)(et.tu,{alignItems:"end",className:Du.rateInfo,gap:4,children:[(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"Minimum purchase total:"}),(0,Z.tZ)(ei.xv.B4,{as:"span",className:Du.planDetails,weight:"bold",children:o?(0,er.centsToPriceString)(a*o,i):"-"})]}),(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,children:"This group's price per seat:"}),(0,Z.tZ)(ei.xv.B4,{as:"span",className:Du.planDetails,weight:"bold",children:(0,er.centsToPriceString)(a,i)})]}),(0,Z.BX)(et.gq,{gap:16,children:[(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"Standard price per seat:"}),(0,Z.tZ)(ei.xv.B4,{as:"span",color:"secondary",className:Du.planDetails,decoration:r?"line-through":void 0,children:(0,er.centsToPriceString)(t,i)})]})]})},DZ=()=>(0,Z.tZ)(et.hs,{alignItems:"center",justifyContent:"center",paddingTop:32,children:(0,Z.tZ)(iI.$j,{})}),Dw="emailLink-z4x4OL";function DC(){let e=(0,G._)(["Minimum ",""]);return DC=function(){return e},e}function Dx(){let e=(0,G._)(["Are you sure you would like to cancel the offer to ","?"]);return Dx=function(){return e},e}let DS=e=>{var t;let{pub:i}=e,[n,r]=(0,A.eJ)([]),[o,a]=(0,A.eJ)(null),l=(0,iN.pm)(),{iString:s,iTemplate:d}=(0,Q.M1)(),c=async e=>{try{await N().delete("/api/v1/group/offer").send({user_id:e}),r([...n,e]),a(null),l.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:s("Offer successfully canceled")})))}catch(t){console.error("Failed to cancel offer for user id ".concat(e),t),l.popToast(e=>(0,Z.tZ)(iN.FN,(0,_._)((0,f._)({},e),{text:(0,Y.zx)(t,s("Failed to cancel offer"))})))}},u=[{key:"email",name:s("Admin"),sortable:!0,valueFn:e=>(0,Z.tZ)("a",{className:Dw,href:"/publish/groups/offer/".concat(e.user_id,"/edit"),children:(0,er.truncateText)(e.email,30)})},{key:"rate",name:s("Rate"),sortable:!0,valueFn:e=>{let t;return e.coupon_id?t="/publish/offers/".concat(e.coupon_id,"/edit"):e.stripe_plan_id&&(t=(0,en.a8l)(i,e.stripe_plan_id)),t?(0,Z.BX)("a",{href:t,children:[e.rate,"unlimited"!==e.type?" / ".concat(s("seat")):""]}):e.rate}},{key:"stripe_plan_id",name:s("Plan"),sortable:!0,valueFn:e=>{var t,i;return(null===(t=e.plan.metadata)||void 0===t?void 0:t.founding)?null!==(i=e.plan.metadata.short_description)&&void 0!==i?i:"":"year"===e.plan.interval?s("Annual"):s("Monthly")}},{key:"minimum_initial_seats",name:s("Seats"),sortable:!0,valueFn:e=>e.minimum_initial_seats?d(DC(),e.minimum_initial_seats):s("Unlimited")},{key:"created_on",name:s("Created on"),sortable:!0,valueFn:e=>(0,H.Z)(e.created_on).format("MMM DD YYYY")},{key:"expires_on",name:s("Expires on"),sortable:!0,valueFn:e=>(0,H.Z)(e.expires_on).format("MMM DD YYYY")},{key:"user_id",name:"",sortable:!1,valueFn:e=>(0,Z.BX)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{children:(0,Z.tZ)(pu.Z,{})}),children:[(0,Z.tZ)(tC.sN,{href:"/publish/groups/offer/".concat(e.user_id,"/edit"),children:s("Edit offer")}),(0,Z.tZ)(tC.sN,{priority:"destructive",onClick:()=>{a({userId:e.user_id,email:e.email})},children:s("Cancel offer")})]})}];return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(gu.Z,{children:[(0,Z.tZ)(ei.xv.H3,{paddingBottom:24,children:s("Pending offers")}),(0,Z.tZ)(ps,{url:"/api/v1/subscriber-stats/group-offers",cols:u,pageSize:5,defaultSort:{by:"email",direction:u8.Asc},isPannable:!0,deps:[n],empty:(0,Z.tZ)(u0,{icon:(0,Z.tZ)(um.Z,{}),title:s("No pending offers"),text:s("Your group subscription offers will show up here.")})})]}),(0,Z.BX)(eK.u_,{isOpen:!!o,onClose:()=>a(null),children:[(0,Z.tZ)(eK.fe,{children:d(Dx(),null!==(t=null==o?void 0:o.email)&&void 0!==t?t:"")}),(0,Z.tZ)(eK.mz,{primaryButton:(0,Z.tZ)(ee.zx,{priority:"primary",onClick:()=>c(null==o?void 0:o.userId),children:s("Continue")}),secondaryButton:(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:()=>a(null),children:s("Go Back")})})]})]})};function Dk(){let e=(0,G._)([" out of ",""]);return Dk=function(){return e},e}function DB(){let e=(0,G._)([" out of ",""]);return DB=function(){return e},e}let DT=()=>{let{iString:e,iTemplate:t,language:i}=(0,Q.M1)(),n=[{key:"user_email_address",name:e("Admin"),sortable:!0,valueFn:e=>(0,Z.tZ)("a",{className:Dw,href:(0,j.OGV)(e.subscription_id),rel:"noopener",children:(0,er.truncateText)(e.user_email_address,30)})},{key:"member_count",name:e("Seats Filled"),sortable:!0,valueFn:e=>{let i="";return e.seats_purchased&&(i=e.seats_purchased>e.member_count?t(Dk(),e.seats_purchased):t(DB(),e.member_count)),"".concat(e.member_count-1).concat(i)}},{key:"subscription_created_at",name:e("Start Date"),sortable:!0,valueFn:e=>(0,H.Z)(e.subscription_created_at).format("MMM DD YYYY")},{key:"subscription_expires_at",name:e("Expiry Date"),sortable:!0,valueFn:e=>(0,H.Z)(e.subscription_expires_at).format("MMM DD YYYY")},{key:"total_revenue_generated",name:e("Gross Annual Revenue"),sortable:!0,valueFn:e=>u3(e.total_revenue_generated,t=>{var i;return(0,er.centsToPriceString)(t,null!==(i=e.currency)&&void 0!==i?i:"usd")})},{key:"status",name:e("Status"),sortable:!1,valueFn:e=>u3(e.status,e=>(0,Dt.P$)(e,{language:i}))}];return(0,Z.tZ)(gu.Z,{children:(0,Z.tZ)(ps,{url:"/api/v1/subscriber-stats/group-subscriptions-stats",appendMode:!1,cols:n,defaultSort:{by:"user_email_address",direction:u8.Asc},pageSize:10,isPannable:!0,empty:(0,Z.tZ)(u0,{icon:(0,Z.tZ)(um.Z,{}),title:e("No current group subscriptions"),text:e("Your group subscribers will show up here.")})})})},DI=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)();return"enabled"===t.payments_state?(0,Z.tZ)(ee.zx,{href:"".concat((0,j.GIj)(),"/offer/new"),priority:"primary",children:i("Create new group offer")}):(0,Z.tZ)(ee.zx,{href:(0,j.wI3)(t,{section:"payments-settings"}),priority:"primary",children:i("Enable payments to sell group subscriptions")})},DN=e=>{let{pub:t}=e,{iString:i}=(0,Q.M1)();return(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(et.gq,{children:(0,Z.BX)(ee.zx,{priority:"tertiary",onClick:()=>window.history.back(),children:["â† ",i("Back")]})}),(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",children:[(0,Z.tZ)(ei.xv.H1,{children:i(" Group Subscriptions")}),(0,Z.tZ)(DI,{pub:t})]})]})},DP=e=>{let{pub:t}=e;return(0,Z.tZ)("section",{className:k()("page typography","pageContainer-kqj2dz"),children:(0,Z.BX)(et.tu,{gap:48,children:[(0,Z.tZ)(DN,{pub:t}),(0,Z.tZ)("div",{className:"table-wrapper",children:(0,Z.BX)("div",{className:"settings-element",children:[(0,Z.tZ)(DT,{}),(0,Z.tZ)(DS,{pub:t})]})})]})})};var DE=i(68648),DX=i(35937),DM=i.n(DX),DA=i(55877);let DD=e=>e.toLowerCase(),DR=e=>(0,_._)((0,f._)({},e),{background_pop:e.background_pop&&DD(e.background_pop),cover_bg_color:e.cover_bg_color&&DD(e.cover_bg_color),web_bg_color:e.web_bg_color&&DD(e.web_bg_color)}),DF=e=>{var t,i,n,r;return(0,_._)((0,f._)({},e),{font_preset_heading:null!==(t=e.font_preset_heading)&&void 0!==t?t:"sans",font_preset_body:null!==(i=e.font_preset_body)&&void 0!==i?i:"classic_serif",web_bg_color:null!==(n=e.web_bg_color)&&void 0!==n?n:"#ffffff",cover_bg_color:null!==(r=e.cover_bg_color)&&void 0!==r?r:"#ffffff"})},DL=e=>DR(DF(e)),Dz=e=>{let{updates:t,feedOfPostsSelected:i}=e;return(0,_._)((0,f._)({},f7()(t,"home_hero")),{homepage_type:i?"classic_post_list":t.home_hero})},DO=e=>(0,_._)((0,f._)({},f7()(e,["background_pop","cover_bg_color","hide_images_from_list","home_hero","home_hero_alignment","home_hero_show_podcast_links","home_posts","home_show_top_posts","web_bg_color"])),{accentColor:DD(e.background_pop),backgroundColor:DD(e.web_bg_color),body:e.home_posts,bodyFontPreset:e.font_preset_body,bodyGroups:e.body_post_groups.map(e=>{var t,i;return{type:e.section_id?"section":"tag",sectionId:null!==(t=e.section_id)&&void 0!==t?t:null,tagId:null!==(i=e.tag_id)&&void 0!==i?i:null}}),headingFontPreset:e.font_preset_heading,hero:e.home_hero,hideImagesFromList:e.hide_images_from_list,homeHeroAlignment:e.home_hero_alignment,homeHeroShowPodcastLinks:e.home_hero_show_podcast_links,showTopPosts:e.home_show_top_posts,welcomePageBackgroundColor:DD(e.cover_bg_color),defaultPostHeader:e.default_post_header_variant}),DU=e=>(0,_._)((0,f._)({},f7()(e,["accentColor","backgroundColor","body","bodyGroups","bodyFontPreset","defaultPostHeader","headingFontPreset","hero","hideImagesFromList","homeHeroAlignment","homeHeroShowPodcastLinks","preset","showTopPosts","welcomePageBackgroundColor"])),{background_pop:DD(e.accentColor),body_post_groups:e.bodyGroups.map((e,t)=>({order:t+1,section_id:"section"===e.type?e.sectionId:null,tag_id:"tag"===e.type?e.tagId:null})),cover_bg_color:DD(e.welcomePageBackgroundColor),font_preset_body:e.bodyFontPreset,font_preset_heading:e.headingFontPreset,hide_images_from_list:e.hideImagesFromList,home_hero:e.hero,home_hero_alignment:e.homeHeroAlignment,home_hero_show_podcast_links:e.homeHeroShowPodcastLinks,home_posts:e.body,home_show_top_posts:e.showTopPosts,web_bg_color:DD(e.backgroundColor),default_post_header_variant:e.defaultPostHeader}),DY=["font_size_body_desktop","font_family_ui","font_family_headings","font_family_body","print_secondary","custom_css_web","custom_css_email"],DH=e=>DY.some(t=>{var i;return null==e?void 0:null===(i=e.theme)||void 0===i?void 0:i[t]}),Dj=e=>{let{feedOfPostsSelected:t,initialPubTheme:i}=e,[n,r]=(0,A.eJ)({}),[o,a]=(0,A.eJ)({}),l=(0,to.useMemo)(()=>(0,f._)({},DO((0,f._)({},i,n)),o),[i,n,o]),s=DM()(DU(l),(e,t)=>{let r=(0,f._)({},i,n);return"body_post_groups"===t?!eS()(e)&&("string"==typeof e||"object"==typeof e&&"length"in e)&&e.length!==r[t].length||Array.isArray(e)&&e.some((e,i)=>!eC()(eI()(e,["order","section_id","tag_id"]),eI()(r[t][i],["order","section_id","tag_id"]))):!eC()(e,r[t])}),d=!im()(s),c=(0,A.I4)(e=>{a(t=>(0,f._)({},t,e))},[]);return{hasChanges:d,resetTheme:(0,A.I4)(()=>{a({})},[]),saveTheme:(0,A.I4)(async()=>{await N().put("/theme").send(Dz({updates:s,feedOfPostsSelected:t})),r((0,f._)({},n,s)),a({})},[t,s,n]),theme:l,updateTheme:c}},DJ=e=>{let{pub:t,postTags:i,onAddBlockCallback:n}=e,[r,o]=(0,A.eJ)([]),[a,l]=(0,A.eJ)([]),[s,d]=(0,A.eJ)({global:null,contentBlocks:{}}),c=a.length!==r.length||a.some((e,t)=>!eC()(e,r[t]));(0,A.d4)(()=>{(async()=>{try{let{body:e}=await N().get("/api/v1/content_block");o(e),l(e)}catch(e){console.error(e)}})()},[]),(0,A.d4)(()=>{u()},[a]);let u=()=>{d({global:null,contentBlocks:{}})},p=async()=>{await N().put("/api/v1/content_block").send(a),o(a)},h=nN()(t.sections,"id"),m=nN()(i,"id");return{contentBlocks:(0,to.useMemo)(()=>a.map(e=>"section"===e.post_source&&e.section_id?(0,_._)((0,f._)({},e),{section:h[e.section_id]}):"tag"===e.post_source&&e.post_tag_id?(0,_._)((0,f._)({},e),{postTag:m[e.post_tag_id]}):e),[a,m,h]),contentBlockErrors:s,hasChanges:c,saveContentBlocks:p,onAddBlock:e=>{let{layoutID:i}=e,r=(0,DA.v4)();l([...a,{attrs:{},block_type:i,id:r,order:a.length,post_source:"subscribe"===i?"none":"latest",post_tag_id:null,primary_sidebar_modules:[],publication_id:t.id,secondary_sidebar_modules:[],section_id:null}]),setTimeout(()=>{n(r)},200)},onChangeBlocks:l,onClearContentBlockErrors:u,onDeleteBlock:e=>{l(t=>t.filter(t=>t.id!==e))},onChangeContentBlockErrors:d,onUpdateBlock:e=>{let{id:t,updates:i}=e;l(e=>e.map(e=>e.id===t?(0,f._)({},e,i):e))}}},DV={hero_alignment:"left",page_hero:"default",page_posts:"list",show_podcast_links:!0},Dq=e=>{var t;let{page:i,pub:n,sectionId:r}=e,o=n.sections.find(e=>e.id===r),[a,l]=(0,A.eJ)({}),[s,d]=(0,A.eJ)({}),[c,u]=(0,A.eJ)(!1),p=o?(0,f._)({},DV,o.pageTheme,a[o.id],s[o.id]):"podcast"===i?(0,f._)({},DV,null===(t=n.pageThemes)||void 0===t?void 0:t.podcast,a.podcast,s.podcast):null;return{reset:()=>{r?d(e=>f7()(e,r)):"podcast"===i&&d(e=>f7()(e,"podcast"))},save:async()=>{(r||i)&&p&&(u(!0),r?(await N().patch("/api/v1/publication/sections/".concat(r,"/page_theme")).send(p),l(e=>(0,_._)((0,f._)({},e),{[r]:p})),d(e=>f7()(e,r))):(await N().patch("/api/v1/publication/page_theme").send((0,_._)((0,f._)({},p),{page:"podcast"})),l(e=>(0,_._)((0,f._)({},e),{podcast:p})),d(e=>f7()(e,"podcast"))),u(!1))},pageTheme:p,saving:c,setPageTheme:e=>{let{pageTheme:t,sectionId:i,page:n}=e;i?d(e=>(0,_._)((0,f._)({},e),{[i]:t})):"podcast"===n&&d(e=>(0,_._)((0,f._)({},e),{[n]:t}))},hasChanges:r?!!s[r]:"podcast"===i&&!!s.podcast}},DW=e=>{let{shouldFetch:t}=e,[i,n]=(0,A.eJ)(null);return(0,A.d4)(()=>{t&&(i||(async()=>{try{let e=await N().get("/api/v1/publication/post-tag");n(e.body)}catch(e){console.error(e)}})())},[i,t]),{postTags:i}},DG=e=>{let{theme:t}=e,[i,n]=(0,A.eJ)(null);return(0,A.d4)(()=>{(async()=>{let{background_contrast:e,white_contrast:i}=(await N().post("/theme/validate_colors").send({web_bg_color:t.backgroundColor,background_pop:t.accentColor})).body;e&&i?n(null):n(nT()([!i&&"Your accent color can't be that close to white. Try picking something more colorful.",!e&&"We recommend picking an accent color that stands out more from your background."]))})()},[t.accentColor,t.backgroundColor]),{colorErrors:i}},DK=(e,t)=>{if(e.navigator.userAgent!==t)try{Object.defineProperty(e.navigator,"userAgent",{get:()=>t,configurable:!0})}catch(e){console.warn("Failed to set userAgent",e)}},DQ=e=>{let{iFrameRef:t}=e,[i,n]=(0,A.eJ)("desktop");return[i,e=>{var i;(null===(i=t.current)||void 0===i?void 0:i.contentWindow)&&DK(t.current.contentWindow,"mobile"===e?"Mozilla/5.0 (iPhone; CPU iPhone OS 14_7_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.2 Mobile/15E148 Safari/604.1":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36"),n(e)}]},D$=e=>(0,Z.tZ)(eH.l,(0,_._)((0,f._)({},e),{name:"DesktopIcon",svgParams:{height:17,width:22,viewBox:"0 0 22 17",stroke:"#1C110B"},children:(0,Z.tZ)("path",{d:"M18.9998 12L20.2798 14.55C20.3569 14.703 20.3934 14.8732 20.3858 15.0444C20.3782 15.2155 20.3267 15.3818 20.2364 15.5274C20.1461 15.6729 20.0198 15.7928 19.8698 15.8756C19.7198 15.9584 19.5511 16.0012 19.3798 16H2.61978C2.44847 16.0012 2.27972 15.9584 2.12972 15.8756C1.97972 15.7928 1.8535 15.6729 1.76315 15.5274C1.67281 15.3818 1.62137 15.2155 1.61378 15.0444C1.60618 14.8732 1.64268 14.703 1.71978 14.55L2.99978 12M18.9998 12V3C18.9998 2.46957 18.7891 1.96086 18.414 1.58579C18.0389 1.21071 17.5302 1 16.9998 1H4.99978C4.46934 1 3.96064 1.21071 3.58556 1.58579C3.21049 1.96086 2.99978 2.46957 2.99978 3V12H18.9998ZM18.9998 12H2.99978H18.9998Z",stroke:e.stroke,"stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})})),D0=e=>(0,Z.BX)(eH.l,(0,_._)((0,f._)({},e),{name:"MobileIcon",svgParams:{height:24,width:24,viewBox:"0 0 24 24",stroke:"#1C110B"},children:[(0,Z.tZ)("path",{d:"M17 2H7C5.89543 2 5 2.89543 5 4V20C5 21.1046 5.89543 22 7 22H17C18.1046 22 19 21.1046 19 20V4C19 2.89543 18.1046 2 17 2Z",stroke:e.stroke,"stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),(0,Z.tZ)("path",{d:"M12 18H12.01",stroke:"#1C110B","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})]})),D1="FEED_OF_POSTS_SELECTED_CHANGED",D2="HOMEPAGE_DATA_CHANGED",D4="REQUEST_ALL_DATA",D3="THEME_EDITOR_PAGE_THEME_CHANGED",D8="THEME_EDITOR_POST_TAGS_CHANGED",D6="THEME_EDITOR_SHOW_CHANGED",D5="THEME_EDITOR_THEME_CHANGED",D9="THEME_EDITOR_USER_ROLE_FOR_PREVIEW_CHANGED",D7=e=>{let{language:t}=e,{iString:i}=I18N.i(t);return{half_feature:{label:i("Half feature"),description:i("A mini feature block that takes up half a page"),id:"half_feature"},single_post:{label:i("Single post"),description:i("Highlight a single post"),id:"single_post"},podcast_plus_three:{label:i("Podcast plus three"),description:i("A podcast episode with three posts"),id:"podcast_plus_three"},subscribe_plus_five:{label:i("Subscribe"),description:i("A subscribe block with extra promo units"),id:"subscribe_plus_five"},media_carousel:{label:i("Media carousel"),description:i("A carousel of podcasts or video shows"),id:"media_carousel"}}},Re=e=>{let{pub:t}=e,{iString:i,language:n}=(0,Q.M1)();return(0,oo.HD)({pub:t})?(0,f._)({feature:{label:i("Feature"),description:i("Choose a tag or newsletter to highlight"),id:"feature"}},D7({language:n})):{list:{label:i("List"),description:i("List of posts with custom sidebar options"),id:"list"},grid:{label:i("Grid"),description:i("Grid of posts with custom sidebar options"),id:"grid"},feature:{label:i("Feature"),description:i("Choose a tag or section to highlight"),id:"feature"},subscribe:{label:i("Subscribe"),description:i("Add a call to action to subscribe"),id:"subscribe"}}},Rt=e=>{var t;let{activePreview:i,device:n,feedOfPostsSelected:r,homepageData:o,iFrameRef:a,pageTheme:l,postTags:s,scrollToSection:d,theme:c,userRoleForPreview:u,onChangeActivePreview:p,onChangeDevice:h}=e,{iString:m}=(0,Q.M1)(),g=(0,A.sO)(null),{previewHeight:v,previewWidth:b,previewScale:y}=Rn({containerRef:g,isMobile:"mobile"===n});(0,A.d4)(()=>{let e=()=>{var e;(null===(e=a.current)||void 0===e?void 0:e.contentWindow)&&(a.current.contentWindow.postMessage({type:D8,value:s},"*"),a.current.contentWindow.postMessage({type:D2,value:o},"*"),a.current.contentWindow.postMessage({type:D6,value:i},"*"),a.current.contentWindow.postMessage({type:D3,value:l},"*"))},t=t=>{t.data.type&&t.data.type===D4&&e()};return window.addEventListener("message",t),()=>{window.removeEventListener("message",t)}},[l,s,o,a,i]),Ri({iFrameRef:a,value:u,type:D9}),Ri({iFrameRef:a,value:i,type:D6}),Ri({iFrameRef:a,value:(0,to.useMemo)(()=>DU(c),[c]),type:D5}),Ri({iFrameRef:a,value:s,type:D8}),Ri({iFrameRef:a,value:r,type:D1}),Ri({iFrameRef:a,value:o,type:D2}),Ri({iFrameRef:a,value:l,type:D3});let f=(0,A.I4)(e=>{setTimeout(()=>{var t,i,n,r;let o=null!==(r=null===(t=a.current)||void 0===t?void 0:t.contentDocument)&&void 0!==r?r:null===(n=a.current)||void 0===n?void 0:null===(i=n.contentWindow)||void 0===i?void 0:i.document;if(!o)return;let l=o.getElementById(e);l&&l.scrollIntoView({behavior:"smooth"})},200)},[a]);return(0,A.d4)(()=>{if(g.current&&d){if("top"===d){g.current.scrollTo({top:0,behavior:"smooth"});return}if("body"===d){f("home-body");return}if(/^block-.+$/.test(d)){f(d);return}}},[f,d]),(0,Z.BX)(et.tu,{className:"container-oKqNza",children:[(0,Z.BX)(et.gq,{justifyContent:"space-between",alignItems:"center",paddingX:32,paddingTop:32,children:["number"==typeof i||"podcast"===i?(0,Z.tZ)("div",{}):(0,Z.tZ)(tx.Z,{tabs:[{label:m("Homepage"),value:"homepage"},{label:m("Welcome page"),value:"welcome"},{label:m("Post"),value:"post"}],value:i,onChange:p}),(0,Z.tZ)(tx.Z,{tabs:[{value:"desktop",label:(0,Z.tZ)(et.gq,{alignItems:"center",children:(0,Z.tZ)(D$,{height:16,stroke:"currentColor"})})},{value:"mobile",label:(0,Z.tZ)(et.gq,{alignItems:"center",children:(0,Z.tZ)(D0,{height:16,stroke:"currentColor"})})}],value:n,onChange:h})]}),(0,Z.tZ)(et.gq,{flex:"grow",position:"relative",ref:g,children:(0,Z.tZ)("iframe",{ref:a,className:k()("iframe-Vlz67q",{[(t="iframeLoaded-oOTkIc",void 0!==t)?t:""]:!!o}),style:{top:24,left:"50%",marginLeft:"-".concat(b*y/2,"px"),height:v,width:b,transform:"scale(".concat(y,")")},src:"/publish/settings/website-theme-preview"})})]})},Ri=e=>{let{iFrameRef:t,value:i,type:n}=e;(0,A.d4)(()=>{var e;(null===(e=t.current)||void 0===e?void 0:e.contentWindow)&&t.current.contentWindow.postMessage({type:n,value:i},"*")},[i,t,n])},Rn=e=>{let{containerRef:t,isMobile:i}=e,[n,r]=(0,A.eJ)(800),[o,a]=(0,A.eJ)(1e3);return((0,A.d4)(()=>{let e=()=>{if("undefined"!=typeof window&&t.current&&t.current){let e=t.current.offsetWidth-64,i=t.current.offsetHeight-48;r(e),a(i)}};return requestAnimationFrame(e),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[t,i]),i)?o<=844?{previewHeight:844,previewWidth:390,previewScale:o/844}:{previewHeight:844,previewWidth:390,previewScale:1}:n>=1280?{previewHeight:o,previewWidth:n,previewScale:1}:{previewHeight:1280/n*o,previewWidth:1280,previewScale:n/1280}},Rr=e=>{let{title:t,description:i,onClick:n}=e;return(0,Z.tZ)(n_.J,{hoverBackground:"light",onClick:n,children:(0,Z.BX)(et.gq,{alignItems:"center",borderBottom:"detail",justifyContent:"space-between",padding:16,children:[(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ei.xv.B2,{weight:"semibold",children:t}),(0,Z.tZ)(ei.xv.B5,{color:"secondary",children:i})]}),(0,Z.tZ)(ez.Z,{size:20})]})})},Ro=e=>{let{children:t}=e;return(0,Z.tZ)(et.gq,{borderTop:"detail",gap:8,justifyContent:"end",paddingX:16,paddingY:20,children:t})},Ra=e=>{let{action:t,children:i,onBack:n}=e;return(0,Z.tZ)(n_.J,{disable:!n,hoverBackground:"light",onClick:n,children:(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",paddingX:16,children:[(0,Z.BX)(et.gq,{alignItems:"center",gap:8,paddingY:16,children:[n&&(0,Z.tZ)(et.gq,{flex:"auto",children:(0,Z.tZ)(uV.Z,{size:20})}),(0,Z.tZ)(ei.xv.H4,{weight:"medium",children:i})]}),t]})})},Rl=e=>{let{actions:t,actionProps:i,children:n,title:r,titleAction:o,onBack:a}=e,{iString:l}=(0,Q.M1)();return(0,Z.BX)(Z.HY,{children:[(0,Z.BX)(et.tu,{width:360,flex:"grow",overflowY:"auto",children:[(0,Z.tZ)(hp.J,{content:(0,Z.BX)(et.tu,{gap:12,padding:8,children:[(0,Z.tZ)(ei.xv.B3,{translated:!0,weight:"semibold",children:"You have unsaved changes"}),(0,Z.BX)(et.gq,{gap:8,justifyContent:"end",children:[(0,Z.tZ)(ee.zx,{priority:"secondary",size:"sm",onClick:null==i?void 0:i.onCancel,children:l("Discard changes")}),(0,Z.tZ)(ee.zx,{disabled:null==i?void 0:i.isSaving,priority:"primary-mono",size:"sm",onClick:null==i?void 0:i.onSave,children:l("Save")})]})]}),disabled:!i,children:(0,Z.tZ)(Ra,{action:o,onBack:a?()=>{(null==i?void 0:i.hasChanges)||a()}:void 0,children:r})}),n]}),i?(0,Z.BX)(Ro,{children:[(0,Z.tZ)(ee.zx,{priority:"secondary",onClick:i.onCancel,children:l("Cancel")}),(0,Z.tZ)(ee.zx,{disabled:!i.hasChanges||i.isSaving,priority:"primary-mono",onClick:i.onSave,children:l("Save")})]}):t]})},Rs=e=>{let{hasAdvanced:t,pub:i,onChangeSidebarNavState:n,onClickDone:r}=e,{iString:o}=(0,Q.M1)(),a={};i.navigationBarItems.forEach((e,t)=>{e.section&&(a[e.section.id]=t)});let l=sL()(i.sections,e=>{var t;return null!==(t=a[e.id])&&void 0!==t?t:999}),s=l.length>0||(0,nC.A$)(i)&&i.show_pub_podcast_tab;return(0,Z.BX)(Rl,{title:o("Theme settings"),actions:(0,Z.tZ)(Ro,{children:(0,Z.tZ)(ee.zx,{priority:"primary-mono",onClick:r,children:o("Done")})}),children:[(0,Z.tZ)(Rr,{title:o("Branding"),description:o("Choose colors, fonts and logos"),onClick:()=>{n("branding")}}),(0,Z.tZ)(Rr,{title:o("Homepage"),description:o("Customize your homepage"),onClick:()=>{n("homepage")}}),s&&(0,Z.BX)(et.tu,{borderBottom:"detail",paddingX:16,paddingBottom:16,children:[(0,Z.tZ)(et.tu,{paddingTop:16,paddingBottom:12,children:(0,Z.tZ)(ei.xv.B2,{weight:"semibold",translated:!0,children:"Sections"})}),(0,Z.BX)(et.tu,{gap:4,children:[(0,nC.A$)(i)&&i.show_pub_podcast_tab&&(0,Z.tZ)(Rd,{onClick:()=>{n("podcast")},children:(0,Z.BX)(et.gq,{alignItems:"center",gap:12,children:[(0,Z.tZ)(et.tu,{alignItems:"center",justifyContent:"center",height:32,width:32,children:(0,Z.tZ)(g4.Z,{size:20})}),(0,Z.tZ)(ei.xv.B3,{weight:"semibold",children:"Podcast"})]})}),l.map(e=>(0,Z.tZ)(Rd,{onClick:()=>{n(e.id)},children:(0,Z.BX)(et.gq,{alignItems:"center",gap:12,overflow:"hidden",children:[(0,Z.tZ)(et.gq,{flex:"auto",children:(0,Z.tZ)(mP,{pub:i,sectionId:e.id,size:32})}),(0,Z.tZ)(ei.xv.B3,{weight:"semibold",ellipsis:!0,children:e.name})]})}))]})]}),t&&(0,Z.tZ)(Rr,{title:o("Advanced"),description:o("Advanced settings"),onClick:()=>{n("advanced")}})]})},Rd=e=>{let{children:t,onClick:i}=e;return(0,Z.tZ)(n_.J,{hoverBackground:"light",padding:8,radius:"sm",onClick:i,children:(0,Z.BX)(et.gq,{alignItems:"center",gap:12,justifyContent:"space-between",children:[t,(0,Z.tZ)(et.gq,{flex:"auto",children:(0,Z.tZ)(ez.Z,{size:20})})]})})},Rc=e=>{let{pub:t}=e;if(!t||!t.theme)return null;let i=DY.filter(e=>{var i;return null==t?void 0:null===(i=t.theme)||void 0===i?void 0:i[e]});return i.length?(0,Z.BX)(et.tu,{gap:24,children:[(0,Z.tZ)(ei.xv.B4,{color:"secondary",translated:!0,children:"These are raw settings that have been manually applied to your publication. They will override other theme variables you set in the above sections. To reset these, please contact support@substack.com."}),i.map(e=>(0,Z.tZ)(i1.g,{label:rT()(e).replace(/Css/g,"CSS"),children:(0,Z.tZ)("div",{className:"content-qAdt2k",children:t.theme[e]})}))]}):null},Ru=e=>{let{pub:t,onBack:i}=e,{iString:n}=(0,Q.M1)();return(0,Z.tZ)(Rl,{title:n("Advanced"),onBack:i,children:(0,Z.tZ)(et.tu,{padding:16,children:(0,Z.tZ)(Rc,{pub:t})})})};var Rp=i(95534),Rh=i.n(Rp),Rm=i(73820);let Rg=e=>{let{renderDropdown:t,children:i,onSelect:n,noBorder:r,className:o,root:a,disabled:l=!1}=e,[s,d]=(0,A.eJ)(!1),c=(0,A.sO)(),u=(0,A.I4)(()=>{var e;d(!1),(a||(null==c?void 0:null===(e=c.current)||void 0===e?void 0:e.closest('[role="dialog"]'))||window).removeEventListener("click",u)},[a]),p=(0,A.I4)(()=>{s||l||(d(!0),setTimeout(()=>{var e;(a||(null==c?void 0:null===(e=c.current)||void 0===e?void 0:e.closest('[role="dialog"]'))||window).addEventListener("click",u)},0))},[s,a,l]);return(0,Z.BX)("div",{className:k()("dropdown-base",o,{"no-border":r}),onClick:p,ref:c,children:[i,(0,Z.tZ)("div",{className:k()("dropdown-content",{open:s}),children:t({onSelect:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];n&&n(...t),u()}})})]})},Rv=["fancy_serif","sans","heavy_sans","mono","slab"],Rb=["fancy_serif","classic_serif","sans","mono","slab"],Ry="'SF Pro Display', -apple-system, system-ui, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'",Rf={heading:{fancy_serif:{font:"Lora",weight:600,fallback:"sans-serif"},mono:{font:"Roboto Mono",weight:700,fallback:"monospace"},slab:{font:"Roboto Slab",weight:700,fallback:"sans-serif"}},body:{fancy_serif:{font:"Lora",weight:400,fallback:"sans-serif"},classic_serif:{font:"Spectral",weight:400,fallback:"sans-serif"},mono:{font:"Roboto Mono",weight:400,fallback:"monospace"},slab:{font:"Roboto Slab",weight:400,fallback:"sans-serif"}}},R_=function(e){var t;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;if("sans"===e)return{fontFamily:Ry,fontWeight:700};if("heavy_sans"===e)return{fontFamily:Ry,fontWeight:900};let n=null===(t=Rf.heading)||void 0===t?void 0:t[e];if(!n)return null;let r=n.font.match(" ")?"'".concat(n.font,"'"):n.font;return(0,f._)({fontFamily:i?n.fallback:[r,n.fallback].join(",")},n.weight&&{fontWeight:n.weight})},RZ=function(e){var t;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;if("sans"===e)return{fontFamily:Ry,fontWeight:400};let n=null===(t=Rf.body)||void 0===t?void 0:t[e];if(!n)return null;let r=n.font.match(" ")?"'".concat(n.font,"'"):n.font;return(0,f._)({fontFamily:i?n.fallback:[r,n.fallback].join(",")},n.weight&&{fontWeight:n.weight})},Rw=[["FF6719","e11d48","ec4899","c026d3","9333ea","7c3aed"],["4f46e5","2563eb","0284c7","0891b2","0d9488","059669"],["16a34a","65a30d","a16207","d97706","ea580c","292524"],["4c0519","1e1b4b","042f2e","1a2e05","431407","020617"]],RC=[["ffffff","fafafa","fff1f2","fdf2f8","faf5ff","fdf4ff"],["f3e8ff","eef2ff","eff6ff","f0f9ff","ecfeff","f0fdfa"],["ecfdf5","f0fdf4","f7fee7","fffbeb","fff7ed","fef2f2"],["292524","171717","111827","020617","1e1b4b","042f2e"]],Rx=e=>!!(e&&e.match(/#?f{3,6}$/i)),RS={accent:Rw,background:RC},Rk=e=>{var t,i;let{color:n,hasError:r}=e;return(0,Z.BX)(et.gq,{alignItems:"center",className:k()("container-UME0t1",{[(t="containerError-jWRem7",void 0!==t)?t:"undefined"]:r}),gap:8,border:"detail",padding:6,paddingRight:16,radius:"sm",children:[(0,Z.tZ)("div",{className:k()("swatch-m_qTnE",{[(i="swatchWhite-XQeuV9",void 0!==i)?i:"undefined"]:Rx(n)}),style:{background:n}}),(0,Z.tZ)(ei.xv.B3,{className:"label-iy3NHN",children:null!=n?n:"-- Select color --"}),(0,Z.tZ)(o7,{height:4})]})},RB=e=>{let{color:t,presets:i,onSelect:n,info:r,label:o}=e;return(0,Z.BX)("div",{className:"dl-color-picker",onClick:e=>e.stopPropagation(),children:[i.map(e=>(0,Z.tZ)("div",{className:"color-row",children:e.map(e=>(0,Z.tZ)("div",{className:k()("color-sq",{"is-selected":t==="#".concat(e)}),style:{background:"#".concat(e)},onClick:()=>n("#".concat(e))}))})),(0,Z.tZ)(tD.oi,{type:"text",value:t,"aria-label":o,autoFocus:!0,onFocus:e=>{e.currentTarget.dataset.previousValue=t},onBlur:e=>{var i,r;let o=e.currentTarget.value,a=e.currentTarget.dataset.previousValue||t,l=(o=(i=o).startsWith("#")?i:"#".concat(i)).slice(1);o="#".concat((r=l,/^[0-9A-F]{1}$/i.test(r)?r.repeat(6):/^[0-9A-F]{2}$/i.test(r)?r.repeat(3):/^[0-9A-F]{3,5}$/i.test(r)?r.split("").map(e=>e+e).join("").slice(0,6):r)),(0,er.validateHex)(o)?n(o):n(a)}}),r&&(0,Z.tZ)("p",{children:r})]})},RT=e=>{let{color:t,hasError:i=!1,onSelect:n,presets:r,info:o}=e;return(0,Z.tZ)(Rg,{onSelect:n,renderDropdown:e=>(0,Z.tZ)(RB,(0,_._)((0,f._)({},e),{color:t,presets:RS[r],info:o})),children:(0,Z.tZ)(Rk,{color:t,hasError:i})})},RI=e=>{let{errors:t,info:i,label:n,paddingTop:r,paddingBottom:o,presets:a,value:l,onChange:s}=e;return(0,Z.tZ)(i1.g,{errors:t,label:n,paddingBottom:o,paddingTop:r,children:(0,Z.tZ)(RT,{color:l,hasError:!!(null==t?void 0:t.length),presets:a,info:i,onSelect:s})})},RN=e=>{let{font:t,presetType:i}=e,n="heading"===i?R_(t):"body"===i?RZ(t):void 0;return(0,Z.BX)(et.gq,{alignItems:"center",border:"detail",radius:"sm",bg:"primary",cursor:"pointer",className:"container-iQPi0d",height:40,paddingX:12,children:[(0,Z.tZ)(ei.xv.B3,{style:null!=n?n:void 0,flex:"grow",children:t?rT()(t):"-- Choose a font --"}),(0,Z.tZ)(o7,{height:4})]})},RP=e=>{let{presetType:t,onSelect:i}=e,n="heading"===t?Rv:"body"===t?Rb:[];return(0,Z.tZ)(et.tu,{bg:"elevated",padding:4,onClick:e=>e.stopPropagation(),children:n.map(e=>{var n,r;return(0,Z.tZ)(et.gq,{paddingX:8,height:40,alignItems:"center",cursor:"pointer",className:"row-Mj3srJ",onClick:()=>i(e),radius:"xs",children:(0,Z.tZ)(ei.xv.B3,{style:"heading"===t?null!==(n=R_(e))&&void 0!==n?n:void 0:"body"===t&&null!==(r=RZ(e))&&void 0!==r?r:void 0,children:rT()(e)})},e)})})},RE=e=>{let{font:t,presetType:i,onSelect:n}=e;return(0,Z.tZ)(Rg,{onSelect:n,renderDropdown:e=>(0,Z.tZ)(RP,(0,_._)((0,f._)({},e),{presetType:i})),children:(0,Z.tZ)(RN,{font:t,presetType:i})})},RX=e=>{let{label:t,presetType:i,value:n,onChange:r}=e;return(0,Z.tZ)(i1.g,{label:t,children:(0,Z.tZ)(RE,{font:n,presetType:i,onSelect:e=>r(e)})})},RM=e=>{let{isColored:t,accentColor:i,bodyFont:n}=e,r=(0,_._)((0,f._)({},RZ(n)),{color:t?i:"inherit",textDecoration:t?"none":"underline"});return(0,Z.BX)(et.gq,{alignItems:"center",border:"detail",radius:"sm",bg:"primary",cursor:"pointer",className:"container-dFEwds",height:40,paddingX:12,children:[(0,Z.tZ)(ei.xv.B3,{style:r,flex:"grow",children:t?"Colored links":"Underlined links"}),(0,Z.tZ)(o7,{height:4})]})},RA=e=>{let{onSelect:t,accentColor:i,bodyFont:n}=e;return(0,Z.tZ)(et.tu,{bg:"elevated",padding:4,onClick:e=>e.stopPropagation(),children:[{label:"Colored links",value:!0},{label:"Underlined links",value:!1}].map(e=>{let{label:r,value:o}=e;return(0,Z.tZ)(et.gq,{paddingX:8,height:40,alignItems:"center",cursor:"pointer",className:"row-iIrzmT",onClick:()=>t(o),radius:"xs",children:(0,Z.tZ)(ei.xv.B3,{style:(0,_._)((0,f._)({},RZ(n)),{color:o?i:"inherit",textDecoration:o?"none":"underline"}),children:r})},r)})})},RD=e=>{let{isColored:t,onSelect:i,accentColor:n,bodyFont:r}=e;return(0,Z.tZ)(Rg,{onSelect:i,renderDropdown:e=>(0,Z.tZ)(RA,(0,_._)((0,f._)({},e),{accentColor:n,bodyFont:r})),children:(0,Z.tZ)(RM,{isColored:t,accentColor:n,bodyFont:r})})},RR=e=>{let{label:t,value:i,onChange:n,accentColor:r,bodyFont:o}=e;return(0,Z.tZ)(i1.g,{label:t,children:(0,Z.tZ)(RD,{isColored:i,onSelect:e=>n(e),accentColor:r,bodyFont:o})})},RF=e=>{let{children:t,isExpanded:i,isHidden:n,title:r,onToggle:o}=e;return n?null:(0,Z.BX)(et.tu,{children:[(0,Z.BX)(et.gq,{alignItems:"center",bg:"secondary",cursor:"pointer",radius:"xs",justifyContent:"space-between",padding:12,onClick:o,children:[(0,Z.tZ)(ei.xv.B3,{weight:"semibold",children:r}),i?(0,Z.tZ)(PQ.Z,{size:16}):(0,Z.tZ)(ta.Z,{size:16})]}),(0,Z.tZ)(ik.H,{expanded:i,children:(0,Z.tZ)(et.tu,{paddingX:8,paddingTop:16,paddingBottom:8,children:t})})]})},RL=e=>{var t;let{colorErrors:i,hasChanges:n,isSaving:r,pub:o,theme:a,onBack:l,onCancel:s,onChangeLogo:d,onSave:c,onUpdateTheme:u,onUpdatePub:p}=e,{iString:h}=(0,Q.M1)(),[m,g]=(0,A.eJ)(a.backgroundColor.toLowerCase()===a.welcomePageBackgroundColor.toLowerCase()),[v,b]=(0,A.eJ)(!0),[y,_]=(0,A.eJ)(o.logo_url),[w,C]=(0,A.eJ)(o.logo_url_wide),[x,S]=(0,A.eJ)(!0),[k,B]=(0,A.eJ)(!0),T=(0,oo.HD)({pub:o}),[I,N]=(0,A.eJ)(T),P=()=>{u({backgroundColor:"#".concat(Rh()(fB()(RC))),accentColor:"#".concat(Rh()(fB()(Rw))),headingFontPreset:Rh()(Rv),bodyFontPreset:Rh()(Rb)})};return(0,Z.tZ)(Rl,{actionProps:{hasChanges:n,isSaving:r,onCancel:s,onSave:c},title:h("Branding"),titleAction:(0,Z.tZ)(tW.u,{text:h("Pick random colors and fonts"),children:(0,Z.tZ)(ee.hU,{size:"sm",priority:"secondary",onClick:e=>{e.stopPropagation(),P()},children:(0,Z.tZ)(Rm.Z,{size:16})})}),onBack:l,children:(0,Z.BX)(et.tu,{gap:16,padding:16,children:[(0,Z.tZ)(RF,{title:h("Logos"),isExpanded:v,onToggle:()=>{b(!v)},children:(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(TK,{publication:o,submitWithAjax:!0,url:y,onChangeLogo:e=>{_(e),d()}}),(0,Z.tZ)(ik.H,{expanded:!!y,children:(0,Z.tZ)(et.tu,{paddingTop:16,children:(0,Z.tZ)(TQ,{publication:o,submitWithAjax:!0,url:w,onChangeLogo:e=>{C(e),d()}})})})]})}),(0,Z.tZ)(RF,{title:h("Colors"),isExpanded:x,onToggle:()=>{S(!x)},children:(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(RI,{presets:"background",label:h("Web background"),value:a.backgroundColor,onChange:e=>{u((0,f._)({backgroundColor:e},m&&{welcomePageBackgroundColor:e}))}}),(0,Z.BX)("div",{children:[(0,Z.tZ)(ik.H,{expanded:!m,children:(0,Z.tZ)(RI,{paddingBottom:16,presets:"background",label:h("Welcome page background"),value:a.welcomePageBackgroundColor,onChange:e=>{u({welcomePageBackgroundColor:e})}})}),(0,Z.tZ)(iw.j,{label:h("Use same color for welcome page"),value:m,onChange:e=>{g(e),e&&u({welcomePageBackgroundColor:a.backgroundColor})}})]}),(0,Z.tZ)(RI,{errors:i,presets:"accent",label:h("Accent Color"),value:a.accentColor,onChange:e=>{u({accentColor:e})}})]})}),(0,Z.tZ)(RF,{isExpanded:k,title:h("Typography"),onToggle:()=>{B(!k)},children:(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(RX,{presetType:"heading",label:h("Heading Font"),value:a.headingFontPreset,onChange:e=>{u({headingFontPreset:e})}}),(0,Z.tZ)(RX,{presetType:"body",label:h("Body Font"),value:a.bodyFontPreset,onChange:e=>{u({bodyFontPreset:e})}}),(0,Z.tZ)(RR,{label:h("Link style"),value:o.theme_var_color_links,onChange:e=>{p("theme_var_color_links",e)},accentColor:a.accentColor,bodyFont:a.bodyFontPreset})]})}),T&&(0,Z.tZ)(RF,{title:h("Post headers"),isExpanded:I,onToggle:()=>{N(!I)},children:(0,Z.tZ)(iT.m,{label:h("Default post header style"),options:[{value:"portrait-image",label:"Portrait image header"},{value:"landscape-image",label:"Landscape image header"},{value:"full-width-image",label:"Full width image header"}],value:null!==(t=a.defaultPostHeader)&&void 0!==t?t:"",onChange:e=>{u({defaultPostHeader:e})}})})]})})};var Rz=i(40160),RO=i(94697),RU=i(45587),RY=i(24285);let RH={emptyMessage:"emptyMessage-hiBWyX"},Rj=e=>{let{label:t,id:i,onRemove:n}=e,{attributes:r,listeners:o,setNodeRef:a,transform:l,transition:s,setActivatorNodeRef:d,isDragging:c}=(0,RU.nB)({id:i}),u={opacity:c?.4:void 0,transform:RY.ux.Translate.toString(l),transition:s};return(0,Z.BX)(et.hs,{alignItems:"center",radius:"sm",bg:"secondary",gap:6,ref:a,style:u,children:[(0,Z.tZ)(ee.hU,(0,_._)((0,f._)({size:"sm",priority:"quaternary"},r,o),{role:r.role,ref:d,children:(0,Z.tZ)(T3.Z,{size:20})})),(0,Z.tZ)(ei.xv.B4,{paddingTop:4,paddingBottom:4,children:t}),(0,Z.tZ)(ee.hU,{size:"sm",priority:"quaternary",onClick:()=>n?n(i):null,children:(0,Z.tZ)(K.Z,{size:20})})]})},RJ=e=>{let{children:t}=e,i={sideEffects:(0,RO.Ai)({styles:{active:{opacity:"0.4"}}})};return(0,Z.tZ)(RO.y9,{dropAnimation:i,children:t})},RV=e=>{var t;let{title:i,options:n,selectedItems:r,labelKey:o="name",onChange:a,emptyMessage:l,renderMenu:s}=e,[d,c]=(0,A.eJ)(null),u=(0,A.Ye)(()=>null==n?void 0:n.find(e=>e.id===(null==d?void 0:d.id)),[d,n]),p=e=>{a([...null!=r?r:[],e])},h=e=>{var t;a(null!==(t=null==r?void 0:r.filter(t=>t.id!==e))&&void 0!==t?t:[])},m=(0,RO.Dy)((0,RO.VT)(RO.we,{activationConstraint:{delay:100,tolerance:10}}),(0,RO.VT)(RO.Lg,{coordinateGetter:RU.is}));return(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(ei.xv.B4,{weight:"medium",color:"secondary",children:i}),n?(0,Z.BX)(et.gq,{wrap:"wrap",gap:8,children:[(0,Z.BX)(RO.LB,{sensors:m,collisionDetection:RO.pE,onDragEnd:e=>{let{active:t,over:i}=e;if(!r){a([t]);return}if(i&&t.id!==i.id){let e=null==r?void 0:r.findIndex(e=>e.id===t.id),n=null==r?void 0:r.findIndex(e=>e.id===i.id);a((0,RU.Rp)(r,e,n))}c(null)},onDragStart:e=>{let{active:t}=e;c(t)},onDragCancel:()=>{c(null)},children:[(0,Z.tZ)(RU.Fo,{items:null!==(t=null==r?void 0:r.map(e=>e.id))&&void 0!==t?t:[],strategy:RU.U2,children:null==r?void 0:r.map(e=>(0,Z.tZ)(Rj,(0,_._)((0,f._)({label:e[o]},e),{onRemove:h}),e.id))}),(0,Z.tZ)(RJ,{children:u?(0,Z.tZ)(Rj,(0,f._)({label:u[o]},u)):null})]}),s?s(p):(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(ee.hU,{disabled:n&&0===n.length,size:"sm",children:(0,Z.tZ)(ta.Z,{size:20})}),children:(0,Z.tZ)(et.tu,{maxHeight:360,children:null==n?void 0:n.map(e=>(0,Z.tZ)(tC.sN,{disabled:!!(null==r?void 0:r.find(t=>t.id===e.id)),onClick:()=>p(e),children:e[o]}))})}),l&&n&&0===n.length&&(0,Z.BX)(et.gq,{padding:16,gap:16,className:RH.emptyMessage,children:[(0,Z.tZ)(eN.Z,{})," ",l]})]}):(0,Z.tZ)(et.gq,{justifyContent:"center",children:(0,Z.tZ)(iI.$j,{})})]})},Rq=e=>{let{label:t,postTags:i,sections:n,value:r,onChange:o}=e,a=nN()(i,"id"),l=nN()(n,"id"),s=nT()(r.map(e=>{var t,i,n,r;let o="section"===e.type?e.sectionId:e.tagId;return null===o?null:(0,_._)((0,f._)({},e),{label:null!==(r=null===(t="section"===e.type?l[null!==(i=e.sectionId)&&void 0!==i?i:"undefined"]:a[null!==(n=e.tagId)&&void 0!==n?n:"undefined"])||void 0===t?void 0:t.name)&&void 0!==r?r:"Unknown",id:o})})),d=null;return i&&n&&(d=[...i.map(e=>({type:"tag",tagId:e.id,sectionId:null,label:e.name,id:e.id})),...n.map(e=>({type:"section",tagId:null,sectionId:e.id,label:e.name,id:e.id}))]),(0,Z.tZ)(RV,{title:t,options:d,labelKey:"label",selectedItems:s,emptyMessage:(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(ei.xv.B4,{color:"error",weight:"semibold",children:"Add tags or sections to publish changes"}),(0,Z.tZ)(ei.xv.B4,{color:"error",children:"Add tags or sections to your posts or choose a different post layout"})]}),onChange:e=>{e&&o(e)}})};var RW=i(32339),RG=i(56649),RK=i(64567),RQ=i(71693),R$=i(3246);let R0={grid:(0,Z.tZ)(x0.Z,{size:16}),list:(0,Z.tZ)(RK.Z,{size:16}),feature:(0,Z.tZ)(RQ.Z,{size:16}),subscribe:(0,Z.tZ)(uh.Z,{size:16})},R1=e=>{let{pub:t,onAddBlock:i}=e,{iString:n}=(0,Q.M1)(),r=Re({pub:t});return(0,Z.tZ)(et.tu,{children:(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(ee.zx,{leading:(0,Z.tZ)(ta.Z,{size:16}),priority:"secondary-outline",children:n("Add block")}),children:Object.values(r).map(e=>{var t;let n=null!==(t=R0[e.id])&&void 0!==t?t:(0,Z.tZ)(R$.Z,{size:16});return(0,Z.tZ)(tC.sN,{onClick:()=>{i({layoutID:e.id})},children:(0,Z.BX)(et.gq,{alignItems:"start",gap:12,children:[(0,Z.tZ)("div",{style:{paddingTop:2},children:n}),(0,Z.BX)("div",{children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",children:e.label}),(0,Z.tZ)(ei.xv.B4,{children:e.description})]})]})})})})})},R2=e=>{var t,i,n,r;let{contentBlock:o,onUpdateBlock:a}=e,{iString:l}=(0,Q.M1)(),{pub:s}=(0,DE.ZT)();if(!(0,oo.HD)({pub:s}))return null;let d=[{value:"special-feature",label:l("Special feature, five posts with three underneath")},{value:"large-on-left",label:l("Five posts with large post on left")},{value:"large-in-middle",label:l("Five posts with large post in middle")},{value:"large-on-right",label:l("Five posts with large post on right")}];return(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(iT.m,{label:l("Variant"),options:d,value:null!==(n=null===(t=o.attrs.feature)||void 0===t?void 0:t.variant)&&void 0!==n?n:"special-feature",onChange:e=>{a({id:o.id,updates:{attrs:(0,_._)((0,f._)({},o.attrs),{feature:(0,_._)((0,f._)({},o.attrs.feature),{variant:e})})}})}}),(0,Z.tZ)(ij.n,{label:l("Title override"),value:null!==(r=null===(i=o.attrs.feature)||void 0===i?void 0:i.title)&&void 0!==r?r:"",onChange:e=>{var t,i,n;a({id:o.id,updates:{attrs:(0,_._)((0,f._)({},o.attrs),{feature:(0,_._)((0,f._)({},o.attrs.feature),{variant:null!==(n=null===(i=o.attrs)||void 0===i?void 0:null===(t=i.feature)||void 0===t?void 0:t.variant)&&void 0!==n?n:"special-feature",title:e})})}})}})]})};var R4=i(6630);let R3=e=>{let{items:t,onChange:i,onRemove:n}=e,r=(0,RO.Dy)((0,RO.VT)(RO.we,{activationConstraint:{distance:5}}));return 0===t.length?null:(0,Z.tZ)(RO.LB,{sensors:r,collisionDetection:RO.pE,onDragEnd:e=>{let{active:n,over:r}=e;if(n.id!==r.id){let e=t.findIndex(e=>e.value===n.id),o=t.findIndex(e=>e.value===r.id);i((0,RU.Rp)(t,e,o))}},children:(0,Z.tZ)(RU.Fo,{items:t.map(e=>(0,_._)((0,f._)({},e),{id:e.value})),strategy:RU.U2,children:(0,Z.tZ)(et.gq,{gap:8,position:"relative",wrap:"wrap",children:t.map(e=>(0,Z.tZ)(R8,{item:e,onRemove:n},e.value))})})})},R8=e=>{let{item:t,onRemove:i}=e,{attributes:n,isDragging:r,listeners:o,setNodeRef:a,transform:l,transition:s}=(0,RU.nB)({id:t.value}),d={transform:RY.ux.Translate.toString(l),transition:s,zIndex:+!!r,cursor:r?"grabbing":"grab"};return(0,Z.BX)(et.gq,(0,_._)((0,f._)({},n,o),{role:n.role,ref:a,alignItems:"center",bg:"secondary",gap:4,justifyContent:"space-between",padding:4,radius:"sm",style:d,children:[(0,Z.BX)(et.gq,{gap:4,alignItems:"center",children:[(0,Z.tZ)(et.gq,{alignItems:"center",color:"secondary",children:(0,Z.tZ)(T3.Z,{size:16})}),(0,Z.tZ)(ei.xv.B4,{children:t.label})]}),i&&(0,Z.tZ)(ee.hU,{size:"sm",priority:"tertiary",onClick:()=>{i(t.value)},children:(0,Z.tZ)(K.Z,{size:16})})]}))},R6=e=>{let{contentWhenChecked:t,label:i,value:n,onChange:r}=e;return(0,Z.BX)(et.tu,{border:"detail",paddingX:16,paddingY:12,radius:"sm",children:[(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",children:[(0,Z.tZ)(ei.xv.B4,{weight:"semibold",children:i}),(0,Z.tZ)(i2.ZP,{checked:n,size:"sm",onChange:r})]}),t&&(0,Z.tZ)(ik.H,{expanded:n,children:(0,Z.tZ)(et.tu,{paddingTop:8,children:t})})]})};var R5=i(62841);let R9=e=>{let{errors:t,hasHomepageLinks:i,left:n,right:r,onChange:o}=e,{iString:a}=(0,Q.M1)();return(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(R7,{errors:null==t?void 0:t.primary_sidebar_modules,hasHomepageLinks:i,label:a("Right column"),selected:r,otherSelected:n,onChange:e=>{o({left:n.filter(t=>!e.includes(t)),right:e})}}),(0,Z.tZ)(R7,{errors:null==t?void 0:t.secondary_sidebar_modules,hasHomepageLinks:i,label:a("Left column"),selected:n,otherSelected:r,onChange:e=>{o({left:e,right:r.filter(t=>!e.includes(t))})}})]})},R7=e=>{let{errors:t,hasHomepageLinks:i,label:n,selected:r,otherSelected:o,onChange:a}=e,[l,s]=(0,A.eJ)(r.length>0),[d,c]=(0,A.eJ)(null);return(0,A.d4)(()=>{!l&&r.length&&(c(r),a([])),l&&d&&(a(d),c(null))},[l,a,d,r]),(0,Z.tZ)(i1.g,{errors:t,children:(0,Z.tZ)(R6,{contentWhenChecked:(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(R3,{items:Ft(r),onChange:e=>{a(e.map(e=>e.value))},onRemove:e=>{a(r.filter(t=>t!==e))}}),(0,Z.tZ)(Fe,{alreadySelected:[...r,...o],hasHomepageLinks:i,onAddModule:e=>{a([...r,e])}})]}),label:n,value:l,onChange:s})})},Fe=e=>{let{alreadySelected:t,hasHomepageLinks:i,onAddModule:n}=e,{iString:r}=(0,Q.M1)();return(0,Z.tZ)(tC.v2,{trigger:(0,Z.tZ)(et.gq,{children:(0,Z.tZ)(ee.zx,{leading:(0,Z.tZ)(ta.Z,{size:16}),priority:"secondary",size:"sm",children:r("Add module")})}),children:Object.values(R5.Qj).map(e=>{let o=null;return t.includes(e.id)?o=r("Already selected"):i||"links"!==e.id||(o=r("There are no homepage links set. You can set these in the main settings page")),(0,Z.tZ)(tC.sN,{disabled:!!o,onClick:()=>{n(e.id)},children:o?(0,Z.tZ)(tW.u,{text:o,children:e.label}):e.label},e.id)})})},Ft=e=>e.map(e=>({label:R5.Qj[e].label,value:e})),Fi=e=>{var t;let{contentBlock:i,errors:n,hasHomepageLinks:r,onUpdateBlock:o}=e,{iString:a}=(0,Q.M1)(),l=Fn(i);return(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(i1.g,{label:a("Number of rows"),errors:null==n?void 0:n.num_rows,children:(0,Z.tZ)(R4.o,{value:null!==(t=i.num_rows)&&void 0!==t?t:R5.di.rows.default,min:R5.di.rows.min,max:l,onChange:e=>{o({id:i.id,updates:{num_rows:e}})}})}),(0,Z.tZ)(R9,{errors:n,hasHomepageLinks:r,left:i.secondary_sidebar_modules,right:i.primary_sidebar_modules,onChange:e=>{let t={secondary_sidebar_modules:e.left,primary_sidebar_modules:e.right},n=Fn(t);i.num_rows&&i.num_rows>n&&(t.num_rows=n),o({id:i.id,updates:t})}})]})},Fn=e=>{let{primary_sidebar_modules:t,secondary_sidebar_modules:i}=e;return 0!==t.length||0!==i.length?R5.di.rows.max:R5.di.rows.max-1},Fr=e=>{var t;let{contentBlock:i,errors:n,hasHomepageLinks:r,onUpdateBlock:o}=e,{iString:a}=(0,Q.M1)();return(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(i1.g,{label:a("Number of posts"),children:(0,Z.tZ)(R4.o,{max:R5.di.posts.max,min:R5.di.posts.min,value:null!==(t=i.num_posts)&&void 0!==t?t:R5.di.posts.default,onChange:e=>{o({id:i.id,updates:{num_posts:e}})}})}),(0,Z.tZ)(R9,{errors:n,hasHomepageLinks:r,left:i.secondary_sidebar_modules,right:i.primary_sidebar_modules,onChange:e=>{o({id:i.id,updates:{secondary_sidebar_modules:e.left,primary_sidebar_modules:e.right}})}})]})},Fo=e=>{var t,i;let{contentBlock:n,onUpdateBlock:r}=e,{iString:o}=(0,Q.M1)(),{pub:a}=(0,DE.ZT)();return(0,oo.HD)({pub:a})?(0,Z.tZ)(et.tu,{gap:16,children:(0,Z.tZ)(iT.m,{label:o("Variant"),options:[{value:"podcasts",label:"Podcasts"},{value:"videos",label:"Videos"}],value:null!==(i=null===(t=n.attrs.media_carousel)||void 0===t?void 0:t.variant)&&void 0!==i?i:"podcasts",onChange:e=>{r({id:n.id,updates:{attrs:(0,_._)((0,f._)({},n.attrs),{media_carousel:(0,_._)((0,f._)({},n.attrs.media_carousel),{variant:e})})}})}})}):null},Fa=e=>{var t,i,n,r,o,a,l,s;let{contentBlock:d,pub:c,onUpdateBlock:u,onUpdateUserRoleForPreview:p}=e,{iString:h}=(0,Q.M1)(),m="enabled"===c.payments_state,g=(0,nC.SY)(c);return(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(ij.n,{label:h("Message for non-subscribers"),value:null!==(o=null===(t=d.attrs)||void 0===t?void 0:t.non_subscriber_message)&&void 0!==o?o:"",onChange:e=>{u({id:d.id,updates:{attrs:(0,_._)((0,f._)({},d.attrs),{non_subscriber_message:e})}})},onFocus:()=>{p({role:"unsubscribed"})}}),(0,Z.tZ)(ij.n,{label:h("Message for free subscribers"),value:null!==(a=null===(i=d.attrs)||void 0===i?void 0:i.free_subscriber_message)&&void 0!==a?a:"",onChange:e=>{u({id:d.id,updates:{attrs:(0,_._)((0,f._)({},d.attrs),{free_subscriber_message:e})}})},onFocus:()=>{p({role:"free"})}}),m&&(0,Z.tZ)(ij.n,{label:h("Message for paid subscribers"),value:null!==(l=null===(n=d.attrs)||void 0===n?void 0:n.paid_subscriber_message)&&void 0!==l?l:"",onChange:e=>{u({id:d.id,updates:{attrs:(0,_._)((0,f._)({},d.attrs),{paid_subscriber_message:e})}})},onFocus:()=>{p({role:"paid"})}}),m&&g&&(0,Z.tZ)(ij.n,{label:h("Message for founding members"),value:null!==(s=null===(r=d.attrs)||void 0===r?void 0:r.founding_member_message)&&void 0!==s?s:"",onChange:e=>{u({id:d.id,updates:{attrs:(0,_._)((0,f._)({},d.attrs),{founding_member_message:e})}})},onFocus:()=>{p({role:"founding"})}})]})},Fl=(0,to.forwardRef)((e,t)=>{var{label:i}=e,n=(0,ef._)(e,["label"]);return(0,Z.BX)(et.gq,(0,_._)((0,f._)({},n),{className:"container-RdEANY",ref:t,alignItems:"center",border:"detail",bg:"primary",justifyContent:"space-between",paddingX:16,paddingY:12,radius:"sm",children:[(0,Z.tZ)(ei.xv.B4,{ellipsis:!0,children:i}),(0,Z.tZ)(et.gq,{color:"secondary",alignItems:"center",children:(0,Z.tZ)(o7,{fill:"currentColor",stroke:"currentColor",height:4})})]}))});function Fs(){let e=(0,G._)(["Tag: ",""]);return Fs=function(){return e},e}function Fd(){let e=(0,G._)(["Tag: Unknown"]);return Fd=function(){return e},e}function Fc(){let e=(0,G._)(["Section: ",""]);return Fc=function(){return e},e}function Fu(){let e=(0,G._)(["Section: Unknown"]);return Fu=function(){return e},e}let Fp=e=>{let{value:t,postTags:i,sections:n,onChange:r}=e,{iString:o,iTemplate:a}=(0,Q.M1)(),[l,s]=(0,A.eJ)(null),d="";if("tag"===t.post_source){let e=i.find(e=>e.id===t.post_tag_id);d=(null==e?void 0:e.name)?a(Fs(),null==e?void 0:e.name):a(Fd())}else if("section"===t.post_source){let e=n.find(e=>e.id===t.section_id);d=(null==e?void 0:e.name)?a(Fc(),null==e?void 0:e.name):a(Fu())}else d="latest"===t.post_source?o("Recent posts"):o("Unknown");return(0,Z.tZ)(hp.J,{content:e=>{let{closePopover:t}=e;return(0,Z.BX)(et.tu,{alignItems:"stretch",className:"dropdownContainer-quv1Pv",children:[!l&&(0,Z.tZ)(tC.sN,{onClick:()=>{r({post_source:"latest",section_id:null,post_tag_id:null}),t()},children:o("Recent posts")}),!l&&(0,Z.tZ)(tC.sN,{onClick:()=>{s("tags")},children:(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",children:[o("Tags"),(0,Z.tZ)(ez.Z,{size:16})]})}),!l&&(0,Z.tZ)(tC.sN,{onClick:()=>{s("sections")},children:(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",children:[o("Sections"),(0,Z.tZ)(ez.Z,{size:16})]})}),"tags"===l&&(0,Z.tZ)(tC.sN,{onClick:()=>{s(null)},children:(0,Z.BX)(et.gq,{alignItems:"center",gap:4,children:[(0,Z.tZ)(uV.Z,{size:16}),o("Tags")]})}),"tags"===l&&0===i.length&&(0,Z.tZ)(tC.sN,{disabled:!0,children:o("Your publication has no tags")}),"tags"===l&&i.length>0&&sL()(i,[e=>e.name.toLowerCase()]).map(e=>(0,Z.tZ)(tC.sN,{onClick:()=>{r({post_source:"tag",post_tag_id:e.id,section_id:null}),t(),s(null)},children:e.name},e.id)),"sections"===l&&(0,Z.tZ)(tC.sN,{onClick:()=>{s(null)},children:(0,Z.BX)(et.gq,{alignItems:"center",gap:4,children:[(0,Z.tZ)(uV.Z,{size:16}),o("Sections")]})}),"sections"===l&&0===n.length&&(0,Z.tZ)(tC.sN,{disabled:!0,children:o("Your publication has no sections")}),"sections"===l&&sL()(n,[e=>e.name.toLowerCase()]).map(e=>(0,Z.tZ)(tC.sN,{onClick:()=>{r({post_source:"section",section_id:e.id,post_tag_id:null}),t(),s(null)},children:e.name},e.id))]})},preferPlacement:"bottom-center",possiblePlacements:["bottom-center","top-center"],children:(0,Z.tZ)(Fl,{label:d})})},Fh=["subscribe","subscribe_plus_five","media_carousel"],Fm=e=>{let{contentBlock:t,errors:i,hasHomepageLinks:n,postTags:r,pub:o,sections:a,onUpdateBlock:l,onUpdateUserRoleForPreview:s}=e,{iString:d}=(0,Q.M1)();return(0,Z.BX)(et.tu,{gap:16,children:[!Fh.includes(t.block_type)&&(0,Z.tZ)(i1.g,{label:d("Posts"),errors:null==i?void 0:i.post_source,children:(0,Z.tZ)(Fp,{postTags:r,sections:a,value:{post_source:t.post_source,post_tag_id:t.post_tag_id,section_id:t.section_id},onChange:e=>{l({id:t.id,updates:e})}})}),"list"===t.block_type&&(0,Z.tZ)(Fr,{contentBlock:t,errors:i,hasHomepageLinks:n,onUpdateBlock:l}),"feature"===t.block_type&&(0,Z.tZ)(R2,{contentBlock:t,onUpdateBlock:l}),"media_carousel"===t.block_type&&(0,Z.tZ)(Fo,{contentBlock:t,onUpdateBlock:l}),"grid"===t.block_type&&(0,Z.tZ)(Fi,{contentBlock:t,errors:i,hasHomepageLinks:n,onUpdateBlock:l}),"subscribe"===t.block_type&&(0,Z.tZ)(Fa,{contentBlock:t,errors:i,pub:o,onUpdateBlock:l,onUpdateUserRoleForPreview:s})]})},Fg=e=>{let{contentBlock:t,hasHomepageLinks:i,errors:n,postTags:r,pub:o,sections:a,onClick:l,onDeleteBlock:s,onUpdateBlock:d,onUpdateUserRoleForPreview:c}=e,{iString:u}=(0,Q.M1)(),p=Re({pub:o})[t.block_type],{attributes:h,isDragging:m,listeners:g,setActivatorNodeRef:v,setNodeRef:b,transform:y,transition:w}=(0,RU.nB)({id:t.id}),C={transform:RY.ux.Translate.toString(y),transition:w,zIndex:+!!m};return p?(0,Z.tZ)("div",(0,_._)((0,f._)({ref:b,style:C},h),{onClick:l,children:(0,Z.BX)(et.tu,{bg:"white",radius:"sm",shadow:"md",children:[(0,Z.BX)(et.gq,(0,_._)((0,f._)({ref:v},g),{alignItems:"center",justifyContent:"space-between",paddingY:8,paddingRight:8,paddingLeft:12,borderBottom:"detail",cursor:m?"grabbing":"grab",children:[(0,Z.BX)(et.gq,{gap:8,alignItems:"center",children:[(0,Z.tZ)(T3.Z,{size:16}),(0,Z.tZ)(ei.xv.B3,{weight:"semibold",children:p.label})]}),(0,Z.tZ)(tC.v2,{layerClassName:"menu-xkw679",trigger:(0,Z.tZ)(ee.hU,{size:"sm",priority:"secondary",children:(0,Z.tZ)(pu.Z,{size:16})}),children:(0,Z.tZ)(tC.sN,{priority:"destructive",onClick:()=>{s(t.id)},children:u("Remove")})})]})),(0,Z.tZ)(et.tu,{padding:16,children:(0,Z.tZ)(Fm,{contentBlock:t,errors:n,hasHomepageLinks:i,postTags:r,sections:a,pub:o,onUpdateBlock:d,onUpdateUserRoleForPreview:c})})]})})):null},Fv=e=>{let{contentBlocks:t,contentBlockErrors:i,hasHomepageLinks:n,postTags:r,pub:o,sections:a,onAddBlock:l,onChangeContentBlocks:s,onDeleteBlock:d,onScrollToSection:c,onUpdateBlock:u,onUpdateUserRoleForPreview:p}=e,h=(0,RO.Dy)((0,RO.VT)(RO.we,{activationConstraint:{distance:5}}));return(0,Z.tZ)(RO.LB,{collisionDetection:RO.pE,modifiers:[RW.DL],sensors:h,onDragEnd:e=>{let{active:t,over:i}=e;t.id!==i.id&&(s(e=>{let n=e.findIndex(e=>e.id===t.id),r=e.findIndex(e=>e.id===i.id);return(0,RU.Rp)(e,n,r)}),c("block-".concat(t.id)))},children:(0,Z.BX)(et.tu,{gap:16,children:[(0,Z.tZ)(RU.Fo,{items:t,strategy:RU.qw,children:(0,Z.tZ)(et.tu,{gap:24,style:{position:"relative"},children:t.length>0?t.map(e=>(0,Z.tZ)(Fg,{contentBlock:e,errors:i.contentBlocks[e.id],hasHomepageLinks:n,postTags:r,pub:o,sections:a,onClick:()=>{c("block-".concat(e.id))},onDeleteBlock:d,onUpdateBlock:u,onUpdateUserRoleForPreview:p},e.id)):(0,Z.tZ)(ei.xv.B4,{color:"secondary",align:"center",paddingY:8,translated:!0,children:"Get started by adding a content block"})})}),(0,Z.BX)(et.tu,{gap:8,children:[(0,Z.tZ)(R1,{pub:o,onAddBlock:l}),(0,Z.tZ)(RG.D,{errors:i.global})]})]})})},Fb=e=>{var t;let{contentBlocks:i,contentBlockErrors:n,hasHomepageLinks:r,postTags:o,pub:a,theme:l,onAddBlock:s,onChangeContentBlocks:d,onDeleteBlock:c,onScrollToSection:u,onUpdateTheme:p,onUpdateBlock:h,onUpdateUserRoleForPreview:m}=e;return(0,Z.BX)(et.tu,{bg:"secondary",radius:"xs",children:[(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",padding:12,children:[(0,Z.tZ)(ei.xv.B3,{translated:!0,weight:"semibold",children:"Advanced layouts"}),(0,Z.tZ)(i2.ZP,{checked:"custom"===l.body,size:"sm",onChange:e=>{p({body:e?"custom":"list"})}})]}),(0,Z.tZ)(ik.H,{expanded:!!("custom"===l.body&&o),children:(0,Z.tZ)(et.tu,{paddingTop:12,paddingX:12,paddingBottom:16,children:(0,Z.tZ)(Fv,{contentBlocks:i,contentBlockErrors:n,hasHomepageLinks:r,postTags:null!=o?o:[],pub:a,sections:null!==(t=a.sections)&&void 0!==t?t:[],onAddBlock:s,onChangeContentBlocks:d,onDeleteBlock:c,onScrollToSection:u,onUpdateBlock:h,onUpdateUserRoleForPreview:m})})})]})},Fy=e=>{let{contentBlocks:t,contentBlockErrors:i,feedOfPostsSelected:n,hasChanges:r,hasHomepageLinks:o,isSaving:a,postTags:l,pub:s,showFeedOfPosts:d,theme:c,onAddBlock:u,onBack:p,onCancel:h,onChangeContentBlocks:m,onDeleteBlock:g,onSave:v,onScrollToSection:b,onUpdateBlock:y,onUpdateTheme:f,onUpdateUserRoleForPreview:_}=e,{iString:w}=(0,Q.M1)(),[C,x]=(0,A.eJ)(!0),[S,k]=(0,A.eJ)(!0),B=(0,R5.IW)(),T=(0,R5.jU)(),I=(0,nC.A$)(s),N=(0,oo.HD)({pub:s}),P=Object.keys(B).filter(e=>"podcast"!==e||I||"podcast"===c.hero).map(e=>({label:B[e].label,value:e}));d&&P.push({label:w("Feed of posts"),value:"classic_post_list"});let E=Object.keys(T).filter(e=>"custom"!==e).map(e=>({label:T[e].label,description:T[e].description,value:e}));return(0,Z.BX)(Rl,{actionProps:{hasChanges:r,isSaving:a,onCancel:h,onSave:v},title:w("Homepage"),onBack:p,children:[(0,Z.tZ)(et.tu,{paddingX:16,paddingTop:16*!N,children:(0,Z.BX)(RF,{isExpanded:C,isHidden:N,title:w("Intro"),onToggle:()=>{x(!C)},children:[!N&&(0,Z.tZ)(iT.m,{label:w("Header style"),options:P,value:n?"classic_post_list":c.hero,onChange:e=>{f({hero:e})}}),(0,Z.tZ)(ik.H,{expanded:"podcast"===c.hero,children:(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",paddingTop:16,children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",children:"Alignment"}),(0,Z.tZ)(tx.Z,{tabs:[{value:"left",label:(0,Z.tZ)(et.gq,{alignItems:"center",children:(0,Z.tZ)(pF.Z,{size:16})})},{value:"center",label:(0,Z.tZ)(et.gq,{alignItems:"center",children:(0,Z.tZ)(Rz.Z,{size:16})})}],value:c.homeHeroAlignment,onChange:e=>{f({homeHeroAlignment:e})}})]})}),(0,Z.tZ)(ik.H,{expanded:"podcast"===c.hero,children:(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",paddingTop:16,children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",children:"Show podcast players"}),(0,Z.tZ)(i2.ZP,{checked:c.homeHeroShowPodcastLinks,size:"sm",onChange:e=>{f({homeHeroShowPodcastLinks:e})}})]})}),(0,Z.tZ)(ik.H,{expanded:"magaziney"!==c.hero&&!n,children:(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",paddingTop:16,children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",children:"Show top posts"}),(0,Z.tZ)(i2.ZP,{checked:c.showTopPosts,size:"sm",onChange:e=>{f({showTopPosts:e})}})]})})]})}),(0,Z.tZ)(et.tu,{padding:16,children:!n&&(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(ik.H,{expanded:"custom"!==c.body,children:(0,Z.tZ)(et.tu,{paddingBottom:24,children:(0,Z.tZ)(RF,{isExpanded:S,title:w("Body"),onToggle:()=>{k(!S)},children:(0,Z.tZ)(et.tu,{gap:16,children:(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(iT.m,{label:w("Post layout"),options:E,value:"custom"===c.body?"list":c.body,onChange:e=>{f({body:e}),b("body")}}),(0,Z.tZ)(ik.H,{expanded:"grid-groups"===c.body,children:(0,Z.tZ)(ts.xu,{paddingTop:12,children:(0,Z.tZ)(Rq,{label:w("Posts"),postTags:l,sections:s.sections,value:c.bodyGroups,onChange:e=>{f({bodyGroups:e})}})})}),(0,Z.tZ)(ik.H,{expanded:"list"===c.body,children:(0,Z.tZ)(ts.xu,{paddingTop:12,children:(0,Z.tZ)(iw.j,{label:w("Hide images"),value:c.hideImagesFromList,onChange:e=>{f({hideImagesFromList:e})}})})})]})})})})}),(0,Z.tZ)(Fb,{theme:c,contentBlocks:t,contentBlockErrors:i,hasHomepageLinks:o,postTags:l,pub:s,onAddBlock:u,onChangeContentBlocks:m,onDeleteBlock:g,onScrollToSection:b,onUpdateTheme:f,onUpdateBlock:y,onUpdateUserRoleForPreview:_})]})})]})},Ff=e=>{var t;let{hasChanges:i,isSaving:n,page:r,pageTheme:o,section:a,onBack:l,onCancel:s,onChangePageTheme:d,onSave:c}=e,{iString:u}=(0,Q.M1)(),[p,h]=(0,A.eJ)(!0),[m,g]=(0,A.eJ)(!0);if(!r&&!a)return null;let v="podcast"===r?u("Podcast"):null!==(t=null==a?void 0:a.name)&&void 0!==t?t:"",b="podcast"===r||!!(null==a?void 0:a.is_podcast);return(0,Z.tZ)(Rl,{actionProps:{hasChanges:i,isSaving:n,onCancel:s,onSave:c},title:v,onBack:l,children:(0,Z.BX)(et.tu,{padding:16,paddingTop:16,gap:16,children:[(0,Z.tZ)(RF,{isExpanded:p,title:u("Intro"),onToggle:()=>{h(!p)},children:(0,Z.BX)(et.tu,{children:[(0,Z.tZ)(iT.m,{label:u("Header style"),options:nT()([{label:"Default",value:"default"},b&&{label:"Podcast",value:"podcast"},{label:"Feature Media",value:"feature-media"}]),value:o.page_hero,onChange:e=>{var t;d({pageTheme:(0,_._)((0,f._)({},o),{page_hero:e}),sectionId:null!==(t=null==a?void 0:a.id)&&void 0!==t?t:null,page:r})}}),(0,Z.tZ)(ik.H,{expanded:"podcast"===o.page_hero||"default"===o.page_hero,children:(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",paddingTop:16,children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",children:"Alignment"}),(0,Z.tZ)(tx.Z,{tabs:[{value:"left",label:(0,Z.tZ)(et.gq,{alignItems:"center",children:(0,Z.tZ)(pF.Z,{size:16})})},{value:"center",label:(0,Z.tZ)(et.gq,{alignItems:"center",children:(0,Z.tZ)(Rz.Z,{size:16})})}],value:o.hero_alignment,onChange:e=>{var t;d({pageTheme:(0,_._)((0,f._)({},o),{hero_alignment:e}),sectionId:null!==(t=null==a?void 0:a.id)&&void 0!==t?t:null,page:r})}})]})}),(0,Z.tZ)(ik.H,{expanded:b&&("podcast"===o.page_hero||"feature-media"===o.page_hero),children:(0,Z.BX)(et.gq,{alignItems:"center",justifyContent:"space-between",paddingTop:16,children:[(0,Z.tZ)(ei.xv.B4,{translated:!0,weight:"semibold",children:"Show podcast players"}),(0,Z.tZ)(i2.ZP,{checked:o.show_podcast_links,size:"sm",onChange:e=>{var t;d({pageTheme:(0,_._)((0,f._)({},o),{show_podcast_links:e}),sectionId:null!==(t=null==a?void 0:a.id)&&void 0!==t?t:null,page:r})}})]})})]})}),(0,Z.tZ)(RF,{isExpanded:m,title:u("Body"),onToggle:()=>{g(!m)},children:(0,Z.tZ)(iT.m,{options:[{label:"List",value:"list"},{label:"Grid",value:"grid"}],value:o.page_posts,onChange:e=>{var t;d({pageTheme:(0,_._)((0,f._)({},o),{page_posts:e}),sectionId:null!==(t=null==a?void 0:a.id)&&void 0!==t?t:null,page:r})}})})]})})},F_=eb(e=>{var t;let{pub:i,themeVariables:n}=e,{iString:r}=(0,Q.M1)(),o=(0,A.sO)(null);if((0,A.d4)(()=>{"profile"===i.homepage_type&&(0,Y.uX)("/publish/home",{local_navigation:!0})},[i.homepage_type]),"profile"===i.homepage_type)return null;let[a,l]=(0,A.eJ)(i),s=(0,to.useMemo)(()=>DL((0,f._)({},n,i.theme)),[i.theme,n]),[d,c]=(0,A.eJ)("settings-home"),[u,p]=(0,A.eJ)("homepage"),[h,m]=DQ({iFrameRef:o}),[g,v]=(0,A.eJ)("unsubscribed"),[b,y]=(0,A.eJ)("classic_post_list"===i.homepage_type),{hasChanges:w,resetTheme:C,saveTheme:x,theme:S,updateTheme:k}=Dj({initialPubTheme:s,feedOfPostsSelected:b}),{reset:B,save:T,saving:I,hasChanges:P,pageTheme:E,setPageTheme:X}=Dq({page:"podcast"===d?"podcast":null,pub:i,sectionId:"number"==typeof d?d:null}),[M,D]=(0,A.eJ)(!1),[R,F]=(0,A.eJ)(null),{postTags:L}=DW({shouldFetch:["custom","grid-groups"].includes(S.body)}),z=nN()(i.sections,"id"),{contentBlocks:U,contentBlockErrors:H,hasChanges:J,saveContentBlocks:V,onAddBlock:q,onChangeBlocks:W,onChangeContentBlockErrors:G,onClearContentBlockErrors:K,onDeleteBlock:$,onUpdateBlock:ee}=DJ({postTags:L,pub:i,onAddBlockCallback:e=>{F("block-".concat(e))}}),ei=(0,Ny.qU)({isPreview:!0}),{colorErrors:en}=DG({theme:S}),er="classic_post_list"===i.homepage_type||new Date(i.created_at)<new Date("2022-08-23"),eo=DH(i),ea=w||J||b!==("classic_post_list"===i.homepage_type);(0,A.d4)(()=>{R&&F(null)},[R]);let el=e=>{e.hero&&("classic_post_list"===e.hero?y(!0):y(!1)),k(e),e.bodyFontPreset&&!e.headingFontPreset&&p("post"),e.welcomePageBackgroundColor&&!e.backgroundColor&&p("welcome")},es=async()=>{if(en){(0,O.ZP)(r("There are some errors with the selected colors."));return}D(!0);try{if("custom"===S.body){let{hasError:e,errorObject:t}=(0,R5.Kf)(U);if(G(t),e){D(!1);return}}else K();await x(),"custom"===S.body&&J&&await V(),D(!1),ec("settings-home"),(0,O.ZP)(r("Theme saved"))}catch(e){D(!1),alert((0,Y.zx)(e))}},ed=()=>{C(),ec("settings-home")},ec=e=>{"homepage"===e&&(p("homepage"),m("desktop")),"number"==typeof e&&p(e),"podcast"===e&&p("podcast"),("number"==typeof d||"podcast"===d)&&"number"!=typeof e&&"podcast"!==e&&p("homepage"),c(e)},eu=()=>{B(),ec("settings-home")},ep=async()=>{await T(),ec("settings-home"),(0,O.ZP)(r("Theme saved"))},eh=async(e,t)=>{try{await N().put("/api/v1/publication").send({[e]:t}),l(i=>(0,_._)((0,f._)({},i),{[e]:t})),e.startsWith("theme_var_")&&k((0,_._)((0,f._)({},S),{[e]:t}))}catch(e){console.error("Failed to update publication:",e),alert("Network error!")}},em=(0,to.useMemo)(()=>ei?(0,_._)((0,f._)({},ei),{contentBlocks:U}):null,[U,ei]);return(0,Z.BX)("div",{className:"container-dBMWJ2",children:[(0,Z.tZ)(DE.hV,{pub:i,children:(0,Z.tZ)(et.tu,{borderRight:"detail",color:"primary",children:(0,Z.BX)(tU.w,{children:["settings-home"===d&&(0,Z.tZ)(Rs,{hasAdvanced:eo,pub:i,onChangeSidebarNavState:ec,onClickDone:()=>{(0,Y.uX)((0,j.wI3)(i,{section:"core"}),{local_navigation:!1})}}),"branding"===d&&(0,Z.tZ)(RL,{colorErrors:en,hasChanges:ea,isSaving:M,pub:a,theme:S,onBack:ed,onCancel:ed,onChangeLogo:()=>{var e;(null===(e=o.current)||void 0===e?void 0:e.contentWindow)&&o.current.contentWindow.location.reload()},onSave:es,onUpdateTheme:el,onUpdatePub:eh}),"homepage"===d&&(0,Z.tZ)(Fy,{contentBlockErrors:H,contentBlocks:U,feedOfPostsSelected:b,hasChanges:ea,hasHomepageLinks:!!(null==ei?void 0:ei.homepageLinks.length),isSaving:M,postTags:L,pub:i,showFeedOfPosts:er,theme:S,onAddBlock:q,onBack:ed,onCancel:ed,onChangeContentBlocks:W,onDeleteBlock:$,onSave:es,onScrollToSection:F,onUpdateBlock:ee,onUpdateTheme:el,onUpdateUserRoleForPreview:e=>{let{role:t}=e;v(t)}}),eo&&"advanced"===d&&(0,Z.tZ)(Ru,{onBack:()=>{c("settings-home")},pub:i}),"number"==typeof d&&z[d]&&E&&(0,Z.tZ)(Ff,{hasChanges:P,isSaving:I,page:null,pageTheme:E,section:null!==(t=z[d])&&void 0!==t?t:null,onBack:eu,onCancel:eu,onChangePageTheme:X,onSave:ep}),"podcast"===d&&E&&(0,Z.tZ)(Ff,{hasChanges:P,isSaving:I,page:"podcast",pageTheme:E,section:null,onBack:eu,onCancel:eu,onChangePageTheme:X,onSave:ep})]})})}),(0,Z.tZ)(Rt,{activePreview:u,device:h,feedOfPostsSelected:b,homepageData:em,iFrameRef:o,pageTheme:E,postTags:L,scrollToSection:R,theme:S,userRoleForPreview:g,onChangeActivePreview:p,onChangeDevice:m})]})});var FZ=i(35047),Fw=i(79510),FC=i(27041),Fx=i(13893),FS=i(15612),Fk=i(38501);let FB={container:"container-BJ6r0M",menuContainer:"menuContainer-BUvIhb",containerPost:"containerPost-dy3lbQ",containerWelcome:"containerWelcome-ELpWpX"},FT=(0,to.forwardRef)((e,t)=>{var i;let{feedOfPostsSelected:n,homepageData:r,pageTheme:o,podcastPosts:a,postTags:l,pub:s,samplePost:d,sectionPosts:c,show:u,user:p}=e,h=(0,oo.HD)({pub:s});return(0,Z.BX)("div",{className:k()(FB.container,"use-theme-bg",{[FB.containerWelcome]:"welcome"===u,[FB.containerPost]:"post"===u,"the-free-press-theme":h}),ref:t,children:["welcome"!==u&&(0,Z.tZ)("div",{className:FB.menuContainer,children:h?(0,Z.tZ)(Fw.B,{activeLiveStream:null,freeSignup:!1,pub:s,showCustomerSupportModeModal:!1,user:null}):(0,Z.tZ)(E.v,{pub:s,user:null,isPostView:"post"===u,selectedSectionId:null})}),"homepage"===u&&!n&&(0,Z.tZ)(Fx.U,{blurbs:[],homepageData:r,hide_intro_popup:!0,postTags:l,pub:s,showEmptyStates:!0,user:p}),"homepage"===u&&n&&(0,Z.tZ)(FC.Z,{path:"/",user:p,pub:s,disableInteractive:!0,skipIntoPopupRender:!0}),"post"===u&&d&&(0,Z.tZ)("div",{className:k()("use-theme-bg",{container:!(["podcast","video"].includes(d.type)||h)}),children:["podcast","video"].includes(d.type)?(0,Z.tZ)(Fk.o,{user:p,post:d,pub:s,isServingFreePodcastUrl:!1,onChange:()=>void 0,showComments:!1,paywall:!1,recentEpisodes:null}):(0,Z.tZ)(w7.SO,{user:p,post:d,pub:s,noTitleLink:!0})}),"welcome"===u&&(0,Z.tZ)(FZ.Eh,{autoFocus:!1,pub:s}),"podcast"===u&&a&&(0,Z.tZ)(FS.t,{blurbs:[],hide_intro_popup:!0,newPostsForPubPodcast:a,pageTheme:o,pub:s,isPodcast:!0,user:p}),"number"==typeof u&&c&&(0,Z.tZ)(FS.t,{blurbs:[],hide_intro_popup:!0,newPostsForSections:{[u]:c},pageTheme:o,pub:s,slug:null===(i=s.sections.find(e=>e.id===u))||void 0===i?void 0:i.slug,user:p})]})}),FI=e=>{var t,i,n,r,o,a;let{pub:l,user:s}=e,[d,c]=(0,A.eJ)(null),[u,p]=(0,A.eJ)("homepage"),[h,m]=(0,A.eJ)(l.theme),[g,v]=(0,A.eJ)("unsubscribed"),[b,y]=(0,A.eJ)(null),[w,C]=(0,A.eJ)(null),[x,S]=(0,A.eJ)("classic_post_list"===l.homepage_type),[k,B]=(0,A.eJ)(null),[T,I]=(0,A.eJ)({}),[P,E]=(0,A.eJ)(null),X=(0,A.sO)(null),{postsBySectionId:M,postsByTagId:D}=(0,Ny.Qy)({contentBlocks:null!==(t=null==k?void 0:k.contentBlocks)&&void 0!==t?t:[]}),R=(0,A.Ye)(()=>k?(0,_._)((0,f._)({},k),{postsByTagId:D,postsBySectionId:M}):null,[k,M,D]);(0,A.d4)(()=>{window.parent.postMessage({type:D4},"*")},[]),(0,A.d4)(()=>{"number"!=typeof u||T[u]||(async()=>{try{let{body:e}=await N().get("/api/v1/archive").query({section_id:u,sort:"new",limit:13});I(t=>(0,_._)((0,f._)({},t),{[u]:e}))}catch(e){console.error(e)}})()},[T,u]),(0,A.d4)(()=>{"podcast"===u&&(async()=>{try{let{body:e}=await N().get("/api/v1/archive").query({type:"podcast",limit:13});E(e)}catch(e){(0,O.ZP)("Something went wrong fetching podcast posts"),console.error(e)}})()},[u]),(0,A.d4)(()=>{let e=e=>{e.data.type===D9&&e.data.value&&v(e.data.value),e.data.type===D5&&e.data.value&&m(e.data.value),e.data.type===D6&&e.data.value&&p(e.data.value),e.data.type===D8&&e.data.value&&C(e.data.value),e.data.type===D1&&S(!!e.data.value),e.data.type===D2&&e.data.value&&B(e.data.value),e.data.type===D3&&e.data.value&&y(e.data.value)};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[]),(0,A.d4)(()=>{(async e=>{try{let t=await N().post("/theme/compute_vars").send(e);for(let e of Object.keys(t.body))document.documentElement.style.setProperty("--".concat(e),t.body[e])}catch(e){console.error(e)}})(h)},[h]),(0,A.d4)(()=>{"post"!==u||d||(async()=>{try{let e=await N().get("/api/v1/posts/theme_sample");c(e.body)}catch(e){console.error(e)}})()},[d,u]);let F=(0,_._)((0,f._)({},l),{theme:h}),L=null;if(d){let e=(null==d?void 0:null===(i=d.postTheme)||void 0===i?void 0:i.header_variant)||(null===(n=l.theme)||void 0===n?void 0:n.default_post_header_variant)?(0,_._)((0,f._)({},null==d?void 0:d.postTheme),{post_id:null==d?void 0:d.id,header_variant:null!==(o=null==h?void 0:h.default_post_header_variant)&&void 0!==o?o:null==d?void 0:null===(r=d.postTheme)||void 0===r?void 0:r.header_variant}):void 0;L=(0,_._)((0,f._)({},d),{postTheme:e})}let z=(0,_._)((0,f._)({},s),{is_free_subscribed:["free","paid","founding"].includes(g),is_subscribed:["paid","founding"].includes(g),is_founding:"founding"===g});return R?(0,Z.tZ)(FT,{ref:X,feedOfPostsSelected:x,homepageData:R,pageTheme:b,podcastPosts:P,postTags:w,pub:F,samplePost:L,sectionPosts:"number"==typeof u&&null!==(a=T[u])&&void 0!==a?a:null,show:u,user:z}):null},FN=eb(e=>{let{pub:t,token:i}=e,{iString:n}=(0,Q.M1)(),r=(0,A.I4)(async(e,t)=>{await N().put("/api/v1/email/publication/unsubscribe").send({setting:e,value:t,token:i})},[i]),o=(0,A.I4)(()=>{},[]);return t?(0,Z.tZ)("div",{className:"one-click-unsubscribe",children:(0,Z.tZ)("div",{className:"page typography",id:"dashboard-page",children:(0,Z.BX)("div",{class:"container",children:[(0,Z.BX)(et.tu,{paddingTop:16,paddingBottom:32,children:[(0,Z.tZ)(ei.xv.H3,{paddingBottom:8,children:n("Unsubscribe successful")}),(0,Z.tZ)(ei.xv.B2,{translated:!0,children:"You have successfully been unsubscribed from those types of emails."})]}),(0,Z.tZ)(kK,{publication:t,token:i,onChange:r,onSuccess:o,oneClickMode:!0})]})})}):null});var FP=i(74312),FE=i(97344);let FX=(0,C.Z)(),FM=["/publish","/publish/home","/publish/subscribers","/publish/stats/traffic","/publish/settings"];class FA extends w.Component{componentDidMount(){this.state.embeddedPublications&&(0,Y.iO)("embeddedPostPublications"),this.state.justPublished&&(0,Y.iO)("justPublished"),this.checkStripeAccount()}checkStripeAccount(){this.state.loadingStripeAccount&&(0,ix.rd)("/api/v1/stripe/account").then(e=>{let{account:t}=e;(null==t?void 0:t.charges_enabled)===!1&&this.setState({stripePaymentsBlocked:!0})}).finally(()=>{this.setState({loadingStripeAccount:!1})})}setThemeBackground(){var e,t;let i=null===(t=this.state.pub)||void 0===t?void 0:null===(e=t.theme)||void 0===e?void 0:e.web_bg_color,n=document.documentElement;n&&i&&(n.style.background=i)}unsetThemeBackground(){let e=document.documentElement;e&&(e.style.background=null)}render(e,t){let{email:n,userId:r,initialData:o}=e,{user:a,pub:l,publication:s,seenWriterReferralExplainer:d,justPublished:c,embeddedPublications:u,scheduledFor:p,audience:h,siteConfigs:m={},publicationSettings:g,publicationUserSettings:v,isChatActive:b,isMeetingsActive:y,hasMeetingsBooked:w,showShare:C,showSubscriberReferralsSetupOptIn:S,showChatReaderParticipationBox:I,showGAMigrationModal:M,surveysOnboardingModalVariant:A,showLocalCurrencyModal:D,showPaywallUnlockReminderModal:R,language:F,themeVariables:L,showPledgeTurnOnPaidBox:z,estimatedArr:O,estimatedArrCurrency:H,isManagedPublication:J,shouldShowSurveyAnnouncement:q,overrideSurveyAnnouncementDismissKey:G,surveyId:K,loadingStripeAccount:Q,stripePaymentsBlocked:$,showPhoneNumberExposedBanner:ee,mfaActionBoxEnabled:et,showGiftsFromSubstackOptIn:en,showLiveStreamDesktopAnnouncement:er,disabledUser:eo,token:ea,isEligibleForLiveStreamCreation:el}=t,{showCopyrightTakedownBanner:es}=t,ed=c&&!(0,Y.K1)(),ec=!!a.publisher_agreement_accepted_at||"profile"!==l.homepage_type&&!(a.id>=0xf9ce90e);return(0,Z.tZ)(W.Z,{pub:l,user:a,siteConfigs:m,experimentInfo:o,publicationSettings:g,language:F,publicationUserSettings:v,loadPubClientSearch:!0,enablePubClientSearchShortcuts:!1,context:"publisher",children:(0,Z.tZ)(ev.Provider,{value:(0,_._)((0,f._)({},this.state),{setPublication:e=>{let{pub:t,publication:i}=e;this.setState({pub:t,publication:i})}}),children:(0,Z.tZ)(mQ.rw,{children:(0,Z.BX)(x.nq,{value:FX,children:[(0,Z.tZ)(T.Match,{path:"/",children:e=>{let{path:t,url:i}=e;!t.startsWith("/publish/posts")&&t.startsWith("/publish/post")?this.setThemeBackground():this.unsetThemeBackground();let o=t.startsWith("/publish/posts")?"/publish/posts":"/publish"===t?"/publish":t.startsWith("/publish/podcasting")?"/publish/podcasting":t.startsWith("/publish/chat")?"/publish/chat":t.startsWith("/publish/subscribers")?"/publish/subscribers":t.startsWith("/publish/stats")?"/publish/stats":t.startsWith("/publish/settings")?"/publish/settings":t.startsWith("/publish/recommendations")?"/publish/recommendations":t.startsWith("/publish/meetings")?"/publish/meetings":t.startsWith("/publish/home")?"/publish/home":null;return(0,Z.BX)("div",{id:"publish-home",className:k()({"theme-editor":t.startsWith("/publish/settings/theme")}),children:[(0,Z.tZ)(X.Metadata,{title:"Substack Home - ".concat(l.name)}),!(0,iP.x)(i,"popup")&&(t.startsWith("/publish/posts")||!t.startsWith("/publish/post")&&!t.startsWith("/publish/collab")&&!t.startsWith("/publish/settings/theme")&&!t.startsWith("/publish/settings/website-theme")&&!t.startsWith("/publish/settings/edit"))&&(0,Z.tZ)(E.v,{pub:l,user:a,isPublishContext:!0,selectedSectionId:o,isMeetingsActive:y,hasMeetingsBooked:w}),(0,Z.BX)("div",{id:"publish-main",className:"/publish/settings"===t?"publish-main-settings":"/publish/chat"===t||"/publish/podcasting"===t||"/publish/recommendations"===t||"/publish/subscribers"===t?"flex":"",children:[FM.includes(t)&&(0,Z.tZ)(FD,{pub:l,loadingStripeAccount:Q,stripePaymentsBlocked:$}),m.pledges_disabled&&(0,Z.BX)(ei.xv.B4,{className:"publisher-banner",translated:!0,children:["We've paused pledges due to a potential violation of"," ",(0,Z.tZ)("a",{href:"".concat((0,j.ZJn)(),"/content"),children:"Substack's policy on Impersonation."})," Please contact our Standards & Enforcement team"," ",(0,Z.tZ)("a",{href:j.Y9U,onClick:()=>(0,U.j)(U.FP.PUBLISH_DISABLED_APPEALED),children:"here"})," ","for more details."]}),es&&(0,Z.tZ)(P.Y0,{className:"sticky",onClose:async()=>{es=!1,await N().put("/api/v1/publication_settings").send({show_copyright_takedown_banner:!1})},children:(0,Z.tZ)("div",{className:"container",children:(0,Z.BX)(ei.xv.B3,{color:"pub-accent",translated:!0,children:["Our Standards & Enforcement team has removed an image from public view in accordance with our"," ",(0,Z.tZ)("a",{href:"".concat((0,j.ZJn)(),"/dispute"),target:"_blank",children:"Copyright Dispute Policy"})," ","due to a DMCA Infringement notice. Please refer to the email sent to your author address for full details and instructions on how you can"," ",(0,Z.tZ)("a",{href:"https://support.substack.com/hc/en-us/requests/new?ticket_form_id=360001921412&type=dmca",target:"_blank",children:"submit a counter notice"}),"."]})})}),ec?(0,Z.BX)(B.default,{onChange:sn.Uu,children:[(0,Z.tZ)(CE,{path:"/publish",user:a,pub:l,maybeShowShareModal:C}),(0,Z.tZ)(Z_,{path:"/publish/posts/:view?",user:a,pub:l,isEligibleForLiveStreamCreation:el}),(0,Z.tZ)(w3,{path:"/publish/posts/detail/:id",tab:"overview",pub:l}),(0,Z.tZ)(w3,{path:"/publish/posts/detail/:id/:tab",pub:l}),(0,Z.tZ)(ga,{path:"/publish/home",user:a,pub:l,themeVariables:L,showSubscriberReferralsSetupOptIn:S,showChatReaderParticipationBox:I,showGAMigrationModal:M,surveysOnboardingModalVariant:A,showLocalCurrencyModal:D,showPaywallUnlockReminderModal:R,showPledgeTurnOnPaidBox:z,estimatedArr:O,estimatedArrCurrency:H,shouldShowSurveyAnnouncement:q,overrideSurveyAnnouncementDismissKey:G,showPhoneNumberExposedBanner:ee,mfaActionBoxEnabled:et,showGiftsFromSubstackOptIn:en,showLiveStreamDesktopAnnouncement:er,isEligibleForLiveStreamCreation:el}),(0,Z.tZ)(f$,{path:"publish/podcasting/:slug?",pub:l}),(0,Z.tZ)(f$,{path:"publish/podcasting/s/:slug",pub:l,isSection:!0}),(0,Z.tZ)(CX,{path:"/publish/:post_id/recipients",user:a,pub:l}),(0,Z.tZ)(si,(0,f._)({path:"/publish/post/:post_id?",user:a,pub:l,publication:s,publicationSettings:g,showWriterReferralExplainer:!d&&!(0,iP.x)("hideWriterReferralCta"),surveyId:K},I18N.i({pub:l}))),(0,Z.tZ)(CO,{path:"/publish/post/:post_id/versions",pub:l}),(0,Z.tZ)(AT,{path:"/publish/subscribers/legacy",user:a,pub:l,email:n,userId:Number(r)||void 0}),(0,Z.tZ)(De,{path:"/publish/subscribers/add",user:a,pub:l,isManagedPublication:J}),(0,Z.tZ)(IJ,{path:"/publish/settings/preamble",pub:l,publication:s,user:a}),(0,Z.tZ)(v_,{path:"/publish/bans",pub:l}),(0,Z.tZ)(ye,{path:"/publish/moderation",pub:l,user:a}),(0,Z.tZ)(bN,{path:"/publish/moderation/policy",pub:l}),(0,Z.tZ)(yw,{path:"/publish/moderation/policies/:policyId/evals/:evalId",pub:l}),(0,Z.tZ)(ys,{path:"/publish/moderation/policies/:policyId/evals/:evalId/runs/:runId",pub:l}),(0,Z.tZ)(yn,{path:"/publish/moderation/new-commenters",pub:l}),(0,Z.tZ)(Ng,{path:"/publish/settings/edit",pub:l,user:a}),(0,Z.tZ)(N5,{path:"/publish/posts/detail/:id/share-center",pub:l,themeVariables:L}),(null==a?void 0:a.is_admin)?[(0,Z.tZ)(g_,{path:"/publish/settings/homepage_links",pub:l}),(0,Z.tZ)(gh,{path:"/publish/settings/blurbs"}),(0,Z.tZ)(F_,{path:"/publish/settings/website-theme",pub:l}),(0,Z.tZ)(FI,{path:"/publish/settings/website-theme-preview",pub:l,user:a}),(0,Z.tZ)(BQ,{path:"/publish/settings/setup_plans",pub:l,full_page_version:!0}),(0,Z.tZ)(No,{path:"/publish/settings/new_newsletter"}),(0,Z.tZ)(IV,{path:"/publish/settings/new_podcast",pub:l,publication:s}),(0,Z.tZ)(IV,{path:"/publish/settings/new_podcast/:initialSectionId",pub:l,publication:s}),(0,Z.tZ)(Ns,{path:"/publish/settings/newsletter/:sectionId",pub:l}),(0,Z.tZ)(I3,{path:"/publish/settings/podcast/:sectionId",pub:l,publication:s}),(0,Z.tZ)(I3,{path:"/publish/settings/podcast/edit",pub:l,publication:s}),(0,Z.tZ)(Ej,{path:"/publish/stats/reader-surveys-editor/:surveyId",pub:l,user:a,popup:!!(0,iP.x)("popup")}),(0,Z.tZ)(EI,{path:"/publish/stats/:statType*",pub:l,themeVariables:L}),(0,Z.tZ)(xB,{path:"/publish/recommendations",pub:l}),(0,Z.tZ)(IX,{path:"/publish/settings",isChatActive:b,isMeetingsActive:y}),(0,Z.tZ)(Nu,{path:"/publish/stripe-import",pub:l,user:a}),(0,Z.tZ)(s3,{path:"/publish/domain/pay"}),(0,Z.tZ)(s4,{path:"/publish/domain"}),(0,Z.tZ)(s8,{path:"/publish/domain/status",pub:l}),(0,Z.tZ)(s$,{path:"/publish/domain/redirects",pub:l}),(0,Z.tZ)(s0,{path:"/publish/domain/redirects-status",pub:l}),(0,Z.tZ)(sY,{path:"/publish/document_exports"}),(0,Z.tZ)(Zm,{path:"/publish/podcast/new",pub:l}),(0,Z.tZ)(gC,{path:"/publish/import/podcast/:sectionId",pub:l}),(0,Z.tZ)(gC,{path:"/publish/import/podcast",pub:l}),(0,Z.tZ)(FE.b,{path:"/publish/import",pub:l}),(0,Z.tZ)(yC,{path:"/publish/offers",pub:l}),(0,Z.tZ)(yT,{path:"/publish/offers/new",pub:l}),(0,Z.tZ)(yT,{path:"/publish/offers/:offer_id/edit",pub:l}),(0,Z.tZ)(Mj,{path:"/publish/subscribers",user:a,pub:l}),(0,Z.tZ)(yP,{path:"/publish/offers/:offer_id",pub:l}),(0,Z.tZ)(Db,{path:"/publish/groups/offer/new",pub:l}),(0,Z.tZ)(Dv,{path:"/publish/groups/offer/:user_id/edit",user_id:a.id,pub:l}),(0,Z.tZ)(DP,{path:"/publish/groups",pub:l}),(0,Z.tZ)(Dd,{path:"/publish/groups/:subscription_id",pub:l}),(0,eW.default)("meetings_v1")?(0,Z.tZ)(gE,{path:"/publish/meetings/:meetingFilter*",pub:l}):null,(0,Z.tZ)(Nr,{path:"/publish/settings/reader_referrals",pub:l}),(0,Z.tZ)(d9,{path:"/publish/drip-campaign/:type",pub:l}),(0,Z.tZ)(Pc,{path:"/publish/sponsorship-campaigns",pub:l}),(0,Z.tZ)(Pd,{path:"/publish/sponsorship-campaigns/:campaignId"})]:(0,Z.tZ)(AT,{path:"/publish/subscribers",user:a,pub:l,email:n,userId:Number(r)||void 0}),(0,Z.tZ)(yO,{path:"/publish/pins",pub:l}),(0,Z.tZ)(FN,{path:"/publish/unsubscribe",pub:l,disabledUser:eo,token:ea}),(0,Z.tZ)(sR,{path:"/publish/chat"})]}):(0,Z.tZ)(C$,{path:"/publish/subscribers",user:a}),ed&&(null==u?void 0:u.length)?(0,Z.tZ)(eg.D,{pub:l,pubsToRecommend:u}):ed?(0,Z.tZ)(V,{isAlreadyPublished:!1,pub:l,scheduledFor:p,audience:h}):null]})]})}}),(0,Y.WC)()?(0,Z.tZ)(FP.cr,{module:"@/frontend/components/dev_toolbar",resolve:e=>e.default,onRequest:()=>Promise.all([i.e("8381"),i.e("1466"),i.e("7499"),i.e("2516")]).then(i.bind(i,25335)),pub:l,user:a,whileLoading:null}):null]})})})})}constructor(e,t){super(e,t);let{pub:i}=e.initialData;this.state=(0,_._)((0,f._)({},e.initialData),{loadingStripeAccount:(null==i?void 0:i.stripe_user_id)&&"enabled"===i.payments_state})}}function FD(e){let{pub:t,loadingStripeAccount:i,stripePaymentsBlocked:n}=e;return(0,Z.tZ)(ep,{pub:t,banners:(()=>{let e=[];if(t.flagged_as_spam&&e.push(eu.PublicationBanned),!i){n&&e.push(eu.StripePaymentsBlocked);let t=(0,eW.default)("publisher_banner");t&&e.push(t)}return e})(),flagged_reason:t.flagged_reason})}(!(g=null===(b=window._preloads)||void 0===b?void 0:null===(v=b.user)||void 0===v?void 0:v.id)||lF().find(e=>e.user_id&&e.user_id!==g))&&lJ(),(0,y.Z)(FA)},75419:function(e,t,i){i.d(t,{Au:()=>z,i3:()=>O,oC:()=>U,sA:()=>R});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(6400),s=i(30396),d=i(94184),c=i.n(d),u=i(13639),p=i(20160),h=i(57391),m=i(95441),g=i(60807),v=i(68733),b=i(68833),y=i(48980),f=i(7882),_=i(97505),Z=i(94874),w=i(15771),C=i(19081),x=i(6490),S=i(58175),k=i(27744),B=i(74312),T=i(88817);i(91400);var I=i(43254),N=i(50364),P=i(63651),E=i(84864),X=i(47929),M=i(7083);let A={utm_campaign:X.VX.notesPostAppUpsell,utm_source:X.b3.substack};function D(e){var{isOpen:t}=e,l=(0,o._)(e,["isOpen"]);return(0,a.tZ)(x.u_,{className:M.Z.composerModal,isOpen:t,onClose:l.onClose,fullscreenMobile:!0,width:600,children:(0,a.tZ)(B.cr,(0,r._)((0,n._)({},l),{module:"../feed/NoteComposer",resolve:e=>e.NoteComposer,onRequest:()=>Promise.all([i.e("9539"),i.e("5431"),i.e("9027"),i.e("6336"),i.e("9931"),i.e("3686"),i.e("5042"),i.e("5477"),i.e("5456"),i.e("4213")]).then(i.bind(i,5817)),whileLoading:(0,a.tZ)("div",{style:{height:336}})}))})}function R(e){let{disabled:t,parentPubId:i,parentPostId:o,parentCommentId:l,restackUrl:s,placeholder:d,tabId:u,surface:b,initialText:y,className:f,textClassName:_}=e,{iString:x}=(0,m.M1)(),k=O(),B=(0,g.aF)(),{requireLogin:I,onboardingModalRef:N}=(0,T.SJ)(),{getExperimentVariant:P}=(0,h.jc)(),E=(0,v.Fm)({onAddFiles:e=>{k.open({parentPubId:i,parentPostId:o,parentCommentId:l,restackUrl:s,initialFiles:e,tabId:u,surface:b,initialText:y})},acceptFile:v.N1});return(0,a.tZ)(C.tu,(0,r._)((0,n._)({},E.props),{position:"relative",children:(0,a.tZ)(w.kG,{onClick:()=>{if(!t){if(B)k.open({parentPubId:i,parentPostId:o,parentCommentId:l,restackUrl:s,tabId:u,surface:b,initialText:y});else if("control"===(P("homepage_welcome_card_2")||"control"))null==I||I();else{var e;null===(e=N.current)||void 0===e||e.open()}}},disabled:t,radius:"md",resetCss:!0,showFocus:!0,animate:!0,"aria-label":x("New post"),children:(0,a.tZ)(p.W,{children:(0,a.BX)(C.gq,{padding:16,gap:12,radius:"md",alignItems:"center",bg:"primary",border:"detail",shadow:"xs",cursor:"pointer",userSelect:"none",className:c()(M.Z.inlineComposer,E.isDragging&&M.Z.isDragging,f),animate:!0,children:[B?(0,a.tZ)(Z.qE,{size:36,user:B,"aria-hidden":!0}):(0,a.tZ)(C.hs,{flex:"auto",children:(0,a.tZ)(Z.qE,{size:36,"aria-hidden":!0})}),(0,a.tZ)(S.xv.B2,{align:"left",color:"secondary",flex:"grow",ellipsis:!0,className:_,children:d||"What's on your mind?"})]})})})}))}let F={isOpen:!1,firstComment:void 0},L=(0,l.createContext)({state:F,open:async()=>{throw Error("Not implemented")}});function z(e){var t,o,l;let{children:d}=e,c=(0,g.aF)(),u=!(null==c?void 0:c.name),p=(0,k.I0)(),[v,f]=(0,s.eJ)(F),[Z,w]=(0,s.eJ)(!1),{exposeExperiment:C,getExperimentVariant:S}=(0,h.jc)(),T=(0,g.SE)(),I=(0,s.sO)(),{iString:N}=(0,m.M1)(),{feedItem:P}=v,X=U(P),M=(null==P?void 0:P.type)==="comment"?null!==(o=null===(t=P.parentComments)||void 0===t?void 0:t[0])&&void 0!==o?o:P.comment:null;(0,s.d4)(()=>{c&&Promise.all([i.e("9539"),i.e("5431"),i.e("9027"),i.e("6336"),i.e("9931"),i.e("3686"),i.e("5042"),i.e("5477"),i.e("5456"),i.e("4213")]).then(i.bind(i,5817))},[c]),(0,s.d4)(()=>{v.isOpen&&i.e("6175").then(i.bind(i,21516))},[v.isOpen]),(0,s.d4)(()=>{v.appInstallUsers&&Promise.resolve().then(i.bind(i,83034))}),(0,s.d4)(()=>{v.isOpen&&u&&w(!0)},[I,u,v.isOpen]);let R=(0,s.Ye)(()=>({state:v,open:e=>new Promise((t,i)=>{f((0,r._)((0,n._)({},F,e),{isOpen:!0,resolve:t,reject:i}))})}),[v]),z=function(){var e,t,i;let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null===(t=document.activeElement)||void 0===t||null===(e=t.blur)||void 0===e||e.call(t),null===(i=v.onDismiss)||void 0===i||i.call(v),f((0,n._)((0,r._)((0,n._)({},v),{isOpen:!1}),o))};return(0,a.BX)(L.Provider,{value:R,children:[d,u?(0,a.tZ)(_.Z,{displaySignInModal:Z,onCloseSignInModal:()=>{w(!1),f((0,r._)((0,n._)({},v),{isOpen:!1}))},isStatic:!1,entry:"composer-new-post"}):X?(0,a.tZ)(x.u_,{isOpen:v.isOpen,onClose:()=>z(),width:316,children:(0,a.tZ)(Y,{onClose:()=>z(),requirement:X,writerId:null!==(l=null==M?void 0:M.user_id)&&void 0!==l?l:0})}):(0,a.tZ)(D,(0,r._)((0,n._)({},v),{isOpen:v.isOpen,onClose:()=>z(),onSuccess:async e=>{var t,i;let o;if(c&&!c.reader_installed_at&&(null==T?void 0:T.userSettings)&&!T.userSettings.has_seen_notes_post_app_upsell&&(T.changeSetting("has_seen_notes_post_app_upsell",!0),C("app_upsell_after_posting_notes"),"treatment"===S("app_upsell_after_posting_notes")))try{o=await (0,y.rd)("/api/v1/app_install_facepile")}catch(e){o=[]}o?((0,b.j)(b.FP.APP_INSTALL_MODAL_OPENED,A),f((0,r._)((0,n._)({},v),{appInstallUsers:o}))):e.isFirstFeedCommentByUser?f((0,r._)((0,n._)({},v),{firstComment:e})):z(),p({type:v.editComment?"edit_comment":"new_comment",payload:{comment:e}}),null===(t=v.onCompose)||void 0===t||t.call(v,e),null===(i=v.resolve)||void 0===i||i.call(v,e)},onError:v.reject})),(0,a.tZ)(x.u_,{isOpen:v.isOpen&&!!v.firstComment,children:v.firstComment&&(0,a.tZ)(B.cr,{module:"@/frontend/feed/NuxModal",resolve:e=>e.FeedNuxShareFirstNote,onRequest:()=>i.e("6175").then(i.bind(i,21516)),onClose:()=>z(),comment:v.firstComment})}),v.appInstallUsers&&(0,a.tZ)(B.cr,(0,n._)({module:"../components/app_install_modal",resolve:e=>e.AppInstallModal,onRequest:()=>Promise.resolve().then(i.bind(i,83034)),onClose:()=>{z({appInstallUsers:void 0})},isOpen:!!v.appInstallUsers,overrideTitle:v.appInstallUsers.length>0?"Join ".concat((0,E.oxfordComma)([...v.appInstallUsers.map(e=>e.name),"others"]).toString(),"  in the Substack app"):"Notes is better in the Substack app",overrideCTA:N("Get the app"),width:500,facepileUsers:v.appInstallUsers,showMobileClose:!0},A))]})}function O(){return(0,s.qp)(L)}function U(e){var t,i;let n=(0,g.aF)(),r=null==e?void 0:e.post,o=(null==e?void 0:e.type)=="comment"?null!==(i=null===(t=e.parentComments)||void 0===t?void 0:t[0])&&void 0!==i?i:e.comment:null,{user_id:a}=null!=o?o:{},{reply_minimum_role:l}=null!=o?o:{},s=(0,I.K1)(null!=a?a:0);if(null==l&&(null==r?void 0:r.write_comment_permissions)==="only_paid"&&(l="paid_subscriber"),!a||!l||(null==e?void 0:e.canReply)||o&&n&&(0,N._N)(o,n.id))return null;if(l){if("free_subscriber"===l&&(!s||!["free_subscription","subscribed"].includes(s)))return"free_subscriber";if("paid_subscriber"===l&&"subscribed"!==s)return"paid_subscriber"}return null}function Y(e){var t;let{requirement:i,writerId:n,onClose:r}=e,o=(0,g.aF)(),{result:l}=(0,f.ib)({pathname:"/api/v1/user/".concat(n,"/primary-publication"),deps:[n],auto:!0});return(0,a.BX)(C.tu,{padding:16,children:[(0,a.tZ)(C.hs,{justifyContent:"center",paddingTop:16,paddingBottom:20,children:(0,a.tZ)(u.Z,{size:32,color:"var(--color-fg-primary)"})}),(0,a.BX)(C.tu,{gap:20,children:[(0,a.BX)(C.tu,{gap:8,alignItems:"center",children:[(0,a.tZ)(S.xv.H3,{align:"center",children:"free_subscriber"===i?"Subscribers only":"Paid subscribers only"}),l&&(0,a.BX)(S.xv.B3,{color:"secondary",align:"center",children:["To join the conversation,"," ","free_subscriber"===i?"subscribe":"become a paying subscriber"," ","to ",null!==(t=l.name)&&void 0!==t?t:"this publication","."]})]}),(0,a.BX)(C.tu,{gap:8,children:[l&&(0,a.tZ)(w.zx,{priority:"primary",rounded:!0,href:(0,P.W1P)(l,{user:o,addBase:!0,params:{utm_source:X.b3.feedCommentReplyRestriction}}),children:"Subscribe"}),(0,a.tZ)(w.zx,{priority:"secondary",rounded:!0,onClick:r,children:"Cancel"})]})]})]})}},65575:function(e,t,i){i.d(t,{EU:()=>S,Uj:()=>f,Vm:()=>y.V,_Y:()=>Z,gq:()=>u.gq,mE:()=>x,mb:()=>w,pe:()=>C,tu:()=>u.tu,zr:()=>k});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(98661),s=i(94184),d=i.n(s);i(1852);var c=i(80878);i(98914);var u=i(19081),p=i(58175);i(45783);var h=i(66611),m=i(76566);i(91400);var g=i(63651),v=i(47929),b=i(28840);i(38202);var y=i(36889);let f=(0,l.forwardRef)((e,t)=>{var{isPadded:i=!0,className:l,linkClassName:s}=e,c=(0,o._)(e,["isPadded","className","linkClassName"]);return(0,a.tZ)("div",{ref:t,className:d()(b.Z.linkRow,i&&b.Z.isPadded,l),children:(0,a.tZ)(_,(0,r._)((0,n._)({},c),{className:s}))})});function _(e){var{children:t,className:i,href:l,newTab:s,onClick:p,noAnchor:h,native:m,utmCampaign:y,utmSource:f,isSelected:_}=e,Z=(0,o._)(e,["children","className","href","newTab","onClick","noAnchor","native","utmCampaign","utmSource","isSelected"]);let w="undefined"!=typeof location?location.pathname:"",C=h||null==l?"div":"a",x=l&&(0,g.n1t)(l,{utm_source:f||w,utm_medium:v.lP.reader2,utm_campaign:y});return(0,a.tZ)(u.hs,(0,r._)((0,n._)({as:C,className:d()(b.Z.linkRowA,i,(x||p)&&null==_&&b.Z.isClickable,_&&b.Z.isSelected,null!=_&&b.Z.isSelectable),"data-selected":_,href:x,target:s?"_blank":void 0,onClick:e=>{p&&p(e),!e.defaultPrevented&&h&&x&&(0,c.Q)(e,x,{native:m,newTab:s})},showFocus:!0,animate:!0},Z),{children:t}))}function Z(e){let{icon:t,title:i,text:n,action:r,className:o}=e;return(0,a.BX)(u.tu,{gap:16,alignItems:"center",justifyContent:"center",flex:"grow",className:d()(b.Z.zero,o),children:[t,(0,a.BX)(u.tu,{gap:4,children:[(0,a.tZ)(p.xv.B4,{weight:"semibold",color:"primary",children:i}),(0,a.tZ)(p.xv.B4,{color:"secondary",children:n})]}),r]})}function w(e){return(0,a.tZ)(u.tu,{bg:"secondary",border:"detail",radius:"md",paddingX:20,paddingY:64,justifyContent:"center",alignItems:"center",flex:"grow",children:(0,a.tZ)(Z,(0,n._)({},e))})}function C(e){var{gap:t=16}=e,i=(0,o._)(e,["gap"]);return(0,a.tZ)(u.tu,(0,r._)((0,n._)({},i),{className:d()(b.Z.pageStack,b.Z["gap_".concat(t)])}))}(0,l.forwardRef)((e,t)=>(0,a.tZ)(m.S,{children:(0,a.tZ)("div",(0,n._)({id:"reader-nav-page-scroll",className:d()("reader-nav-page-scroll",e.className),ref:t},e))})),(0,l.forwardRef)((e,t)=>{var{className:i,hasError:l}=e,s=(0,o._)(e,["className","hasError"]);return(0,a.tZ)("input",(0,r._)((0,n._)({className:d()(b.Z.input,l&&b.Z.error,i)},s),{ref:t}))}),(0,h.L)("reader2-page-top"),(0,h.L)(b.Z.pageTopFixed),(0,h.L)("reader2-page-body");let x=(0,h.L)(b.Z.pageStack);(0,h.L)("reader2-page-center"),(0,h.L)("reader2-modal-title-text"),(0,h.L)("reader2-column"),(0,h.L)("reader2-text-h3"),(0,h.L)("reader2-text-h3 reader2-section-title"),(0,h.L)("reader2-text-h4"),(0,h.L)("reader2-item-title"),(0,h.L)("reader2-item-meta"),(0,h.L)("reader2-text-b4"),(0,h.L)("reader2-form-error"),(0,h.L)("reader2-subtitle"),(0,h.L)("reader2-separator","hr"),(0,h.L)("reader2-page-section withTitle"),(0,h.L)("reader2-row reader2-split-row"),(0,h.L)("reader2-emphasis-box");let S=(0,h.L)(d()(b.Z.hoverLink,"pencraft"),"a");function k(e){return(0,a.tZ)(S,(0,n._)({target:"_blank"},e))}},12461:function(e,t,i){i.d(t,{$:()=>u});var n=i(16584),r=i(35543),o=i(60807),a=i(80878),l=i(15771),s=i(3021),d=i(63651),c=i(47929);function u(e){let{person:t,surface:i="suggestion"}=e,u=(0,o.aF)(),{primary_publication:p}=t,h=(0,r.Sv)(t,i),m=h.isFollowing?"Following":"Follow",g=h.isFollowing?"secondary-outline":"secondary";return(0,n.tZ)(s.kJ,{user:t,publication:p,label:p?p.name:"",source:i,onClick:e=>(0,a.Q)(e,(0,d.NNq)(t,{utm_source:c.b3.substack,utm_content:c.fZ.resackerItem}),{state:{showBack:!0}}),cta:t.id===(null==u?void 0:u.id)?null:(0,n.tZ)(l.zx,{priority:g,size:"sm",onClick:e=>{e.preventDefault(),h.toggle()},children:m})})}},55533:function(e,t,i){i.d(t,{ld:()=>c,vJ:()=>d});var n=i(7409),r=i(99282),o=i(98848),a=i(16584);i(15771);var l=i(19081),s=i(58175);function d(e){var{title:t,body:i,children:s,spacing:d}=e,u=(0,o._)(e,["title","body","children","spacing"]);return(0,a.tZ)(l.tu,(0,r._)((0,n._)({flex:"grow",alignItems:"center",justifyContent:"center",padding:20},u),{children:(0,a.tZ)(c,{title:t,body:i,gap:d,children:s})}))}function c(e){let{title:t,body:i,children:n,gap:r}=e;return(0,a.BX)(l.tu,{gap:12,alignItems:"center",children:[(0,a.BX)(l.tu,{gap:null!=r?r:4,alignItems:"center",children:[(0,a.tZ)(s.xv.B3,{weight:"semibold",color:"primary",align:"center",children:t}),(0,a.tZ)(s.xv.B4,{color:"secondary",align:"center",children:i})]}),n]})}},91432:function(e,t,i){i.d(t,{Bm:()=>I,Fb:()=>T,lU:()=>B});var n=i(7409),r=i(16584),o=i(30396),a=i(94184),l=i.n(a),s=i(86657),d=i(29032),c=i(95441),u=i(98422),p=i(71068),h=i(19081),m=i(4158),g=i(14283),v=i(18618),b=i(54480),y=i(28226),f=i(70958),_=i(61404),Z=i(43905),w=i(24791),C=i(6070),x=i(31377),S=i(93370),k=i(73015);let B=e=>{let{isFreeSubscribed:t,isSubscribed:i,isTesting:n,post:a,pub:l,section:s,variant:d,reaction_token:c,trackingProps:u}=e,[p,h]=(0,o.eJ)(!1),m=(0,o.sO)(null),g=!i&&(0,x.isPaidAudience)(a.audience);if(!a.podcastUpload)return null;let v=(0,C.lp)({post:a}),b=a.podcastUpload.is_free_preview,f=!v&&g&&(p||!b&&"notes-embed"!==d)&&!(0,w.sv)({post:a});return(0,r.BX)(r.HY,{children:[(0,r.tZ)(P,{audioFileUrl:a.podcast_url,audioPlayerRef:m,metricsPost:a,hidePreviewUI:v,paywallComponent:f?(0,r.tZ)(y.Y,{inlineIcon:"notes-embed"===d,isFreeSubscribed:t,post:a,pub:l,medium:"audio",variant:"overlay",onRestart:b?()=>{var e;(null===(e=m.current)||void 0===e?void 0:e.player)&&(h(!1),m.current.player.currentTime=0,m.current.player.play())}:void 0,magicToken:c}):void 0,podcastDuration:a.podcast_duration,podcastUpload:a.podcastUpload,post:a,postId:a.id,postTitle:a.title,pub:l,section:s,showPaidLabel:g&&!b,user:null,variant:d,onFinishAudio:()=>{h(!0)},useBlur:!0,trackingProps:u}),n&&(0,r.tZ)("button",{onClick:()=>{h(!0)},children:"finish audio"})]})},T=e=>{var t;let{audioPlayerRef:i,explicitHeight:n,explicitPodcastUrl:a,feedUrl:l,hasPaywall:s,isPrivateFeed:d,isServingFreePodcastUrl:c,post:u,pub:p,radius:h,section:m,ufiComponent:g,user:v,freeSignup:b,reaction_token:f}=e,[_,Z]=(0,o.eJ)(!1),w=(0,C.lp)({post:u}),x=null===(t=u.podcastUpload)||void 0===t?void 0:t.is_free_preview,S=!w&&s&&(!x||_)&&!c;return(0,r.tZ)(P,{audioFileUrl:u.podcast_url,audioPlayerRef:i,feedUrl:l,explicitHeight:n,explicitPodcastUrl:a,hidePreviewUI:w,isPrivateFeed:d,isServingFreePodcastUrl:c,metricsPost:u,paywallComponent:S?(0,r.tZ)(y.Y,{isFreeSubscribed:!!(null==v?void 0:v.is_free_subscribed)||!!b,post:u,pub:p,medium:"audio",variant:"overlay",onRestart:x?()=>{var e;(null===(e=i.current)||void 0===e?void 0:e.player)&&(Z(!1),i.current.player.currentTime=0,i.current.player.play())}:void 0,magicToken:f}):void 0,podcastDuration:u.podcast_duration,podcastUpload:u.podcastUpload,post:u,postId:u.id,postTitle:u.title,pub:p,radius:h,section:m,ufiComponent:g,user:v,variant:"episode-page",onFinishAudio:()=>{Z(!0)}})},I=e=>{let{audioFileUrl:t,hasFreePodcastUrlSet:i,postTitle:n,podcastDuration:o,podcastPreviewUpload:a,podcastUpload:l,pub:s,section:d,editComponent:c}=e;return(0,r.tZ)(P,{audioFileUrl:t,hasFreePodcastUrlSet:i,metricsPost:null,hidePreviewUI:!1,postId:null,postTitle:n,podcastDuration:o,podcastPreviewUpload:a,podcastUpload:l,post:null,pub:s,section:d,user:null,variant:"editor",editComponent:c})},N={"episode-page":400,editor:320,"notes-embed":128,"notes-full":250},P=e=>{var t,i,o;let{audioFileUrl:a,audioPlayerRef:y,explicitHeight:w,explicitPodcastUrl:C,feedUrl:x,hasFreePodcastUrlSet:B,hidePreviewUI:T,hideUfi:I,isPrivateFeed:P,isServingFreePodcastUrl:E,metricsPost:X,postId:M,postTitle:A,podcastDuration:D,pub:R,podcastUpload:F,radius:L,section:z,showPaidLabel:O,podcastPreviewUpload:U,post:Y,ufiComponent:H,editComponent:j,paywallComponent:J,variant:V,user:q,onFinishAudio:W,useBlur:G,trackingProps:K}=e,{isMobile:Q}=(0,u.v9)(),{iString:$}=(0,c.M1)(),ee=z?null!==(t=z.podcastPalette)&&void 0!==t?t:null:null!==(i=R.podcastPalette)&&void 0!==i?i:null,{title:et,backgroundUrl:ei,artUrl:en}=(0,Z.Mv)({pub:R,podcastUpload:F,section:z,thumbnailInfo:(null==F?void 0:F.full_podcast_info)&&M?{post_id:M,media_upload_id:F.full_podcast_info.media_upload_id,thumbnail_id:F.full_podcast_info.thumbnail_id}:null}),er=null!=w?w:N[V],eo="notes-embed"===V,ea=Q||eo,el=!!J,es=G||en===ei,ed=!!j,ec=(null==F?void 0:F.is_free_preview)||U;return(0,r.tZ)(s.Z,{ref:y,duration:D,metricsPost:X,preventSnappingToCurrentTime:!0,pub:R,skipPreloading:E,src:a,updateOnEveryFrame:D<300,onFinishAudio:W,mediaUpload:null!=F?F:void 0,trackingProps:(0,n._)({contentType:"post",entityType:"post",entityKey:null!==(o=null==Y?void 0:Y.id)&&void 0!==o?o:"unknown",surface:"editor"===V?"editor":"post"},K),render:e=>{var t;let{currentTime:i,dragTime:n,isPlaying:o,playbackRate:s,progress:c,progressBarRef:u,progressBarOnMouseDown:y,remainingTime:Z,setPlaybackRate:w,skipBack:N,skipForward:X,togglePlayback:M}=e;return(0,r.tZ)(d.C,{children:(0,r.BX)(p.xu,{position:"relative",style:{minHeight:Q?Math.min(200,er):er},children:[(0,r.tZ)(m.z,{backgroundUrl:eo?null:ei,blurAmount:eo?40:120,isBlurred:es,palette:ee,radius:L}),(0,r.BX)(h.tu,{position:"absolute",inset:0,justifyContent:ea?"space-between":void 0,children:[(0,r.BX)(h.gq,{alignItems:"stretch",flex:ea?void 0:"grow",justifyContent:"space-between",children:[(!ea||!el)&&(0,r.tZ)(p.xu,{padding:ea||"notes-full"===V?16:24,paddingBottom:"notes-embed"===V?0:void 0,overflow:"hidden",flex:"grow",children:(0,r.tZ)(g.o,{isDisabled:el,explicitPodcastUrl:C,pub:R,post:Y,postTitle:A,section:z,showUpgradeButton:E,showTitle:et,variant:"notes-embed"===V?"notes-embed":Q||"notes-full"===V?"mini":"regular"})}),!ea&&!el&&!I&&H&&(0,r.tZ)(h.gq,{alignItems:"center",paddingX:24,children:H}),null!=j?j:null]}),!el&&"notes-embed"!==V&&(0,r.tZ)(h.tu,{paddingX:16,position:ea?void 0:"absolute",className:l()({[k.Z.controlsCentered]:!ea}),children:(0,r.tZ)(b.n,{audioFileUrl:a,feedUrl:x,isPlaying:null!=o&&o,isPrivateFeed:!!P,playbackRate:s,sectionId:z?z.id:null,user:q,onChangePlaybackRate:w,onSkipBack:N,onSkipForward:X,onTogglePlayback:M})}),(!ea||!el)&&(0,r.BX)(h.gq,{className:l()(k.Z.track),alignItems:"center",gap:16,opacity:el?20:void 0,padding:ea||"notes-full"===V?16:24,paddingTop:"notes-embed"===V?8:void 0,pointerEvents:el?"none":void 0,onClick:e=>{O||(e.stopPropagation(),e.preventDefault())},children:[ec&&ed&&U&&(0,r.tZ)(f.l,{children:(0,S.DL)(null!==(t=U.duration)&&void 0!==t?t:0)}),ec&&!T&&!ed&&(0,r.tZ)(f.l,{children:$("Preview")}),O&&(0,r.tZ)(f.l,{children:$("Paid")}),B&&(0,r.tZ)(f.l,{children:$("Free url set")}),(0,r.tZ)(_.w,{containerRef:u,currentTime:i,dragTime:n,hideStartingTimestamp:Q,progress:c,remainingTime:Z,onMouseDown:y}),"notes-embed"===V&&(0,r.tZ)(v.D,{isPlaying:null!=o&&o,size:40,onTogglePlayback:M})]})]}),J]})})}})}},98905:function(e,t,i){i.d(t,{K:()=>p});var n=i(7409),r=i(99282),o=i(98848),a=i(16584),l=i(98661),s=i(94184),d=i.n(s),c=i(19081),u=i(37381);let p=(0,l.forwardRef)((e,t)=>{var{className:i,error:l=!1,type:s="text",width:p,background:h,font:m,leftIcon:g,rightIcon:v}=e,b=(0,o._)(e,["className","error","type","width","background","font","leftIcon","rightIcon"]);let y=(0,a.tZ)("input",(0,r._)((0,n._)({},b),{className:d()(i,u.Z.inputWithIcons,{[u.Z.error]:l},m&&u.Z["font-".concat(m)]),style:{width:p,background:h},type:s,ref:t}));return(0,a.BX)(c.gq,{paddingX:12,className:d()(i,u.Z.inputWrapper,{[u.Z.error]:l}),style:{width:p,background:h},children:[g&&(0,a.tZ)("span",{children:g}),y,v&&(0,a.tZ)("span",{children:v})]})})},43905:function(e,t,i){i.d(t,{Mv:()=>f,U6:()=>C,a9:()=>k,bf:()=>w,mr:()=>P,nK:()=>I,tc:()=>S,ty:()=>T,wg:()=>_,wq:()=>N});var n=i(7409),r=i(99282),o=i(58865),a=i(39693),l=i.n(a),s=i(24350),d=i.n(s),c=i(49995),u=i(68833),p=i(55480),h=i(98914),m=i(24791),g=i(31377),v=i(60308),b=i(63651);function y(){let e=(0,o._)(['Invalid URL. URL should start with "','"']);return y=function(){return e},e}let f=e=>{let{pub:t,podcastUpload:i,section:o,thumbnailInfo:a,useSection:l}=e;if(l){let e=o?(0,b.Ucy)(t,{section:o}):(0,b.SVA)(t);return o?{artUrl:o.logo_url,backgroundUrl:o.cover_photo_url,description:o.description,paidArtUrl:null,title:o.name,url:e}:{artUrl:t.logo_url,backgroundUrl:t.cover_photo_url,description:null,paidArtUrl:null,title:t.name,url:e}}let{title:s,description:d,artUrl:c,paidEpisodeArtUrl:u}=o&&!l?(0,p.d_)({pub:t,section:o}):(0,p.jU)({pub:t}),h=o?(0,b.Ucy)(t,{section:o}):(0,b.SVA)(t),m=c;if(i&&a&&a.thumbnail_id>1){let e=(0,v.kOB)((0,r._)((0,n._)({},i),{id:a.media_upload_id,post_id:a.post_id,thumbnail_id:a.thumbnail_id}));e&&(m=e)}else if(i&&i.thumbnail_id>1){let e=(0,v.kOB)(i);e&&(m=e)}return{artUrl:c,backgroundUrl:m,description:d,paidArtUrl:null!=u?u:null,title:s,url:h}},_=[{key:"apple_podcasts",label:"Apple Podcasts",fieldName:"apple_podcasts_url"},{key:"spotify",label:"Spotify",fieldName:"spotify_url"},{key:"spotify_for_paid_users",label:"Spotify",fieldName:"spotify_for_paid_users_url"},{key:"youtube_music",label:"YouTube Music",fieldName:"youtube_music_url"},{key:"youtube",label:"YouTube",fieldName:"youtube_url"},{key:"overcast",label:"Overcast",fieldName:"overcast_url"},{key:"pocket_casts",label:"Pocket Casts",fieldName:"pocket_casts_url"}],Z=e=>{let{platform:t,feedUrl:i,isApple:n,isMobile:r}=e;return i?"apple_podcasts"===t&&n?"podcast://".concat((0,v.G1C)(i)):"overcast"===t&&r?"overcast://x-callback-url/add?url=".concat(encodeURIComponent(i)):"pocket_casts"===t&&r?"pktc://subscribe/".concat((0,v.G1C)(i)):null:null},w=e=>{let{feedUrl:t,isApple:i,isMobile:n,showLinks:r,userIsSubscribed:o}=e,a=[],l=d()(_,"key"),s=!1;for(let e of _){let d;if(["spotify","spotify_for_paid_users","spotify_open_access"].includes(e.key)){if(s)continue;let e=function(e){let{showLinks:t,userIsSubscribed:i}=e;return i&&t.spotify_for_paid_users_url?{label:"Spotify",platform:"spotify_for_paid_users",url:t.spotify_for_paid_users_url}:!i&&t.spotify_url?{label:"Spotify",platform:"spotify",url:t.spotify_url}:t.spotify_open_access_url?{label:"Spotify",platform:"spotify",url:t.spotify_open_access_url}:null}({showLinks:r,userIsSubscribed:o});if(e){a.push(e),s=!0;continue}}if(o&&"youtube"!==e.key)d=Z({platform:e.key,feedUrl:t,isApple:i,isMobile:n});else{var c;d=null!==(c=r[e.fieldName])&&void 0!==c?c:Z({platform:e.key,feedUrl:t,isApple:i,isMobile:n})}d&&a.push({label:l[e.key].label,platform:e.key,url:d}),"spotify"===e.key&&r.spotify_open_access_url&&a.push({label:"Spotify",platform:"spotify_open_access",url:r.spotify_open_access_url})}return a},C=e=>{let{feedUrl:t,isApple:i,isMobile:n,render:r,showLinks:o,user:a,analyticsSource:s="shows_episode_page"}=e,p=d()(_,"key");return l()([...w({feedUrl:t,isApple:i,isMobile:n,showLinks:o,userIsSubscribed:!!(null==a?void 0:a.is_subscribed)}).map(e=>{let i="spotify_open_access"===e.platform?"Spotify":p[e.platform].label;return r({key:e.platform,label:i,url:e.url,onClick:()=>{(0,u.j)(u.FP.PODCAST_APP_LINK_CLICK,{appName:i,feedUrl:t,url:e.url,source:s}),n||window.open(e.url,"_blank")}})}),t&&r({key:"rss",label:"RSS Feed",url:t,onClick:()=>{(0,u.j)(u.FP.PODCAST_FEED_URL_COPIED,{feedUrl:t,source:s}),(0,c.ZP)("RSS feed URL copied"),(0,h.vQ)(t)}})])},x={apple_podcasts:["https://podcasts.apple.com/","https://itunes.apple.com/"],overcast:["https://overcast.fm/"],pocket_casts:["https://pca.st/"],spotify:["https://open.spotify.com/"],spotify_for_paid_users:["https://open.spotify.com/"],youtube:["https://youtube.com/","https://www.youtube.com/"],youtube_music:["https://music.youtube.com/"]},S=e=>{let{platform:t,url:i,language:n}=e,{iString:r,iTemplate:o}=I18N.i(n),a=x[t];if(a.every(e=>!i.startsWith(e))){var l;return{isValid:!1,message:o(y(),null!==(l=a[0])&&void 0!==l?l:"undefined")}}return i.length>255?{isValid:!1,message:r("URL can't be longer than 255 characters")}:{isValid:!0,message:null}},k=e=>{let{pub:t,section:i,spotifySettings:n}=e;return B({showLinks:i?i.showLinks:t.show_links,spotifySettings:n})},B=e=>{let{showLinks:t,spotifySettings:i}=e,n={apple_podcasts_url:null,overcast_url:null,pocket_casts_url:null,spotify_url:null,spotify_for_paid_users_url:null,youtube_url:null,youtube_music_url:null,spotify_open_access_url:null};if(i&&(n.spotify_open_access_url=i.spotify_show_url),!t)return n;for(let e of t)n["".concat(e.platform,"_url")]=e.url;return n},T="https://support.substack.com/hc/en-us/articles/4519588148244-How-do-I-listen-to-episodes-on-my-podcast-app-",I="comments-for-scroll",N=e=>{var t,i,n,r;let{post:o,pub:a,user:l}=e,s=o.section_id&&null!==(i=a.sections.find(e=>e.id===o.section_id))&&void 0!==i?i:null;if((0,m.uo)({post:o,section:s,pub:a}))return null;if((null===(t=o.podcastFields)||void 0===t?void 0:t.free_podcast_url)&&!(null==l?void 0:l.is_subscribed))return{url:o.podcastFields.free_podcast_url,type:"free_podcast_url"};if(o.podcastUpload&&o.podcast_url){let e=!!o.podcastUpload.src_media_upload_id||!(0,g.isPaidAudience)(o.audience)||(null==l?void 0:l.is_subscribed)||null!==(r=null===(n=o.videoUpload)||void 0===n?void 0:n.preview_duration)&&void 0!==r&&r,t=(0,g.isPaidAudience)(o.audience)&&!(null==l?void 0:l.is_subscribed);return{url:o.podcast_url,type:t?e?"alternate_audio_preview":"extra_audio_preview":"alternate_full_audio"}}return null},P=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=(null==t?void 0:t.decimals)===1,n=Math.floor(e/3600),r=Math.floor(e%3600/60),o=Math.floor(e%60),a=n?"".concat(n,":").concat(r<10?"0":"").concat(r,":").concat(o<10?"0":"").concat(o):"".concat(r,":").concat(o<10?"0":"").concat(o);if(i){let t=Math.round(e%1*10);return"".concat(a,".").concat(t)}return a}},12988:function(e,t,i){i.d(t,{Hb:()=>o,SQ:()=>a,Ws:()=>l,n3:()=>s});var n=i(75472),r=i.n(n);let o=["portrait","landscape"],a=(e,t)=>{var i,n;let o=null!==(n=null==e?void 0:e.assets)&&void 0!==n?n:[],a=t?o.filter(t):o,l=r()(a,"mediaUpload.created_at","desc");return null==l?void 0:null===(i=l[0])||void 0===i?void 0:i.mediaUpload},l=(e,t)=>{let i;let{showLiveOverlay:n,subtitle:r,aspectRatio:o,pub:a}=null!=t?t:{},l={},s=!1,d=e.width&&e.height?e.width/e.height:1,c=!!e.live_stream_id,u=!(e.live_stream_id&&d>=1);if(e.liveStream){var p,h,m;s=(null!==(h=e.liveStream.joinedOrCompletedLiveStreamInvites)&&void 0!==h?h:[]).length>0,i=null!==(m=null===(p=e.liveStream.user)||void 0===p?void 0:p.handle)&&void 0!==m?m:void 0}return(null==a?void 0:a.author_handle)&&(i=a.author_handle),(c||n)&&(u||(l.legacy_watermark={type:"legacy_watermark",show:!1}),(d<1||["vertical_fill","vertical_fit"].includes(null!=o?o:""))&&(n&&(l.live_overlay={type:"live_overlay",position:s?"bottom":"center",subtitle:r||(i?"@".concat(i):void 0)}),l.captions={type:"captions",position:s?["center","center"]:["center",825]})),l},s=e=>{var t,i;return(null!==(t=null==e?void 0:e.height)&&void 0!==t?t:0)>(null!==(i=null==e?void 0:e.width)&&void 0!==i?i:0)?"portrait":"landscape"}},50364:function(e,t,i){i.d(t,{Hz:()=>a,Zu:()=>o,_N:()=>s,ql:()=>l});var n=i(1835),r=i(26042);let o=9999,a=function(){let{likesEnabled:e=!0,language:t="en"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{iString:i}=I18N.i(t),n=[];return e&&n.push({key:"best_first",text:i("Top first"),description:i("Top comments first")}),n.push({key:"most_recent_first",text:i("Newest first"),description:i("Newest comments first")}),n.push({key:"oldest_first",text:i("Oldest first"),description:i("Oldest comments first")}),n},l={review_required:"review_required",edit_review_required:"edit_review_required",published:"published",flagged:"flagged",deleted:"deleted",moderator_approved:"moderator_approved",moderator_removed:"moderator_removed",new_commenter_approval_required:"new_commenter_approval_required"};function s(e,t){let{attachments:i}=e;if(i&&i.length>0){for(let e of i)if("post"===e.type){for(let i of e.post.publishedBylines)if(i.id===t)return!0;if((0,n.wN)(e.publication,t))return!0}else if("comment"===e.type){if(e.comment.user_id===t)return!0}else if("publication"===e.type&&(0,n.wN)(e.publication,t))return!0}return(function(e){let t=[];if(e.body_json)for(let a of(0,r.Z)(e.body_json)){var i,n,o;"substack_mention"!==a.type||(null===(i=a.attrs)||void 0===i?void 0:i.mentionType)!=="user"&&(null===(n=a.attrs)||void 0===n?void 0:n.mentionType)||t.push(null===(o=a.attrs)||void 0===o?void 0:o.id)}return new Set(t)})(e).has(t)}l.review_required,l.edit_review_required,l.published,l.moderator_approved,l.new_commenter_approval_required},73943:function(e,t,i){i.d(t,{$j:()=>d,WX:()=>s,_s:()=>l,u:()=>a,us:()=>o,vn:()=>n});let n={test1:"SubstackInc",badnews:"ryangrim",dmortberg:"danielortberg",offthechain:"APompliano",on:"SubstackInc",petition:"petition",popularinformation:"JuddLegum",shane:"shanesnow",signalproblems:"A_W_Gordon",sinocism:"niubi",taibbi:"mtaibbi",thefirstand15th:"tressiemcphd",thenewsletter:"jbouie",numlock:"WaltHickey"};var r,o=((r={}).comments_disabled="comments_disabled",r.free_subscription_required="free_subscription_required",r.paid_subscription_required="paid_subscription_required",r.founding_subscription_required="founding_subscription_required",r);let a=600,l=1024,s=608,d=255},19834:function(e,t,i){i.d(t,{Z:()=>o});var n=i(86492),r=i.n(n);function o(e){let{only_non_ascii:t=!1,useNamedReferences:i=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?r().encode(e||"",{useNamedReferences:i,decimal:!0,allowUnsafeSymbols:t}):e}},4953:function(e,t,i){i.d(t,{w:()=>n});function*n(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;for(let n=e;n<t;n+=i)yield n}},24791:function(e,t,i){i.d(t,{A$:()=>a,H$:()=>f,HL:()=>B,LH:()=>P,Os:()=>_,R7:()=>v,SY:()=>y,XV:()=>h,a_:()=>Z,dq:()=>m,i$:()=>T,lf:()=>w,oH:()=>u,po:()=>c,rD:()=>k,sv:()=>g,uo:()=>I,xH:()=>N});var n=i(6070),r=i(51699);i(31582),i(60308),i(63651),i(84864);let o=e=>{var t;return!!(null==e?void 0:e.sections)&&(null===(t=e.sections)||void 0===t?void 0:t.length)>0},a=e=>!!(null==e?void 0:e.podcast_enabled),l=e=>{if(!e)return 0;let t=[];return o(e)&&(t=d(e)),+!!a(e)+t.length},s=e=>!!e&&l(e)>0,d=e=>e&&o(e)?e.sections.filter(e=>e.is_podcast):[],c=e=>!!e&&!!(e.is_free_subscribed&&!e.is_subscribed),u=e=>!!e&&"enabled"===e.payments_state,p=function(e){let{usePreview:t=!1,useDraft:i=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(null==e?void 0:e.type){case"newsletter":return i?e.draftVoiceoverUpload:e.voiceoverUpload;case"podcast":if(t)return i?e.draftPodcastPreviewUpload:e.podcastPreviewUpload;return i?e.draftPodcastUpload:e.podcastUpload;case"video":return i?e.draftVideoUpload:e.videoUpload;default:return null}},h=function(e){let{usePreview:t=!1,useDraft:i=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return null;let n=p(e,{usePreview:t,useDraft:i});if(n){var r;return null!==(r=n.duration)&&void 0!==r?r:null}if((null==e?void 0:e.type)==="podcast"&&!t){let t=i?e.draft_podcast_duration:e.podcast_duration;return null!=t?t:null}return null},m=e=>!!e&&"podcast"===e.type&&!!e.podcastUpload&&!!e.podcastUpload.is_free_preview,g=e=>{var t;let{post:i}=e;return!!i&&!!(null===(t=i.podcastFields)||void 0===t?void 0:t.free_podcast_url)},v=e=>{var t,i;return e.is_www?null!==(i=e.logo_url)&&void 0!==i?i:void 0:e.logo_url||e.cover_photo_url||e.author_photo_url||(null===(t=e.author)||void 0===t?void 0:t.photo_url)},b=e=>{var t;return e&&"plans"in e&&Array.isArray(null==e?void 0:e.plans)&&null!==(t=e.plans.find(e=>(0,r.F)({plan:e})))&&void 0!==t?t:null},y=e=>!!b(e),f=e=>{var t,i;if((0,n.VL)({pub:e}))return"Founders";let r=b(e);return null!==(i=null==r?void 0:null===(t=r.metadata)||void 0===t?void 0:t.short_description)&&void 0!==i?i:null},_=e=>!!e&&!!e.state&&("error"===e.state||"cancelled"===e.state),Z=(e,t)=>(null==t?void 0:t.audience)==="founding"&&f(e)||"paid",w=(e,t)=>!!(e&&t&&s(e))&&!!t.draft_voiceover_upload_id,C=e=>{let{pub:t,url:i}=e;if(!i.includes("api.substack.com"))return null;if(i.includes("/feed/podcast/".concat(t.id,".rss")))return t.podcast_title||t.name;if(i.includes("/feed/podcast/".concat(t.id,"/s/"))){var n,r;let e=null===(r=i.match(RegExp("\\/feed\\/podcast\\/\\d+\\/s\\/(?<sectionId>\\d+)\\.rss")))||void 0===r?void 0:null===(n=r.groups)||void 0===n?void 0:n.sectionId;if(!e)return"Unknown section";let o=t.sections.find(t=>t.id===parseInt(e));return o?o.name:"Unknown Section"}return"another podcast"},x=e=>{if(!e)return{can_syndicate:!1,hover_text:"Cannot find podcast"};if(!e.podcast_enabled)return{can_syndicate:!1,hover_text:"This podcast is not currently enabled."};if(!e.podcast_feed_url)return{can_syndicate:!0,hover_text:null};let t=C({pub:e,url:e.podcast_feed_url});return t?{can_syndicate:!1,hover_text:"This podcast is currently redirecting to ".concat(t,".")}:{can_syndicate:!1,hover_text:"This podcast is currently redirecting to ".concat(e.podcast_feed_url,".")}},S=e=>{var t;let{pub:i,section:n}=e;if(!n.is_podcast)return{can_syndicate:!1,hover_text:"This section is not currently set up as a podcast."};let r=(null===(t=n.podcastSettings)||void 0===t?void 0:t.podcast_feed_url)||null;if(!r)return{can_syndicate:!0,hover_text:null};let o=C({pub:i,url:r});return o?{can_syndicate:!1,hover_text:"This podcast is currently redirecting to ".concat(o,".")}:{can_syndicate:!1,hover_text:"This podcast is currently redirecting to ".concat(r,".")}},k=e=>{var t;let{pub:i}=e,n=[];if(i.podcast_enabled||i.podcast_title){let e=x(i);n.push({name:i.podcast_title||i.name,description:i.podcast_description||"",can_publish_to:e.can_syndicate,hover_text:e.hover_text,publication_id:i.id,section_id:null})}for(let e of null!==(t=i.sections)&&void 0!==t?t:[]){if(!e.is_podcast)continue;let t=S({pub:i,section:e});n.push({name:e.name,description:e.description,can_publish_to:t.can_syndicate,hover_text:t.hover_text,publication_id:i.id,section_id:e.id})}return n},B=e=>{var t,i;return(null!==(t=e.trial_period_days)&&void 0!==t?t:0)>0?"FREE_TRIAL":(null!==(i=e.extra_seats)&&void 0!==i?i:0)>0?"EXTRA_SEATS":"PERCENT_OFF"},T=(e,t)=>o(e)&&["newsletter","thread","podcast","video"].includes(t)?e.sections:null,I=e=>{var t;let{post:i,section:n,pub:r}=e;return!!i.videoUpload&&("video"===i.type||!!(null===(t=i.podcastFields)||void 0===t?void 0:t.hide_from_feed)||!!(!n&&!r.podcast_enabled)||!!(n&&!n.is_podcast))},N=e=>{var t,i,n,r,o;return!!(null==e?void 0:null===(n=e.videoUpload)||void 0===n?void 0:null===(i=n.extractedAudio)||void 0===i?void 0:null===(t=i.transcription)||void 0===t?void 0:t.transcript_url)||!!(null==e?void 0:null===(o=e.podcastUpload)||void 0===o?void 0:null===(r=o.transcription)||void 0===r?void 0:r.transcript_url)},P=e=>{var t,i,n,r,o,a;return null!==(a=null!==(o=null==e?void 0:null===(i=e.videoUpload)||void 0===i?void 0:null===(t=i.extractedAudio)||void 0===t?void 0:t.transcription)&&void 0!==o?o:null==e?void 0:null===(n=e.podcastUpload)||void 0===n?void 0:n.transcription)&&void 0!==a?a:null==e?void 0:null===(r=e.videoUpload)||void 0===r?void 0:r.transcription}},6070:function(e,t,i){i.d(t,{$H:()=>c,HD:()=>s,Iv:()=>Z,VL:()=>a,hx:()=>y,jC:()=>u,kb:()=>l,lp:()=>m,p$:()=>p,rM:()=>_,uT:()=>h});var n=i(39693),r=i.n(n);let o=new Set([0x83c163a,0x82bc701,0x81adcb6,0x8455987,0x8487b09,0x85eb9a5,0x861de49,0x8653d00,0x868d293,0x86f9884,0x872b528,0x8798da8,0x87d48d6,0x8809a67,0x883f640,0x8961657,0x8aedf0b,0x8bc9b46,0x8559743,0x887329b,0x888f704,0x88a9886,0x8910626,0x8999664,0x89d3d02,0x8a084ae,0x8c6f81e,0x8cb3c01,0x8cf2aa9,0x90a54a4,0x9aa80e8]);function a(e){let{pub:t,includeTheRampart:i=!1}=e;return!!t&&(!!i&&1620566===t.id||87281===t.id)}function l(e){let{pub:t}=e;return 228030===t.id}function s(e){let{pub:t}=e;return!!t&&[260347,3116199].includes(t.id)}let d=[/the front page/i,/tgif/i,/things worth remembering/i],c=e=>{let{pub:t}=e;return r()(d.map(e=>t.sections.find(t=>t.name.match(e)))).map(e=>e.id)};function u(e){let{pub:t}=e;return 2325511===t.id}function p(e){let{pub:t}=e;return 2857530===t.id}function h(e){let{pub:t}=e;return 471923===t.id}function m(e){let{post:t}=e;return!!t&&o.has(t.id)&&!!t.podcast_preview_upload_id}let g={87908:"morning-shots",87934:"the-triad",87969:"press-pass",87950:"overtime",87957:"bulwark-podcast",87956:"screen-time",87963:"the-next-level",104848:"george-conway-explains-it-all",87971:"the-focus-group",87958:"beg-to-differ",87975:"movie-aisle",87961:"the-secret-podcast",87964:"between-us",87978:"thursday-night-bulwark",135716:"the-michael-steele-podcast",111316:"shield-of-the-republic"},v={62624:"morning-shots",62631:"the-triad",62634:"overtime",62636:"press-pass",62639:"bulwark-podcast",62641:"beg-to-differ",62642:"the-secret-podcast",62644:"the-next-level",62645:"movie-aisle",62646:"between-us",62647:"the-focus-group",62648:"thursday-night-bulwark"},b=new Set(["beg-to-differ","between-us","bulwark-podcast","george-conway-explains-it-all","the-focus-group","the-next-level","the-secret-podcast","thursday-night-bulwark","the-michael-steele-podcast"]),y=e=>{let{sectionId:t}=e;return!!t&&(b.has(g[t])||b.has(v[t]))},f=new Set(["bulwark-podcast","the-focus-group","beg-to-differ","george-conway-explains-it-all","the-next-level","the-michael-steele-podcast","shield-of-the-republic"]),_=e=>{let{sectionId:t}=e;return t&&(f.has(g[t])||f.has(v[t]))?["audio","video"]:["audio"]},Z=e=>{let{user:t}=e;return t.is_founding?"/account/gifts/founding":"/subscribe?gift=true"}},86458:function(e,t,i){i.d(t,{JK:()=>a});var n=i(84864);let r={gbp:{month:3.5,year:20,founding:20},inr:{month:50,year:300,founding:300}},o={month:5,year:50,founding:50},a=e=>{let{value:t,interval:i,is_founding:a,currency:s}=e,d=(r[s.toLowerCase()]||o)[a?"founding":i];return t<d?"".concat((0,n.toTitleCase)(i),"ly plan price must be at least ").concat(l(d,s)):t>0x5f5e0ff?"".concat((0,n.toTitleCase)(i),"ly").concat(e.is_founding?" founding":""," plan price must be less than ").concat(l(0x5f5e0ff,s)):null},l=(e,t)=>(0,n.centsToPriceString)(e*((0,n.isZeroDecimalCurrency)(t)?1:100),t)},31377:function(e,t,i){i.r(t),i.d(t,{getAllAudiences:()=>c,getAudiencesForPublicListing:()=>u,getCommentAuthor:()=>k,getCoverImageUrl:()=>B,getDurationForPostPreview:()=>I,getFoundingAudiences:()=>h,getFreePodcastUrl:()=>T,getPaidAudiences:()=>p,getPostAuthor:()=>S,isFoundingAudience:()=>g,isPaidAudience:()=>m,isSubscriptionLevel:()=>v,previewSubHasFullAccessToPost:()=>x,pubRoleHasFullAccessToPost:()=>w,pubRolesHaveFullAccessToPost:()=>C,subHasFullAccessToPost:()=>_,subHasFullAccessToPostAudience:()=>Z,userHasFullAccessToPost:()=>y});var n=i(7409),r=i(98848);let o=["founding","only_paid","everyone","only_free"],a=["founding","only_paid","everyone"],l=["founding","only_paid"],s=["founding"],d=["free","paid","founding"];function c(){return[...o]}function u(){return[...a]}function p(){return[...l]}function h(){return[...s]}function m(e){return p().includes(e)}function g(e){return h().includes(e)}function v(e){return d.map(String).includes(e)}function b(e){switch(e){case"founding":return["founding"];case"only_paid":return["paid","founding"];case"only_free":return["free"];case"everyone":return["free","paid","founding"];default:throw Error("Unknown audience: ".concat(e))}}function y(e,t){if(!t)return!1;if(!t.audience)throw Error("Post has no audience");if(e&&e.is_contributor&&e.subscription_publication_id===t.publication_id)return!0;let i=function(e,t){if(!t||(null==e?void 0:e.subscription_publication_id)===t){if((null==e?void 0:e.is_founding)||(null==e?void 0:e.is_contributor))return"founding";if(null==e?void 0:e.is_subscribed)return"paid"}return"free"}(e,t.publication_id);return b(t.audience).includes(i)}function f(e,t){if(!t||(null==e?void 0:e.publication_id)===t){if((null==e?void 0:e.membership_state)==="subscribed"&&(null==e?void 0:e.is_founding))return"founding";if((null==e?void 0:e.membership_state)==="subscribed")return"paid"}return"free"}function _(e,t){if(!t)return!1;if(!t.audience)throw Error("Post has no audience");let i=f(e,t.publication_id);return b(t.audience).includes(i)}function Z(e,t){let i=f(e);return b(t).includes(i)}function w(e,t){if(!t)return!1;if(!t.audience)throw Error("Post has no audience");let i=(null==e?void 0:e.role)==="admin"||(null==e?void 0:e.role)==="contributor"||(null==e?void 0:e.membership_state)==="subscribed"&&(null==e?void 0:e.is_founding)?"founding":(null==e?void 0:e.membership_state)==="subscribed"?"paid":"free";return b(t.audience).includes(i)}function C(e,t){return!!(t&&w(null==e?void 0:e[t.publication_id],t))}function x(e,t,i){let{audienceOverride:n}=i;if(!t)return!1;if(!t.audience&&!n)throw Error("Post has no audience");return b(null!=n?n:t.audience).includes(e)}function S(e,t){var i;let o=null==t?void 0:null===(i=t.publishedBylines)||void 0===i?void 0:i[0];if(o)return o;let a=e.contributors.find(e=>e.owner);if(a){let{user_id:e}=a,t=(0,r._)(a,["user_id"]);return(0,n._)({id:e},t)}let l=e.contributors.find(e=>["admin","contributor"].includes(e.role));if(l){let{user_id:e}=l,t=(0,r._)(l,["user_id"]);return(0,n._)({id:e},t)}return{id:e.author_id,name:e.author_name,photo_url:e.author_photo_url,bio:e.author_bio}}function k(e){var t,i,n,r,o,a,l,s,d,c,u,p,h,m,g;return{id:null!==(s=null!==(l=null===(t=e.user)||void 0===t?void 0:t.id)&&void 0!==l?l:e.user_id)&&void 0!==s?s:-1,name:null!==(c=null!==(d=null===(i=e.user)||void 0===i?void 0:i.name)&&void 0!==d?d:e.name)&&void 0!==c?c:"",handle:null!==(u=null===(n=e.user)||void 0===n?void 0:n.handle)&&void 0!==u?u:e.handle,photo_url:null!==(p=null===(r=e.user)||void 0===r?void 0:r.photo_url)&&void 0!==p?p:e.photo_url,bestseller_tier:null!==(m=null!==(h=null===(o=e.user)||void 0===o?void 0:o.bestseller_tier)&&void 0!==h?h:e.user_bestseller_tier)&&void 0!==m?m:null,primary_publication:null!==(g=null===(a=e.user)||void 0===a?void 0:a.primary_publication)&&void 0!==g?g:e.user_primary_publication}}function B(e){return!e.cover_image||/12634ced-0eb6-4238-a94a-70ab242c5ad8/.test(e.cover_image)||/fa15c776-f514-42fe-8ee0-4c94148a0a8a/.test(e.cover_image)||/8826edac-0d50-4ba0-b861-f3ed9336878b/.test(e.cover_image)||/49be2356-6491-4a6f-84a5-15e99d23b6d1/.test(e.cover_image)?null:e.cover_image}function T(e){var t,i;let{post:n}=e;return null!==(i=null===(t=n.podcastFields)||void 0===t?void 0:t.free_podcast_url)&&void 0!==i?i:null}function I(e){var t,i,n,r,o,a,l,s;let{post:d}=e;return null!==(s=null!==(l=null!==(a=null!==(o=null===(t=d.videoUpload)||void 0===t?void 0:t.duration)&&void 0!==o?o:null===(n=d.podcastUpload)||void 0===n?void 0:null===(i=n.full_podcast_info)||void 0===i?void 0:i.duration)&&void 0!==a?a:null===(r=d.podcastUpload)||void 0===r?void 0:r.duration)&&void 0!==l?l:d.podcast_duration)&&void 0!==s?s:0}},1835:function(e,t,i){i.d(t,{FV:()=>h,Gm:()=>m,Im:()=>d,Kw:()=>p,ab:()=>c,wN:()=>u});var n=i(39693),r=i.n(n),o=i(98012),a=i(60308),l=i(84864);let s=function(e){let t=e.trim();return(0,l.endsWithPunctuation)(t)?t:"".concat(t,".")},d=function(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!(null==e?void 0:e.length)||!(null===(t=e[0])||void 0===t?void 0:t.owner))return null;let n=e[0].name;if(1===e.length)return{owner:n,others:null};let r=e.slice(1);if(r.length>i&&(r=r.filter(e=>"admin"===e.role)),r.length&&r.length<=i){let e=r.map(e=>e.name);return{owner:n,others:(0,l.oxfordComma)(e).toString()}}return{owner:n,others:null}},c=function(e,t,i,n,r){let o,a;let l=e?s(e):"";return o=t&&!t.others?n.toLowerCase().includes(t.owner.toLowerCase())?"":" by ".concat(t.owner,","):"",a=i?" a Substack publication with ".concat(i,"."):r?" a Substack publication. ".concat(r,"."):" a Substack publication.",s("".concat(l," Click to read ").concat(n,",").concat(o).concat(a))};function u(e,t){if(e){if(e.author_id===t)return!0;for(let i of e.contributors)if(i.user_id===t)return!0}return!1}function p(e){return e.is_author||e.is_global_admin}let h=e=>{let t=e.podcast_enabled?{title:e.podcast_title,subtitle:e.podcast_description,podcast_art_url:e.podcast_art_url,url:(0,a.UVC)({pub:e,section:null}),section_id:null}:null,i=e.sections.filter(e=>e.is_podcast).map(t=>{var i,n;return{title:t.name,subtitle:null===(i=t.podcastSettings)||void 0===i?void 0:i.podcast_description,podcast_art_url:null===(n=t.podcastSettings)||void 0===n?void 0:n.podcast_art_url,url:(0,a.UVC)({pub:e,section:t}),section_id:t.id}});return r()([t,...i])};function m(e){var t,i;let n=null===(t=e.plans)||void 0===t?void 0:t.find(e=>"month"===e.interval);return!!n&&!e.invite_only&&["newspaper","magaziney"].includes(null!==(i=e.homepage_type)&&void 0!==i?i:"")&&"enabled"===e.payments_state&&e.first_enabled_payments_at&&(0,o.Z)().diff((0,o.Z)(e.first_enabled_payments_at),"days")>=25&&e.stripe_country&&["AU","CA","US"].includes(e.stripe_country)&&null!==n.amount&&n.amount<=1200}},20521:function(e,t,i){i.d(t,{k:()=>a,x:()=>o});var n=i(98012);function r(e){var t;let i=[e.is_primary,(null===(t=e.publication)||void 0===t?void 0:t.author_id)===e.user_id,"admin"===e.role,"contributor"===e.role].map(e=>e?"0":"1").join("");return"".concat(i,"-").concat((0,n.Z)(e.created_at).valueOf())}function o(e){return e.slice(0).sort((e,t)=>r(e)>r(t)?1:-1)}function a(e){let{ineligibilityReasons:t,isSelfOrGlobalAdmin:i}=e,n=!0;for(let e of t)switch(e){case"not_member_of_pub":return!1;case"not_primary_pub":case"primary_user_of_other_pub":n=n&&i}return n}},31582:function(e,t,i){i.d(t,{P$:()=>l,uG:()=>a});var n=i(18029),r=i.n(n),o=i(98012);i(84864);let a=(e,t)=>"open"===e&&(0,o.Z)(t).isBeforeNow()?"Overdue":"open"===e?"Unpaid":r()(e),l=(e,t)=>{let{language:i}=t,{iString:n}=I18N.i(null!=i?i:"en");switch(e){case"active":return n("Active");case"canceled":return n("Canceled");case"incomplete":return n("Incomplete");case"incomplete_expired":return n("Incomplete Expired");case"past_due":return n("Past Due");case"trialing":return n("Trialing");case"unpaid":return n("Unpaid");default:return r()(e)}}},6163:function(e,t,i){i.d(t,{hd:()=>a});var n=i(7409);i(49762),i(98012);var r=i(60308);i(84864);var o=i(47929);function a(e){let{name:t,url:i,description:a,potentialAction:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return void 0===l&&(l={"@type":"SearchAction",name:"Search ".concat(e.name),target:"".concat(e.base_url).concat((0,r.nxG)(e),"?utm_source=").concat(o.b3.google,"&sort=search&search={search_term_string}"),"query-input":"required name=search_term_string"}),{"@context":"https://schema.org","@type":"WebSite",name:t||e.name,publisher:(0,n._)({"@type":"Organization",name:e.name,url:e.base_url},e.logo_url?{logo:{"@type":"ImageObject",url:e.logo_url}}:{},e.twitter_screen_name?{sameAs:["https://twitter.com/".concat(e.twitter_screen_name)]}:{}),url:i||e.base_url,mainEntityOfPage:{"@type":"WebPage",url:i||e.base_url},description:a||e.hero_text,potentialAction:l}}},62841:function(e,t,i){i.d(t,{Fl:()=>y,IW:()=>s,Kf:()=>m,Qj:()=>p,b8:()=>u,di:()=>h,eP:()=>v,jU:()=>c,ne:()=>b,zM:()=>l});var n=i(7409),r=i(99282),o=i(30396),a=i(95441);let l={newspaper:{id:"newspaper",legacyEquivalent:"newspaper",postCount:{desktop:1,tablet:1,mobile:1}},magaziney:{id:"magaziney",legacyEquivalent:"magaziney",postCount:{desktop:3,tablet:3,mobile:3}},"magazine-5":{id:"magazine-5",legacyEquivalent:"magaziney",postCount:{desktop:5,tablet:3,mobile:5}},"feature-media":{id:"feature-media",legacyEquivalent:"newspaper",postCount:{desktop:1,tablet:1,mobile:1}},feature:{id:"feature",legacyEquivalent:"magaziney",postCount:{desktop:5,tablet:5,mobile:5}},podcast:{id:"podcast",legacyEquivalent:"newspaper",postCount:{desktop:0,tablet:0,mobile:0}}},s=()=>{let{iString:e}=(0,a.M1)();return(0,o.Ye)(()=>{let t={newspaper:{label:e("Feature"),description:e("One featured post")},magaziney:{label:e("Newspaper"),description:e("A side column of top posts")},"magazine-5":{label:e("Magazine"),description:e("Five featured posts")},feature:{label:e("Highlight"),description:e("A large post with three smaller posts")},"feature-media":{label:e("Media Feature"),description:e("A large media feature")},podcast:{label:e("Podcast"),description:e("Highlight your podcast")}};return Object.fromEntries(Object.keys(l).map(e=>[e,(0,n._)({},l[e],t[e])]))},[e])},d=["list","grid","grid-groups","custom"],c=()=>{let{iString:e}=(0,a.M1)();return{list:{id:"list",label:e("List"),description:e("A list of posts"),postCount:{desktop:7,tablet:7,mobile:7}},grid:{id:"grid",label:e("Grid"),description:e("A grid of nine posts"),postCount:{desktop:9,tablet:9,mobile:7}},"grid-groups":{id:"grid-groups",label:e("Groups (sections or tags)"),description:e("A grid of nine posts, grouped by section or tag"),postCount:{desktop:9,tablet:9,mobile:7}},custom:{id:"custom",label:e("Custom"),description:e("Custom layout"),postCount:{desktop:0,tablet:0,mobile:0}}}},u=()=>{let e=c();return d.reduce((t,i)=>(0,r._)((0,n._)({},t),{[i]:e[i].postCount}),{})},p={subscribe:{id:"subscribe",label:"Subscribe"},recommendations:{id:"recommendations",label:"Recommendations"},links:{id:"links",label:"Links"},contributors:{id:"contributors",label:"Contributors"},newsletters:{id:"newsletters",label:"Newsletters"},podcasts:{id:"podcasts",label:"Podcasts"},"top-posts":{id:"top-posts",label:"Top posts"}},h={posts:{min:3,default:6,max:7},rows:{min:1,default:2,max:4}},m=e=>{let t=!1,i=[],o={},a=new Set,l=new Set,s=0;return 0===e.length&&(t=!0,i.push("You must have at least one content block")),e.forEach(e=>{let i=g(e);"latest"===i&&(s+=v({contentBlock:e}))>16&&(t=!0,o[e.id]=(0,r._)((0,n._)({},o[e.id]),{post_source:["You can't have more than ".concat(16," of your most recent posts")]})),"latest"!==i&&"none"!==i&&(a.has(i)?(t=!0,o[e.id]=(0,r._)((0,n._)({},o[e.id]),{post_source:["You can't use the same post source more than once"]})):a.add(i)),"none"===i&&"subscribe"!==e.block_type&&(t=!0,o[e.id]=(0,r._)((0,n._)({},o[e.id]),{post_source:["This block type requires a post source"]})),e.primary_sidebar_modules.forEach(i=>{l.has(i)?(t=!0,o[e.id]=(0,r._)((0,n._)({},o[e.id]),{primary_sidebar_modules:["You can't use the same module more than once"]})):l.add(i)}),e.secondary_sidebar_modules.forEach(i=>{l.has(i)?(t=!0,o[e.id]=(0,r._)((0,n._)({},o[e.id]),{secondary_sidebar_modules:["You can't use the same module more than once"]})):l.add(i)}),"grid"===e.block_type&&4===e.num_rows&&0===e.primary_sidebar_modules.length&&0===e.secondary_sidebar_modules.length&&(t=!0,o[e.id]=(0,r._)((0,n._)({},o[e.id]),{num_rows:["Too many rows for this content block"]}))}),{hasError:t,errorObject:{global:i.length?i:null,contentBlocks:o}}},g=e=>"tag"===e.post_source?"tag:".concat(e.post_tag_id):"section"===e.post_source?"section:".concat(e.section_id):e.post_source,v=e=>{let{contentBlock:t,breakpoint:i="desktop",isTheFP:n}=e;if("list"===t.block_type)return t.num_posts||h.posts.default;if("grid"===t.block_type){let e=t.num_rows||h.rows.default;if("desktop"===i||"mobile"===i){let i=4;return t.primary_sidebar_modules.length>0&&(i-=1),t.secondary_sidebar_modules.length>0&&(i-=1),i*e}if("tablet"===i){let i=3;return(t.primary_sidebar_modules.length>0||t.secondary_sidebar_modules.length>0)&&(i-=1),i*e}}if("feature"===t.block_type){if(n){var r;return t.attrs.feature&&(null===(r=t.attrs.feature)||void 0===r?void 0:r.variant)!=="special-feature"?5:8}return 5}return"podcast_plus_three"===t.block_type?4:"single_post"===t.block_type?1:"half_feature"===t.block_type?"tablet"===i?3:4:0},b=e=>{let{contentBlocks:t,breakpoint:i,isTheFP:n,recentPosts:r,postsBySectionId:o,postsByTagId:a,postsForContentBlockPins:l}=e,s={},d=0;for(let e of t){var c,u,p;let t=[];if("latest"===e.post_source){let o=v({contentBlock:e,breakpoint:i,isTheFP:n});t=r.slice(d,d+o),d+=o}else"section"===e.post_source&&e.section_id?t=null!==(c=o[e.section_id])&&void 0!==c?c:[]:"tag"===e.post_source&&e.post_tag_id&&(t=null!==(u=a[e.post_tag_id])&&void 0!==u?u:[]);let{posts:h,numPostsDisplaced:m}=y({posts:t,contentBlockPins:null!==(p=e.contentBlockPins)&&void 0!==p?p:[],pinnedPosts:l});d-=m,s[e.id]={posts:h,postsWithoutPins:t}}return s},y=e=>{let{posts:t,contentBlockPins:i,pinnedPosts:n}=e,r=[...t],o=0;if(!i||0===i.length)return{posts:r,numPostsDisplaced:o};for(let e of i.sort((e,t)=>e.position-t.position)){let i=n[e.post_id];if(!i)continue;let a=r.findIndex(e=>e.id===i.id);-1===a?(r.splice(e.position,0,i),r=r.slice(0,t.length),o+=1):(r.splice(a,1),r.splice(e.position,0,i))}return{posts:r,numPostsDisplaced:o}}},61468:function(e,t,i){i.d(t,{$h:()=>h,Ap:()=>c,Vu:()=>g,kF:()=>u,ob:()=>m});var n=i(7409),r=i(99282);i(56303);var o=i(14293),a=i.n(o),l=i(84864);let s=[{regex:/\((\d{2}):(\d{2}):(\d{2})\):/,parse:e=>3600*parseInt(e[1])+60*parseInt(e[2])+parseInt(e[3])},{regex:/\((\d{2}):(\d{2})\):/,parse:e=>60*parseInt(e[1])+parseInt(e[2])},{regex:/\((\d{2}:\d{2}\.\d{1,3})\)/,parse:e=>{let[t,i]=e[1]?e[1].split(":").map(parseFloat):[0,0];return 60*t+i}}],d=[{regex:/^(.*?[\w\sâ€™â€˜,.'-]*)\s\(\d{2}:\d{2}:\d{2}\):/,parse:e=>e[1]},{regex:/^(.*?[\w\sâ€™â€˜,.'-]*)\s\(\d{2}:\d{2}\):/,parse:e=>e[1]},{regex:/^(.*?[\w\sâ€™â€˜,.'-]*)\s*\(\d{2}:\d{2}\.\d{1,3}\)$/,parse:e=>e[1]}],c=e=>{let{rows:t,maxWordsPerRow:i=60}=e;if(a()(t[0]))return[];let o=[],l=(0,r._)((0,n._)({},t[0]),{words:t[0].words.map(e=>(0,r._)((0,n._)({},e),{originalIndex:0}))});for(let e=1;e<t.length;e++){let a=t[e];if(!a)continue;let s=(0,r._)((0,n._)({},a),{words:a.words.map(t=>(0,r._)((0,n._)({},t),{originalIndex:e}))});l.speaker===s.speaker&&l.words.length+s.words.length<=i?l={start:l.start,end:s.end,text:"".concat(l.text," ").concat(s.text),words:l.words.concat(...s.words),speaker:l.speaker}:(o.push(l),l=s)}return o.push(l),o},u=(e,t)=>{let i=e.split("\n"),o=[],a="",l="",c=0,u=0,p=new Set,h={},m=0;return i.forEach((e,n)=>{var r,g;let v=null!==(r=s.find(t=>!!e.match(t.regex)))&&void 0!==r?r:null,b=null!==(g=d.find(t=>!!e.match(t.regex)))&&void 0!==g?g:null,y=e.trim();if(v){let t=e.match(v.regex);t&&(u=v.parse(t),l&&(o.push({speaker:h[a],start:c,end:u,text:l.trim(),words:[]}),l=""),c=u,y=y.replace(v.regex,""))}if(b){let t=e.match(b.regex);t&&(a=b.parse(t),p.has(a)||(p.add(a),h[a]="SPEAKER_".concat(m++)),l+="".concat(y.substring(a.length)," "))}else""!==y.trim()&&(l+="".concat(y," "));n===i.length-1&&l&&o.push({speaker:h[a],start:c,end:t,text:l.trim(),words:[]})}),[{segments:o},Object.entries(h).reduce((e,t)=>(0,r._)((0,n._)({},e),{[t[1]]:t[0]}),{})]};function p(e){let[t,i,n]=e.split(":").map(parseFloat);return 3600*t+60*i+n}let h=e=>{let t=e.split("\n").map(e=>e.trim()),i=[],o=new Set,l={},s=0;for(let e=0;e<t.length;e++){let n=t[e];if(a()(n))continue;let r=n.trim();if(r.includes("--\x3e")){let n=r.split(" --\x3e ").map(e=>e.trim()),d=p(n[0]),c=p(n[1]);e++;let u=[],h="";for(;e<t.length&&!a()(t[e])&&""!==t[e].trim();){let i=t[e].trim();if(i.startsWith("<v ")){let e=i.match(/<v\s+([^>]+)>/);if(e&&e[1]){h=e[1].trim(),o.has(h)||(o.add(h),l[h]="SPEAKER_".concat(s++));let t=i.indexOf(">")+1;t<i.length&&u.push(i.substring(t).trim())}}else u.push(i);e++}i.push({speaker:l[h],start:d,end:c,text:u.join(" ").trim(),words:[]})}}return[{segments:i},Object.entries(l).reduce((e,t)=>(0,r._)((0,n._)({},e),{[t[1]]:t[0]}),{})]},m=e=>e?e.segments.some(e=>!e.text)?"Segment text is missing":e.segments.some(e=>a()(e.end)||a()(e.start))?"Segment start or end time is missing":null:"Transcription is missing",g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=[];return e.forEach(e=>{var n;let r=t[null!==(n=e.speaker)&&void 0!==n?n:""],o="(".concat((0,l.secondsToHHMMSS)(e.start,{strict:!0}),"):\n").concat(e.text.trim(),"\n");r?i.push("".concat(r," ").concat(o)):i.push(o)}),i.join("\n")}},63651:function(e,t,i){i.d(t,{AKp:()=>q,ANx:()=>p.AN,Am1:()=>ek,BMD:()=>R,Bdn:()=>k,BhD:()=>es,Cnj:()=>eb,E2n:()=>d.E2,F6J:()=>j,FA:()=>I,FKc:()=>eB,FoX:()=>s.Fo,GR3:()=>m.GR,GTk:()=>eC,HQ2:()=>J,HQ5:()=>X,Hs2:()=>_,ISD:()=>en,IYm:()=>d.IY,Iww:()=>U,JDA:()=>s.JD,JlE:()=>ey,L4R:()=>s.L4,MiE:()=>eg,Mk9:()=>O,MoQ:()=>p.Mo,NJv:()=>m.NJ,NNq:()=>m.NN,Nhr:()=>m.Nh,Oz:()=>ee,QHt:()=>F,QK7:()=>S,QXp:()=>d.QX,RKj:()=>$,SUl:()=>eo,SVA:()=>s.SV,Sgq:()=>d.Sg,SjL:()=>el,T91:()=>s.T9,TKM:()=>d.TK,UDR:()=>P,UH4:()=>u.UH,Ucy:()=>et,UdV:()=>ex,VQu:()=>em,VSz:()=>w,W1P:()=>g,XAP:()=>ev,Y$Q:()=>s.Y$,Y3R:()=>ew,ZJn:()=>s.ZJ,ZVW:()=>M,ZXb:()=>s.ZX,_5K:()=>A,_IO:()=>m._I,_No:()=>p._N,a8l:()=>W,b1P:()=>y,bHR:()=>N,by7:()=>H,bzh:()=>eh,chL:()=>Q,ciB:()=>T,cwg:()=>ed,e83:()=>K,en2:()=>L,f3V:()=>eS,fQy:()=>ec,gKm:()=>ef,gpq:()=>z,h8g:()=>ep,hYg:()=>G,j8T:()=>eu,jeD:()=>ei,jnY:()=>p.jn,lsD:()=>D,lsY:()=>e_,mGw:()=>p.mG,mx9:()=>d.mx,n1t:()=>s.n1,o4O:()=>Y,pvz:()=>s.pv,qUD:()=>er,qvS:()=>m.qv,rCb:()=>x,rcW:()=>d.rc,sR2:()=>Z,szv:()=>B,thY:()=>E,uRy:()=>p.uR,wI3:()=>C,wsn:()=>p.ws,xC8:()=>b,xdn:()=>f,yRy:()=>v,zF4:()=>u.zF,zJH:()=>u.zJ});var n=i(7409),r=i(99282),o=i(60826),a=i(6070),l=i(40121),s=i(14773),d=i(33884),c=i(26111),u=i(17043),p=i(60836),h=i(84864),m=i(36186);function g(e){let{root:t,user:i,addBase:n,skipToken:r=!1,doNotAutoSubmit:o=!1,params:a={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t?/[&?]$/.test(t)||(t.includes("?")||t.endsWith("%%")?t+="&":t+="?"):t=n?"".concat((0,s.SV)(e),"/subscribe?"):"/subscribe?",null==i?void 0:i.email)a.autoSubmit=!o,a.email=null==i?void 0:i.email;else if(!a.token&&!r){var l;let e="undefined"!=typeof window&&(null===(l=window._preloads)||void 0===l?void 0:l.original_url)?(0,c.x)(window._preloads.original_url,"token"):null;a.token=e}return t+(0,s.Y$)(a)}function v(e){var t,i;let{pub:r,user:o,params:l}=e;return g(r,{addBase:!0,user:o,params:(0,n._)({},l,(0,a.VL)({pub:r})?{plan:"yearly300usd",upgrade_to_founding:!0}:{selectedPlanId:null===(i=r.plans)||void 0===i?void 0:null===(t=i.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===t?void 0:t.id})})}function b(e){let{pubId:t,postId:i,commentId:n,params:r,noBase:o}=e,a=o?"":(0,s.ZJ)();return(0,s.n1)("".concat(a,"/chat").concat(t?"/".concat(t):"").concat(i?"/post/".concat(i):"").concat(n?"/reply/".concat(n):""),r)}function y(e){let{pub:t,params:i}=e;return(0,s.n1)("".concat((0,s.ZX)(),"/send-reader-gifts/").concat(t.id),i)}function f(e){let{pub:t,params:i}=e;return(0,s.n1)("".concat((0,s.SV)(t),"/account/gifts"),i)}function _(e){let{giftId:t,token:i,params:r}=e;return(0,s.n1)("".concat((0,s.ZX)(),"/accept-gift/").concat(t),(0,n._)({token:i},r))}function Z(e){let{pub:t}=e;return(0,s.n1)("".concat((0,s.SV)(t),"/account"),{extra_seats:!0})}function w(e){let{addBase:t,baseUrlOptions:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t?(0,s.SV)(e,i):"";return"".concat(n,"/publish")}function C(e){let{addBase:t=!1,baseUrlOptions:i={},section:n="",params:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=(0,s.n1)("".concat(w(e,{addBase:t,baseUrlOptions:i}),"/settings"),r);return n&&(o+="#".concat(n)),o}function x(e){let{addBase:t=!1,baseUrlOptions:i={},params:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.n1)("".concat(w(e,{addBase:t,baseUrlOptions:i}),"/groups"),n)}function S(e){let{addBase:t,params:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t?(0,s.SV)(e):"",r="".concat(n,"/publish/home");return i?(0,s.n1)(r,i):r}function k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"published",{addBase:i,params:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i?(0,s.SV)(e):"",o="".concat(r,"/publish/posts/").concat(t);return n?(0,s.n1)(o,n):o}function B(e){let{addBase:t,params:i,referrer:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t?(0,s.SV)(e):"",l="".concat(a,"/meetings"),d=(0,r._)((0,n._)({},i),{referrer:o});return i||o?(0,s.n1)(l,d):l}function T(e){let{addBase:t,params:i,filter:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t?(0,s.SV)(e):"",o="".concat(r,"/publish/meetings/").concat(null!=n?n:"upcoming");return i?(0,s.n1)(o,i):o}function I(e){let{user_id:t,user_name:i,utm_source:n,utm_campaign:r,redirect:o}=e,a="".concat((0,s.ZX)(),"/users/").concat(t),d=(0,l.Hm)(i,{hashIfEmpty:!0});return d&&(a+="-".concat(d)),(0,s.n1)(a,{utm_source:n,utm_campaign:r,redirect:o})}function N(e){let{liveStreamId:t,utm_source:i,utm_campaign:r,params:o}=e;return(0,s.n1)("".concat((0,s.ZX)(),"/live-stream/").concat(t),(0,n._)({utm_source:i,utm_campaign:r},o))}function P(e){let{liveStreamId:t,utm_source:i,utm_campaign:r,noBase:o,params:a}=e,l=o?"":(0,s.SV)();return(0,s.n1)("".concat(l,"/live-stream/").concat(t),(0,n._)({utm_source:i,utm_campaign:r},a))}function E(e){let{pub:t,utm_source:i,utm_campaign:n}=e;return(0,s.n1)("".concat((0,s.SV)(t),"/livestream"),{utm_source:i,utm_campaign:n})}function X(e){let{subdomain:t,utm_source:i,utm_campaign:n,redirect:r}=e;return(0,s.n1)("".concat((0,s.ZX)(),"/pub/").concat(t),{utm_source:i,utm_campaign:n,redirect:r})}function M(e){let{pubKey:t,utm_source:i,utm_campaign:n,r,redirect:o,modal:a}=e;return(0,s.n1)("".concat((0,s.ZX)(),"/pub/").concat(t,"/chat"),{utm_source:i,utm_campaign:n,redirect:o,modal:a,r})}function A(e){let{postId:t,targetReplyId:i,utm_source:n,utm_campaign:r,showTarget:o,redirect:a,modal:l}=e;return(0,s.n1)("".concat((0,s.ZX)(),"/chat/posts/").concat(t),{target_reply_id:i,utm_source:n,utm_campaign:r,showTarget:o,redirect:a,modal:l})}function D(e){let{commentId:t,targetReplyId:i,utm_source:n,utm_campaign:r,showTarget:o,redirect:a,modal:l}=e;return(0,s.n1)("".concat((0,s.ZX)(),"/chat/replies/").concat(t),{target_reply_id:i,showTarget:o,utm_source:n,utm_campaign:r,redirect:a,modal:l})}function R(e){let{urlParams:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,d.Sg)(e,{baseUrl:(0,s.ZX)(),urlParams:t})}function F(e){let{pub:t,params:i,section:n}=e;return n?(0,s.n1)("".concat((0,s.SV)(t),"/listen/").concat(n.slug,"/archive"),i):(0,s.n1)("".concat((0,s.SV)(t),"/podcast/archive"),i)}function L(e){let t=e.trim();if(/\s/.test(t))return null;try{let e=new URL(t);if(!["http:","https:"].includes(e.protocol))return null;return e}catch(e){return null}}let z=(e,t,i,n)=>{switch(e){case"user":default:return I({user_id:t,user_name:i,utm_source:"mentions"});case"pub":return n?(0,s.n1)(n,{utm_source:"mentions"}):""}};function O(e,t){let{addBase:i=!1,query:n={}}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,s.n1)("".concat(i?(0,s.SV)(e):"","/t/").concat(t.slug),n)}let U=e=>{let{section:t}=e;return"/publish/settings/new_podcast/".concat(t.id)},Y=e=>{let{section:t}=e;return t?"/publish/import/podcast/".concat(t.id):""},H=e=>{let{pub:t,addBase:i}=e,n=i?(0,s.SV)(t):"";return"".concat(n,"/publish/settings/podcast/edit")},j=e=>{let{pub:t,section:i,addBase:n,referrer:r}=e;if(!i)return console.error("section is missing when passed to getEditSectionPodcastUrl"),"";let o=n?(0,s.SV)(t):"";return"".concat(o,"/publish/settings/podcast/").concat(i.id).concat(r?"?referrer=".concat(r):"")};function J(e){let{pub:t,section:i}=e,n=(0,s.SV)(t),r="".concat(n,"/publish/settings/podcast");return i?"".concat(r,"/").concat(i.id):"".concat(r,"/edit")}let V="https://dashboard.stripe.com",q=e=>"".concat(V,"/").concat(e.stripe_user_id),W=(e,t)=>"".concat(V,"/").concat(e.stripe_user_id,"/prices/").concat(t),G=(e,t)=>"".concat(V,"/").concat(e.stripe_user_id,"/invoices/").concat(t);function K(e){return!!e&&e.startsWith("https://images.unsplash.com/")}function Q(e){if(e){if(e.startsWith(s.L4)||e.startsWith("https://res.cloudinary.com")||e.startsWith("https://bucketeer"))return!0;let t="https://".concat((0,h.getPostMediaBucketName)(),".s3.amazonaws.com");if(e.startsWith(t))return!0}return!1}function $(e){let t;if(!e)return!1;try{t=new URL(e)}catch(e){return!1}let{hostname:i,pathname:n}=t;return!!i.startsWith("open.substack.com")&&n.startsWith("/pub/")&&n.includes("/p/")}function ee(e,t){var i,n;let{addBase:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.section?et(e,{addBase:r,section:t.section}):t.post?(0,p.uR)(e,t.post,{noBase:!r}):t.postTag?O(e,t.postTag,{addBase:r}):r&&/^\/[^/]/.test(null!==(i=t.link_url)&&void 0!==i?i:"")?"".concat((0,s.SV)(e)).concat(t.link_url):null!==(n=t.link_url)&&void 0!==n?n:""}function et(e){let{addBase:t,section:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(i=i||(null==e?void 0:e.section)))throw Error("Section not found");let n=t?(0,s.SV)(e):"";return"".concat(n,"/s/").concat(i.slug||i.id)}function ei(e){let{addBase:t,section:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(i=i||(null==e?void 0:e.section)))throw Error("Section not found");let n=t?(0,s.SV)(e):"";return(0,s.n1)("".concat(n,"/publish/settings/preamble"),{section:i.id})}let en=e=>{var t;let i="".concat(null!==(t=null==e?void 0:e.base)&&void 0!==t?t:"","/api/v1/twitter/authorize");return e?(0,s.n1)(i,e):i};function er(e,t){return(0,s.n1)("".concat((0,s.SV)(),"/inbox/post/").concat(e),t)}function eo(e,t){let{token:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,s.n1)("".concat((0,s.SV)(e),"/api/v1/post/pdf"),{postId:t,token:i})}function ea(e){var t;let i=e.match(/^https?:\/\/open\.substack\.com(?:\.localhost:5000)?\/pub\/([^\/]+)/);return(i||(i=e.match(/^https?:\/\/([^\.]+)\.substack\.com/)))&&null!==(t=i[1])&&void 0!==t?t:null}function el(e){let{url:t,currentSubdomain:i,currentCustomDomain:n}=e;if($(t))return i===ea(t);let r=!!t.match(/http:\/\/\w*\.substack\.com\.localhost:5000/);if(n&&!r){var o;return n.replace(/^www\./,"")===(null!==(o=function(e){let t=(e=(e||"").toLowerCase().trim()).match(/^(\w+)$/);if(t)return t[1];let i=e.match(/[\w-]+(\.[\w-]+)+/);if(i){let e=i[0];return e.includes("substack")&&(e=e.split(".")[0]),e}}(t))&&void 0!==o?o:"").replace(/^www\./,"")}return i===ea(t)}let es=function(e){let{addBase:t,params:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t?(0,s.SV)(e):"";return(0,s.n1)("".concat(n,"/account/cancel"),i)},ed=function(e,t){let{addBase:i,referrer:o,params:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=i?(0,s.SV)(e):"",d="".concat(l,"/publish/posts/detail/").concat(t),c=(0,r._)((0,n._)({},a),{referrer:o});return a||o?(0,s.n1)(d,c):d},ec=function(e,t){let{addBase:i,referrer:o,params:a,selectionForQuote:l,alreadyPublished:d}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=i?(0,s.SV)(e):"",u="".concat(c,"/publish/posts/detail/").concat(t,"/share-center"),p=(0,r._)((0,n._)({},a),{referrer:o,selectionForQuote:l,alreadyPublished:d});return a||o||l||d?(0,s.n1)(u,p):u},eu=function(e,t){let{addBase:i,params:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(null==e?void 0:e.id))return"";let o=i?(0,s.SV)(e):"";return(0,s.n1)("".concat(o,"/leaderboard?"),(0,n._)({},r,(null==t?void 0:t.id)&&{referrer_token:t.id.toString(36)}))},ep=(e,t)=>{if(!e)return"";let i=(0,s.SV)(e);return"".concat(o.W.SURVEY_URL_PREFIX).concat(i,"/survey/").concat(t,"?token=").concat(o.W.SURVEY_TOKEN)},eh=(e,t,i)=>{let{popup:n}=i,r=(0,s.SV)(e);return(0,s.n1)("".concat(r,"/publish/stats/reader-surveys-editor/").concat(t).concat(n?"?popup=true":""))},em=function(e){let{addBase:t,baseUrlOptions:i,params:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t?(0,s.SV)(e,i):"";return(0,s.n1)("".concat(r,"/publish/stats/pledges"),n)},eg=function(e){let{addBase:t,baseUrlOptions:i,params:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t?(0,s.SV)(e,i):"";return(0,s.n1)("".concat(r,"/publish/stats/notes"),n)};function ev(e){return"".concat((0,s.ZJ)(),"/browse/").concat(e)}function eb(e){return(0,s.Q2)("/chat",e)}function ey(e){let{userId:t,userName:i}=e;return"".concat(t,"-").concat((0,l.Of)(i))}function ef(e){let{userId:t,userName:i,noBase:n=!0}=e,r=ey({userId:t,userName:i}),o=n?"":(0,s.ZJ)();return"".concat(o,"/api/v1/user/").concat(r,"/public_profile")}function e_(e){return!!e&&e.includes("generic.png")}let eZ=new Set(["com","edu","gov","net","mil","org","nom","co","name","info","biz"]);function ew(e){let t=e.split(".");return!!(2===t.length||3===t.length&&eZ.has(t[1]))}function eC(e){let t=e.split(".");for(;t.length>2&&!(3===t.length&&eZ.has(t[1]));)t.shift();return t.join(".")}function ex(e){let t=eC(e);return t===e?"@":e.substring(0,e.length-t.length-1)}function eS(){return"".concat((0,s.ZJ)(),"/pa")}function ek(){return"".concat((0,s.ZJ)(),"/privacy")}function eB(){let{utm_medium:e,post_id:t,publication_subdomain:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.n1)("".concat((0,s.SV)({subdomain:null!=i?i:""},{forceSubdomain:!0}),"/publish/post/").concat(t),{tab:"clips",utm_medium:e})}},60308:function(e,t,i){i.d(t,{ANx:()=>g.ANx,AaB:()=>v.A,AmV:()=>e8,An$:()=>eg,BPe:()=>eS,BhD:()=>g.BhD,BtY:()=>eD,ChS:()=>eI,D4e:()=>v.D4,E2n:()=>c.E2,FEI:()=>eN,Fdd:()=>eO,Fnz:()=>Q,FoX:()=>g.FoX,Fu$:()=>k,G1C:()=>Z,GIj:()=>W,GR3:()=>g.GR3,HMK:()=>x,I4e:()=>m.I4,JWy:()=>eQ,K8_:()=>T,LaP:()=>e6,Li8:()=>em,LwU:()=>e_,MBd:()=>eM,MWO:()=>ek,MoQ:()=>g.MoQ,NNq:()=>g.NNq,Nhr:()=>h.Nh,OEk:()=>ev,OGV:()=>q,P8A:()=>er,Q6L:()=>C,QAj:()=>eb,QK7:()=>g.QK7,RF2:()=>es,RMm:()=>v.RM,RQ:()=>eY,RwZ:()=>eE,SMH:()=>m.SM,SVA:()=>g.SVA,TID:()=>eh,TJI:()=>f,UA6:()=>ej,UH4:()=>g.UH4,UVC:()=>N,Ul:()=>Y,UzE:()=>ef,W$Z:()=>e7,W1P:()=>ec,WFt:()=>eo,Wnz:()=>I,Xbg:()=>A,Y$Q:()=>g.Y$Q,Y9U:()=>b,ZJn:()=>g.ZJn,ZPN:()=>eH,ZVf:()=>P,Zdb:()=>K,Zs0:()=>G,Zzu:()=>el,_HV:()=>ep,_P8:()=>ed,_QN:()=>en,aFk:()=>ey,aR6:()=>_,b_Y:()=>J,bxL:()=>eJ,c0Q:()=>D,cdl:()=>ea,d54:()=>eB,d6h:()=>M,dIB:()=>O,dnM:()=>e9,eSs:()=>w,en2:()=>g.en2,eq9:()=>eF,fQy:()=>g.fQy,fw6:()=>eZ,gGz:()=>eX,gSe:()=>H,h75:()=>eC,hI6:()=>eG,iJV:()=>eL,iNT:()=>eP,jHQ:()=>F,kOB:()=>e1,kPM:()=>eK,kfT:()=>eu,l5Q:()=>tt,mGw:()=>g.mGw,maq:()=>z,n1t:()=>g.n1t,nRe:()=>R,nxG:()=>X,ow1:()=>e0,p5u:()=>eR,pN7:()=>V,qN9:()=>eV,qQN:()=>B,qYj:()=>L,rCb:()=>g.rCb,rfk:()=>te,rhs:()=>y,s2v:()=>eq,sai:()=>E,tSX:()=>e4,tTj:()=>ee,tk4:()=>p.tk,uQO:()=>eA,uRy:()=>g.uRy,uXE:()=>ei,urw:()=>eW,uyd:()=>e2,v3t:()=>$,v5X:()=>j,wI3:()=>g.wI3,xJ2:()=>e5,xOy:()=>U,zF4:()=>g.zF4,zJH:()=>g.zJH,zUJ:()=>m.zU});var n=i(7409),r=i(99282),o=i(98848),a=i(14293),l=i.n(a),s=i(35500),d=i(40121),c=i(33884),u=i(69332),p=i(60836),h=i(36186),m=i(70408),g=i(63651),v=i(51231);let b="https://support.substack.com/hc/en-us/requests/new?ticket_form_id=14793522353556&tf_14811460381460=i_own_a_publication_&tf_14818271924756=my_publication_isn_t_publicly_visible";function y(e,t){let{skipHash:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"==typeof e&&(t=e,e=document.location.pathname+document.location.search+document.location.hash);let n=(0,g.n1t)(e.split("?")[0].split("#")[0],Object.assign((0,u.m)(e),t));return -1===e.indexOf("#")||i||(n+=e.substr(e.indexOf("#"))),n}let f=function(e){let{params:t={},signedIn:i=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(0,g._No)(i,e);return(0,g.n1t)("".concat((0,g.SVA)(e),"/"),(0,n._)({lli:r},t))},_=e=>!e||!e.startsWith("/")||e.startsWith("//")||!/\.svg(\?|#|$)/.test(e)?e:"".concat(g.L4R,"/").concat(e),Z=e=>(e||"").replace(/^(\w+:)?\/\//g,""),w=e=>{let t=(0,g.ZJn)();return"".concat(t,"/discover/stocks/").concat(e)},C=(e,t)=>{let i=(0,g.SVA)({subdomain:"admin"});return(0,g.n1t)("".concat(i,"/customer_support_mode"),{for_pub:t?t.subdomain:void 0,redirect:e})},x=function(){let{utm_source:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=g.T91;return(0,g.n1t)((0,g.JDA)("".concat("reader",".").concat(t)),{utm_source:e})},S=function(e){let{query:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=g.T91;return(0,g.n1t)("".concat((0,g.JDA)(i)).concat(e),t)},k=e=>S("/activity",{query:e}),B=e=>S("/inbox/saved",e),T=function(e,t){let{params:i={},redirect:r=null,source:o=null,postUuid:a=null,inbox:l=null,hostOverride:s=null}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||!t)return"";let d=s?a?"".concat(s,"/p/").concat(a):"".concat(s,"/p/").concat(t):a?"".concat((0,g.ZXb)(),"/pub/").concat(e,"/drafts/").concat(a):"".concat((0,g.ZXb)(),"/pub/").concat(e,"/p/").concat(t),c=(0,n._)({utm_source:o,redirect:r,inbox:l},i);return(0,g.n1t)(d,c)};function I(e,t,i,n){let{maxParents:r=3,token:o}=n;if(!i||!i.ancestor_path)return(0,p.tk)(e,t,i);let a=i.ancestor_path.split("."),l=a.length<r?0:a.length-r;return(0,g.uRy)(e,t,{comments:!0,commentId:i.id,commentContextId:a[l],urlParams:{token:o}})}let N=e=>{let{pub:t,section:i,addBase:n=!0}=e,r=n?(0,g.SVA)(t):"";return i?"".concat(r,"/listen/").concat(i.slug||i.id):"".concat(r,"/podcast")},P=function(e){let{addBase:t,type:i,id:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t?(0,g.SVA)(e):"";return"".concat(r,"/publish/settings/").concat(i,"/").concat(n)},E=function(e){let{params:t,section:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i?"/s/".concat(i.slug||i.id):"";return(0,g.n1t)("".concat(n,"/archive"),t)},X=function(e){let{addBase:t,params:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t?(0,g.SVA)(e):"";return(0,g.n1t)("".concat(n,"/archive"),i)},M=function(e){let{addBase:t,params:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t?(0,g.SVA)(e):"";return(0,g.n1t)("".concat(n,"/about"),i)},A=function(e){let{addBase:t,params:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t?(0,g.SVA)(e):"";return(0,g.n1t)("".concat(n,"/sitemap"),i)},D=function(e){let{params:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i="".concat((0,g.SVA)({subdomain:e}),"/publish/home");return(0,g.n1t)(i,t)},R=e=>(0,g.n1t)("".concat((0,g.ZJn)(),"/twitter/find-pubs"),e),F=function(e){let{addBase:t,params:i,slug:n,isSection:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t?(0,g.SVA)(e):"",a="".concat(o,"/publish/podcasting");return(n&&(a=r?"".concat(a,"/s/").concat(n):"".concat(a,"/").concat(n)),i)?(0,g.n1t)(a,i):a},L=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var{baseUrl:i=null}=t,n=(0,o._)(t,["baseUrl"]);return(0,g.n1t)("".concat(null!=i?i:(0,g.SVA)(e),"/publish/post"),n)},z=(e,t)=>(0,g.n1t)("".concat((0,g.SVA)(e),"/publish/post/marketing"),t),O=function(e){let{addBase:t,params:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t?(0,g.SVA)(e):"";return(0,g.n1t)("".concat(n,"/publish/subscribers"),i)},U=()=>"/publish/subscribers/add",Y=function(e){let{payment:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"/publish/domain".concat(t?"/pay":"")},H=()=>"/publish/domain/status",j=()=>"/publish/domain/redirects",J=()=>"/publish/domain/redirects-status",V=function(e,t){let{addBase:i,tab:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i?(0,g.SVA)(e):"";return(0,g.n1t)("".concat(r,"/publish/subscribers/legacy"),{email:t,tab:n})},q=e=>"/publish/groups/".concat(e),W=()=>"/publish/groups",G=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(0,g.n1t)("".concat((0,g.SVA)(e),"/subscribe"),t);return -1===i.indexOf("?")?"".concat(i,"?"):i},K=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,g.n1t)("/account/login",e)},Q=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?(0,g.n1t)("".concat((0,g.ZJn)(),"/refer/").concat(e),t):null},$=function(){let{utm_source:e,section:t,highlightNotification:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,g.n1t)("".concat((0,g.ZJn)(),"/settings"),{utm_source:e,section:t,highlightNotification:i})},ee=function(){let{highlight:e,utm_source:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return $({section:"notifications",highlightNotification:e,utm_source:t})},et=e=>{let{useOriginalUrl:t}=e;if(t&&"undefined"!=typeof window&&window._preloads.original_url)try{let e=new URL(window._preloads.original_url);return"".concat(e.pathname).concat(e.search).concat(e.hash)}catch(e){}return"".concat(document.location.pathname).concat(document.location.search).concat(document.location.hash)},ei=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{for_pub:t,email:i,prefilled_email:n,with_password:r,error:o,message:a,change_user:l,justTrying:s,useOriginalUrl:d}=e,{redirect:c}=e;return"string"!=typeof c&&(c=et({useOriginalUrl:null!=d&&d})),(0,g.n1t)("".concat((0,g.ZJn)(),"/sign-in"),{redirect:c,for_pub:t,email:i,prefilled_email:n,with_password:r,error:o,message:a,change_user:l,justTrying:s})},en=function(){let{utm_source:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,g.n1t)("".concat((0,g.ZJn)(),"/tos"),{utm_source:e})},er=function(){let{pub:e,utm_source:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e?(0,g.n1t)("".concat((0,g.SVA)(e),"/tos"),{utm_source:t}):en({utm_source:t})},eo=function(){let{utm_source:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"".concat((0,g.n1t)("".concat((0,g.ZJn)(),"/ccpa"),{utm_source:e}),"#personal-data-collected")},ea=function(){let{utm_source:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,g.n1t)("".concat((0,g.ZJn)(),"/welcome"),{utm_source:e})},el=function(){let{utm_source:e,hash:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"".concat((0,g.n1t)("".concat((0,g.ZJn)(),"/privacy"),{utm_source:e})).concat(t?"#".concat(t):"")},es=function(){let{pub:e,utm_source:t,hash:i=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e)return"".concat(el({utm_source:t,hash:i}));let n=i?"#".concat(i):"";return"".concat((0,g.n1t)("".concat((0,g.SVA)(e),"/privacy"),{utm_source:t})).concat(n)},ed=(e,t)=>"".concat((0,g.ZJn)(),"/discover").concat(e?"/category/".concat(e.slug):"/recomendations").concat("all"===t?"/all":"");function ec(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var{signedIn:i=!1,addBase:r=!1,root:a,user:l}=t,s=(0,o._)(t,["signedIn","addBase","root","user"]);let d=(0,g._No)(i,e);return(0,g.W1P)(e,{root:a,user:l,addBase:r,params:(0,n._)({},void 0===d?{}:{lli:d},s)})}let eu=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,g.n1t)("".concat((0,g.SVA)(e),"/recommendations"),t)},ep=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return y("".concat((0,g.ZJn)(),"/signup"),e)},eh=function(e){let{addBase:t=!1,baseUrlOptions:i={},params:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,g.n1t)("".concat((0,g.VSz)(e,{addBase:t,baseUrlOptions:i}),"/stripe-import"),n)},em=function(e){let{addBase:t,baseUrlOptions:i,params:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t?(0,g.SVA)(e,i):"";return(0,g.n1t)("".concat(r,"/publish/recommendations"),n)},eg=function(e){let{addBase:t,baseUrlOptions:i,params:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t?(0,g.SVA)(e,i):"";return(0,g.n1t)("".concat(r,"/publish/settings/blurbs"),n)},ev=e=>{let t=(0,g.SVA)(e);return(0,g.n1t)("".concat(t,"/publish/settings/"),{search:"referral"})},eb=function(e){let{addBase:t=!1,baseUrlOptions:i={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"".concat((0,g.VSz)(e,{addBase:t,baseUrlOptions:i}),"/moderation")},ey=()=>"/publish/settings/podcast/edit",ef=e=>"".concat((0,g.SVA)(e),"/invite"),e_=function(e,t){let{utm_source:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,g.NNq)(e,{utm_source:i})},eZ=e=>{let{pub:t,token:i=null}=e,{section:n}=t;if(n){var r;return(null===(r=n.podcastSettings)||void 0===r?void 0:r.podcast_feed_url)?n.podcastSettings.podcast_feed_url:ew({pubId:t.id,sectionId:n.id,token:i})}return t.podcast_feed_url?t.podcast_feed_url:ew({pubId:t.id,sectionId:null,token:i})};function ew(e){let{pubId:t,sectionId:i,token:n}=e;if(i){let e="".concat((0,g.SVA)({subdomain:"api"}),"/feed/podcast/").concat(t,"/s/");return n?e+="".concat(i,"/private/").concat(n,".rss"):e+="".concat(i,".rss"),e}let r="".concat((0,g.SVA)({subdomain:"api"}),"/feed/podcast/").concat(t);return n?r+="/private/".concat(n,".rss"):r+=".rss",r}let eC=(e,t)=>{let i=ex(e,t);return(0,g.zF4)(i,null,{skipDomainValidation:!0,quality:"auto:best",version:4})},ex=(e,t)=>(0,g.n1t)("".concat((0,g.SVA)(e,{forceSubdomain:!0}),"/api/v1/post_preview/").concat(t.id,"/twitter.jpg"),{isDraft:t.is_draft||t.is_scheduled}),eS=(e,t,i,n,r)=>{let o=ek(e,t,i,n);return(0,g.zF4)(o,null,{skipDomainValidation:!0,quality:"auto:best",version:11,attachment:!!r,filename:r})},ek=(e,t,i,r)=>(0,g.n1t)("".concat((0,g.SVA)(e,{forceSubdomain:!0}),"/api/v1/post_selection_image/").concat(t.id,"/").concat(i,".jpg"),(0,n._)({},r)),eB=e=>(0,g.zF4)("".concat(eT(e)),null,{quality:"auto:best",version:9,skipDomainValidation:!0}),eT=e=>{let{hashString:t}=i(84864),n="".concat((0,g.SVA)(e,{forceSubdomain:!0}),"/twitter/subscribe-card.jpg"),r=t("".concat(e.logo_url,":").concat(e.hero_text,":").concat(e.name,":").concat(e.author_name,":").concat(e.subdomain));return r?n+="?v=".concat(r):n+="?v=bust",n},eI=(e,t,i,n)=>{let r=eN(e,t,i);return(0,g.zF4)(r,null,{quality:"auto:best",skipDomainValidation:!0,version:13,attachment:!!n,filename:n})},eN=(e,t,o)=>{let{hashString:a}=i(84864),l=a("".concat(t.social_title+t.title+t.description+t.cover_image));return(0,g.n1t)("".concat((0,g.SVA)(e,{forceSubdomain:!0}),"/api/v1/press_kit/").concat(t.id,".jpg"),(0,r._)((0,n._)({},o),{isDraft:"is_draft"in t&&t.is_draft,hash:l}))},eP=function(e,t,i,n){let{useRootDomain:r=!1}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=eE(e,t,i,{useRootDomain:r});return(0,g.zF4)(o,null,{quality:"auto:best",skipDomainValidation:!0,version:10,attachment:!!n,filename:n})},eE=function(e,t,i){let{useRootDomain:r=!1}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=null;if(Object.values(s.dD).includes(t))o="arr";else if(Object.values(s.bq).includes(t))o="subscribers";else throw Error("endpoint for milestone not found [".concat(t,"]"));return(0,g.n1t)("".concat(r?(0,g.SVA)():(0,g.SVA)(e,{forceSubdomain:!0}),"/api/v1/milestone_assets/").concat(o,".jpg"),(0,n._)({milestone:t},i,r&&{subdomain:e.subdomain}))},eX=function(e,t,i){let{fileToDownload:n="",useRootDomain:r=!1}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=eM(e,t,i,{useRootDomain:r});return(0,g.zF4)(o,null,{quality:"auto:best",skipDomainValidation:!0,version:10,attachment:!!n,filename:n})},eM=function(e,t,i){let{useRootDomain:r=!1}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return(0,g.n1t)("".concat(r?(0,g.SVA)():(0,g.SVA)(e,{forceSubdomain:!0}),"/api/v1/subscription_note_assets/").concat(t.id,".png"),(0,n._)({},i,r&&{subdomain:e.subdomain}))},eA=function(e,t,i){let{fileToDownload:n="",useRootDomain:r=!1}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=eD(e,t,i,{useRootDomain:r});return(0,g.zF4)(o,null,{quality:"auto:best",skipDomainValidation:!0,version:10,attachment:!!n,filename:n})},eD=function(e,t,i){let{useRootDomain:r=!1}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return(0,g.n1t)("".concat(r?(0,g.SVA)():(0,g.SVA)(e,{forceSubdomain:!0}),"/api/v1/pledge_note_assets/").concat(t.id,".jpg"),(0,n._)({},i,r&&{subdomain:e.subdomain}))},eR=function(e,t,i){let{fileToDownload:n="",useRootDomain:r=!1}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=eF(e,i,{useRootDomain:r});return(0,g.zF4)(o,null,{quality:"auto:best",skipDomainValidation:!0,version:11,attachment:!!n,filename:n})},eF=function(e,t){let{useRootDomain:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,g.n1t)("".concat(i?(0,g.SVA)():(0,g.SVA)(e,{forceSubdomain:!0}),"/api/v1/publication_assets/image.jpg"),(0,n._)({},t,i&&{subdomain:e.subdomain}))},eL=e=>{let t=ez(e);return(0,g.zF4)(t,null,{quality:"auto:best",version:9})},ez=e=>(0,g.n1t)("/api/v1/latex/jpeg",{expression:e}),eO=e=>e.startsWith("/publish"),eU=e=>{let t=(0,g.en2)(e);return!!t&&t.pathname.startsWith("/p/")},eY=e=>{var t,i;return eU(e)&&null!==(i=null===(t=(0,g.en2)(e))||void 0===t?void 0:t.pathname.split("/")[2])&&void 0!==i?i:null},eH=function(){let{redirect:e,for_pub:t,utm_source:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e=e||"",(0,g.n1t)("".concat((0,g.ZJn)(),"/sign-out"),{redirect:e,for_pub:t,utm_source:i})},ej=(e,t)=>{let i=new URLSearchParams;return i.set("referrer",encodeURIComponent(e)),t&&i.set("initialSectionId",String(t)),"/publish/podcast/new?".concat(i.toString())},eJ=550,eV=728,eq=[424,848,1272,1456],eW=1200,eG=2880,eK=320,eQ=550,e$=()=>"substack-video",e0=function(e){var t,i;let{post:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return;let r=e$();if("audio"===e.media_type&&(l()(e.thumbnail_id)||1===e.thumbnail_id))return null==n?void 0:null===(t=n.podcast_episode_image_info)||void 0===t?void 0:t.url;let o=e.post_id?"https://".concat(r,".s3.amazonaws.com/video_upload/post/").concat(e.post_id):"https://".concat(r,".s3.amazonaws.com/video_upload/user/").concat(e.user_id);return"".concat(o,"/").concat(e.id,"/transcoded-").concat((null!==(i=e.thumbnail_id)&&void 0!==i?i:1).toString().padStart(5,"0"),".png")},e1=function(e){var t;let{isStatic:n,post:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{videoPlayerDimensions:o}=i(84864),{height:a,width:l}=o(e,{isStatic:n});return(0,g.zF4)(null!==(t=e0(e,{post:r}))&&void 0!==t?t:"",2*l,{crop:l/a<1920/1080?"pad":"fill",height:2*a,trailingSegments:n?["l_".concat("play_button_usfui2",",w_144,e_colorize:0")]:[]})},e2=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,g.n1t)("https://substack.com/app-link/publications/".concat(e.id,"/drafts/").concat(t),i)},e4=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,g.n1t)("".concat((0,g.ZJn)(),"/app"),e)},e3=function(){let{pathOnly:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="/img/podcast/generic.png";return e?t:"".concat((0,g.ZJn)()).concat(t)},e8=()=>{let e=e3({pathOnly:!0});return(0,g.zF4)(e,1400)},e6=e=>(0,g.n1t)("https://twitter.com/intent/tweet",e),e5=e=>{let{text:t,query:i}=e;return(0,g.n1t)("https://bsky.app/intent/compose",(0,r._)((0,n._)({},i),{text:t}))};function e9(e){let{spotifyUri:t}=e;return t?"https://content-access.spotify.com/link/3NuiRiVbdxZaKYsqcCXKYV?spotifyShowUri=".concat(t):""}let e7=e=>{var t;let{post:i,height:n}=e;return(null===(t=i.videoUpload)||void 0===t?void 0:t.is_mux)?"/api/v1/video/upload/".concat(i.videoUpload.id,"/preview.gif?height=").concat(n):null},te=e=>{let{userId:t,pub:i,addBase:n=!1}=e;if(!i.authorPagesInfo)return null;let r=i.authorPagesInfo.find(e=>e.user_id===t);if(!r)return null;let o=n?(0,g.SVA)(i):"";return"".concat(o,"/w/").concat((0,d.Of)(r.name))},tt=e=>{let{campaignId:t,medium:i,userId:n,pubId:r}=e;return"".concat((0,g.ZXb)(),"/sponsorship-campaigns/").concat(t,"/link?pub_id=").concat(r,"&medium=").concat(i).concat(n?"&user_id=".concat(n):"")}},14773:function(e,t,i){i.d(t,{Fo:()=>s,JD:()=>o,L4:()=>r,Q2:()=>m,SV:()=>u,T9:()=>n,Y$:()=>d,ZJ:()=>p,ZX:()=>h,n1:()=>c,pv:()=>l,tE:()=>a});let n="substack.com",r="https://substackcdn.com";function o(e){return"https://"+e}r.replace(/https?:\/\//,"").replace(/\/$/,"");let a=o(n),l=new URL(a);function s(e){let{forceSubdomain:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&"object"==typeof e&&"custom_domain"in e&&e.custom_domain&&!e.custom_domain_optional&&!t)return e.custom_domain;let i=n;return e&&"www"!==e.subdomain&&(i="".concat(e.subdomain,".").concat(i)),i}function d(e){return Object.keys(e).filter(t=>void 0!==e[t]&&null!==e[t]).map(t=>"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))).join("&")}function c(e,t){if(!e)return"";if(!t)return e;let i=d(t),n=i?-1===e.indexOf("?")?"?":"&":"";return"".concat(e).concat(n).concat(i)}function u(e){let{forceSubdomain:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e&&"object"==typeof e&&"base_url"in e&&e.base_url&&!t?e.base_url:o(s(e,{forceSubdomain:t}))}function p(){return u()}function h(){return o("open.".concat(n))}function m(e){let{noBase:t,urlParams:i,pub:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t?"":u(n);return c("".concat(r).concat(e),i)}},36186:function(e,t,i){i.d(t,{GR:()=>l,NJ:()=>s,NN:()=>c,Nh:()=>u,_I:()=>a,qv:()=>d});var n=i(7409),r=i(40121),o=i(14773);function a(e){let{id:t,name:i,handle:n}=e;if(n)return"@".concat(n);let o=(0,r.Hm)(i,{hashIfEmpty:!0});return"".concat(t).concat(o?"-".concat(o):"")}function l(e,t){let{searchParams:i,noBase:n,baseUrl:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=n?"":null!=r?r:(0,o.ZJ)(),s="".concat(l,"/profile/").concat(a({id:e,name:t}));return(0,o.n1)(s,i)}let s=function(e){let{searchParams:t,noBase:i,baseUrl:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i?"":null!=n?n:(0,o.ZJ)(),a="".concat(r,"/@").concat(e);return(0,o.n1)(a,t)};function d(){return"".concat((0,o.ZJ)(),"/profile/edit")}function c(e){let{utm_source:t,utm_content:i,utm_campaign:r,noBase:o,baseUrl:a,noHandle:d,extraParams:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=(0,n._)({},c,t||i||r?{utm_source:t,utm_content:i,utm_campaign:r}:void 0),p=d?void 0:(null==e?void 0:e.handle)||(null==e?void 0:e.author_handle);return p?s(p,{noBase:o,baseUrl:a,searchParams:u}):l(e.author_id||e.user_id||e.id,e.user_profile_name||e.author_name||e.name,{noBase:o,baseUrl:a,searchParams:u})}function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.n1)("".concat((0,o.ZJ)(),"/profile/start"),e)}},84864:function(e,t,i){i.r(t),i.d(t,{AUDIENCE_ADJECTIVES:()=>ew,CENTS_PER_EMAIL:()=>eO,CONTENT_MODERATION_REASONS:()=>ep,CORE_SUPPORTED_LANGUAGES:()=>eD,ChatError:()=>eH,DEFAULT_GIFT_LENGTH_DAYS:()=>ek,DEFAULT_GRANT_NUMBER:()=>eB,DEFAULT_MAX_BYLINES:()=>i7,DEFAULT_PREVIEW_LIMIT:()=>ei,DEFAULT_PREVIEW_LIMIT_EMAIL:()=>en,DEFAULT_PROFILE_PAGE_SUBSCRIPTIONS_LIMIT:()=>et,EEA_COUNTRIES:()=>tc,EU_COUNTRIES:()=>td,FIRST_ILLEGAL_POSTGRES_INTEGER:()=>ed,GIFT_LENGTH_MONTHS:()=>eS,GRACE_PERIOD_COUPON_TRIAL_DAYS:()=>ee,GRACE_PERIOD_DAYS:()=>K,HOMEPAGE_TYPE_CHANGE_CUTOFF:()=>ex,LINK_SUPPORTED_COUNTRIES:()=>tu,LIVE_STREAM_CONTENT_WARNINGS:()=>n_,MANUAL_BILLING_DAYS_UNTIL_DUE:()=>Q,MAX_BANK_PAYMENT_ATTEMPTS:()=>eo,MAX_FILE_SIZE:()=>R,MAX_INT32:()=>es,MAX_MEDIA_FILE_SIZE:()=>A,MAX_MEDIA_UPLOAD_CHUNK_SIZE:()=>D,MAX_PODCAST_FIELD_LENGTH:()=>ec,MAX_PODCAST_FILE_SIZE:()=>M,MAX_SECTION_DESCRIPTION_LENGTH:()=>eu,MIN_MONTH_GAP_BETWEEN_PAUSES:()=>er,MISSING_IMAGE_HEIGHT:()=>b.Vi,MISSING_IMAGE_URL:()=>b.wW,MISSING_IMAGE_WIDTH:()=>b._j,MONTH_NAMES:()=>eX,NO_PLATFORM_CUSTOMER_CLONE_COUNTRIES:()=>eL,NO_REPLY_EMAIL:()=>e1,NZD_COUNTRIES:()=>tp,OLD_PODCAST_CATEGORIES:()=>eE,PODCAST_CATEGORIES:()=>eP,PODCAST_SECTIONS_TO_MARK_AS_NEWSLETTERS:()=>eU,PUBLICATION_TIER_DESCRIPTIONS:()=>i6,PUB_IDS_TO_NOT_SHOW_FOLLOW_PROMPT_ON:()=>I,READ_WORDS_PER_MINUTE:()=>ea,SECURITY_QUESTIONS:()=>eZ,SENDER_REMINDER_2_DELAY_SINCE_LAST_REMINDER:()=>eI,SENDER_REMINDER_3_DELAY_SINCE_LAST_REMINDER:()=>eN,SENDER_REMINDER_DELAY:()=>eT,SPEAK_WORDS_PER_MINUTE:()=>el,SPECIAL_SUBDOMAINS:()=>e_,STRIPE_COUNTRIES_WITH_TRANSFERS_ENABLED:()=>nZ,STRIPE_DAYS_UNTIL_DUE:()=>$,STRIPE_TAX_ID_TYPES:()=>eM,SUBSCRIPTION_WORDS:()=>ij,SUBSTACK_PUBLICATION_IDS:()=>V,SUBSTACK_PUBLICATION_ID_BETA:()=>Y,SUBSTACK_PUBLICATION_ID_BLOGOLD:()=>U,SUBSTACK_PUBLICATION_ID_COMPANY:()=>L,SUBSTACK_PUBLICATION_ID_LIBRARYOLD:()=>z,SUBSTACK_PUBLICATION_ID_ON:()=>F,SUBSTACK_PUBLICATION_ID_PRODUCTLAB:()=>J,SUBSTACK_PUBLICATION_ID_READ:()=>H,SUBSTACK_PUBLICATION_ID_STORIESOLD:()=>O,SUBSTACK_PUBLICATION_ID_THREADSPILOT:()=>j,SUBSTACK_USER_ID:()=>q,SUBSTACK_USER_IDS:()=>G,SUBSTACK_WRITERS_USER_ID:()=>W,SUPPORTED_CURRENCIES:()=>th,SUPPORTED_LANGUAGES:()=>eA,SUPPORTED_LANGUAGES_IN_LANGUAGE:()=>eR,SUPPORTED_SEARCH_LANGUAGES:()=>eF,TERSE_AUDIENCE_ADJECTIVES:()=>eC,TRANSPARENT_IMAGE_URL:()=>b.Vk,TWEET_PLACEHOLDER_DATA_URI:()=>T,WEEK_IN_SECONDS:()=>ez,anonymousName:()=>iY,areCommentsLocked:()=>is,assertIsDefined:()=>N,assertIsError:()=>P,averageVectors:()=>ny,balanceTextWithCharacterWidths:()=>tl,baschezScoreToEmojis:()=>tU,baschezToCategory:()=>tO,canDeleteComment:()=>ip,canDeletePost:()=>im,canEditComment:()=>iu,canPostComments:()=>id,canReplyToPost:()=>e0,canReportComment:()=>ig,canSeeCommenterEmails:()=>io,canSeeComments:()=>ia,canSeeTranscription:()=>il,centsToDollarString:()=>tZ,centsToPriceString:()=>t_,colorLightness:()=>tD,colorLuma:()=>tR,commentsEnabledForPost:()=>it,couldPostCommentsIfSubscribed:()=>ic,coverPageFreeSubscriberCount:()=>t0,currencySymbol:()=>ty,decimalToPercent:()=>t8,defaultAudienceForPub:()=>iy,defaultCommentLevelForPub:()=>iw,defaultSendEmailForPub:()=>iC,dollarFormatter:()=>tw,dollarStringToCents:()=>tC,endsWithPunctuation:()=>te,ensureInList:()=>nb,escapeNewlines:()=>ie,flowTextBasedOnWidth:()=>nh,formatArray:()=>tL,formatBytes:()=>iz,formatEllipsis:()=>e7,formatPercentForDisplay:()=>t3,formatPodcastDuration:()=>nn,formatPodcastDurationLower:()=>nr,formattedBytesToNumber:()=>iO,foundingMemberDescription:()=>iK,fromEnv:()=>nu,getByLine:()=>ej,getBylineUsers:()=>iX,getCopyrightedContentBucketName:()=>ey,getCurrencyForCountry:()=>tm,getGiftValueText:()=>tk,getGlobalBanMessage:()=>eh,getImageUrlFromBucketKey:()=>eb,getInitalPayment:()=>tS,getModerationPolicyName:()=>eg,getNext5HoursAfterMidnight:()=>ni,getNumberWithCommas:()=>t$,getOpennodePaymentUrl:()=>iQ,getPlanTitle:()=>nd,getPostCtaPresentParticiple:()=>iI,getPostCtaText:()=>iT,getPostEmbedMeta:()=>eq,getPostMediaBucketName:()=>ev,getPrintedByline:()=>iM,getPrintedPostType:()=>iN,getPublicationBanMessage:()=>em,getReadableAttribution:()=>i0,getRemovedContentBucketName:()=>ef,getRestackEmailSubject:()=>iP,getScheduledAt:()=>t6,getSubscribeText:()=>eV,getSubscriptionSentenceWithCustomWords:()=>iq,getSubscriptionWord:()=>iW,getSuperscriptNumberString:()=>iG,getTrialEndOverride:()=>ix,getWithIndefiniteArticle:()=>na,get_month_name:()=>iS,guessFirstName:()=>v.Q1,guessLastName:()=>v.bu,handleDocumentLinkClick:()=>iF,hashString:()=>nl,hexToHSV:()=>tE,hexToRgb:()=>tX,hidePaidPostsFor:()=>eW,isAppAttribution:()=>i1,isDefaultMarblePhoto:()=>b.d7,isNotMainEntry:()=>iL,isNotesAttribution:()=>i2,isPaidPub:()=>ib,isPinnable:()=>i9,isProbablyEmail:()=>i3,isSearchEngineCrawlerQuick:()=>iU,isSubstackNetworkAttribution:()=>i4,isTouchDevice:()=>nm,isUUID:()=>iA,isValidCommentLevel:()=>iZ,isZeroDecimalCurrency:()=>tv,joinLines:()=>tY,kFormatter:()=>ns,longestSetOfWordsBelowCost:()=>ta,mode:()=>iB,normalizeHex:()=>tP,numberToHumanFileSize:()=>i$,numberToOrderOfMagnitude:()=>tW,numberToOrderOfMagnitudeString:()=>tG,numberToOrdinal:()=>tV,numberToRoughRankingString:()=>tQ,numberToRoughShortString:()=>tK,numberToString:()=>tq,onlyOwnsRootComment:()=>ih,oxfordComma:()=>ik,paymentPeriodToPlan:()=>i5,planBasePricing:()=>tB,pluralize:()=>t9,possessive:()=>t7,postSocialDescription:()=>iH,preventOrphans:()=>e5,profilePageFreeSubscriberCountString:()=>t4,pubCurrency:()=>tg,pubHasPaymentsEnabled:()=>iv,pubUsesZeroDecimalCurrency:()=>tb,pubsWithCustomSubscriptionWords:()=>iV,randomString:()=>tH,resolveTwitterShareText:()=>eJ,restacksEnabledForPost:()=>ii,rgbToHex:()=>tM,roughFreeSubscriberCount:()=>t1,roughFreeSubscriberCountString:()=>t2,roundPriceUp:()=>tx,sanitizeInlineText:()=>i8,satoshiToBitcoin:()=>tf,secondsToHHMMSS:()=>tI,secondsToLargestUnit:()=>tT,sectionIsSpecificallyMarkedAsNewsletter:()=>eY,setDateToMidnightPST:()=>nt,shouldHidePostFromArchive:()=>iE,shouldUseInlineComments:()=>eG,showCommentsOnPost:()=>ir,simpleBalanceText:()=>ti,sortSubscriptions:()=>eQ,spellOutNumber:()=>t5,startsWithVowel:()=>no,streamToBuffer:()=>np,stringCost:()=>to,stripInvalidBytes:()=>e2,subscriptionTypeText:()=>e$,textLengthAlphaNumericMinimumValidator:()=>nc,toFlagEmoji:()=>nf,toMillis:()=>iD,toSentenceCase:()=>tJ,toTitleCase:()=>tj,transformDocumentLink:()=>iR,truncAndFormatArray:()=>tF,truncateBytes:()=>e4,truncateNumber:()=>tz,truncateText:()=>e8,truncateToValidBytes:()=>e3,truncateWords:()=>e6,twitterScreenNames:()=>B,userFromReferralKey:()=>nv,userReferralKey:()=>ng,validCommentLevels:()=>i_,validateColor:()=>tA,validateHex:()=>tN,videoPlayerDimensions:()=>ne});var n=i(27412),r=i(7409),o=i(99282),a=i(58865),l=i(14293),s=i.n(l),d=i(57824),c=i.n(d),u=i(60826),p=i(73943),h=i(6070),m=i(31377),g=i(35934),v=i(23945),b=i(61301),y=i(34155),f=i(64945).Buffer;function _(){let e=(0,a._)(["We've removed your publication from public view due to a violation of Substack's ",". If you believe this was a mistake, you can submit an appeal to our Standards & Enforcement team"]);return _=function(){return e},e}function Z(){let e=(0,a._)(["","k"]);return Z=function(){return e},e}function w(){let e=(0,a._)(["","m"]);return w=function(){return e},e}function C(){let e=(0,a._)(["","b"]);return C=function(){return e},e}function x(){let e=(0,a._)(["","t"]);return x=function(){return e},e}function S(){let e=(0,a._)(["Over "," subscribers"]);return S=function(){return e},e}function k(){let e=(0,a._)(["Get "," in your inbox"]);return k=function(){return e},e}let B=p.vn,T="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjQAAAC0BAMAAABxiqvBAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAnUExURd/n60dwTN/n7N/n7ODn69/n6N/n69/f6t/n6uHp7eLo7t/f3+Ho7QTAsUwAAAAMdFJOU4AATnVkIUAQN+W/CFiRL14AAALCSURBVHja7dy9TgJBFIbhAwtCYsOosBYWGDT+VGqMFjZQGKOVJBaWGivoiJWl8Q6M0cbKGHouwdLEi7JS92eGNWZcdpn3q7eYPJmdc2ZmQVT/+YPE86qk9jhQJJ6Nghwjo43/KC8o6NOXNxD0uYHGlCVooIEGGmiggQYaaKCBhkADDTQp05yvbMnueheaKE29JSIi4q1CE5Fpy1cOoQnG/5ERWYMmkLuAjHi30HxnTkKZgeY7zTCNLEOjnzQixcjjV5JidrJEcxEbXnjazEmqucwOzWJ8dNXQ0/Pp0mxnh+Y6PjpvEHy6li5NITs0Tc3wOtAopeq64ZUn+EJ1MkOzoBteKfh0w9Vl+FQ7vtAOvJWmzF52indTO0Bnu74gzVYGK2g2aOr6aV2GRtfwxZs+N2kMu4AiNPraHanejtIY+jkPGuMuABpooGGtoUJNsq+Bhm6YPRQ779TPayzdQ5UGOaNJPuWzdg91kDOa5LNha8fm1ZzRJN8o1FylUe2kpcZdmsTbS2svVDlvNIl33tbuofbzRqMp35FbspajxfsX39e42vIpvsoaQ9Ng0pho+ALUTOMHX6kjBU0gfG1upOE3CmYaftkyhoZAAw000EADDTTQQAMNNCBAAw000EADDTTQQAMNMdOciZMpjhJpfHE0nUSahqs0s9CYUoEGmn94oZxdhpcp3qZ/KxvR8tENQwMNNNBAAw000BBooIEGGmigyRvN1B9led0/0jhwAFr+I40Dx+ZFaKCBZvI0DizDFYq37eJNoIEGGmiggQYaaKCBhkADDTTQQAMNNLmnsXgA6l1OFY3VY/PqVNFYvWzxoIEGGnspsQybMkPxdqN4E2iggQYaaKCBBhpooCHQQAMNNNBAAw000EADDTTQQAMNNNBAkzOaJxBMNEMQ9NmU3gAFXfwHqd3DoJPpFUSdfJB43ofqE56LnR5mRT/HAAAAAElFTkSuQmCC",I=[21267,260347];function N(e){if(null==e)throw new g.gz("Expected value to be defined, but received ".concat(e))}function P(e){if(!(e instanceof Error))throw new g.gz("Expected value to be an Error, but received ".concat(e))}let E=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],X=["CA","AU","HK","NZ"],M=0x15e00000,A=0x500000000,D=0x3200000,R=0x2bc00000,F=1,L=46438,z=86696,O=81318,U=87805,Y=508885,H=737237,j=1014268,J=1056696,V=[1,46438,86696,81318,87805,508885,737237,1014268,1056696],q=0x4d8b0ef,W=0x27ead30,G=[0x4d8b0ef,0x27ead30],K=16,Q=45,$=30,ee=2/24,et=1e3,ei=356,en=256,er=6,eo=3,ea=220,el=150,es=0x7fffffff,ed=0x80000000,ec=25e4,eu=1e3,ep=["illegal","private_information","general","spam","hate","impersonation","plagiarism","porn"].sort();function eh(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"general";return"Your account is currently suspended. Something you posted may have violated Substack's ".concat(eg(e),". If you believe this is a mistake, you can submit an appeal to our Standards & Enforcement team here:")}function em(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",{iTemplate:i}=I18N.i(t);return i(_(),eg(e,t))}function eg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",{iString:i}=I18N.i(t);switch(e){case"hate":return i("Hate policy");case"illegal":return i("Illegal & Harmful Activities policy");case"impersonation":return i("Impersonation policy");case"plagiarism":return i("Plagiarism policy");case"porn":return i("Nudity, Porn, & Erotica policy");case"private_information":return i("Private Information policy");case"spam":return i("Spam & Phishing policy");default:return i("Content Guidelines, Terms of Service, or Publisher Agreement")}}function ev(){let e="substack-post-media";if(!e)throw new g.gz("postMediaBucketName is not defined");return e}function eb(e){return"https://".concat(ev(),".s3.amazonaws.com/").concat(e)}function ey(){return"substack-post-media"===ev()?"substack-copyrighted-media":"substack-copyrighted-media-staging"}function ef(){return"substack-post-media"===ev()?"substack-removed-media":"substack-removed-media-staging"}let e_=["cdn","cloudinary","delivery","jobs","mailgun","mail","support","www","callback","api","admin","reader","sublink","random","your","dashboard","open"],eZ=["In what city or town did your parents meet?","What was your first teacher's last name?","What is your earliest memory?","What was the make and model of your first car?","What was the first concert you attended?","Where did you go on your first date?","What was your first favorite band?","What was your first computer or smartphone?","What is your least favorite color?","What was the first video game you beat?","Who was your favorite artist, musician, or celebrity when you were a teenager?"],ew={everyone:"public",only_free:"free-only",only_paid:"subscribers-only",founding:"founding-only"},eC={everyone:"public",only_free:"free-only",only_paid:"subscriber's",founding:"subscriber's"},ex=new Date("2020-01-16"),eS=1,ek=30,eB=3,eT=2592e5,eI=6048e5,eN=1728e6,eP={Arts:["Books","Design","Fashion & Beauty","Food","Performing Arts","Visual Arts"],Business:["Careers","Entrepreneurship","Investing","Management","Marketing","Non-Profit"],Comedy:["Comedy Interviews","Improv","Stand-Up"],Education:["Courses","How To","Language Learning","Self-Improvement"],Fiction:["Comedy Fiction","Drama","Science Fiction"],Government:[],History:[],"Health & Fitness":["Alternative Health","Fitness","Medicine","Mental Health","Nutrition","Sexuality"],"Kids & Family":["Education for Kids","Parenting","Pets & Animals","Stories for Kids"],Leisure:["Animation & Manga","Automotive","Aviation","Crafts","Games","Hobbies","Home & Garden","Video Games"],Music:["Music Commentary","Music History","Music Interviews"],News:["Business News","Daily News","Entertainment News","News Commentary","Politics","Sports News","Tech News"],"Religion & Spirituality":["Buddhism","Christianity","Hinduism","Islam","Judaism","Religion","Spirituality"],Science:["Astronomy","Chemistry","Earth Sciences","Life Sciences","Mathematics","Natural Sciences","Nature","Physics","Social Sciences"],"Society & Culture":["Documentary","Personal Journals","Philosophy","Places & Travel","Relationships"],Sports:["Baseball","Basketball","Cricket","Fantasy Sports","Football","Golf","Hockey","Rugby","Running","Soccer","Swimming","Tennis","Volleyball","Wilderness","Wrestling"],Technology:[],"True Crime":[],"TV & Film":["After Shows","Film History","Film Interviews","Film Reviews","TV Reviews"]},eE={Arts:["Books","Design","Fashion & Beauty","Food","Literature","Performing Arts","Visual Arts"],Business:["Business News","Careers","Investing","Management & Marketing","Shopping"],Comedy:[],Education:["Educational Technology","Higher Education","K-12","Language Courses","Training"],"Games & Hobbies":["Automotive","Aviation","Hobbies","Other Games","Video Games"],"Government & Organizations":["Local","National","Non-Profit","Regional"],Health:["Alternative Health","Fitness & Nutrition","Self-Help","Sexuality"],"Kids & Family":[],Music:[],"News & Politics":[],"Religion & Spirituality":["Buddhism","Christianity","Hinduism","Islam","Judaism","Other","Spirituality"],"Science & Medicine":["Medicine","Natural Sciences","Social Sciences"],"Society & Culture":["History","Personal Journals","Philosophy","Places & Travel"],"Sports & Recreation":["Amateur","College & High School","Outdoor","Professional"],Technology:["Gadgets","Tech News","Podcasting","Software How-To"],"TV & Film":[]},eX=["January","February","March","April","May","June","July","August","September","October","November","December"],eM=[{name:"eu_vat",description:"European VAT number"},{name:"au_abn",description:"Australian Business Number (AU ABN)"},{name:"au_arn",description:"Australian Taxation Office Reference Number"},{name:"br_cnpj",description:"Brazilian CNPJ number"},{name:"br_cpf",description:"Brazilian CPF number"},{name:"bg_uic",description:"Bulgaria Unified Identification Code"},{name:"ca_bn",description:"Canadian BN"},{name:"ca_gst_hst",description:"Canadian GST/HST number"},{name:"ca_pst_bc",description:"Canadian PST number (British Columbia)"},{name:"ca_pst_mb",description:"Canadian PST number (Manitoba)"},{name:"ca_pst_sk",description:"Canadian PST number (Saskatchewan)"},{name:"ca_qst",description:"Canadian QST number (Qu\xe9bec)"},{name:"cl_tin",description:"Chilean TIN"},{name:"eu_oss_vat",description:"European One Stop Shop VAT number for non-Union scheme"},{name:"ge_va",description:"Georgian VAT"},{name:"hk_br",description:"Hong Kong BR number"},{name:"hu_tin",description:"Hungary tax number (ad\xf3sz\xe1m)"},{name:"is_vat",description:"Icelandic VAT"},{name:"in_gst",description:"Indian GST number"},{name:"id_npwp",description:"Indonesian NPWP number"},{name:"il_vat",description:"Israel VAT"},{name:"jp_cn",description:"Japanese Corporate Number (*HÅjin BangÅ*)"},{name:"jp_rn",description:"Japanese Registered Foreign Businesses' Registration Number (*TÅroku Kokugai JigyÅsha no TÅroku BangÅ*) "},{name:"li_uid",description:"Liechtensteinian UID number"},{name:"my_frp",description:"Malaysian FRP number"},{name:"my_itn",description:"Malaysian ITN C"},{name:"my_sst",description:"Malaysian SST number"},{name:"mx_rfc",description:"Mexican RFC number"},{name:"nz_gst",description:"New Zealand GST number"},{name:"no_vat",description:"Norwegian VAT number"},{name:"ru_inn",description:"Russian INN"},{name:"ru_kpp",description:"Russian KPP"},{name:"sa_vat",description:"Saudi Arabia VAT"},{name:"sg_gst",description:"Singaporean GST"},{name:"sg_uen",description:"Singaporean UEN"},{name:"si_tin",description:"Slovenia tax number (davÄna Å¡tevilka)"},{name:"za_vat",description:"South African VAT number"},{name:"kr_brn",description:"Korean BRN"},{name:"es_cif",description:"Spanish CIF number"},{name:"ch_vat",description:"Switzerland VAT number"},{name:"tw_vat",description:"Taiwanese VAT"},{name:"th_vat",description:"Thai VAT"},{name:"ua_vat",description:"Ukrainian VAT"},{name:"ae_trn",description:"United Arab Emirates TRN"},{name:"gb_vat",description:"United Kingdom VAT number"},{name:"us_ein",description:"United States EIN"}],eA={de:"German",es:"Spanish",fr:"French",it:"Italian",pt:"Portuguese","pt-br":"Brazilian Portuguese"},eD=["en","de","es","fr","it","pt"],eR={de:"Deutsch",es:"Espa\xf1ol",fr:"Fran\xe7ais",it:"Italiano",pt:"Portugu\xeas","pt-br":"Portugu\xeas do Brasil"},eF=["ar","cs","de","el","en","es","fr","hi","hu","id","it","ja","ko","la","nl","no","pl","pt","ro","ru","sv","th","tr","vi","zh"],eL=["IN"],ez=604800,eO=.0064,eU={therampart:{sectionIds:[62635]},thebulwark:{sectionIds:[87956]}},eY=e=>{var t;let{section:i,pub:n}=e;return!!(null===(t=eU[n.subdomain])||void 0===t?void 0:t.sectionIds.includes(i.id))};class eH extends Error{constructor({status:e,errType:t,errMessage:i,pub:a,body:l}){super(i),(0,n._)(this,"name",void 0),(0,n._)(this,"status",void 0),(0,n._)(this,"response",void 0),this.name=this.constructor.name,this.status=e,this.response={body:(0,o._)((0,r._)({},l),{status:t,error:i})},a&&(this.response.body.publication=a),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}function ej(e){var t,i,n,r;let{skipMultiContributorCheck:o=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("popularinformation"===e.subdomain)return"Judd Legum";if("whyisthisinteresting"===e.subdomain)return"Noah & Colin";if("informant"===e.subdomain)return"Nick Martin";if("colinmeloy"===e.subdomain)return"Colin Meloy";if("petition"===e.subdomain||"russiandissent"===e.subdomain)return null;if("mattlabash"===e.subdomain)return"Matt Labash";if("wmbrown"===e.subdomain)return"Matt Hranek";if("bigtechontrial"===e.subdomain)return"Matt Stoller";if("thegreenspoon"===e.subdomain)return"Greta and Fanny";if("exponentialview"===e.subdomain)return"Azeem Azhar";if("thegodpod"===e.subdomain)return"God";if(!o&&"object"==typeof e&&"contributors"in e&&(null===(r=e.contributors)||void 0===r?void 0:r.length)>1)return null;let a=e.name||e.subdomain;for(let r of["object"==typeof e&&"contributors"in e&&(null===(i=e.contributors)||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:t.name),"author_name"in e&&e.author_name,e.email_from_name,null==e?void 0:null===(n=e.author)||void 0===n?void 0:n.name])if(r&&(r=r.split(/(,|\||\s-|-\s|\bfrom\b|\bat\b)/g)[0].trim())&&!r.startsWith(a)&&!a.startsWith(r)&&!r.endsWith(a)&&!a.endsWith(r))return r;return null}function eJ(e){var t;let{pub:i,post:n}=e,r=(null==i?void 0:i.twitter_screen_name)||i&&B[null==i?void 0:i.subdomain],o=null!==(t=null==n?void 0:n.title)&&void 0!==t?t:null==i?void 0:i.name;return i&&!n&&(o="Subscribe to ".concat(o)),r&&(!n||i&&(!n.publishedBylines.length||n.publishedBylines.some(e=>e.id===i.author_id)))&&(o+=", by @".concat(r)),o}function eV(e){let{now:t=!1,isFreeSubscribed:i=!1,isMobile:n=!1,isPledged:r=!1,pledgesEnabled:o=!1,language:a,foundingUpsell:l,isFoundingSubscribed:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"Subscribe";let{iString:d}=I18N.i(a||e.language);return iq(e,()=>{if(i&&e.plans&&l&&!s)return d("Upgrade to founding");if(i&&e.plans&&n&&t)return d("Upgrade now");if(i&&e.plans&&n&&!t)return d("Upgrade");if(i&&e.plans&&!n&&t)return d("Upgrade to paid now");if(i&&e.plans&&!n&&!t)return d("Upgrade to paid");else if(i&&o&&!r&&t)return d("Pledge your support now");else if(i&&o&&!r&&!t)return d("Pledge your support");else if(t)return d("Subscribe now");return d("Subscribe")},a=>(i&&e.plans?tJ(n?a.upgrade:a.upgradeToPaid):i&&o&&!r?"Pledge your support":tJ(iW(e,"subscribe")))+(t?" now":""))}function eq(e){let{date:t,bylines:n,like_count:r,comment_count:o,language:a="en"}=e,{iPlural:l}=I18N.i(a),s=i(98012).Z,d=[];return d.push(s(t).locale(a).fromNow()),r&&d.push(l("1 like","%1 likes",r)),o&&d.push(l("1 comment","%1 comments",o)),n&&n.length&&d.push(tL(n.map(e=>e.name).filter(e=>null!==e),a)),d.join(" \xb7 ")}let eW=["astralcodexten"];function eG(e,t){return!(!["astralcodexten","company","library","on","blog","stories"].includes(null==e?void 0:e.subdomain)&&((null==t?void 0:t.type)!=="podcast"||(0,h.HD)({pub:e}))&&((null==t?void 0:t.type)!=="video"||(0,h.HD)({pub:e})))}let eK=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.toUpperCase().replace(/^(THE|A|AN)\s+/,"")};function eQ(e){return e.sort((e,t)=>{var i,n;if(!e)return 1;if(!t||"subscribed"===e.membership_state&&"subscribed"!==t.membership_state)return -1;if("subscribed"===t.membership_state&&"subscribed"!==e.membership_state)return 1;let r=eK(null===(i=e.publication)||void 0===i?void 0:i.name),o=eK(null===(n=t.publication)||void 0===n?void 0:n.name);return r<o?-1:+(r>o)})}function e$(e){if(e.expiry&&new Date(e.expiry)>new Date)switch(e.type){case"gift":return"Gifted Subscription";case"comp":return"Comped Subscription";default:return"Paid Subscriber"}else if(!e.email_disabled||e.email_settings&&Object.values(e.email_settings||{}).some(e=>"individual"===e))return"Free Subscriber";else if(e.email_settings&&Object.values(e.email_settings||{}).some(e=>"digest"===e))return"Follows in Digests";else return"Emails Disabled"}function e0(e){let{post:t,user:i}=e;return!!(t&&i&&i.has_publication&&!i.is_admin&&!i.is_contributor&&"coming-soon"!==t.slug)}let e1="no-reply@substack.com";function e2(e){if(!e||"string"!=typeof e)return e;e=e.replace(/[\u0000-\u0008\u000B-\u001F\u007F]/g,e=>e.length>1?e:" ");try{return encodeURIComponent(e),e}catch(e){}return e.replace(/[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g,e=>e.length>1?e:" ")}function e4(e,t){let i=new TextEncoder().encode(e);return i.length>t?new TextDecoder().decode(i.slice(0,t)):e}function e3(e){for(;;)try{return encodeURIComponent(e),e}catch(t){e=e.substring(0,e.length-1)}}function e8(e,t){let{words:i=null,ellipsis:n="â€¦",extension:r=null}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return e;let o=!1;if(i){let t=new RegExp("^(\\w+\\W+){".concat(i-1,"}\\w+")).exec(e);t&&(o=!0,e=t[0])}return t&&e.length>t&&(o=!0,e=e.substring(0,t-n.length)),o&&(e=e3(e)+n,r&&(e+=r)),e}function e6(e,t){let{ellipsis:i="â€¦",quotationMarks:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return e;n&&(t-=2);let r=e;if(e&&e.length>t){let n=e.split(/\s+/),o=[],a=0;for(;a<=t;){let e=n.shift();if(!e||a+e.length>t)break;o.push(e),a+=e.length+1}r=e7(o.join(" "),i)}return n&&(r.endsWith(" ")||r.startsWith(" "))&&(r=r.trim()),n?'"'.concat(r,'"'):r}let e5=e=>{var t;if(!e)return"";let i=e.trim(),n=i.split(/\s/);return(null!==(t=n[n.length-1])&&void 0!==t?t:"").length>5?i:i.replace(/(\s)(\S+)$/,"\xa0$2")},e9=/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~]+$/g;function e7(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"â€¦";return"".concat(e.replace(e9,"")).concat(t)}function te(e){return/[!.?](?:\s+)?$/.test(e)}let tt=new Set([" ","-"]);function ti(e){let{maxCharsPerLine:t=55,maxLines:i=2,preferWide:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.length<=t)return[e];let r=t*i;if(e.length>r){let t=r;for(;t>=0&&" "!==e.charAt(t);)t--;e=e7(e.slice(0,t))}let o=n?t:Math.floor(e.length/i),a=-1,l=0,s=[];for(;l+o<e.length-1;){for(l+=o;l<=e.length-1&&!tt.has(e.charAt(l));)l++;let t="-"===e.charAt(l);s.push(e.slice(a+1,t?l+1:l)),a=l}return l<e.length-1&&s.push(e.slice(a+1)),s}let tn=e=>/[A-Z]/.test(e),tr=e=>/[\s-]/.test(e);function to(e,t){let i=0;for(let r=0;r<e.length;r+=1){var n;tn(null!==(n=e[r])&&void 0!==n?n:"")?i+=t:i+=1}return i}function ta(e,t,i){let n=[],r=0,o=!1;for(let t=0;t<e.length;t+=1){var a;if(tr(null!==(a=e[t])&&void 0!==a?a:"")){o=!0;continue}o&&(n.push(e.slice(r,t)),r=t,o=!1)}if(r<e.length&&n.push(e.slice(r)),!n[0])return"";let l=[n[0]],s=to(n[0],t);for(let e of n.slice(1))if((s+=to(e,t))<=i)l.push(e);else break;return l.join("")}function tl(e){let{maxCostPerLine:t=55,maxLines:i=2,capitalCost:n=1.2}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e;if(to(e,n)<=t)return[e];let o=[];for(let r=0;r<i;r+=1){let i=ta(e,n,t);if(i)o.push(i),e=e.slice(i.length);else break}if(o.reduce((e,t)=>e+t.length,0)<r.length){var a,l;o[o.length-1]=e7(null===(l=o[o.length-1])||void 0===l?void 0:l.slice(0,(null===(a=o[o.length-1])||void 0===a?void 0:a.length)-1))}return o}let ts=["AT","BE","CY","DE","EE","ES","FI","FR","GR","HR","IE","IT","LT","LU","LV","MT","NL","PT","SI","SK"],td=[...ts,"BG","CZ","DK","HU","PL","RO","SE"],tc=[...td,"IS","LI","NO"],tu=[...td,"AE","AU","CA","CH","GB","GI","HK","JP","LI","MX","MY","NO","NZ","SG","US"],tp=["NZ","CK","NU","PN","TK"],th=["usd","eur","gbp","cad","aud","nzd","brl","mxn","inr","pln"];function tm(e){return"AU"===e?"aud":"BR"===e?"brl":"CA"===e?"cad":"LI"===e||"CH"===e?"chf":"DK"===e||"FO"===e||"GL"===e?"dkk":ts.includes(e)?"eur":"GB"===e?"gbp":"MX"===e?"mxn":"BV"===e||"NO"===e||"SJ"===e?"nok":tp.includes(e)?"nzd":"PL"===e?"pln":"SE"===e?"sek":"US"===e?"usd":null}let tg=e=>{var t,i;return(null===(i=e.draft_plans)||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:t.currency)||"usd"};function tv(e){return["BIF","CLP","DJF","GNF","JPY","KMF","KRW","MGA","PYG","RWF","UGX","VND","VUV","XAF","XOF","XPF"].includes(e.toUpperCase())}function tb(e){return tv(tg(e))}function ty(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:e,minimumFractionDigits:0,maximumFractionDigits:0}).format(0).replace(/\d/,"").trim()}let tf=e=>e/1e8;function t_(e,t){let{forceDecimals:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:i?2:e%100&&!tv(t)?2:0,maximumFractionDigits:"btc"===t?8:2}).format("btc"===t?tf(e):tv(t)?e:e/100);return"usd"===t&&"undefined"!=typeof window&&window._preloads&&window._preloads.country&&X.includes(window._preloads.country)&&(n="US".concat(n)),n}function tZ(e){return new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(e/100)}let tw=new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0});function tC(e){if(!e)return null;if("string"!=typeof e)throw Error("Bad type for dollar string");let t=e.replace(/[^0-9.]/g,"");return t?Math.round(100*Number(t)):null}function tx(e){let t=e/100;return 100*(t=t<50?Math.ceil(t):5*Math.ceil(t/5))}function tS(e){let{quantity:t=1,coupon:i=null,noTrial:n=!1,trial_end_override:r=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!n&&(e.trial_period_days||i&&i.trial_period_days||r&&r>Date.now()/1e3+120))return 0;let o=e.amount*t;return i&&i.percent_off?o=Math.round(o*(1-(i.percent_off_precise||i.percent_off)/100)):i&&i.amount_off&&(o=Math.max(0,o-i.amount_off)),o}function tk(e){let t,i,n,r,{interval:o="month",interval_count:a=eS,multiplier:l=1,min:s=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(let r of e){if(n){if(n!=r.currency)continue}else n=r.currency;"month"==r.interval?(!t||r.amount<t)&&(t=r.amount):"year"==r.interval&&(!i||r.amount<i)&&(i=r.amount)}let d=t;if(!d&&i&&(d=i/12),!d)return null;switch(o){case"month":r=d;break;case"day":r=d/30;break;case"year":r=i||12*d;break;default:throw Error("bad interval: ".concat(o))}let c=r*a*l;return(c=100*Math.floor(c/100))<s?null:t_(c,n)}function tB(e){let{amount:t,interval:i="",language:n="en",isOneOff:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t_(null!=t?t:e.amount,e.currency);if("forever"!==e.interval){let t=i||e.interval,{iPlural:a,iString:l}=I18N.i(n);if(r)return o;if(3===e.interval_count){if("day"===t)return l("%1/three days",o);if("month"===t)return l("%1/three months",o);if("week"===t)return l("%1/three weeks",o);else if("year"===t)return l("%1/three years",o)}if("day"===t)return a("%2/day","%2/%1 days",e.interval_count,o);if("month"===t)return a("%2/month","%2/%1 months",e.interval_count,o);if("week"===t)return a("%2/week","%2/%1 weeks",e.interval_count,o);else if("year"===t)return a("%2/year","%2/%1 years",e.interval_count,o)}return o}function tT(e){let t,{secondsCutoff:i,minutesCutoff:n,hoursCutoff:r,daysCutoff:o,weeksCutoff:a,long:l,noNumber:s,noWord:d,lessThanMinute:c,language:u="en",appendAgo:p}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{iCombo:h}=I18N.i(u);if((e=Math.round(e))<(i||60))return(t=Math.round(e),d)?t:s&&l?h("secondsToLargestUnit","second","seconds",t):s&&!l?h("secondsToLargestUnit","sec","secs",t):!l&&p?h("secondsToLargestUnit","%1 sec ago","%1 secs ago",t):l?p?h("secondsToLargestUnit","%1 second ago","%1 seconds ago",t):h("secondsToLargestUnit","%1 second","%1 seconds",t):h("secondsToLargestUnit","%1 sec","%1 secs",t);if(e<(n||3600)&&c&&!d&&!s)return(t=Math.round(e/60),!l&&p)?h("secondsToLargestUnit","%1 min ago","%1 mins ago",t):l?p?h("secondsToLargestUnit","less than %1 second ago","less than %1 seconds ago",t):h("secondsToLargestUnit","less than %1 minute","less than %1 minutes",t):h("secondsToLargestUnit","less than %1 min","less than %1 mins",t);if(e<(n||3600))return(t=Math.round(e/60),d)?t:s&&l?h("secondsToLargestUnit","minute","minutes",t):s&&!l?h("secondsToLargestUnit","min","mins",t):!l&&p?h("secondsToLargestUnit","%1 min ago","%1 mins ago",t):l?p?h("secondsToLargestUnit","%1 minute ago","%1 minutes ago",t):h("secondsToLargestUnit","%1 minute","%1 minutes",t):h("secondsToLargestUnit","%1 min","%1 mins",t);if(e<(r||86400))return(t=Math.round(e/60/60),d)?t:s&&l?h("secondsToLargestUnit","hour","hours",t):s&&!l?h("secondsToLargestUnit","hr","hrs",t):!l&&p?h("secondsToLargestUnit","%1 hr ago","%1 hrs ago",t):l?p?h("secondsToLargestUnit","%1 hour ago","%1 hours ago",t):h("secondsToLargestUnit","%1 hour","%1 hours",t):h("secondsToLargestUnit","%1 hr","%1 hrs",t);if(e<(o||604800))return(t=Math.round(e/60/60/24),d)?t:s?h("secondsToLargestUnit","day","days",t):p?h("secondsToLargestUnit","%1 day ago","%1 days ago",t):h("secondsToLargestUnit","%1 day","%1 days",t);else if(e<(a||0x1e187e0))return(t=Math.round(e/60/60/24/7),d)?t:s&&l?h("secondsToLargestUnit","week","weeks",t):s&&!l?h("secondsToLargestUnit","wk","wks",t):!l&&p?h("secondsToLargestUnit","%1 wk ago","%1 wks ago",t):l?p?h("secondsToLargestUnit","%1 week ago","%1 weeks ago",t):h("secondsToLargestUnit","%1 week","%1 weeks",t):h("secondsToLargestUnit","%1 wk","%1 wks",t);return(t=Math.round(e/60/60/24/365.25),d)?t:s&&l?h("secondsToLargestUnit","year","years",t):s&&!l?h("secondsToLargestUnit","yr","yrs",t):!l&&p?h("secondsToLargestUnit","%1 yr ago","%1 yrs ago",t):l?p?h("secondsToLargestUnit","%1 year ago","%1 years ago",t):h("secondsToLargestUnit","%1 year","%1 years",t):h("secondsToLargestUnit","%1 yr","%1 yrs",t)}function tI(e){let{strict:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{strict:!1},i=Math.floor(e/60/60),n=Math.floor(e/60)%60,r=Math.floor(e%60);if(!t)return"".concat((i?"".concat(i,":"):"")+(i?"0".concat(n).slice(-2):n),":").concat("0".concat(r).slice(-2));let o=e=>e.toString().padStart(2,"0"),a=o(i),l=o(n),s=o(r);return"".concat(a,":").concat(l,":").concat(s)}function tN(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)}function tP(e){return"#"!==e[0]&&(e="#".concat(e)),e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(e,t,i,n)=>t+t+i+i+n+n)}function tE(e){let t;function i(e,t){"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)&&(e="100%");let i="string"==typeof e&&-1!=e.indexOf("%");return(e=Math.min(t,Math.max(0,parseFloat(e))),i&&(e=parseInt(e*t,10)/100),1e-6>Math.abs(e-t))?1:e%t/parseFloat(t)}e=tP(e);let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),r=parseInt(null==n?void 0:n[1],16),o=parseInt(null==n?void 0:n[2],16),a=parseInt(null==n?void 0:n[3],16);r=i(r,255);let l=Math.max(r,o=i(o,255),a=i(a,255)),s=Math.min(r,o,a),d=l-s;if(l==s)t=0;else{switch(l){case r:t=(o-a)/d+6*(o<a);break;case o:t=(a-r)/d+2;break;case a:t=(r-o)/d+4}t/=6}return{h:t,s:0===l?0:d/l,v:l}}function tX(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(tP(e));return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function tM(e){let{r:t,g:i,b:n}=e;return"#".concat(t.toString(16).padStart(2,"0")).concat(i.toString(16).padStart(2,"0")).concat(n.toString(16).padStart(2,"0"))}function tA(e){let t=tE(e);if(t.h>.11&&t.h<.56){if(t.s>.25&&t.v>.5&&(t.s<.6&&t.v>.8||t.s>.6))return!0}else if(t.s>.25&&t.v>.5)return!0;return!1}function tD(e,t){let i=tX(e);return i?(i.r=Math.max(0,Math.min(255,Math.round(i.r*t))),i.g=Math.max(0,Math.min(255,Math.round(i.g*t))),i.b=Math.max(0,Math.min(255,Math.round(i.b*t))),tM(i)):e}function tR(e){let{r:t,g:i,b:n}=tX(e);return t/=255,i/=255,n/=255,.2126*(t=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(i=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.0722*(n=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))}function tF(e,t){let{name:i=e=>e,restWord:n="other",noNames:r="people",pluralizeRest:o=!0,showRestCount:a=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=e.map(i).filter(Boolean).slice(0,t);if(0===l.length)l.push(t9(e.length,r));else if(l.length<e.length){let t=e.length-l.length;l.push("".concat(a?t:""," ").concat(n).concat(t>1&&o?"s":""))}return tL(l)}function tL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",{iString:i}=I18N.i(t),n="";return 1===e.length?n=e[0]:2===e.length?n=e.join(" ".concat(i("and")," ")):e.length>2&&(n="".concat(e.slice(0,-1).join(", "),", ").concat(i("and")," ").concat(e.slice(-1))),n}function tz(e){let{minSignificantDigits:t=1,language:i="en"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e<1e3)return e.toString();let{iTemplate:n}=I18N.i(i),r=e=>{let i=Math.max(t-1-Math.floor(Math.log10(e)),0);return Math.round(e*Math.pow(10,i))/Math.pow(10,i)};return 1e3>Math.round(e/1e3)?(e/=1e3,n(Z(),r(e))):1e3>Math.round(e/1e6)?(e/=1e6,n(w(),r(e))):1e3>Math.round(e/1e9)?(e/=1e9,n(C(),r(e))):(e/=1e12,n(x(),r(e)))}let tO=e=>Math.max(0,Math.min(5,Math.floor(Math.log(Math.max(e,1))/Math.LN10+1e-9))-1),tU=e=>"\uD83D\uDD25".repeat(tO(e));function tY(e,t,i){let n=(e||"").trim().split(/[\s\r]*\n[\s\r]*/g).map(e=>e.trim()).filter(e=>e),r=[];for(;n.length>0;){let e=n.shift(),o=r[r.length-1];o&&o.length<i?r[r.length-1]+=t+e:r.push(e)}return r.join("\n")}function tH(){return Math.random().toString(36).replace(/^0\./,"")}function tj(e){return e.trim().split(/\s+/).filter(Boolean).map(e=>{var t;return(null===(t=e[0])||void 0===t?void 0:t.toUpperCase())+e.substr(1).toLowerCase()}).join(" ")}function tJ(e,t){var i;let n=t?e.substr(1).toLowerCase():e.substr(1);return(null===(i=e[0])||void 0===i?void 0:i.toUpperCase())+n}function tV(e){let t=["th","st","nd","rd"],i=e%100;return e+(t[(i-20)%10]||t[i]||"th")}function tq(e){let{precision:t=0,language:i="en"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=Number(e.replace(/,/g,""))),new Intl.NumberFormat(i,{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:t}).format(e)}function tW(e){return s()(e)?0:Math.pow(10,Math.floor(Math.log10(e)))||0}function tG(e,t){let{iString:i}=I18N.i(t);if(e<100)return i("tens");if(e<1e3)return i("hundreds");if(e<1e4)return i("thousands");if(e<1e5)return i("tens of thousands");if(e<1e6)return i("hundreds of thousands");else if(e<1e7)return i("millions");else if(e<1e8)return i("tens of millions");else if(e<1e9)return i("hundreds of millions");else if(e<1e10)return i("billions");else if(e<1e11)return i("tens of billions");else if(e<1e12)return i("hundreds of billions");else if(e<1e13)return i("trillions");else if(e<1e14)return i("tens of trillions");else if(e<1e15)return i("hundreds of trillions");return i("gagillions")}function tK(e){let{maximumFractionDigits:t=1,plusSignifier:i="+"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.toLocaleString(void 0,{notation:"compact",maximumFractionDigits:t,roundingMode:"floor"});return e>=1e3?"".concat(n).concat(i):e>0?n:"0"}function tQ(e){return e<=10?"#".concat(e):e<=25?"Top 25":e<=50?"Top 50":e<=100?"Top 100":""}function t$(e){if(e<1e3)return null;let t=1e3*Math.floor(e/1e3);return t>=1e6&&(t=1e5*Math.floor(e/1e5)),tq(t)}function t0(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",{iTemplate:i}=I18N.i(t),n=t$(e);return n?i(S(),n):null}function t1(e){let t;return e?(t=e<1e3?1:e<1e4?100:e<1e6?1e3:1e5,Math.floor(e/t)*t):0}function t2(e){let t=t1(e);return t&&0!==t?tK(t):null}function t4(e,t){let{iString:i}=I18N.i(t);return e&&0!==e?"".concat(t2(e)," ").concat(i(1===e?"subscriber":"subscribers")):i("See subscribers")}let t3=e=>1>Number(e)?"< 1%":"".concat(e,"%");function t8(e){let{rounded:t=!1,display:i=!1,decimalPlaces:n=-1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=100*parseFloat(e);return(n>=0&&(r=r.toFixed(n)),t&&(r=Math.floor(r)),i)?t3(Number(r)):r}function t6(e){var t;return(null==e?void 0:null===(t=e.postSchedules)||void 0===t?void 0:t.length)&&e.postSchedules[0]&&e.postSchedules[0].trigger_at?new Date(e.postSchedules[0].trigger_at):"scheduled_at"in e&&e&&e.scheduled_at?e.email_sent_at&&e.should_send_email?void 0:new Date(Math.max(new Date(e.scheduled_at).getTime(),Date.now())):void 0}function t5(e){if(0===e)return"zero";if(1===e)return"one";if(2===e)return"two";if(3===e)return"three";if(4===e)return"four";else if(5===e)return"five";else if(6===e)return"six";else if(7===e)return"seven";else if(8===e)return"eight";else if(9===e)return"nine";else if(10===e)return"ten";else if(11===e)return"eleven";else if(12===e)return"twelve";return tq(e)}function t9(e,t){let i,n,{zero_fallback:r="",just_word:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t.lastIndexOf(" ")+1,l=t.substr(a),s=t.substr(0,a);return(["person","people"].includes(l)?(i="".concat(s,"person"),n="".concat(s,"people")):["Person","People"].includes(l)?(i="".concat(s,"Person"),n="".concat(s,"People")):["reply","replies"].includes(l)?(i="".concat(s,"reply"),n="".concat(s,"replies")):["Reply","Replies"].includes(l)?(i="".concat(s,"Reply"),n="".concat(s,"Replies")):["entry","entries"].includes(l)?(i="".concat(s,"entry"),n="".concat(s,"entries")):["Entry","Entries"].includes(l)?(i="".concat(s,"Entry"),n="".concat(s,"Entries")):["match","matches"].includes(l)?(i="".concat(s,"match"),n="".concat(s,"matches")):["Match","Matches"].includes(l)?(i="".concat(s,"Match"),n="".concat(s,"Matches")):(i=t,n="".concat(t,"s")),o||(i="".concat(tq(e)," ").concat(i),n="".concat(tq(e)," ").concat(n)),!e&&r)?r:1==e?i:n}function t7(e){return"".concat(e,"â€™").concat("s"===e[e.length-1]?"":"s")}function ie(e){return e.replace(/\n/g,"\\n")}function it(e){let{publication:t,post:i}=e;return!(!i||["adhoc_email","page"].includes(null==i?void 0:i.type))&&t.community_enabled&&i&&"none"!==i.write_comment_permissions}function ii(e){let{publication:t,post:i}=e;return!!(t.community_enabled&&i)}function ir(e){let{publication:t,post:i}=e;return(null==i?void 0:i.type)!=="page"&&(null==i?void 0:i.type)!=="adhoc_email"&&(null==i?void 0:i.slug)!=="coming-soon"&&(i&&i.comment_count>0||it({publication:t,post:i}))}let io=e=>!!(e&&e.is_contributor);function ia(e,t){let{bypassContentAccessCheck:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{userHasFullAccessToPost:r}=i(31377);return!t.is_geoblocked&&(!!(e&&t.publishedBylines&&t.publishedBylines.find(t=>t.id===e.id))||n||r(e,t))}function il(e,t){let{bypassContentAccessCheck:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{userHasFullAccessToPost:r}=i(31377);return!!(e&&t.publishedBylines&&t.publishedBylines.find(t=>t.id===e.id))||n||r(e,t)}let is=e=>"thread"===e.type&&"none"===e.write_comment_permissions;function id(e,t,i){let n=e&&"id"in e?e.id:null;if(n&&t.publishedBylines&&t.publishedBylines.find(e=>e.id===n)||e&&e.is_contributor)return{canReply:!0};switch(t.write_comment_permissions||i.default_write_comment_permissions){case"everyone":return{canReply:!0};case"none":return{canReply:!1,repliesDisabledReason:p.us.comments_disabled};case"only_paid":{if((0,m.isFoundingAudience)(t.audience)){let i=!!e&&(0,m.userHasFullAccessToPost)(e,t);return{canReply:i,repliesDisabledReason:i?void 0:p.us.founding_subscription_required}}let i=!!(e&&e.is_subscribed);return{canReply:i,repliesDisabledReason:i?void 0:p.us.paid_subscription_required}}}return{canReply:!1}}function ic(e,t,i){return id((0,o._)((0,r._)({},e),{is_subscribed:!0}),t,i).canReply}let iu=(e,t)=>!!(t&&e&&e.id===t.user_id);function ip(e,t,i){let{pub:n,post:r,parentComments:o}=i;if(!e||!t)return!1;if(e.id===t.user_id)return!0;if(t.publication_id&&t.post_id){if(im(e,n))return!0}else if(ih({user:e,comment:t,parentComments:o}))return!0;return!1}function ih(e){var t;let{user:i,comment:n,parentComments:r}=e;if(!i||!n||n.publication_id&&n.post_id||i.id===n.user_id||i.is_contributor)return!1;let o=Number(null===(t=n.ancestor_path)||void 0===t?void 0:t.split(".").filter(Boolean)[0]);if(!o)return!1;let a=null==r?void 0:r.find(e=>(null==e?void 0:e.id)===o);return i.id===(null==a?void 0:a.user_id)}function im(e,t){return!!e&&!!(e.id===(null==t?void 0:t.author_id)||(null==t?void 0:t.contributors.find(t=>t.user_id===e.id&&["admin","contributor"].includes(t.role))))}function ig(e,t){return!!e&&!!t&&e.id!==t.user_id}function iv(e){return!!e.plans}function ib(e){return!!(e.plans||e.has_subscribers)}function iy(e){let{type:t,coupon:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.plans&&"page"!==t?i?"only_free":"only_paid":"everyone"}function i_(e,t,i){if("thread"===t)switch(e){case"only_paid":case"founding":return["only_paid"];default:return["everyone"]}else switch(e){case"only_paid":case"founding":return["only_paid","none"];case"everyone":if(i)return["only_paid","everyone","none"];return["everyone","none"];default:return["none"]}}function iZ(e,t,i,n){return null!=e&&i_(t,i,n).includes(e)}function iw(e,t,i,n){return iZ(i.default_write_comment_permissions,e,t,n)?i.default_write_comment_permissions:i_(e,t,n)[0]}function iC(e,t,i){return"page"!==t&&("only_free"===i||!!e.default_post_publish_send_email)}function ix(e,t,i){return t&&"forever"===t.interval?0:Math.max(0,...[e.trial_end_override>Date.now()/1e3?e.trial_end_override:0,t&&"trial_period_days"in t&&t.trial_period_days&&Math.round((Date.now()+864e5*t.trial_period_days)/1e3),i&&i.trial_period_days&&Math.round((Date.now()+864e5*i.trial_period_days)/1e3)].filter(e=>e))}let iS=e=>eX[new Date(e).getMonth()];function ik(e){let{noBreakSpace:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t?"\xa0":" ",n=[];if(1==e.length&&e[0])n=[e[0]];else if(2==e.length&&e[0]&&e[1])n=[e[0],"".concat(i,"and").concat(i),e[1]];else if(e.length>=3)for(let t=0;t<e.length;t++)n.push(e[t]),t<e.length-2?n.push(",".concat(i)):t===e.length-2&&n.push(",".concat(i,"and").concat(i));return n.toString=()=>n.join(""),n}function iB(e){var t;let i=new Map;for(let t of e){let e=i.get(t);e=(e||0)+1,i.set(t,e)}return null===(t=Array.from(i).sort((e,t)=>t[1]-e[1])[0])||void 0===t?void 0:t[0]}function iT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",{iString:i}=I18N.i(t);return i("thread"===e.type?"View thread":"podcast"===e.type?"Listen":"Read")}function iI(e){let{isFinalWord:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"podcast"===e?"listening".concat(t?"":" to"):"video"===e?"watching":"reading"}function iN(e){return"newsletter"===e?"post":"podcast"===e?"episode":"adhoc_email"===e?"email":"video"===e?"video":e}function iP(e){return"".concat(e8(e.title||"Untitled post",115))}function iE(e){return 10475===e.publication_id&&18994===e.section_id}function iX(e){let{isDraft:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?((t?e.draftBylines:e.publishedBylines)||[]).filter(e=>e.name):[]}function iM(e,t){let{isDraft:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=iX(t,{isDraft:i});return n.length>0?tL(n.map(e=>e.name).filter(e=>null!==e)):null}let iA=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e);function iD(e){return"string"==typeof e?c()(e)||0:"number"==typeof e?e:0}function iR(e){let t=e=>new RegExp("^.*".concat(e));if(e){if(e.includes(u.W.CHECKOUT_URL))return e.replace(t(u.W.CHECKOUT_URL),"/subscribe?");if(e.includes(u.W.FOUNDING_CHECKOUT_URL))return e.replace(t(u.W.FOUNDING_CHECKOUT_URL),"/subscribe?plan=founding&");else if(e.includes(u.W.REFERRAL_URL))return e.replace(t(u.W.REFERRAL_URL),"/?showWelcome=true");else if(e.includes(u.W.UNSUBSCRIBE_URL))return e.replace(t(u.W.UNSUBSCRIBE_URL),"/account?");else if(e.includes(u.W.ONE_CLICK_UNSUBSCRIBE_URL))return e.replace(t(u.W.ONE_CLICK_UNSUBSCRIBE_URL),"/account?");else if(/^.*%%.*%%/.test(e))return null}return e}function iF(e){let t=iR(e);if(t){let e=window.open(t,"_blank");(null==e?void 0:e.focus)&&e.focus()}}function iL(e){var t;return!e||["publish","account"].includes(null!==(t=(document.location&&document.location.pathname||"").split("/")[1])&&void 0!==t?t:"")}function iz(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";let i=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,i)).toFixed(t<0?0:t))," ").concat(E[i])}function iO(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return 0;let[t,i]=e.split(" "),n=E.indexOf(i);return n<0?0:Number(t)*Math.pow(1024,n)}function iU(e){return/Googlebot/i.test(e||"")?"Google":/bingbot/i.test(e||"")||/BingPreview/i.test(e||"")?"Bing":/Slurp/i.test(e||"")?"Yahoo":/DuckDuckBot/i.test(e||"")?"DDG":!!/Baiduspider/i.test(e||"")&&"Baidu"}function iY(e,t,i,n){return e.name?e.name:(i&&i.author_id===n.id||t&&t.publishedBylines&&t.publishedBylines.find(e=>e.id===n.id))&&e.email||"Someone"}function iH(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"en",{iTemplate:n}=I18N.i(i);return e&&e.description||t.hero_text||n(k(),t.name)}let ij=[{pubs:["thebulwark"],subscription:"membership",donateItem:"membership",subscriber:"member",subscribe:"join",subscribeTo:"join",upgrade:"join",upgradeTo:"join",upgradeToPaid:"join",upgradeSubscriptionTo:"upgrade your membership to"},{pubs:["georgesaunders"],donateItem:"scholarship"},{pubs:["thecoddlingmovie"],subscribe:new Date>new Date("2024-02-22T08:00:00Z")?"watch the film":"pre-order the film"}],iJ={subscription:"subscription",donateItem:"subscription",subscriber:"subscriber",subscribe:"subscribe",subscribeTo:"subscribe to",upgrade:"upgrade",upgradeTo:"upgrade to",upgradeToPaid:"upgrade to paid",upgradeSubscriptionTo:"upgrade your subscription to"},iV=ij.flatMap(e=>e.pubs);function iq(e,t,i){let n=ij.find(t=>t.pubs.includes(null==e?void 0:e.subdomain))||null,o=n?(0,r._)({},iJ,n):null;return o?i(o):t()}function iW(e,t){let i=e?ij.find(t=>t.pubs.includes(e.subdomain)):void 0,n=i&&i[t];if(!n&&!(n=iJ[t]))throw Error("".concat(t," is not a valid subscription word"));return n}function iG(e){let t={0:8304,1:185,2:178,3:179,4:8308,5:8309,6:8310,7:8311,8:8312,9:8313};return String.fromCodePoint(...Array.from("".concat(e)).map(e=>t[e]))}let iK=e=>{var t,i,n;return null==e?void 0:null===(n=e.plans)||void 0===n?void 0:null===(i=n.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===i?void 0:null===(t=i.metadata)||void 0===t?void 0:t.short_description},iQ=e=>"https://".concat("","checkout.opennode.com/").concat(e);function i$(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=0===e?0:Math.floor(Math.log(e)/Math.log(1024));return"".concat(+(e/Math.pow(1024,t)).toPrecision(3)).concat(["B","KB","MB","GB","TB"][t])}function i0(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en";if(!e)return null;let{iString:i}=I18N.i(t),n=i("Substack Network"),r=i("Substack App"),o=i("Substack Live Video");if(i2(e))return r;let a={"blog.substack.com":n,"library.substack.com":n,"substack-network":n,"on.substack.com":n,"open.substack.com":r,"post-end-cta":"Post Footer CTA","stories.substack.com":n,"substack-app":r,"substack-boost":n,"substack-categories-discovery":r,"substack-categories-discovery-search":r,"substack-comment-links":n,"substack-country-leaderboards":r,"substack-cross-posts":n,"substack-facepiles":n,"substack-feed-item":r,"substack-follow-recommendations":r,"substack-homepage-recommendations":n,"substack-ios-in-app-purchase":"Substack iOS In-App Purchase","substack-leaderboards":r,"substack-live-stream":o,"substack-mentions":n,"substack-notes":r,"substack-onboarding-discovery":r,"substack-paid-gift":r,"substack-post-embeds":n,"substack-post-reply-comment":n,"substack-presubscribe":r,"substack-publication-embeds":n,"substack-reader-discovery":r,"substack-reader-profile-discovery":r,"substack-reader-shared":"Reader sharing","substack-your-weekly-stack":i("Substack Network â€” Your Weekly Stack"),"substack-recommendation-email":n,"substack-recommendations-page":n,"substack-referral":n,"substack-signup-flow":n,"substack-spotify-integration":r,"substack-subscriber-referral":n,"substack-twitter-link":r,"substack-twitter-suggest":r,"substack-xp-post-template":n,"substack-xp-read-next":n,"substack.com":r,"t.co":"Twitter","www.substack.com":r,external:i("external form / api"),"googleads.g.doubleclick.net":"Google","score-upsell":i("Boost upsell to engaged subscribers"),"substack-boost-subscribe-page-upsell":i("Boost upsell on another publication")}[e];return a||(/(\b|\.)facebook\./.test(e)?"Facebook":/(\b|\.)instagram\./.test(e)?"Instagram":/(\b|\.)linkedin\./.test(e)?"LinkedIn":/(\b|\.)youtube\./.test(e)?"YouTube":/(\b|\.)duckduckgo\./.test(e)?"DuckDuckGo":/(\b|\.)medium\./.test(e)?"Medium":/(\b|\.)reddit\./.test(e)?"Reddit":/(\b|\.)bing\./.test(e)?"Bing":/(\b|\.)google\./.test(e)?"Google":(null==e?void 0:e.includes("."))?e:tj(e.replace(/-/g," ")))}function i1(e){return!!i2(e)||["substack-app","substack-categories-discovery","substack-categories-discovery-search","substack-country-leaderboards","substack-feed-item","substack-follow-recommendations","substack-ios-in-app-purchase","substack-leaderboards","substack-live-stream","substack-notes","substack-onboarding-discovery","substack-paid-gift","substack-presubscribe","substack-reader-discovery","substack-reader-profile-discovery","substack-twitter-link","substack-twitter-suggest","substack.com"].includes(e)}function i2(e){return["substack-feed-item","notes_inline_suggestions","notes_sidebar_suggestions","feed-nux","feed-twitter-suggestions","notes_all_suggestions","note_permalink_upsell","notes_likes","note_inline_upsell","notes_restacks","notes_quote_attachment","notes_context","substack-notes"].includes(e)}function i4(e){return!i1(e)&&/substack/i.test(e)}let i3=e=>/^\S+@\S+\.\S+$/.test(e),i8=e=>(e||"").replace(/\s+/g," "),i6={"-2":{short:"Deleted - Flagged as spam",long:"This publication is deleted and every page will show a flagged error"},"-1":{short:"Noindexed - In moderation queue",long:"This publication is temporarily not available to search engines because it is pending moderation, where it will be approved or deleted"},0:{short:"Noindexed - New Pub",long:'This publication is temporarily not available to search engines because the author needs to create a new post other than "coming-soon"'},1:{short:"Available",long:"This publication is available to search engines"},2:{short:"Available w/priority",long:"This publication is available to search engines and is given priority SEO treatment"}};function i5(e){return e?e<3456e3?"monthly":e<8121600?"quarterly":e<0xf53700?"semiannual":e<3456e4?"annual":e>3888e3?"lifetime":"other":"free"}function i9(e){return e&&("newspaper"===e.homepage_type||"magaziney"===e.homepage_type)}let i7=35;function ne(e){let t,i,{isStatic:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.width>=e.height*(960/540)?i=Math.round((t=n?550:960)*(e.height/e.width)):e.width>=e.height?i=Math.round((t=n?550:728)*(e.height/e.width)):t=i=n?550:728,{height:i,width:t}}function nt(e){let t=i(98012).Z,n=t(e);return t.utc([n.year(),n.month(),n.date(),8,0,0]).toDate()}function ni(){let{now:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=i(98012).Z,n=e?t(e):t(),r=n.utc().startOf("day").add(5,"hour");return r.isBefore(n)&&(r=r.utc().add(1,"day")),r}function nn(e){let t=Math.round(e/60),i=Math.floor(t/60);return"".concat(i?"".concat(i,"HR "):"").concat(t%60,"M")}function nr(e){let t=Math.round(e/60),i=Math.floor(t/60),n=t%60;return i?"".concat(i,"h ").concat(n,"m"):n?"".concat(n,"m"):"".concat(Math.round(e),"s")}function no(e){let t=e.toLowerCase()[0];return["a","e","i","o","u"].includes(null!=t?t:"")}function na(e){return"".concat(e.toLowerCase().startsWith("uni watch")?"a":no(e)?"an":"a"," ").concat(e)}function nl(e){return e.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0)}function ns(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",{iContext:i}=I18N.i(t),n=i("thousandsAbbreviation","K");return Math.abs(e)>9999?"".concat(Math.sign(e)*(Math.abs(e)/1e3).toFixed(1)).concat(n):(Math.sign(e)*Math.abs(e)).toString()}function nd(e){var t,i,n,r,o;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",{iString:l}=I18N.i(a);return l((null===(t=e.metadata)||void 0===t?void 0:t.short_description_english)==="Stammleser"||(null===(i=e.metadata)||void 0===i?void 0:i.short_description_english)==="Gr\xfcndungsmitglied"?"Founding Member":(null===(n=e.metadata)||void 0===n?void 0:n.short_description_english)?null===(r=e.metadata)||void 0===r?void 0:r.short_description_english:(null===(o=e.metadata)||void 0===o?void 0:o.short_description)?e.metadata.short_description:"year"===e.interval?"Annual":"forever"===e.interval?"Founding Membership":"month"===e.interval&&3===e.interval_count?"Quarterly":"month"===e.interval&&6===e.interval_count?"Semiannually":"day"===e.interval?"Daily":"week"===e.interval?"Weekly":"Monthly")}let nc=function(){let{minLength:e,maxLength:t,minAlphaNumeric:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n=>{if(!n)return"Missing input";if(e&&n.length<e)return"Must be at least ".concat(e," characters long");if(t&&n.length>t)return"Must be at most ".concat(t," characters long");let r=RegExp("\\P{P}|`","gu"),o=n.match(r);if(!o||(null==o?void 0:o.length)<(null!=i?i:e))return"Must contain at least ".concat(null!=i?i:e," non-punctuation characters");let a=["`"],l=0;return(o.forEach(e=>{a.includes(e)&&(l+=1)}),o.length-l<(null!=i?i:e))?"Must contain at least ".concat(null!=i?i:e," non-punctuation characters"):null}};function nu(e,t){let i=y.env[e];if(void 0!==i)return i;if(void 0!==t)return t;throw Error("Missing required env var ".concat(e))}function np(e){return new Promise((t,i)=>{let n=[];e.on("data",e=>n.push(e)),e.once("end",()=>t(f.concat(n))),e.once("error",i)})}function nh(e){let{maxWidth:t=55,maxLines:i=2,charWidth:n=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=[],o="",a=0;for(let l of e.split(" ")){let e=l.length*n;if(a+e<=t)o?(o+=" ".concat(l),a+=e+n):(o=l,a=e);else if(r.push(o),o=l,a=e,r.length===i)break}if(r.length===i&&o){let e=t-a;e>=3?o+="...":o="".concat(o.substring(0,o.length-(3-e)),"..."),r[i-1]=o}else o&&r.push(o);return r}function nm(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0)}function ng(e){return(null==e?void 0:e.id)&&e.id.toString(36)||null}function nv(e){if(!e)return null;try{let t=parseInt(e,36);return isNaN(t)||t>es?null:t}catch(e){return null}}function nb(e,t){return"string"!=typeof e?t[0]:t.includes(e)?e:t[0]}function ny(e){var t,i,n;let r=Array(null===(t=e[0])||void 0===t?void 0:t.length).fill(0);for(let t=0;t<e.length;t++)for(let o=0;o<(null==e?void 0:null===(i=e[t])||void 0===i?void 0:i.length);o++)r[o]+=(null==e?void 0:null===(n=e[t])||void 0===n?void 0:n[o])/e.length;return r}function nf(e){return[...e].map(e=>String.fromCodePoint(e.toUpperCase().codePointAt()+127397)).join("")}let n_=[{label:"Generic",value:"generic",url:"https://substack.com/content",message:void 0},{label:"Copyright Infringement",value:"copyright_infringement",url:"https://substack.com/dispute",message:"Warning: We have detected potential copyrighted content in your stream. Please remove any unauthorized content immediately to avoid additional enforcement actions from being taken against this stream or your account."},{label:"Explicit Content",value:"explicit_content",url:"https://substack.com/content",message:"Warning: We have detected a potential violation of Substack's Nudity/Porn/Erotica policy. As a reminder, Substack does not allow visual depictions of sexual acts. Please remove any violating content to avoid additional enforcement actions from being taken against this stream or your account."},{label:"Harmful and Illegal Activities",value:"harmful_and_illegal_activities",url:"https://substack.com/content",message:"We have detected a potential violation of Substack's Harmful & Illegal Activities policy. As a reminder, Substack does not allow content that promotes harmful or illegal activities, including material that advocates, threatens, or shows your causing harm to yourself, other people, or animals. Please remove any violating content to avoid additional enforcement actions from being taken against this stream or your account."}],nZ=["US","GB","CA","FR","DE","ES","IT","NL","PL","GR","BE","IE","PT"]},22498:function(e,t,i){i.d(t,{aT:()=>l,cb:()=>o,je:()=>r});var n=i(62092);function r(e,t){let{nodeTypes:i,reverse:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(e,t,{nodeTypes:i,reverse:n})}function o(e,t){let{nodeTypes:i,reverse:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(e,t,{nodeTypes:i,reverse:n})}function a(e,t){var i;let{nodeTypes:r,reverse:o=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;if(!e)return;r&&!Array.isArray(r)&&(r=[r]);let d=!1;if("type"in e&&e.type&&(r?"string"==typeof e.type&&r.includes(e.type)?d=!0:"string"!=typeof e.type&&"name"in e.type&&r.includes(e.type.name)&&(d=!0):d=!0),"type"in e&&d){let i=t(e,s);if(!1===i||i===l)return i}let c=[];if((0,n.f5)(e))Array.isArray(e.content)&&(c=e.content);else if((null===(i=e.content)||void 0===i?void 0:i.childCount)&&e.content.childCount>0)for(let t=0;t<e.content.childCount;t++)c.push(e.content.child(t));for(let i of(o&&(c=c.reverse()),c))if(a(i,t,{nodeTypes:r,reverse:o},e)===l)return l}let l=Symbol("done")}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=e,i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};i.t=function(n,r){if(1&r&&(n=this(n)),8&r||"object"==typeof n&&n&&(4&r&&n.__esModule||16&r&&"function"==typeof n.then))return n;var o=Object.create(null);i.r(o);var a={};e=e||[null,t({}),t([]),t(t)];for(var l=2&r&&n;"object"==typeof l&&!~e.indexOf(l);l=t(l))Object.getOwnPropertyNames(l).forEach(function(e){a[e]=function(){return n[e]}});return a.default=function(){return n},i.d(o,a),o}})(),i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=function(e){return Promise.all(Object.keys(i.f).reduce(function(t,n){return i.f[n](e,t),t},[]))},i.hmd=function(e){return(e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e},i.u=function(e){return"565"===e?"static/js/565.db243e90.js":"222"===e?"static/js/222.0d7e6c9c.js":"3751"===e?"static/js/3751.1cb41153.js":"7283"===e?"static/js/7283.1ab51ea6.js":"2280"===e?"static/js/2280.107f63a3.js":"1621"===e?"static/js/1621.8b495e16.js":"1184"===e?"static/js/1184.e47824c5.js":"3290"===e?"static/js/3290.51c9f5d8.js":"5394"===e?"static/js/5394.485bcabc.js":"6336"===e?"static/js/6336.8996d4aa.js":"9931"===e?"static/js/9931.eb824b53.js":"6299"===e?"static/js/6299.11823971.js":"8381"===e?"static/js/8381.07397fc1.js":"static/js/async/"+e+"."+({1400:"a5416051",1466:"6bbfa6d7",2290:"07192e48",2457:"6d896428",2667:"050bc694",2926:"b66edd22",3134:"ee4cb44f",3139:"f6f29dda",3875:"3eb97739",3894:"abd1971d",4139:"9f9e7519",4213:"93dec63f",4713:"47aa8ddc",4754:"a7c372e8",4769:"53e5db8b",4803:"908f8757",4834:"69343a92",5477:"9b021d43",553:"3d48574a",5551:"d1099c61",5571:"41d8276a",5590:"1f69ee6d",5850:"961b6d5b",5871:"4a866c47",6175:"6ca5b627",6666:"33bcc480",6993:"2070ab64",7152:"4b27437b",7381:"01091de5",7499:"97500584",7710:"0af693dc",7833:"609655ac",8427:"b11b4d57",8693:"c871a13e",881:"de15e495",8842:"db727af5",893:"633d5990",9314:"7e77435c",9327:"5d94bfa3",9340:"2b347aa4"})[e]+".js"},i.miniCssF=function(e){return"3119"===e?"static/css/3119.3c17cd82.css":"static/css/async/"+e+"."+({1400:"be5485b6",2290:"30136bb9",2457:"ba703026",2516:"45761dbe",3139:"6fc5e6b6",3875:"18c3fcdc",3894:"216e944d",4213:"606915eb",4713:"16faf46d",4769:"92492746",4834:"9c290112",6666:"aaca9004",893:"a71df167",9314:"7ec37487",9340:"ce2fb3ea"})[e]+".css"},i.h=function(){return"3c763a22aa42b921"},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},(()=>{var e={},t="substack:";i.l=function(n,r,o,a){if(e[n]){e[n].push(r);return}if(void 0!==o)for(var l,s,d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+o){l=u;break}}l||(s=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,i.nc&&l.setAttribute("nonce",i.nc),l.setAttribute("data-webpack",t+o),l.src=n),e[n]=[r];var p=function(t,i){l.onerror=l.onload=null,clearTimeout(h);var r=e[n];if(delete e[n],l.parentNode&&l.parentNode.removeChild(l),r&&r.forEach(function(e){return e(i)}),t)return t(i)},h=setTimeout(p.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=p.bind(null,l.onerror),l.onload=p.bind(null,l.onload),s&&document.head.appendChild(l)}})(),i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},(()=>{var e=[];i.O=function(t,n,r,o){if(n){o=o||0;for(var a=e.length;a>0&&e[a-1][2]>o;a--)e[a]=e[a-1];e[a]=[n,r,o];return}for(var l=1/0,a=0;a<e.length;a++){for(var n=e[a][0],r=e[a][1],o=e[a][2],s=!0,d=0;d<n.length;d++)(!1&o||l>=o)&&Object.keys(i.O).every(function(e){return i.O[e](n[d])})?n.splice(d--,1):(s=!1,o<l&&(l=o));if(s){e.splice(a--,1);var c=r();void 0!==c&&(t=c)}}return t}})(),i.p="https://substackcdn.com/bundle/",i.rv=function(){return"1.2.5"},i.j="4716",(()=>{if("undefined"!=typeof document){var e=function(e,t,n,r,o){var a=document.createElement("link");return a.rel="stylesheet",a.type="text/css",i.nc&&(a.nonce=i.nc),a.onerror=a.onload=function(i){if(a.onerror=a.onload=null,"load"===i.type)r();else{var n=i&&("load"===i.type?"missing":i.type),l=i&&i.target&&i.target.href||t,s=Error("Loading CSS chunk "+e+" failed.\\n("+l+")");s.code="CSS_CHUNK_LOAD_FAILED",s.type=n,s.request=l,a.parentNode&&a.parentNode.removeChild(a),o(s)}},a.href=t,n?n.parentNode.insertBefore(a,n.nextSibling):document.head.appendChild(a),a},t=function(e,t){for(var i=document.getElementsByTagName("link"),n=0;n<i.length;n++){var r=i[n],o=r.getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(o===e||o===t))return r}for(var a=document.getElementsByTagName("style"),n=0;n<a.length;n++){var r=a[n],o=r.getAttribute("data-href");if(o===e||o===t)return r}},n={4716:0};i.f.miniCss=function(r,o){if(n[r])o.push(n[r]);else if(0!==n[r]&&({2290:1,3875:1,6666:1,3119:1,4769:1,3139:1,1400:1,9340:1,2457:1,4713:1,893:1,3894:1,9314:1,2516:1,4213:1,4834:1})[r])o.push(n[r]=new Promise(function(n,o){var a=i.miniCssF(r),l=i.p+a;if(t(a,l))return n();e(r,l,null,n,o)}).then(function(){n[r]=0},function(e){throw delete n[r],e}))}}})(),(()=>{var e={4716:0,7023:0,8309:0,994:0};i.f.j=function(t,n){var r=i.o(e,t)?e[t]:void 0;if(0!==r){if(r)n.push(r[2]);else if(/^(2516|3119|7023|8309|994)$/.test(t))e[t]=0;else{var o=new Promise(function(i,n){r=e[t]=[i,n]});n.push(r[2]=o);var a=i.p+i.u(t),l=Error();i.l(a,function(n){if(i.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;l.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",l.name="ChunkLoadError",l.type=o,l.request=a,r[1](l)}},"chunk-"+t,t)}}},i.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,o,a=n[0],l=n[1],s=n[2],d=0;if(a.some(function(t){return 0!==e[t]})){for(r in l)i.o(l,r)&&(i.m[r]=l[r]);if(s)var c=s(i)}for(t&&t(n);d<a.length;d++)o=a[d],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(c)},n=self.webpackChunksubstack=self.webpackChunksubstack||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),i.ruid="bundler=rspack@1.2.5";var n=i.O(void 0,["5129","6304","6535","9505","3860","6622","9539","3792","6651","8504","8117","566","1426","5410","4777","546","4838","5431","5268","9027","4850","4057","6454","8867","4955","2265","2629","7536","735","994","5330","4880","8309","7023","770","6190","32","1756","7949","1929","7952","3686","3115","7944","1262","3144","7517","3530","2757","4040","3065","3734","3173","4725","2536","4539","5947","9846","9517","1273","7562","1635","3862","5053","7566","5042","5519","4280","7197","8074","2710","6334","6725","5672","7858","7248","6835","774","3810","2430","5456","4918","773"],function(){return i(11672)});n=i.O(n)})();